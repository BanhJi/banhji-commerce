{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/babel-loader/lib/index.js!/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/eslint-loader/index.js??ref--13-0!/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/cookie.js","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/cookie.js","mtime":1640595536765},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:J3VzZSBzdHJpY3QnOwoKdmFyIF9hc3luY1RvR2VuZXJhdG9yID0gcmVxdWlyZSgiL1VzZXJzL21hY29zL0Rlc2t0b3AvYmFuaGppLTAuMi9iYW5oamktY29tbWVyY2Uvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvYXN5bmNUb0dlbmVyYXRvciIpLmRlZmF1bHQ7CgpyZXF1aXJlKCJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdC5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiKTsKCnZhciBqd3QgPSByZXF1aXJlKCdqc29ud2VidG9rZW4nKTsKCnZhciBheGlvcyA9IHJlcXVpcmUoJ2F4aW9zJyk7Cgp2YXIgX3JlcXVpcmUgPSByZXF1aXJlKCcuL29ic2VydmFibGUvc3RvcmUnKSwKICAgIGRhdGFTdG9yZSA9IF9yZXF1aXJlLmRhdGFTdG9yZTsKCnZhciBnZXRDb29raWUgPSBmdW5jdGlvbiBnZXRDb29raWUoY25hbWUpIHsKICB2YXIgbmFtZSA9IGNuYW1lICsgIj0iOwogIHZhciBjYSA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgnOycpOwoKICBmb3IgKHZhciBpID0gMDsgaSA8IGNhLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgYyA9IGNhW2ldOwoKICAgIHdoaWxlIChjLmNoYXJBdCgwKSA9PT0gJyAnKSB7CiAgICAgIGMgPSBjLnN1YnN0cmluZygxKTsKICAgIH0KCiAgICBpZiAoYy5pbmRleE9mKG5hbWUpID09PSAwKSByZXR1cm4gYy5zdWJzdHJpbmcobmFtZS5sZW5ndGgsIGMubGVuZ3RoKTsKICB9CgogIHJldHVybiAiIjsKfTsKCm1vZHVsZS5leHBvcnRzLmdldENvb2tpZSA9IGZ1bmN0aW9uICgpIHsKICB0cnkgewogICAgdmFyIGJhbmhqaUNvb2tpZSA9IGdldENvb2tpZSgnYmFuaGppLXRva2VuJyArIHByb2Nlc3MuZW52LlZVRV9BUFBfTU9ERSk7CgogICAgaWYgKGJhbmhqaUNvb2tpZSAhPT0gJycpIHsKICAgICAgdmFyIGNvb2tpZSA9IGp3dC52ZXJpZnkoYmFuaGppQ29va2llLCBwcm9jZXNzLmVudi5WVUVfQVBQX0pXVF9TRVNDUkVUKTsKICAgICAgLyogQXBwbHkgdG9rZW4gdG8gZ2xvYmFsIGF4aW9zIGRlZmF1bHRzICovCgogICAgICB2YXIgQVVUSF9UT0tFTiA9IGNvb2tpZS5hY2Nlc3NUb2tlbjsgLy8gUmVxdWVzdCBpbnRlcmNlcHRvciBmb3IgQVBJIGNhbGxzCgogICAgICBheGlvcy5pbnRlcmNlcHRvcnMucmVxdWVzdC51c2UoZnVuY3Rpb24gKGNvbmZpZykgewogICAgICAgIC8vIERvIHNvbWV0aGluZyBiZWZvcmUgcmVxdWVzdCBpcyBzZW50CiAgICAgICAgY29uZmlnLmhlYWRlcnMgPSB7CiAgICAgICAgICAnQXV0aG9yaXphdGlvbic6ICJCZWFyZXIgIi5jb25jYXQoQVVUSF9UT0tFTiksCiAgICAgICAgICAnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIGNvbmZpZzsKICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgLy8gRG8gc29tZXRoaW5nIHdpdGggcmVxdWVzdCBlcnJvcgogICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7CiAgICAgIH0pOyAvLyBSZXNwb25zZSBpbnRlcmNlcHRvciBmb3IgQVBJIGNhbGxzCgogICAgICBheGlvcy5pbnRlcmNlcHRvcnMucmVzcG9uc2UudXNlKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIHJldHVybiByZXNwb25zZTsKICAgICAgfSwgLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgICB2YXIgX3JlZiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShlcnJvcikgewogICAgICAgICAgdmFyIG9yaWdpbmFsUmVxdWVzdDsKICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgb3JpZ2luYWxSZXF1ZXN0ID0gZXJyb3IuY29uZmlnOwoKICAgICAgICAgICAgICAgICAgaWYgKCEoZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MDMgJiYgIW9yaWdpbmFsUmVxdWVzdC5fcmV0cnkpKSB7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIG9yaWdpbmFsUmVxdWVzdC5fcmV0cnkgPSB0cnVlOwogICAgICAgICAgICAgICAgICBheGlvcy5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnQXV0aG9yaXphdGlvbiddID0gIkJlYXJlciAiLmNvbmNhdChBVVRIX1RPS0VOKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgYXhpb3Mob3JpZ2luYWxSZXF1ZXN0KSk7CgogICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBQcm9taXNlLnJlamVjdChlcnJvcikpOwoKICAgICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgICB9KSk7CgogICAgICAgIHJldHVybiBmdW5jdGlvbiAoX3gpIHsKICAgICAgICAgIHJldHVybiBfcmVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfTsKICAgICAgfSgpKTsgLy8gYXhpb3MuZGVmYXVsdHMuYmFzZVVSTCA9ICdodHRwczovL2Rldi1hcGlzLmJhbmhqaS5jb20nOwogICAgICAvLyBJbXBvcnRhbnQ6IElmIGF4aW9zIGlzIHVzZWQgd2l0aCBtdWx0aXBsZSBkb21haW5zLCB0aGUgQVVUSF9UT0tFTiB3aWxsIGJlIHNlbnQgdG8gYWxsIG9mIHRoZW0uCiAgICAgIC8vIFNlZSBiZWxvdyBmb3IgYW4gZXhhbXBsZSB1c2luZyBDdXN0b20gaW5zdGFuY2UgZGVmYXVsdHMgaW5zdGVhZC4KICAgICAgLy8gYXhpb3MuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ0F1dGhvcml6YXRpb24nXSA9IGBCZWFyZXIgJHtBVVRIX1RPS0VOfWA7CiAgICAgIC8vIGF4aW9zLmRlZmF1bHRzLmhlYWRlcnMucG9zdFsnQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJzsKCiAgICAgIHJldHVybiBjb29raWU7CiAgICB9IGVsc2UgewogICAgICBkYXRhU3RvcmUuaXNWYWxpZFVzZXIgPSBmYWxzZTsKICAgICAgcmV0dXJuIHsKICAgICAgICBpbnN0aXR1dGVJZDogJycsCiAgICAgICAgY3JlYXRvcjogJycsCiAgICAgICAgdXNlcjogJycsCiAgICAgICAgbmFtZTogJycsCiAgICAgICAgZW1haWw6ICcnLAogICAgICAgIHBsYW46ICcnLAogICAgICAgIGFjY2Vzc1Rva2VuOiAnJwogICAgICB9OwogICAgfQogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICB3aW5kb3cuY29uc29sZS5lcnJvcihlcnJvcik7CiAgICByZXR1cm4gZmFsc2U7CiAgICAvKiBGb3IgYXV0aCB2YWxpZGF0aW9uICovCiAgfQp9Ow=="},{"version":3,"sources":["/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/cookie.js"],"names":["jwt","require","axios","dataStore","getCookie","cname","name","ca","document","cookie","split","i","length","c","charAt","substring","indexOf","module","exports","banhjiCookie","process","env","VUE_APP_MODE","verify","VUE_APP_JWT_SESCRET","AUTH_TOKEN","accessToken","interceptors","request","use","config","headers","error","Promise","reject","response","originalRequest","status","_retry","defaults","common","isValidUser","instituteId","creator","user","email","plan","window","console"],"mappings":"AAAA;;;;;;;;;;;;AAEA,IAAMA,GAAG,GAAGC,OAAO,CAAC,cAAD,CAAnB;;AACA,IAAMC,KAAK,GAAGD,OAAO,CAAC,OAAD,CAArB;;AACA,eAAoBA,OAAO,CAAC,oBAAD,CAA3B;AAAA,IAAOE,SAAP,YAAOA,SAAP;;AAEA,IAAIC,SAAS,GAAG,SAAZA,SAAY,CAACC,KAAD,EAAW;AACvB,MAAIC,IAAI,GAAGD,KAAK,GAAG,GAAnB;AACA,MAAIE,EAAE,GAAGC,QAAQ,CAACC,MAAT,CAAgBC,KAAhB,CAAsB,GAAtB,CAAT;;AACA,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,EAAE,CAACK,MAAvB,EAA+BD,CAAC,EAAhC,EAAoC;AAChC,QAAIE,CAAC,GAAGN,EAAE,CAACI,CAAD,CAAV;;AACA,WAAOE,CAAC,CAACC,MAAF,CAAS,CAAT,MAAgB,GAAvB;AAA4BD,MAAAA,CAAC,GAAGA,CAAC,CAACE,SAAF,CAAY,CAAZ,CAAJ;AAA5B;;AACA,QAAIF,CAAC,CAACG,OAAF,CAAUV,IAAV,MAAoB,CAAxB,EAA2B,OAAOO,CAAC,CAACE,SAAF,CAAYT,IAAI,CAACM,MAAjB,EAAyBC,CAAC,CAACD,MAA3B,CAAP;AAC9B;;AACD,SAAO,EAAP;AACH,CATD;;AAWAK,MAAM,CAACC,OAAP,CAAed,SAAf,GAA2B,YAAM;AAC7B,MAAI;AACA,QAAIe,YAAY,GAAGf,SAAS,CAAC,iBAAiBgB,OAAO,CAACC,GAAR,CAAYC,YAA9B,CAA5B;;AACA,QAAIH,YAAY,KAAK,EAArB,EAAyB;AACrB,UAAMV,MAAM,GAAGT,GAAG,CAACuB,MAAJ,CAAWJ,YAAX,EAAyBC,OAAO,CAACC,GAAR,CAAYG,mBAArC,CAAf;AAEA;;AACA,UAAMC,UAAU,GAAGhB,MAAM,CAACiB,WAA1B,CAJqB,CAMrB;;AACAxB,MAAAA,KAAK,CAACyB,YAAN,CAAmBC,OAAnB,CAA2BC,GAA3B,CAA+B,UAAUC,MAAV,EAAkB;AAC7C;AACAA,QAAAA,MAAM,CAACC,OAAP,GAAiB;AACb,4CAA2BN,UAA3B,CADa;AAEb,oBAAU,kBAFG;AAGb,0BAAgB;AAHH,SAAjB;AAMA,eAAOK,MAAP;AACH,OATD,EASG,UAAUE,KAAV,EAAiB;AAChB;AACA,eAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACH,OAZD,EAPqB,CAqBrB;;AACA9B,MAAAA,KAAK,CAACyB,YAAN,CAAmBQ,QAAnB,CAA4BN,GAA5B,CAAgC,UAACM,QAAD,EAAc;AAC1C,eAAOA,QAAP;AACH,OAFD;AAAA,2EAEG,iBAAgBH,KAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AACOI,kBAAAA,eADP,GACyBJ,KAAK,CAACF,MAD/B;;AAAA,wBAEKE,KAAK,CAACG,QAAN,CAAeE,MAAf,KAA0B,GAA1B,IAAiC,CAACD,eAAe,CAACE,MAFvD;AAAA;AAAA;AAAA;;AAGKF,kBAAAA,eAAe,CAACE,MAAhB,GAAyB,IAAzB;AACApC,kBAAAA,KAAK,CAACqC,QAAN,CAAeR,OAAf,CAAuBS,MAAvB,CAA8B,eAA9B,qBAA2Df,UAA3D;AAJL,mDAMYvB,KAAK,CAACkC,eAAD,CANjB;;AAAA;AAAA,mDASQH,OAAO,CAACC,MAAR,CAAeF,KAAf,CATR;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAFH;;AAAA;AAAA;AAAA;AAAA,WAtBqB,CAoCrB;AACA;AACA;AACA;AACA;;AAEA,aAAOvB,MAAP;AACH,KA3CD,MA2CO;AACHN,MAAAA,SAAS,CAACsC,WAAV,GAAwB,KAAxB;AACA,aAAO;AACHC,QAAAA,WAAW,EAAE,EADV;AAEHC,QAAAA,OAAO,EAAE,EAFN;AAGHC,QAAAA,IAAI,EAAE,EAHH;AAIHtC,QAAAA,IAAI,EAAE,EAJH;AAKHuC,QAAAA,KAAK,EAAE,EALJ;AAMHC,QAAAA,IAAI,EAAE,EANH;AAOHpB,QAAAA,WAAW,EAAE;AAPV,OAAP;AASH;AACJ,GAzDD,CAyDE,OAAOM,KAAP,EAAc;AACZe,IAAAA,MAAM,CAACC,OAAP,CAAehB,KAAf,CAAqBA,KAArB;AACA,WAAO,KAAP;AAAc;AACjB;AACJ,CA9DD","sourcesContent":["'use strict'\n\nconst jwt = require('jsonwebtoken');\nconst axios = require('axios');\nconst {dataStore} = require('./observable/store');\n\nlet getCookie = (cname) => {\n    var name = cname + \"=\";\n    var ca = document.cookie.split(';');\n    for (var i = 0; i < ca.length; i++) {\n        var c = ca[i];\n        while (c.charAt(0) === ' ') c = c.substring(1);\n        if (c.indexOf(name) === 0) return c.substring(name.length, c.length);\n    }\n    return \"\";\n}\n\nmodule.exports.getCookie = () => {\n    try {\n        let banhjiCookie = getCookie('banhji-token' + process.env.VUE_APP_MODE );\n        if (banhjiCookie !== '') {\n            const cookie = jwt.verify(banhjiCookie, process.env.VUE_APP_JWT_SESCRET);\n\n            /* Apply token to global axios defaults */\n            const AUTH_TOKEN = cookie.accessToken;\n\n            // Request interceptor for API calls\n            axios.interceptors.request.use(function (config) {\n                // Do something before request is sent\n                config.headers = {\n                    'Authorization': `Bearer ${AUTH_TOKEN}`,\n                    'Accept': 'application/json',\n                    'Content-Type': 'application/json',\n                }\n\n                return config;\n            }, function (error) {\n                // Do something with request error\n                return Promise.reject(error);\n            });\n\n            // Response interceptor for API calls\n            axios.interceptors.response.use((response) => {\n                return response\n            }, async function (error) {\n                const originalRequest = error.config;\n                if (error.response.status === 403 && !originalRequest._retry) {\n                    originalRequest._retry = true;\n                    axios.defaults.headers.common['Authorization'] = `Bearer ${AUTH_TOKEN}`;\n\n                    return axios(originalRequest);\n                }\n\n                return Promise.reject(error);\n            });\n\n            // axios.defaults.baseURL = 'https://dev-apis.banhji.com';\n            // Important: If axios is used with multiple domains, the AUTH_TOKEN will be sent to all of them.\n            // See below for an example using Custom instance defaults instead.\n            // axios.defaults.headers.common['Authorization'] = `Bearer ${AUTH_TOKEN}`;\n            // axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';\n\n            return cookie;\n        } else {\n            dataStore.isValidUser = false\n            return {\n                instituteId: '',\n                creator: '',\n                user: '',\n                name: '',\n                email: '',\n                plan: '',\n                accessToken: '',\n            }\n        }\n    } catch (error) {\n        window.console.error(error);\n        return false; /* For auth validation */\n    }\n}"]}]}