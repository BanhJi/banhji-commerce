{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/babel-loader/lib/index.js!/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/eslint-loader/index.js??ref--14-0!/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/cookie.js","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/cookie.js","mtime":1638499442953},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/babel.config.js","mtime":1638499442885},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:J3VzZSBzdHJpY3QnOwoKdmFyIF9hc3luY1RvR2VuZXJhdG9yID0gcmVxdWlyZSgiL1VzZXJzL21hY29zL0Rlc2t0b3AvYmFuaGppLTAuMi9iYW5oamktYWNjb3VudGluZy13ZWItbW9kdWxlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2FzeW5jVG9HZW5lcmF0b3IuanMiKS5kZWZhdWx0OwoKcmVxdWlyZSgicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIik7Cgp2YXIgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7Cgp2YXIgYXhpb3MgPSByZXF1aXJlKCdheGlvcycpOwoKdmFyIF9yZXF1aXJlID0gcmVxdWlyZSgnLi9vYnNlcnZhYmxlL3N0b3JlJyksCiAgICBkYXRhU3RvcmUgPSBfcmVxdWlyZS5kYXRhU3RvcmU7Cgp2YXIgZ2V0Q29va2llID0gZnVuY3Rpb24gZ2V0Q29va2llKGNuYW1lKSB7CiAgdmFyIG5hbWUgPSBjbmFtZSArICI9IjsKICB2YXIgY2EgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKTsKCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjYS5sZW5ndGg7IGkrKykgewogICAgdmFyIGMgPSBjYVtpXTsKCiAgICB3aGlsZSAoYy5jaGFyQXQoMCkgPT09ICcgJykgewogICAgICBjID0gYy5zdWJzdHJpbmcoMSk7CiAgICB9CgogICAgaWYgKGMuaW5kZXhPZihuYW1lKSA9PT0gMCkgcmV0dXJuIGMuc3Vic3RyaW5nKG5hbWUubGVuZ3RoLCBjLmxlbmd0aCk7CiAgfQoKICByZXR1cm4gIiI7Cn07Cgptb2R1bGUuZXhwb3J0cy5nZXRDb29raWUgPSBmdW5jdGlvbiAoKSB7CiAgdHJ5IHsKICAgIHZhciBiYW5oamlDb29raWUgPSBnZXRDb29raWUoJ2JhbmhqaS10b2tlbicpOwoKICAgIGlmIChiYW5oamlDb29raWUgIT09ICcnKSB7CiAgICAgIHZhciBjb29raWUgPSBqd3QudmVyaWZ5KGJhbmhqaUNvb2tpZSwgcHJvY2Vzcy5lbnYuVlVFX0FQUF9KV1RfU0VTQ1JFVCk7CiAgICAgIC8qIEFwcGx5IHRva2VuIHRvIGdsb2JhbCBheGlvcyBkZWZhdWx0cyAqLwoKICAgICAgdmFyIEFVVEhfVE9LRU4gPSBjb29raWUuYWNjZXNzVG9rZW47IC8vIFJlcXVlc3QgaW50ZXJjZXB0b3IgZm9yIEFQSSBjYWxscwoKICAgICAgYXhpb3MuaW50ZXJjZXB0b3JzLnJlcXVlc3QudXNlKGZ1bmN0aW9uIChjb25maWcpIHsKICAgICAgICAvLyBEbyBzb21ldGhpbmcgYmVmb3JlIHJlcXVlc3QgaXMgc2VudAogICAgICAgIGNvbmZpZy5oZWFkZXJzID0gewogICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiAiQmVhcmVyICIuY29uY2F0KEFVVEhfVE9LRU4pLAogICAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicKICAgICAgICB9OwogICAgICAgIHJldHVybiBjb25maWc7CiAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgIC8vIERvIHNvbWV0aGluZyB3aXRoIHJlcXVlc3QgZXJyb3IKICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpOwogICAgICB9KTsgLy8gUmVzcG9uc2UgaW50ZXJjZXB0b3IgZm9yIEFQSSBjYWxscwoKICAgICAgYXhpb3MuaW50ZXJjZXB0b3JzLnJlc3BvbnNlLnVzZShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICByZXR1cm4gcmVzcG9uc2U7CiAgICAgIH0sIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIF9yZWYgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoZXJyb3IpIHsKICAgICAgICAgIHZhciBvcmlnaW5hbFJlcXVlc3Q7CiAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgIG9yaWdpbmFsUmVxdWVzdCA9IGVycm9yLmNvbmZpZzsKCiAgICAgICAgICAgICAgICAgIGlmICghKGVycm9yLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDAzICYmICFvcmlnaW5hbFJlcXVlc3QuX3JldHJ5KSkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBvcmlnaW5hbFJlcXVlc3QuX3JldHJ5ID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgYXhpb3MuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ0F1dGhvcml6YXRpb24nXSA9ICJCZWFyZXIgIi5jb25jYXQoQVVUSF9UT0tFTik7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGF4aW9zKG9yaWdpbmFsUmVxdWVzdCkpOwoKICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgUHJvbWlzZS5yZWplY3QoZXJyb3IpKTsKCiAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgICAgfSkpOwoKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKF94KSB7CiAgICAgICAgICByZXR1cm4gX3JlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH07CiAgICAgIH0oKSk7IC8vIGF4aW9zLmRlZmF1bHRzLmJhc2VVUkwgPSAnaHR0cHM6Ly9kZXYtYXBpcy5iYW5oamkuY29tJzsKICAgICAgLy8gSW1wb3J0YW50OiBJZiBheGlvcyBpcyB1c2VkIHdpdGggbXVsdGlwbGUgZG9tYWlucywgdGhlIEFVVEhfVE9LRU4gd2lsbCBiZSBzZW50IHRvIGFsbCBvZiB0aGVtLgogICAgICAvLyBTZWUgYmVsb3cgZm9yIGFuIGV4YW1wbGUgdXNpbmcgQ3VzdG9tIGluc3RhbmNlIGRlZmF1bHRzIGluc3RlYWQuCiAgICAgIC8vIGF4aW9zLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydBdXRob3JpemF0aW9uJ10gPSBgQmVhcmVyICR7QVVUSF9UT0tFTn1gOwogICAgICAvLyBheGlvcy5kZWZhdWx0cy5oZWFkZXJzLnBvc3RbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCc7CgogICAgICByZXR1cm4gY29va2llOwogICAgfSBlbHNlIHsKICAgICAgZGF0YVN0b3JlLmlzVmFsaWRVc2VyID0gZmFsc2U7CiAgICAgIHJldHVybiB7CiAgICAgICAgaW5zdGl0dXRlSWQ6ICcnLAogICAgICAgIGNyZWF0b3I6ICcnLAogICAgICAgIHVzZXI6ICcnLAogICAgICAgIG5hbWU6ICcnLAogICAgICAgIGVtYWlsOiAnJywKICAgICAgICBwbGFuOiAnJywKICAgICAgICBhY2Nlc3NUb2tlbjogJycKICAgICAgfTsKICAgIH0KICB9IGNhdGNoIChlcnJvcikgewogICAgd2luZG93LmNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgcmV0dXJuIGZhbHNlOwogICAgLyogRm9yIGF1dGggdmFsaWRhdGlvbiAqLwogIH0KfTs="},{"version":3,"sources":["/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/cookie.js"],"names":["jwt","require","axios","dataStore","getCookie","cname","name","ca","document","cookie","split","i","length","c","charAt","substring","indexOf","module","exports","banhjiCookie","verify","process","env","VUE_APP_JWT_SESCRET","AUTH_TOKEN","accessToken","interceptors","request","use","config","headers","error","Promise","reject","response","originalRequest","status","_retry","defaults","common","isValidUser","instituteId","creator","user","email","plan","window","console"],"mappings":"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","sourcesContent":["'use strict'\n\nconst jwt = require('jsonwebtoken');\nconst axios = require('axios');\nconst {dataStore} = require('./observable/store');\n\nlet getCookie = (cname) => {\n    var name = cname + \"=\";\n    var ca = document.cookie.split(';');\n    for (var i = 0; i < ca.length; i++) {\n        var c = ca[i];\n        while (c.charAt(0) === ' ') c = c.substring(1);\n        if (c.indexOf(name) === 0) return c.substring(name.length, c.length);\n    }\n    return \"\";\n}\n\nmodule.exports.getCookie = () => {\n    try {\n        let banhjiCookie = getCookie('banhji-token');\n        if (banhjiCookie !== '') {\n            const cookie = jwt.verify(banhjiCookie, process.env.VUE_APP_JWT_SESCRET);\n\n            /* Apply token to global axios defaults */\n            const AUTH_TOKEN = cookie.accessToken;\n\n            // Request interceptor for API calls\n            axios.interceptors.request.use(function (config) {\n                // Do something before request is sent\n                config.headers = {\n                    'Authorization': `Bearer ${AUTH_TOKEN}`,\n                    'Accept': 'application/json',\n                    'Content-Type': 'application/json',\n                }\n\n                return config;\n            }, function (error) {\n                // Do something with request error\n                return Promise.reject(error);\n            });\n\n            // Response interceptor for API calls\n            axios.interceptors.response.use((response) => {\n                return response\n            }, async function (error) {\n                const originalRequest = error.config;\n                if (error.response.status === 403 && !originalRequest._retry) {\n                    originalRequest._retry = true;\n                    axios.defaults.headers.common['Authorization'] = `Bearer ${AUTH_TOKEN}`;\n\n                    return axios(originalRequest);\n                }\n\n                return Promise.reject(error);\n            });\n\n            // axios.defaults.baseURL = 'https://dev-apis.banhji.com';\n            // Important: If axios is used with multiple domains, the AUTH_TOKEN will be sent to all of them.\n            // See below for an example using Custom instance defaults instead.\n            // axios.defaults.headers.common['Authorization'] = `Bearer ${AUTH_TOKEN}`;\n            // axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';\n\n            return cookie;\n        } else {\n            dataStore.isValidUser = false\n            return {\n                instituteId: '',\n                creator: '',\n                user: '',\n                name: '',\n                email: '',\n                plan: '',\n                accessToken: '',\n            }\n        }\n    } catch (error) {\n        window.console.error(error);\n        return false; /* For auth validation */\n    }\n}"]}]}