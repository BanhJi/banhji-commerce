{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/babel-loader/lib/index.js!/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/eslint-loader/index.js??ref--13-0!/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/compliance/monthly_tax/new_tax_return/input/add_purchase/_add_purchase.js?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/compliance/monthly_tax/new_tax_return/input/add_purchase/_add_purchase.js","mtime":1638499443165},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9Vc2Vycy9tYWNvcy9EZXNrdG9wL2JhbmhqaS0wLjIvYmFuaGppLWNvbW1lcmNlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICIvVXNlcnMvbWFjb3MvRGVza3RvcC9iYW5oamktMC4yL2JhbmhqaS1jb21tZXJjZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vZGVmaW5lUHJvcGVydHkiOwoKdmFyIF9kZWZhdWx0SXRlbTsKCmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc2VhcmNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmRlc2NyaXB0aW9uLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZy5qcyI7CgovKgogKiBMYXN0IG1vZGlmaWVkIDogMy8zMC8yMSwgOTo1MiBBTSBpbiBQcm9qZWN0IGJhbmhqaS1hY2NvdW50aW5nLXdlYi1tb2R1bGUKICogQ29weXJpZ2h0IChjKSAyMDIxLiBDaGFuZGFyaXRoIENoZWEgdW5kZXIgQ29tcGFueSBCYW5oSmkgRmludGVjaCBDby4sIEx0ZAogKiBGYWNlYm9vayBQcm9maWxlIDogaHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDAxMTE5NDgwNjk0NwogKiBHaXRodWIgUHJvZmlsZSA6IGh0dHBzOi8vZ2l0aHViLmNvbS9EYXJpdGgtTW9rcG9zdAogKiBJbnN0YWdyYW0gUHJvZmlsZSA6IGh0dHBzOi8vd3d3Lmluc3RhZ3JhbS5jb20vY2hhbmRhcml0aF9jaGVhCiAqLwppbXBvcnQgUHVyY2hhc2VSZWNvcmQgZnJvbSAiQC9zY3JpcHRzL2NvbXBsaWFuY2UvbW9kZWwvUHVyY2hhc2VSZWNvcmQiOwppbXBvcnQga2VuZG8gZnJvbSAiQHByb2dyZXNzL2tlbmRvLXVpIjsKaW1wb3J0IHsgRHJvcERvd25MaXN0IH0gZnJvbSAiQHByb2dyZXNzL2tlbmRvLXZ1ZS1kcm9wZG93bnMiOwppbXBvcnQgTW9udGhseVJldHVybiBmcm9tICJAL3NjcmlwdHMvY29tcGxpYW5jZS9tb2RlbC9Nb250aGx5UmV0dXJuIjsKaW1wb3J0IExvYWRpbmdNZSBmcm9tICJAL2NvbXBvbmVudHMvTG9hZGluZyI7CmltcG9ydCB7IHV1aWQgfSBmcm9tICd2dWUtdXVpZCc7CmltcG9ydCBJdGVtTGluZVB1cmNoYXNlIGZyb20gIkAvc2NyaXB0cy9jb21wbGlhbmNlL21vZGVsL2l0ZW1MaW5lUHVyY2hhc2UiOwoKdmFyICQgPSByZXF1aXJlKCJqcXVlcnkiKTsKCnZhciB0ZXh0RmllbGQgPSAnbnVtYmVyTmFtZSc7CnZhciBrZXlGaWVsZCA9ICdpZCc7CnZhciBkZWZhdWx0SXRlbSA9IChfZGVmYXVsdEl0ZW0gPSB7fSwgX2RlZmluZVByb3BlcnR5KF9kZWZhdWx0SXRlbSwgdGV4dEZpZWxkLCAnU2VsZWN0IHN1cHBsaWVyLi4uJyksIF9kZWZpbmVQcm9wZXJ0eShfZGVmYXVsdEl0ZW0sIGtleUZpZWxkLCBudWxsKSwgX2RlZmF1bHRJdGVtKTsKCnZhciBlbXB0eUl0ZW0gPSBfZGVmaW5lUHJvcGVydHkoe30sIHRleHRGaWVsZCwgJ2xvYWRpbmcgLi4uJyk7Cgp2YXIgdGF4U2V0dGluZyA9IHJlcXVpcmUoJ0Avc3RvcmUvdGF4U2V0dGluZycpOwoKdmFyIHRheFNldHRpbmdIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3RheFNldHRpbmdIYW5kbGVyIik7Cgp2YXIgYXBpVXJsID0gcmVxdWlyZSgnQC9hcGlVcmwnKTsKCnZhciBtb250aGx5UmV0dXJuSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9jb21wbGlhbmNlL2hhbmRsZXIvbW9udGhseVJldHVybkhhbmRsZXIiKTsKCnZhciBwdXJjaGFzZUhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvY29tcGxpYW5jZS9oYW5kbGVyL3B1cmNoYXNlSGFuZGxlciIpOwoKdmFyIHN1cHBsaWVySGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9zdXBwbGllckhhbmRsZXIiKTsKCnZhciBwdXJjaGFzZSA9IG5ldyBQdXJjaGFzZVJlY29yZCh7fSk7CnZhciBtb250aGx5UmV0dXJuID0gbmV3IE1vbnRobHlSZXR1cm4oe30pOyAvLyBAdnVlL2NvbXBvbmVudAoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdBZGRfcHVyY2hhc2UnLAogIGNvbXBvbmVudHM6IHsKICAgICdkcm9wZG93bmxpc3QnOiBEcm9wRG93bkxpc3QsCiAgICAnTG9hZGluZ01lJzogTG9hZGluZ01lCiAgfSwKICBtaXhpbnM6IFtdLAogIHByb3BzOiB7fSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZGlhbG9nVGF4OiBmYWxzZSwKICAgICAgc2hvd0xvYWRpbmc6IGZhbHNlLAogICAgICBtZW51SkRhdGVBZGRTYWxlOiBmYWxzZSwKICAgICAgcHVyY2hhc2U6IHB1cmNoYXNlLAogICAgICB0eG5fZGF0ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnN1YnN0cigwLCAxMCksCiAgICAgIGl0ZW1MaW5lczogW10sCiAgICAgIGZpbHRlcjogJycsCiAgICAgIHRleHRGaWVsZDogJ251bWJlck5hbWUnLAogICAgICBkYXRhSXRlbUtleTogJ2lkJywKICAgICAgZGVmYXVsdEl0ZW06IGRlZmF1bHRJdGVtLAogICAgICBzdXBwQmFzZVVybDogc3VwcGxpZXJIYW5kbGVyLnNlYXJjaCgpLAogICAgICBzdXBwbGllckxpc3Q6IFtdLAogICAgICB0b3RhbFZhdDogMCwKICAgICAgYW1vdW50VmF0OiAwLAogICAgICBhbW91bnRJbmNsdXNpdmVWYXQ6IDAsCiAgICAgIGFtb3VudE5ldFZhdDogMCwKICAgICAgbW9udGhseVJldHVybjogbW9udGhseVJldHVybgogICAgfTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICB0eXBlUHJvZHVjdFRheDogZnVuY3Rpb24gdHlwZVByb2R1Y3RUYXgoKSB7CiAgICAgIHJldHVybiB0YXhTZXR0aW5nLmRlZmF1bHQuc3RhdGUubGlzdFRheDsKICAgIH0sCiAgICBpc0Rpc2FibGU6IGZ1bmN0aW9uIGlzRGlzYWJsZSgpIHsKICAgICAgaWYgKHRoaXMubW9udGhseVJldHVybi5oYXNPd25Qcm9wZXJ0eSgnc3RhdHVzJykpIHsKICAgICAgICBpZiAodGhpcy5tb250aGx5UmV0dXJuLnN0YXR1cy5jb2RlID09PSAxKSB7CiAgICAgICAgICBpZiAodGhpcy4kcm91dGUucXVlcnkudHlwZSA9PT0gJ2VkaXQnKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy4kcm91dGUucXVlcnkudHlwZSA9PT0gJ3ZpZXcnKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfSwKICAgIGlkOiBmdW5jdGlvbiBpZCgpIHsKICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5wdXJjaGFzZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuJHJvdXRlLnBhcmFtcy5wdXJjaGFzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gJyc7CiAgICAgIH0KICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICAnaWQnOiAnaW5pdERhdGEnCiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmluaXREYXRhKCk7CgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQ7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmxvYWRMaXN0VGF4KCk7CgogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDY7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmxvYWREYXRhKDAsICcnLCBfdGhpcy5zdXBwQmFzZVVybCk7CgogICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUpOwogICAgfSkpKCk7CiAgfSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkge30sCiAgbWV0aG9kczogewogICAgaW5pdERhdGE6IGZ1bmN0aW9uIGluaXREYXRhKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgIHZhciBpdGVtTGluZXMsIF9sb29wLCBpOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX3RoaXMyLnNob3dMb2FkaW5nID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICBpZiAoIShfdGhpczIuJHJvdXRlLnBhcmFtcy5pZCAhPT0gdW5kZWZpbmVkICYmIF90aGlzMi4kcm91dGUucGFyYW1zLm1vbnRobHlSZXR1cm4gPT09IHVuZGVmaW5lZCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA3OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMyLm9uTG9hZE9uZVJldHVybigpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coX3RoaXMyLiRyb3V0ZS5wYXJhbXMpOwogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxMzsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBpZiAoIShfdGhpczIuJHJvdXRlLnBhcmFtcy5tb250aGx5UmV0dXJuICE9PSB1bmRlZmluZWQpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF90aGlzMi5tb250aGx5UmV0dXJuID0gX3RoaXMyLiRyb3V0ZS5wYXJhbXMubW9udGhseVJldHVybjsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMyLmNsZWFyKCk7CgogICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICBpZiAoIShfdGhpczIuJHJvdXRlLnF1ZXJ5LnBfaWQgIT09IHVuZGVmaW5lZCAmJiBfdGhpczIuJHJvdXRlLnBhcmFtcy5wdXJjaGFzZSA9PT0gdW5kZWZpbmVkKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE4OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE2OwogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMi5vbmxvYWRPbmVQdXJjaGFzZSgpOwoKICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzMjsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgICAgaWYgKCEoX3RoaXMyLiRyb3V0ZS5wYXJhbXMucHVyY2hhc2UgIT09IHVuZGVmaW5lZCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzMDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX3RoaXMyLnB1cmNoYXNlID0gX3RoaXMyLiRyb3V0ZS5wYXJhbXMucHVyY2hhc2U7CiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coX3RoaXMyLnB1cmNoYXNlLCAnbGlzdCB0YXgnKTsKICAgICAgICAgICAgICAgIGl0ZW1MaW5lcyA9IFtdOwoKICAgICAgICAgICAgICAgIF9sb29wID0gZnVuY3Rpb24gX2xvb3AoaSkgewogICAgICAgICAgICAgICAgICBfdGhpczIucHVyY2hhc2UuaXRlbUxpbmVbaV0udGF4TmFtZSA9IF90aGlzMi50eXBlUHJvZHVjdFRheC5maWx0ZXIoZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcC5kZWZhdWx0VGF4ID09PSBfdGhpczIucHVyY2hhc2UuaXRlbUxpbmVbaV0udGF4TmFtZS5uYW1lOwogICAgICAgICAgICAgICAgICB9KVswXTsKICAgICAgICAgICAgICAgICAgaXRlbUxpbmVzLnB1c2gobmV3IEl0ZW1MaW5lUHVyY2hhc2UoX3RoaXMyLnB1cmNoYXNlLml0ZW1MaW5lW2ldKSk7CiAgICAgICAgICAgICAgICAgIF90aGlzMi5hbW91bnRWYXQgKz0gX3RoaXMyLnB1cmNoYXNlLml0ZW1MaW5lW2ldLnZhdCB8fCAwOwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX3RoaXMyLnB1cmNoYXNlLml0ZW1MaW5lLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgIF9sb29wKGkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF90aGlzMi5wdXJjaGFzZS5pdGVtTGluZSA9IGl0ZW1MaW5lczsKICAgICAgICAgICAgICAgIF90aGlzMi5hbW91bnRJbmNsdXNpdmVWYXQgPSBfdGhpczIucHVyY2hhc2UudG90YWxBbW91bnRJbmNsdXNpdmUgfHwgMDsKICAgICAgICAgICAgICAgIF90aGlzMi5hbW91bnROZXRWYXQgPSBfdGhpczIucHVyY2hhc2UudG90YWxBbW91bnROZXRWYXQgfHwgMDsKICAgICAgICAgICAgICAgIF90aGlzMi50b3RhbFZhdCA9IF90aGlzMi5wdXJjaGFzZS50b3RhbFZBVCB8fCAwOwogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzMjsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzMjsKICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczIuY2xlYXJQdXJjaGFzZSgpOwoKICAgICAgICAgICAgICBjYXNlIDMyOgogICAgICAgICAgICAgICAgaWYgKCEoX3RoaXMyLnB1cmNoYXNlLnRvdGFsQW1vdW50TmV0VmF0ICE9PSAwIHx8IF90aGlzMi5wdXJjaGFzZS50b3RhbEFtb3VudEluY2x1c2l2ZSAhPT0gMCB8fCBfdGhpczIucHVyY2hhc2UudG90YWxWQVQgIT09IDApKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzg7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF90aGlzMi5hbW91bnRJbmNsdXNpdmVWYXQgPSBfdGhpczIucHVyY2hhc2UudG90YWxBbW91bnRJbmNsdXNpdmU7CiAgICAgICAgICAgICAgICBfdGhpczIuYW1vdW50TmV0VmF0ID0gX3RoaXMyLnB1cmNoYXNlLnRvdGFsQW1vdW50TmV0VmF0OwogICAgICAgICAgICAgICAgX3RoaXMyLnRvdGFsVmF0ID0gX3RoaXMyLnB1cmNoYXNlLnRvdGFsVkFUOwogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA0MTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDM4OgogICAgICAgICAgICAgICAgaWYgKCEocHVyY2hhc2UuaXRlbUxpbmUubGVuZ3RoID09PSAwKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDQxOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDQxOwogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMi5hZGRSb3coKTsKCiAgICAgICAgICAgICAgY2FzZSA0MToKICAgICAgICAgICAgICAgIF90aGlzMi5zaG93TG9hZGluZyA9IGZhbHNlOyAvLyBpZiAodGhpcy5zYWxlLml0ZW1MaW5lLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgLy8gICAgIGF3YWl0IHRoaXMuYWRkUm93KCkKICAgICAgICAgICAgICAgIC8vIH0KCiAgICAgICAgICAgICAgY2FzZSA0MjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMik7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIGNsZWFyOiBmdW5jdGlvbiBjbGVhcigpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMygpIHsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMy5jbGVhclB1cmNoYXNlKCk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczMuY2xlYXJNb250aGx5UmV0dXJuKCk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMyk7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIGNsZWFyTW9udGhseVJldHVybjogZnVuY3Rpb24gY2xlYXJNb250aGx5UmV0dXJuKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KCkgewogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfdGhpczQubW9udGhseVJldHVybiA9IG5ldyBNb250aGx5UmV0dXJuKHt9KTsKCiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU0KTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgZGlzYWJsZUVkaXRvcjogZnVuY3Rpb24gZGlzYWJsZUVkaXRvcigpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIGNsZWFyUHVyY2hhc2U6IGZ1bmN0aW9uIGNsZWFyUHVyY2hhc2UoKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUoKSB7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF90aGlzNS5wdXJjaGFzZSA9IG5ldyBQdXJjaGFzZVJlY29yZCh7fSk7CiAgICAgICAgICAgICAgICBfdGhpczUuaXRlbUxpbmVzID0gW107CiAgICAgICAgICAgICAgICBfdGhpczUuYW1vdW50TmV0VmF0ID0gMDsKICAgICAgICAgICAgICAgIF90aGlzNS5hbW91bnRJbmNsdXNpdmVWYXQgPSAwOwogICAgICAgICAgICAgICAgX3RoaXM1LnRvdGFsVmF0ID0gMDsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU1KTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgb25sb2FkT25lUHVyY2hhc2U6IGZ1bmN0aW9uIG9ubG9hZE9uZVB1cmNoYXNlKCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU2KCkgewogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNiQoX2NvbnRleHQ2KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCdyZXNvbHZlZCcpOwogICAgICAgICAgICAgICAgICAgIHZhciBpZCA9IF90aGlzNi4kcm91dGUucGFyYW1zLmlkOwogICAgICAgICAgICAgICAgICAgIHB1cmNoYXNlSGFuZGxlci5nZXRPbmUoaWQpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICAgICAgICAgICAgX3RoaXM2LnB1cmNoYXNlID0gcmVzLmRhdGEuZGF0YVswXTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU2KTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgb25Mb2FkT25lUmV0dXJuOiBmdW5jdGlvbiBvbkxvYWRPbmVSZXR1cm4oKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTcoKSB7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU3JChfY29udGV4dDcpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ3LnByZXYgPSBfY29udGV4dDcubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoJ3Jlc29sdmVkJyk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGlkID0gX3RoaXM3LiRyb3V0ZS5wYXJhbXMuaWQ7CiAgICAgICAgICAgICAgICAgICAgbW9udGhseVJldHVybkhhbmRsZXIuZ2V0T25lKGlkKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgICAgICAgICAgIF90aGlzNy5tb250aGx5UmV0dXJuID0gcmVzLmRhdGEuZGF0YVswXTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU3KTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgbG9hZExpc3RUYXg6IGZ1bmN0aW9uIGxvYWRMaXN0VGF4KCkgewogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlOCgpIHsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0OCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDgucHJldiA9IF9jb250ZXh0OC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgncmVzb2x2ZWQnKTsKICAgICAgICAgICAgICAgICAgICB0YXhTZXR0aW5nSGFuZGxlci5nZXQoYXBpVXJsLnRheF9zZXR0aW5nLnRheF9saXN0X2dldCwgImxpc3RUYXgiLCAic2V0TGlzdFRheCIpOwogICAgICAgICAgICAgICAgICB9LCAxMDApOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOCk7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIG9uU3VwcGxpZXJGaWx0ZXJDaGFuZ2VkOiBmdW5jdGlvbiBvblN1cHBsaWVyRmlsdGVyQ2hhbmdlZChldmVudCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU5KCkgewogICAgICAgIHZhciBmaWx0ZXI7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU5JChfY29udGV4dDkpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ5LnByZXYgPSBfY29udGV4dDkubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGZpbHRlciA9IGV2ZW50LmZpbHRlci52YWx1ZTsKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczgubG9hZERhdGEoMCwgZmlsdGVyLCBfdGhpczguc3VwcEJhc2VVcmwpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBfdGhpczguZmlsdGVyID0gZmlsdGVyOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTkpOwogICAgICB9KSkoKTsKICAgIH0sCiAgICBsb2FkRGF0YTogZnVuY3Rpb24gbG9hZERhdGEoc2tpcCwgZmlsdGVyLCBiYXNlVXJsKSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEwKCkgewogICAgICAgIHZhciB1cmw7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMCQoX2NvbnRleHQxMCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDEwLnByZXYgPSBfY29udGV4dDEwLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICB1cmwgPSBiYXNlVXJsICsgIj9maWx0ZXI9Ii5jb25jYXQoZmlsdGVyKTsKICAgICAgICAgICAgICAgIF90aGlzOS5yZXF1ZXN0U3RhcnRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBmZXRjaCh1cmwpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7CiAgICAgICAgICAgICAgICB9KS50aGVuKF90aGlzOS5hZnRlckZldGNoKTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTApOwogICAgICB9KSkoKTsKICAgIH0sCiAgICBhZnRlckZldGNoOiBmdW5jdGlvbiBhZnRlckZldGNoKGpzb24pIHsKICAgICAgdGhpcy5zdXBwbGllckxpc3QgPSBqc29uLmRhdGE7CiAgICB9LAogICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGV2ZW50KSB7CiAgICAgIHZhciB2YWx1ZSA9IGV2ZW50LnZhbHVlOwoKICAgICAgaWYgKHZhbHVlICYmIHZhbHVlW3RleHRGaWVsZF0gPT09IGVtcHR5SXRlbVt0ZXh0RmllbGRdKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLnB1cmNoYXNlLnN1cHBsaWVyID0gdmFsdWU7CiAgICB9LAogICAgY2FsY3VsYXRlVGF4OiBmdW5jdGlvbiBjYWxjdWxhdGVUYXgoKSB7CiAgICAgIHZhciBfdGhpczEwID0gdGhpczsKCiAgICAgIHZhciBkcyA9IHRoaXMuJHJlZnMuZGF0YVNvdXJjZS5rZW5kb1dpZGdldCgpOwogICAgICB2YXIgZGF0YVJvdyA9IGRzLmRhdGEoKSwKICAgICAgICAgIHZhdFRheCA9IDAsCiAgICAgICAgICB0b3RhbFRheCA9IDAsCiAgICAgICAgICB0b3RhbFZhdCA9IDAsCiAgICAgICAgICBhbW91bnROZXQgPSAwLAogICAgICAgICAgdG90YWxOZXQgPSAwLAogICAgICAgICAgYW1vdW50SW5jID0gMDsKICAgICAgdGhpcy5pdGVtTGluZXMgPSBbXTsKICAgICAgZGF0YVJvdy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgYW1vdW50TmV0ID0gMDsKICAgICAgICBhbW91bnRJbmMgPSAwOwoKICAgICAgICBpZiAoaXRlbS50YXhOYW1lKSB7CiAgICAgICAgICB2YXIgYW10ID0gaXRlbS5hbW91bnQ7CiAgICAgICAgICB2YXRUYXggPSBfdGhpczEwLmF1dG9DYWxjdWxhdGVUYXgoaXRlbS50YXhOYW1lLCBhbXQpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGl0ZW0udGF4TmFtZS5iYXNlQW1vdW50LnRvTG93ZXJDYXNlKCkgPT09ICJpbmNsdXNpdmUiKSB7CiAgICAgICAgICBhbW91bnRJbmMgPSBpdGVtLmFtb3VudCAvICgxICsgaXRlbS50YXhOYW1lLnJhdGUgLyAxMDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhbW91bnROZXQgPSBpdGVtLmFtb3VudDsKICAgICAgICB9CgogICAgICAgIF90aGlzMTAuaXRlbUxpbmVzLm1hcChmdW5jdGlvbiAoaSwgaW5kZXgpIHsKICAgICAgICAgIGlmIChpLnVpZCA9PT0gaXRlbS51aWQpIHsKICAgICAgICAgICAgX3RoaXMxMC5pdGVtTGluZXMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgX3RoaXMxMC5pdGVtTGluZXMucHVzaCh7CiAgICAgICAgICB1aWQ6IGl0ZW0udWlkLAogICAgICAgICAgYW1vdW50OiBpdGVtLmFtb3VudCwKICAgICAgICAgIGFtb3VudEluY2x1c2l2ZTogYW1vdW50SW5jLAogICAgICAgICAgYW1vdW50TmV0VmF0OiBhbW91bnROZXQgfHwgMCwKICAgICAgICAgIHZhdDogdmF0VGF4LAogICAgICAgICAgZGVzY3JpcHRpb246IGl0ZW0uZGVzY3JpcHRpb24sCiAgICAgICAgICB0YXhOYW1lOiB7CiAgICAgICAgICAgIG5hbWU6IGl0ZW0udGF4TmFtZS5kZWZhdWx0VGF4LAogICAgICAgICAgICBhY2NvdW50SWQ6IGl0ZW0udGF4TmFtZS5hY2NvdW50LmlkCiAgICAgICAgICB9LAogICAgICAgICAgYmFzZUFtb3VudDogaXRlbS5iYXNlQW1vdW50CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICB0b3RhbFRheCArPSBrZW5kby5wYXJzZUZsb2F0KHZhdFRheCk7CiAgICAgIHRvdGFsVmF0ICs9IGtlbmRvLnBhcnNlRmxvYXQoYW1vdW50SW5jKTsKICAgICAgdG90YWxOZXQgKz0ga2VuZG8ucGFyc2VGbG9hdChhbW91bnROZXQpOwogICAgICB0aGlzLnRvdGFsVmF0ICs9IHRvdGFsVGF4OwogICAgICB0aGlzLmFtb3VudE5ldFZhdCArPSB0b3RhbE5ldDsKICAgICAgdGhpcy5hbW91bnRJbmNsdXNpdmVWYXQgKz0gdG90YWxWYXQ7CiAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLml0ZW1MaW5lcyk7CiAgICB9LAogICAgYXV0b0NhbGN1bGF0ZVRheDogZnVuY3Rpb24gYXV0b0NhbGN1bGF0ZVRheCh0YXgsIGFtb3VudCkgewogICAgICBpZiAodGF4KSB7CiAgICAgICAgdmFyIGZvcm11bGEgPSB0YXguZm9ybXVsYSwKICAgICAgICAgICAgaW5BbXQgPSBrZW5kby5wYXJzZUZsb2F0KGFtb3VudCksCiAgICAgICAgICAgIG5BbXQgPSBrZW5kby5wYXJzZUZsb2F0KGFtb3VudCksCiAgICAgICAgICAgIHRheEJhc2UgPSBrZW5kby5wYXJzZUZsb2F0KHRheC50YXhCYXNlKSAvIDEwMCwKICAgICAgICAgICAgcmF0ZSA9IGtlbmRvLnBhcnNlRmxvYXQodGF4LnJhdGUpIC8gMTAwLAogICAgICAgICAgICB0b3RhbCA9IGV2YWwoZm9ybXVsYSk7CiAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKGluQW10LCBuQW10LCB0YXhCYXNlLCByYXRlLCBmb3JtdWxhLCB0b3RhbCk7CiAgICAgICAgcmV0dXJuIHRvdGFsOwogICAgICB9CiAgICB9LAogICAgY2FsY3VsYXRlVGF4RGVsZXRlOiBmdW5jdGlvbiBjYWxjdWxhdGVUYXhEZWxldGUoZGF0YVJvdykgewogICAgICB2YXIgdmF0VGF4ID0gMDsKCiAgICAgIGlmIChkYXRhUm93LnRheE5hbWUpIHsKICAgICAgICB2YXIgYW10ID0gZGF0YVJvdy5hbW91bnQ7CiAgICAgICAgdmF0VGF4ID0gdGhpcy5hdXRvQ2FsY3VsYXRlVGF4KGRhdGFSb3cudGF4TmFtZSwgYW10KTsKICAgICAgfQoKICAgICAgdGhpcy50b3RhbFZhdCA9IHRoaXMudG90YWxWYXQgLSB2YXRUYXg7CiAgICB9LAogICAgb25EYXRhU291cmNlQ2hhbmdlczogZnVuY3Rpb24gb25EYXRhU291cmNlQ2hhbmdlcyhlKSB7CiAgICAgIGlmIChlLmZpZWxkKSB7CiAgICAgICAgdmFyIGRhdGFSb3cgPSBlLml0ZW1zWzBdOwoKICAgICAgICBzd2l0Y2ggKGUuZmllbGQpIHsKICAgICAgICAgIGNhc2UgInRheE5hbWUiOgogICAgICAgICAgICBkYXRhUm93LnNldCgiYmFzZUFtb3VudCIsIGRhdGFSb3cudGF4TmFtZS5iYXNlQW1vdW50KTsKCiAgICAgICAgICAgIGlmIChkYXRhUm93LmFtb3VudCA+IDApIHsKICAgICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZVRheCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICJhbW91bnQiOgogICAgICAgICAgICBpZiAoZGF0YVJvdy50YXhOYW1lLmhhc093blByb3BlcnR5KCdkZWZhdWx0VGF4JykpIHsKICAgICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZVRheCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBvbkNsb3NlOiBmdW5jdGlvbiBvbkNsb3NlKCkgewogICAgICB0aGlzLnB1cmNoYXNlID0gbmV3IFB1cmNoYXNlUmVjb3JkKHt9KTsKICAgICAgdGhpcy50b3RhbFZhdCA9IDA7CiAgICAgIHRoaXMuYW1vdW50SW5jbHVzaXZlVmF0ID0gMDsKICAgICAgdGhpcy5hbW91bnROZXRWYXQgPSAwOwogICAgICB3aW5kb3cuaGlzdG9yeS5nbygtMSk7IC8vIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgLy8gICAgIG5hbWU6ICdQdXJjaGFzZSBSZWNvcmQnLAogICAgICAvLyAgICAgcGF0aDogJ3B1cmNoYXNlX3JlY29yZCcsCiAgICAgIC8vICAgICBxdWVyeToge3R5cGU6IHRoaXMuJHJvdXRlLnF1ZXJ5LnR5cGV9LAogICAgICAvLyAgICAgcGFyYW1zOiB7aWQ6IHRoaXMubW9udGhseVJldHVybi5pZCwgbW9udGhseVJldHVybjogdGhpcy5tb250aGx5UmV0dXJufQogICAgICAvLyB9KQogICAgfSwKICAgIG51bWJlckZvcm1hdDogZnVuY3Rpb24gbnVtYmVyRm9ybWF0KHZhbHVlKSB7CiAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLnNhbGVGb3JtQ29udGVudC5kZWNpbWFsLCduaW1vbCcpCiAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyh2YWx1ZSwgIm4iLmNvbmNhdCh0aGlzLnB1cmNoYXNlLmRlY2ltYWwpKTsKICAgIH0sCiAgICAvLyBBdXRvIEluY3JlYXNlIG51bWJlcgogICAgcm93TnVtYmVyVG1wbDogZnVuY3Rpb24gcm93TnVtYmVyVG1wbChkYXRhSXRlbSkgewogICAgICB2YXIgZHMgPSB0aGlzLiRyZWZzLmRhdGFTb3VyY2Uua2VuZG9XaWRnZXQoKSwKICAgICAgICAgIGluZGV4ID0gZHMuaW5kZXhPZihkYXRhSXRlbSk7CiAgICAgIHJldHVybiBpbmRleCArIDE7CiAgICB9LAogICAgLy8gUmVtb3ZlIFJvdwogICAgcmVtb3ZlUm93OiBmdW5jdGlvbiByZW1vdmVSb3coZSkgewogICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHZhciBncmlkID0ga2VuZG8ualF1ZXJ5KCIjZ3JpZCIpLmRhdGEoImtlbmRvR3JpZCIpLAogICAgICAgICAgZGF0YVNvdXJjZSA9IGdyaWQuZGF0YVNvdXJjZSwKICAgICAgICAgIGRhdGFJdGVtID0gZ3JpZC5kYXRhSXRlbSgkKGUuY3VycmVudFRhcmdldCkuY2xvc2VzdCgidHIiKSk7CgogICAgICBpZiAoZGF0YVNvdXJjZS50b3RhbCgpID4gMSkgewogICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhkYXRhSXRlbSwgJ2RlbGV0ZScpOwoKICAgICAgICBpZiAoZGF0YUl0ZW0uYW1vdW50ICE9PSAwIHx8IGRhdGFJdGVtLnRheE5hbWUucmF0ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBpZiAoZGF0YUl0ZW0uYmFzZUFtb3VudC50b0xvd2VyQ2FzZSgpID09PSAnbmV0JykgewogICAgICAgICAgICB0aGlzLmFtb3VudE5ldFZhdCA9IHRoaXMuYW1vdW50TmV0VmF0IC0gZGF0YUl0ZW0uYW1vdW50OwogICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZVRheERlbGV0ZShkYXRhSXRlbSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgYW1vdW50ID0gZGF0YUl0ZW0uYW1vdW50IC8gKDEgKyBkYXRhSXRlbS50eXBlUHJvZHVjdFRheC5yYXRlIC8gMTAwKTsKICAgICAgICAgICAgdGhpcy5hbW91bnRJbmNsdXNpdmVWYXQgPSB0aGlzLmFtb3VudEluY2x1c2l2ZVZhdCAtIGFtb3VudDsKICAgICAgICAgICAgdGhpcy5jYWxjdWxhdGVUYXhEZWxldGUoZGF0YUl0ZW0pOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZGF0YVNvdXJjZS5yZW1vdmUoZGF0YUl0ZW0pOwogICAgICB9CiAgICB9LAogICAgdHlwZVByb2R1Y3RUYXhEcm9wZG93bkVkaXRvcjogZnVuY3Rpb24gdHlwZVByb2R1Y3RUYXhEcm9wZG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgLy8gY29uc3QgdHBsID0gdGhpcy50eXBlUHJvZHVjdExpc3QKICAgICAga2VuZG8ualF1ZXJ5KCc8aW5wdXQgcmVxdWlyZWQgbmFtZT0iJyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykuYXBwZW5kVG8oY29udGFpbmVyKS5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgYXV0b0JpbmQ6IGZhbHNlLAogICAgICAgIGF1dG9XaWR0aDogdHJ1ZSwKICAgICAgICBoZWlnaHQ6IDMwMCwKICAgICAgICBkYXRhVGV4dEZpZWxkOiAiZGVmYXVsdFRheCIsCiAgICAgICAgZGF0YVZhbHVlRmllbGQ6ICJpZCIsCiAgICAgICAgb3B0aW9uTGFiZWw6ICItLS0gU2VsZWN0IC0tLSIsCiAgICAgICAgZGF0YVNvdXJjZTogewogICAgICAgICAgZGF0YTogdGhpcy50eXBlUHJvZHVjdFRheC5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIGl0ZW0udHJhbnNhY3Rpb25UeXBlLnRvTG93ZXJDYXNlKCkgPT09ICJwdXJjaGFzZSIgJiYgaXRlbS50YXhUeXBlLnR5cGVJZCA9PT0gMTsKICAgICAgICAgIH0pLAogICAgICAgICAgZ3JvdXA6IHsKICAgICAgICAgICAgZmllbGQ6ICJiYXNlQW1vdW50IgogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgYWRkUm93OiBmdW5jdGlvbiBhZGRSb3coKSB7CiAgICAgIHZhciBfdGhpczExID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMSgpIHsKICAgICAgICB2YXIgZHMsIHRvdGFsOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTEkKF9jb250ZXh0MTEpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMS5wcmV2ID0gX2NvbnRleHQxMS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgZHMgPSBfdGhpczExLiRyZWZzLmRhdGFTb3VyY2Uua2VuZG9XaWRnZXQoKSwgdG90YWwgPSBkcy50b3RhbCgpOwogICAgICAgICAgICAgICAgZHMuaW5zZXJ0KHRvdGFsLCB7CiAgICAgICAgICAgICAgICAgIHR5cGVQcm9kdWN0VGF4OiB7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFRheDogIiIKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgYmFzZUFtb3VudDogIiIsCiAgICAgICAgICAgICAgICAgIGFtb3VudDogMCwKICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICIiCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTEpOwogICAgICB9KSkoKTsKICAgIH0sCiAgICBvblNhdmVDbG9zZTogZnVuY3Rpb24gb25TYXZlQ2xvc2UoKSB7CiAgICAgIHZhciBfdGhpczEyID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMigpIHsKICAgICAgICB2YXIgZGF0YSwgcmVzdWx0OwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTIkKF9jb250ZXh0MTIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMi5wcmV2ID0gX2NvbnRleHQxMi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX3RoaXMxMi5zaG93TG9hZGluZyA9IHRydWU7IC8vIGF3YWl0IHRoaXMuZ2V0RGF0YVNvdXJjZSgpCgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTIucHVyY2hhc2Uuc3VwcGxpZXIudGF4UGF5ZXJUeXBlID09PSAnJykgewogICAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMi5wdXJjaGFzZS5zdXBwbGllci50eXBlLnRvTG93ZXJDYXNlKCkgPT09ICdpbmRpdmlkdWFsLWZvcmVpZ24nKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMxMi5wdXJjaGFzZS5zdXBwbGllci50YXhQYXllclR5cGUgPSAnUGh5c2ljYWwgUGVyc29uJzsKICAgICAgICAgICAgICAgICAgICBfdGhpczEyLnB1cmNoYXNlLnN1cHBsaWVyLm5hdHVyZVRheFR5cGUgPSAnTm9uLVJlc2lkZW50JzsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChfdGhpczEyLnB1cmNoYXNlLnN1cHBsaWVyLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gJ2ZvcmVpZ24gZW50aXR5JykgewogICAgICAgICAgICAgICAgICAgIF90aGlzMTIucHVyY2hhc2Uuc3VwcGxpZXIudGF4UGF5ZXJUeXBlID0gJ0xlZ2FsIFBlcnNvbic7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMxMi5wdXJjaGFzZS5zdXBwbGllci5uYXR1cmVUYXhUeXBlID0gJ05vbi1SZXNpZGVudCc7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxMi5wdXJjaGFzZS5zdXBwbGllci50eXBlLnRvTG93ZXJDYXNlKCkgPT09ICdpbmRpdmlkdWFsLWxvY2FsJykgewogICAgICAgICAgICAgICAgICAgIF90aGlzMTIucHVyY2hhc2Uuc3VwcGxpZXIudGF4UGF5ZXJUeXBlID0gJ1BoeXNpY2FsIFBlcnNvbic7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMxMi5wdXJjaGFzZS5zdXBwbGllci5uYXR1cmVUYXhUeXBlID0gJ1Jlc2lkZW50JzsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChfdGhpczEyLnB1cmNoYXNlLnN1cHBsaWVyLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gJ25vbi10YXhhYmxlIGVudGl0eScpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczEyLnB1cmNoYXNlLnN1cHBsaWVyLnRheFBheWVyVHlwZSA9ICdMZWdhbCBQZXJzb24nOwogICAgICAgICAgICAgICAgICAgIF90aGlzMTIucHVyY2hhc2Uuc3VwcGxpZXIubmF0dXJlVGF4VHlwZSA9ICdSZXNpZGVudCc7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxMi5wdXJjaGFzZS5zdXBwbGllci50eXBlLnRvTG93ZXJDYXNlKCkgPT09ICd0YXhhYmxlIGVudGl0eScpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczEyLnB1cmNoYXNlLnN1cHBsaWVyLnRheFBheWVyVHlwZSA9ICdMZWdhbCBQZXJzb24nOwogICAgICAgICAgICAgICAgICAgIF90aGlzMTIucHVyY2hhc2Uuc3VwcGxpZXIubmF0dXJlVGF4VHlwZSA9ICdSZXNpZGVudCc7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMi5pdGVtTGluZXMubGVuZ3RoIDwgMCB8fCBfdGhpczEyLnB1cmNoYXNlLml0ZW1MaW5lLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKF90aGlzMTIucHVyY2hhc2UuaXRlbUxpbmUsICdpdGVtbGluZSAxMjM0MTI0MTInKTsKICAgICAgICAgICAgICAgICAgX3RoaXMxMi5wdXJjaGFzZS5pdGVtTGluZSA9IF90aGlzMTIucHVyY2hhc2UuaXRlbUxpbmUubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgIHVpZDogaXRlbS51aWQsCiAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IGl0ZW0uYW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgYW1vdW50SW5jbHVzaXZlOiBpdGVtLmFtb3VudEluY2x1c2l2ZSwKICAgICAgICAgICAgICAgICAgICAgIGFtb3VudE5ldFZhdDogaXRlbS5hbW91bnROZXRWYXQsCiAgICAgICAgICAgICAgICAgICAgICBpdGVtOiBpdGVtLml0ZW0sCiAgICAgICAgICAgICAgICAgICAgICB2YXQ6IGl0ZW0udmF0LAogICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGl0ZW0uZGVzY3JpcHRpb24sCiAgICAgICAgICAgICAgICAgICAgICB0YXhOYW1lOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGl0ZW0udGF4TmFtZS5kZWZhdWx0VGF4LAogICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IGl0ZW0udGF4TmFtZS5hY2NvdW50LmlkCiAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgYmFzZUFtb3VudDogaXRlbS5iYXNlQW1vdW50CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgaWQ6IF90aGlzMTIucHVyY2hhc2UuaWQgPyBfdGhpczEyLnB1cmNoYXNlLmlkIDogIm1yLSIuY29uY2F0KHV1aWQudjEoKSksCiAgICAgICAgICAgICAgICAgIHR5cGU6ICdwdXJjaGFzZScsCiAgICAgICAgICAgICAgICAgIGRhdGU6IF90aGlzMTIucHVyY2hhc2UuZGF0ZSwKICAgICAgICAgICAgICAgICAgbW9udGhseVJldHVybklkOiBfdGhpczEyLm1vbnRobHlSZXR1cm4uaWQsCiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnJywKICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlOiBfdGhpczEyLnB1cmNoYXNlLnJlZmVyZW5jZSwKICAgICAgICAgICAgICAgICAgbW9udGhPZjogX3RoaXMxMi5tb250aGx5UmV0dXJuLm1vbnRoT2YsCiAgICAgICAgICAgICAgICAgIHN1cHBsaWVyOiBfdGhpczEyLnB1cmNoYXNlLnN1cHBsaWVyLAogICAgICAgICAgICAgICAgICB0b3RhbFZBVDogX3RoaXMxMi50b3RhbFZhdCwKICAgICAgICAgICAgICAgICAgdG90YWxBbW91bnRJbmNsdXNpdmU6IF90aGlzMTIuYW1vdW50SW5jbHVzaXZlVmF0LAogICAgICAgICAgICAgICAgICB0b3RhbEFtb3VudE5ldFZhdDogX3RoaXMxMi5hbW91bnROZXRWYXQsCiAgICAgICAgICAgICAgICAgIGl0ZW1MaW5lOiBfdGhpczEyLml0ZW1MaW5lcy5sZW5ndGggPiAwID8gX3RoaXMxMi5pdGVtTGluZXMgOiBfdGhpczEyLnB1cmNoYXNlLml0ZW1MaW5lLAogICAgICAgICAgICAgICAgICBpc1NhdmU6IF90aGlzMTIucHVyY2hhc2UuaXNTYXZlIHx8IGZhbHNlLAogICAgICAgICAgICAgICAgICBzdGF0dXM6IF90aGlzMTIuJHJvdXRlLnF1ZXJ5LnR5cGUgPT09ICdFZGl0JyA/IDIgOiAxLAogICAgICAgICAgICAgICAgICBkYXRhU291cmNlOiBfdGhpczEyLiRyb3V0ZS5xdWVyeS50eXBlID09PSAnRWRpdCcgPyBfdGhpczEyLnB1cmNoYXNlLmRhdGFTb3VyY2UgOiB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIk1hbnVhbGx5IiwKICAgICAgICAgICAgICAgICAgICBpZDogMgogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgX3RoaXMxMi5wdXJjaGFzZS5zdXBwbGllci5zdXBwbGllcklkID0gJyc7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBuZXcgUHVyY2hhc2VSZWNvcmQoZGF0YSk7CgogICAgICAgICAgICAgICAgX3RoaXMxMi4kc3RvcmUuZGlzcGF0Y2goJ2NvbXBsaWFuY2UvcHVzaFB1cmNoYXNlJywgcmVzdWx0KTsgLy8gbGV0IHAgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMubW9udGhseVJldHVybi5udW1iZXIrICcmUHVyY2hhc2UnKSkKICAgICAgICAgICAgICAgIC8vIGlmIChwKSB7CiAgICAgICAgICAgICAgICAvLyAgICAgaWYgKHAubGVuZ3RoIDw9IDApIHsKICAgICAgICAgICAgICAgIC8vICAgICAgICAgaWYgKHRoaXMubW9udGhseVJldHVybi5hYmJyICE9PSAnJyAmJiB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICE9PSAnJykgewogICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZQdXJjaGFzZScsIEpTT04uc3RyaW5naWZ5KGRhdGEpKQogICAgICAgICAgICAgICAgLy8gICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vICAgICAgICAgLy8gbG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5tb250aGx5UmV0dXJuLm51bWJlcisgJyZQdXJjaGFzZScsIEpTT04uc3RyaW5naWZ5KFtdKSkKICAgICAgICAgICAgICAgIC8vICAgICAgICAgY29uc3QgYWxsQXJyYXkgPSBbLi4ucCwgLi4uZGF0YV0KICAgICAgICAgICAgICAgIC8vICAgICAgICAgcmVzdWx0cyA9IGFsbEFycmF5LmZpbHRlcigoZSwgaSkgPT4gYWxsQXJyYXkuZmluZEluZGV4KG8gPT4gby50b3RhbEFtb3VudEluY2x1c2l2ZSA9PT0gZS50b3RhbEFtb3VudEluY2x1c2l2ZSAmJiBvLnRvdGFsVkFUID09PSBlLnRvdGFsVkFUICYmIG8udG90YWxBbW91bnROZXRWYXQgPT09IGUudG90YWxBbW91bnROZXRWYXQpID09PSBpKQogICAgICAgICAgICAgICAgLy8gICAgICAgICB3aW5kb3cuY29uc29sZS5sb2cocmVzdWx0cywgJzM0NTY3JykKICAgICAgICAgICAgICAgIC8vICAgICAgICAgaWYgKHRoaXMubW9udGhseVJldHVybi5hYmJyICE9PSAnJyAmJiB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICE9PSAnJykgewogICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZQdXJjaGFzZScsIEpTT04uc3RyaW5naWZ5KHJlc3VsdHMpKQogICAgICAgICAgICAgICAgLy8gICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyAgICAgfQogICAgICAgICAgICAgICAgLy8gfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJlB1cmNoYXNlJywgSlNPTi5zdHJpbmdpZnkoZGF0YSkpCiAgICAgICAgICAgICAgICAvLyB9CgoKICAgICAgICAgICAgICAgIF90aGlzMTIuc2hvd0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICBfdGhpczEyLm9uQ2xvc2UoKTsKCiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coX3RoaXMxMi5pdGVtTGluZXMsIGRhdGEsICdkYXRhJyk7IC8vIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICAvLyAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAvLyAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAvLyAgICAgICAgIHB1cmNoYXNlSGFuZGxlci5jcmVhdGUoZGF0YSkudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlcykKICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgdGhpcy5vbkNsb3NlKCkKICAgICAgICAgICAgICAgIC8vICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5lcnJvcihlKQogICAgICAgICAgICAgICAgLy8gICAgICAgICB9KQogICAgICAgICAgICAgICAgLy8gICAgIH0sIDMwMCk7CiAgICAgICAgICAgICAgICAvLyB9KQoKICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTIpOwogICAgICB9KSkoKTsKICAgIH0KICB9Cn07"},{"version":3,"sources":["/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/compliance/monthly_tax/new_tax_return/input/add_purchase/_add_purchase.js"],"names":["PurchaseRecord","kendo","DropDownList","MonthlyReturn","LoadingMe","uuid","ItemLinePurchase","$","require","textField","keyField","defaultItem","emptyItem","taxSetting","taxSettingHandler","apiUrl","monthlyReturnHandler","purchaseHandler","supplierHandler","purchase","monthlyReturn","name","components","mixins","props","data","dialogTax","showLoading","menuJDateAddSale","txn_date","Date","toISOString","substr","itemLines","filter","dataItemKey","suppBaseUrl","search","supplierList","totalVat","amountVat","amountInclusiveVat","amountNetVat","computed","typeProductTax","default","state","listTax","isDisable","hasOwnProperty","status","code","$route","query","type","id","params","undefined","watch","mounted","initData","loadListTax","loadData","created","methods","onLoadOneReturn","window","console","log","clear","p_id","onloadOnePurchase","i","itemLine","taxName","p","defaultTax","push","vat","length","totalAmountInclusive","totalAmountNetVat","totalVAT","clearPurchase","addRow","clearMonthlyReturn","disableEditor","Promise","resolve","setTimeout","getOne","then","res","get","tax_setting","tax_list_get","onSupplierFilterChanged","event","value","skip","baseUrl","url","requestStarted","fetch","response","json","afterFetch","onChange","supplier","calculateTax","ds","$refs","dataSource","kendoWidget","dataRow","vatTax","totalTax","amountNet","totalNet","amountInc","forEach","item","amt","amount","autoCalculateTax","baseAmount","toLowerCase","rate","map","index","uid","splice","amountInclusive","description","accountId","account","parseFloat","tax","formula","inAmt","nAmt","taxBase","total","eval","calculateTaxDelete","onDataSourceChanges","e","field","items","set","onClose","history","go","numberFormat","toString","decimal","rowNumberTmpl","dataItem","indexOf","removeRow","preventDefault","grid","jQuery","currentTarget","closest","remove","typeProductTaxDropdownEditor","container","options","appendTo","kendoDropDownList","autoBind","autoWidth","height","dataTextField","dataValueField","optionLabel","transactionType","taxType","typeId","group","insert","onSaveClose","taxPayerType","natureTaxType","v1","date","monthlyReturnId","reference","monthOf","isSave","supplierId","result","$store","dispatch"],"mappings":"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","sourcesContent":["/*\n * Last modified : 3/30/21, 9:52 AM in Project banhji-accounting-web-module\n * Copyright (c) 2021. Chandarith Chea under Company BanhJi Fintech Co., Ltd\n * Facebook Profile : https://www.facebook.com/profile.php?id=100011194806947\n * Github Profile : https://github.com/Darith-Mokpost\n * Instagram Profile : https://www.instagram.com/chandarith_chea\n */\nimport PurchaseRecord from \"@/scripts/compliance/model/PurchaseRecord\";\nimport kendo from \"@progress/kendo-ui\";\nimport {DropDownList} from \"@progress/kendo-vue-dropdowns\";\nimport MonthlyReturn from \"@/scripts/compliance/model/MonthlyReturn\";\nimport LoadingMe from \"@/components/Loading\";\nimport {uuid} from 'vue-uuid'\nimport ItemLinePurchase from \"@/scripts/compliance/model/itemLinePurchase\";\n\nconst $ = require(\"jquery\")\nconst textField = 'numberName'\nconst keyField = 'id'\nconst defaultItem = {[textField]: 'Select supplier...', [keyField]: null}\nconst emptyItem = {[textField]: 'loading ...'}\nconst taxSetting = require('@/store/taxSetting');\nconst taxSettingHandler = require(\"@/scripts/taxSettingHandler\")\nconst apiUrl = require('@/apiUrl')\nconst monthlyReturnHandler = require(\"@/scripts/compliance/handler/monthlyReturnHandler\")\nconst purchaseHandler = require(\"@/scripts/compliance/handler/purchaseHandler\")\nconst supplierHandler = require(\"@/scripts/supplierHandler\")\nconst purchase = new PurchaseRecord({})\nconst monthlyReturn = new MonthlyReturn({})\n// @vue/component\nexport default {\n    name: 'Add_purchase',\n\n    components: {\n        'dropdownlist': DropDownList,\n        'LoadingMe': LoadingMe,\n    },\n\n    mixins: [],\n\n    props: {},\n\n    data() {\n        return {\n            dialogTax: false,\n            showLoading: false,\n            menuJDateAddSale: false,\n            purchase: purchase,\n            txn_date: new Date().toISOString().substr(0, 10),\n            itemLines: [],\n            filter: '',\n            textField: 'numberName',\n            dataItemKey: 'id',\n            defaultItem: defaultItem,\n            suppBaseUrl: supplierHandler.search(),\n            supplierList: [],\n\n            totalVat: 0,\n            amountVat: 0,\n            amountInclusiveVat: 0,\n            amountNetVat: 0,\n            monthlyReturn: monthlyReturn,\n        }\n    },\n\n    computed: {\n        typeProductTax() {\n            return taxSetting.default.state.listTax\n        },\n        isDisable() {\n            if (this.monthlyReturn.hasOwnProperty('status')) {\n                if (this.monthlyReturn.status.code === 1) {\n                    if (this.$route.query.type === 'edit') {\n                        return false\n                    } else if (this.$route.query.type === 'view') {\n                        return true\n                    } else {\n                        return true\n                    }\n                } else {\n                    return true\n                }\n            } else {\n                return true\n            }\n        },\n        id() {\n            if (this.$route.params.purchase !== undefined) {\n                return this.$route.params.purchase\n            }else {\n                return ''\n            }\n        }\n    },\n\n    watch: {\n        'id': 'initData'\n    },\n\n    async mounted() {\n        await this.initData()\n        await this.loadListTax()\n        await this.loadData(0, '', this.suppBaseUrl)\n    },\n\n    created() {\n    },\n\n    methods: {\n        async initData() {\n            this.showLoading = true\n            if (this.$route.params.id !== undefined && this.$route.params.monthlyReturn === undefined) {\n                await this.onLoadOneReturn()\n                window.console.log(this.$route.params)\n            } else if (this.$route.params.monthlyReturn !== undefined) {\n                this.monthlyReturn = this.$route.params.monthlyReturn\n            } else {\n                await this.clear()\n            }\n            if (this.$route.query.p_id !== undefined && this.$route.params.purchase === undefined) {\n                await this.onloadOnePurchase()\n            } else if (this.$route.params.purchase !== undefined) {\n                this.purchase = this.$route.params.purchase\n                window.console.log(this.purchase, 'list tax')\n                const itemLines = []\n                for (let i =0; i < this.purchase.itemLine.length; i++) {\n                    this.purchase.itemLine[i].taxName = this.typeProductTax.filter(p => p.defaultTax === this.purchase.itemLine[i].taxName.name)[0]\n                    itemLines.push(new ItemLinePurchase(this.purchase.itemLine[i]))\n                    this.amountVat += this.purchase.itemLine[i].vat || 0\n                }\n                this.purchase.itemLine = itemLines\n                this.amountInclusiveVat = this.purchase.totalAmountInclusive || 0\n                this.amountNetVat = this.purchase.totalAmountNetVat || 0\n                this.totalVat = this.purchase.totalVAT || 0\n            } else {\n                await this.clearPurchase()\n            }\n            if (this.purchase.totalAmountNetVat !== 0 || this.purchase.totalAmountInclusive !== 0 || this.purchase.totalVAT !== 0) {\n                this.amountInclusiveVat = this.purchase.totalAmountInclusive\n                this.amountNetVat = this.purchase.totalAmountNetVat\n                this.totalVat = this.purchase.totalVAT\n            }else {\n                if (purchase.itemLine.length === 0) {\n                    await this.addRow()\n                }\n            }\n            this.showLoading = false\n            // if (this.sale.itemLine.length === 0) {\n            //     await this.addRow()\n            // }\n        },\n        async clear() {\n            await this.clearPurchase()\n            await this.clearMonthlyReturn()\n        },\n        async clearMonthlyReturn() {\n            this.monthlyReturn = new MonthlyReturn({})\n        },\n        disableEditor() {\n            return false;\n        },\n        async clearPurchase() {\n            this.purchase = new PurchaseRecord({})\n            this.itemLines = []\n            this.amountNetVat = 0\n            this.amountInclusiveVat = 0\n            this.totalVat = 0\n        },\n        async onloadOnePurchase() {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved');\n                    const id = this.$route.params.id\n                    purchaseHandler.getOne(id).then(res => {\n                        this.purchase = res.data.data[0]\n                    })\n                })\n            })\n        },\n        async onLoadOneReturn() {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved');\n                    const id = this.$route.params.id\n                    monthlyReturnHandler.getOne(id).then(res => {\n                        this.monthlyReturn = res.data.data[0]\n                    })\n                })\n            })\n        },\n        async loadListTax() {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved');\n                    taxSettingHandler.get(apiUrl.tax_setting.tax_list_get, \"listTax\", \"setListTax\")\n                }, 100)\n            })\n        },\n        async onSupplierFilterChanged(event) {\n            const filter = event.filter.value\n            await this.loadData(0, filter, this.suppBaseUrl)\n            this.filter = filter\n        },\n        async loadData(skip, filter, baseUrl) {\n            const url = baseUrl +\n                `?filter=${filter}`\n            this.requestStarted = true;\n            fetch(url)\n                .then((response) => {\n                    return response.json()\n                })\n                .then(this.afterFetch)\n        },\n        afterFetch(json) {\n            this.supplierList = json.data\n        },\n        onChange(event) {\n            const value = event.value\n            if (value && value[textField] === emptyItem[textField]) {\n                return;\n            }\n            this.purchase.supplier = value\n        },\n        calculateTax() {\n            let ds = this.$refs.dataSource.kendoWidget()\n            let dataRow = ds.data(),\n                vatTax = 0, totalTax = 0, totalVat = 0, amountNet = 0, totalNet = 0, amountInc = 0\n            this.itemLines = []\n            dataRow.forEach(item => {\n                amountNet = 0\n                amountInc = 0\n                if (item.taxName) {\n                    let amt = (item.amount)\n                    vatTax = this.autoCalculateTax(item.taxName, amt)\n                }\n                if (item.taxName.baseAmount.toLowerCase() === \"inclusive\") {\n                    amountInc = item.amount / (1 + (item.taxName.rate / 100))\n                } else {\n                    amountNet = item.amount\n                }\n                this.itemLines.map((i, index) => {\n                    if (i.uid === item.uid) {\n                        this.itemLines.splice(index, 1)\n                    }\n                })\n                this.itemLines.push({\n                    uid: item.uid,\n                    amount: item.amount,\n                    amountInclusive: amountInc,\n                    amountNetVat: amountNet || 0,\n                    vat: vatTax,\n                    description: item.description,\n                    taxName: {name: item.taxName.defaultTax, accountId: item.taxName.account.id},\n                    baseAmount: item.baseAmount\n                })\n            })\n            totalTax += kendo.parseFloat(vatTax)\n            totalVat += kendo.parseFloat(amountInc)\n            totalNet += kendo.parseFloat(amountNet)\n\n            this.totalVat += totalTax\n            this.amountNetVat += totalNet\n            this.amountInclusiveVat += totalVat\n\n            window.console.log(this.itemLines)\n        },\n        autoCalculateTax(tax, amount) {\n            if (tax) {\n                let formula = tax.formula,\n                    inAmt = kendo.parseFloat(amount),\n                    nAmt = kendo.parseFloat(amount),\n                    taxBase = kendo.parseFloat(tax.taxBase) / 100,\n                    rate = kendo.parseFloat(tax.rate) / 100,\n                    total = eval(formula)\n                window.console.log(inAmt, nAmt, taxBase, rate, formula, total)\n                return total\n            }\n        },\n        calculateTaxDelete(dataRow) {\n            let vatTax = 0\n            if (dataRow.taxName) {\n                let amt = dataRow.amount\n                vatTax = this.autoCalculateTax(dataRow.taxName, amt)\n            }\n            this.totalVat = this.totalVat - vatTax\n        },\n        onDataSourceChanges(e) {\n            if (e.field) {\n                let dataRow = e.items[0]\n                switch (e.field) {\n                    case \"taxName\":\n                        dataRow.set(\"baseAmount\", dataRow.taxName.baseAmount)\n                        if (dataRow.amount > 0) {\n                            this.calculateTax()\n                        }\n                        break\n                    case \"amount\":\n                        if (dataRow.taxName.hasOwnProperty('defaultTax')) {\n                            this.calculateTax()\n                        }\n                        break\n                }\n            }\n        },\n        onClose() {\n            this.purchase = new PurchaseRecord({})\n            this.totalVat = 0\n            this.amountInclusiveVat = 0\n            this.amountNetVat = 0\n            window.history.go(-1)\n            // this.$router.push({\n            //     name: 'Purchase Record',\n            //     path: 'purchase_record',\n            //     query: {type: this.$route.query.type},\n            //     params: {id: this.monthlyReturn.id, monthlyReturn: this.monthlyReturn}\n            // })\n        },\n        numberFormat(value) {\n            // window.console.log(this.saleFormContent.decimal,'nimol')\n            return kendo.toString(value, `n${this.purchase.decimal}`)\n        },\n        // Auto Increase number\n        rowNumberTmpl(dataItem) {\n            let ds = this.$refs.dataSource.kendoWidget(),\n                index = ds.indexOf(dataItem);\n            return index + 1;\n        },\n        // Remove Row\n        removeRow(e) {\n            e.preventDefault();\n            let grid = kendo.jQuery(\"#grid\").data(\"kendoGrid\"),\n                dataSource = grid.dataSource,\n                dataItem = grid.dataItem($(e.currentTarget).closest(\"tr\"));\n\n            if (dataSource.total() > 1) {\n                window.console.log(dataItem, 'delete')\n                if (dataItem.amount !== 0 || dataItem.taxName.rate !== undefined) {\n                    if (dataItem.baseAmount.toLowerCase() === 'net') {\n                        this.amountNetVat = this.amountNetVat - dataItem.amount\n                        this.calculateTaxDelete(dataItem)\n                    }else {\n                        let amount = dataItem.amount / (1 + (dataItem.typeProductTax.rate / 100))\n                        this.amountInclusiveVat = this.amountInclusiveVat - amount\n                        this.calculateTaxDelete(dataItem)\n                    }\n                }\n\n                dataSource.remove(dataItem);\n            }\n        },\n        typeProductTaxDropdownEditor(container, options) {\n            // const tpl = this.typeProductList\n            kendo.jQuery('<input required name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: false,\n                    autoWidth: true,\n                    height: 300,\n                    dataTextField: \"defaultTax\",\n                    dataValueField: \"id\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: {\n                        data: this.typeProductTax.filter((item) => item.transactionType.toLowerCase() === \"purchase\" && item.taxType.typeId === 1),\n                        group: {\n                            field: \"baseAmount\"\n                        }\n                    }\n                });\n        },\n        async addRow() {\n            let ds = this.$refs.dataSource.kendoWidget(),\n                total = ds.total();\n            ds.insert(total, {\n                typeProductTax: {defaultTax: \"\"},\n                baseAmount: \"\",\n                amount: 0,\n                description: \"\",\n            });\n        },\n        async onSaveClose() {\n            this.showLoading = true\n            // await this.getDataSource()\n            if (this.purchase.supplier.taxPayerType === '') {\n                if (this.purchase.supplier.type.toLowerCase() === 'individual-foreign') {\n                    this.purchase.supplier.taxPayerType = 'Physical Person'\n                    this.purchase.supplier.natureTaxType = 'Non-Resident'\n                } else if (this.purchase.supplier.type.toLowerCase() === 'foreign entity') {\n                    this.purchase.supplier.taxPayerType = 'Legal Person'\n                    this.purchase.supplier.natureTaxType = 'Non-Resident'\n                } else if (this.purchase.supplier.type.toLowerCase() === 'individual-local') {\n                    this.purchase.supplier.taxPayerType = 'Physical Person'\n                    this.purchase.supplier.natureTaxType = 'Resident'\n                } else if (this.purchase.supplier.type.toLowerCase() === 'non-taxable entity') {\n                    this.purchase.supplier.taxPayerType = 'Legal Person'\n                    this.purchase.supplier.natureTaxType = 'Resident'\n                } else if (this.purchase.supplier.type.toLowerCase() === 'taxable entity') {\n                    this.purchase.supplier.taxPayerType = 'Legal Person'\n                    this.purchase.supplier.natureTaxType = 'Resident'\n                }\n            }\n            if (this.itemLines.length < 0 || this.purchase.itemLine.length > 0) {\n                window.console.log(this.purchase.itemLine, 'itemline 123412412')\n                this.purchase.itemLine = this.purchase.itemLine.map(item => {\n                    return {\n                        uid: item.uid,\n                        amount: item.amount,\n                        amountInclusive: item.amountInclusive,\n                        amountNetVat: item.amountNetVat,\n                        item: item.item,\n                        vat: item.vat,\n                        description: item.description,\n                        taxName: {name: item.taxName.defaultTax, accountId: item.taxName.account.id},\n                        baseAmount: item.baseAmount,\n                    }\n                })\n            }\n            const data = {\n                id: this.purchase.id ? this.purchase.id : `mr-${uuid.v1()}`,\n                type: 'purchase',\n                date: this.purchase.date,\n                monthlyReturnId: this.monthlyReturn.id,\n                description: '',\n                reference: this.purchase.reference,\n                monthOf: this.monthlyReturn.monthOf,\n                supplier: this.purchase.supplier,\n                totalVAT: this.totalVat,\n                totalAmountInclusive: this.amountInclusiveVat,\n                totalAmountNetVat: this.amountNetVat,\n                itemLine: this.itemLines.length > 0 ? this.itemLines : this.purchase.itemLine,\n                isSave: this.purchase.isSave || false,\n                status: this.$route.query.type === 'Edit' ? 2 : 1,\n                dataSource: this.$route.query.type === 'Edit' ? this.purchase.dataSource : {name: \"Manually\", id: 2},\n            }\n            this.purchase.supplier.supplierId = ''\n            const result = new PurchaseRecord(data)\n            this.$store.dispatch('compliance/pushPurchase', result)\n            // let p = JSON.parse(localStorage.getItem(this.monthlyReturn.number+ '&Purchase'))\n            // if (p) {\n            //     if (p.length <= 0) {\n            //         if (this.monthlyReturn.abbr !== '' && this.monthlyReturn.number !== '') {\n            //             localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Purchase', JSON.stringify(data))\n            //         }\n            //     } else {\n            //         // localStorage.setItem(this.monthlyReturn.number+ '&Purchase', JSON.stringify([]))\n            //         const allArray = [...p, ...data]\n            //         results = allArray.filter((e, i) => allArray.findIndex(o => o.totalAmountInclusive === e.totalAmountInclusive && o.totalVAT === e.totalVAT && o.totalAmountNetVat === e.totalAmountNetVat) === i)\n            //         window.console.log(results, '34567')\n            //         if (this.monthlyReturn.abbr !== '' && this.monthlyReturn.number !== '') {\n            //             localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Purchase', JSON.stringify(results))\n            //         }\n            //     }\n            // } else {\n            //     localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Purchase', JSON.stringify(data))\n            // }\n            this.showLoading = false\n            this.onClose()\n            window.console.log(this.itemLines, data, 'data')\n            // new Promise((resolve) => {\n            //     setTimeout(() => {\n            //         resolve(\"resolved\");\n            //         purchaseHandler.create(data).then(res => {\n            //             window.console.log(res)\n            //             this.showLoading = false\n            //             this.onClose()\n            //         }).catch(e => {\n            //             window.console.error(e)\n            //         })\n            //     }, 300);\n            // })\n        },\n    }\n}\n"]}]}