{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/suppliers/CashPayments.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/suppliers/CashPayments.vue","mtime":1642155812719},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7RHJvcERvd25MaXN0fSBmcm9tICJAcHJvZ3Jlc3Mva2VuZG8tdnVlLWRyb3Bkb3ducyI7CmltcG9ydCB7aTE4bn0gZnJvbSAiQC9pMThuIjsKaW1wb3J0IERhdGVQaWNrZXJDb21wb25lbnQgZnJvbSAiQC9jb21wb25lbnRzL2N1c3RvbV90ZW1wbGF0ZXMvRGF0ZVBpY2tlckNvbXBvbmVudCI7CmltcG9ydCBDYXNoUGF5bWVudE1vZGVsIGZyb20gIkAvc2NyaXB0cy9jYXNoLXBheW1lbnQvbW9kZWwvQ2FzaFBheW1lbnQiOwppbXBvcnQgSXRlbUxpbmVNb2RlbCBmcm9tICJAL3NjcmlwdHMvY2FzaC1wYXltZW50L21vZGVsL0l0ZW1MaW5lIjsKaW1wb3J0IGtlbmRvIGZyb20gIkBwcm9ncmVzcy9rZW5kby11aSI7CmltcG9ydCB7Z2V0UHJpbnR9IGZyb20gIkAvZm9ybS9wYXltZW50Vm91Y2hlciI7CmltcG9ydCBQYXltZW50T3B0aW9uRWRpdG9yIGZyb20gIkAvc2NyaXB0cy9rZW5kb19lZGl0b3IvUGF5bWVudE9wdGlvbkVkaXRvciI7CmltcG9ydCBIZWxwZXIgZnJvbSAiQC9oZWxwZXIiOwoKCmNvbnN0IHByZWZpeEhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvcHJlZml4SGFuZGxlciIpOwpjb25zdCBwdXJjaGFzZUZvcm1Db250ZW50SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wdXJjaGFzZUZvcm1Db250ZW50SGFuZGxlciIpOwpjb25zdCBiaWxsaW5nSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9pbnZvaWNlL2hhbmRsZXIvYmlsbGluZ0hhbmRsZXIiKTsKY29uc3Qgc3VwcGxpZXJIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3N1cHBsaWVySGFuZGxlciIpOwoKY29uc3QgJCA9IGtlbmRvLmpRdWVyeQpjb25zdCBjb29raWVKUyA9IHJlcXVpcmUoIkAvY29va2llLmpzIik7CmNvbnN0IGNvb2tpZSA9IGNvb2tpZUpTLmdldENvb2tpZSgpOwpjb25zdCBwYXltZW50T3B0aW9uSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wYXltZW50T3B0aW9uSGFuZGxlciIpOwpjb25zdCBzZXR0aW5nSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9zZXR0aW5nc0hhbmRsZXIiKTsKCmNvbnN0IGNhc2hQYXltZW50TW9kZWwgPSBuZXcgQ2FzaFBheW1lbnRNb2RlbCh7fSk7CmNvbnN0IGl0ZW1MaW5lTW9kZWwgPSBuZXcgSXRlbUxpbmVNb2RlbCh7fSk7Cgpjb25zdCBrZXlGaWVsZCA9ICJpZCI7CmNvbnN0IHRleHRGaWVsZCA9ICJudW1iZXJOYW1lIjsKY29uc3QgZGVmYXVsdEl0ZW0gPSB7W3RleHRGaWVsZF06ICJTZWxlY3QgdmVuZG9yLi4uIiwgW2tleUZpZWxkXTogbnVsbH07CmNvbnN0IGVtcHR5SXRlbSA9IHtbdGV4dEZpZWxkXTogImxvYWRpbmcgLi4uIn07CmNvbnN0IE9QVElPTl9UWVBFID0gIlN1cHBsaWVyIjsKY29uc3Qgc3RyRmlsdGVyID0gIj9vcHRpb25UeXBlPSIgKyBPUFRJT05fVFlQRTsKY29uc3QgVFhOX1RZUEUgPSAiY2FzaCBwYXltZW50IjsKY29uc3QgVFJBTlNBQ1RJT05fVFlQRSA9ICJDYXNoIFBheW1lbnQiOwoKZXhwb3J0IGRlZmF1bHQgewogICAgbmFtZTogIkNhc2hQYXltZW50IiwKICAgIHByb3BzOiBbImlkIl0sCiAgICBjb21wb25lbnRzOiB7CiAgICAgICAgTG9hZGluZ01lOiAoKSA9PiBpbXBvcnQoYEAvY29tcG9uZW50cy9Mb2FkaW5nYCksCiAgICAgICAgImFwcC1kYXRlcGlja2VyIjogRGF0ZVBpY2tlckNvbXBvbmVudCwKICAgICAgICBkcm9wZG93bmxpc3Q6IERyb3BEb3duTGlzdCwKICAgIH0sCiAgICBkYXRhOiAoKSA9PiAoewogICAgICAgIFBheW1lbnRPcHRpb25FZGl0b3I6IFBheW1lbnRPcHRpb25FZGl0b3IsCiAgICAgICAgc2hvd0xvYWRpbmc6IGZhbHNlLAogICAgICAgIGFsZXJ0OiBmYWxzZSwKICAgICAgICBmaWxlczogW10sCiAgICAgICAgZXJyb3JzOiBbXSwKICAgICAgICB2YWxpZDogdHJ1ZSwKICAgICAgICBsb2dnZWRVc2VyOiB7CiAgICAgICAgICAgIGlkOiBjb29raWUuY3JlYXRvciwKICAgICAgICAgICAgbmFtZTogY29va2llLmVtYWlsLAogICAgICAgIH0sCiAgICAgICAgaXRlbUxpbmVzOiBbXSwKICAgICAgICB0ZW1wbGF0ZXM6IFsKICAgICAgICAgICAge3RpdGxlOiAiRHJhZnQifSwKICAgICAgICAgICAge3RpdGxlOiAiT3BlbiJ9LAogICAgICAgICAgICB7dGl0bGU6ICJQYXJ0aWFsbHkgQ2xvc2VkIn0sCiAgICAgICAgICAgIHt0aXRsZTogIkNsb3NlZCJ9LAogICAgICAgIF0sCiAgICAgICAgY29sX2V4cGFuZDogOSwKICAgICAgICBjb2xfaGlkZTogMywKICAgICAgICBpc0hpZGVCYXI6IGZhbHNlLAogICAgICAgIHR5cGVBczogWydDYXNoJywgJ0JhbmsnXSwKICAgICAgICBwYXltZW50T3B0aW9uczogWyJWZW5kb3IiXSwKICAgICAgICBtUGF5bWVudE9wdGlvbjogIlZlbmRvciIsCiAgICAgICAgcGF5bWVudE1ldGhvZDogWyJDYXNoIiwgIkNoZXF1ZSJdLAogICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnN1YnN0cigwLCAxMCksCiAgICAgICAgY2FzaFBheW1lbnQ6IGNhc2hQYXltZW50TW9kZWwsCiAgICAgICAgaXRlbUxpbmU6IGl0ZW1MaW5lTW9kZWwsCiAgICAgICAgcHVyY2hhc2VGb3JtQ29udGVudDoge30sCiAgICAgICAgc2VhcmNoOiAiIiwKICAgICAgICB0cmFuc2FjdGlvblR5cGVzOiBbXSwKICAgICAgICBzdXBwbGllcnM6IFtdLAogICAgICAgIG1TdXBwbGllcjoge30sCiAgICAgICAgZGVmYXVsdEl0ZW06IGRlZmF1bHRJdGVtLAogICAgICAgIHN1cEJhc2VVcmw6IHN1cHBsaWVySGFuZGxlci5zZWFyY2goKSwKICAgICAgICBmaWx0ZXI6ICIiLAogICAgICAgIG5hbWU6ICIiLAogICAgICAgIHJlZmVyZW5jZU5vOiAiIiwKICAgICAgICBvbGRUb3RhbDogMCwKICAgICAgICBkYXRlRm9ybWF0OiBpdGVtTGluZU1vZGVsLmRhdGVGb3JtYXQsCiAgICAgICAgZ3JvdXA6IHtmaWVsZDogInN1cHBsaWVyLm5hbWUifSwKICAgICAgICBiYW5rczogW10sCiAgICAgICAgdHhuTGlzdDogW10sCiAgICAgICAgY3VycmVuY3lDb2RlOiAiIiwKICAgICAgICB0cmFuc2FjdGlvblJhdGU6IDEsCiAgICAgICAgc2NoZW1hRGVmaW5pdGlvbjogewogICAgICAgICAgICBtb2RlbDoge2lkOiAibGluZUlkIn0sCiAgICAgICAgfSwKICAgICAgICBiYXNlQ3VycmVuY3k6IHt9LAogICAgICAgIGJhc2VDdXJyZW5jeUNvZGU6ICIiLAogICAgICAgIGpSYXc6IFtdLAogICAgICAgIGdhaW5Mb3NzQWNjOiB7fSwKICAgICAgICBvdGhlclJldmVudWVBY2M6IHt9LAogICAgICAgIGdhaW5Pckxvc3NEZXNjcmlwdGlvbjogImdhaW4vbG9zcyBvbiBleGNoYW5nZSByYXRlIiwKICAgICAgICBwZW5hbHR5RGVzY3JpcHRpb246ICJwZW5hbHR5IiwKICAgICAgICByZXF1ZXN0UGF5bWVudExpc3Q6IFtdLAogICAgICAgIHNlbGVjdGVkRXhwZW5zZUlkczogW10sCiAgICAgICAgY3I6IDAsCiAgICAgICAgZHI6IDAsCiAgICAgICAgaXNFZGl0OiB0cnVlLAogICAgICAgIGNoZWNrZWQ6IGZhbHNlLAogICAgICAgIGlzVmlldzogZmFsc2UKICAgIH0pLAogICAgbWV0aG9kczogewogICAgICAgIGlzRWRpdGFibGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmlzRWRpdAogICAgICAgIH0sCiAgICAgICAgc2F2ZVByaW50KCkgewogICAgICAgIH0sCiAgICAgICAgY3VycmVuY3koZGF0YUl0ZW0pIHsKICAgICAgICAgICAgaWYgKGRhdGFJdGVtKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaGFzT3duUHJvcGVydHkoImN1cnJlbmN5Q29kZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFJdGVtLmN1cnJlbmN5Q29kZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgfSwKICAgICAgICByZWZlcmVuY2VOb1RtcChkYXRhSXRlbSkgewogICAgICAgICAgICBpZiAoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgICAgIGlmIChkYXRhSXRlbS5oYXNPd25Qcm9wZXJ0eSgicmVmZXJlbmNlTm8iKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhSXRlbS5yZWZlcmVuY2VObzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgfSwKICAgICAgICBiaWxsTnVtYmVyVG1wKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGlmIChkYXRhSXRlbSkgewogICAgICAgICAgICAgICAgaWYgKGRhdGFJdGVtLmhhc093blByb3BlcnR5KCJiaWxsTnVtYmVyIikpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YUl0ZW0uYmlsbE51bWJlcjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgfSwKICAgICAgICBwYWlkQW1vdW50VG1wKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGlmIChkYXRhSXRlbSkgewogICAgICAgICAgICAgICAgaWYgKGRhdGFJdGVtLmhhc093blByb3BlcnR5KCJwYWlkQW1vdW50IikpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcoZGF0YUl0ZW0ucGFpZEFtb3VudCwgZGF0YUl0ZW0uZGVjaW1hbEZvcm1hdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIH0sCiAgICAgICAgYW1vdW50VG9iZVBhaWQoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgaWYgKGRhdGFJdGVtKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaGFzT3duUHJvcGVydHkoImFtb3VudFRvYmVQYWlkIikpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcoCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFJdGVtLmFtb3VudFRvYmVQYWlkLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhSXRlbS5kZWNpbWFsRm9ybWF0CiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgfSwKICAgICAgICBkaXNjb3VudChkYXRhSXRlbSkgewogICAgICAgICAgICBpZiAoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgICAgIGlmIChkYXRhSXRlbS5oYXNPd25Qcm9wZXJ0eSgiZGlzY291bnQiKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyhkYXRhSXRlbS5kaXNjb3VudCwgZGF0YUl0ZW0uZGVjaW1hbEZvcm1hdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIH0sCiAgICAgICAgYW1vdW50KGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGlmIChkYXRhSXRlbSkgewogICAgICAgICAgICAgICAgaWYgKGRhdGFJdGVtLmhhc093blByb3BlcnR5KCJhbW91bnQiKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyhkYXRhSXRlbS5hbW91bnQsIGRhdGFJdGVtLmRlY2ltYWxGb3JtYXQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICB9LAogICAgICAgIGJhbmtSZWZlcmVuY2VObyhkYXRhSXRlbSkgewogICAgICAgICAgICBpZiAoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgICAgIGlmIChkYXRhSXRlbS5oYXNPd25Qcm9wZXJ0eSgib3ZlckR1ZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFJdGVtLmJhbmtSZWZlcmVuY2VObzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgfSwKICAgICAgICBvdmVyRHVlKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGlmIChkYXRhSXRlbSkgewogICAgICAgICAgICAgICAgaWYgKGRhdGFJdGVtLmhhc093blByb3BlcnR5KCJvdmVyRHVlIikpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YUl0ZW0ub3ZlckR1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9LAogICAgICAgIC8vIGFzeW5jIGxvYWRUcmFuc2FjdGlvblJhdGUoY29kZSkgewogICAgICAgIC8vICAgICBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHsKICAgICAgICAvLyAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIC8vICAgICAgICAgICAgIHJlc29sdmUoJ3Jlc29sdmVkJykKICAgICAgICAvLyAgICAgICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUodGhpcy50cmFuc2FjdGlvbkRhdGUpLnRvSVNPU3RyaW5nKCkuc3Vic3RyKDAsIDEwKQogICAgICAgIC8vICAgICAgICAgICAgIC8vIGNvbnN0IHByaWNlTGV2ZWwgPSB0aGlzLmludm9pY2UucHJpY2VMZXZlbAogICAgICAgIC8vICAgICAgICAgICAgIGlmIChjb2RlICE9PSB1bmRlZmluZWQgfHwgY29kZSAhPT0gJycpIHsKICAgICAgICAvLyAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWUKICAgICAgICAvLyAgICAgICAgICAgICAgICAgY3VycmVuY3lIYW5kbGVyLmdldExhc3RFeGNoYW5nZVJhdGVCeURhdGUoZGF0ZSwgY29kZSkudGhlbihyZXMgPT4gewogICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZQogICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4Y2hhbmdlUmF0ZSA9IHJlcy5kYXRhLmRhdGEKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbmN5Q29kZSA9IGV4Y2hhbmdlUmF0ZS5jb2RlCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvblJhdGUgPSBleGNoYW5nZVJhdGUucmF0ZQogICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FzaFJlY2VpcHQudHhuUmF0ZSA9IGV4Y2hhbmdlUmF0ZS5yYXRlCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXNoUmVjZWlwdC5leGNoYW5nZVJhdGUgPSBleGNoYW5nZVJhdGUKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAvLyAgICAgICAgICAgICAgICAgfSkKICAgICAgICAvLyAgICAgICAgICAgICB9CiAgICAgICAgLy8KICAgICAgICAvLyAgICAgICAgIH0sIDEwKQogICAgICAgIC8vICAgICB9KQogICAgICAgIC8vIH0sCiAgICAgICAgYXN5bmMgaW5pdERhdGEoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgY29uc3QgcXVlcnlTdHJpbmcgPSB0aGlzLiRyb3V0ZS5xdWVyeTsKICAgICAgICAgICAgICAgIGxldCB0eXBlID0gIiI7CiAgICAgICAgICAgICAgICBsZXQgb3B0aW9uID0gMDsKICAgICAgICAgICAgICAgIGlmIChxdWVyeVN0cmluZy5oYXNPd25Qcm9wZXJ0eSgidHlwZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IHF1ZXJ5U3RyaW5nLnR5cGU7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9uID0gcXVlcnlTdHJpbmcub3B0aW9uOwogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAicG10IikgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1QYXltZW50T3B0aW9uID0gb3B0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaCA9IHRoaXMuJHJvdXRlLnBhcmFtcy5pZDsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hQdXJjaGFzZU9yZGVyRXhwZW5zZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5sb2FkQ2FzaFBheW1lbnRWaWV3KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLmluaXRSb3coKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcGFpZEFtb3VudEVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBkYXRhLWJpbmQ9InZhbHVlOicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvTnVtZXJpY1RleHRCb3goewogICAgICAgICAgICAgICAgICAgIGRlY2ltYWxzOiAzMCwKICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IGBuJHt0aGlzLnB1cmNoYXNlRm9ybUNvbnRlbnQuZGVjaW1hbH1gLAogICAgICAgICAgICAgICAgICAgIG1pbjogMCwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgZGlzY291bnRFZGl0b3IoY29udGFpbmVyLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAualF1ZXJ5KCc8aW5wdXQgZGF0YS1iaW5kPSJ2YWx1ZTonICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb051bWVyaWNUZXh0Qm94KHsKICAgICAgICAgICAgICAgICAgICBkZWNpbWFsczogMzAsCiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBgbiR7dGhpcy5wdXJjaGFzZUZvcm1Db250ZW50LmRlY2ltYWx9YCwKICAgICAgICAgICAgICAgICAgICBtaW46IDAsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIG9uVHJhbnNhY3Rpb25EYXRlQ2hhbmdlZCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuY2FzaFBheW1lbnQuc3VwcGxpZXIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHN1cHBsaWVyID0gdGhpcy5jYXNoUGF5bWVudC5zdXBwbGllciB8fCB7fTsKICAgICAgICAgICAgICAgIGNvbnN0IHN1cElkID0gc3VwcGxpZXIuaWQgfHwgIiI7CiAgICAgICAgICAgICAgICBpZiAoc3VwSWQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlTnVtYmVyKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hQdXJjaGFzZU9yZGVyRXhwZW5zZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBnZW5lcmF0ZU51bWJlcigpIHsKICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCkgewogICAgICAgICAgICAgICAgY29uc3QgdHJhbkRhdGUgPSBuZXcgRGF0ZSh0aGlzLnRyYW5zYWN0aW9uRGF0ZSk7CiAgICAgICAgICAgICAgICBjb25zdCB0cmFuRGF0ZVJlY2VpcHQgPSBuZXcgRGF0ZSh0aGlzLmNhc2hQYXltZW50LnRyYW5zYWN0aW9uRGF0ZSk7CiAgICAgICAgICAgICAgICBjb25zdCB0cmFuRGF0ZU0gPSB0cmFuRGF0ZS5nZXRGdWxsWWVhcigpICsgdHJhbkRhdGUuZ2V0TW9udGgoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlUmVjZWlwdE0gPQogICAgICAgICAgICAgICAgICAgIHRyYW5EYXRlUmVjZWlwdC5nZXRGdWxsWWVhcigpICsgdHJhbkRhdGVSZWNlaXB0LmdldE1vbnRoKCk7CiAgICAgICAgICAgICAgICBpZiAodHJhbkRhdGVNID09PSB0cmFuRGF0ZVJlY2VpcHRNKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXNoUGF5bWVudC5yZWZlcmVuY2VObyA9IHRoaXMucmVmZXJlbmNlTm87CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygndGhpcy5jYXNoUGF5bWVudC50cmFuc2FjdGlvblR5cGUnLCB0aGlzLmNhc2hQYXltZW50LnRyYW5zYWN0aW9uVHlwZSkKICAgICAgICAgICAgaWYgKHRoaXMuY2FzaFBheW1lbnQudHJhbnNhY3Rpb25EYXRlICE9PSAiIiAmJiB0aGlzLnRyYW5zYWN0aW9uVHlwZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgbGV0IGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgYWJicjogdGhpcy5jYXNoUGF5bWVudC50cmFuc2FjdGlvblR5cGUuYWJiciwKICAgICAgICAgICAgICAgICAgICBzdHJ1Y3R1cmU6IHRoaXMuY2FzaFBheW1lbnQudHJhbnNhY3Rpb25UeXBlLnN0cnVjdHVyZSwKICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbkRhdGU6IHRoaXMuY2FzaFBheW1lbnQudHJhbnNhY3Rpb25EYXRlLAogICAgICAgICAgICAgICAgICAgIHNlcXVjZW5jaW5nOiB0aGlzLmNhc2hQYXltZW50LnRyYW5zYWN0aW9uVHlwZS5zZXF1Y2VuY2luZywKICAgICAgICAgICAgICAgICAgICBwcmVmaXhTZXBhcmF0b3I6IHRoaXMuY2FzaFBheW1lbnQudHJhbnNhY3Rpb25UeXBlLnByZWZpeFNlcGFyYXRvciB8fCAnJywKICAgICAgICAgICAgICAgICAgICBudW1iZXJTZXBhcmF0b3I6IHRoaXMuY2FzaFBheW1lbnQudHJhbnNhY3Rpb25UeXBlLm51bWJlclNlcGFyYXRvciB8fCAnJywKICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IHRoaXMuY2FzaFBheW1lbnQudHJhbnNhY3Rpb25UeXBlLmZvcm1hdCB8fCA1LAogICAgICAgICAgICAgICAgICAgIHR5cGU6IFRSQU5TQUNUSU9OX1RZUEUsCiAgICAgICAgICAgICAgICAgICAgZW50aXR5OiAxLAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGJpbGxpbmdIYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgLmxhc3ROdW1iZXIoZGF0YSkKICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXMgPSByZXNwb25zZS5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXN0TnVtYmVyID0gdGhpcy56ZXJvUGFkKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlSW50KHJlcy5sYXN0TnVtYmVyKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhc2hQYXltZW50LnRyYW5zYWN0aW9uVHlwZS5mb3JtYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBudW1iZXIgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5zdWZmaXggKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FzaFBheW1lbnQudHJhbnNhY3Rpb25UeXBlLm51bWJlclNlcGFyYXRvciArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdE51bWJlcjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FzaFBheW1lbnQubnVtYmVyID0gbnVtYmVyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FzaFBheW1lbnQudHJhbnNhY3Rpb25UeXBlLmhhc093blByb3BlcnR5KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicHJlZml4U2VwYXJhdG9yIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByZWZpeFNlcCA9IHRoaXMuY2FzaFBheW1lbnQudHJhbnNhY3Rpb25UeXBlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5wcmVmaXhTZXBhcmF0b3I7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXNoUGF5bWVudC5yZWZlcmVuY2VObyA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FzaFBheW1lbnQudHJhbnNhY3Rpb25UeXBlLmFiYnIgKyBwcmVmaXhTZXAgKyBudW1iZXI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9ycy5wdXNoKGUpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICB6ZXJvUGFkKG51bSwgcGxhY2VzKSB7CiAgICAgICAgICAgIHJldHVybiBTdHJpbmcobnVtKS5wYWRTdGFydChwbGFjZXMsICIwIik7CiAgICAgICAgfSwKICAgICAgICBhdXRvQ2FsY3VsYXRlKCkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLml0ZW1MaW5lRFMua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIHJlY2VpcHRBbW91bnQgPSAwLAogICAgICAgICAgICAgICAgZGlzY291bnQgPSAwLAogICAgICAgICAgICAgICAgY29udmVydGVkQW1vdW50ID0gMCwKICAgICAgICAgICAgICAgIGV4Y2hhbmdlRGlzY291bnQgPSAwLAogICAgICAgICAgICAgICAgZXhjaGFuZ2VEaXNjb3VudFR4biA9IDAsCiAgICAgICAgICAgICAgICBwYWlkQW1vdW50VHhuID0gMDsKICAgICAgICAgICAgdGhpcy5qUmF3ID0gW107CiAgICAgICAgICAgIGNvbnN0IHJvd3MgPSBkcy5kYXRhKCkuZmlsdGVyKChtKSA9PiBtLnBhaWRBbW91bnQgPiAwIHx8IG0uZGlzY291bnQgPiAwKTsKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCdjYXNoUGF5bWVudCcsIGRzLmRhdGEoKSkKICAgICAgICAgICAgcm93cy5mb3JFYWNoKCh2YWx1ZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKH50aGlzLnNlbGVjdGVkRXhwZW5zZUlkcy5pbmRleE9mKHZhbHVlLmxpbmVJZCkpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgbmF0dXJlID0gIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHB1cmNoYXNlUmF0ZSA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIHBheW1lbnRSYXRlID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgcmF3UGFpZEFtb3VudCA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIHJhd0Rpc2NvdW50QW1vdW50ID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlID0gIiI7CiAgICAgICAgICAgICAgICAgICAgbGV0IGRpc2NvdW50QW1vdW50ID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgYXBBbW91bnQgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICByZWZObyA9ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBwYXlPcHRpb24gPSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3kgPSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgZ2Fpbkxvc3MgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBsYXN0WFJhdGUgPSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24gPSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudCA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0ID0ge30sCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uSWQgPSAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudElkID0gIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3RJZCA9ICIiLAogICAgICAgICAgICAgICAgICAgICAgICB0eG5JZCA9ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBpbnZSYXRlID0gMTsKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUucmVmZXJlbmNlTm8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVmTm8gPSB2YWx1ZS5yZWZlcmVuY2VObzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR4bklkID0gdmFsdWUuaWQgfHwgIiI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS50eG5SYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHB1cmNoYXNlUmF0ZSA9IHBhcnNlRmxvYXQodmFsdWUudHhuUmF0ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5jdXJyZW5jeUNvZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlID0gdmFsdWUuY3VycmVuY3lDb2RlIHx8ICIiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuY3VycmVuY3kpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3kgPSB2YWx1ZS5jdXJyZW5jeSB8fCB7fTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmxvY2F0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uID0gdmFsdWUubG9jYXRpb24gfHwge307CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2NhdGlvbi5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25JZCA9IGxvY2F0aW9uLmlkOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5zZWdtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnQgPSB2YWx1ZS5zZWdtZW50IHx8IHt9OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VnbWVudC5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudElkID0gc2VnbWVudC5pZDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUucHJvamVjdCkgewogICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0ID0gdmFsdWUucHJvamVjdCB8fCB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb2plY3QuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3RJZCA9IHByb2plY3QuaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmV4Y2hhbmdlUmF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBsYXN0WFJhdGUgPSB2YWx1ZS5leGNoYW5nZVJhdGUgfHwge307CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS50eG5SYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGludlJhdGUgPSBwYXJzZUZsb2F0KHZhbHVlLnR4blJhdGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUucmF0ZVRvYmFzZSkgewogICAgICAgICAgICAgICAgICAgICAgICBwYXltZW50UmF0ZSA9IHBhcnNlRmxvYXQodmFsdWUucmF0ZVRvYmFzZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5wYWlkQW1vdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpcHRBbW91bnQgKz0ga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5wYWlkQW1vdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVydGVkQW1vdW50ICs9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnBhaWRBbW91bnQpICogdmFsdWUucmF0ZVRvYmFzZTsKICAgICAgICAgICAgICAgICAgICAgICAgcGFpZEFtb3VudFR4biArPSBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnBhaWRBbW91bnQpICogaW52UmF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGFpZEFtdCA9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucGFpZEFtb3VudCkgKiBwdXJjaGFzZVJhdGUKICAgICAgICAgICAgICAgICAgICAgICAgcmF3UGFpZEFtb3VudCA9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucGFpZEFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5kaXNjb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBkaXNjb3VudCArPSBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmRpc2NvdW50KQogICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudCArPSBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmRpc2NvdW50KSAqIHZhbHVlLnJhdGVUb2Jhc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlRGlzY291bnQgKz0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuZXhjaGFuZ2VEaXNjb3VudCkgKiB2YWx1ZS5yYXRlVG9iYXNlOwogICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZURpc2NvdW50VHhuICs9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuZGlzY291bnQpICogaW52UmF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgZGlzY291bnRBbW91bnQgPSBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmRpc2NvdW50KSAqIHBheW1lbnRSYXRlOwogICAgICAgICAgICAgICAgICAgICAgICByYXdEaXNjb3VudEFtb3VudCA9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuZGlzY291bnQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyB0b2RvOiBnYWluIG9yIGxvc3MgZXhjaGFuZ2UgcmF0ZQogICAgICAgICAgICAgICAgICAgIGdhaW5Mb3NzID0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VGbG9hdCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChwdXJjaGFzZVJhdGUgLSBwYXltZW50UmF0ZSkgKiAocmF3UGFpZEFtb3VudCArIHJhd0Rpc2NvdW50QW1vdW50KQogICAgICAgICAgICAgICAgICAgICAgICApICogLTE7CiAgICAgICAgICAgICAgICAgICAgaWYgKGdhaW5Mb3NzICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnYWluTG9zcyA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdHVyZSA9ICJkciI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAiY3IiOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygiZ2Fpbkxvc3MiLCBnYWluTG9zcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnYWluTG9zcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2Fpbkxvc3NBY2MuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmpSYXcucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nYWluTG9zc0FjYy5pZCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF0dXJlICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUNvZGUgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1cmNoYXNlUmF0ZSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25JZCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdElkICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50SWQgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4bklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eG5JZDogdHhuSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3Q6IHByb2plY3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBsb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudDogc2VnbWVudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdElkOiBwcm9qZWN0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uSWQ6IGxvY2F0aW9uSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnRJZDogc2VnbWVudElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUNvZGU6IGN1cnJlbmN5Q29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k6IGN1cnJlbmN5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0WFJhdGU6IGxhc3RYUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogbmV3IEl0ZW1MaW5lTW9kZWwodmFsdWUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNlaXB0UmF0ZTogZ2Fpbkxvc3MgPiAwID8gcGF5bWVudFJhdGUgOiBwdXJjaGFzZVJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmdhaW5Pckxvc3NEZXNjcmlwdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogdGhpcy5nYWluTG9zc0FjYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudElkOiB0aGlzLmdhaW5Mb3NzQWNjLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OiBnYWluTG9zcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogbmF0dXJlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlQXM6ICJHYWluT3JMb3NzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvL1RvZG86IEFQICBEcgogICAgICAgICAgICAgICAgICAgIGFwQW1vdW50ID0gcmF3UGFpZEFtb3VudCArIHJhd0Rpc2NvdW50QW1vdW50OwogICAgICAgICAgICAgICAgICAgIGlmIChhcEFtb3VudCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmF0dXJlID0gImRyIjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAiY3IiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuaGFzT3duUHJvcGVydHkoImFwQWNjIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXBBY2MgPSB2YWx1ZS5hcEFjYzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFwQWNjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXBBY2MuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmpSYXcucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBBY2MuaWQgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdHVyZSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXJjaGFzZVJhdGUgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uSWQgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3RJZCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudElkICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eG5JZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHhuSWQ6IHR4bklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0OiBwcm9qZWN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogbG9jYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnQ6IHNlZ21lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3RJZDogcHJvamVjdElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbklkOiBsb2NhdGlvbklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50SWQ6IHNlZ21lbnRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlOiBjdXJyZW5jeUNvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiBjdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFhSYXRlOiBsYXN0WFJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IG5ldyBJdGVtTGluZU1vZGVsKHZhbHVlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWlwdFJhdGU6IHB1cmNoYXNlUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHJlZk5vLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiBhcEFjYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudElkOiBhcEFjYy5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBhcEFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQ6IGFwQW1vdW50ICogcHVyY2hhc2VSYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVBczogIkFQIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvL1RvZG86IENhc2ggQWNjb3VudCAgQ1IKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUucGF5bWVudE9wdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICBwYXlPcHRpb24gPSB2YWx1ZS5wYXltZW50T3B0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjYXNoQW1vdW50ID0gcmF3UGFpZEFtb3VudCAqIC0xOyAvLysgKChwdXJjaGFzZVJhdGUgLSBwYXltZW50UmF0ZSkgKiAocmF3UGFpZEFtb3VudCArIHJhd0Rpc2NvdW50QW1vdW50KSkKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc3QgY2FzaEFtb3VudCA9IHJhd1BhaWRBbW91bnQgKyAoZ2Fpbkxvc3MgKSArIHJhd1BhaWRBbW91bnQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhc2hBbW91bnQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAiZHIiOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF0dXJlID0gImNyIjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGF5T3B0aW9uLmhhc093blByb3BlcnR5KCJhY2NvdW50IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBheU9wdGlvbkFjYyA9IHBheU9wdGlvbi5hY2NvdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBheU9wdGlvbkFjYy5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMualJhdy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXlPcHRpb25BY2MuaWQgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdHVyZSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXJjaGFzZVJhdGUgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uSWQgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3RJZCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudElkICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eG5JZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHhuSWQ6IHR4bklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0OiBwcm9qZWN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogbG9jYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnQ6IHNlZ21lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3RJZDogcHJvamVjdElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbklkOiBsb2NhdGlvbklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50SWQ6IHNlZ21lbnRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlOiBjdXJyZW5jeUNvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiBjdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFhSYXRlOiBsYXN0WFJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IG5ldyBJdGVtTGluZU1vZGVsKHZhbHVlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWlwdFJhdGU6IHB1cmNoYXNlUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHJlZk5vLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiBwYXlPcHRpb25BY2MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRJZDogcGF5T3B0aW9uQWNjLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IGNhc2hBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OiBjYXNoQW1vdW50ICogcGF5bWVudFJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZUFzOiAiQ2FzaEFjY291bnQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vVG9kbzogU2V0dGxlbWVudCBEaXNjb3VudCAgQ3IKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUucGF5bWVudFRlcm0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2V0dGxlbWVudERpc2MgPSB2YWx1ZS5wYXltZW50VGVybTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpc2NvdW50QW1vdW50ID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpc2NvdW50QW1vdW50ICogLTEgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF0dXJlID0gImRyIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF0dXJlID0gImNyIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhzZXR0bGVtZW50RGlzYywgInNldHRsZW1lbnREaXNjIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2V0dGxlbWVudERpc2MuaGFzT3duUHJvcGVydHkoImFjY291bnQiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNldHRsZW1lbnREaXNjQWNjID0gc2V0dGxlbWVudERpc2MuYWNjb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2V0dGxlbWVudERpc2NBY2MuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5qUmF3LnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGxlbWVudERpc2NBY2MuaWQgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF0dXJlICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5Q29kZSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXJjaGFzZVJhdGUgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25JZCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0SWQgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudElkICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4bklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHhuSWQ6IHR4bklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdDogcHJvamVjdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBsb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnQ6IHNlZ21lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0SWQ6IHByb2plY3RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uSWQ6IGxvY2F0aW9uSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50SWQ6IHNlZ21lbnRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5Q29kZTogY3VycmVuY3lDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k6IGN1cnJlbmN5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFhSYXRlOiBsYXN0WFJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBuZXcgSXRlbUxpbmVNb2RlbCh2YWx1ZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNlaXB0UmF0ZTogcGF5bWVudFJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogIlB1cmNoYXNlIFBheW1lbnQgRGlzY291bnQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogc2V0dGxlbWVudERpc2NBY2MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IHNldHRsZW1lbnREaXNjQWNjLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiByYXdEaXNjb3VudEFtb3VudCAqIC0xLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQ6IGRpc2NvdW50QW1vdW50ICogLTEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlQXM6ICJTZXR0bGVtZW50IERpc2NvdW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgLy8gdGhpcy5pbnZvaWNlVHhuKHR4bklkcykKCiAgICAgICAgICAgIHRoaXMuY2FzaFBheW1lbnQudG90YWwgPSByZWNlaXB0QW1vdW50OwogICAgICAgICAgICB0aGlzLmNhc2hQYXltZW50LmV4Y2hhbmdlQW1vdW50ID0gY29udmVydGVkQW1vdW50OwogICAgICAgICAgICB0aGlzLmNhc2hQYXltZW50LmRpc2NvdW50ID0gZGlzY291bnQ7CiAgICAgICAgICAgIHRoaXMuY2FzaFBheW1lbnQuZXhjaGFuZ2VEaXNjb3VudCA9IGV4Y2hhbmdlRGlzY291bnQ7CiAgICAgICAgICAgIHRoaXMuY2FzaFBheW1lbnQucGFpZEFtb3VudFR4biA9IHBhaWRBbW91bnRUeG47CiAgICAgICAgICAgIHRoaXMuY2FzaFBheW1lbnQuZXhjaGFuZ2VEaXNjb3VudFR4biA9IGV4Y2hhbmdlRGlzY291bnRUeG47CiAgICAgICAgICAgIHRoaXMuc2hyaW5rRGF0YSh0aGlzLmpSYXcpOwogICAgICAgIH0sCiAgICAgICAgcmVtb3ZlRHVwbGljYXRlKGFycmF5KSB7CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IFtdOwogICAgICAgICAgICBjb25zdCBtYXAgPSBuZXcgTWFwKCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBhcnJheSkgewogICAgICAgICAgICAgICAgaWYgKCFtYXAuaGFzKGl0ZW0uaWQpKSB7CiAgICAgICAgICAgICAgICAgICAgbWFwLnNldChpdGVtLmlkLCB0cnVlKTsgLy8gc2V0IGFueSB2YWx1ZSB0byBNYXAKICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChpdGVtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0sCiAgICAgICAgc2hyaW5rRGF0YShvYmopIHsKICAgICAgICAgICAgY29uc3QgdW5pcXVlcyA9IHRoaXMucmVtb3ZlRHVwbGljYXRlKG9iaik7CiAgICAgICAgICAgIHVuaXF1ZXMuZm9yRWFjaCgobikgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZm91bmQgPSBvYmouZmlsdGVyKChtKSA9PiBtLmlkID09PSBuLmlkKTsKICAgICAgICAgICAgICAgIGxldCBhbW91bnQgPSAwLAogICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50ID0gMDsKICAgICAgICAgICAgICAgIGZvdW5kLmZvckVhY2goKHopID0+IHsKICAgICAgICAgICAgICAgICAgICBhbW91bnQgKz0gcGFyc2VGbG9hdCh6LmFtb3VudCB8fCAwKTsKICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudCArPSBwYXJzZUZsb2F0KHouZXhjaGFuZ2VBbW91bnQgfHwgMCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIG4uZXhjaGFuZ2VBbW91bnQgPSBwYXJzZUZsb2F0KGV4Y2hhbmdlQW1vdW50KTsgLy90aGlzLm51bWJlckZvcm1hdChhbW91bnQpCiAgICAgICAgICAgICAgICBuLmFtb3VudCA9IHBhcnNlRmxvYXQoYW1vdW50KTsgLy9wYXJzZUZsb2F0KHBhcnNlRmxvYXQoYW1vdW50IC8gcGFyc2VGbG9hdChuLnJlY2VpcHRSYXRlKSkpIC8vdGhpcy5udW1iZXJGb3JtYXQoYW1vdW50ICogcGFyc2VGbG9hdCh0aGlzLmludm9pY2UudHhuUmF0ZSkpIC8vLnRvRml4ZWQodGhpcy5zYWxlRm9ybUNvbnRlbnQuZGVjaW1hbCkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMualJhdyA9IHVuaXF1ZXM7CiAgICAgICAgICAgIGxldCBkciA9IDAsCiAgICAgICAgICAgICAgICBjciA9IDA7CiAgICAgICAgICAgIHRoaXMualJhdy5mb3JFYWNoKChqKSA9PiB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKGoudHlwZSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgImNyIjoKICAgICAgICAgICAgICAgICAgICAgICAgY3IgKz0gcGFyc2VGbG9hdChqLmV4Y2hhbmdlQW1vdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZHIiOgogICAgICAgICAgICAgICAgICAgICAgICBkciArPSBwYXJzZUZsb2F0KGouZXhjaGFuZ2VBbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeSh0aGlzLmpSYXcpLCAndW5pcXVlcycpCiAgICAgICAgICAgIGNvbnN0IHR4bklkID0gdGhpcy5qUmF3Lm1hcCgobykgPT4gby50eG5JZCk7CiAgICAgICAgICAgIHZhciB1U2V0ID0gbmV3IFNldCh0eG5JZCk7CiAgICAgICAgICAgIGNvbnN0IHVuaXF1ZVNldCA9IFsuLi51U2V0XTsKICAgICAgICAgICAgbGV0IGpSYXdzID0gW107CiAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeSh1bmlxdWVTZXQpLCAndW5pcXVlcycpCiAgICAgICAgICAgIHVuaXF1ZVNldC5mb3JFYWNoKChuKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBmb3VuZCA9IHRoaXMualJhdy5maWx0ZXIoKG0pID0+IG0udHhuSWQgPT09IG4pOwogICAgICAgICAgICAgICAgY29uc3QgbGluZSA9IGZvdW5kWzBdLmxpbmU7CiAgICAgICAgICAgICAgICBjb25zdCByZWZObyA9IGxpbmUucmVmZXJlbmNlTm87CiAgICAgICAgICAgICAgICBqUmF3cy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICBpZDogbiwKICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUNvZGU6IGZvdW5kWzBdLmN1cnJlbmN5Q29kZSwKICAgICAgICAgICAgICAgICAgICBwcm9qZWN0SWQ6IGZvdW5kWzBdLnByb2plY3RJZCwKICAgICAgICAgICAgICAgICAgICBzZWdtZW50SWQ6IGZvdW5kWzBdLnNlZ21lbnRJZCwKICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbklkOiBmb3VuZFswXS5sb2NhdGlvbklkLAogICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5vOiByZWZObyB8fCAiIiwKICAgICAgICAgICAgICAgICAgICBlbnRyaWVzOiBmb3VuZCwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5qUmF3ID0galJhd3M7CiAgICAgICAgICAgIHRoaXMuZHIgPSBkcjsKICAgICAgICAgICAgdGhpcy5jciA9IGNyOwogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coImRyPSIsIGRyLCAiY3I9IiwgY3IsICJkcitjciA9ICIsIGRyICsgY3IpOwogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoalJhd3MpLCAidW5pcXVlcyIpOwogICAgICAgIH0sCiAgICAgICAgcHVyY2hhc2VUeG4oKSB7CiAgICAgICAgICAgIGxldCB0eG5JZHMgPSBbXSwKICAgICAgICAgICAgICAgIGlkcyA9IFtdOwogICAgICAgICAgICB0aGlzLml0ZW1MaW5lcy5mb3JFYWNoKCh2YWx1ZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKHZhbHVlLmlkKSB7CiAgICAgICAgICAgICAgICAgICAgdHhuSWRzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICBpZDogdmFsdWUuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogMSwKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGlkcyA9IE9iamVjdC52YWx1ZXModHhuSWRzLnJlZHVjZSgociwgbykgPT4gKChyW28uaWRdID0gbyksIHIpLCB7fSkpOwogICAgICAgICAgICBpZHMuZm9yRWFjaCgobSkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgbGluZXMgPSB0aGlzLml0ZW1MaW5lcy5maWx0ZXIoKG4pID0+IG4uaWQgPT09IG0uaWQpOwogICAgICAgICAgICAgICAgbGV0IHBhaWRBbXQgPSAwOwogICAgICAgICAgICAgICAgbGV0IGFtb3VudFRvYmVQYWlkID0gMDsKICAgICAgICAgICAgICAgIGxpbmVzLmZvckVhY2goKHgpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoeC5wYWlkQW1vdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhaWRBbXQgKz0geC5wYWlkQW1vdW50OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoeC5hbW91bnRUb2JlUGFpZCkgewogICAgICAgICAgICAgICAgICAgICAgICBhbW91bnRUb2JlUGFpZCArPSB4LmFtb3VudFRvYmVQYWlkOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgY29uc3QgcEFtdCA9IHRoaXMubnVtYmVyRm9ybWF0KHBhaWRBbXQpOwogICAgICAgICAgICAgICAgY29uc3QgYW10VG9iZVBhaWQgPSB0aGlzLm51bWJlckZvcm1hdChhbW91bnRUb2JlUGFpZCk7CiAgICAgICAgICAgICAgICBpZiAocEFtdCA9PT0gYW10VG9iZVBhaWQpIHsKICAgICAgICAgICAgICAgICAgICBtWyJzdGF0dXMiXSA9IDM7IC8vUGFpZAogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBtWyJzdGF0dXMiXSA9IDI7IC8vIFBhcnRpYWxseSBQYWlkCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLnR4bkxpc3QgPSBpZHM7CiAgICAgICAgfSwKICAgICAgICBpbml0Um93KCkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLml0ZW1MaW5lRFMua2VuZG9XaWRnZXQoKTsKICAgICAgICAgICAgZHMuaW5zZXJ0KFt0aGlzLml0ZW1MaW5lXSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBpbml0R3JpZCh0aGF0KSB7CiAgICAgICAgICAgIGxldCBncmlkID0ga2VuZG8ualF1ZXJ5KCIjZ3JpZENhc2hQYXltZW50IikuZGF0YSgia2VuZG9HcmlkIik7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgICQoIiNoZWFkZXItY2hiIikuY2hhbmdlKGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgY2hlY2tlZCA9IGV2LnRhcmdldC5jaGVja2VkOwogICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLmpRdWVyeSgiLnJvdy1jaGVja2JveCIpLmVhY2goZnVuY3Rpb24gKGlkeCwgaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICEkKGl0ZW0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2xvc2VzdCgidHIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmlzKCIuay1zdGF0ZS1zZWxlY3RlZCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoaXRlbSkuY2xpY2soKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG1Sb3cgPSAkKGl0ZW0pLmNsb3Nlc3QoInRyIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkYXRhSXRlbSA9IGdyaWQuZGF0YUl0ZW0obVJvdyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaChkYXRhSXRlbSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGl0ZW0pLmNsaWNrKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmNoZWNrZWRDaGFuZ2VkKGRhdGEpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIGxldCBjaGVja2VkSWRzID0ge30KICAgICAgICAgICAgbGV0IGRhdGEgPSBbXTsKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gZnVuY3Rpb24gc2VsZWN0Um93KHRoYXQpIHsKICAgICAgICAgICAgLy8gICAgIGxldCBjaGVja2VkID0gdGhpcy5jaGVja2VkLAogICAgICAgICAgICAvLyAgICAgICAgIHJvdyA9ICQodGhpcykuY2xvc2VzdCgidHIiKSwKICAgICAgICAgICAgLy8gICAgICAgICBncmlkID0gJCgnI2l0ZW1MaW5lJykuZGF0YSgna2VuZG9HcmlkJyksCiAgICAgICAgICAgIC8vICAgICAgICAgZGF0YUl0ZW0gPSBncmlkLmRhdGFJdGVtKHJvdykKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gICAgIGNoZWNrZWRJZHNbZGF0YUl0ZW0ucGF5bWVudENvZGVdID0gY2hlY2tlZDsKICAgICAgICAgICAgLy8gICAgIHdpbmRvdy5jb25zb2xlLmxvZygnaGVyZScsZGF0YUl0ZW0pCiAgICAgICAgICAgIC8vICAgICBpZiAoY2hlY2tlZCkgewogICAgICAgICAgICAvLyAgICAgICAgIC8vLXNlbGVjdCB0aGUgcm93CiAgICAgICAgICAgIC8vICAgICAgICAgcm93LmFkZENsYXNzKCJrLXN0YXRlLXNlbGVjdGVkIikKICAgICAgICAgICAgLy8gICAgICAgICBkYXRhLnB1c2goZGF0YUl0ZW0pCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vICAgICAgICAgdGhhdC5jaGVja2VkQ2hhbmdlZChkYXRhSXRlbSkKICAgICAgICAgICAgLy8gICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vICAgICAgICAgLy8tcmVtb3ZlIHNlbGVjdGlvbgogICAgICAgICAgICAvLyAgICAgICAgIHJvdy5yZW1vdmVDbGFzcygiay1zdGF0ZS1zZWxlY3RlZCIpCiAgICAgICAgICAgIC8vICAgICB9CiAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgLy8gaWYgKGdyaWQpIHsKICAgICAgICAgICAgLy8gICAgIGdyaWQudGFibGUub24oImNsaWNrIiwgIi5yb3ctY2hlY2tib3giLCBzZWxlY3RSb3codGhhdCkpCiAgICAgICAgICAgIC8vIH0KICAgICAgICB9LAogICAgICAgIGNoZWNrZWRDaGFuZ2VkKGRhdGEpIHsKICAgICAgICAgICAgZGF0YS5mb3JFYWNoKChtKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAocGFyc2VGbG9hdChtLnBhaWRBbW91bnQpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgbS5wYWlkQW1vdW50ID0gbS5hbW91bnRUb2JlUGFpZDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5pdGVtTGluZXMuZmluZEluZGV4KChpdGVtKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgbS5wYXltZW50Q29kZSA9PT0gaXRlbS5wYXltZW50Q29kZSAmJgogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUZsb2F0KGl0ZW0ucGFpZEFtb3VudCkgPT09IDAKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB0aGlzLml0ZW1MaW5lcy5zcGxpY2UoaW5kZXgsIDEsIG0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlKCk7CiAgICAgICAgfSwKICAgICAgICBoZWFkZXJUZW1wbGF0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIGA8aW5wdXQgdHlwZT0nY2hlY2tib3gnIGlkPSdoZWFkZXItY2hiJyBjbGFzcz0nay1jaGVja2JveCBoZWFkZXItY2hlY2tib3gnPmA7CiAgICAgICAgfSwKICAgICAgICBjaGVja1RlbXBsYXRlKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIHJldHVybiBgPGlucHV0IHR5cGU9J2NoZWNrYm94JyAjPSAke2RhdGFJdGVtLmNoZWNrfSA/IFxcJ2NoZWNrZWQ9ImNoZWNrZWQiXFwnIDogJycgIyBjbGFzcz0nay1jaGVja2JveCByb3ctY2hlY2tib3gnIC8+YDsKICAgICAgICB9LAogICAgICAgIGZvcm1hdERhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgaWYgKGRhdGFJdGVtLmhhc093blByb3BlcnR5KCJkdWVEYXRlIikpIHsKICAgICAgICAgICAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyhuZXcgRGF0ZShkYXRhSXRlbS5kdWVEYXRlKSwgdGhpcy5kYXRlRm9ybWF0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgfSwKICAgICAgICBzZXR0bGVtZW50RGlzY291bnQoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgaWYgKGRhdGFJdGVtLmhhc093blByb3BlcnR5KCJwYXltZW50VGVybSIpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YUl0ZW0ucGF5bWVudFRlcm0ubmFtZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgfSwKICAgICAgICBzdGF0dXMoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgaWYgKGRhdGFJdGVtKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaGFzT3duUHJvcGVydHkoInN0YXR1cyIpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhdHVzID0gZGF0YUl0ZW0uc3RhdHVzOwogICAgICAgICAgICAgICAgICAgIGxldCBzdGF0dXNUZXh0ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChzdGF0dXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dCA9ICJPUEVOIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0ID0gIlBhcnRpYWxseSBQYWlkIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0ID0gIlZPSUQiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c1RleHQgPSAiUEFJRCI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0YXR1c1RleHQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIH0sCiAgICAgICAgb25DdXN0b21lckNoYW5nZWQoZXZlbnQpIHsKICAgICAgICAgICAgdGhpcy5pc0VkaXQgPSB0cnVlCiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZXZlbnQudmFsdWU7CiAgICAgICAgICAgIGlmICh2YWx1ZSAmJiB2YWx1ZVt0ZXh0RmllbGRdID09PSBlbXB0eUl0ZW1bdGV4dEZpZWxkXSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMubVN1cHBsaWVyID0gdmFsdWU7CiAgICAgICAgICAgIHRoaXMuY2FzaFBheW1lbnQuc3VwcGxpZXIgPSB2YWx1ZTsKICAgICAgICAgICAgdGhpcy5sb2FkUmVxdWVzdFBheW1lbnQoKTsKICAgICAgICB9LAogICAgICAgIG9uQ3VzdG9tZXJGaWx0ZXJDaGFuZ2VkKGV2ZW50KSB7CiAgICAgICAgICAgIGNvbnN0IGZpbHRlciA9IGV2ZW50LmZpbHRlci52YWx1ZTsKICAgICAgICAgICAgdGhpcy5sb2FkRGF0YSgwLCBmaWx0ZXIsIHRoaXMuc3VwQmFzZVVybCk7CiAgICAgICAgICAgIHRoaXMuZmlsdGVyID0gZmlsdGVyOwogICAgICAgIH0sCiAgICAgICAgbG9hZERhdGEoc2tpcCwgZmlsdGVyLCBiYXNlVXJsKSB7CiAgICAgICAgICAgIGNvbnN0IHVybCA9IGJhc2VVcmwgKyBgP2ZpbHRlcj0ke2ZpbHRlcn1gOwogICAgICAgICAgICB0aGlzLnJlcXVlc3RTdGFydGVkID0gdHJ1ZTsKICAgICAgICAgICAgZmV0Y2godXJsKQogICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAudGhlbih0aGlzLmFmdGVyRmV0Y2gpOwogICAgICAgIH0sCiAgICAgICAgYWZ0ZXJGZXRjaChqc29uKSB7CiAgICAgICAgICAgIHRoaXMuc3VwcGxpZXJzID0ganNvbi5kYXRhOwogICAgICAgIH0sCiAgICAgICAgbnVtYmVyRm9ybWF0KHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyh2YWx1ZSwgYG4ke3RoaXMucHVyY2hhc2VGb3JtQ29udGVudC5kZWNpbWFsfWApOwogICAgICAgIH0sCiAgICAgICAgcm93TnVtYmVyVG1wbChkYXRhSXRlbSkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLml0ZW1MaW5lRFMua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIGluZGV4ID0gZHMuaW5kZXhPZihkYXRhSXRlbSk7CiAgICAgICAgICAgIHJldHVybiBpbmRleCArIDE7CiAgICAgICAgfSwKICAgICAgICBkYXRhU291cmNlQ2hhbmdlZChlKSB7CiAgICAgICAgICAgIGxldCBhbXRUb2JlUGFpZCA9IDAsIGFtb3VudCA9IDAsIGRpc2NvdW50ID0gMCwKICAgICAgICAgICAgICAgIHBhaWRBbW91bnQgPSAwOwogICAgICAgICAgICBsZXQgZGF0YVJvdyA9IGUuaXRlbXNbMF0gfHwge30KICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKGRhdGFSb3cpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCdvcHRpb25UeXBlJywgT1BUSU9OX1RZUEUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGUuZmllbGQpIHsKICAgICAgICAgICAgICAgIGxldCBkYXRhUm93ID0gZS5pdGVtc1swXTsKICAgICAgICAgICAgICAgIHN3aXRjaCAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgImRpc2NvdW50IjoKICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50ID0gZGF0YVJvdy5hbW91bnQgfHwgMAogICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudCA9IGRhdGFSb3cuZGlzY291bnQgfHwgMAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGlzY291bnQgPiBhbW91bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJkaXNjb3VudCIsIGFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImFtb3VudFRvYmVQYWlkIiwgcGFyc2VGbG9hdChkYXRhUm93LmFtb3VudCkgLSBwYXJzZUZsb2F0KGRhdGFSb3cuZGlzY291bnQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImV4Y2hhbmdlRGlzY291bnQiLCBwYXJzZUZsb2F0KGRhdGFSb3cuZGlzY291bnQpICogcGFyc2VGbG9hdChkYXRhUm93LnJhdGVUb2Jhc2UpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImV4Y2hhbmdlRGlzY291bnRUeG4iLCBwYXJzZUZsb2F0KGRhdGFSb3cuZGlzY291bnQpICogcGFyc2VGbG9hdChkYXRhUm93LnR4blJhdGUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYW10VG9iZVBhaWQgPSBwYXJzZUZsb2F0KGRhdGFSb3cuYW1vdW50VG9iZVBhaWQgfHwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhaWRBbW91bnQgPSBwYXJzZUZsb2F0KGRhdGFSb3cucGFpZEFtb3VudCB8fCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhaWRBbW91bnQgPiBhbXRUb2JlUGFpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFpZEFtb3VudCA9IGFtdFRvYmVQYWlkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoInBhaWRBbW91bnQiLCBwYXJzZUZsb2F0KHBhaWRBbW91bnQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJwYWlkQW1vdW50VG9iYXNlIiwgcGFyc2VGbG9hdChwYWlkQW1vdW50KSAqIHBhcnNlRmxvYXQoZGF0YVJvdy5yYXRlVG9iYXNlIHx8IDEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJwYWlkQW1vdW50VHhuIiwgcGFpZEFtb3VudCAqIHBhcnNlRmxvYXQoZGF0YVJvdy50eG5SYXRlIHx8IDEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJwYWlkQW1vdW50IjoKICAgICAgICAgICAgICAgICAgICAgICAgYW10VG9iZVBhaWQgPSBwYXJzZUZsb2F0KGRhdGFSb3cuYW1vdW50VG9iZVBhaWQpOwogICAgICAgICAgICAgICAgICAgICAgICBwYWlkQW1vdW50ID0gcGFyc2VGbG9hdChkYXRhUm93LnBhaWRBbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFpZEFtb3VudCA+IGFtdFRvYmVQYWlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWlkQW1vdW50ID0gYW10VG9iZVBhaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoInBhaWRBbW91bnQiLCBwYXJzZUZsb2F0KHBhaWRBbW91bnQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoInBhaWRBbW91bnRUb2Jhc2UiLCBwYXJzZUZsb2F0KHBhaWRBbW91bnQpICogcGFyc2VGbG9hdChkYXRhUm93LnJhdGVUb2Jhc2UpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoInBhaWRBbW91bnRUeG4iLCBwYWlkQW1vdW50ICogcGFyc2VGbG9hdChkYXRhUm93LnR4blJhdGUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZVR4bigpOwogICAgICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIG9uVHlwZUNoYW5nZWQoKSB7CiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQsICdwcCcpCiAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09IG51bGwgfHwgdGhpcy4kcm91dGUucGFyYW1zLmlkID09PSAiIiB8fCB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZU51bWJlcigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIHRoaXMudGVtcGxhdGVIYW5kbGUoKTsKICAgICAgICB9LAogICAgICAgIGNhbmNlbCgpIHsKICAgICAgICAgICAgdGhpcy4kc3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogaTE4bi50KCJtc2dfdGl0bGVfd2FybmluZyIpLAogICAgICAgICAgICAgICAgdGV4dDogaTE4bi50KCJtc2dfZGlzY2FyZCIpLAogICAgICAgICAgICAgICAgaWNvbjogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IGkxOG4udCgiY2FuY2VsIiksCiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjNGQ0ODQ4IiwKICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI0VEMUEzQSIsCiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogaTE4bi50KCJkaXNjYXJkIiksCiAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdENlbikgPT4gewogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlc3VsdENlbik7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0Q2VuLnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLmdvKC0xKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBQTVRUZW1wbGF0ZShkYXRhSXRlbSkgewogICAgICAgICAgICBjb25zdCBwbXQgPSBkYXRhSXRlbS5wYXltZW50T3B0aW9uIHx8IHt9OwogICAgICAgICAgICBpZiAocG10KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYDxzcGFuPiR7cG10LmJhbmtBY2NvdW50TmFtZSB8fCBgYH08L3NwYW4+YDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBgYDsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFBheW1lbnRPcHRpb24oKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMucGF5bWVudE1ldGhvZCA9IFtdOwogICAgICAgICAgICAgICAgICAgIHBheW1lbnRPcHRpb25IYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgIC5saXN0KHN0ckZpbHRlcikKICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBheW1lbnRNZXRob2QgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKTsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgUGF5bWVudE1ldGhvZERyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IG5hbWU9IicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgICAgICAgICAgICBhdXRvQmluZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogIm5hbWUiLAogICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZUZpZWxkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAiPHNwYW4+Iz1uYW1lIzwvc3Bhbj4iLAogICAgICAgICAgICAgICAgICAgIG9wdGlvbkxhYmVsOiAiLS1TZWxlY3QtLSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZTogbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHRoaXMucGF5bWVudE1ldGhvZCwKICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgaGlkZVNtYWxsU2lkZWJhcigpIHsKICAgICAgICAgICAgdGhpcy5pc0hpZGVCYXIgPSAhdGhpcy5pc0hpZGVCYXI7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkUHJlZml4KCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBwcmVmaXhIYW5kbGVyLmdldChUWE5fVFlQRSkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb25UeXBlcyA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50cmFuc2FjdGlvblR5cGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhc2hQYXltZW50LnRyYW5zYWN0aW9uVHlwZSA9IHRoaXMudHJhbnNhY3Rpb25UeXBlc1swXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuJHJvdXRlLnBhcmFtcy5pZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlTnVtYmVyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFNhbGVGb3JtQ29udGVudCgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgcHVyY2hhc2VGb3JtQ29udGVudEhhbmRsZXIubGlzdCgpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlRm9ybUNvbnRlbnQgPSBkYXRhWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgc2VhcmNoUHVyY2hhc2VPcmRlckV4cGVuc2UoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tlZCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0VkaXQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgbGV0IGRhdGEgPSB7fTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNhc2hQYXltZW50LnJlcXVlc3RQYXltZW50ID0ge30KICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tUGF5bWVudE9wdGlvbiA9PT0gIlZlbmRvciIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaDogdGhpcy5tU3VwcGxpZXIuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiVmVuZG9yIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogdGhpcy5jYXNoUGF5bWVudC50cmFuc2FjdGlvbkRhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbUxpbmVzID0gW107CiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc2VhcmNoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnNlYXJjaC5sZW5ndGggPiA0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtTGluZXMgPSBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FzaFBheW1lbnQuaXRlbUxpbmUgPSBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpbGxpbmdIYW5kbGVyLnNlYXJjaENhc2hQYXltZW50KGRhdGEpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHJlcy5kYXRhLnJlc3VsdDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtTGluZXMgPSByZXNwb25zZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhc2hQYXltZW50Lml0ZW1MaW5lID0gcmVzcG9uc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLiRyZWZzLmxpbmVEUy5rZW5kb1dpZGdldCgpLnNldERhdGFTb3VyY2UodGhpcy5pdGVtTGluZXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2JqID0gcmVzcG9uc2VbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5hdXRvQ2FsY3VsYXRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5kYXRhU291cmNlQ2hhbmdlZCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eSgic3VwcGxpZXIiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhc2hQYXltZW50LnN1cHBsaWVyID0gb2JqLnN1cHBsaWVyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnN1cHBsaWVyLmhhc093blByb3BlcnR5KCJuYW1lIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubmFtZSA9IG9iai5zdXBwbGllci5uYW1lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFzZUN1cnJlbmN5ID0gcmVzdWx0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5iYXNlQ3VycmVuY3kgPSBiYXNlQ3VycmVuY3k7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhc2hQYXltZW50LmN1cnJlbmN5ID0gYmFzZUN1cnJlbmN5OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJhc2VDdXJyZW5jeSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiYXNlQ3VycmVuY3kuaGFzT3duUHJvcGVydHkoImNvZGUiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJhc2VDdXJyZW5jeUNvZGUgPSBiYXNlQ3VycmVuY3kuY29kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgKGNvZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIHRoaXMubG9hZFRyYW5zYWN0aW9uUmF0ZShiYXNlQ3VycmVuY3kuY29kZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgb25TYXZlQ2xvc2UoaXNQcmludCkgewogICAgICAgICAgICBpZiAoIXRoaXMuJHJlZnMuZm9ybS52YWxpZGF0ZSgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRyZWZzLmZvcm0udmFsaWRhdGUoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBsZXQgaXRlbUxpbmVEUyA9IHRoaXMuJHJlZnMuaXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICAgICAgICAgIGxldCBkYXRhVmFsaWRhdGUgPSAwOwogICAgICAgICAgICAgICAgICAgIGxldCBpdGVtTGluZXMgPSBbXQogICAgICAgICAgICAgICAgICAgIGl0ZW1MaW5lRFMKICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGEoKQogICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChuKSA9PiBuLnBhaWRBbW91bnQgPiAwIHx8IG4uZGlzY291bnQgPiAwKQogICAgICAgICAgICAgICAgICAgICAgICAubWFwKChuKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAofnRoaXMuc2VsZWN0ZWRFeHBlbnNlSWRzLmluZGV4T2Yobi5saW5lSWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgblsnaWQnXSA9IG5bJ3R4bklkXyddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbUxpbmVzLnB1c2gobmV3IEl0ZW1MaW5lTW9kZWwobikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByZXR1cm4gbmV3IEl0ZW1MaW5lTW9kZWwobik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbUxpbmVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLyp0b2RvOiBjaGVjayBwYXltZW50IG9wdGlvbiAqLwogICAgICAgICAgICAgICAgICAgICAgICBpdGVtTGluZXMuZm9yRWFjaCgodmFsdWUsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXltZW50T3B0aW9uID0gdmFsdWUucGF5bWVudE9wdGlvbiB8fCB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBheW1lbnRPcHRpb25JZCA9IHBheW1lbnRPcHRpb24uaWQgfHwgIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGF5bWVudE9wdGlvbklkID09PSAiIiB8fCBwYXltZW50T3B0aW9uSWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJQbGVhc2Ugc2VsZWN0IHBheW1lbnQgb3B0aW9uIGF0IHJvdyAiICsgKGluZGV4ICsgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVmFsaWRhdGUgKz0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1MaW5lcy5sZW5ndGggPT09IGRhdGFWYWxpZGF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGlzQXV0b0dlbmVyYXRlID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlID0gbmV3IERhdGUodGhpcy50cmFuc2FjdGlvbkRhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlUmVjZWlwdCA9IG5ldyBEYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhc2hQYXltZW50LnRyYW5zYWN0aW9uRGF0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJhbkRhdGVNID0gdHJhbkRhdGUuZ2V0RnVsbFllYXIoKSArIHRyYW5EYXRlLmdldE1vbnRoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJhbkRhdGVSZWNlaXB0TSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5EYXRlUmVjZWlwdC5nZXRGdWxsWWVhcigpICsgdHJhbkRhdGVSZWNlaXB0LmdldE1vbnRoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyYW5EYXRlTSA9PT0gdHJhbkRhdGVSZWNlaXB0TSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0F1dG9HZW5lcmF0ZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGV0IGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICJpZCI6IHRoaXMuY2FzaFBheW1lbnQuaWQgPyB0aGlzLmNhc2hQYXltZW50LmlkIDogJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICJ0eXBlIjogVFJBTlNBQ1RJT05fVFlQRSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIm51bWJlciI6IHRoaXMuY2FzaFBheW1lbnQubnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAiYWJiciI6IHRoaXMuY2FzaFBheW1lbnQudHJhbnNhY3Rpb25UeXBlLmFiYnIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICJ0cmFuc2FjdGlvbkRhdGUiOiB0aGlzLnRyYW5zYWN0aW9uRGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgInN1cHBsaWVyIjogdGhpcy5jYXNoUGF5bWVudC5zdXBwbGllciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgInRyYW5zYWN0aW9uVHlwZSI6IHRoaXMuY2FzaFBheW1lbnQudHJhbnNhY3Rpb25UeXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAiaXRlbUxpbmUiOiBkYXRhUm93LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAidHJhbnNhY3Rpb25Ob3RlIjogdGhpcy5jYXNoUGF5bWVudC50cmFuc2FjdGlvbk5vdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICJqb3VybmFsTm90ZSI6IHRoaXMuY2FzaFBheW1lbnQuam91cm5hbE5vdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICJyZWZlcmVuY2VObyI6IHRoaXMuY2FzaFBheW1lbnQucmVmZXJlbmNlTm8sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICJ0b3RhbCI6IHRoaXMuY2FzaFBheW1lbnQudG90YWwsIC8vIG5vdCB1c2VkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICJjdXJyZW5jeSI6IHRoaXMuY2FzaFBheW1lbnQuY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICJleGNoYW5nZUFtb3VudCI6IHRoaXMuY2FzaFBheW1lbnQuZXhjaGFuZ2VBbW91bnQsLy8gYW1vdW50IHRvIGJhc2UgY3VycmVuY3kKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgInBhaWRPcHRpb24iOiB0aGlzLm1QYXltZW50T3B0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAicGFpZE9wdGlvblRleHQiOiB0aGlzLm1TdXBwbGllciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgImRpc2NvdW50IjogdGhpcy5jYXNoUGF5bWVudC5kaXNjb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgInN0YXR1cyI6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICJhcHByb3ZlZEJ5IjogdGhpcy5jYXNoUGF5bWVudC5hcHByb3ZlZEJ5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAiZm9ybVRlbXBsYXRlIjoge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICJjcmVhdGVkQXQiOiB0aGlzLmNhc2hQYXltZW50LmNyZWF0ZWRBdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgImxvZ2dlZFVzZXIiOiB0aGlzLmxvZ2dlZFVzZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICJ0eG5MaXN0IjogdGhpcy50eG5MaXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAiaXNBdXRvR2VuZXJhdGUiOiBpc0F1dG9HZW5lcmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIm9sZFRvdGFsIjogdGhpcy5vbGRUb3RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgImpSYXciOiB0aGlzLmpSYXcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICJhY3Rpb25UeXBlIjogdGhpcy4kcm91dGUucGFyYW1zLmlkID8gdGhpcy4kcm91dGUucXVlcnkudHlwZSA6ICduZXcnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3RvZG86IG1hdGNoIENhc2ggUGF5bWVudCBtb2RlbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXNoUGF5bWVudC5wYWlkT3B0aW9uID0gdGhpcy5tUGF5bWVudE9wdGlvbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FzaFBheW1lbnQucGFpZE9wdGlvblRleHQgPSB0aGlzLm1TdXBwbGllcjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FzaFBheW1lbnQuaXRlbUxpbmUgPSBpdGVtTGluZXM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhc2hQYXltZW50WyJqUmF3Il0gPSB0aGlzLmpSYXc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhc2hQYXltZW50WyJ0eXBlIl0gPSBUUkFOU0FDVElPTl9UWVBFOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXNoUGF5bWVudC5sb2dnZWRVc2VyID0gdGhpcy5sb2dnZWRVc2VyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXNoUGF5bWVudFsib2xkVG90YWwiXSA9IHRoaXMub2xkVG90YWw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhc2hQYXltZW50WyJpc0F1dG9HZW5lcmF0ZSJdID0gaXNBdXRvR2VuZXJhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhc2hQYXltZW50WyJ0eG5MaXN0Il0gPSB0aGlzLnR4bkxpc3Q7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhc2hQYXltZW50WyJ0cmFuc2FjdGlvbkRhdGVUWiJdID0gSGVscGVyLnRvSVNPRGF0ZSh0aGlzLmNhc2hQYXltZW50LnRyYW5zYWN0aW9uRGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhc2hQYXltZW50WyJhY3Rpb25UeXBlIl0gPSB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHRoaXMuJHJvdXRlLnF1ZXJ5LnR5cGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ICJuZXciOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXNoUGF5bWVudFsibG9nZ2VkVXNlciJdID0gdGhpcy5sb2dnZWRVc2VyOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmKGlzUHJpbnQgPT0gdHJ1ZSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgdGhpcy5jbGVhcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKHRoaXMuY2FzaFBheW1lbnQsICdjYXNoIFBheW1lbnQnLCBpc1ByaW50KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmlsbGluZ0hhbmRsZXIuY3JlYXRlQ2FzaFBheW1lbnQodGhpcy5jYXNoUGF5bWVudCkudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXNDb2RlID09PSAyMDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5jbG9zZShyZXNwb25zZS5kYXRhLmRhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5zdWNjZXNzKCJTdWNjZXNzZnVsbHkiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzUHJpbnQgPT0gJ1ByaW50JykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0UHJpbnQocmVzcG9uc2UuZGF0YS5kYXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc1ByaW50ID09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5oaXN0b3J5LmdvKC0xKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcigiU29tZXRoaW5nIHdlbnQgd3JvbmciKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvcnMucHVzaChlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDIwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBfcHJpbnQoKSB7CiAgICAgICAgICAgIHRoaXMuY2FzaFBheW1lbnRbImpSYXciXSA9IHRoaXMualJhdzsKICAgICAgICAgICAgZ2V0UHJpbnQodGhpcy5jYXNoUGF5bWVudCk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkQ2FzaFBheW1lbnRWaWV3KCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1MaW5lcyA9IFtdOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyRmlsdGVyID0gIj9pZD0iICsgdGhpcy4kcm91dGUucGFyYW1zLmlkOwogICAgICAgICAgICAgICAgICAgICAgICBiaWxsaW5nSGFuZGxlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnR4bkNhc2hQYXltZW50KHN0ckZpbHRlcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXNoUGF5bWVudCA9IHJlc3BvbnNlWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWZlcmVuY2VObyA9IHRoaXMuY2FzaFBheW1lbnQucmVmZXJlbmNlTm87CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1TdXBwbGllciA9IHRoaXMuY2FzaFBheW1lbnQuc3VwcGxpZXI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9sZFRvdGFsID0gdGhpcy5jYXNoUGF5bWVudC50b3RhbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb25EYXRlID0gdGhpcy5jYXNoUGF5bWVudC50cmFuc2FjdGlvbkRhdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbUxpbmVzID0gcmVzcG9uc2VbMF0uaXRlbUxpbmU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jYXNoUGF5bWVudC5oYXNPd25Qcm9wZXJ0eSgic3VwcGxpZXIiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNhc2hQYXltZW50LnN1cHBsaWVyLmhhc093blByb3BlcnR5KCJuYW1lIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5uYW1lID0gdGhpcy5jYXNoUGF5bWVudC5zdXBwbGllci5uYW1lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKTsKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGNsZWFyKCkgewogICAgICAgICAgICB0aGlzLmlkID0gdW5kZWZpbmVkOwogICAgICAgICAgICB0aGlzLm1TdXBwbGllciA9IHt9CiAgICAgICAgICAgIHRoaXMuY2FzaFBheW1lbnQgPSBuZXcgQ2FzaFBheW1lbnRNb2RlbCh7fSk7CiAgICAgICAgICAgIGxldCBpdGVtTGluZURTID0gdGhpcy4kcmVmcy5pdGVtTGluZURTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgIHRoaXMuaXRlbUxpbmVzID0gaXRlbUxpbmVEUy5kYXRhKFtdKTsKICAgICAgICAgICAgdGhpcy5jYXNoUGF5bWVudC50cmFuc2FjdGlvblR5cGUgPSB0aGlzLnRyYW5zYWN0aW9uVHlwZXNbMF07CiAgICAgICAgICAgIHRoaXMubmFtZSA9ICIiCiAgICAgICAgICAgIHRoaXMucmVxdWVzdFBheW1lbnRMaXN0ID0gW10KICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZU51bWJlcigpOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZE90aGVyQWNjb3VudCgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ0hhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgLmdldE90aGVyQWNjb3VudCgpCiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSByZXNwb25zZS5maWx0ZXIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChvKSA9PiBvLmJhbmhqaUFjY0NvZGUgPT09ICI3NDAwMTAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coZGF0YSwgIiB0aGlzLmdhaW5Mb3NzQWMiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2Fpbkxvc3NBY2MgPSBkYXRhWzBdLmFjY291bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFfID0gcmVzcG9uc2UuZmlsdGVyKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobykgPT4gby5iYW5oamlBY2NDb2RlID09PSAiNzQwMDQwIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFfLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vdGhlclJldmVudWVBY2MgPSBkYXRhX1swXS5hY2NvdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKCk7CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRSZXF1ZXN0UGF5bWVudCgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3VwcGxpZXIgPSB0aGlzLmNhc2hQYXltZW50LnN1cHBsaWVyIHx8IHt9CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3VwcGxpZXJJZCA9IHN1cHBsaWVyLmlkIHx8ICcnCiAgICAgICAgICAgICAgICAgICAgaWYgKHN1cHBsaWVySWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0ckZpbHRlciA9ICI/aWQ9IiArIHN1cHBsaWVySWQgKyAnJnN0YXR1cz0xJzsKICAgICAgICAgICAgICAgICAgICAgICAgYmlsbGluZ0hhbmRsZXIucmVxdWVzdFBheW1lbnRMaXN0KHN0ckZpbHRlcikudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdFBheW1lbnRMaXN0ID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRSZXF1ZXN0UGF5bWVudExpbmVzKCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCByZXF1ZXN0UGF5bWVudCA9IHRoaXMuY2FzaFBheW1lbnQucmVxdWVzdFBheW1lbnQgfHwge30KICAgICAgICAgICAgICAgICAgICBjb25zdCByZXFJZCA9IHJlcXVlc3RQYXltZW50LmlkIHx8ICcnCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcUlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJGaWx0ZXIgPSAiP2lkPSIgKyByZXFJZCArICcmZGV0YWlsPTEnOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1MaW5lcyA9IFtdCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FzaFBheW1lbnQuaXRlbUxpbmUgPSBbXQogICAgICAgICAgICAgICAgICAgICAgICBiaWxsaW5nSGFuZGxlci5yZXF1ZXN0UGF5bWVudExpc3Qoc3RyRmlsdGVyKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtTGluZXMgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FzaFBheW1lbnQuaXRlbUxpbmUgPSB0aGlzLml0ZW1MaW5lcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJlZnMubGluZURTLmtlbmRvV2lkZ2V0KCkuc2V0RGF0YVNvdXJjZSh0aGlzLml0ZW1MaW5lcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBsZXQgZGF0YVNvdXJjZSA9IG5ldyBrZW5kby5kYXRhLkRhdGFTb3VyY2UoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICBkYXRhOiB0aGlzLml0ZW1MaW5lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGV0IGdyaWQgPSAkKCcjZ3JpZCcpLmRhdGEoImtlbmRvR3JpZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGdyaWQuc2V0RGF0YVNvdXJjZShkYXRhU291cmNlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIG9uUGF5bWVudFJlcXVlc3RDaGFuZ2UoKSB7CiAgICAgICAgICAgIHRoaXMuaXNFZGl0ID0gZmFsc2UKICAgICAgICAgICAgdGhpcy5jaGVja2VkID0gdHJ1ZQogICAgICAgICAgICBjb25zdCByZXEgPSB0aGlzLmNhc2hQYXltZW50LnJlcXVlc3RQYXltZW50IHx8IHt9CiAgICAgICAgICAgIGlmIChyZXEuaWQpIHsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMubG9hZFJlcXVlc3RQYXltZW50TGluZXMoKQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5pdGVtTGluZXMgPSBbXQogICAgICAgICAgICAgICAgdGhpcy5jYXNoUGF5bWVudC5pdGVtTGluZSA9IFtdCiAgICAgICAgICAgIH0KCiAgICAgICAgfSwKICAgICAgICBvbkdyaWRDYXNoUGF5bWVudCgpIHsKICAgICAgICAgICAgY29uc3QgZ3JpZCA9IHRoaXMuJHJlZnMuZ3JpZENhc2hQYXltZW50LmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRFeHBlbnNlSWRzID0gZ3JpZC5zZWxlY3RlZEtleU5hbWVzKCk7CiAgICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpOwogICAgICAgIH0sCiAgICAgICAgZGF0YUJvdW5kOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrZWQpIHsKICAgICAgICAgICAgICAgICQoIiNncmlkQ2FzaFBheW1lbnQgdGJvZHkgaW5wdXQ6Y2hlY2tib3giKS50cmlnZ2VyKCJjbGljayIpOwogICAgICAgICAgICAgICAgJCgiI2dyaWRDYXNoUGF5bWVudCB0Ym9keSBpbnB1dDpjaGVja2JveCIpLnByb3AoImRpc2FibGVkIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAkKCIuay1oZWFkZXIgaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJkaXNhYmxlZCIsIHRydWUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJCgiI2dyaWRDYXNoUGF5bWVudCB0Ym9keSBpbnB1dDpjaGVja2JveCIpLnByb3AoImRpc2FibGVkIiwgZmFsc2UpOwogICAgICAgICAgICAgICAgJCgiLmstaGVhZGVyIGlucHV0OmNoZWNrYm94IikucHJvcCgiZGlzYWJsZWQiLCBmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgfSwKICAgIHdhdGNoOiB7CiAgICAgICAgaWQoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgdGhpcy5jbGVhcigpOwogICAgICAgICAgICAgICAgdGhpcy5pc1ZpZXcgPSBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5pbml0RGF0YSgpOwogICAgICAgICAgICAgICAgdGhpcy5pc1ZpZXcgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgIH0sCiAgICBjcmVhdGVkKCkgewogICAgICAgIC8vIGZldGNoIHRoZSBkYXRhIHdoZW4gdGhlIHZpZXcgaXMgY3JlYXRlZCBhbmQgdGhlIGRhdGEgaXMKICAgICAgICAvLyBhbHJlYWR5IGJlaW5nIG9ic2VydmVkCiAgICAgICAgLy8gdGhpcy5sb2FkT2JqKCkKICAgICAgICB0aGlzLmxvYWRQYXltZW50T3B0aW9uKCk7CiAgICAgICAgdGhpcy5sb2FkT3RoZXJBY2NvdW50KCk7CiAgICB9LAogICAgbW91bnRlZDogYXN5bmMgZnVuY3Rpb24gKCkgewogICAgICAgIGF3YWl0IHRoaXMubG9hZFByZWZpeCgpOwogICAgICAgIGF3YWl0IHRoaXMubG9hZFNhbGVGb3JtQ29udGVudCgpOwogICAgICAgIHRoaXMubG9hZERhdGEoMCwgdGhpcy5maWx0ZXIsIHRoaXMuc3VwQmFzZVVybCk7CiAgICAgICAgYXdhaXQgdGhpcy5pbml0R3JpZCh0aGlzKTsKICAgICAgICBhd2FpdCB0aGlzLmluaXREYXRhKCk7CiAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCA9PT0gdW5kZWZpbmVkKSB7CgogICAgICAgICAgICB0aGlzLmlzVmlldyA9IGZhbHNlOwogICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgICB0aGlzLmlzVmlldyA9IHRydWU7CiAgICAgICAgfQogICAgfSwKICAgIGNvbXB1dGVkOiB7CiAgICAgICAgZGlzYWJsZWRNZSgpIHsKICAgICAgICAgICAgcmV0dXJuICEhdGhpcy4kcm91dGUucGFyYW1zLmlkOwogICAgICAgIH0sCiAgICAgICAgc2hvd01lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5tUGF5bWVudE9wdGlvbiA9PT0gIlZlbmRvciI7IC8vIG9yIHNvbWUgb3RoZXIgbW9yZSBjb21wbGljYXRlZCBsb2dpYwogICAgICAgIH0sCiAgICAgICAgZW5hYmxlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHJvdXRlLnBhcmFtcy5pZCAhPT0gdW5kZWZpbmVkOwogICAgICAgIH0sCiAgICAgICAgaGlkZGVuQnV0dG9uKCkgewogICAgICAgICAgICBpZiAodGhpcy4kcm91dGUucXVlcnkudHlwZSA9PSAiZWRpdCIpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0sCn0K"},{"version":3,"sources":["CashPayments.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqkBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CashPayments.vue","sourceRoot":"src/views/suppliers","sourcesContent":["<template>\n    <v-app>\n        <v-container>\n            <v-row>\n                <v-col sm=\"12\" cols=\"12\">\n                    <v-card\n                        outlined\n                        dense\n                        class=\"pa-4 no_border rounded-sm\"\n                        color=\"white\">\n                        <v-row>\n                            <v-col\n                                class=\"bigSide py-0\"\n                                sm=\"12\"\n                                cols=\"12\"\n                                style=\"transition: .3s ease-in;\"\n                                :class=\"{ hide_big_bar_class: isHideBar }\">\n                                <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                                    <v-card outlined dense class=\"no_border\">\n                                        <h2 class=\"mb-0\">\n                                            {{ $t(\"cash_payment\") }}\n                                        </h2>\n                                        <v-icon\n                                            v-if=\"!isHideBar\"\n                                            @click=\"cancel()\"\n                                            style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                                            class=\"float-right\"\n                                        >close\n                                        </v-icon>\n                                    </v-card>\n                                    <v-card outlined dense class=\"px-3 no_border\" color=\"grayBg\">\n                                        <v-row>\n                                            <v-col sm=\"7\" cols=\"12\" class=\"pb-0\">\n                                                <label class=\"label\">{{ $t(\"vendor_name\") }}</label>\n                                                <div class=\"pt-0 mb-4 kendo_dropdown_custom d-flex mt-0\">\n                                                    <dropdownlist\n                                                        :data-items=\"suppliers\"\n                                                        @change=\"onCustomerChanged\"\n                                                        :value=\"mSupplier\"\n                                                        :disabled=\"enabled\"\n                                                        :data-item-key=\"'id'\"\n                                                        :text-field=\"'name'\"\n                                                        :default-item=\"defaultItem\"\n                                                        :filterable=\"true\"\n                                                        @filterchange=\"onCustomerFilterChanged\"\n                                                    >\n                                                    </dropdownlist>\n                                                    <v-btn\n                                                        color=\"primary mt-1 ml-2 white--text\"\n                                                        @click=\"searchPurchaseOrderExpense\"\n                                                        :disabled=\"enabled\"\n                                                    >\n                                                        <i\n                                                            class=\"b-search\"\n                                                            style=\"font-size: 18px; color:#fff\"\n                                                        />\n                                                    </v-btn>\n\n                                                </div>\n\n                                                <label class=\"label\">{{ $t(\"type\") }}</label>\n                                                <v-select\n                                                    class=\"mt-1\"\n                                                    v-model=\"cashPayment.transactionType\"\n                                                    :items=\"transactionTypes\"\n                                                    item-value=\"id\"\n                                                    item-text=\"name\"\n                                                    return-object\n                                                    @change=\"onTypeChanged\"\n                                                    :placeholder=\"$t('type')\"\n                                                    outlined\n                                                >\n                                                </v-select>\n                                                <label class=\"label\">{{ $t(\"date\") }}</label>\n                                                <app-datepicker\n                                                    :initialDate=\"cashPayment.transactionDate\"\n                                                    @onChanged=\"onTransactionDateChanged\"\n                                                    @emitDate=\"cashPayment.transactionDate = $event\"\n                                                />\n                                            </v-col>\n                                            <v-col sm=\"5\" cosl=\"12\">\n                                                <label class=\"label\">{{ $t(\"payment_request\") }}</label>\n                                                <v-select\n                                                    class=\"mt-1\"\n                                                    :items=\"requestPaymentList\"\n                                                    @change=\"onPaymentRequestChange\"\n                                                    item-value=\"id\"\n                                                    item-text=\"referenceNo\"\n                                                    v-model=\"cashPayment.requestPayment\"\n                                                    :placeholder=\"$t('payment_request')\"\n                                                    return-object\n                                                    clearable\n                                                    outlined\n                                                />\n                                                <label class=\"label\">{{ $t(\"name\") }}</label>\n                                                <v-text-field\n                                                    class=\"mt-1\"\n                                                    v-model=\"name\"\n                                                    readonly=\"readonly\"\n                                                    outlined\n                                                />\n                                                <label class=\"label mb-0\">{{ $t(\"number\") }}</label>\n                                                <div class=\"d-flex mt-1\">\n\n                                                    <div class=\"code_text flex-1 text-bold\">\n                                                        {{ cashPayment.transactionType.abbr }}\n                                                    </div>\n                                                    <v-text-field\n                                                        class=\" custom-border  flex-2\"\n                                                        v-model=\"cashPayment.number\"\n                                                        outlined\n                                                        disabled\n                                                        :rules=\"[(v) => !!v || 'Number is required']\"\n                                                        required\n                                                    />\n                                                    <v-icon\n                                                        color=\"black\"\n                                                        size=\"30\"\n                                                        style=\" height: 40px;\"\n                                                        class=\"border_qrcode ml-2\"\n                                                        @click=\"generateNumber\"\n                                                    >mdi-qrcode\n                                                    </v-icon>\n\n                                                </div>\n                                            </v-col>\n                                        </v-row>\n                                    </v-card>\n\n                                    <v-row class=\"pt-3\" style=\"background-color: #fff;\">\n                                        <v-col sm=\"12\" cols=\"12\" class=\"pt-0\">\n                                            <LoadingMe\n                                                :isLoading=\"showLoading\"\n                                                :fullPage=\"false\"\n                                                :myLoading=\"true\"\n                                            />\n                                            <kendo-datasource\n                                                ref=\"itemLineDS\"\n                                                :change=\"dataSourceChanged\"\n                                                :schema=\"schemaDefinition\"\n                                                :data=\"itemLines\"/>\n                                            <kendo-grid\n                                                id=\"gridCashPayment\"\n                                                ref=\"gridCashPayment\"\n                                                class=\"grid-function\"\n                                                :data-source-ref=\"'itemLineDS'\"\n                                                :sortable=\"false\"\n                                                :groupable=\"false\"\n                                                :filterable=\"false\"\n                                                :column-menu=\"true\"\n                                                :editable=\"true\"\n                                                :change=\"onGridCashPayment\"\n                                                v-on:databound=\"dataBound\"\n                                                :noRecords=\"true\">\n                                                <!-- <kendo-grid-column\n                                                                          :field=\"'check'\"\n                                                                          :title=\"''\"\n                                                                          :headerTemplate=\"headerTemplate\"\n                                                                          :template=\"checkTemplate\"\n                                                                          :width=\"60\"\n                                                                          :column-menu=\"false\"\n                                                                          :editable=\"\n                                                                            () => {\n                                                                              return false;\n                                                                            }\n                                                                          \"\n                                                                          :locked=\"true\"\n                                                                          :headerAttributes=\"{\n                                                                            style: 'background-color: #EDF1F5;',\n                                                                            class: 'text-center',\n                                                                          }\"\n                                                                          :attributes=\"{ style: 'text-align: center' }\"\n                                                                        /> -->\n                                                <kendo-grid-column\n                                                    :locked=\"true\"\n                                                    :selectable=\"true\"\n                                                    :selected=\"true\"\n                                                    :width=\"40\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'billNumber'\"\n                                                    :title=\"$t('bill_number')\"\n                                                    :width=\"180\"\n                                                    :editable=\" () => { return false;}\"\n                                                    :template=\"billNumberTmp\"\n                                                    :locked=\"true\"\n                                                    :headerAttributes=\"{ style: 'background-color: #EDF1F5',}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'referenceNo'\"\n                                                    :title=\"$t('transaction_num')\"\n                                                    :width=\"210\"\n                                                    :hidden=\"false\"\n                                                    :locked=\"true\"\n                                                    :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                                                    :template=\"referenceNoTmp\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'dueDate'\"\n                                                    :title=\"$t('due_date')\"\n                                                    :width=\"150\"\n                                                    :lockable=\"false\"\n                                                    :template=\"formatDate\"\n                                                    :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'txnNote'\"\n                                                    :title=\"$t('note')\"\n                                                    :width=\"200\"\n                                                    :hidden=\"false\"\n                                                    :lockable=\"false\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: left; ' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'paymentOption'\"\n                                                    :title=\"$t('payment_option')\"\n                                                    :width=\"200\"\n                                                    :lockable=\"false\"\n                                                    :template=\"PMTTemplate\"\n                                                    :editor=\"PaymentOptionEditor\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: right; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: right; ' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'currencyCode'\"\n                                                    :title=\"$t('currency')\"\n                                                    :width=\"150\"\n                                                    :lockable=\"false\"\n                                                    :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                                                    :template=\"currency\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'amount'\"\n                                                    :title=\"$t('amount')\"\n                                                    :width=\"150\"\n                                                    :lockable=\"false\"\n                                                    :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                                                    :template=\"amount\"\n                                                    :attributes=\"{\n                            style: 'text-align: right',\n                          }\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n\n                                                <kendo-grid-column\n                                                    :field=\"'discount'\"\n                                                    :title=\"$t('discount')\"\n                                                    :editor=\"discountEditor\"\n                                                    :template=\"discount\"\n                                                    :width=\"150\"\n                                                    :lockable=\"false\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: right; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{\n                            style: 'text-align: right',\n                          }\"\n                                                />\n\n                                                <kendo-grid-column\n                                                    :field=\"'amountTobePaid'\"\n                                                    :title=\"$t('amount_to_be_paid')\"\n                                                    :width=\"210\"\n                                                    :lockable=\"false\"\n                                                    :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                                                    :template=\"amountTobePaid\"\n                                                    :attributes=\"{ style: 'text-align: right; ' }\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n\n                                                <kendo-grid-column\n                                                    :field=\"'paidAmount'\"\n                                                    :title=\"$t('paid_amount')\"\n                                                    :width=\"200\"\n                                                    :lockable=\"false\"\n                                                    :editor=\"paidAmountEditor\"\n                                                    :template=\"paidAmountTmp\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: right; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: right; ' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'overDue'\"\n                                                    :title=\"$t('over_due')\"\n                                                    :width=\"150\"\n                                                    :lockable=\"false\"\n                                                    :hidden=\"true\"\n                                                    :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                                                    :template=\"overDue\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n\n                                                <kendo-grid-column\n                                                    :field=\"'paymentTerm'\"\n                                                    :title=\"$t('payment_term')\"\n                                                    :width=\"200\"\n                                                    :lockable=\"false\"\n                                                    :hidden=\"true\"\n                                                    :template=\"settlementDiscount\"\n                                                    :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: right; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: right; ' }\"\n                                                />\n\n                                                <kendo-grid-column\n                                                    :field=\"'bankReferenceNo'\"\n                                                    :title=\"$t('bank_reference_no')\"\n                                                    :width=\"180\"\n                                                    :lockable=\"false\"\n                                                    :hidden=\"true\"\n                                                    :template=\"bankReferenceNo\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: right; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: right; ' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'status'\"\n                                                    :title=\"$t('status')\"\n                                                    :width=\"100\"\n                                                    :lockable=\"false\"\n                                                    :template=\"status\"\n                                                    :hidden=\"true\"\n                                                    :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: right; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: right; ' }\"\n                                                />\n                                            </kendo-grid>\n                                        </v-col>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"pb-0\">\n                                            <v-row>\n                                                <v-col sm=\"6\" cols=\"12\" class=\"\">\n                                                    <v-card class=\"no-boxshadow pa-3\" color=\"grayBg\">\n                                                        <v-row>\n                                                            <v-col class=\"py-0\" sm=\"6\" cols=\"6\">\n                                                                <label>{{ $t(\"message_on_receipt\") }}</label>\n                                                                <v-textarea\n                                                                    class=\"mt-1\"\n                                                                    outlined\n                                                                    v-model=\"cashPayment.transactionNote\"\n                                                                    no-resize\n                                                                    height=\"70px\"\n                                                                    rows=\"3\"\n                                                                    placeholder=\"This will appear on the invoice\"\n                                                                />\n                                                            </v-col>\n                                                            <v-col class=\"py-0\" sm=\"6\" cols=\"6\">\n                                                                <label>{{ $t(\"message_for_journal\") }}</label>\n                                                                <v-textarea\n                                                                    class=\"mt-1\"\n                                                                    outlined\n                                                                    v-model=\"cashPayment.journalNote\"\n                                                                    no-resize\n                                                                    height=\"70px\"\n                                                                    rows=\"3\"\n                                                                    placeholder=\"This will appear on the invoice\"\n                                                                />\n                                                            </v-col>\n                                                        </v-row>\n                                                    </v-card>\n                                                    <!--                                                    <template>-->\n                                                    <!--                                                        <v-file-input class=\"mt-0 pt-0 \" sm=\"3\" cols=\"6\"-->\n                                                    <!--                                                                      v-model=\"files\"-->\n                                                    <!--                                                                      :placeholder=\"$t('attachment')\"-->\n                                                    <!--                                                                      multiple-->\n                                                    <!--                                                                      prepend-icon=\"mdi-paperclip\">-->\n                                                    <!--                                                            <template v-slot:selection=\"{ text }\">-->\n                                                    <!--                                                                <v-chip-->\n                                                    <!--                                                                    small-->\n                                                    <!--                                                                    label-->\n                                                    <!--                                                                    color=\"primary\">-->\n                                                    <!--                                                                    {{ text }}-->\n                                                    <!--                                                                </v-chip>-->\n                                                    <!--                                                            </template>-->\n                                                    <!--                                                        </v-file-input>-->\n                                                    <!--                                                    </template>-->\n                                                </v-col>\n                                                <v-col sm=\"6\" cols=\"12\">\n                                                    <v-simple-table>\n                                                        <template v-slot:default>\n                                                            <tbody>\n                                                            <tr>\n                                                                <td class=\"text-left text-uppercase\">\n                                                                    {{ $t(\"discount\") }}\n                                                                </td>\n                                                                <td class=\"text-center\">:</td>\n                                                                <td class=\"text-left primary--text text-bold\">\n                                                                    {{ numberFormat(cashPayment.discount) }}\n                                                                </td>\n                                                            </tr>\n                                                            <!--                                                            <tr>-->\n                                                            <!--                                                                <td class=\"text-left text-uppercase\">{{ $t('total') }}-->\n                                                            <!--                                                                </td>-->\n                                                            <!--                                                                <td class=\"text-center\">:</td>-->\n                                                            <!--                                                                <td class=\"text-left primary--text text-bold\">-->\n                                                            <!--                                                                    {{ numberFormat(cashReceipt.total) }}-->\n                                                            <!--                                                                </td>-->\n                                                            <!--                                                            </tr>-->\n                                                            <tr>\n                                                                <td class=\"text-left text-uppercase\">\n                                                                    {{ $t(\"exchange_amount\") }} -\n                                                                    {{ baseCurrencyCode }}\n                                                                </td>\n                                                                <td class=\"text-center\">:</td>\n                                                                <td class=\"text-left primary--text text-bold\">\n                                                                    {{\n                                                                        numberFormat(cashPayment.exchangeAmount)\n                                                                    }}\n                                                                </td>\n                                                            </tr>\n                                                            <tr hidden>\n                                                                <td class=\"text-left text-uppercase\">\n                                                                    {{ $t(\"dr\") }}\n                                                                </td>\n                                                                <td class=\"text-center\">:</td>\n                                                                <td class=\"text-left primary--text text-bold\">\n                                                                    {{ numberFormat(dr) }}\n                                                                </td>\n                                                            </tr>\n                                                            <tr hidden>\n                                                                <td class=\"text-left text-uppercase\">\n                                                                    {{ $t(\"cr\") }}\n                                                                </td>\n                                                                <td class=\"text-center\">:</td>\n                                                                <td class=\"text-left primary--text text-bold\">\n                                                                    {{ numberFormat(cr) }}\n                                                                </td>\n                                                            </tr>\n                                                            </tbody>\n                                                        </template>\n                                                    </v-simple-table>\n                                                </v-col>\n                                            </v-row>\n                                        </v-col>\n                                    </v-row>\n\n                                    <v-divider/>\n                                    <v-card outlined dense class=\"no_border function_footer\">\n                                        <!-- <v-menu>\n                                                              <template v-slot:activator=\"{ on }\">\n                                                                <v-btn color=\"black\" outlined\n                                                                       class=\"mr-2 text-capitalize  black--text float-left\"\n                                                                       v-on=\"on\">\n                                                                  {{ $t('select_template') }}\n                                                                  <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>\n                                                                </v-btn>\n                                                              </template>\n                                                              <v-list>\n                                                                <v-list-item v-for=\"(item, index) in templates\" :key=\"index\">\n                                                                  <v-list-item-title>{{ item.title }}</v-list-item-title>\n                                                                </v-list-item>\n                                                              </v-list>\n                                                            </v-menu> -->\n                                        <v-btn\n                                            color=\"primary\"\n                                            outlined\n                                            class=\"text-capitalize  black--text float-left\"\n                                            @click=\"cancel\"\n                                        >{{ $t(\"cancel\") }}\n                                        </v-btn>\n                                        <!--                    <v-menu>-->\n                                        <!--                      <template v-slot:activator=\"{ on }\">-->\n                                        <!--                        <v-btn-->\n                                        <!--                            class=\"ml-2 float-right text-capitalize  black&#45;&#45;text\"-->\n                                        <!--                            v-on=\"on\"-->\n                                        <!--                        >-->\n                                        <!--                          {{ $t(\"save_option\") }}-->\n                                        <!--                          <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>-->\n                                        <!--                        </v-btn>-->\n                                        <!--                      </template>-->\n                                        <!--                      <v-list rounded>-->\n                                        <!--                        <v-list-item-group>-->\n                                        <!--                          <v-list-item @click=\"onSaveClose(true)\">-->\n                                        <!--                            <v-list-item-content>-->\n                                        <!--                              <v-list-item-title-->\n                                        <!--                              >{{ $t(\"save_print\") }}-->\n                                        <!--                              </v-list-item-title>-->\n                                        <!--                            </v-list-item-content>-->\n                                        <!--                          </v-list-item>-->\n                                        <!--                          &lt;!&ndash; <v-list-item>-->\n                                        <!--                            <v-list-item-content>-->\n                                        <!--                              <v-list-item-title>{{ $t('save_draft') }}-->\n                                        <!--                              </v-list-item-title>-->\n                                        <!--                            </v-list-item-content>-->\n                                        <!--                          </v-list-item> &ndash;&gt;-->\n                                        <!--                        </v-list-item-group>-->\n                                        <!--                      </v-list>-->\n                                        <!--                    </v-menu>-->\n                                        <v-btn\n                                            color=\"primary\"\n                                            v-if=\"!isView\"\n                                            class=\"float-right white--text text-capitalize \"\n                                            @click=\"onSaveClose(false)\">\n                                            {{ $t(\"save_close\") }}\n                                        </v-btn>\n                                        <v-btn v-if=\"!isView\" color=\"secondary\"\n                                               style=\"margin-right: 10px !important\"\n                                               class=\"white--text float-right text-capitalize\"\n                                               @click=\"onSaveClose(true)\" :hidden=\"hiddenButton\">{{ $t(\"save_new\") }}\n                                        </v-btn>\n                                        <v-btn v-if=\"isView\" color=\"primary\"\n                                               style=\"margin-right: 10px !important\"\n                                               @click=\"_print\"\n                                               class=\"white--text float-right text-capitalize\"\n                                        >{{ $t(\"print\") }}\n                                        </v-btn>\n                                    </v-card>\n                                </v-form>\n                            </v-col>\n                        </v-row>\n                    </v-card>\n                </v-col>\n            </v-row>\n        </v-container>\n    </v-app>\n</template>\n\n<script>\nimport {DropDownList} from \"@progress/kendo-vue-dropdowns\";\nimport {i18n} from \"@/i18n\";\nimport DatePickerComponent from \"@/components/custom_templates/DatePickerComponent\";\nimport CashPaymentModel from \"@/scripts/cash-payment/model/CashPayment\";\nimport ItemLineModel from \"@/scripts/cash-payment/model/ItemLine\";\nimport kendo from \"@progress/kendo-ui\";\nimport {getPrint} from \"@/form/paymentVoucher\";\nimport PaymentOptionEditor from \"@/scripts/kendo_editor/PaymentOptionEditor\";\nimport Helper from \"@/helper\";\n\n\nconst prefixHandler = require(\"@/scripts/prefixHandler\");\nconst purchaseFormContentHandler = require(\"@/scripts/purchaseFormContentHandler\");\nconst billingHandler = require(\"@/scripts/invoice/handler/billingHandler\");\nconst supplierHandler = require(\"@/scripts/supplierHandler\");\n\nconst $ = kendo.jQuery\nconst cookieJS = require(\"@/cookie.js\");\nconst cookie = cookieJS.getCookie();\nconst paymentOptionHandler = require(\"@/scripts/paymentOptionHandler\");\nconst settingHandler = require(\"@/scripts/settingsHandler\");\n\nconst cashPaymentModel = new CashPaymentModel({});\nconst itemLineModel = new ItemLineModel({});\n\nconst keyField = \"id\";\nconst textField = \"numberName\";\nconst defaultItem = {[textField]: \"Select vendor...\", [keyField]: null};\nconst emptyItem = {[textField]: \"loading ...\"};\nconst OPTION_TYPE = \"Supplier\";\nconst strFilter = \"?optionType=\" + OPTION_TYPE;\nconst TXN_TYPE = \"cash payment\";\nconst TRANSACTION_TYPE = \"Cash Payment\";\n\nexport default {\n    name: \"CashPayment\",\n    props: [\"id\"],\n    components: {\n        LoadingMe: () => import(`@/components/Loading`),\n        \"app-datepicker\": DatePickerComponent,\n        dropdownlist: DropDownList,\n    },\n    data: () => ({\n        PaymentOptionEditor: PaymentOptionEditor,\n        showLoading: false,\n        alert: false,\n        files: [],\n        errors: [],\n        valid: true,\n        loggedUser: {\n            id: cookie.creator,\n            name: cookie.email,\n        },\n        itemLines: [],\n        templates: [\n            {title: \"Draft\"},\n            {title: \"Open\"},\n            {title: \"Partially Closed\"},\n            {title: \"Closed\"},\n        ],\n        col_expand: 9,\n        col_hide: 3,\n        isHideBar: false,\n        typeAs: ['Cash', 'Bank'],\n        paymentOptions: [\"Vendor\"],\n        mPaymentOption: \"Vendor\",\n        paymentMethod: [\"Cash\", \"Cheque\"],\n        transactionDate: new Date().toISOString().substr(0, 10),\n        cashPayment: cashPaymentModel,\n        itemLine: itemLineModel,\n        purchaseFormContent: {},\n        search: \"\",\n        transactionTypes: [],\n        suppliers: [],\n        mSupplier: {},\n        defaultItem: defaultItem,\n        supBaseUrl: supplierHandler.search(),\n        filter: \"\",\n        name: \"\",\n        referenceNo: \"\",\n        oldTotal: 0,\n        dateFormat: itemLineModel.dateFormat,\n        group: {field: \"supplier.name\"},\n        banks: [],\n        txnList: [],\n        currencyCode: \"\",\n        transactionRate: 1,\n        schemaDefinition: {\n            model: {id: \"lineId\"},\n        },\n        baseCurrency: {},\n        baseCurrencyCode: \"\",\n        jRaw: [],\n        gainLossAcc: {},\n        otherRevenueAcc: {},\n        gainOrLossDescription: \"gain/loss on exchange rate\",\n        penaltyDescription: \"penalty\",\n        requestPaymentList: [],\n        selectedExpenseIds: [],\n        cr: 0,\n        dr: 0,\n        isEdit: true,\n        checked: false,\n        isView: false\n    }),\n    methods: {\n        isEditable() {\n            return this.isEdit\n        },\n        savePrint() {\n        },\n        currency(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty(\"currencyCode\")) {\n                    return dataItem.currencyCode;\n                }\n            }\n            return \"\";\n        },\n        referenceNoTmp(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty(\"referenceNo\")) {\n                    return dataItem.referenceNo;\n                }\n            }\n            return \"\";\n        },\n        billNumberTmp(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty(\"billNumber\")) {\n                    return dataItem.billNumber;\n                }\n            }\n            return \"\";\n        },\n        paidAmountTmp(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty(\"paidAmount\")) {\n                    return kendo.toString(dataItem.paidAmount, dataItem.decimalFormat);\n                }\n            }\n            return \"\";\n        },\n        amountTobePaid(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty(\"amountTobePaid\")) {\n                    return kendo.toString(\n                        dataItem.amountTobePaid,\n                        dataItem.decimalFormat\n                    );\n                }\n            }\n            return \"\";\n        },\n        discount(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty(\"discount\")) {\n                    return kendo.toString(dataItem.discount, dataItem.decimalFormat);\n                }\n            }\n            return \"\";\n        },\n        amount(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty(\"amount\")) {\n                    return kendo.toString(dataItem.amount, dataItem.decimalFormat);\n                }\n            }\n            return \"\";\n        },\n        bankReferenceNo(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty(\"overDue\")) {\n                    return dataItem.bankReferenceNo;\n                }\n            }\n            return \"\";\n        },\n        overDue(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty(\"overDue\")) {\n                    return dataItem.overDue;\n                }\n            }\n            return 0;\n        },\n        // async loadTransactionRate(code) {\n        //     new Promise(resolve => {\n        //         setTimeout(() => {\n        //             resolve('resolved')\n        //             const date = new Date(this.transactionDate).toISOString().substr(0, 10)\n        //             // const priceLevel = this.invoice.priceLevel\n        //             if (code !== undefined || code !== '') {\n        //                 this.showLoading = true\n        //                 currencyHandler.getLastExchangeRateByDate(date, code).then(res => {\n        //                     if (res.data.statusCode === 200) {\n        //                         this.showLoading = false\n        //                         const exchangeRate = res.data.data\n        //                         this.currencyCode = exchangeRate.code\n        //                         this.transactionRate = exchangeRate.rate\n        //                         this.cashReceipt.txnRate = exchangeRate.rate\n        //                         this.cashReceipt.exchangeRate = exchangeRate\n        //                         this.showLoading = false\n        //                     }\n        //                 })\n        //             }\n        //\n        //         }, 10)\n        //     })\n        // },\n        async initData() {\n            if (this.$route.params.id !== undefined) {\n                const queryString = this.$route.query;\n                let type = \"\";\n                let option = 0;\n                if (queryString.hasOwnProperty(\"type\")) {\n                    type = queryString.type;\n                    option = queryString.option;\n                    if (type === \"pmt\") {\n                        this.mPaymentOption = option;\n                        this.search = this.$route.params.id;\n                        this.searchPurchaseOrderExpense();\n                    }\n                } else {\n                    await this.loadCashPaymentView();\n                }\n            } else {\n                this.initRow();\n            }\n        },\n        paidAmountEditor(container, options) {\n            kendo\n                .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoNumericTextBox({\n                    decimals: 30,\n                    format: `n${this.purchaseFormContent.decimal}`,\n                    min: 0,\n                });\n        },\n        discountEditor(container, options) {\n            kendo\n                .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoNumericTextBox({\n                    decimals: 30,\n                    format: `n${this.purchaseFormContent.decimal}`,\n                    min: 0,\n                });\n        },\n        onTransactionDateChanged() {\n            if (this.cashPayment.supplier) {\n                const supplier = this.cashPayment.supplier || {};\n                const supId = supplier.id || \"\";\n                if (supId) {\n                    this.generateNumber();\n                    this.searchPurchaseOrderExpense();\n                }\n            }\n        },\n        generateNumber() {\n            if (this.$route.params.id) {\n                const tranDate = new Date(this.transactionDate);\n                const tranDateReceipt = new Date(this.cashPayment.transactionDate);\n                const tranDateM = tranDate.getFullYear() + tranDate.getMonth();\n                const tranDateReceiptM =\n                    tranDateReceipt.getFullYear() + tranDateReceipt.getMonth();\n                if (tranDateM === tranDateReceiptM) {\n                    this.cashPayment.referenceNo = this.referenceNo;\n                    return;\n                }\n            }\n            window.console.log('this.cashPayment.transactionType', this.cashPayment.transactionType)\n            if (this.cashPayment.transactionDate !== \"\" && this.transactionTypes.length > 0) {\n                let data = {\n                    abbr: this.cashPayment.transactionType.abbr,\n                    structure: this.cashPayment.transactionType.structure,\n                    transactionDate: this.cashPayment.transactionDate,\n                    sequcencing: this.cashPayment.transactionType.sequcencing,\n                    prefixSeparator: this.cashPayment.transactionType.prefixSeparator || '',\n                    numberSeparator: this.cashPayment.transactionType.numberSeparator || '',\n                    format: this.cashPayment.transactionType.format || 5,\n                    type: TRANSACTION_TYPE,\n                    entity: 1,\n                };\n                billingHandler\n                    .lastNumber(data)\n                    .then((response) => {\n                        if (response.data.statusCode === 200) {\n                            const res = response.data.data;\n                            const lastNumber = this.zeroPad(\n                                parseInt(res.lastNumber),\n                                this.cashPayment.transactionType.format\n                            );\n                            const number =\n                                res.suffix +\n                                this.cashPayment.transactionType.numberSeparator +\n                                lastNumber;\n                            this.cashPayment.number = number;\n                            if (\n                                this.cashPayment.transactionType.hasOwnProperty(\n                                    \"prefixSeparator\"\n                                )\n                            ) {\n                                const prefixSep = this.cashPayment.transactionType\n                                    .prefixSeparator;\n                                this.cashPayment.referenceNo =\n                                    this.cashPayment.transactionType.abbr + prefixSep + number;\n                            }\n                        }\n                    })\n                    .catch((e) => {\n                        this.errors.push(e);\n                    });\n            }\n        },\n        zeroPad(num, places) {\n            return String(num).padStart(places, \"0\");\n        },\n        autoCalculate() {\n            let ds = this.$refs.itemLineDS.kendoWidget(),\n                receiptAmount = 0,\n                discount = 0,\n                convertedAmount = 0,\n                exchangeDiscount = 0,\n                exchangeDiscountTxn = 0,\n                paidAmountTxn = 0;\n            this.jRaw = [];\n            const rows = ds.data().filter((m) => m.paidAmount > 0 || m.discount > 0);\n            window.console.log('cashPayment', ds.data())\n            rows.forEach((value) => {\n                if (~this.selectedExpenseIds.indexOf(value.lineId)) {\n                    let nature = \"\",\n                        purchaseRate = 0,\n                        paymentRate = 0,\n                        rawPaidAmount = 0,\n                        rawDiscountAmount = 0,\n                        currencyCode = \"\";\n                    let discountAmount = 0,\n                        apAmount = 0,\n                        refNo = \"\",\n                        payOption = {},\n                        currency = {},\n                        gainLoss = 0,\n                        lastXRate = {},\n                        location = {},\n                        segment = {},\n                        project = {},\n                        locationId = \"\",\n                        segmentId = \"\",\n                        projectId = \"\",\n                        txnId = \"\",\n                        invRate = 1;\n                    if (value.referenceNo) {\n                        refNo = value.referenceNo;\n                    }\n                    if (value.id) {\n                        txnId = value.id || \"\";\n                    }\n                    if (value.txnRate) {\n                        purchaseRate = parseFloat(value.txnRate);\n                    }\n                    if (value.currencyCode) {\n                        currencyCode = value.currencyCode || \"\";\n                    }\n                    if (value.currency) {\n                        currency = value.currency || {};\n                    }\n                    if (value.location) {\n                        location = value.location || {};\n                        if (location.hasOwnProperty(\"id\")) {\n                            locationId = location.id;\n                        }\n                    }\n                    if (value.segment) {\n                        segment = value.segment || {};\n                        if (segment.hasOwnProperty(\"id\")) {\n                            segmentId = segment.id;\n                        }\n                    }\n                    if (value.project) {\n                        project = value.project || {};\n                        if (project.hasOwnProperty(\"id\")) {\n                            projectId = project.id;\n                        }\n                    }\n                    if (value.exchangeRate) {\n                        lastXRate = value.exchangeRate || {};\n                    }\n                    if (value.txnRate) {\n                        invRate = parseFloat(value.txnRate);\n                    }\n                    if (value.rateTobase) {\n                        paymentRate = parseFloat(value.rateTobase);\n                    }\n                    if (value.paidAmount) {\n                        receiptAmount += kendo.parseFloat(value.paidAmount);\n                        convertedAmount +=\n                            kendo.parseFloat(value.paidAmount) * value.rateTobase;\n                        paidAmountTxn += kendo.parseFloat(value.paidAmount) * invRate;\n                        // paidAmt = kendo.parseFloat(value.paidAmount) * purchaseRate\n                        rawPaidAmount = kendo.parseFloat(value.paidAmount);\n                    }\n                    if (value.discount) {\n                        // discount += kendo.parseFloat(value.discount)\n                        discount += kendo.parseFloat(value.discount) * value.rateTobase;\n                        exchangeDiscount +=\n                            kendo.parseFloat(value.exchangeDiscount) * value.rateTobase;\n                        exchangeDiscountTxn += kendo.parseFloat(value.discount) * invRate;\n                        discountAmount = kendo.parseFloat(value.discount) * paymentRate;\n                        rawDiscountAmount = kendo.parseFloat(value.discount);\n                    }\n                    // todo: gain or loss exchange rate\n                    gainLoss =\n                        parseFloat(\n                            (purchaseRate - paymentRate) * (rawPaidAmount + rawDiscountAmount)\n                        ) * -1;\n                    if (gainLoss !== 0) {\n                        if (gainLoss > 0) {\n                            nature = \"dr\";\n                        } else {\n                            nature = \"cr\";\n                        }\n                        window.console.log(\"gainLoss\", gainLoss);\n                        if (gainLoss) {\n                            if (this.gainLossAcc.hasOwnProperty(\"id\")) {\n                                this.jRaw.push({\n                                    id:\n                                        this.gainLossAcc.id +\n                                        \"-\" +\n                                        nature +\n                                        \"-\" +\n                                        currencyCode +\n                                        \"-\" +\n                                        purchaseRate +\n                                        \"-\" +\n                                        locationId +\n                                        \"-\" +\n                                        projectId +\n                                        \"-\" +\n                                        segmentId +\n                                        \"-\" +\n                                        txnId,\n                                    txnId: txnId,\n                                    project: project,\n                                    location: location,\n                                    segment: segment,\n                                    projectId: projectId,\n                                    locationId: locationId,\n                                    segmentId: segmentId,\n                                    currencyCode: currencyCode,\n                                    currency: currency,\n                                    lastXRate: lastXRate,\n                                    line: new ItemLineModel(value),\n                                    receiptRate: gainLoss > 0 ? paymentRate : purchaseRate,\n                                    description: this.gainOrLossDescription,\n                                    account: this.gainLossAcc,\n                                    accountId: this.gainLossAcc.id,\n                                    amount: 0,\n                                    exchangeAmount: gainLoss,\n                                    type: nature,\n                                    typeAs: \"GainOrLoss\",\n                                });\n                            }\n                        }\n                    }\n                    //Todo: AP  Dr\n                    apAmount = rawPaidAmount + rawDiscountAmount;\n                    if (apAmount > 0) {\n                        nature = \"dr\";\n                    } else {\n                        nature = \"cr\";\n                    }\n                    if (value.hasOwnProperty(\"apAcc\")) {\n                        const apAcc = value.apAcc;\n                        if (apAcc) {\n                            if (apAcc.hasOwnProperty(\"id\")) {\n                                this.jRaw.push({\n                                    id:\n                                        apAcc.id +\n                                        \"-\" +\n                                        nature +\n                                        \"-\" +\n                                        currencyCode +\n                                        \"-\" +\n                                        purchaseRate +\n                                        \"-\" +\n                                        locationId +\n                                        \"-\" +\n                                        projectId +\n                                        \"-\" +\n                                        segmentId +\n                                        \"-\" +\n                                        txnId,\n                                    txnId: txnId,\n                                    project: project,\n                                    location: location,\n                                    segment: segment,\n                                    projectId: projectId,\n                                    locationId: locationId,\n                                    segmentId: segmentId,\n                                    currencyCode: currencyCode,\n                                    currency: currency,\n                                    lastXRate: lastXRate,\n                                    line: new ItemLineModel(value),\n                                    receiptRate: purchaseRate,\n                                    description: refNo,\n                                    account: apAcc,\n                                    accountId: apAcc.id,\n                                    amount: apAmount,\n                                    exchangeAmount: apAmount * purchaseRate,\n                                    type: nature,\n                                    typeAs: \"AP\",\n                                });\n                            }\n                        }\n                    }\n                    //Todo: Cash Account  CR\n                    if (value.paymentOption) {\n                        payOption = value.paymentOption;\n                        const cashAmount = rawPaidAmount * -1; //+ ((purchaseRate - paymentRate) * (rawPaidAmount + rawDiscountAmount))\n                        // const cashAmount = rawPaidAmount + (gainLoss ) + rawPaidAmount\n                        if (cashAmount > 0) {\n                            nature = \"dr\";\n                        } else {\n                            nature = \"cr\";\n                        }\n                        if (payOption.hasOwnProperty(\"account\")) {\n                            const payOptionAcc = payOption.account;\n                            if (payOptionAcc.hasOwnProperty(\"id\")) {\n                                this.jRaw.push({\n                                    id:\n                                        payOptionAcc.id +\n                                        \"-\" +\n                                        nature +\n                                        \"-\" +\n                                        currencyCode +\n                                        \"-\" +\n                                        purchaseRate +\n                                        \"-\" +\n                                        locationId +\n                                        \"-\" +\n                                        projectId +\n                                        \"-\" +\n                                        segmentId +\n                                        \"-\" +\n                                        txnId,\n                                    txnId: txnId,\n                                    project: project,\n                                    location: location,\n                                    segment: segment,\n                                    projectId: projectId,\n                                    locationId: locationId,\n                                    segmentId: segmentId,\n                                    currencyCode: currencyCode,\n                                    currency: currency,\n                                    lastXRate: lastXRate,\n                                    line: new ItemLineModel(value),\n                                    receiptRate: purchaseRate,\n                                    description: refNo,\n                                    account: payOptionAcc,\n                                    accountId: payOptionAcc.id,\n                                    amount: cashAmount,\n                                    exchangeAmount: cashAmount * paymentRate,\n                                    type: nature,\n                                    typeAs: \"CashAccount\",\n                                });\n                            }\n                        }\n                    }\n                    //Todo: Settlement Discount  Cr\n                    if (value.paymentTerm) {\n                        const settlementDisc = value.paymentTerm;\n                        if (discountAmount > 0) {\n                            if (discountAmount * -1 > 0) {\n                                nature = \"dr\";\n                            } else {\n                                nature = \"cr\";\n                            }\n                            window.console.log(settlementDisc, \"settlementDisc\");\n                            if (settlementDisc.hasOwnProperty(\"account\")) {\n                                const settlementDiscAcc = settlementDisc.account;\n                                if (settlementDiscAcc.hasOwnProperty(\"id\")) {\n                                    this.jRaw.push({\n                                        id:\n                                            settlementDiscAcc.id +\n                                            \"-\" +\n                                            nature +\n                                            \"-\" +\n                                            currencyCode +\n                                            \"-\" +\n                                            purchaseRate +\n                                            \"-\" +\n                                            locationId +\n                                            \"-\" +\n                                            projectId +\n                                            \"-\" +\n                                            segmentId +\n                                            \"-\" +\n                                            txnId,\n                                        txnId: txnId,\n                                        project: project,\n                                        location: location,\n                                        segment: segment,\n                                        projectId: projectId,\n                                        locationId: locationId,\n                                        segmentId: segmentId,\n                                        currencyCode: currencyCode,\n                                        currency: currency,\n                                        lastXRate: lastXRate,\n                                        line: new ItemLineModel(value),\n                                        receiptRate: paymentRate,\n                                        description: \"Purchase Payment Discount\",\n                                        account: settlementDiscAcc,\n                                        accountId: settlementDiscAcc.id,\n                                        amount: rawDiscountAmount * -1,\n                                        exchangeAmount: discountAmount * -1,\n                                        type: nature,\n                                        typeAs: \"Settlement Discount\",\n                                    });\n                                }\n                            }\n                        }\n                    }\n                }\n            });\n            // this.invoiceTxn(txnIds)\n\n            this.cashPayment.total = receiptAmount;\n            this.cashPayment.exchangeAmount = convertedAmount;\n            this.cashPayment.discount = discount;\n            this.cashPayment.exchangeDiscount = exchangeDiscount;\n            this.cashPayment.paidAmountTxn = paidAmountTxn;\n            this.cashPayment.exchangeDiscountTxn = exchangeDiscountTxn;\n            this.shrinkData(this.jRaw);\n        },\n        removeDuplicate(array) {\n            const result = [];\n            const map = new Map();\n            for (const item of array) {\n                if (!map.has(item.id)) {\n                    map.set(item.id, true); // set any value to Map\n                    result.push(item);\n                }\n            }\n            return result;\n        },\n        shrinkData(obj) {\n            const uniques = this.removeDuplicate(obj);\n            uniques.forEach((n) => {\n                const found = obj.filter((m) => m.id === n.id);\n                let amount = 0,\n                    exchangeAmount = 0;\n                found.forEach((z) => {\n                    amount += parseFloat(z.amount || 0);\n                    exchangeAmount += parseFloat(z.exchangeAmount || 0);\n                });\n                n.exchangeAmount = parseFloat(exchangeAmount); //this.numberFormat(amount)\n                n.amount = parseFloat(amount); //parseFloat(parseFloat(amount / parseFloat(n.receiptRate))) //this.numberFormat(amount * parseFloat(this.invoice.txnRate)) //.toFixed(this.saleFormContent.decimal)\n            });\n            this.jRaw = uniques;\n            let dr = 0,\n                cr = 0;\n            this.jRaw.forEach((j) => {\n                switch (j.type) {\n                    case \"cr\":\n                        cr += parseFloat(j.exchangeAmount);\n                        break;\n                    case \"dr\":\n                        dr += parseFloat(j.exchangeAmount);\n                        break;\n                    default:\n                        break;\n                }\n            });\n            // window.console.log(JSON.stringify(this.jRaw), 'uniques')\n            const txnId = this.jRaw.map((o) => o.txnId);\n            var uSet = new Set(txnId);\n            const uniqueSet = [...uSet];\n            let jRaws = [];\n            // window.console.log(JSON.stringify(uniqueSet), 'uniques')\n            uniqueSet.forEach((n) => {\n                const found = this.jRaw.filter((m) => m.txnId === n);\n                const line = found[0].line;\n                const refNo = line.referenceNo;\n                jRaws.push({\n                    id: n,\n                    currencyCode: found[0].currencyCode,\n                    projectId: found[0].projectId,\n                    segmentId: found[0].segmentId,\n                    locationId: found[0].locationId,\n                    referenceNo: refNo || \"\",\n                    entries: found,\n                });\n            });\n            this.jRaw = jRaws;\n            this.dr = dr;\n            this.cr = cr;\n            window.console.log(\"dr=\", dr, \"cr=\", cr, \"dr+cr = \", dr + cr);\n            window.console.log(JSON.stringify(jRaws), \"uniques\");\n        },\n        purchaseTxn() {\n            let txnIds = [],\n                ids = [];\n            this.itemLines.forEach((value) => {\n                if (value.id) {\n                    txnIds.push({\n                        id: value.id,\n                        status: 1,\n                    });\n                }\n            });\n            ids = Object.values(txnIds.reduce((r, o) => ((r[o.id] = o), r), {}));\n            ids.forEach((m) => {\n                const lines = this.itemLines.filter((n) => n.id === m.id);\n                let paidAmt = 0;\n                let amountTobePaid = 0;\n                lines.forEach((x) => {\n                    if (x.paidAmount) {\n                        paidAmt += x.paidAmount;\n                    }\n                    if (x.amountTobePaid) {\n                        amountTobePaid += x.amountTobePaid;\n                    }\n                });\n                const pAmt = this.numberFormat(paidAmt);\n                const amtTobePaid = this.numberFormat(amountTobePaid);\n                if (pAmt === amtTobePaid) {\n                    m[\"status\"] = 3; //Paid\n                } else {\n                    m[\"status\"] = 2; // Partially Paid\n                }\n            });\n            this.txnList = ids;\n        },\n        initRow() {\n            let ds = this.$refs.itemLineDS.kendoWidget();\n            ds.insert([this.itemLine]);\n        },\n        async initGrid(that) {\n            let grid = kendo.jQuery(\"#gridCashPayment\").data(\"kendoGrid\");\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    $(\"#header-chb\").change(function (ev) {\n                        let checked = ev.target.checked;\n                        data = [];\n                        kendo.jQuery(\".row-checkbox\").each(function (idx, item) {\n                            if (checked) {\n                                if (\n                                    !$(item)\n                                        .closest(\"tr\")\n                                        .is(\".k-state-selected\")\n                                ) {\n                                    $(item).click();\n                                    let mRow = $(item).closest(\"tr\");\n                                    let dataItem = grid.dataItem(mRow);\n                                    data.push(dataItem);\n                                }\n                            } else {\n                                $(item).click();\n                            }\n                        });\n                        that.checkedChanged(data);\n                    });\n                }, 10);\n            });\n\n            //\n            // let checkedIds = {}\n            let data = [];\n            //\n            // function selectRow(that) {\n            //     let checked = this.checked,\n            //         row = $(this).closest(\"tr\"),\n            //         grid = $('#itemLine').data('kendoGrid'),\n            //         dataItem = grid.dataItem(row)\n            //\n            //     checkedIds[dataItem.paymentCode] = checked;\n            //     window.console.log('here',dataItem)\n            //     if (checked) {\n            //         //-select the row\n            //         row.addClass(\"k-state-selected\")\n            //         data.push(dataItem)\n            //\n            //         that.checkedChanged(dataItem)\n            //     } else {\n            //         //-remove selection\n            //         row.removeClass(\"k-state-selected\")\n            //     }\n            // }\n            // if (grid) {\n            //     grid.table.on(\"click\", \".row-checkbox\", selectRow(that))\n            // }\n        },\n        checkedChanged(data) {\n            data.forEach((m) => {\n                if (parseFloat(m.paidAmount) === 0) {\n                    m.paidAmount = m.amountTobePaid;\n                }\n                const index = this.itemLines.findIndex((item) => {\n                    return (\n                        m.paymentCode === item.paymentCode &&\n                        parseFloat(item.paidAmount) === 0\n                    );\n                });\n                this.itemLines.splice(index, 1, m);\n            });\n            this.autoCalculate();\n        },\n        headerTemplate() {\n            return `<input type='checkbox' id='header-chb' class='k-checkbox header-checkbox'>`;\n        },\n        checkTemplate(dataItem) {\n            return `<input type='checkbox' #= ${dataItem.check} ? \\\\'checked=\"checked\"\\\\' : '' # class='k-checkbox row-checkbox' />`;\n        },\n        formatDate(dataItem) {\n            if (dataItem.hasOwnProperty(\"dueDate\")) {\n                return kendo.toString(new Date(dataItem.dueDate), this.dateFormat);\n            }\n            return \"\";\n        },\n        settlementDiscount(dataItem) {\n            if (dataItem.hasOwnProperty(\"paymentTerm\")) {\n                return dataItem.paymentTerm.name;\n            }\n            return \"\";\n        },\n        status(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty(\"status\")) {\n                    const status = dataItem.status;\n                    let statusText = \"\";\n                    switch (status) {\n                        case 1:\n                            statusText = \"OPEN\";\n                            break;\n                        case 2:\n                            statusText = \"Partially Paid\";\n                            break;\n                        case 4:\n                            statusText = \"VOID\";\n                            break;\n                        case 3:\n                            statusText = \"PAID\";\n                            break;\n                    }\n                    return statusText;\n                }\n            }\n            return \"\";\n        },\n        onCustomerChanged(event) {\n            this.isEdit = true\n            const value = event.value;\n            if (value && value[textField] === emptyItem[textField]) {\n                return;\n            }\n            this.mSupplier = value;\n            this.cashPayment.supplier = value;\n            this.loadRequestPayment();\n        },\n        onCustomerFilterChanged(event) {\n            const filter = event.filter.value;\n            this.loadData(0, filter, this.supBaseUrl);\n            this.filter = filter;\n        },\n        loadData(skip, filter, baseUrl) {\n            const url = baseUrl + `?filter=${filter}`;\n            this.requestStarted = true;\n            fetch(url)\n                .then((response) => {\n                    return response.json();\n                })\n                .then(this.afterFetch);\n        },\n        afterFetch(json) {\n            this.suppliers = json.data;\n        },\n        numberFormat(value) {\n            return kendo.toString(value, `n${this.purchaseFormContent.decimal}`);\n        },\n        rowNumberTmpl(dataItem) {\n            let ds = this.$refs.itemLineDS.kendoWidget(),\n                index = ds.indexOf(dataItem);\n            return index + 1;\n        },\n        dataSourceChanged(e) {\n            let amtTobePaid = 0, amount = 0, discount = 0,\n                paidAmount = 0;\n            let dataRow = e.items[0] || {}\n            if (Object.keys(dataRow).length > 0) {\n                dataRow.set('optionType', OPTION_TYPE)\n            }\n            if (e.field) {\n                let dataRow = e.items[0];\n                switch (e.field) {\n                    case \"discount\":\n                        amount = dataRow.amount || 0\n                        discount = dataRow.discount || 0\n                        if (discount > amount) {\n                            dataRow.set(\"discount\", amount);\n                        }\n                        dataRow.set(\"amountTobePaid\", parseFloat(dataRow.amount) - parseFloat(dataRow.discount));\n                        dataRow.set(\"exchangeDiscount\", parseFloat(dataRow.discount) * parseFloat(dataRow.rateTobase));\n                        dataRow.set(\"exchangeDiscountTxn\", parseFloat(dataRow.discount) * parseFloat(dataRow.txnRate));\n                        amtTobePaid = parseFloat(dataRow.amountTobePaid || 0);\n                        paidAmount = parseFloat(dataRow.paidAmount || 0);\n                        if (paidAmount > amtTobePaid) {\n                            paidAmount = amtTobePaid;\n                            dataRow.set(\"paidAmount\", parseFloat(paidAmount));\n                            dataRow.set(\"paidAmountTobase\", parseFloat(paidAmount) * parseFloat(dataRow.rateTobase || 1));\n                            dataRow.set(\"paidAmountTxn\", paidAmount * parseFloat(dataRow.txnRate || 1));\n                        }\n                        break;\n                    case \"paidAmount\":\n                        amtTobePaid = parseFloat(dataRow.amountTobePaid);\n                        paidAmount = parseFloat(dataRow.paidAmount);\n                        if (paidAmount > amtTobePaid) {\n                            paidAmount = amtTobePaid;\n                        }\n                        dataRow.set(\"paidAmount\", parseFloat(paidAmount));\n                        dataRow.set(\"paidAmountTobase\", parseFloat(paidAmount) * parseFloat(dataRow.rateTobase));\n                        dataRow.set(\"paidAmountTxn\", paidAmount * parseFloat(dataRow.txnRate));\n                        break;\n                    default:\n                        break;\n                }\n\n                this.purchaseTxn();\n                this.autoCalculate();\n            }\n        },\n        onTypeChanged() {\n            window.console.log(this.$route.params.id, 'pp')\n            if (this.$route.params.id === null || this.$route.params.id === \"\" || this.$route.params.id === undefined) {\n                this.generateNumber();\n            }\n            // this.templateHandle();\n        },\n        cancel() {\n            this.$swal({\n                title: i18n.t(\"msg_title_warning\"),\n                text: i18n.t(\"msg_discard\"),\n                icon: \"warning\",\n                showCancelButton: true,\n                cancelButtonText: i18n.t(\"cancel\"),\n                confirmButtonColor: \"#4d4848\",\n                cancelButtonColor: \"#ED1A3A\",\n                confirmButtonText: i18n.t(\"discard\"),\n            }).then((resultCen) => {\n                window.console.log(resultCen);\n                if (resultCen.value) {\n                    this.$router.go(-1);\n                }\n            });\n        },\n        PMTTemplate(dataItem) {\n            const pmt = dataItem.paymentOption || {};\n            if (pmt) {\n                return `<span>${pmt.bankAccountName || ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        async loadPaymentOption() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    this.paymentMethod = [];\n                    paymentOptionHandler\n                        .list(strFilter)\n                        .then((res) => {\n                            if (res.data.statusCode === 200) {\n                                this.showLoading = false;\n                                this.paymentMethod = res.data.data;\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 10);\n            });\n        },\n        PaymentMethodDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=name#</span>\",\n                    optionLabel: \"--Select--\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.paymentMethod,\n                    }),\n                });\n        },\n        hideSmallSidebar() {\n            this.isHideBar = !this.isHideBar;\n        },\n        async loadPrefix() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    prefixHandler.get(TXN_TYPE).then((res) => {\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false;\n                            this.transactionTypes = res.data.data;\n                            if (this.transactionTypes.length > 0) {\n                                this.cashPayment.transactionType = this.transactionTypes[0];\n                                if (!this.$route.params.id) {\n                                    this.generateNumber();\n                                }\n                            }\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async loadSaleFormContent() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    purchaseFormContentHandler.list().then((res) => {\n                        if (res.data.statusCode === 200) {\n                            const data = res.data.data;\n                            if (data.length > 0) {\n                                this.purchaseFormContent = data[0];\n                            }\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async searchPurchaseOrderExpense() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    this.checked = false\n                    this.isEdit = true\n                    let data = {};\n                    this.cashPayment.requestPayment = {}\n                    this.showLoading = true;\n                    if (this.mPaymentOption === \"Vendor\") {\n                        data = {\n                            search: this.mSupplier.id,\n                            type: \"Vendor\",\n                            transactionDate: this.cashPayment.transactionDate,\n                        };\n                    }\n                    this.itemLines = [];\n                    if (data.search) {\n                        if (data.search.length > 4) {\n                            this.showLoading = true;\n                            try {\n                                this.itemLines = []\n                                this.cashPayment.itemLine = []\n                                billingHandler.searchCashPayment(data).then((res) => {\n                                    this.showLoading = false;\n                                    if (res.data.statusCode === 200) {\n                                        const response = res.data.data;\n                                        const result = res.data.result;\n                                        this.showLoading = false;\n                                        if (response.length > 0) {\n                                            this.itemLines = response;\n                                            this.cashPayment.itemLine = response\n                                            // this.$refs.lineDS.kendoWidget().setDataSource(this.itemLines)\n                                            const obj = response[0];\n                                            // this.autoCalculate();\n                                            // this.dataSourceChanged()\n                                            if (obj.hasOwnProperty(\"supplier\")) {\n                                                this.cashPayment.supplier = obj.supplier;\n                                                if (obj.supplier.hasOwnProperty(\"name\")) {\n                                                    this.name = obj.supplier.name;\n                                                }\n                                            }\n                                        }\n                                        const baseCurrency = result;\n                                        this.baseCurrency = baseCurrency;\n                                        this.cashPayment.currency = baseCurrency;\n                                        if (baseCurrency) {\n                                            if (baseCurrency.hasOwnProperty(\"code\")) {\n                                                this.baseCurrencyCode = baseCurrency.code;\n                                                // if (code) {\n                                                //     this.loadTransactionRate(baseCurrency.code)\n                                                // }\n                                            }\n                                        }\n                                    }\n                                });\n                            } catch (e) {\n                                this.showLoading = false;\n                            }\n                        } else {\n                            this.showLoading = false;\n                        }\n                    } else {\n                        this.showLoading = false;\n                    }\n                }, 10);\n            });\n        },\n        async onSaveClose(isPrint) {\n            if (!this.$refs.form.validate()) {\n                this.$refs.form.validate();\n                return;\n            }\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    let itemLineDS = this.$refs.itemLineDS.kendoWidget();\n                    let dataValidate = 0;\n                    let itemLines = []\n                    itemLineDS\n                        .data()\n                        .filter((n) => n.paidAmount > 0 || n.discount > 0)\n                        .map((n) => {\n                            if (~this.selectedExpenseIds.indexOf(n.lineId)) {\n                                n['id'] = n['txnId_']\n                                itemLines.push(new ItemLineModel(n))\n                            }\n                            // return new ItemLineModel(n);\n                        });\n\n                    if (itemLines.length > 0) {\n                        /*todo: check payment option */\n                        itemLines.forEach((value, index) => {\n                            const paymentOption = value.paymentOption || {};\n                            const paymentOptionId = paymentOption.id || \"\";\n                            if (paymentOptionId === \"\" || paymentOptionId === undefined) {\n                                this.$snotify.error(\n                                    \"Please select payment option at row \" + (index + 1)\n                                );\n                            } else {\n                                dataValidate += 1;\n                            }\n                        });\n                        /*****************************/\n                        if (itemLines.length === dataValidate) {\n                            let isAutoGenerate = 1;\n                            this.autoCalculate();\n                            if (this.$route.params.id) {\n                                const tranDate = new Date(this.transactionDate);\n                                const tranDateReceipt = new Date(\n                                    this.cashPayment.transactionDate\n                                );\n                                const tranDateM = tranDate.getFullYear() + tranDate.getMonth();\n                                const tranDateReceiptM =\n                                    tranDateReceipt.getFullYear() + tranDateReceipt.getMonth();\n                                if (tranDateM === tranDateReceiptM) {\n                                    isAutoGenerate = 0;\n                                }\n                            }\n                            // let data = {\n                            //   \"id\": this.cashPayment.id ? this.cashPayment.id : '',\n                            //   \"type\": TRANSACTION_TYPE,\n                            //   \"number\": this.cashPayment.number,\n                            //   \"abbr\": this.cashPayment.transactionType.abbr,\n                            //   \"transactionDate\": this.transactionDate,\n                            //   \"supplier\": this.cashPayment.supplier,\n                            //   \"transactionType\": this.cashPayment.transactionType,\n                            //   \"itemLine\": dataRow,\n                            //   \"transactionNote\": this.cashPayment.transactionNote,\n                            //   \"journalNote\": this.cashPayment.journalNote,\n                            //   \"referenceNo\": this.cashPayment.referenceNo,\n                            //   \"total\": this.cashPayment.total, // not used\n                            //   \"currency\": this.cashPayment.currency,\n                            //   \"exchangeAmount\": this.cashPayment.exchangeAmount,// amount to base currency\n                            //   \"paidOption\": this.mPaymentOption,\n                            //   \"paidOptionText\": this.mSupplier,\n                            //   \"discount\": this.cashPayment.discount,\n                            //   \"status\": 1,\n                            //   \"approvedBy\": this.cashPayment.approvedBy,\n                            //   \"formTemplate\": {},\n                            //   \"createdAt\": this.cashPayment.createdAt,\n                            //   \"loggedUser\": this.loggedUser,\n                            //   \"txnList\": this.txnList,\n                            //   \"isAutoGenerate\": isAutoGenerate,\n                            //   \"oldTotal\": this.oldTotal,\n                            //   \"jRaw\": this.jRaw,\n                            //   \"actionType\": this.$route.params.id ? this.$route.query.type : 'new'\n                            // }\n                            //todo: match Cash Payment model\n                            this.cashPayment.paidOption = this.mPaymentOption;\n                            this.cashPayment.paidOptionText = this.mSupplier;\n                            this.cashPayment.itemLine = itemLines;\n                            this.cashPayment[\"jRaw\"] = this.jRaw;\n                            this.cashPayment[\"type\"] = TRANSACTION_TYPE;\n                            this.cashPayment.loggedUser = this.loggedUser;\n                            this.cashPayment[\"oldTotal\"] = this.oldTotal;\n                            this.cashPayment[\"isAutoGenerate\"] = isAutoGenerate;\n                            this.cashPayment[\"txnList\"] = this.txnList;\n                            this.cashPayment[\"transactionDateTZ\"] = Helper.toISODate(this.cashPayment.transactionDate);\n                            this.cashPayment[\"actionType\"] = this.$route.params.id\n                                ? this.$route.query.type\n                                : \"new\";\n                            this.cashPayment[\"loggedUser\"] = this.loggedUser;\n\n                            this.showLoading = false;\n                            // if(isPrint == true){\n                            //     this.clear();\n                            // }\n                            // window.console.log(this.cashPayment, 'cash Payment', isPrint)\n                            billingHandler.createCashPayment(this.cashPayment).then((response) => {\n                                if (response.data.statusCode === 201) {\n                                    // this.close(response.data.data)\n                                    this.showLoading = false;\n                                    this.$snotify.success(\"Successfully\");\n                                    if (isPrint == 'Print') {\n                                        getPrint(response.data.data);\n                                        this.clear();\n                                    } else if (isPrint == true) {\n                                        this.clear();\n                                    } else {\n                                        this.clear();\n                                        window.history.go(-1);\n                                    }\n                                }\n                            })\n                                .catch((e) => {\n                                    this.showLoading = false;\n                                    this.$snotify.error(\"Something went wrong\");\n                                    this.errors.push(e);\n                                });\n                        }\n                    }\n                }, 20);\n            });\n        },\n        _print() {\n            this.cashPayment[\"jRaw\"] = this.jRaw;\n            getPrint(this.cashPayment);\n        },\n        async loadCashPaymentView() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    this.itemLines = [];\n                    if (this.$route.params.id) {\n                        const strFilter = \"?id=\" + this.$route.params.id;\n                        billingHandler\n                            .txnCashPayment(strFilter)\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    const response = res.data.data;\n                                    if (response.length > 0) {\n                                        this.cashPayment = response[0];\n                                        this.referenceNo = this.cashPayment.referenceNo;\n                                        this.mSupplier = this.cashPayment.supplier;\n                                        this.oldTotal = this.cashPayment.total;\n                                        this.transactionDate = this.cashPayment.transactionDate\n                                        this.itemLines = response[0].itemLine;\n                                        if (this.cashPayment.hasOwnProperty(\"supplier\")) {\n                                            if (this.cashPayment.supplier.hasOwnProperty(\"name\")) {\n                                                this.name = this.cashPayment.supplier.name;\n                                            }\n                                        }\n                                    }\n                                }\n                            })\n                            .catch();\n                        {\n                            this.showLoading = false;\n                        }\n                    }\n                }, 10);\n            });\n        },\n        clear() {\n            this.id = undefined;\n            this.mSupplier = {}\n            this.cashPayment = new CashPaymentModel({});\n            let itemLineDS = this.$refs.itemLineDS.kendoWidget();\n            this.itemLines = itemLineDS.data([]);\n            this.cashPayment.transactionType = this.transactionTypes[0];\n            this.name = \"\"\n            this.requestPaymentList = []\n            this.generateNumber();\n        },\n        async loadOtherAccount() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    settingHandler\n                        .getOtherAccount()\n                        .then((res) => {\n                            if (res.data.statusCode === 200) {\n                                this.showLoading = false;\n                                const response = res.data.data;\n                                const data = response.filter(\n                                    (o) => o.banhjiAccCode === \"740010\"\n                                );\n                                window.console.log(data, \" this.gainLossAc\");\n                                if (data.length > 0) {\n                                    this.gainLossAcc = data[0].account;\n                                }\n                                const data_ = response.filter(\n                                    (o) => o.banhjiAccCode === \"740040\"\n                                );\n                                if (data_.length > 0) {\n                                    this.otherRevenueAcc = data_[0].account;\n                                }\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 10);\n            });\n        },\n        async loadRequestPayment() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const supplier = this.cashPayment.supplier || {}\n                    const supplierId = supplier.id || ''\n                    if (supplierId) {\n                        this.showLoading = true;\n                        const strFilter = \"?id=\" + supplierId + '&status=1';\n                        billingHandler.requestPaymentList(strFilter).then((res) => {\n                            if (res.data.statusCode === 200) {\n                                this.showLoading = false;\n                                this.requestPaymentList = res.data.data;\n                            } else {\n                                this.showLoading = false;\n                            }\n                        });\n                    }\n\n                }, 10);\n            });\n        },\n        async loadRequestPaymentLines() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const requestPayment = this.cashPayment.requestPayment || {}\n                    const reqId = requestPayment.id || ''\n                    if (reqId) {\n                        this.showLoading = true;\n                        const strFilter = \"?id=\" + reqId + '&detail=1';\n                        this.itemLines = []\n                        this.cashPayment.itemLine = []\n                        billingHandler.requestPaymentList(strFilter).then((res) => {\n                            if (res.data.statusCode === 200) {\n                                this.showLoading = false;\n                                this.itemLines = res.data.data;\n                                this.cashPayment.itemLine = this.itemLines\n                                // this.$refs.lineDS.kendoWidget().setDataSource(this.itemLines)\n                                // let dataSource = new kendo.data.DataSource({\n                                //     data: this.itemLine\n                                // });\n                                // let grid = $('#grid').data(\"kendoGrid\");\n                                // grid.setDataSource(dataSource);\n\n                                this.autoCalculate()\n                            } else {\n                                this.showLoading = false;\n                            }\n                        });\n                    }\n\n                }, 10);\n            });\n        },\n        async onPaymentRequestChange() {\n            this.isEdit = false\n            this.checked = true\n            const req = this.cashPayment.requestPayment || {}\n            if (req.id) {\n                await this.loadRequestPaymentLines()\n            } else {\n                this.itemLines = []\n                this.cashPayment.itemLine = []\n            }\n\n        },\n        onGridCashPayment() {\n            const grid = this.$refs.gridCashPayment.kendoWidget();\n            this.selectedExpenseIds = grid.selectedKeyNames();\n            this.autoCalculate();\n        },\n        dataBound: function () {\n            if (this.checked) {\n                $(\"#gridCashPayment tbody input:checkbox\").trigger(\"click\");\n                $(\"#gridCashPayment tbody input:checkbox\").prop(\"disabled\", true);\n                $(\".k-header input:checkbox\").prop(\"disabled\", true);\n            } else {\n                $(\"#gridCashPayment tbody input:checkbox\").prop(\"disabled\", false);\n                $(\".k-header input:checkbox\").prop(\"disabled\", false);\n            }\n        },\n    },\n    watch: {\n        id() {\n            if (this.$route.params.id === undefined) {\n                this.clear();\n                this.isView = false;\n            } else {\n                this.showLoading = true;\n                this.initData();\n                this.isView = true;\n            }\n        },\n    },\n    created() {\n        // fetch the data when the view is created and the data is\n        // already being observed\n        // this.loadObj()\n        this.loadPaymentOption();\n        this.loadOtherAccount();\n    },\n    mounted: async function () {\n        await this.loadPrefix();\n        await this.loadSaleFormContent();\n        this.loadData(0, this.filter, this.supBaseUrl);\n        await this.initGrid(this);\n        await this.initData();\n        if (this.$route.params.id === undefined) {\n\n            this.isView = false;\n        } else {\n\n            this.isView = true;\n        }\n    },\n    computed: {\n        disabledMe() {\n            return !!this.$route.params.id;\n        },\n        showMe() {\n            return this.mPaymentOption === \"Vendor\"; // or some other more complicated logic\n        },\n        enabled() {\n            return this.$route.params.id !== undefined;\n        },\n        hiddenButton() {\n            if (this.$route.query.type == \"edit\") {\n                return true\n            } else {\n                return false\n            }\n        }\n    },\n}\n</script>\n\n<style scoped>\n.k-dropdown {\n    width: 100%;\n    margin-top: 3px;\n}\n\n.function_wrapper {\n    box-shadow: none !important;\n}\n\n.v-application--is-ltr .v-text-field .v-input__append-inner {\n    margin-top: 0 !important;\n}\n\n.v-input__slot {\n    background-color: #fff !important;\n}\n\n.function_content .label {\n    margin-bottom: 10px;\n    display: inline-block;\n}\n\n.border_radius10 {\n    border-radius: 10px !important;\n    background-color: #f2f2f2;\n}\n\n.pa-3.v-card h4 {\n    font-size: 18px;\n    color: #333;\n}\n\n.pa-3.v-card p {\n    font-size: 12px;\n    color: #b5b5b5;\n}\n\n.attachment_file {\n    background-color: #efeded;\n    border-radius: 0 !important;\n}\n\n.attachment_table.v-data-table table {\n    border: thin solid rgba(0, 0, 0, 0.12);\n}\n\n.attachment_table table tr th {\n    border-left: thin solid rgba(0, 0, 0, 0.12);\n    height: 35px;\n    border-right: thin solid rgba(0, 0, 0, 0.12);\n}\n\n.block_debit,\n.block_credit {\n    border-bottom: 1px solid #fff;\n}\n\n.block_debit p.number,\n.block_credit p.number {\n    font-size: 25px;\n    color: #7f7f7f;\n}\n\n.block_debit h5,\n.block_credit h5,\n.block_difference h5 {\n    text-transform: uppercase;\n    color: #7f7f7f;\n    font-size: 15px;\n    font-weight: normal;\n}\n\n.block_difference h5 {\n    font-size: 18px;\n}\n\n.block_difference h5 span {\n    font-size: 15px;\n}\n\n.custom_grid table th:last-child {\n    text-align: right !important;\n}\n\n@media (min-width: 1264px) {\n    .container {\n        max-width: 1080px !important;\n    }\n}\n\n@media (max-width: 576px) {\n    .pt-6.col-sm-5.col-12 {\n        padding-top: 0 !important;\n    }\n\n    .code_text {\n        width: 100%;\n    }\n\n    .phone_no_pt {\n        padding-top: 0 !important;\n    }\n\n    .select_template,\n    .save_option {\n        margin-bottom: 10px;\n    }\n}\n\n.hide_small_bar_class {\n    max-width: 0;\n    transition: 0.5s ease-in;\n    flex: 0 0 0;\n}\n\n.hide_big_bar_class {\n    max-width: 100%;\n    transition: 0.5s ease-in;\n    flex: 0 0 100%;\n}\n\n.info_add {\n    background-color: #ffffff;\n}\n\n.small_sidebar {\n    height: 98%;\n    position: relative;\n    padding: 12px;\n    background-color: #edf1f5;\n}\n\n.iconArrow {\n    right: -35px;\n    position: absolute;\n    bottom: -10px;\n}\n\n.iconArrowHide {\n    position: absolute;\n    right: -7px;\n    bottom: -10px;\n}\n\n.color_grey {\n    color: #808080;\n}\n\n.card_green {\n    min-height: 70px;\n    background-color: #00b050 !important;\n    color: #ffffff;\n}\n\n.lb_bold {\n    font-size: 12px;\n}\n\n.detial_smallside_p {\n    position: absolute;\n    bottom: 10px;\n}\n\n.card_background {\n    background-color: #edf1f5;\n    min-height: 120px;\n}\n\n.deposite_input {\n    width: 100px;\n}\n\n.btn_save_draft {\n    color: #ffffff;\n    background-color: #00b0f0 !important;\n    text-transform: capitalize;\n}\n\n.save_option {\n    background-color: #203864 !important;\n}\n\n.btn_add_small {\n    height: 27px !important;\n    min-width: 25px !important;\n    font-size: 10px;\n    padding: 0 22px !important;\n    background-color: #00b050 !important;\n    color: #ffffff;\n    border-radius: 0 !important;\n}\n\n.list_site_inv {\n    background-color: #92d050;\n    color: #ffffff;\n    font-size: 12px;\n}\n\n.list_site_exp {\n    background-color: #c5e0b4;\n    color: #000000;\n    font-size: 12px;\n    line-height: 16px;\n    min-height: 40px;\n}\n\n.checkbox_inv {\n    padding: 2px;\n    margin-top: 3px;\n    margin-right: 2px;\n}\n\n.exp_select {\n    font-size: 12px !important;\n}\n\n.theme--light.v-data-table td {\n    border-bottom: 1px solid #808080;\n    border-top: 1px solid #808080;\n}\n\n.theme--light.v-data-table\n> .v-data-table__wrapper\n> table\n> tbody\n> tr:hover:not(.v-data-table__expanded__content):not(.v-data-table__empty-wrapper) {\n    background-color: transparent !important;\n}\n\n.b-search:before {\n    color: #fff !important;\n}\n</style>\n"]}]}