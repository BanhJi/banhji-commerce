{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/finances/RecordLoanReceipt.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/finances/RecordLoanReceipt.vue","mtime":1638499443233},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBrZW5kbyBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tdWknOwppbXBvcnQgTG9hZGluZ01lIGZyb20gIkAvY29tcG9uZW50cy9Mb2FkaW5nIjsKY29uc3QgeyBqb3VybmFsSGFuZGxlciB9ID0gcmVxdWlyZSgiQC9zY3JpcHRzL0FwcEhhbmRsZXJzIik7CmNvbnN0IHtFbnRpdHlUeXBlfSA9IHJlcXVpcmUoIkAvc2NyaXB0cy9kZWZhdWx0X3NldHVwL0NvbGxlY3Rpb25zIikKaW1wb3J0IHtKb3VybmFsTW9kZWwsIEpvdXJuYWxFbnRyeU1vZGVsLCBMb2FuRGV0YWlsTW9kZWx9IGZyb20gIkAvc2NyaXB0cy9tb2RlbC9BcHBNb2RlbHMiOwppbXBvcnQge2FjY291bnRIYW5kbGVyLCBwcmVmaXhIYW5kbGVyfSBmcm9tICJAL3NjcmlwdHMvQXBwSGFuZGxlcnMiOwppbXBvcnQgRGF0ZVBpY2tlckNvbXBvbmVudCBmcm9tICJAL2NvbXBvbmVudHMvY3VzdG9tX3RlbXBsYXRlcy9EYXRlUGlja2VyQ29tcG9uZW50IjsKaW1wb3J0IEhlbHBlciBmcm9tICJAL2hlbHBlci5qcyI7CmNvbnN0IGJpbGxpbmdIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2ludm9pY2UvaGFuZGxlci9iaWxsaW5nSGFuZGxlciIpOwpjb25zdCBMb2FuVHlwZSA9IHJlcXVpcmUoIkAvc2NyaXB0cy9kZWZhdWx0X3NldHVwL0xvYW5UeXBlLmpzIik7CmNvbnN0ICQgPSBrZW5kby5qUXVlcnkKaW1wb3J0IFJlY29yZExvYW5SZWNlaXB0IGZyb20gIkAvc2NyaXB0cy9maW5hbmNpbmcvbW9kZWwvUmVjb3JkTG9hblJlY2VpcHQiCmltcG9ydCBjdXJyZW5jeUhhbmRsZXIgZnJvbSAiQC9zY3JpcHRzL2N1cnJlbmN5L2hhbmRsZXIvY3VycmVuY3lIYW5kbGVyIjsKLy8gaW1wb3J0IGJpbGxpbmdIYW5kbGVyIGZyb20gIkAvc2NyaXB0cy9pbnZvaWNlL2hhbmRsZXIvYmlsbGluZ0hhbmRsZXIiOwpjb25zdCBsb2FuSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9maW5hbmNpbmcvaGFuZGxlci9sb2FuSGFuZGxlciIpCgpleHBvcnQgZGVmYXVsdCB7CiAgICBuYW1lOiAiUmVjb3JkTG9hblJlY2VpcHQiLAogICAgY29tcG9uZW50czogewogICAgICAgIExvYWRpbmdNZSwKICAgICAgICAiYXBwLWRhdGVwaWNrZXIiOiBEYXRlUGlja2VyQ29tcG9uZW50LAogICAgfSwKICAgIHByb3BzOiB7CiAgICAgICAgaW5pdExvYW46IHt9LAogICAgfSwKICAgIGRhdGE6ICgpID0+ICh7CiAgICAgICAgLyogT2JqICovCiAgICAgICAgYWNjb3VudExvYWRpbmc6IGZhbHNlLAogICAgICAgIGxvYW46IHt9LAogICAgICAgIGpvdXJuYWw6IHt9LAogICAgICAgIGpvdXJuYWxFbnRyaWVzOiBbXSwKICAgICAgICBsb2FuRGV0YWlsOiB7fSwKICAgICAgICAvLyBGb3JtIHZhbGlkYXRpb24KICAgICAgICB2YWxpZDogdHJ1ZSwKICAgICAgICBpc0VkaXQ6IGZhbHNlLAogICAgICAgIHNhdmVNb2RlOiAnJywKICAgICAgICBhbGVydDogZmFsc2UsCiAgICAgICAgZXJyb3JNZXNzYWdlOiAnJywKICAgICAgICB1c2VyOiBIZWxwZXIuZ2V0VXNlcigpLAogICAgICAgIC8vIExvYWRpbmdNZQogICAgICAgIGNvbXBlbGV0TG9hZGluZzogZmFsc2UsCiAgICAgICAgbG9hZGluZ0FsZXJ0OiBmYWxzZSwKICAgICAgICBsb2FkaW5nQ29sb3JBbGVydDogIiIsCiAgICAgICAgbG9hZGluZ1RleHRBbGVydDogIiIsCiAgICAgICAgLy8gT3RoZXIKICAgICAgICB0b3RhbEFtb3VudDogMCwKICAgICAgICBhY2NvdW50czogW10sCiAgICAgICAgY2FzaEJhbmtBY2NvdW50RW50cmllczogW10sCiAgICAgICAgcmVsYXRlZENvc3RFbnRyaWVzOiBbXSwKICAgICAgICB0cmFuc2FjdGlvblR5cGU6IHt9LAogICAgICAgIHI6IG5ldyBSZWNvcmRMb2FuUmVjZWlwdCh7fSksCiAgICAgICAgZXhwZW5zZUFjY291bnRzOiBbXSwKICAgICAgICBiYW5rQWNjb3VudHM6IFtdLAogICAgICAgIGVycm9yczogW10sCiAgICAgICAgZXhjaGFuZ2VSYXRlOiB7fSwKICAgICAgICBqb3VybmFsTnVtYmVyOiAnJywKICAgICAgICBqb3VybmFsUHJlZml4OiAnJywKICAgICAgICBqb3VybmFsVHhuVHlwZTogRW50aXR5VHlwZS5KT1VSTkFMLAogICAgICAgIHN1ZmZpeDogJycKICAgIH0pLAogICAgbWV0aG9kczogewogICAgICAgIC8qIFNldCBEZWZhdWx0IERhdGEgKi8KICAgICAgICBhc3luYyBzZXREZWZhdWx0RGF0YSgpIHsKICAgICAgICAgICAgdGhpcy5yID0gbmV3IFJlY29yZExvYW5SZWNlaXB0KHt9KQogICAgICAgICAgICB0aGlzLnJlbGF0ZWRDb3N0RW50cmllcyA9IFtdCiAgICAgICAgICAgIHRoaXMuY2FzaEJhbmtBY2NvdW50RW50cmllcyA9IFtdCiAgICAgICAgICAgIC8vIGxldCBiYW5rRFMgPSB0aGlzLiRyZWZzLmNhc2hCYW5rQWNjb3VudERTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgIC8vIGJhbmtEUy5kYXRhKCkuZm9yRWFjaChlbGVtZW50ID0+IHsKICAgICAgICAgICAgLy8gICAgIGJhbmtEUy5yZW1vdmUoZWxlbWVudCkKICAgICAgICAgICAgLy8gfSkKICAgICAgICAgICAgLy8gbGV0IHJlbGF0ZWRDb3N0RFMgPSB0aGlzLiRyZWZzLnJlbGF0ZWRDb3N0RFMua2VuZG9XaWRnZXQoKTsKICAgICAgICAgICAgLy8gcmVsYXRlZENvc3REUy5kYXRhKCkuZm9yRWFjaChlbGVtZW50ID0+IHsKICAgICAgICAgICAgLy8gICAgIHJlbGF0ZWRDb3N0RFMucmVtb3ZlKGVsZW1lbnQpCiAgICAgICAgICAgIC8vIH0pCiAgICAgICAgICAgIHRoaXMubG9hZFByZWZpeCgpOwogICAgICAgICAgICB0aGlzLmxvYWRUcmFuc2FjdGlvblJhdGUoKQogICAgICAgICAgICB0aGlzLmdldEpvdXJuYWxOdW1iZXIoKQogICAgICAgIH0sCiAgICAgICAgb25HZW5lcmF0ZU51bWJlckNsaWNrZWQoKSB7CiAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVOdW1iZXIoKTsKICAgICAgICB9LAogICAgICAgIC8vIE51bWJlcgogICAgICAgIC8vIGdlbmVyYXRlTnVtYmVyKCkgewogICAgICAgIC8vICAgICB0aGlzLmpvdXJuYWwubnVtYmVyID0gbmV3IERhdGUoKS5nZXRUaW1lKCkKICAgICAgICAvLyB9LAogICAgICAgIC8qIEF1dG8gQ2FsY3VsYXRlICovCiAgICAgICAgYXV0b0NhbGN1bGF0ZSgpIHsKICAgICAgICAgICAgbGV0IGNiYURTID0gdGhpcy4kcmVmcy5jYXNoQmFua0FjY291bnREUy5rZW5kb1dpZGdldCgpLAogICAgICAgICAgICAgICAgcmNEUyA9IHRoaXMuJHJlZnMucmVsYXRlZENvc3REUy5rZW5kb1dpZGdldCgpLAogICAgICAgICAgICAgICAgdG90YWwgPSAwOwogICAgICAgICAgICB0b3RhbCA9IHBhcnNlRmxvYXQodGhpcy5sb2FuLmFwcHJvdmVkQW1vdW50KQoKICAgICAgICAgICAgcmNEUy5kYXRhKCkuZm9yRWFjaCh2YWx1ZSA9PiB7CiAgICAgICAgICAgICAgICB0b3RhbCAtPSB2YWx1ZS5hbW91bnQ7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjYmFEUy5kYXRhKCkuZm9yRWFjaCh2YWx1ZSA9PiB7CiAgICAgICAgICAgICAgICB2YWx1ZS5hbW91bnQgPSB0b3RhbAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKGNiYURTLmRhdGEoKSwgJ2RhdGEnKQogICAgICAgICAgICB0aGlzLnRvdGFsQW1vdW50ID0gdG90YWwKICAgICAgICB9LAogICAgICAgIG9uRHJHcmlkRGF0YVNvdXJjZUNoYW5nZWQoKSB7CiAgICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpOwogICAgICAgIH0sCiAgICAgICAgb25DckdyaWREYXRhU291cmNlQ2hhbmdlZCgpIHsKICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlKCk7CiAgICAgICAgfSwKICAgICAgICBvbkFkZFJvd0Nhc2hCYW5rQWNjb3VudENsaWNrZWQoKSB7CiAgICAgICAgICAgIHRoaXMuYWRkUm93KHRoaXMuJHJlZnMuY2FzaEJhbmtBY2NvdW50RFMua2VuZG9XaWRnZXQoKSk7CiAgICAgICAgfSwKICAgICAgICBvbkFkZFJvd1JlbGF0ZWRDb3N0Q2xpY2tlZCgpIHsKICAgICAgICAgICAgdGhpcy5hZGRSb3codGhpcy4kcmVmcy5yZWxhdGVkQ29zdERTLmtlbmRvV2lkZ2V0KCkpOwogICAgICAgIH0sCiAgICAgICAgY2FzaEJhbmtBY2NvdW50Um93TnVtYmVyVG1wbChkYXRhSXRlbSkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLmNhc2hCYW5rQWNjb3VudERTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICBpbmRleCA9IGRzLmluZGV4T2YoZGF0YUl0ZW0pCiAgICAgICAgICAgIHJldHVybiBpbmRleCArIDEKICAgICAgICB9LAogICAgICAgIHJlbGF0ZWRDb3N0Um93TnVtYmVyVG1wbChkYXRhSXRlbSkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLnJlbGF0ZWRDb3N0RFMua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIGluZGV4ID0gZHMuaW5kZXhPZihkYXRhSXRlbSkKICAgICAgICAgICAgcmV0dXJuIGluZGV4ICsgMQogICAgICAgIH0sCiAgICAgICAgYWRkUm93KGdyaWREYXRhU291cmNlKSB7CiAgICAgICAgICAgIGxldCBsYXN0ID0gZ3JpZERhdGFTb3VyY2UudG90YWwoKTsKICAgICAgICAgICAgbGV0IGplID0gbmV3IEpvdXJuYWxFbnRyeU1vZGVsKCk7CiAgICAgICAgICAgIGdyaWREYXRhU291cmNlLmluc2VydChsYXN0LCBqZSk7CiAgICAgICAgfSwKICAgICAgICBhZGRSb3dUKGdyaWREYXRhU291cmNlKSB7CiAgICAgICAgICAgIGxldCBsYXN0ID0gZ3JpZERhdGFTb3VyY2UudG90YWwoKTsKICAgICAgICAgICAgbGV0IGplID0gbmV3IEpvdXJuYWxFbnRyeU1vZGVsKCk7CiAgICAgICAgICAgIGplLmFtb3VudCA9IHRoaXMubG9hbi5hcHByb3ZlZEFtb3VudAogICAgICAgICAgICBncmlkRGF0YVNvdXJjZS5pbnNlcnQobGFzdCwgamUpOwogICAgICAgIH0sCiAgICAgICAgLy8gR3JpZCBDdXN0b20gRWRpdG9yCiAgICAgICAgY2FzaEFjY291bnRFZGl0b3IoY29udGFpbmVyLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGtlbmRvLmpRdWVyeSgnPGlucHV0IHJlcXVpcmVkIG5hbWU9IicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgICAgICAgICAgICBhdXRvQmluZDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogInN0YXJ0c3dpdGgiLAogICAgICAgICAgICAgICAgICAgIGRhdGFUZXh0RmllbGQ6ICJuYW1lIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogIm5hbWUiLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAiPHNwYW4+Iz1udW1iZXIjICM9bmFtZSM8L3NwYW4+IiwKICAgICAgICAgICAgICAgICAgICBvcHRpb25MYWJlbDogIi0tLSBTZWxlY3QgLS0tIiwKICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlOiBuZXcga2VuZG8uZGF0YS5EYXRhU291cmNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogdGhpcy5iYW5rQWNjb3VudHMsCiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZDogImFjY291bnRfdHlwZS5uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBhcmU6IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gT3JkZXIgYnkgbnVtYmVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEuaXRlbXNbMF0ubnVtYmVyID09PSBiLml0ZW1zWzBdLm51bWJlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGEuaXRlbXNbMF0ubnVtYmVyID4gYi5pdGVtc1swXS5udW1iZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGV4cGVuc2VBY2NvdW50RWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kby5qUXVlcnkoJzxpbnB1dCByZXF1aXJlZCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGF1dG9XaWR0aDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDQwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXI6ICJzdGFydHN3aXRoIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVGV4dEZpZWxkOiAibmFtZSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlRmllbGQ6ICJuYW1lIiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9bnVtYmVyIyAjPW5hbWUjPC9zcGFuPiIsCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6ICItLS0gU2VsZWN0IC0tLSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZTogbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHRoaXMuZXhwZW5zZUFjY291bnRzLAogICAgICAgICAgICAgICAgICAgICAgICBncm91cDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQ6ICJhY2NvdW50X3R5cGUubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wYXJlOiBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE9yZGVyIGJ5IG51bWJlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLml0ZW1zWzBdLm51bWJlciA9PT0gYi5pdGVtc1swXS5udW1iZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhLml0ZW1zWzBdLm51bWJlciA+IGIuaXRlbXNbMF0ubnVtYmVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICAvKiBBZGQgTG9hbiBEZXRhaWwgKi8KICAgICAgICBhZGRMb2FuRGV0YWlsKCkgewogICAgICAgICAgICB0aGlzLmxvYW5EZXRhaWwgPSBuZXcgTG9hbkRldGFpbE1vZGVsKHsKICAgICAgICAgICAgICAgIGpvdXJuYWxfdXVpZDogdGhpcy5qb3VybmFsLnV1aWQsCiAgICAgICAgICAgICAgICBhY2NvdW50X3V1aWQ6IHRoaXMubG9hbi5sb2FuQWNjb3VudC51dWlkLAogICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuam91cm5hbC5kZXNjcmlwdGlvbiwKICAgICAgICAgICAgICAgIGFtb3VudDogdGhpcy50b3RhbEFtb3VudCwKICAgICAgICAgICAgICAgIGRhdGU6IEhlbHBlci50b0lTT0RhdGUodGhpcy5yLmlzc3VlZERhdGUpLAogICAgICAgICAgICAgICAgdHhuX3R5cGU6IExvYW5UeXBlLlJFQ0lFUFQsCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkVHJhbnNhY3Rpb25SYXRlKCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUodGhpcy5yLmlzc3VlZERhdGUpLnRvSVNPU3RyaW5nKCkuc3Vic3RyKDAsIDEwKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2RlID0gdGhpcy5sb2FuLmN1cnJlbmN5LmNvZGUKICAgICAgICAgICAgICAgICAgICBpZiAoY29kZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lIYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0TGFzdEV4Y2hhbmdlUmF0ZUJ5RGF0ZShkYXRlLCBjb2RlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV4Y2hhbmdlUmF0ZSA9IHJlcy5kYXRhLmRhdGFbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIC8qIEFkZCBKb3VybmFsICovCiAgICAgICAgYWRkSm91cm5hbCgpIHsKICAgICAgICAgICAgbGV0IGVudHJpZXMgPSBbXTsKCiAgICAgICAgICAgIC8vIENhc2ggQmFuayBBY2NvdW50IG9uIERyCiAgICAgICAgICAgIGxldCBjYXNoQmFua0FjY3REUyA9IHRoaXMuJHJlZnMuY2FzaEJhbmtBY2NvdW50RFMua2VuZG9XaWRnZXQoKTsKICAgICAgICAgICAgY2FzaEJhbmtBY2N0RFMuZGF0YSgpLmZvckVhY2goZWxlbWVudCA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5hbW91bnQgIT0gMCkgewogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuY3VycmVuY3kgPSB0aGlzLmxvYW4uY3VycmVuY3k7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5leGNoYW5nZV9yYXRlID0gcGFyc2VGbG9hdCh0aGlzLmV4Y2hhbmdlUmF0ZS5yYXRlKTsgLy8gV2lsbCBjaGFuZ2UgbGF0ZXIKICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmV4Y2hhbmdlZF9hbW91bnQgPSBlbGVtZW50LmFtb3VudCAqIHBhcnNlRmxvYXQodGhpcy5leGNoYW5nZVJhdGUucmF0ZSk7CiAgICAgICAgICAgICAgICAgICAgZW50cmllcy5wdXNoKGVsZW1lbnQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIFJlbGF0ZWQgQ29zdCBvbiBEcgogICAgICAgICAgICBsZXQgcmVsYXRlZENvc3REUyA9IHRoaXMuJHJlZnMucmVsYXRlZENvc3REUy5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICByZWxhdGVkQ29zdERTLmRhdGEoKS5mb3JFYWNoKGVsZW1lbnQgPT4gewogICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuYW1vdW50ICE9IDApIHsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmN1cnJlbmN5ID0gdGhpcy5sb2FuLmN1cnJlbmN5OwogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZXhjaGFuZ2VfcmF0ZSA9IHBhcnNlRmxvYXQodGhpcy5leGNoYW5nZVJhdGUucmF0ZSk7IC8vIFdpbGwgY2hhbmdlIGxhdGVyCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5leGNoYW5nZWRfYW1vdW50ID0gZWxlbWVudC5hbW91bnQgKiBwYXJzZUZsb2F0KHRoaXMuZXhjaGFuZ2VSYXRlLnJhdGUpOwogICAgICAgICAgICAgICAgICAgIGVudHJpZXMucHVzaChlbGVtZW50KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBMb2FuIEFjY291bnQgb24gQ3IKICAgICAgICAgICAgbGV0IGxvYW5FbnRyeSA9IG5ldyBKb3VybmFsRW50cnlNb2RlbCh7CiAgICAgICAgICAgICAgICBhY2NvdW50OiB0aGlzLmxvYW4ubG9hbkFjY291bnQsCiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5qb3VybmFsLmRlc2NyaXB0aW9uLAogICAgICAgICAgICAgICAgYW1vdW50OiB0aGlzLmxvYW4uYXBwcm92ZWRBbW91bnQgKiAtMSwKICAgICAgICAgICAgICAgIGN1cnJlbmN5OiB0aGlzLmxvYW4uY3VycmVuY3ksCiAgICAgICAgICAgICAgICBleGNoYW5nZV9yYXRlOiBwYXJzZUZsb2F0KHRoaXMuZXhjaGFuZ2VSYXRlLnJhdGUpLCAvLyBXaWxsIGNoYW5nZSBsYXRlcgogICAgICAgICAgICAgICAgZXhjaGFuZ2VkX2Ftb3VudDogcGFyc2VGbG9hdCh0aGlzLmxvYW4uYXBwcm92ZWRBbW91bnQpICogcGFyc2VGbG9hdCh0aGlzLmV4Y2hhbmdlUmF0ZS5yYXRlKSwKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGVudHJpZXMucHVzaChsb2FuRW50cnkpOwogICAgICAgICAgICB0aGlzLmpvdXJuYWxFbnRyaWVzID0gZW50cmllczsKICAgICAgICB9LAogICAgICAgIHNocmlua0RhdGEoKSB7CiAgICAgICAgICAgIC8vIE51bWJlciBjb21iaW5lIGFiYnIgKyBudW1iZXIKICAgICAgICAgICAgLy8gdGhpcy5qb3VybmFsLm51bWJlciA9IHRoaXMuam91cm5hbC5hYmJyICsgJy0nICsgdGhpcy5qb3VybmFsLm51bWJlcgoKICAgICAgICAgICAgLy8gSm91cm5hbCBEYXRlCiAgICAgICAgICAgIHRoaXMuam91cm5hbC5qb3VybmFsX2RhdGUgPSBIZWxwZXIudG9JU09EYXRlKHRoaXMuci5pc3N1ZWREYXRlKQoKICAgICAgICAgICAgLy8gTG9hbiBBY3RpdmUgRGF0ZQogICAgICAgICAgICB0aGlzLmxvYW4ucmVjZWlwdERhdGUgPSBIZWxwZXIudG9JU09EYXRlKHRoaXMuci5pc3N1ZWREYXRlKQoKICAgICAgICAgICAgLy8gVXNlcgogICAgICAgICAgICBpZiAodGhpcy5pc0VkaXQpIHsKICAgICAgICAgICAgICAgIHRoaXMuam91cm5hbC5tb2RpZmllZF9ieSA9IHRoaXMudXNlcgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5qb3VybmFsLmNyZWF0ZWRfYnkgPSB0aGlzLnVzZXIKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgLy8gVmFsaWRhdGluZwogICAgICAgIHZhbGlkYXRlRm9ybSgpIHsKICAgICAgICAgICAgbGV0IHJlc3VsdCA9IHRydWUsCiAgICAgICAgICAgICAgICBtc2cgPSAnJwoKICAgICAgICAgICAgLy8gVG90YWwgQW1vdW50CiAgICAgICAgICAgIC8vIGlmICh0aGlzLmxvYW4uYXBwcm92ZWRfYW1vdW50ICE9PSB0aGlzLnRvdGFsQW1vdW50KSB7CiAgICAgICAgICAgIC8vICAgICBtc2cgKz0gJzxwPicgKyB0aGlzLiRpMThuLnQoJ1RvdGFsIEFtb3VudCBlcXVhbCB0byBBcHByb3ZlZCBBbW91bnQnKSArICc8L3A+JwogICAgICAgICAgICAvLyAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICAgIC8vIH0KCiAgICAgICAgICAgIC8vIC8vIFNlbGVjdCBBY2NvdW50IGFuZCBBbW91bnQKICAgICAgICAgICAgLy8gbGV0IHBsZWFzZV9zZWxlY3RfYWNjb3VudF9saW5lID0gdGhpcy4kaTE4bi50KCdwbHNfc2VsZWN0X2FjY19saW5lJykKICAgICAgICAgICAgY29uc3QgYmFuZCA9ICQoIiNjYXNoQmFua0FjY291bnRHcmlkIikuZGF0YSgia2VuZG9HcmlkIiksCiAgICAgICAgICAgICAgICBiZGF0YSA9IGJhbmQuZGF0YVNvdXJjZQogICAgICAgICAgICBiZGF0YS5kYXRhKCkuZm9yRWFjaChtID0+IHsKICAgICAgICAgICAgICAgIGlmIChtLmFjY291bnQudXVpZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgbXNnICs9IHRoaXMuJGkxOG4udCgncGxzX3NlbGVjdF9hY2NfbGluZScpCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyhkYXRhU291cmNlLCBtc2cpCiAgICAgICAgICAgIC8vIAkvLyBObyBBY2NvdW50CiAgICAgICAgICAgIC8vIAlpZih2YWx1ZS5hY2NvdW50Lm51bWJlciA9PT0gJycgJiYgdmFsdWUuYW1vdW50ICE9PSAwKXsKICAgICAgICAgICAgLy8gCQlsZXQgcm93SW5kZXggPSBpbmRleCArIDEKICAgICAgICAgICAgLy8gCQltc2cgKz0gJzxwPicgKyBwbGVhc2Vfc2VsZWN0X2FjY291bnRfbGluZSArIHJvd0luZGV4LnRvU3RyaW5nKCkgKyAnPC9wPicKICAgICAgICAgICAgLy8gCQlyZXN1bHQgPSBmYWxzZQogICAgICAgICAgICAvLyAJfQoKICAgICAgICAgICAgLy8gCS8vIENvdW50IEVtcHR5IFJvdwogICAgICAgICAgICAvLyAJaWYodmFsdWUuYWNjb3VudC5udW1iZXIgPT09ICcnICYmIHZhbHVlLmFtb3VudCA9PT0gMCl7CiAgICAgICAgICAgIC8vIAkJY291bnRFbXB0eSsrCiAgICAgICAgICAgIC8vIAl9CiAgICAgICAgICAgIC8vIH0pCgogICAgICAgICAgICAvLyAvLyBFbXB0eSBSb3cKICAgICAgICAgICAgLy8gaWYoY291bnRFbXB0eSA9PT0gY2FzaEJhbmtBY2NvdW50RFMudG90YWwoKSl7CiAgICAgICAgICAgIC8vIAltc2cgKz0gJzxwPicgKyB0aGlzLiRpMThuLnQoJ3BsZWFzZV9hY2Nfb3RfcmVjb3JkJykgKyAnPC9wPicKICAgICAgICAgICAgLy8gCXJlc3VsdCA9IGZhbHNlOwogICAgICAgICAgICAvLyB9CgogICAgICAgICAgICAvLyBTaG93IEFsZXJ0CiAgICAgICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gbXNnOwogICAgICAgICAgICB0aGlzLmFsZXJ0ID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICB0aGlzLmFsZXJ0ID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9LAogICAgICAgIC8vIEFsbCBTYXZlcwogICAgICAgIG9uU2F2ZU9wdGlvbkNsaWNrKG1vZGUpIHsKICAgICAgICAgICAgaWYgKHRoaXMuJHJlZnMuZm9ybS52YWxpZGF0ZSgpICYmIHRoaXMudmFsaWRhdGVGb3JtKCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2F2ZU1vZGUgPSBtb2RlCiAgICAgICAgICAgICAgICB0aGlzLnNhdmUoKQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5hbGVydEVycm9yKCkKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgY2FuY2VsKCkgewogICAgICAgICAgICB0aGlzLiRzd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiAnQXJlIHlvdSBzdXJlPycsCiAgICAgICAgICAgICAgICB0ZXh0OiAiWW91IHdvbid0IGJlIGFibGUgdG8gcmV2ZXJ0IHRoaXMhIiwKICAgICAgICAgICAgICAgIGljb246ICd3YXJuaW5nJywKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICcjNGQ0ODQ4JywKICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAnI0VEMUEzQScsCiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ1llcywgZGlzY2FyZCBpdCEnCiAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXIoKQogICAgICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5nbygtMSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIGNsZWFyKCkgewogICAgICAgICAgICAvLyBSZXNldCBGb3JtCiAgICAgICAgICAgIC8vIHRoaXMuJHJlZnMuZm9ybS5yZXNldCgpOwoKICAgICAgICAgICAgdGhpcy50b3RhbEFtb3VudCA9IDA7CiAgICAgICAgICAgIHRoaXMuY2FzaEJhbmtBY2NvdW50RW50cmllcyA9IFtdOwogICAgICAgICAgICB0aGlzLnJlbGF0ZWRDb3N0RW50cmllcyA9IFtdOwoKICAgICAgICAgICAgLy8gU2V0IGRlZmF1bHQgZGF0YQogICAgICAgICAgICB0aGlzLnNldERlZmF1bHREYXRhKCkKICAgICAgICB9LAogICAgICAgIHJlbW92ZUVtcHR5TGluZSgpIHsKICAgICAgICAgICAgbGV0IHJlbGF0ZWRDb3N0RFMgPSB0aGlzLiRyZWZzLnJlbGF0ZWRDb3N0RFMua2VuZG9XaWRnZXQoKTsKICAgICAgICAgICAgaWYocmVsYXRlZENvc3REUy5kYXRhKCkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgcmVsYXRlZENvc3REUy5kYXRhKCkuZm9yRWFjaChlbGVtZW50ID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuYWNjb3VudC51dWlkID09PSB1bmRlZmluZWQgfHwgZWxlbWVudC5hY2NvdW50LnV1aWQgPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbGF0ZWRDb3N0RFMucmVtb3ZlKGVsZW1lbnQpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRlZENvc3REUy5yZW1vdmUoZWxlbWVudCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzYXZlKCkgewogICAgICAgICAgICBsZXQgYmFua0RTID0gdGhpcy4kcmVmcy5jYXNoQmFua0FjY291bnREUy5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICBiYW5rRFMuZGF0YSgpLmZvckVhY2goZWxlbWVudCA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5hY2NvdW50LnV1aWQgPT09IHVuZGVmaW5lZCB8fCBlbGVtZW50LmFjY291bnQudXVpZCA9PSAnJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoJ1BsZWFzZSBzZWxlY3QgYSBDYXNoL0JhbmsgYWNjb3VudCcpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCgogICAgICAgICAgICAvLyBsZXQgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHRoaXMucmVtb3ZlRW1wdHlMaW5lKCkKICAgICAgICAgICAgLy8gU2hyaW5rIERhdGEKICAgICAgICAgICAgdGhpcy5zaHJpbmtEYXRhKCk7CgogICAgICAgICAgICAvLyBBZGQgTG9hbiBEZXRhaWwKICAgICAgICAgICAgdGhpcy5hZGRMb2FuRGV0YWlsKCk7CgogICAgICAgICAgICAvLyBBZGQgSm91cm5hbAogICAgICAgICAgICB0aGlzLmFkZEpvdXJuYWwoKTsKCiAgICAgICAgICAgIC8vIFN5bmMgRGF0YQogICAgICAgICAgICB0aGlzLmpvdXJuYWwuam91cm5hbF9lbnRyaWVzID0gdGhpcy5qb3VybmFsRW50cmllcwogICAgICAgICAgICB0aGlzLmFjY291bnRMb2FkaW5nID0gdHJ1ZQogICAgICAgICAgICBsZXQgc2VsZiA9IHRoaXMKICAgICAgICAgICAgbGV0IHJlbGF0ZWRDb3N0RFMgPSB0aGlzLiRyZWZzLnJlbGF0ZWRDb3N0RFMua2VuZG9XaWRnZXQoKTsKICAgICAgICAgICAgdGhpcy5yLmxvYW4gPSB0aGlzLmxvYW4KICAgICAgICAgICAgdGhpcy5qb3VybmFsLmN1cnJlbmN5X2NvZGUgPSB0aGlzLmxvYW4uY3VycmVuY3kuY29kZQogICAgICAgICAgICAvLyB0aGlzLmpvdXJuYWwubnVtYmVyID0gdGhpcy5qb3VybmFsTnVtYmVyCiAgICAgICAgICAgIHRoaXMuam91cm5hbC5wcmVmaXhfZm9ybWF0ID0gdGhpcy5qb3VybmFsUHJlZml4CiAgICAgICAgICAgIGlmKHRoaXMubG9hbi5oYXNPd25Qcm9wZXJ0eSgnc2VnbWVudCcpKXsKICAgICAgICAgICAgICAgIHRoaXMuam91cm5hbC5zZWdtZW50X3V1aWQgPSB0aGlzLmxvYW4uc2VnbWVudC5pZAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKHRoaXMubG9hbi5oYXNPd25Qcm9wZXJ0eSgnbG9jYXRpb24nKSl7CiAgICAgICAgICAgICAgICB0aGlzLmpvdXJuYWwubG9jYXRpb25fdXVpZCA9IHRoaXMubG9hbi5sb2NhdGlvbi5pZAogICAgICAgICAgICB9CiAgICAgICAgICAgIGpvdXJuYWxIYW5kbGVyLnNhdmUobmV3IEpvdXJuYWxNb2RlbCh0aGlzLmpvdXJuYWwpKQogICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yLmpvdXJuYWxJZCA9IHJlc3BvbnNlID8gcmVzcG9uc2UuZGF0YS51dWlkIDogJycKICAgICAgICAgICAgICAgICAgICBzZWxmLnIuam91cm5hbCA9IEpTT04uc3RyaW5naWZ5KHNlbGYuam91cm5hbCkKICAgICAgICAgICAgICAgICAgICBzZWxmLnIudXNlciA9IHNlbGYudXNlcgogICAgICAgICAgICAgICAgICAgIHNlbGYuci5leGNoYW5nZVJhdGUgPSBzZWxmLmV4Y2hhbmdlUmF0ZQogICAgICAgICAgICAgICAgICAgIHNlbGYuci5jYXNoSXRlbUxpbmUgPSBiYW5rRFMuZGF0YSgpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5yLnJlbGF0ZUNvc3RJdGVtTGluZSA9IHJlbGF0ZWRDb3N0RFMuZGF0YSgpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5yLnJlY2VpdmVkQW1vdW50ID0gc2VsZi50b3RhbEFtb3VudAogICAgICAgICAgICAgICAgICAgIGxvYW5IYW5kbGVyLmxvYW5SZWNlaXB0Q3JlYXRlKG5ldyBSZWNvcmRMb2FuUmVjZWlwdChzZWxmLnIpKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hY2NvdW50TG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi4kc25vdGlmeS5zdWNjZXNzKCdTdWNjZXNzZnVsbHknKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lmhpc3RvcnkuZ28oLTEpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuJHNub3RpZnkuZXJyb3IoJ1NvbWV0aGluZyB3ZW50IHdyb25nJykKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5lcnJvcnMucHVzaChlKQogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coZSwgJ2Vycm9yJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICBIZWxwZXIuYWxlcnRFcnJvck1zZyhlcnJvcik7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmZpbmFsbHkoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHNlbGYuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgLy8gUmVzcG9uc2UgU3RhdHVzCiAgICAgICAgcmVzcG9uc2VTdGF0dXMoc3RhdHVzKSB7CiAgICAgICAgICAgIHN3aXRjaCAoc3RhdHVzKSB7CiAgICAgICAgICAgICAgICBjYXNlIDIwMDovLyBPawogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0FsZXJ0KCkKCiAgICAgICAgICAgICAgICAgICAgLy8gUmVzZXQgdG8gZGVmYXVsdCBkYXRhCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhcigpOwoKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgY2FzZSAyMDE6Ly8gRHVwbGljYXRlCiAgICAgICAgICAgICAgICAgICAgdGhpcy5hbGVydEVycm9yKCdEdXBsaWNhdGUgZW50cnkhJykKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAvLyBTd2VldGFsZXJ0MgogICAgICAgIGNoYW5nZUFsZXJ0U3RhdHVzKCkgewogICAgICAgICAgICB0aGlzLmxvYWRpbmdBbGVydCA9IHRydWUKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRpbmdBbGVydCA9IGZhbHNlCiAgICAgICAgICAgIH0sIDYyMDApOwogICAgICAgIH0sCiAgICAgICAgc2hvd0FsZXJ0KCkgewogICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgdGhpcy5jaGFuZ2VBbGVydFN0YXR1cygpCiAgICAgICAgICAgIHRoaXMubG9hZGluZ1RleHRBbGVydCA9ICJBZGRlZCBTdWNjZXNzZnVsIgogICAgICAgICAgICB0aGlzLmxvYWRpbmdDb2xvckFsZXJ0ID0gIiMzREE3MkUiCiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5zYXZlTW9kZSkgewogICAgICAgICAgICAgICAgY2FzZSAnc2F2ZUNsb3NlJzovLyBTYXZlIENsb3NlCiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy4kc3dhbCh7CiAgICAgICAgICAgICAgICAgICAgLy8gCXBvc2l0aW9uOiAncHJvZHVjdHMnLAogICAgICAgICAgICAgICAgICAgIC8vIAlpY29uOiAnc3VjY2VzcycsCiAgICAgICAgICAgICAgICAgICAgLy8gCXRpdGxlOiAnWW91ciB3b3JrIGhhcyBiZWVuIHNhdmVkJywKICAgICAgICAgICAgICAgICAgICAvLyAJc2hvd0NvbmZpcm1CdXR0b246IHRydWUsCiAgICAgICAgICAgICAgICAgICAgLy8gfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8gCWlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAvLyAJCXdpbmRvdy5oaXN0b3J5LmdvKC0xKQoKICAgICAgICAgICAgICAgICAgICAvLyAJCXJldHVybiBmYWxzZQogICAgICAgICAgICAgICAgICAgIC8vIAl9CiAgICAgICAgICAgICAgICAgICAgLy8gfSkKICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIuZ28oLTEpCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0Oi8vIFNhdmUgTmV3CiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy4kc3dhbCh7CiAgICAgICAgICAgICAgICAgICAgLy8gCXBvc2l0aW9uOiAncHJvZHVjdHMnLAogICAgICAgICAgICAgICAgICAgIC8vIAlpY29uOiAnc3VjY2VzcycsCiAgICAgICAgICAgICAgICAgICAgLy8gCXRpdGxlOiAnWW91ciB3b3JrIGhhcyBiZWVuIHNhdmVkJywKICAgICAgICAgICAgICAgICAgICAvLyAJc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIC8vIAl0aW1lcjogMTUwMAogICAgICAgICAgICAgICAgICAgIC8vIH0pCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5zYXZlTW9kZSA9ICcnCiAgICAgICAgfSwKICAgICAgICBhbGVydEVycm9yKG1zZykgewogICAgICAgICAgICBpZiAobXNnKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRzd2FsKHsKICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ2NlbnRlcicsCiAgICAgICAgICAgICAgICAgICAgaWNvbjogJ2Vycm9yJywKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ09vcHMuLi4hJywKICAgICAgICAgICAgICAgICAgICB0ZXh0OiBtc2csCiAgICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgIHRoaXMubG9hZGluZ1RleHRBbGVydCA9ICJGYWlsZWQhIgogICAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nQ29sb3JBbGVydCA9ICIjZWI4MzM0IgogICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VBbGVydFN0YXR1cygpCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRQcmVmaXgoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIHByZWZpeEhhbmRsZXIuZ2V0KCJyZWNvcmQgbG9hbiByZWNlaXB0IikudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb25UeXBlID0gcmVzLmRhdGEuZGF0YVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVOdW1iZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGdlbmVyYXRlTnVtYmVyKCkgewogICAgICAgICAgICBsZXQgZGF0YSA9IHsKICAgICAgICAgICAgICAgIGFiYnI6IHRoaXMudHJhbnNhY3Rpb25UeXBlLmFiYnIsCiAgICAgICAgICAgICAgICBzdHJ1Y3R1cmU6IHRoaXMudHJhbnNhY3Rpb25UeXBlLnN0cnVjdHVyZSwKICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogdGhpcy5yLmlzc3VlZERhdGUsCiAgICAgICAgICAgICAgICB0eXBlOiAiUmVjb3JkIExvYW4gUmVjZWlwdCIsCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGJpbGxpbmdIYW5kbGVyCiAgICAgICAgICAgIC5sYXN0TnVtYmVyKGRhdGEpCiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc3VmZml4ID0gcmVzLnN1ZmZpeDsKICAgICAgICAgICAgICAgICAgICB0aGlzLmdldExhc3ROdW0oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmVycm9ycy5wdXNoKGUpOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGdldExhc3ROdW0oKXsKICAgICAgICAgICAgbGV0IGQgPSB7CiAgICAgICAgICAgICAgICB0eXBlOiAiUmVjb3JkUmVjZWlwdCIsCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGxvYW5IYW5kbGVyCiAgICAgICAgICAgICAgICAuZ2V0TGFzdE51bWJlcihkKQogICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGFzdE51bWJlciA9IHRoaXMuemVyb1BhZCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlSW50KHJlcy5sYXN0TnVtYmVyKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb25UeXBlLmZvcm1hdAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnIubGFzdE51bWJlciA9IHBhcnNlSW50KHJlcy5sYXN0TnVtYmVyKQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBudW1iZXIgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdWZmaXggKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvblR5cGUubnVtYmVyU2VwYXJhdG9yICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3ROdW1iZXI7CgogICAgICAgICAgICAgICAgICAgICAgICBsZXQgZGVzID0gJycKICAgICAgICAgICAgICAgICAgICAgICAgaWYoT2JqZWN0LmtleXModGhpcy5sb2FuKS5sZW5ndGggPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlcyA9IGBSZWNpZXZlIExvYW4gZnJvbSAke3RoaXMubG9hbi5maW5hbmNpYWxJbnN0aXR1dGlvbnMubmFtZX0gRm9yIExvYW4gTnVtYmVyICR7dGhpcy5sb2FuLmFwcHJvdmVOdW1iZXJ9YDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5qb3VybmFsID0gbmV3IEpvdXJuYWxNb2RlbCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogZGVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25fdHlwZTogTG9hblR5cGUuUkVDSUVQVCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvdXJuYWxfdHlwZTogTG9hblR5cGUuUkVDSUVQVCwKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuam91cm5hbC5hYmJyID0gdGhpcy50cmFuc2FjdGlvblR5cGUuYWJicgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYW4uYWN0aXZlRGF0ZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zdWJzdHIoMCwgMTApOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIDIgZGVmYXVsdCByb3dzCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkUm93VCh0aGlzLiRyZWZzLmNhc2hCYW5rQWNjb3VudERTLmtlbmRvV2lkZ2V0KCkpOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgMjsgaW5kZXgrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRSb3codGhpcy4kcmVmcy5yZWxhdGVkQ29zdERTLmtlbmRvV2lkZ2V0KCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuam91cm5hbC5udW1iZXIgPSB0aGlzLnRyYW5zYWN0aW9uVHlwZS5hYmJyICsgdGhpcy50cmFuc2FjdGlvblR5cGUubnVtYmVyU2VwYXJhdG9yICsgbnVtYmVyCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuci5hYmJyID0gdGhpcy50cmFuc2FjdGlvblR5cGUuYWJicgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnIubnVtYmVyID0gbnVtYmVyOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnIuYWJick51bWJlciA9IHRoaXMudHJhbnNhY3Rpb25UeXBlLmFiYnIgKyB0aGlzLnRyYW5zYWN0aW9uVHlwZS5udW1iZXJTZXBhcmF0b3IgKyBudW1iZXIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKGUpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICB6ZXJvUGFkKG51bSwgcGxhY2VzKSB7CiAgICAgICAgICAgIHJldHVybiBTdHJpbmcobnVtKS5wYWRTdGFydChwbGFjZXMsICIwIik7CiAgICAgICAgfSwKICAgICAgICBjbGVhckZvcm0oKXsKICAgICAgICAgICAgdGhpcy5yID0gbmV3IFJlY29yZExvYW5SZWNlaXB0KHt9KQogICAgICAgICAgICB0aGlzLnJlbW92ZUVtcHR5TGluZSgpCiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5hZGRSb3coKQogICAgICAgICAgICAgICAgdGhpcy5hZGRSb3coKQogICAgICAgICAgICB9LCA1MDApCiAgICAgICAgfSwKICAgICAgICBhc3luYyBnZXRKb3VybmFsTnVtYmVyKCkgewogICAgICAgICAgICBsZXQgbnVtID0gYXdhaXQgSGVscGVyLmdlbmVyYXRlQWNjb3VudGluZ051bWJlcih0aGlzLmpvdXJuYWxUeG5UeXBlLCB0aGlzLnIuaXNzdWVkRGF0ZSkKICAgICAgICAgICAgdGhpcy5qb3VybmFsTnVtYmVyID0gbnVtLm51bWJlcgogICAgICAgICAgICB0aGlzLmpvdXJuYWxQcmVmaXggPSBudW0ucHJlZml4X2Zvcm1hdAogICAgICAgIH0sCiAgICB9LAogICAgd2F0Y2g6IHsKICAgICAgICAnJHJvdXRlJzogJ3NldERlZmF1bHREYXRhJywKICAgICAgICBpbml0TG9hbigpIHsKICAgICAgICAgICAgdGhpcy5sb2FuID0gdGhpcy5pbml0TG9hbgogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2codGhpcy5sb2FuLCAnbG9hbicpCiAgICAgICAgfQogICAgfSwKICAgIG1vdW50ZWQoKSB7CiAgICAgICAgaWYodGhpcy5pbml0TG9hbiA9PSB1bmRlZmluZWQpewogICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5nbygtMSkKICAgICAgICB9ZWxzZSB7CiAgICAgICAgICAgIHRoaXMubG9hbiA9IHRoaXMuaW5pdExvYW47CiAgICAgICAgICAgIC8qIEluaXRpYWwgTG9hbiAqLwogICAgICAgICAgICB0aGlzLmxvYW4gPSB0aGlzLmluaXRMb2FuOwogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2codGhpcy5sb2FuLCAnbG9hbicpCiAgICAgICAgICAgIC8qIFNldCBEZWZhdWx0IERhdGEgKi8KICAgICAgICAgICAgdGhpcy5zZXREZWZhdWx0RGF0YSgpOwogICAgICAgICAgICB0aGlzLnIubG9hbiA9IHRoaXMuaW5pdExvYW47CiAgICAgICAgICAgIC8qIENhbGwgQWxsIEFjY291bnRzICovCiAgICAgICAgICAgIHRoaXMuYWNjb3VudExvYWRpbmcgPSB0cnVlCiAgICAgICAgICAgIGxldCBzZWxmID0gdGhpcwogICAgICAgICAgICBhY2NvdW50SGFuZGxlci5nZXRBbGwoKQogICAgICAgICAgICAgICAgLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXMuYWNjb3VudExvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIHRoaXMuYWNjb3VudHMgPSByZXN1bHQuZGF0YTsKICAgICAgICAgICAgICAgICAgICBsZXQgcmVzID0gcmVzdWx0LmRhdGEKICAgICAgICAgICAgICAgICAgICBsZXQgZXggPSByZXMuZmlsdGVyKChvYmopID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KG9iai5hY2NvdW50X3R5cGUubnVtYmVyKSA+PSAzMyAmJiBwYXJzZUludChvYmouYWNjb3VudF90eXBlLm51bWJlcikgPD0gNDMKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIGlmKGV4Lmxlbmd0aCA+IDApewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV4cGVuc2VBY2NvdW50cyA9IGV4CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxldCBiayA9IHJlcy5maWx0ZXIoKG9iaikgPT4gewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQob2JqLmFjY291bnRfdHlwZS5udW1iZXIpID49IDEgJiYgcGFyc2VJbnQob2JqLmFjY291bnRfdHlwZS5udW1iZXIpIDw9IDUKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIGlmKGJrLmxlbmd0aCA+IDApewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJhbmtBY2NvdW50cyA9IGJrCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICAgICAgICBzZWxmLmFsZXJ0RXJyb3IoZXJyb3IpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9LAogICAgY3JlYXRlZCgpIHsKICAgIH0KfTsK"},{"version":3,"sources":["RecordLoanReceipt.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0WA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"RecordLoanReceipt.vue","sourceRoot":"src/views/finances","sourcesContent":["<template>\n    <v-app>\n        <v-container>\n            <v-row>\n                <v-col cols=\"12\" sm=\"12\">\n                    <v-card\n                        outlined\n                        dense\n                        class=\"pa-4 no_border rounded-sm\"\n                        color=\"white\"\n                    >\n                        <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                            <v-card outlined dense class=\"no_border\">\n                                <h2 class=\"mb-0\">{{ $t(\"record_loan_receipt\") }}</h2>\n                                <v-icon\n                                    size=\"36\"\n                                    onclick=\"window.history.go(-1); return false;\"\n                                    style=\"cursor: pointer; color: #333;\"\n                                    class=\"float-right\"\n                                >close\n                                </v-icon>\n                            </v-card>\n\n                            <v-card\n                                outlined\n                                dense\n                                class=\"px-4 no_border mb-4\"\n                                color=\"grayBg\"\n                                height=\"175px\"\n                            >\n                                <v-row>\n                                    <v-col sm=\"6\" cols=\"12\" class=\"py-0 \">\n                                        <!-- Date -->\n                                        <label class=\"label\">{{ $t(\"date\") }}</label>\n                                        <app-datepicker\n                                            :initialDate=\"r.issuedDate\"\n                                            @emitDate=\"r.issuedDate = $event\"\n                                            @onChanged=\"generateNumber\"\n                                        />\n\n                                        <!-- Number -->\n                                        <label class=\"label\">{{ $t(\"number\") }}</label>\n                                        <v-row>\n                                            <v-col sm=\"2\" cols=\"3\" class=\"pb-1 pt-1 pr-0\">\n                                                <div class=\"code_text\" v-text=\"r.abbr\"></div>\n                                            </v-col>\n                                            <v-col sm=\"8\" cols=\"7\" class=\"pb-1 pt-1 pl-0 pr-0\">\n                                                <v-text-field\n                                                    class=\"custom-border\"\n                                                    v-model=\"r.number\"\n                                                    outlined\n                                                    :rules=\"[(v) => !!v || 'Number is required']\"\n                                                    required\n                                                />\n                                            </v-col>\n                                            <v-col sm=\"1\" cols=\"2\" class=\"pb-1 pt-1 pr-0\">\n                                                <v-icon\n                                                    color=\"black\"\n                                                    size=\"30\"\n                                                    class=\"border_qrcode\"\n                                                    @click=\"onGenerateNumberClicked\"\n                                                >mdi-qrcode\n                                                </v-icon>\n                                            </v-col>\n                                        </v-row>\n                                    </v-col>\n\n                                    <!-- Total Approved Amount -->\n                                    <v-col sm=\"3\" cols=\"12\" class=\"pb-0 pt-4\">\n                                        <v-card\n                                            outlined\n                                            style=\"display: block\"\n                                            height=\"140\"\n                                            dense\n                                            class=\"pa-3\"\n                                            color=\"third\"\n                                        >\n                                            <h4 class=\"mb-0 text-left text-white\">\n                                                {{ $t(\"approved_amount\") }}\n                                            </h4>\n                                            <h3\n                                                style=\"font-size: 25px\"\n                                                class=\"py-10 float-right text-right text-white\"\n                                            >\n                                                {{ Number(loan.approvedAmount).toLocaleString() }}\n                                            </h3>\n                                        </v-card>\n                                    </v-col>\n\n                                    <!-- Total Amount -->\n                                    <v-col sm=\"3\" cols=\"12\" class=\"pb-0 pt-4\">\n                                        <v-card\n                                            outlined\n                                            style=\"display: block\"\n                                            height=\"140\"\n                                            dense\n                                            class=\"pa-3\"\n                                            color=\"third\"\n                                        >\n                                            <h4 class=\"mb-0 text-left text-white\">\n                                                {{ $t(\"total_amount\") }}\n                                            </h4>\n                                            <h3\n                                                style=\"font-size: 25px\"\n                                                class=\"py-10 float-right text-right text-white\"\n                                            >\n                                                {{ Number(totalAmount).toLocaleString() }}\n                                            </h3>\n                                        </v-card>\n                                    </v-col>\n                                </v-row>\n                            </v-card>\n\n                            <v-card\n                                class=\"px-4 no_border\"\n                                color=\"white\"\n                                outlined>\n                                <v-row>\n                                    <v-col sm=\"12\" cols=\"12\" class=\"pb-3 pa-0\">\n                                        <h3 class=\"mb-3\">{{ $t(\"cash_bank_receipt\") }}</h3>\n                                        <template>\n                                            <kendo-datasource\n                                                ref=\"cashBankAccountDS\"\n                                                :data=\"cashBankAccountEntries\"\n                                                :change=\"onDrGridDataSourceChanged\"\n                                            />\n                                            <kendo-grid\n                                                id=\"cashBankAccountGrid\"\n                                                class=\"grid-function\"\n                                                :data-source-ref=\"'cashBankAccountDS'\"\n                                                :column-menu=\"true\"\n                                                :editable=\"true\"\n                                                :scrollable-virtual=\"true\"\n                                            >\n                                                <kendo-grid-column\n                                                    :title=\"$t('no.')\"\n                                                    :template=\"cashBankAccountRowNumberTmpl\"\n                                                    :width=\"45\"\n                                                    :headerAttributes=\"{\n                                                        style: 'background-color: #EDF1F5;',\n                                                        class: 'text-products',\n                                                    }\"\n                                                    :attributes=\"{\n                                                        style: 'text-align: products',\n                                                    }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'account'\"\n                                                    :title=\"$t('account')\"\n                                                    :width=\"200\"\n                                                    :template=\"'<span>#=account.name||``#</span>'\"\n                                                    :editor=\"cashAccountEditor\"\n                                                    :headerAttributes=\"{\n                                                            style: 'background-color: #EDF1F5',\n                                                        }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'description'\"\n                                                    :title=\"$t('description')\"\n                                                    :width=\"200\"\n                                                    :headerAttributes=\"{\n                                                        style: 'background-color: #EDF1F5',\n                                                    }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'ref_number'\"\n                                                    :title=\"$t('reference_no')\"\n                                                    :width=\"160\"\n                                                    :headerAttributes=\"{\n                                                        style: 'background-color: #EDF1F5',\n                                                    }\"\n                                                />\n                                                <!-- <kendo-grid-column\n                                                    :field=\"'amount'\"\n                                                    :title=\"$t('amount')\"\n                                                    :format=\"'{0:n}'\"\n                                                    :width=\"150\"\n                                                    :editable=\"false\"\n                                                    :headerAttributes=\"{\n                                                        style: 'text-align: right; background-color: #EDF1F5',\n                                                    }\"\n                                                    :attributes=\"{ style: 'text-align: right; ' }\"\n                                                /> -->\n                                            </kendo-grid>\n                                        </template>\n                                        <!--                                        <v-row style=\"background-color: #fff\">-->\n                                        <!--                                            <v-col sm=\"1\" cols=\"12\" class=\"py-0\">-->\n                                        <!--                                                <v-btn color=\"primary\"-->\n                                        <!--                                                       class=\"float-left btn_plus rounded-0 white&#45;&#45;text mt-3\"-->\n                                        <!--                                                       name=\"addDrBtn\"-->\n                                        <!--                                                       @click=\"onAddRowCashBankAccountClicked\">-->\n                                        <!--                                                    <v-icon size=\"\" class=\"ma-1\">mdi-plus</v-icon>-->\n                                        <!--                                                </v-btn>-->\n                                        <!--                                            </v-col>-->\n                                        <!--                                        </v-row>-->\n                                    </v-col>\n                                </v-row>\n                                <v-row>\n                                    <v-col sm=\"12\" cols=\"12\" class=\"pa-0\">\n                                        <h3 class=\"mb-3\">{{ $t(\"relate_cost_receipt\") }}</h3>\n                                        <kendo-datasource\n                                            ref=\"relatedCostDS\"\n                                            :data=\"relatedCostEntries\"\n                                            :change=\"onCrGridDataSourceChanged\"\n                                        />\n                                        <kendo-grid\n                                            id=\"relatedCostGrid\"\n                                            class=\"grid-function\"\n                                            :data-source-ref=\"'relatedCostDS'\"\n                                            :sortable=\"false\"\n                                            :filterable=\"false\"\n                                            :column-menu=\"true\"\n                                            :editable=\"true\"\n                                            :scrollable-virtual=\"true\"\n                                        >\n                                            <kendo-grid-column\n                                                :title=\"$t('no.')\"\n                                                :template=\"relatedCostRowNumberTmpl\"\n                                                :width=\"45\"\n                                                :column-menu=\"false\"\n                                                :headerAttributes=\"{\n                                                style: 'background-color: #EDF1F5;',\n                                                    class: 'text-products',\n                                                }\"\n                                                :attributes=\"{\n                                                    style: 'text-align: products',\n                                                }\"\n                                            />\n                                            <kendo-grid-column\n                                                :field=\"'account'\"\n                                                :title=\"$t('account')\"\n                                                :width=\"200\"\n                                                :template=\"'<span>#=account.name||``#</span>'\"\n                                                :editor=\"expenseAccountEditor\"\n                                                :headerAttributes=\"{\n                                                    style: 'background-color: #EDF1F5',\n                                                }\"\n                                            />\n                                            <kendo-grid-column\n                                                :field=\"'description'\"\n                                                :title=\"$t('description')\"\n                                                :width=\"200\"\n                                                :headerAttributes=\"{\n                                                    style: 'background-color: #EDF1F5',\n                                                }\"\n                                            />\n                                            <kendo-grid-column\n                                                :field=\"'ref_number'\"\n                                                :title=\"$t('reference_no')\"\n                                                :width=\"160\"\n                                                :headerAttributes=\"{\n                                                    style: 'background-color: #EDF1F5',\n                                                }\"\n                                            />\n                                            <kendo-grid-column\n                                                :field=\"'amount'\"\n                                                :title=\"$t('amount')\"\n                                                :format=\"'{0:n}'\"\n                                                :width=\"150\"\n                                                :headerAttributes=\"{\n                                                    style: 'text-align: right; background-color: #EDF1F5',\n                                                }\"\n                                                :attributes=\"{ style: 'text-align: right; ' }\"\n                                            />\n                                            <kendo-grid-column\n                                                :command=\"{\n                                                    iconClass: 'k-icon k-i-trash',\n                                                    text: 'Delete',\n                                                    name: 'destroy',\n                                                    class: 'btn-plus',\n                                                }\"\n                                                :title=\"'&nbsp;'\"\n                                                :width=\"100\"\n                                                :headerAttributes=\"{\n                                                    style: 'text-align: right; background-color: #EDF1F5',\n                                                }\"\n                                            />\n                                        </kendo-grid>\n                                        <v-row style=\"background-color: #fff\">\n                                            <v-col sm=\"1\" cols=\"12\" class=\"pb-4 pt-0\">\n                                                <v-btn color=\"primary\"\n                                                       class=\"float-left btn_plus rounded-0 white--text mt-3\"\n                                                       name=\"addCrdBtn\"\n                                                       @click=\"onAddRowRelatedCostClicked\">\n                                                    <v-icon size=\"\" class=\"ma-1\">mdi-plus</v-icon>\n                                                </v-btn>\n                                            </v-col>\n                                            <!--                                            <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">-->\n                                            <!--                                                <template>-->\n                                            <!--                                                    <v-file-input-->\n                                            <!--                                                        class=\"mt-0 pt-0\"-->\n                                            <!--                                                        sm=\"3\"-->\n                                            <!--                                                        cols=\"6\"-->\n                                            <!--                                                        :placeholder=\"$t('attachment')\"-->\n                                            <!--                                                        multiple-->\n                                            <!--                                                        prepend-icon=\"mdi-paperclip\"-->\n                                            <!--                                                    >-->\n                                            <!--                                                        <template v-slot:selection=\"{ text }\">-->\n                                            <!--                                                            <v-chip small label color=\"primary\">-->\n                                            <!--                                                                {{ text }}-->\n                                            <!--                                                            </v-chip>-->\n                                            <!--                                                        </template>-->\n                                            <!--                                                    </v-file-input>-->\n                                            <!--                                                </template>-->\n                                            <!--                                            </v-col>-->\n                                        </v-row>\n                                    </v-col>\n                                </v-row>\n                            </v-card>\n\n                            <v-divider/>\n\n                            <!-- Footer -->\n                            <v-card outlined dense class=\"no_border function_footer\">\n                                <!-- Warning Message -->\n                                <v-alert type=\"warning\"\n                                         v-model=\"alert\"\n                                         dismissible>\n                                    <span v-html=\"errorMessage\"/>\n                                </v-alert>\n\n                                <v-btn color=\"black\"\n                                       class=\"text-capitalize  white--text float-left\"\n                                       ref=\"btnCancel\"\n                                       @click=\"cancel\"\n                                >{{ $t(\"cancel\") }}\n                                </v-btn>\n<!--                                <v-btn-->\n<!--                                    color=\"primary\"-->\n<!--                                    class=\"ml-2 float-right text-capitalize  white&#45;&#45;text\"-->\n<!--                                    @click=\"onSaveOptionClick('saveNew')\"-->\n<!--                                >{{ $t(\"save_new\") }}-->\n<!--                                </v-btn>-->\n                                <v-btn\n                                    color=\"primary\"\n                                    class=\"float-right white--text text-capitalize \"\n                                    @click=\"onSaveOptionClick('saveClose')\"\n                                >{{ $t(\"save_close\") }}\n                                </v-btn>\n                            </v-card>\n                        </v-form>\n                    </v-card>\n                </v-col>\n            </v-row>\n            <LoadingMe\n                :isLoading=\"compeletLoading\"\n                :fullPage=\"true\"\n                :myLoading=\"true\"\n                :alertMessage=\"loadingAlert\"\n                :color=\"loadingColorAlert\"\n                :alertText=\"loadingTextAlert\"\n            />\n            <LoadingMe\n                :isLoading=\"accountLoading\"\n                :fullPage=\"true\"\n                :myLoading=\"true\"\n            />\n        </v-container>\n    </v-app>\n</template>\n\n<script>\nimport kendo from '@progress/kendo-ui';\nimport LoadingMe from \"@/components/Loading\";\nconst { journalHandler } = require(\"@/scripts/AppHandlers\");\nconst {EntityType} = require(\"@/scripts/default_setup/Collections\")\nimport {JournalModel, JournalEntryModel, LoanDetailModel} from \"@/scripts/model/AppModels\";\nimport {accountHandler, prefixHandler} from \"@/scripts/AppHandlers\";\nimport DatePickerComponent from \"@/components/custom_templates/DatePickerComponent\";\nimport Helper from \"@/helper.js\";\nconst billingHandler = require(\"@/scripts/invoice/handler/billingHandler\");\nconst LoanType = require(\"@/scripts/default_setup/LoanType.js\");\nconst $ = kendo.jQuery\nimport RecordLoanReceipt from \"@/scripts/financing/model/RecordLoanReceipt\"\nimport currencyHandler from \"@/scripts/currency/handler/currencyHandler\";\n// import billingHandler from \"@/scripts/invoice/handler/billingHandler\";\nconst loanHandler = require(\"@/scripts/financing/handler/loanHandler\")\n\nexport default {\n    name: \"RecordLoanReceipt\",\n    components: {\n        LoadingMe,\n        \"app-datepicker\": DatePickerComponent,\n    },\n    props: {\n        initLoan: {},\n    },\n    data: () => ({\n        /* Obj */\n        accountLoading: false,\n        loan: {},\n        journal: {},\n        journalEntries: [],\n        loanDetail: {},\n        // Form validation\n        valid: true,\n        isEdit: false,\n        saveMode: '',\n        alert: false,\n        errorMessage: '',\n        user: Helper.getUser(),\n        // LoadingMe\n        compeletLoading: false,\n        loadingAlert: false,\n        loadingColorAlert: \"\",\n        loadingTextAlert: \"\",\n        // Other\n        totalAmount: 0,\n        accounts: [],\n        cashBankAccountEntries: [],\n        relatedCostEntries: [],\n        transactionType: {},\n        r: new RecordLoanReceipt({}),\n        expenseAccounts: [],\n        bankAccounts: [],\n        errors: [],\n        exchangeRate: {},\n        journalNumber: '',\n        journalPrefix: '',\n        journalTxnType: EntityType.JOURNAL,\n        suffix: ''\n    }),\n    methods: {\n        /* Set Default Data */\n        async setDefaultData() {\n            this.r = new RecordLoanReceipt({})\n            this.relatedCostEntries = []\n            this.cashBankAccountEntries = []\n            // let bankDS = this.$refs.cashBankAccountDS.kendoWidget();\n            // bankDS.data().forEach(element => {\n            //     bankDS.remove(element)\n            // })\n            // let relatedCostDS = this.$refs.relatedCostDS.kendoWidget();\n            // relatedCostDS.data().forEach(element => {\n            //     relatedCostDS.remove(element)\n            // })\n            this.loadPrefix();\n            this.loadTransactionRate()\n            this.getJournalNumber()\n        },\n        onGenerateNumberClicked() {\n            this.generateNumber();\n        },\n        // Number\n        // generateNumber() {\n        //     this.journal.number = new Date().getTime()\n        // },\n        /* Auto Calculate */\n        autoCalculate() {\n            let cbaDS = this.$refs.cashBankAccountDS.kendoWidget(),\n                rcDS = this.$refs.relatedCostDS.kendoWidget(),\n                total = 0;\n            total = parseFloat(this.loan.approvedAmount)\n\n            rcDS.data().forEach(value => {\n                total -= value.amount;\n            });\n            cbaDS.data().forEach(value => {\n                value.amount = total\n            });\n            // window.console.log(cbaDS.data(), 'data')\n            this.totalAmount = total\n        },\n        onDrGridDataSourceChanged() {\n            this.autoCalculate();\n        },\n        onCrGridDataSourceChanged() {\n            this.autoCalculate();\n        },\n        onAddRowCashBankAccountClicked() {\n            this.addRow(this.$refs.cashBankAccountDS.kendoWidget());\n        },\n        onAddRowRelatedCostClicked() {\n            this.addRow(this.$refs.relatedCostDS.kendoWidget());\n        },\n        cashBankAccountRowNumberTmpl(dataItem) {\n            let ds = this.$refs.cashBankAccountDS.kendoWidget(),\n                index = ds.indexOf(dataItem)\n            return index + 1\n        },\n        relatedCostRowNumberTmpl(dataItem) {\n            let ds = this.$refs.relatedCostDS.kendoWidget(),\n                index = ds.indexOf(dataItem)\n            return index + 1\n        },\n        addRow(gridDataSource) {\n            let last = gridDataSource.total();\n            let je = new JournalEntryModel();\n            gridDataSource.insert(last, je);\n        },\n        addRowT(gridDataSource) {\n            let last = gridDataSource.total();\n            let je = new JournalEntryModel();\n            je.amount = this.loan.approvedAmount\n            gridDataSource.insert(last, je);\n        },\n        // Grid Custom Editor\n        cashAccountEditor(container, options) {\n            kendo.jQuery('<input required name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: false,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"name\",\n                    dataValueField: \"name\",\n                    template: \"<span>#=number# #=name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.bankAccounts,\n                        group: {\n                            field: \"account_type.name\",\n                            compare: function (a, b) {\n                                // Order by number\n                                if (a.items[0].number === b.items[0].number) {\n                                    return 0;\n                                } else if (a.items[0].number > b.items[0].number) {\n                                    return 1;\n                                } else {\n                                    return -1;\n                                }\n                            },\n                        },\n                    }),\n                });\n        },\n        expenseAccountEditor(container, options) {\n            kendo.jQuery('<input required name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: false,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"name\",\n                    dataValueField: \"name\",\n                    template: \"<span>#=number# #=name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.expenseAccounts,\n                        group: {\n                            field: \"account_type.name\",\n                            compare: function (a, b) {\n                                // Order by number\n                                if (a.items[0].number === b.items[0].number) {\n                                    return 0;\n                                } else if (a.items[0].number > b.items[0].number) {\n                                    return 1;\n                                } else {\n                                    return -1;\n                                }\n                            },\n                        },\n                    }),\n                });\n        },\n        /* Add Loan Detail */\n        addLoanDetail() {\n            this.loanDetail = new LoanDetailModel({\n                journal_uuid: this.journal.uuid,\n                account_uuid: this.loan.loanAccount.uuid,\n                description: this.journal.description,\n                amount: this.totalAmount,\n                date: Helper.toISODate(this.r.issuedDate),\n                txn_type: LoanType.RECIEPT,\n            })\n        },\n        async loadTransactionRate() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const date = new Date(this.r.issuedDate).toISOString().substr(0, 10);\n                    const code = this.loan.currency.code\n                    if (code) {\n                        this.showLoading = true;\n                        currencyHandler\n                            .getLastExchangeRateByDate(date, code)\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    this.exchangeRate = res.data.data[0];\n                                }\n                            });\n                    }\n                }, 10);\n            });\n        },\n        /* Add Journal */\n        addJournal() {\n            let entries = [];\n\n            // Cash Bank Account on Dr\n            let cashBankAcctDS = this.$refs.cashBankAccountDS.kendoWidget();\n            cashBankAcctDS.data().forEach(element => {\n                if (element.amount != 0) {\n                    element.currency = this.loan.currency;\n                    element.exchange_rate = parseFloat(this.exchangeRate.rate); // Will change later\n                    element.exchanged_amount = element.amount * parseFloat(this.exchangeRate.rate);\n                    entries.push(element);\n                }\n            });\n\n            // Related Cost on Dr\n            let relatedCostDS = this.$refs.relatedCostDS.kendoWidget();\n            relatedCostDS.data().forEach(element => {\n                if (element.amount != 0) {\n                    element.currency = this.loan.currency;\n                    element.exchange_rate = parseFloat(this.exchangeRate.rate); // Will change later\n                    element.exchanged_amount = element.amount * parseFloat(this.exchangeRate.rate);\n                    entries.push(element);\n                }\n            });\n\n            // Loan Account on Cr\n            let loanEntry = new JournalEntryModel({\n                account: this.loan.loanAccount,\n                description: this.journal.description,\n                amount: this.loan.approvedAmount * -1,\n                currency: this.loan.currency,\n                exchange_rate: parseFloat(this.exchangeRate.rate), // Will change later\n                exchanged_amount: parseFloat(this.loan.approvedAmount) * parseFloat(this.exchangeRate.rate),\n            });\n            entries.push(loanEntry);\n            this.journalEntries = entries;\n        },\n        shrinkData() {\n            // Number combine abbr + number\n            // this.journal.number = this.journal.abbr + '-' + this.journal.number\n\n            // Journal Date\n            this.journal.journal_date = Helper.toISODate(this.r.issuedDate)\n\n            // Loan Active Date\n            this.loan.receiptDate = Helper.toISODate(this.r.issuedDate)\n\n            // User\n            if (this.isEdit) {\n                this.journal.modified_by = this.user\n            } else {\n                this.journal.created_by = this.user\n            }\n        },\n        // Validating\n        validateForm() {\n            let result = true,\n                msg = ''\n\n            // Total Amount\n            // if (this.loan.approved_amount !== this.totalAmount) {\n            //     msg += '<p>' + this.$i18n.t('Total Amount equal to Approved Amount') + '</p>'\n            //     result = false;\n            // }\n\n            // // Select Account and Amount\n            // let please_select_account_line = this.$i18n.t('pls_select_acc_line')\n            const band = $(\"#cashBankAccountGrid\").data(\"kendoGrid\"),\n                bdata = band.dataSource\n            bdata.data().forEach(m => {\n                if (m.account.uuid === undefined) {\n                    msg += this.$i18n.t('pls_select_acc_line')\n                    result = false;\n                }\n            })\n            // window.console.log(dataSource, msg)\n            // \t// No Account\n            // \tif(value.account.number === '' && value.amount !== 0){\n            // \t\tlet rowIndex = index + 1\n            // \t\tmsg += '<p>' + please_select_account_line + rowIndex.toString() + '</p>'\n            // \t\tresult = false\n            // \t}\n\n            // \t// Count Empty Row\n            // \tif(value.account.number === '' && value.amount === 0){\n            // \t\tcountEmpty++\n            // \t}\n            // })\n\n            // // Empty Row\n            // if(countEmpty === cashBankAccountDS.total()){\n            // \tmsg += '<p>' + this.$i18n.t('please_acc_ot_record') + '</p>'\n            // \tresult = false;\n            // }\n\n            // Show Alert\n            this.errorMessage = msg;\n            this.alert = false;\n            if (result === false) {\n                this.alert = true;\n            }\n\n            return result;\n        },\n        // All Saves\n        onSaveOptionClick(mode) {\n            if (this.$refs.form.validate() && this.validateForm()) {\n                this.saveMode = mode\n                this.save()\n            } else {\n                this.alertError()\n            }\n        },\n        cancel() {\n            this.$swal({\n                title: 'Are you sure?',\n                text: \"You won't be able to revert this!\",\n                icon: 'warning',\n                showCancelButton: true,\n                confirmButtonColor: '#4d4848',\n                cancelButtonColor: '#ED1A3A',\n                confirmButtonText: 'Yes, discard it!'\n            }).then((result) => {\n                if (result.value) {\n                    this.clear()\n                    this.$router.go(-1)\n                }\n            })\n        },\n        clear() {\n            // Reset Form\n            // this.$refs.form.reset();\n\n            this.totalAmount = 0;\n            this.cashBankAccountEntries = [];\n            this.relatedCostEntries = [];\n\n            // Set default data\n            this.setDefaultData()\n        },\n        removeEmptyLine() {\n            let relatedCostDS = this.$refs.relatedCostDS.kendoWidget();\n            if(relatedCostDS.data().length > 0) {\n                relatedCostDS.data().forEach(element => {\n                    if (element != undefined) {\n                        if (element.account.uuid === undefined || element.account.uuid == '') {\n                            relatedCostDS.remove(element)\n                        }\n                    }else{\n                        relatedCostDS.remove(element)\n                    }\n                })\n            }\n        },\n        save() {\n            let bankDS = this.$refs.cashBankAccountDS.kendoWidget();\n            bankDS.data().forEach(element => {\n                if (element.account.uuid === undefined || element.account.uuid == '') {\n                    this.$snotify.error('Please select a Cash/Bank account')\n                    return\n                }\n            })\n\n            // let self = this;\n            this.removeEmptyLine()\n            // Shrink Data\n            this.shrinkData();\n\n            // Add Loan Detail\n            this.addLoanDetail();\n\n            // Add Journal\n            this.addJournal();\n\n            // Sync Data\n            this.journal.journal_entries = this.journalEntries\n            this.accountLoading = true\n            let self = this\n            let relatedCostDS = this.$refs.relatedCostDS.kendoWidget();\n            this.r.loan = this.loan\n            this.journal.currency_code = this.loan.currency.code\n            // this.journal.number = this.journalNumber\n            this.journal.prefix_format = this.journalPrefix\n            if(this.loan.hasOwnProperty('segment')){\n                this.journal.segment_uuid = this.loan.segment.id\n            }\n            if(this.loan.hasOwnProperty('location')){\n                this.journal.location_uuid = this.loan.location.id\n            }\n            journalHandler.save(new JournalModel(this.journal))\n                .then(function (response) {\n                    self.r.journalId = response ? response.data.uuid : ''\n                    self.r.journal = JSON.stringify(self.journal)\n                    self.r.user = self.user\n                    self.r.exchangeRate = self.exchangeRate\n                    self.r.cashItemLine = bankDS.data()\n                    self.r.relateCostItemLine = relatedCostDS.data()\n                    self.r.receivedAmount = self.totalAmount\n                    loanHandler.loanReceiptCreate(new RecordLoanReceipt(self.r)).then(response => {\n                        self.accountLoading = false\n                        if (response.data.statusCode === 201) {\n                            self.$snotify.success('Successfully')\n                            window.history.go(-1);\n                        }\n                    }).catch(e => {\n                        self.$snotify.error('Something went wrong')\n                        self.errors.push(e)\n                        window.console.log(e, 'error')\n                    })\n                })\n                .catch(function (error) {\n                    Helper.alertErrorMsg(error);\n                })\n                .finally(() => {\n                    self.showLoading = false;\n                });\n        },\n        // Response Status\n        responseStatus(status) {\n            switch (status) {\n                case 200:// Ok\n                    this.showAlert()\n\n                    // Reset to default data\n                    this.clear();\n\n                    break\n                case 201:// Duplicate\n                    this.alertError('Duplicate entry!')\n                    break\n                default:\n                    break\n            }\n        },\n        // Sweetalert2\n        changeAlertStatus() {\n            this.loadingAlert = true\n            setTimeout(() => {\n                this.loadingAlert = false\n            }, 6200);\n        },\n        showAlert() {\n            this.showLoading = false\n            this.changeAlertStatus()\n            this.loadingTextAlert = \"Added Successful\"\n            this.loadingColorAlert = \"#3DA72E\"\n            switch (this.saveMode) {\n                case 'saveClose':// Save Close\n                    // this.$swal({\n                    // \tposition: 'products',\n                    // \ticon: 'success',\n                    // \ttitle: 'Your work has been saved',\n                    // \tshowConfirmButton: true,\n                    // }).then((result) => {\n                    // \tif (result.value) {\n                    // \t\twindow.history.go(-1)\n\n                    // \t\treturn false\n                    // \t}\n                    // })\n                    this.$router.go(-1)\n                    break;\n                default:// Save New\n                    // this.$swal({\n                    // \tposition: 'products',\n                    // \ticon: 'success',\n                    // \ttitle: 'Your work has been saved',\n                    // \tshowConfirmButton: false,\n                    // \ttimer: 1500\n                    // })\n                    break;\n            }\n            this.saveMode = ''\n        },\n        alertError(msg) {\n            if (msg) {\n                this.$swal({\n                    position: 'center',\n                    icon: 'error',\n                    title: 'Oops...!',\n                    text: msg,\n                    showConfirmButton: true\n                })\n            } else {\n                this.showLoading = false\n                this.loadingTextAlert = \"Failed!\"\n                this.loadingColorAlert = \"#eb8334\"\n                this.changeAlertStatus()\n            }\n        },\n        async loadPrefix() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    prefixHandler.get(\"record loan receipt\").then((res) => {\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false;\n                            this.transactionType = res.data.data[0];\n                            this.generateNumber();\n                        }\n                    });\n                }, 10);\n            });\n        },\n        generateNumber() {\n            let data = {\n                abbr: this.transactionType.abbr,\n                structure: this.transactionType.structure,\n                transactionDate: this.r.issuedDate,\n                type: \"Record Loan Receipt\",\n            };\n            billingHandler\n            .lastNumber(data)\n            .then((response) => {\n                if (response.data.statusCode === 200) {\n                    const res = response.data.data;\n                    this.suffix = res.suffix;\n                    this.getLastNum();\n                }\n            })\n            .catch((e) => {\n                this.errors.push(e);\n            });\n        },\n        getLastNum(){\n            let d = {\n                type: \"RecordReceipt\",\n            };\n            loanHandler\n                .getLastNumber(d)\n                .then((response) => {\n                    if (response.data.statusCode === 200) {\n                        const res = response.data.data;\n                        const lastNumber = this.zeroPad(\n                            parseInt(res.lastNumber),\n                            this.transactionType.format\n                        );\n                        this.r.lastNumber = parseInt(res.lastNumber)\n                        const number =\n                            this.suffix +\n                            this.transactionType.numberSeparator +\n                            lastNumber;\n\n                        let des = ''\n                        if(Object.keys(this.loan).length > 0){\n                            des = `Recieve Loan from ${this.loan.financialInstitutions.name} For Loan Number ${this.loan.approveNumber}`;\n                        }\n\n                        this.journal = new JournalModel({\n                            description: des,\n                            transaction_type: LoanType.RECIEPT,\n                            journal_type: LoanType.RECIEPT,\n                        });\n                        this.journal.abbr = this.transactionType.abbr\n                        this.loan.activeDate = new Date().toISOString().substr(0, 10);\n\n                        // Add 2 default rows\n                        this.addRowT(this.$refs.cashBankAccountDS.kendoWidget());\n                        for (let index = 0; index < 2; index++) {\n                            this.addRow(this.$refs.relatedCostDS.kendoWidget());\n                        }\n                        this.journal.number = this.transactionType.abbr + this.transactionType.numberSeparator + number\n                        this.r.abbr = this.transactionType.abbr\n                        this.r.number = number;\n                        this.r.abbrNumber = this.transactionType.abbr + this.transactionType.numberSeparator + number\n                    }\n                })\n                .catch((e) => {\n                    window.console.log(e);\n                });\n        },\n        zeroPad(num, places) {\n            return String(num).padStart(places, \"0\");\n        },\n        clearForm(){\n            this.r = new RecordLoanReceipt({})\n            this.removeEmptyLine()\n            setTimeout(() => {\n                this.addRow()\n                this.addRow()\n            }, 500)\n        },\n        async getJournalNumber() {\n            let num = await Helper.generateAccountingNumber(this.journalTxnType, this.r.issuedDate)\n            this.journalNumber = num.number\n            this.journalPrefix = num.prefix_format\n        },\n    },\n    watch: {\n        '$route': 'setDefaultData',\n        initLoan() {\n            this.loan = this.initLoan\n            window.console.log(this.loan, 'loan')\n        }\n    },\n    mounted() {\n        if(this.initLoan == undefined){\n            window.history.go(-1)\n        }else {\n            this.loan = this.initLoan;\n            /* Initial Loan */\n            this.loan = this.initLoan;\n            window.console.log(this.loan, 'loan')\n            /* Set Default Data */\n            this.setDefaultData();\n            this.r.loan = this.initLoan;\n            /* Call All Accounts */\n            this.accountLoading = true\n            let self = this\n            accountHandler.getAll()\n                .then((result) => {\n                    this.accountLoading = false\n                    this.accounts = result.data;\n                    let res = result.data\n                    let ex = res.filter((obj) => {\n                        return parseInt(obj.account_type.number) >= 33 && parseInt(obj.account_type.number) <= 43\n                    })\n                    if(ex.length > 0){\n                        this.expenseAccounts = ex\n                    }\n                    let bk = res.filter((obj) => {\n                        return parseInt(obj.account_type.number) >= 1 && parseInt(obj.account_type.number) <= 5\n                    })\n                    if(bk.length > 0){\n                        this.bankAccounts = bk\n                    }\n                }).catch(function (error) {\n                self.alertError(error);\n            });\n        }\n    },\n    created() {\n    }\n};\n</script>\n\n<style scoped>\n.function_content {\n    padding: 0 25px 25px;\n    border-bottom: 0;\n}\n\n.attachment_table.theme--light.v-data-table {\n    background-color: transparent !important;\n}\n\n@media (min-width: 1264px) {\n    .container {\n        /* max-width: 1185px; */\n        max-width: 1080px !important;\n    }\n}\n\n@media (max-width: 576px) {\n    .mb-6 {\n        margin-bottom: 0 !important;\n    }\n}\n</style>"]}]}