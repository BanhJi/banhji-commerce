{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/share_funding/FundReceipt.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/share_funding/FundReceipt.vue","mtime":1638499443326},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGkxOG4gfSBmcm9tICJAL2kxOG4iOwppbXBvcnQga2VuZG8gZnJvbSAiQHByb2dyZXNzL2tlbmRvLXVpIjsKaW1wb3J0IEhlbHBlciBmcm9tICJAL2hlbHBlci5qcyI7CmltcG9ydCB7CiAgSm91cm5hbE1vZGVsLAogIEpvdXJuYWxFbnRyeU1vZGVsLAogIEFjY291bnRNb2RlbCwKICBDbGFzc01vZGVsLAogIEN1cnJlbmN5TW9kZWwsCiAgRXhjaGFuZ2VSYXRlTW9kZWwsCiAgTG9jYXRpb25Nb2RlbCwKICBQcm9qZWN0TW9kZWwsCiAgU2VnbWVudE1vZGVsLAogIENvbnRhY3RNb2RlbCwKfSBmcm9tICJAL3NjcmlwdHMvbW9kZWwvQXBwTW9kZWxzIjsKaW1wb3J0IEN1c3RvbWVyTW9kZWwgZnJvbSAiQC9zY3JpcHRzL21vZGVsL0N1c3RvbWVyIjsKCi8qIEVkaXRvcnMgKi8KaW1wb3J0IENhc2hSZWNlaXB0QWNjb3VudEVkaXRvciBmcm9tICJAL3NjcmlwdHMva2VuZG9fZWRpdG9yL0Nhc2hBY2NvdW50IjsKaW1wb3J0IFJlbGF0ZWRFeHBlbnNlQWNjb3VudEVkaXRvciBmcm9tICJAL3NjcmlwdHMva2VuZG9fZWRpdG9yL1JlbGF0ZWRFeHBlbnNlQWNjb3VudCI7CmltcG9ydCBSZXZlbnVlRGVmZmVyZWRHcmFudEFjY291bnRFZGl0b3IgZnJvbSAiQC9zY3JpcHRzL2tlbmRvX2VkaXRvci9SZXZlbnVlRGVmZmVyZWRHcmFudEFjY291bnQiOwppbXBvcnQgQ2xhc3NFZGl0b3IgZnJvbSAiQC9zY3JpcHRzL2tlbmRvX2VkaXRvci9DbGF6eiI7CgovKiBTdG9yZSAqLwppbXBvcnQgc3RvcmUgZnJvbSAiQC9zdG9yZSI7CmNvbnN0IGluc3RpdHV0ZSA9IHN0b3JlLnN0YXRlLmluc3RpdHV0ZS5pbnN0aXR1dGU7Cgpjb25zdCBqb3VybmFsSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9qb3VybmFsSGFuZGxlciIpOwpjb25zdCBBY2NvdW50VHlwZUNvZGUgPSByZXF1aXJlKCJAL3NjcmlwdHMvZGVmYXVsdF9zZXR1cC9BY2NvdW50VHlwZUNvZGUiKTsKaW1wb3J0IHsgU2hvd1Jlc291cmNlIH0gZnJvbSAiQC9vYnNlcnZhYmxlL3N0b3JlIjsKCmNvbnN0IHsKICBFbnRpdHlUeXBlLAogIFNhdmVPcHRpb24sCn0gPSByZXF1aXJlKCJAL3NjcmlwdHMvZGVmYXVsdF9zZXR1cC9Db2xsZWN0aW9ucyIpOwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJGdW5kUmVjZWlwdCIsCiAgY29tcG9uZW50czogewogICAgTG9hZGluZ01lOiAoKSA9PiBpbXBvcnQoIkAvY29tcG9uZW50cy9Mb2FkaW5nIiksCiAgICAiYXBwLWRhdGVwaWNrZXIiOiAoKSA9PgogICAgICBpbXBvcnQoIkAvY29tcG9uZW50cy9jdXN0b21fdGVtcGxhdGVzL0RhdGVQaWNrZXJDb21wb25lbnQiKSwKICAgICJhcHAtY3VycmVuY3ktZHJvcGRvd25saXN0IjogKCkgPT4KICAgICAgaW1wb3J0KCJAL2NvbXBvbmVudHMvZHJvcGRvd25saXN0L0N1cnJlbmN5IiksCiAgICAiYXBwLWRvbm9yLWRyb3Bkb3dubGlzdCI6ICgpID0+IGltcG9ydCgiQC9jb21wb25lbnRzL2Ryb3Bkb3dubGlzdC9Eb25vciIpLAogICAgImFwcC1mdW5kLWNhdGVnb3J5LWRyb3Bkb3dubGlzdCI6ICgpID0+CiAgICAgIGltcG9ydCgiQC9jb21wb25lbnRzL2Ryb3Bkb3dubGlzdC9GdW5kQ2F0ZWdvcnkiKSwKICAgICJhcHAtc2VnbWVudC1kcm9wZG93bmxpc3QiOiAoKSA9PgogICAgICBpbXBvcnQoIkAvY29tcG9uZW50cy9kcm9wZG93bmxpc3QvU2VnbWVudCIpLAogICAgImFwcC1wcm9qZWN0LWRyb3Bkb3dubGlzdCI6ICgpID0+CiAgICAgIGltcG9ydCgiQC9jb21wb25lbnRzL2Ryb3Bkb3dubGlzdC9Qcm9qZWN0IiksCiAgICAiYXBwLWxvY2F0aW9uLWRyb3Bkb3dubGlzdCI6ICgpID0+CiAgICAgIGltcG9ydCgiQC9jb21wb25lbnRzL2Ryb3Bkb3dubGlzdC9Mb2NhdGlvbiIpLAogIH0sCiAgcHJvcHM6IHsKICAgIGluaXRKb3VybmFsOiB7CiAgICAgIHR5cGU6IEpvdXJuYWxNb2RlbCwKICAgIH0sCiAgfSwKICBkYXRhOiAoKSA9PiAoewogICAgLyogT2JqICovCiAgICBmdW5kQ2F0ZWdvcnk6IG51bGwsCiAgICBqb3VybmFsOiBuZXcgSm91cm5hbE1vZGVsKCksCiAgICBjdXJyZW5jeTogbmV3IEN1cnJlbmN5TW9kZWwoaW5zdGl0dXRlLmJhc2VDdXJyZW5jeSksCiAgICBleGNoYW5nZVJhdGU6IG5ldyBFeGNoYW5nZVJhdGVNb2RlbChpbnN0aXR1dGUuYmFzZUN1cnJlbmN5KSwKICAgIGpvdXJuYWxFbnRyaWVzOiBbXSwKICAgIGNhc2hSZWNlaXB0RW50cmllczogW10sCiAgICByZWxhdGVkRXhwZW5zZUVudHJpZXM6IFtdLAogICAgcmV2ZW51ZURlZmZlcmVkR3JhbnRFbnRyaWVzOiBbXSwKICAgIGRvbm9yOiBuZXcgQ29udGFjdE1vZGVsKCksCiAgICBsb2NhdGlvbjogbmV3IExvY2F0aW9uTW9kZWwoKSwKICAgIHByb2plY3Q6IG5ldyBQcm9qZWN0TW9kZWwoKSwKICAgIHNlZ21lbnQ6IG5ldyBTZWdtZW50TW9kZWwoKSwKICAgIC8vIEFjY291bnRzCiAgICBhY2NvdW50czogW10sCiAgICBjYXNoUmVjaWVwdEFjY291bnRzOiBbXSwKICAgIHJlbGF0ZWRFeHBlbnNlQWNjb3VudHM6IFtdLAogICAgcmV2ZW51ZURlZmZlcmVkR3JhbnRBY2NvdW50czogW10sCiAgICAvLyBFZGl0b3JzCiAgICBDYXNoUmVjZWlwdEFjY291bnRFZGl0b3I6IENhc2hSZWNlaXB0QWNjb3VudEVkaXRvciwKICAgIFJlbGF0ZWRFeHBlbnNlQWNjb3VudEVkaXRvcjogUmVsYXRlZEV4cGVuc2VBY2NvdW50RWRpdG9yLAogICAgUmV2ZW51ZURlZmZlcmVkR3JhbnRBY2NvdW50RWRpdG9yOiBSZXZlbnVlRGVmZmVyZWRHcmFudEFjY291bnRFZGl0b3IsCiAgICBDbGFzc0VkaXRvcjogQ2xhc3NFZGl0b3IsCiAgICAvLyBPdGhlcgogICAgdG90YWxEcjogMCwKICAgIHRvdGFsQ3I6IDAsCiAgICB0ZW1wbGF0ZXM6IFtdLAogICAgdXNlcjogSGVscGVyLmdldFVzZXIoKSwKICAgIC8vIEZvcm0gdmFsaWRhdGlvbgogICAgdmFsaWQ6IHRydWUsCiAgICBpc0VkaXQ6IGZhbHNlLAogICAgYWxlcnQ6IGZhbHNlLAogICAgZXJyb3JNZXNzYWdlOiAiIiwKICAgIHNhdmVNb2RlOiAiIiwKICAgIFNhdmVPcHRpb246IFNhdmVPcHRpb24sCiAgICAvLyBMb2FkaW5nTWUKICAgIHNob3dMb2FkaW5nOiBmYWxzZSwKICAgIC8vIGZ1bmNpb24KICAgIGlzSGlkZUJhcjogZmFsc2UsCiAgfSksCiAgbWV0aG9kczogewogICAgSGlkZVNtYWxsU2lkZUJhcigpIHsKICAgICAgdGhpcy5pc0hpZGVCYXIgPSAhdGhpcy5pc0hpZGVCYXI7CiAgICB9LAogICAgSGVscChrZXlfc2VhcmNoKSB7CiAgICAgIFNob3dSZXNvdXJjZShrZXlfc2VhcmNoKTsKICAgIH0sCiAgICAvLyBJbml0aWFsIERhdGEKICAgIGluaXRpYWxEYXRhKCkgewogICAgICBpZiAodGhpcy5pbml0Sm91cm5hbCkgewogICAgICAgIC8vIEVkaXQgTW9kZQogICAgICAgIHRoaXMuam91cm5hbCA9IHRoaXMuaW5pdEpvdXJuYWw7CiAgICAgICAgdGhpcy5iaW5kRGF0YSgpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIEJyYW5kIE5ldyBNb2RlCiAgICAgICAgdGhpcy5zZXREZWZhdWx0RGF0YSgpOwogICAgICB9CiAgICB9LAogICAgLy8gU2V0IGRlZmF1bHQgZGF0YQogICAgYXN5bmMgc2V0RGVmYXVsdERhdGEoKSB7CiAgICAgIC8vIEJyYW5kIE5ldyBNb2RlCiAgICAgIHRoaXMuaXNFZGl0ID0gZmFsc2U7CgogICAgICB0aGlzLmpvdXJuYWwgPSBuZXcgSm91cm5hbE1vZGVsKHsKICAgICAgICB0cmFuc2FjdGlvbl90eXBlOiBFbnRpdHlUeXBlLkZVTkRfUkVDRUlQVCwKICAgICAgICBqb3VybmFsX2RhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zdWJzdHIoMCwgMTApLAogICAgICB9KTsKCiAgICAgIC8qIERlZmF1bHQgU2lkZWJhciAqLwogICAgICBsZXQgbG9jYXRpb25zID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goImxvY2F0aW9ucy9nZXRMaXN0Iik7CiAgICAgIHRoaXMubG9jYXRpb24gPSBuZXcgTG9jYXRpb25Nb2RlbChsb2NhdGlvbnNbMF0pOwoKICAgICAgbGV0IHNlZ21lbnRzID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goInNlZ21lbnRzL2dldExpc3QiKTsKICAgICAgdGhpcy5zZWdtZW50ID0gbmV3IFNlZ21lbnRNb2RlbChzZWdtZW50cy5maW5kKChpKSA9PiBpLmlzU3lzdGVtID09PSAxKSk7CgogICAgICAvLyBHZW5lcmF0ZSBOdW1iZXIKICAgICAgdGhpcy5nZW5lcmF0ZU51bWJlcigpOwoKICAgICAgLy8gQWRkIHR3byBkZWZhdWx0IHJvd3MKICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IDI7IGluZGV4KyspIHsKICAgICAgICB0aGlzLmFkZFJvd0Nhc2hSZWNlaXB0KCk7CiAgICAgICAgdGhpcy5hZGRSb3dSZWxhdGVkRXhwZW5zZSgpOwogICAgICAgIHRoaXMuYWRkUm93UmV2ZW51ZURlZmZlcmVkR3JhbnQoKTsKICAgICAgfQogICAgfSwKICAgIC8vIEJpbmQgZGF0YSBmcm9tIHByb3AgZm9yIGVkaXQgbW9kZQogICAgYXN5bmMgYmluZERhdGEoKSB7CiAgICAgIC8vIEVkaXQgTW9kZQogICAgICB0aGlzLmlzRWRpdCA9IHRydWU7CgogICAgICBsZXQgdG90YWxEciA9IDAsCiAgICAgICAgdG90YWxDciA9IDAsCiAgICAgICAgY2FzaFJlY2VpcHRFbnRyaWVzID0gW10sCiAgICAgICAgcmVsYXRlZEV4cGVuc2VFbnRyaWVzID0gW10sCiAgICAgICAgcmV2ZW51ZURlZmZlcmVkR3JhbnRFbnRyaWVzID0gW107CgogICAgICAvLyBEb25vcgogICAgICB0aGlzLmRvbm9yID0gbmV3IEN1c3RvbWVyTW9kZWwoCiAgICAgICAgdGhpcy5qb3VybmFsLmpvdXJuYWxfZW50cmllc1swXS5wcmltYXJ5X2NvbnRhY3QKICAgICAgKTsKCiAgICAgIC8qIENsYXNzZXMgKi8KICAgICAgbGV0IGNsYXNzZXMgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgiY2xhc3Nlcy9nZXRMaXN0Iik7CgogICAgICAvLyBDdXJyZW5jeQogICAgICB0aGlzLmN1cnJlbmN5ID0gbmV3IEN1cnJlbmN5TW9kZWwoCiAgICAgICAgdGhpcy5qb3VybmFsLmpvdXJuYWxfZW50cmllc1swXS5jdXJyZW5jeQogICAgICApOwogICAgICB0aGlzLmV4Y2hhbmdlUmF0ZSA9IG5ldyBFeGNoYW5nZVJhdGVNb2RlbCgKICAgICAgICB0aGlzLmpvdXJuYWwuam91cm5hbF9lbnRyaWVzWzBdLmN1cnJlbmN5CiAgICAgICk7CiAgICAgIHRoaXMuZXhjaGFuZ2VSYXRlLmlkID0gdGhpcy5qb3VybmFsLmpvdXJuYWxfZW50cmllc1swXS5leGNoYW5nZV9yYXRlX3V1aWQ7CiAgICAgIHRoaXMuZXhjaGFuZ2VSYXRlLnJhdGUgPSB0aGlzLmpvdXJuYWwuam91cm5hbF9lbnRyaWVzWzBdLmV4Y2hhbmdlX3JhdGU7CgogICAgICB0aGlzLmpvdXJuYWwuam91cm5hbF9lbnRyaWVzLmZvckVhY2goKHZhbHVlKSA9PiB7CiAgICAgICAgbGV0IGplID0gbmV3IEpvdXJuYWxFbnRyeU1vZGVsKHZhbHVlKTsKCiAgICAgICAgaWYgKHZhbHVlLmFtb3VudCA+IDApIHsKICAgICAgICAgIC8vIERyIHNpZGUKICAgICAgICAgIGlmICgKICAgICAgICAgICAgfkFjY291bnRUeXBlQ29kZS5DQVNIX0FDQ09VTlRTLmluZGV4T2YoCiAgICAgICAgICAgICAgdmFsdWUuYWNjb3VudC5hY2NvdW50X3R5cGUubnVtYmVyCiAgICAgICAgICAgICkKICAgICAgICAgICkgewogICAgICAgICAgICBjYXNoUmVjZWlwdEVudHJpZXMucHVzaChqZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBDbGFzc2VzCiAgICAgICAgICAgIGplLmNsYXNzMSA9IG5ldyBDbGFzc01vZGVsKAogICAgICAgICAgICAgIGNsYXNzZXMuZmluZCgoaXRlbSkgPT4gaXRlbS5pZCA9PT0gdmFsdWUuY2xhc3NfMV91dWlkKQogICAgICAgICAgICApOwogICAgICAgICAgICBqZS5jbGFzczIgPSBuZXcgQ2xhc3NNb2RlbCgKICAgICAgICAgICAgICBjbGFzc2VzLmZpbmQoKGl0ZW0pID0+IGl0ZW0uaWQgPT09IHZhbHVlLmNsYXNzXzJfdXVpZCkKICAgICAgICAgICAgKTsKICAgICAgICAgICAgamUuY2xhc3MzID0gbmV3IENsYXNzTW9kZWwoCiAgICAgICAgICAgICAgY2xhc3Nlcy5maW5kKChpdGVtKSA9PiBpdGVtLmlkID09PSB2YWx1ZS5jbGFzc18zX3V1aWQpCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGplLmNsYXNzNCA9IG5ldyBDbGFzc01vZGVsKAogICAgICAgICAgICAgIGNsYXNzZXMuZmluZCgoaXRlbSkgPT4gaXRlbS5pZCA9PT0gdmFsdWUuY2xhc3NfNF91dWlkKQogICAgICAgICAgICApOwogICAgICAgICAgICBqZS5jbGFzczUgPSBuZXcgQ2xhc3NNb2RlbCgKICAgICAgICAgICAgICBjbGFzc2VzLmZpbmQoKGl0ZW0pID0+IGl0ZW0uaWQgPT09IHZhbHVlLmNsYXNzXzVfdXVpZCkKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIHJlbGF0ZWRFeHBlbnNlRW50cmllcy5wdXNoKGplKTsKICAgICAgICAgIH0KICAgICAgICAgIHRvdGFsRHIgKz0gdmFsdWUuYW1vdW50OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBDciBzaWRlCiAgICAgICAgICBqZS5hbW91bnQgPSB2YWx1ZS5hbW91bnQgKiAtMTsKICAgICAgICAgIHJldmVudWVEZWZmZXJlZEdyYW50RW50cmllcy5wdXNoKGplKTsKICAgICAgICAgIHRvdGFsQ3IgKz0gamUuYW1vdW50OwogICAgICAgIH0KICAgICAgfSk7CgogICAgICAvLyBTaWRlYmFyCiAgICAgIGxldCBsb2NhdGlvbnMgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgibG9jYXRpb25zL2dldExpc3QiKTsKICAgICAgdGhpcy5sb2NhdGlvbiA9IG5ldyBMb2NhdGlvbk1vZGVsKAogICAgICAgIGxvY2F0aW9ucy5maW5kKChpKSA9PiBpLmlkID09PSB0aGlzLmpvdXJuYWwubG9jYXRpb25fdXVpZCkKICAgICAgKTsKCiAgICAgIGxldCBzZWdtZW50cyA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJzZWdtZW50cy9nZXRMaXN0Iik7CiAgICAgIHRoaXMuc2VnbWVudCA9IG5ldyBTZWdtZW50TW9kZWwoCiAgICAgICAgc2VnbWVudHMuZmluZCgoaSkgPT4gaS5pZCA9PT0gdGhpcy5qb3VybmFsLnNlZ21lbnRfdXVpZCkKICAgICAgKTsKCiAgICAgIGxldCBwcm9qZWN0cyA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJwcm9qZWN0cy9nZXRMaXN0Iik7CiAgICAgIHRoaXMucHJvamVjdCA9IG5ldyBQcm9qZWN0TW9kZWwoCiAgICAgICAgcHJvamVjdHMuZmluZCgoaSkgPT4gaS5pZCA9PT0gdGhpcy5qb3VybmFsLnByb2plY3RfdXVpZCkKICAgICAgKTsKCiAgICAgIHRoaXMudG90YWxEciA9IHRvdGFsRHI7CiAgICAgIHRoaXMudG90YWxDciA9IHRvdGFsQ3I7CgogICAgICB0aGlzLmNhc2hSZWNlaXB0RW50cmllcyA9IGNhc2hSZWNlaXB0RW50cmllczsKICAgICAgdGhpcy5yZWxhdGVkRXhwZW5zZUVudHJpZXMgPSByZWxhdGVkRXhwZW5zZUVudHJpZXM7CiAgICAgIHRoaXMucmV2ZW51ZURlZmZlcmVkR3JhbnRFbnRyaWVzID0gcmV2ZW51ZURlZmZlcmVkR3JhbnRFbnRyaWVzOwogICAgfSwKICAgIC8vIE51bWJlcgogICAgYXN5bmMgZ2VuZXJhdGVOdW1iZXIoKSB7CiAgICAgIGlmICghdGhpcy5pc0VkaXQpIHsKICAgICAgICBsZXQgbnVtID0gYXdhaXQgSGVscGVyLmdlbmVyYXRlQWNjb3VudGluZ051bWJlcigKICAgICAgICAgIHRoaXMuam91cm5hbC50cmFuc2FjdGlvbl90eXBlLAogICAgICAgICAgdGhpcy5qb3VybmFsLmpvdXJuYWxfZGF0ZQogICAgICAgICk7CgogICAgICAgIHRoaXMuam91cm5hbC5udW1iZXIgPSBudW0ubnVtYmVyOwogICAgICAgIHRoaXMuam91cm5hbC5wcmVmaXhfZm9ybWF0ID0gbnVtLnByZWZpeF9mb3JtYXQ7CiAgICAgIH0KICAgIH0sCiAgICAvLyBHZXQgRXhjaGFuZ2UgUmF0ZQogICAgYXN5bmMgZ2V0RXhjaGFuZ2VSYXRlKCkgewogICAgICBpZiAodGhpcy5qb3VybmFsLmpvdXJuYWxfZGF0ZSAmJiB0aGlzLmN1cnJlbmN5LmNvZGUgIT09ICIiKSB7CiAgICAgICAgdGhpcy5leGNoYW5nZVJhdGUgPSBhd2FpdCBIZWxwZXIuZ2V0TGFzdEV4Y2hhbmdlUmF0ZUJ5RGF0ZSgKICAgICAgICAgIHRoaXMuam91cm5hbC5qb3VybmFsX2RhdGUsCiAgICAgICAgICB0aGlzLmN1cnJlbmN5LmNvZGUKICAgICAgICApOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZXhjaGFuZ2VSYXRlID0gbmV3IEV4Y2hhbmdlUmF0ZU1vZGVsKGluc3RpdHV0ZS5iYXNlQ3VycmVuY3kpOwogICAgICB9CiAgICB9LAogICAgLyogT24gRGF0ZSBDaGFuZXMgKi8KICAgIG9uRGF0ZUNoYW5nZXMoKSB7CiAgICAgIHRoaXMuZ2V0RXhjaGFuZ2VSYXRlKCk7CiAgICAgIHRoaXMuZ2VuZXJhdGVOdW1iZXIoKTsKICAgIH0sCiAgICAvKiBLZW5kbyAqLwogICAgLy8gRGF0YVNvdXJjZSBDaGFuZ2VzCiAgICBvbkNoYW5nZUNhc2hSZWNlaXB0RFMoZSkgewogICAgICBpZiAoZS5maWVsZCkgewogICAgICAgIGxldCBkYXRhUm93ID0gZS5pdGVtc1swXTsKCiAgICAgICAgaWYgKGUuZmllbGQgPT09ICJhY2NvdW50IikgewogICAgICAgICAgdGhpcy5hZGRFeHRyYVJvd0Nhc2hSZWNlaXB0KGRhdGFSb3cudWlkKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuZGF0YVNvdXJjZUF1dG9DYWxjdWxhdGUoKTsKICAgICAgfQogICAgfSwKICAgIG9uQ2hhbmdlUmVsYXRlZEV4cGVuc2VEUyhlKSB7CiAgICAgIGlmIChlLmZpZWxkKSB7CiAgICAgICAgbGV0IGRhdGFSb3cgPSBlLml0ZW1zWzBdOwoKICAgICAgICBpZiAoZS5maWVsZCA9PT0gImFjY291bnQiKSB7CiAgICAgICAgICB0aGlzLmFkZEV4dHJhUm93UmVsYXRlZEV4cGVuc2UoZGF0YVJvdy51aWQpOwogICAgICAgIH0gZWxzZSBpZiAoZS5maWVsZCA9PT0gImNsYXNzMSIpIHsKICAgICAgICAgIGlmIChkYXRhUm93LmNsYXNzMSAhPT0gbnVsbCkgewogICAgICAgICAgICBkYXRhUm93LnNldCgiY2xhc3NfMV91dWlkIiwgZGF0YVJvdy5jbGFzczEuaWQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gU2V0IGRlZmF1bHQgd2hlbiBkZXNlbGVjdAogICAgICAgICAgICBkYXRhUm93LnNldCgiY2xhc3NfMV91dWlkIiwgIiIpOwogICAgICAgICAgICBkYXRhUm93LnNldCgiY2xhc3MxIiwgbmV3IENsYXNzTW9kZWwoKSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChlLmZpZWxkID09PSAiY2xhc3MyIikgewogICAgICAgICAgaWYgKGRhdGFSb3cuY2xhc3MyICE9PSBudWxsKSB7CiAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjbGFzc18yX3V1aWQiLCBkYXRhUm93LmNsYXNzMi5pZCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBTZXQgZGVmYXVsdCB3aGVuIGRlc2VsZWN0CiAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjbGFzc18yX3V1aWQiLCAiIik7CiAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjbGFzczIiLCBuZXcgQ2xhc3NNb2RlbCgpKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGUuZmllbGQgPT09ICJjbGFzczMiKSB7CiAgICAgICAgICBpZiAoZGF0YVJvdy5jbGFzczMgIT09IG51bGwpIHsKICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNsYXNzXzNfdXVpZCIsIGRhdGFSb3cuY2xhc3MzLmlkKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFNldCBkZWZhdWx0IHdoZW4gZGVzZWxlY3QKICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNsYXNzXzNfdXVpZCIsICIiKTsKICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNsYXNzMyIsIG5ldyBDbGFzc01vZGVsKCkpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZS5maWVsZCA9PT0gImNsYXNzNCIpIHsKICAgICAgICAgIGlmIChkYXRhUm93LmNsYXNzNCAhPT0gbnVsbCkgewogICAgICAgICAgICBkYXRhUm93LnNldCgiY2xhc3NfNF91dWlkIiwgZGF0YVJvdy5jbGFzczQuaWQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gU2V0IGRlZmF1bHQgd2hlbiBkZXNlbGVjdAogICAgICAgICAgICBkYXRhUm93LnNldCgiY2xhc3NfNF91dWlkIiwgIiIpOwogICAgICAgICAgICBkYXRhUm93LnNldCgiY2xhc3M0IiwgbmV3IENsYXNzTW9kZWwoKSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChlLmZpZWxkID09PSAiY2xhc3M1IikgewogICAgICAgICAgaWYgKGRhdGFSb3cuY2xhc3M1ICE9PSBudWxsKSB7CiAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjbGFzc181X3V1aWQiLCBkYXRhUm93LmNsYXNzNS5pZCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBTZXQgZGVmYXVsdCB3aGVuIGRlc2VsZWN0CiAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjbGFzc181X3V1aWQiLCAiIik7CiAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjbGFzczUiLCBuZXcgQ2xhc3NNb2RlbCgpKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuZGF0YVNvdXJjZUF1dG9DYWxjdWxhdGUoKTsKICAgICAgfQogICAgfSwKICAgIG9uQ2hhbmdlUmV2ZW51ZURlZmZlcmVkR3JhbnREUyhlKSB7CiAgICAgIGlmIChlLmZpZWxkKSB7CiAgICAgICAgbGV0IGRhdGFSb3cgPSBlLml0ZW1zWzBdOwoKICAgICAgICBpZiAoZS5maWVsZCA9PT0gImFjY291bnQiKSB7CiAgICAgICAgICB0aGlzLmFkZEV4dHJhUm93UmV2ZW51ZURlZmZlcmVkR3JhbnQoZGF0YVJvdy51aWQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5kYXRhU291cmNlQXV0b0NhbGN1bGF0ZSgpOwogICAgICB9CiAgICB9LAogICAgLy8gQXV0byBDYWxjdWxhdGUgSW4gRGF0YVNvdXJjZQogICAgZGF0YVNvdXJjZUF1dG9DYWxjdWxhdGUoKSB7CiAgICAgIGxldCBjYXNoUmVjZWlwdERTID0gdGhpcy4kcmVmcy5jYXNoUmVjZWlwdERTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgcmVsYXRlZEV4cGVuc2VEUyA9IHRoaXMuJHJlZnMucmVsYXRlZEV4cGVuc2VEUy5rZW5kb1dpZGdldCgpLAogICAgICAgIHJldmVudWVEZWZmZXJlZEdyYW50RFMgPQogICAgICAgICAgdGhpcy4kcmVmcy5yZXZlbnVlRGVmZmVyZWRHcmFudERTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgdG90YWxEciA9IDAsCiAgICAgICAgdG90YWxDciA9IDA7CgogICAgICAvLyBTdW0KICAgICAgY2FzaFJlY2VpcHREUy5kYXRhKCkuZm9yRWFjaCgodmFsdWUpID0+IHsKICAgICAgICB0b3RhbERyICs9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuYW1vdW50KTsKICAgICAgfSk7CiAgICAgIHJlbGF0ZWRFeHBlbnNlRFMuZGF0YSgpLmZvckVhY2goKHZhbHVlKSA9PiB7CiAgICAgICAgdG90YWxEciArPSBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmFtb3VudCk7CiAgICAgIH0pOwogICAgICByZXZlbnVlRGVmZmVyZWRHcmFudERTLmRhdGEoKS5mb3JFYWNoKCh2YWx1ZSkgPT4gewogICAgICAgIHRvdGFsQ3IgKz0ga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5hbW91bnQpOwogICAgICB9KTsKCiAgICAgIHRoaXMudG90YWxEciA9IHRvdGFsRHI7CiAgICAgIHRoaXMudG90YWxDciA9IHRvdGFsQ3I7CiAgICB9LAogICAgLy8gUm93IE51bWJlciBUZW1wbGF0ZQogICAgcm93TnVtYmVyQ2FzaFJlY2VpcHQoZGF0YUl0ZW0pIHsKICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5jYXNoUmVjZWlwdERTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgaW5kZXggPSBkcy5pbmRleE9mKGRhdGFJdGVtKTsKCiAgICAgIHJldHVybiBpbmRleCArIDE7CiAgICB9LAogICAgcm93TnVtYmVyUmVsYXRlZEV4cGVuc2UoZGF0YUl0ZW0pIHsKICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5yZWxhdGVkRXhwZW5zZURTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgaW5kZXggPSBkcy5pbmRleE9mKGRhdGFJdGVtKTsKCiAgICAgIHJldHVybiBpbmRleCArIDE7CiAgICB9LAogICAgcm93TnVtYmVyUmV2ZW51ZURlZmZlcmVkR3JhbnQoZGF0YUl0ZW0pIHsKICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5yZXZlbnVlRGVmZmVyZWRHcmFudERTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgaW5kZXggPSBkcy5pbmRleE9mKGRhdGFJdGVtKTsKCiAgICAgIHJldHVybiBpbmRleCArIDE7CiAgICB9LAogICAgLy8gQWRkIE5ldyBSb3cKICAgIGFkZFJvd0Nhc2hSZWNlaXB0KCkgewogICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLmNhc2hSZWNlaXB0RFMua2VuZG9XaWRnZXQoKSwKICAgICAgICBsYXN0ID0gZHMudG90YWwoKSwKICAgICAgICBqZSA9IG5ldyBKb3VybmFsRW50cnlNb2RlbCgpOwoKICAgICAgZHMuaW5zZXJ0KGxhc3QsIGplKTsKICAgIH0sCiAgICBhZGRSb3dSZWxhdGVkRXhwZW5zZSgpIHsKICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5yZWxhdGVkRXhwZW5zZURTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgbGFzdCA9IGRzLnRvdGFsKCksCiAgICAgICAgamUgPSBuZXcgSm91cm5hbEVudHJ5TW9kZWwoKTsKCiAgICAgIC8vIENsYXNzZXMKICAgICAgamUuY2xhc3MxID0gbmV3IENsYXNzTW9kZWwoKTsKICAgICAgamUuY2xhc3MyID0gbmV3IENsYXNzTW9kZWwoKTsKICAgICAgamUuY2xhc3MzID0gbmV3IENsYXNzTW9kZWwoKTsKICAgICAgamUuY2xhc3M0ID0gbmV3IENsYXNzTW9kZWwoKTsKICAgICAgamUuY2xhc3M1ID0gbmV3IENsYXNzTW9kZWwoKTsKCiAgICAgIGRzLmluc2VydChsYXN0LCBqZSk7CiAgICB9LAogICAgYWRkUm93UmV2ZW51ZURlZmZlcmVkR3JhbnQoKSB7CiAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMucmV2ZW51ZURlZmZlcmVkR3JhbnREUy5rZW5kb1dpZGdldCgpLAogICAgICAgIGxhc3QgPSBkcy50b3RhbCgpLAogICAgICAgIGplID0gbmV3IEpvdXJuYWxFbnRyeU1vZGVsKCk7CgogICAgICBkcy5pbnNlcnQobGFzdCwgamUpOwogICAgfSwKICAgIC8vIEFkZCBFeHRyYSBSb3cKICAgIGFkZEV4dHJhUm93Q2FzaFJlY2VpcHQodWlkKSB7CiAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuY2FzaFJlY2VpcHREUy5rZW5kb1dpZGdldCgpLAogICAgICAgIHRvdGFsID0gZHMudG90YWwoKSwKICAgICAgICByb3cgPSBkcy5nZXRCeVVpZCh1aWQpLAogICAgICAgIGluZGV4ID0gZHMuaW5kZXhPZihyb3cpOwoKICAgICAgaWYgKGluZGV4ID09IHRvdGFsIC0gMSkgewogICAgICAgIHRoaXMuYWRkUm93Q2FzaFJlY2VpcHQoKTsKICAgICAgfQogICAgfSwKICAgIGFkZEV4dHJhUm93UmVsYXRlZEV4cGVuc2UodWlkKSB7CiAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMucmVsYXRlZEV4cGVuc2VEUy5rZW5kb1dpZGdldCgpLAogICAgICAgIHRvdGFsID0gZHMudG90YWwoKSwKICAgICAgICByb3cgPSBkcy5nZXRCeVVpZCh1aWQpLAogICAgICAgIGluZGV4ID0gZHMuaW5kZXhPZihyb3cpOwoKICAgICAgaWYgKGluZGV4ID09IHRvdGFsIC0gMSkgewogICAgICAgIHRoaXMuYWRkUm93UmVsYXRlZEV4cGVuc2UoKTsKICAgICAgfQogICAgfSwKICAgIGFkZEV4dHJhUm93UmV2ZW51ZURlZmZlcmVkR3JhbnQodWlkKSB7CiAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMucmV2ZW51ZURlZmZlcmVkR3JhbnREUy5rZW5kb1dpZGdldCgpLAogICAgICAgIHRvdGFsID0gZHMudG90YWwoKSwKICAgICAgICByb3cgPSBkcy5nZXRCeVVpZCh1aWQpLAogICAgICAgIGluZGV4ID0gZHMuaW5kZXhPZihyb3cpOwoKICAgICAgaWYgKGluZGV4ID09IHRvdGFsIC0gMSkgewogICAgICAgIHRoaXMuYWRkUm93UmV2ZW51ZURlZmZlcmVkR3JhbnQoKTsKICAgICAgfQogICAgfSwKICAgIC8vIFJlbW92ZSBSb3cKICAgIHJlbW92ZVJvd0Nhc2hSZWNlaXB0KGUpIHsKICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgbGV0IGdyaWQgPSB0aGlzLiRyZWZzLmNhc2hSZWNlaXB0R3JpZC5rZW5kb1dpZGdldCgpLAogICAgICAgIGRzID0gZ3JpZC5kYXRhU291cmNlLAogICAgICAgIGRhdGFJdGVtID0gZ3JpZC5kYXRhSXRlbShrZW5kby5qUXVlcnkoZS5jdXJyZW50VGFyZ2V0KS5jbG9zZXN0KCJ0ciIpKTsKCiAgICAgIGlmIChkcy5kYXRhKCkubGVuZ3RoID4gMikgewogICAgICAgIGRzLnJlbW92ZShkYXRhSXRlbSk7CiAgICAgIH0KICAgIH0sCiAgICByZW1vdmVSb3dSZWxhdGVkRXhwZW5zZShlKSB7CiAgICAgIGUucHJldmVudERlZmF1bHQoKTsKCiAgICAgIGxldCBncmlkID0gdGhpcy4kcmVmcy5yZWxhdGVkRXhwZW5zZUdyaWQua2VuZG9XaWRnZXQoKSwKICAgICAgICBkcyA9IGdyaWQuZGF0YVNvdXJjZSwKICAgICAgICBkYXRhSXRlbSA9IGdyaWQuZGF0YUl0ZW0oa2VuZG8ualF1ZXJ5KGUuY3VycmVudFRhcmdldCkuY2xvc2VzdCgidHIiKSk7CgogICAgICBpZiAoZHMudG90YWwoKSA+IDIpIHsKICAgICAgICBkcy5yZW1vdmUoZGF0YUl0ZW0pOwogICAgICB9CiAgICB9LAogICAgcmVtb3ZlUm93UmV2ZW51ZURlZmZlcmVkR3JhbnQoZSkgewogICAgICBlLnByZXZlbnREZWZhdWx0KCk7CgogICAgICBsZXQgZ3JpZCA9IHRoaXMuJHJlZnMucmV2ZW51ZURlZmZlcmVkR3JhbnRHcmlkLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgZHMgPSBncmlkLmRhdGFTb3VyY2UsCiAgICAgICAgZGF0YUl0ZW0gPSBncmlkLmRhdGFJdGVtKGtlbmRvLmpRdWVyeShlLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoInRyIikpOwoKICAgICAgaWYgKGRzLnRvdGFsKCkgPiAyKSB7CiAgICAgICAgZHMucmVtb3ZlKGRhdGFJdGVtKTsKICAgICAgfQogICAgfSwKICAgIC8vIFNocmluayBEYXRhCiAgICBzaHJpbmtEYXRhKCkgewogICAgICAvLyBKb3VybmFsIERhdGUKICAgICAgdGhpcy5qb3VybmFsLmpvdXJuYWxfZGF0ZSA9IEhlbHBlci50b0lTT0RhdGUodGhpcy5qb3VybmFsLmpvdXJuYWxfZGF0ZSk7CgogICAgICAvKiBKb3VybmFsIFR5cGUgKi8KICAgICAgdGhpcy5qb3VybmFsLmpvdXJuYWxfdHlwZSA9IHRoaXMuZnVuZENhdGVnb3J5Lm5hbWU7CgogICAgICAvKiBQcm9qZWN0IFNlZ21lbnQgTG9jYXRpb24gKi8KICAgICAgdGhpcy5qb3VybmFsLnByb2plY3RfdXVpZCA9IHRoaXMucHJvamVjdC5pZDsKICAgICAgdGhpcy5qb3VybmFsLnNlZ21lbnRfdXVpZCA9IHRoaXMuc2VnbWVudC5pZDsKICAgICAgdGhpcy5qb3VybmFsLmxvY2F0aW9uX3V1aWQgPSB0aGlzLmxvY2F0aW9uLmlkOwoKICAgICAgLy8gVXNlcgogICAgICBpZiAodGhpcy5pc0VkaXQpIHsKICAgICAgICB0aGlzLmpvdXJuYWwubW9kaWZpZWRfYnkgPSB0aGlzLnVzZXI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5qb3VybmFsLmNyZWF0ZWRfYnkgPSB0aGlzLnVzZXI7CiAgICAgIH0KCiAgICAgIGxldCBlbnRyaWVzID0gW10sCiAgICAgICAgY2FzaFJlY2VpcHREUyA9IHRoaXMuJHJlZnMuY2FzaFJlY2VpcHREUy5rZW5kb1dpZGdldCgpLAogICAgICAgIHJlbGF0ZWRFeHBlbnNlRFMgPSB0aGlzLiRyZWZzLnJlbGF0ZWRFeHBlbnNlRFMua2VuZG9XaWRnZXQoKSwKICAgICAgICByZXZlbnVlRGVmZmVyZWRHcmFudERTID0KICAgICAgICAgIHRoaXMuJHJlZnMucmV2ZW51ZURlZmZlcmVkR3JhbnREUy5rZW5kb1dpZGdldCgpOwoKICAgICAgLy8gQ2FzaCBSZWNlaXB0IEFjY291bnRzIG9uIERyCiAgICAgIGNhc2hSZWNlaXB0RFMuZGF0YSgpLmZvckVhY2goKHZhbHVlKSA9PiB7CiAgICAgICAgLy8gRmlsdGVyIHNlbGVjdGVkIGFjY291bnQKICAgICAgICBpZiAodmFsdWUuYWNjb3VudC5udW1iZXIgIT09ICIiICYmIHZhbHVlLmFtb3VudCA+IDApIHsKICAgICAgICAgIC8vIEFjY291bnQKICAgICAgICAgIHZhbHVlLnNldCgiYWNjb3VudCIsIG5ldyBBY2NvdW50TW9kZWwodmFsdWUuYWNjb3VudCkpOwogICAgICAgICAgdmFsdWUuc2V0KCJhY2NvdW50X3V1aWQiLCB2YWx1ZS5hY2NvdW50LnV1aWQpOwoKICAgICAgICAgIC8vIENvbnRhY3QKICAgICAgICAgIHZhbHVlLnNldCgicHJpbWFyeV9jb250YWN0IiwgbmV3IENvbnRhY3RNb2RlbCh0aGlzLmRvbm9yKSk7CgogICAgICAgICAgLy8gQ3VycmVuY3kKICAgICAgICAgIHZhbHVlLnNldCgiY3VycmVuY3kiLCBuZXcgQ3VycmVuY3lNb2RlbCh0aGlzLmN1cnJlbmN5KSk7CiAgICAgICAgICB2YWx1ZS5zZXQoImV4Y2hhbmdlX3JhdGVfdXVpZCIsIHRoaXMuZXhjaGFuZ2VSYXRlLmlkKTsKICAgICAgICAgIHZhbHVlLnNldCgiZXhjaGFuZ2VfcmF0ZSIsIHRoaXMuZXhjaGFuZ2VSYXRlLnJhdGUpOwoKICAgICAgICAgIGVudHJpZXMucHVzaChuZXcgSm91cm5hbEVudHJ5TW9kZWwodmFsdWUpKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgLy8gUmVsYXRlZCBFeHBlbnNlIEFjY291bnRzIG9uIERyCiAgICAgIHJlbGF0ZWRFeHBlbnNlRFMuZGF0YSgpLmZvckVhY2goKHZhbHVlKSA9PiB7CiAgICAgICAgLy8gRmlsdGVyIHNlbGVjdGVkIGFjY291bnQKICAgICAgICBpZiAodmFsdWUuYWNjb3VudC5udW1iZXIgIT09ICIiICYmIHZhbHVlLmFtb3VudCA+IDApIHsKICAgICAgICAgIC8vIEFjY291bnQKICAgICAgICAgIHZhbHVlLnNldCgiYWNjb3VudCIsIG5ldyBBY2NvdW50TW9kZWwodmFsdWUuYWNjb3VudCkpOwogICAgICAgICAgdmFsdWUuc2V0KCJhY2NvdW50X3V1aWQiLCB2YWx1ZS5hY2NvdW50LnV1aWQpOwoKICAgICAgICAgIC8vIENvbnRhY3QKICAgICAgICAgIHZhbHVlLnNldCgicHJpbWFyeV9jb250YWN0IiwgbmV3IENvbnRhY3RNb2RlbCh0aGlzLmRvbm9yKSk7CgogICAgICAgICAgLy8gQ3VycmVuY3kKICAgICAgICAgIHZhbHVlLnNldCgiY3VycmVuY3kiLCBuZXcgQ3VycmVuY3lNb2RlbCh0aGlzLmN1cnJlbmN5KSk7CiAgICAgICAgICB2YWx1ZS5zZXQoImV4Y2hhbmdlX3JhdGVfdXVpZCIsIHRoaXMuZXhjaGFuZ2VSYXRlLmlkKTsKICAgICAgICAgIHZhbHVlLnNldCgiZXhjaGFuZ2VfcmF0ZSIsIHRoaXMuZXhjaGFuZ2VSYXRlLnJhdGUpOwoKICAgICAgICAgIGVudHJpZXMucHVzaChuZXcgSm91cm5hbEVudHJ5TW9kZWwodmFsdWUpKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgLy8gUmV2ZW51ZSBEZWZmZXJlZCBHcmFudCBBY2NvdW50IG9uIENyCiAgICAgIHJldmVudWVEZWZmZXJlZEdyYW50RFMuZGF0YSgpLmZvckVhY2goKHZhbHVlKSA9PiB7CiAgICAgICAgLy8gRmlsdGVyIHNlbGVjdGVkIGFjY291bnQKICAgICAgICBpZiAodmFsdWUuYWNjb3VudC5udW1iZXIgIT09ICIiICYmIHZhbHVlLmFtb3VudCA+IDApIHsKICAgICAgICAgIC8vIEFjY291bnQKICAgICAgICAgIHZhbHVlLnNldCgiYWNjb3VudCIsIG5ldyBBY2NvdW50TW9kZWwodmFsdWUuYWNjb3VudCkpOwogICAgICAgICAgdmFsdWUuc2V0KCJhY2NvdW50X3V1aWQiLCB2YWx1ZS5hY2NvdW50LnV1aWQpOwoKICAgICAgICAgIC8vIENvbnRhY3QKICAgICAgICAgIHZhbHVlLnNldCgicHJpbWFyeV9jb250YWN0IiwgbmV3IENvbnRhY3RNb2RlbCh0aGlzLmRvbm9yKSk7CgogICAgICAgICAgLy8gQ3VycmVuY3kKICAgICAgICAgIHZhbHVlLnNldCgiY3VycmVuY3kiLCBuZXcgQ3VycmVuY3lNb2RlbCh0aGlzLmN1cnJlbmN5KSk7CiAgICAgICAgICB2YWx1ZS5zZXQoImFtb3VudCIsIHZhbHVlLmFtb3VudCAqIC0xKTsgLy8gQ3JlZGl0IHNpZGUgaXMgbmVnYXRpdmUKICAgICAgICAgIHZhbHVlLnNldCgiZXhjaGFuZ2VfcmF0ZV91dWlkIiwgdGhpcy5leGNoYW5nZVJhdGUuaWQpOwogICAgICAgICAgdmFsdWUuc2V0KCJleGNoYW5nZV9yYXRlIiwgdGhpcy5leGNoYW5nZVJhdGUucmF0ZSk7CgogICAgICAgICAgZW50cmllcy5wdXNoKG5ldyBKb3VybmFsRW50cnlNb2RlbCh2YWx1ZSkpOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICAvLyBKb3VybmFsIEVudHJpZXMKICAgICAgdGhpcy5qb3VybmFsLmpvdXJuYWxfZW50cmllcyA9IGVudHJpZXM7CiAgICB9LAogICAgLy8gVmFsaWRhdGluZwogICAgdmFsaWRhdGVGb3JtKCkgewogICAgICBsZXQgcmVzdWx0ID0gdHJ1ZSwKICAgICAgICBtc2cgPSAiIiwKICAgICAgICBjYXNoUmVjZWlwdERTID0gdGhpcy4kcmVmcy5jYXNoUmVjZWlwdERTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgcmVsYXRlZEV4cGVuc2VEUyA9IHRoaXMuJHJlZnMucmVsYXRlZEV4cGVuc2VEUy5rZW5kb1dpZGdldCgpLAogICAgICAgIHJldmVudWVEZWZmZXJlZEdyYW50RFMgPQogICAgICAgICAgdGhpcy4kcmVmcy5yZXZlbnVlRGVmZmVyZWRHcmFudERTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgY291bnRFbXB0eUNhc2hSZWNlaXB0ID0gMCwKICAgICAgICBjb3VudEVtcHR5UmV2ZW51ZURlZmZlcmVkR3JhbnQgPSAwOwoKICAgICAgLy8gRG9ub3IKICAgICAgaWYgKHRoaXMuZG9ub3IuaWQgPT09ICIiKSB7CiAgICAgICAgbXNnICs9IGA8cD4ke2kxOG4udCgiZG9ub3JfaXNfcmVxdWlyZWQiKX08L3A+YDsKICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgLy8gUHJvamVjdAogICAgICBpZiAodGhpcy5wcm9qZWN0LmlkID09PSAiIikgewogICAgICAgIG1zZyArPSBgPHA+JHtpMThuLnQoInByb2plY3RfaXNfcmVxdWlyZWQiKX08L3A+YDsKICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgLy8gU2VnbWVudAogICAgICBpZiAodGhpcy5zZWdtZW50LmlkID09PSAiIikgewogICAgICAgIG1zZyArPSBgPHA+JHtpMThuLnQoInNlZ21lbnRfaXNfcmVxdWlyZWQiKX08L3A+YDsKICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgLy8gTG9jYXRpb24KICAgICAgaWYgKHRoaXMubG9jYXRpb24uaWQgPT09ICIiKSB7CiAgICAgICAgbXNnICs9IGA8cD4ke2kxOG4udCgibG9jYXRpb25faXNfcmVxdWlyZWQiKX08L3A+YDsKICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgLy8gQ2FzaCBSZWNlaXB0CiAgICAgIGNhc2hSZWNlaXB0RFMuZGF0YSgpLmZvckVhY2goKHZhbHVlLCBpbmRleCkgPT4gewogICAgICAgIC8vIE5vIGFjY291bnQKICAgICAgICBpZiAodmFsdWUuYWNjb3VudC5uYW1lID09PSAiIiAmJiB2YWx1ZS5hbW91bnQgPiAwKSB7CiAgICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgICAgIG1zZyArPSBgPHA+JHtpMThuLnQoCiAgICAgICAgICAgICJwbGVhc2Vfc2VsZWN0X2Nhc2hfcmVjZWlwdF9hY2NvdW50X2F0X3Jvd19udW1iZXIiCiAgICAgICAgICApfSAke2luZGV4ICsgMX08L3A+YDsKICAgICAgICB9CgogICAgICAgIC8vIE5vIGFtb3VudAogICAgICAgIGlmICh2YWx1ZS5hY2NvdW50Lm5hbWUgIT09ICIiICYmIHZhbHVlLmFtb3VudCA9PT0gMCkgewogICAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICBtc2cgKz0gYDxwPiR7dmFsdWUuYWNjb3VudC5uYW1lfSAke2kxOG4udCgiaGFzX25vX2Ftb3VudCIpfTwvcD5gOwogICAgICAgIH0KCiAgICAgICAgLy8gQ291bnQgRnJvbSBBY2NvdW50cwogICAgICAgIGlmICh2YWx1ZS5hY2NvdW50Lm5hbWUgIT09ICIiICYmIHZhbHVlLmFtb3VudCA+IDApIHsKICAgICAgICAgIGNvdW50RW1wdHlDYXNoUmVjZWlwdCsrOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICAvLyBFbXB0eSBSb3cgRnJvbSBBY2NvdW50cwogICAgICBpZiAoY291bnRFbXB0eUNhc2hSZWNlaXB0ID09PSAwKSB7CiAgICAgICAgbXNnICs9IGA8cD4ke2kxOG4udCgicGxlYXNlX3NlbGVjdF9jYXNoX3JlY2VpcHRfYWNjb3VudCIpfTwvcD5gOwogICAgICAgIHJlc3VsdCA9IGZhbHNlOwogICAgICB9CgogICAgICAvLyBSZWxhdGVkIEV4cGVuc2UKICAgICAgcmVsYXRlZEV4cGVuc2VEUy5kYXRhKCkuZm9yRWFjaCgodmFsdWUsIGluZGV4KSA9PiB7CiAgICAgICAgLy8gTm8gYWNjb3VudAogICAgICAgIGlmICh2YWx1ZS5hY2NvdW50Lm5hbWUgPT09ICIiICYmIHZhbHVlLmFtb3VudCA+IDApIHsKICAgICAgICAgIHJlc3VsdCA9IGZhbHNlOwogICAgICAgICAgbXNnICs9IGA8cD4ke2kxOG4udCgKICAgICAgICAgICAgInBsZWFzZV9zZWxlY3RfcmVsYXRlZF9leHBlbnNlX2FjY291bnRfYXRfcm93X251bWJlciIKICAgICAgICAgICl9ICR7aW5kZXggKyAxfTwvcD5gOwogICAgICAgIH0KCiAgICAgICAgLy8gTm8gYW1vdW50CiAgICAgICAgaWYgKHZhbHVlLmFjY291bnQubmFtZSAhPT0gIiIgJiYgdmFsdWUuYW1vdW50ID09PSAwKSB7CiAgICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgICAgIG1zZyArPSBgPHA+JHt2YWx1ZS5hY2NvdW50Lm5hbWV9ICR7aTE4bi50KCJoYXNfbm9fYW1vdW50Iil9PC9wPmA7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIC8vIFJlbGF0ZWQgRXhwZW5zZQogICAgICByZXZlbnVlRGVmZmVyZWRHcmFudERTLmRhdGEoKS5mb3JFYWNoKCh2YWx1ZSwgaW5kZXgpID0+IHsKICAgICAgICAvLyBObyBhY2NvdW50CiAgICAgICAgaWYgKHZhbHVlLmFjY291bnQubmFtZSA9PT0gIiIgJiYgdmFsdWUuYW1vdW50ID4gMCkgewogICAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICBtc2cgKz0gYDxwPiR7aTE4bi50KAogICAgICAgICAgICAicGxlYXNlX3NlbGVjdF9yZXZlbnVlX2RlZmZlcmVkX2dyYW50X2FjY291bnRfYXRfcm93X251bWJlciIKICAgICAgICAgICl9ICR7aW5kZXggKyAxfTwvcD5gOwogICAgICAgIH0KCiAgICAgICAgLy8gTm8gYW1vdW50CiAgICAgICAgaWYgKHZhbHVlLmFjY291bnQubmFtZSAhPT0gIiIgJiYgdmFsdWUuYW1vdW50ID09PSAwKSB7CiAgICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgICAgIG1zZyArPSBgPHA+JHt2YWx1ZS5hY2NvdW50Lm5hbWV9ICR7aTE4bi50KCJoYXNfbm9fYW1vdW50Iil9PC9wPmA7CiAgICAgICAgfQoKICAgICAgICAvLyBDb3VudCBUbyBBY2NvdW50cwogICAgICAgIGlmICh2YWx1ZS5hY2NvdW50Lm5hbWUgIT09ICIiICYmIHZhbHVlLmFtb3VudCA+IDApIHsKICAgICAgICAgIGNvdW50RW1wdHlSZXZlbnVlRGVmZmVyZWRHcmFudCsrOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICAvLyBFbXB0eSBSb3cgVG8KICAgICAgaWYgKGNvdW50RW1wdHlSZXZlbnVlRGVmZmVyZWRHcmFudCA9PT0gMCkgewogICAgICAgIG1zZyArPSBgPHA+JHtpMThuLnQoCiAgICAgICAgICAicGxlYXNlX3NlbGVjdF9yZXZlbnVlX2RlZmZlcmVkX2dyYW50X2FjY291bnQiCiAgICAgICAgKX08L3A+YDsKICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgLy8gQWxsIHRvdGFscwogICAgICBpZiAoa2VuZG8ucGFyc2VGbG9hdCh0aGlzLnRvdGFsRHIpICE9PSBrZW5kby5wYXJzZUZsb2F0KHRoaXMudG90YWxDcikpIHsKICAgICAgICBtc2cgKz0gYDxwPiR7aTE4bi50KCJ0b3RhbF9kcl9hbmRfdG90YWxfY3JfYXJlX25vdF9iYWxhbmNlIil9PC9wPmA7CiAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIC8vIFNob3cgQWxlcnQKICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSBtc2c7CiAgICAgIHRoaXMuYWxlcnQgPSBmYWxzZTsKICAgICAgaWYgKHJlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgICB0aGlzLmFsZXJ0ID0gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0sCiAgICAvLyBBbGwgU2F2ZXMKICAgIGFzeW5jIG9uU2F2ZU9wdGlvbkNsaWNrKG1vZGUpIHsKICAgICAgaWYgKHRoaXMuJHJlZnMuZm9ybS52YWxpZGF0ZSgpICYmIHRoaXMudmFsaWRhdGVGb3JtKCkpIHsKICAgICAgICBsZXQgaXNWYWxpZENsb3NpbmdEYXRlID0gYXdhaXQgSGVscGVyLnZhbGlkYXRlQ2xvc2luZ0RhdGUoCiAgICAgICAgICB0aGlzLmpvdXJuYWwuam91cm5hbF9kYXRlCiAgICAgICAgKTsKICAgICAgICBpZiAoaXNWYWxpZENsb3NpbmdEYXRlKSB7CiAgICAgICAgICB0aGlzLnNhdmVNb2RlID0gbW9kZTsKICAgICAgICAgIHRoaXMuc2F2ZSgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGNhbmNlbCgpIHsKICAgICAgdGhpcy4kc3dhbCh7CiAgICAgICAgdGl0bGU6IGkxOG4udCgibXNnX3RpdGxlX3dhcm5pbmciKSwKICAgICAgICB0ZXh0OiBpMThuLnQoIm1zZ19kaXNjYXJkIiksCiAgICAgICAgaWNvbjogIndhcm5pbmciLAogICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogaTE4bi50KCJjYW5jZWwiKSwKICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjNGQ0ODQ4IiwKICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNFRDFBM0EiLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBpMThuLnQoImRpc2NhcmQiKSwKICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgdGhpcy5jbGVhcigpOwogICAgICAgICAgdGhpcy5zZXREZWZhdWx0RGF0YSgpOwogICAgICAgICAgdGhpcy4kcm91dGVyLmdvKC0xKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGNsZWFyKCkgewogICAgICB0aGlzLmlzRWRpdCA9IGZhbHNlOwogICAgICB0aGlzLnNhdmVNb2RlID0gIiI7CgogICAgICB0aGlzLmN1cnJlbmN5ID0gbmV3IEN1cnJlbmN5TW9kZWwoaW5zdGl0dXRlLmJhc2VDdXJyZW5jeSk7CiAgICAgIHRoaXMuZXhjaGFuZ2VSYXRlID0gbmV3IEV4Y2hhbmdlUmF0ZU1vZGVsKGluc3RpdHV0ZS5iYXNlQ3VycmVuY3kpOwoKICAgICAgdGhpcy5kb25vciA9IG5ldyBDb250YWN0TW9kZWwoKTsKICAgICAgdGhpcy5zZWdtZW50ID0gbmV3IFNlZ21lbnRNb2RlbCgpOwogICAgICB0aGlzLnByb2plY3QgPSBuZXcgUHJvamVjdE1vZGVsKCk7CiAgICAgIHRoaXMubG9jYXRpb24gPSBuZXcgTG9jYXRpb25Nb2RlbCgpOwoKICAgICAgbGV0IGNhc2hSZWNlaXB0RFMgPSB0aGlzLiRyZWZzLmNhc2hSZWNlaXB0RFMua2VuZG9XaWRnZXQoKTsKICAgICAgY2FzaFJlY2VpcHREUy5kYXRhKFtdKTsKICAgICAgbGV0IHJlbGF0ZWRFeHBlbnNlRFMgPSB0aGlzLiRyZWZzLnJlbGF0ZWRFeHBlbnNlRFMua2VuZG9XaWRnZXQoKTsKICAgICAgcmVsYXRlZEV4cGVuc2VEUy5kYXRhKFtdKTsKICAgICAgbGV0IHJldmVudWVEZWZmZXJlZEdyYW50RFMgPQogICAgICAgIHRoaXMuJHJlZnMucmV2ZW51ZURlZmZlcmVkR3JhbnREUy5rZW5kb1dpZGdldCgpOwogICAgICByZXZlbnVlRGVmZmVyZWRHcmFudERTLmRhdGEoW10pOwogICAgfSwKICAgIGNvbmZpcm1EZWxldGUoKSB7CiAgICAgIHRoaXMuJHN3YWwoewogICAgICAgIHRpdGxlOiBpMThuLnQoImFyZV95b3Vfc3VyZV95b3Vfd2FudF90b19kZWxldGVfaXQiKSwKICAgICAgICB0ZXh0OiBpMThuLnQoInlvdV93b250X2JlX2FibGVfdG9fcmV2ZXJ0X3RoaXMiKSwKICAgICAgICBpY29uOiAid2FybmluZyIsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjNGQ0ODQ4IiwKICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNFRDFBM0EiLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiWWVzIiwKICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgdGhpcy5zYXZlTW9kZSA9IFNhdmVPcHRpb24uREVMRVRFOwoKICAgICAgICAgIC8qIE1hcmsgYXMgZGVsZXRlZCAqLwogICAgICAgICAgdGhpcy5qb3VybmFsLmlzX2RlbGV0ZWQgPSAxOwoKICAgICAgICAgIC8qIFVwZGF0ZSBKb3VybmFsIFN0YXR1cyAqLwogICAgICAgICAgdGhpcy5zYXZlKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBzYXZlKCkgewogICAgICBsZXQgc2VsZiA9IHRoaXM7CgogICAgICAvLyBEcmFmdCBNb2RlCiAgICAgIGlmICh0aGlzLnNhdmVNb2RlID09PSBTYXZlT3B0aW9uLlNBVkVEUkFGVCkgewogICAgICAgIHRoaXMuam91cm5hbC5pc19kcmFmdCA9IDE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5qb3VybmFsLmlzX2RyYWZ0ID0gMDsKICAgICAgfQoKICAgICAgLy8gU2hyaW5rIERhdGEKICAgICAgdGhpcy5zaHJpbmtEYXRhKCk7CgogICAgICAvLyBTeW5jIERhdGEKICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgIGpvdXJuYWxIYW5kbGVyCiAgICAgICAgLnNhdmUobmV3IEpvdXJuYWxNb2RlbCh0aGlzLmpvdXJuYWwpKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIHNlbGYucmVzcG9uc2VTdGF0dXMocmVzcG9uc2UpOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgc2VsZi5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgSGVscGVyLmFsZXJ0RXJyb3JNc2coZXJyb3IpOwogICAgICAgIH0pCiAgICAgICAgLmZpbmFsbHkoKCkgPT4gewogICAgICAgICAgc2VsZi5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIC8vIFJlc3BvbnNlIFN0YXR1cwogICAgcmVzcG9uc2VTdGF0dXMocmVzcG9uc2UpIHsKICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgaWYgKAogICAgICAgICAgdGhpcy5zYXZlTW9kZSA9PT0gU2F2ZU9wdGlvbi5TQVZFQ0xPU0UgfHwKICAgICAgICAgIHRoaXMuc2F2ZU1vZGUgPT09IFNhdmVPcHRpb24uREVMRVRFCiAgICAgICAgKSB7CiAgICAgICAgICAvKiBTYXZlIENsb3NlIG9yIERlbGV0ZSAqLwogICAgICAgICAgaWYgKHRoaXMuaXNFZGl0KSB7CiAgICAgICAgICAgIHRoaXMuZ29CYWNrVG9WaWV3UGFnZSgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy4kcm91dGVyLmdvKC0xKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmNsZWFyKCk7CiAgICAgICAgICB0aGlzLnNldERlZmF1bHREYXRhKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8qIFNhdmUgTmV3ICovCiAgICAgICAgICB0aGlzLmNsZWFyKCk7CiAgICAgICAgICB0aGlzLnNldERlZmF1bHREYXRhKCk7CiAgICAgICAgfQoKICAgICAgICAvKiBBbGVydCBTdWNjZXNzICovCiAgICAgICAgdGhpcy4kc25vdGlmeS5zdWNjZXNzKGkxOG4udCgic3VjY2Vzc2Z1bCIpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvKiBBbGVydCBFcnJvciAqLwogICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoaTE4bi50KCJlcnJvcl9zb21ldGhpbmdfd3JvbmciKSk7CiAgICAgIH0KICAgIH0sCiAgICAvLyBHbyBiYWNrIHRvIHZpZXcgcGFnZSBhZnRlciBlZGl0IG1vZGUKICAgIGdldEpvdXJuYWwoKSB7CiAgICAgIHJldHVybiB0aGlzLmpvdXJuYWw7CiAgICB9LAogICAgZ29CYWNrVG9WaWV3UGFnZSgpIHsKICAgICAgdGhpcy4kcm91dGVyLnJlcGxhY2UoewogICAgICAgIG5hbWU6ICJGdW5kIFJlY2VpcHQgVmlldyIsCiAgICAgICAgcGFyYW1zOiB7IGluaXRKb3VybmFsOiB0aGlzLmdldEpvdXJuYWwoKSB9LAogICAgICB9KTsKICAgIH0sCiAgfSwKICB3YXRjaDogewogICAgaW5pdEpvdXJuYWwoKSB7CiAgICAgIHRoaXMuaW5pdGlhbERhdGEoKTsKICAgIH0sCiAgfSwKICBjcmVhdGVkKCkge30sCiAgbW91bnRlZCgpIHsKICAgIC8vIEluaXRpYWwgRGF0YQogICAgdGhpcy5pbml0aWFsRGF0YSgpOwogIH0sCn07Cg=="},{"version":3,"sources":["FundReceipt.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4sBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"FundReceipt.vue","sourceRoot":"src/views/share_funding","sourcesContent":["<template>\n  <v-app>\n    <v-container>\n      <v-row>\n        <v-col cols=\"12\" sm=\"12\">\n          <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n            <v-card\n              outlined\n              dense\n              class=\"pa-4 no_border rounded-sm\"\n              color=\"white\"\n            >\n              <v-row>\n                <v-col\n                  class=\"bigSide pr-2 py-0\"\n                  sm=\"8\"\n                  cols=\"12\"\n                  style=\"transition: 0.3s ease-in\"\n                  :class=\"{ hide_big_bar_class: isHideBar }\"\n                >\n                  <v-card outlined dense class=\"no_border\">\n                    <h2 class=\"mb-0\">{{ $t(\"fund_receipt\") }}</h2>\n                    <v-icon\n                      v-if=\"isHideBar\"\n                      onclick=\"window.history.go(-1); return false;\"\n                      style=\"cursor: pointer; color: #333; font-size: 40px\"\n                      class=\"float-right\"\n                      >close\n                    </v-icon>\n                    <span\n                      style=\"transition: 0.3s ease-in; z-index: 10\"\n                      :class=\"{\n                        iconArrow: !isHideBar,\n                        iconArrowHide: isHideBar,\n                      }\"\n                    >\n                      <v-icon\n                        size=\"22\"\n                        class=\"arr_icon\"\n                        @click=\"HideSmallSideBar\"\n                        v-if=\"isHideBar\"\n                        >mdi-chevron-left-circle\n                      </v-icon>\n                      <v-icon\n                        size=\"22\"\n                        class=\"arr_icon\"\n                        @click=\"HideSmallSideBar\"\n                        v-if=\"!isHideBar\"\n                        >mdi-chevron-right-circle\n                      </v-icon>\n                    </span>\n                  </v-card>\n                  <v-card outlined dense class=\"px-3 no_border\" color=\"grayBg\">\n                    <v-row class=\"\">\n                      <v-col sm=\"6\" cols=\"12\" class=\"pb-0\">\n                        <label class=\"label\">{{ $t(\"donor\") }}</label>\n                        <app-donor-dropdownlist\n                          :initDonor=\"donor\"\n                          @emitDonor=\"donor = $event\"\n                          @onChanged=\"getExchangeRate\"\n                        />\n\n                        <label class=\"label\">{{ $t(\"date\") }}</label>\n                        <app-datepicker\n                          :initialDate=\"journal.journal_date\"\n                          @emitDate=\"journal.journal_date = $event\"\n                          @onChanged=\"onDateChanges\"\n                        />\n                        <label class=\"label\">{{ $t(\"number\") }}</label>\n                        <v-row>\n                          <v-col sm=\"10\" cols=\"10\" class=\"pb-0 pr-0 pt-1\">\n                            <v-text-field\n                              v-model=\"journal.number\"\n                              outlined\n                              :rules=\"[(v) => !!v || 'Number is required']\"\n                              readonly\n                              required\n                            />\n                          </v-col>\n                          <v-col sm=\"2\" cols=\"2\" class=\"pb-0 pl-1 pt-1\">\n                            <v-icon\n                              color=\"black\"\n                              size=\"30\"\n                              class=\"border_qrcode\"\n                              @click=\"generateNumber\"\n                              >mdi-qrcode</v-icon\n                            >\n                          </v-col>\n                        </v-row>\n                        <label class=\"label\">{{ $t(\"currency\") }}</label>\n                        <app-currency-dropdownlist\n                          :initCurrency=\"currency\"\n                          @emitCurrency=\"currency = $event\"\n                          @onChanged=\"getExchangeRate\"\n                        />\n                      </v-col>\n\n                      <v-col sm=\"6\" cols=\"12\" class=\"pb-0\">\n                        <label class=\"label\">{{ $t(\"fund_categories\") }}</label>\n                        <app-fund-category-dropdownlist\n                          :initFundCategory=\"fundCategory\"\n                          @emitFundCategory=\"fundCategory = $event\"\n                        />\n\n                        <label class=\"label\">{{ $t(\"contract\") }}</label>\n                        <v-text-field outlined class=\"mt-1\" />\n\n                        <label class=\"label\">{{ $t(\"description\") }}</label>\n                        <v-textarea\n                          class=\"mt-1\"\n                          height=\"120px\"\n                          no-resize\n                          v-model=\"journal.description\"\n                          outlined\n                          rows=\"4\"\n                          :placeholder=\"$t('transaction_purpose')\"\n                        />\n                      </v-col>\n                    </v-row>\n                  </v-card>\n\n                  <v-card outlined dense class=\"no_border\" color=\"white\">\n                    <!-- Grid 1 -->\n                    <v-row\n                      style=\"\n                        background-color: rgb(255, 255, 255);\n                        width: 100%;\n                        margin: 0 auto 0px;\n                      \"\n                    >\n                      <v-col sm=\"12\" cols=\"12\" class=\"pb-3 pa-0\">\n                        <h2 class=\"mb-0 font_18\">{{ $t(\"cash_receipt\") }}</h2>\n                        <kendo-datasource\n                          ref=\"cashReceiptDS\"\n                          :data=\"cashReceiptEntries\"\n                          :change=\"onChangeCashReceiptDS\"\n                        />\n\n                        <kendo-grid\n                          id=\"cashReceiptGrid\"\n                          ref=\"cashReceiptGrid\"\n                          class=\"grid-function\"\n                          :data-source-ref=\"'cashReceiptDS'\"\n                          :sortable=\"false\"\n                          :filterable=\"false\"\n                          :column-menu=\"true\"\n                          :editable=\"true\"\n                          :scrollable-virtual=\"true\"\n                        >\n                          <kendo-grid-column\n                            :title=\"$t('no.')\"\n                            :template=\"rowNumberCashReceipt\"\n                            :width=\"45\"\n                            :column-menu=\"false\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5;',\n                              class: 'text-products',\n                            }\"\n                            :attributes=\"{\n                              style: 'text-align: products',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'account'\"\n                            :title=\"$t('account')\"\n                            :width=\"200\"\n                            :template=\"'<span>#=account.name#</span>'\"\n                            :editor=\"CashReceiptAccountEditor\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"''\"\n                            :hidden=\"\n                              !this.$store.state.accounting.secondaryAccount\n                            \"\n                            :title=\"$t('s_account')\"\n                            :width=\"200\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'description'\"\n                            :title=\"$t('description')\"\n                            :width=\"200\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'ref_number'\"\n                            :title=\"$t('reference_no')\"\n                            :width=\"160\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'amount'\"\n                            :title=\"$t('amount')\"\n                            :format=\"'{0:n}'\"\n                            :width=\"150\"\n                            :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                            :attributes=\"{ style: 'text-align: right; ' }\"\n                          />\n                          <kendo-grid-column\n                            :command=\"{\n                              iconClass: 'k-icon k-i-trash',\n                              text: 'Delete',\n                              click: removeRowCashReceipt,\n                              class: 'btn-plus',\n                            }\"\n                            :title=\"'&nbsp;'\"\n                            :width=\"100\"\n                            :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                          />\n                        </kendo-grid>\n                        <v-row style=\"background-color: #fff\">\n                          <v-col sm=\"1\" cols=\"12\" class=\"pb-0\">\n                            <v-btn\n                              class=\"float-left ml-0 rounded-0 btn_plus\"\n                              @click=\"addRowCashReceipt\"\n                            >\n                              <v-icon size=\"\" class=\"ma-1\">mdi-plus</v-icon>\n                            </v-btn>\n                          </v-col>\n                        </v-row>\n                      </v-col>\n                    </v-row>\n                    <!-- Grid 2 -->\n                    <v-row>\n                      <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                        <h2 class=\"mb-0 font_18\">\n                          {{ $t(\"related_expense\") }}\n                        </h2>\n                        <kendo-datasource\n                          ref=\"relatedExpenseDS\"\n                          :data=\"relatedExpenseEntries\"\n                          :change=\"onChangeRelatedExpenseDS\"\n                        />\n\n                        <kendo-grid\n                          id=\"relatedExpenseGrid\"\n                          ref=\"relatedExpenseGrid\"\n                          class=\"grid-function\"\n                          :data-source-ref=\"'relatedExpenseDS'\"\n                          :sortable=\"false\"\n                          :filterable=\"false\"\n                          :column-menu=\"true\"\n                          :editable=\"true\"\n                          :scrollable-virtual=\"true\"\n                        >\n                          <kendo-grid-column\n                            :title=\"$t('no.')\"\n                            :template=\"rowNumberRelatedExpense\"\n                            :width=\"45\"\n                            :column-menu=\"false\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5;',\n                              class: 'text-products',\n                            }\"\n                            :attributes=\"{\n                              style: 'text-align: products',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'account'\"\n                            :title=\"$t('account')\"\n                            :width=\"200\"\n                            :template=\"'<span>#=account.name#</span>'\"\n                            :editor=\"RelatedExpenseAccountEditor\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"''\"\n                            :hidden=\"\n                              !this.$store.state.accounting.secondaryAccount\n                            \"\n                            :title=\"$t('s_account')\"\n                            :width=\"200\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'description'\"\n                            :title=\"$t('description')\"\n                            :width=\"200\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'ref_number'\"\n                            :title=\"$t('reference_no')\"\n                            :width=\"160\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'amount'\"\n                            :title=\"$t('amount')\"\n                            :format=\"'{0:n}'\"\n                            :width=\"150\"\n                            :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                            :attributes=\"{ style: 'text-align: right; ' }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'class1'\"\n                            :title=\"$t('class_1')\"\n                            :template=\"'<span>#=class1.name#</span>'\"\n                            :width=\"200\"\n                            :editor=\"ClassEditor.class1\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'class2'\"\n                            :title=\"$t('class_2')\"\n                            :template=\"'<span>#=class2.name#</span>'\"\n                            :width=\"200\"\n                            :hidden=\"true\"\n                            :editor=\"ClassEditor.class2\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'class3'\"\n                            :title=\"$t('class_3')\"\n                            :template=\"'<span>#=class3.name#</span>'\"\n                            :hidden=\"true\"\n                            :width=\"200\"\n                            :editor=\"ClassEditor.class3\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'class4'\"\n                            :title=\"$t('class_4')\"\n                            :template=\"'<span>#=class4.name#</span>'\"\n                            :hidden=\"true\"\n                            :width=\"200\"\n                            :editor=\"ClassEditor.class4\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'class5'\"\n                            :title=\"$t('class_5')\"\n                            :template=\"'<span>#=class5.name#</span>'\"\n                            :hidden=\"true\"\n                            :width=\"200\"\n                            :editor=\"ClassEditor.class5\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :command=\"{\n                              iconClass: 'k-icon k-i-trash',\n                              text: 'Delete',\n                              click: removeRowRelatedExpense,\n                              class: 'btn-plus',\n                            }\"\n                            :title=\"'&nbsp;'\"\n                            :width=\"100\"\n                            :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                          />\n                        </kendo-grid>\n                        <v-row style=\"background-color: #fff\">\n                          <v-col sm=\"1\" cols=\"12\" class=\"pb-0\">\n                            <v-btn\n                              class=\"float-left ml-0 rounded-0 btn_plus\"\n                              @click=\"addRowRelatedExpense\"\n                            >\n                              <v-icon size=\"\" class=\"ma-1\">mdi-plus</v-icon>\n                            </v-btn>\n                          </v-col>\n                        </v-row>\n                      </v-col>\n                    </v-row>\n                    <!-- Grid 3 -->\n                    <v-row>\n                      <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                        <h2 class=\"mb-0 font_18\">\n                          {{ $t(\"revenue_deferred_grant\") }}\n                        </h2>\n                        <kendo-datasource\n                          ref=\"revenueDefferedGrantDS\"\n                          :data=\"revenueDefferedGrantEntries\"\n                          :change=\"onChangeRevenueDefferedGrantDS\"\n                        />\n\n                        <kendo-grid\n                          id=\"revenueDefferedGrantGrid\"\n                          ref=\"revenueDefferedGrantGrid\"\n                          class=\"grid-function\"\n                          :data-source-ref=\"'revenueDefferedGrantDS'\"\n                          :sortable=\"false\"\n                          :filterable=\"false\"\n                          :column-menu=\"true\"\n                          :editable=\"true\"\n                          :scrollable-virtual=\"true\"\n                        >\n                          <kendo-grid-column\n                            :title=\"$t('no.')\"\n                            :template=\"rowNumberRevenueDefferedGrant\"\n                            :width=\"45\"\n                            :column-menu=\"false\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5;',\n                              class: 'text-products',\n                            }\"\n                            :attributes=\"{\n                              style: 'text-align: products',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'account'\"\n                            :title=\"$t('account')\"\n                            :width=\"200\"\n                            :template=\"'<span>#=account.name#</span>'\"\n                            :editor=\"RevenueDefferedGrantAccountEditor\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"''\"\n                            :hidden=\"\n                              !this.$store.state.accounting.secondaryAccount\n                            \"\n                            :title=\"$t('s_account')\"\n                            :width=\"200\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'description'\"\n                            :title=\"$t('description')\"\n                            :width=\"200\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'ref_number'\"\n                            :title=\"$t('reference_no')\"\n                            :width=\"160\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'amount'\"\n                            :title=\"$t('amount')\"\n                            :format=\"'{0:n}'\"\n                            :width=\"150\"\n                            :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                            :attributes=\"{ style: 'text-align: right; ' }\"\n                          />\n                          <kendo-grid-column\n                            :command=\"{\n                              iconClass: 'k-icon k-i-trash',\n                              text: 'Delete',\n                              click: removeRowRevenueDefferedGrant,\n                              class: 'btn-plus',\n                            }\"\n                            :title=\"'&nbsp;'\"\n                            :width=\"100\"\n                            :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                          />\n                        </kendo-grid>\n                        <v-row style=\"background-color: #fff\">\n                          <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                            <v-btn\n                              class=\"float-left ml-0 rounded-0 btn_plus\"\n                              @click=\"addRowRevenueDefferedGrant\"\n                            >\n                              <v-icon size=\"\" class=\"ma-1\">mdi-plus</v-icon>\n                            </v-btn>\n                          </v-col>\n                          <v-col sm=\"4\" cols=\"12\" class=\"pb-0 pt-5\">\n                            <p>\n                              <span class=\"float-left\">{{\n                                $t(\"cash_receipt_and_related_expense\")\n                              }}</span>\n                              <span class=\"float-right text-bold\">{{\n                                Number(totalDr).toLocaleString()\n                              }}</span>\n                            </p>\n                          </v-col>\n                          <v-col sm=\"4\" cols=\"12\" class=\"pb-0 pt-5\">\n                            <p>\n                              <span class=\"float-left\">{{\n                                $t(\"revenue_deffered_grant\")\n                              }}</span>\n                              <span class=\"float-right text-bold\">{{\n                                Number(totalCr).toLocaleString()\n                              }}</span>\n                            </p>\n                          </v-col>\n                        </v-row>\n                      </v-col>\n                    </v-row>\n\n                    <v-divider />\n\n                    <v-card outlined dense class=\"no_border function_footer\">\n                      <!-- Warning Message -->\n                      <v-alert type=\"warning\" v-model=\"alert\" dismissible>\n                        <span v-html=\"errorMessage\" />\n                      </v-alert>\n\n                      <v-menu>\n                        <template v-slot:activator=\"{ on }\">\n                          <v-btn\n                            color=\"black\"\n                            outlined\n                            class=\"mr-2 text-capitalize black--text float-left\"\n                            v-on=\"on\"\n                          >\n                            {{ $t(\"select_template\") }}\n                            <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>\n                          </v-btn>\n                        </template>\n                        <v-list>\n                          <v-list-item\n                            v-for=\"(item, index) in templates\"\n                            :key=\"index\"\n                          >\n                            <v-list-item-title>{{\n                              item.title\n                            }}</v-list-item-title>\n                          </v-list-item>\n                        </v-list>\n                      </v-menu>\n                      <v-btn\n                        color=\"black\"\n                        class=\"text-capitalize white--text float-left\"\n                        @click=\"cancel\"\n                        >{{ $t(\"cancel\") }}</v-btn\n                      >\n                      <v-btn\n                        color=\"primary\"\n                        class=\"ml-2 text-capitalize white--text\"\n                        v-if=\"isEdit\"\n                        @click=\"confirmDelete\"\n                        >{{ $t(\"delete\") }}\n                      </v-btn>\n                      <v-menu>\n                        <template v-slot:activator=\"{ on }\">\n                          <v-btn\n                            color=\"primary\"\n                            class=\"ml-2 float-right text-capitalize white--text\"\n                            v-on=\"on\"\n                          >\n                            {{ $t(\"save_option\") }}\n                            <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>\n                          </v-btn>\n                        </template>\n                        <v-list rounded>\n                          <v-list-item-group>\n                            <v-list-item v-if=\"!isEdit\">\n                              <v-list-item-content>\n                                <v-list-item-title\n                                  @click=\"onSaveOptionClick(SaveOption.SAVENEW)\"\n                                  >{{ $t(\"save_new\") }}</v-list-item-title\n                                >\n                              </v-list-item-content>\n                            </v-list-item>\n                            <v-list-item>\n                              <v-list-item-content>\n                                <v-list-item-title\n                                  @click=\"\n                                    onSaveOptionClick(SaveOption.SAVEPRINT)\n                                  \"\n                                  >{{ $t(\"save_print\") }}</v-list-item-title\n                                >\n                              </v-list-item-content>\n                            </v-list-item>\n                            <v-list-item>\n                              <v-list-item-content>\n                                <v-list-item-title\n                                  @click=\"\n                                    onSaveOptionClick(SaveOption.SAVEDRAFT)\n                                  \"\n                                  >{{ $t(\"save_draft\") }}</v-list-item-title\n                                >\n                              </v-list-item-content>\n                            </v-list-item>\n                          </v-list-item-group>\n                        </v-list>\n                      </v-menu>\n                      <v-btn\n                        color=\"secondary\"\n                        class=\"float-right white--text text-capitalize\"\n                        @click=\"onSaveOptionClick(SaveOption.SAVECLOSE)\"\n                        >{{ $t(\"save_close\") }}</v-btn\n                      >\n                    </v-card>\n                  </v-card>\n                </v-col>\n                <v-col\n                  class=\"smallSide pl-2\"\n                  sm=\"4\"\n                  style=\"transition: 0.3s ease-in\"\n                  :class=\"{ hide_small_bar_class: isHideBar }\"\n                >\n                  <h3\n                    style=\"color: #b3b5bc; font-size: 20px\"\n                    v-if=\"!isHideBar\"\n                    class=\"text-uppercase float-right mt-n3\"\n                  >\n                    <span class=\"pointer\" @click=\"Help('fund receipt')\">\n                      {{ $t(\"help\") }}\n                    </span>\n                    <v-icon\n                      @click=\"cancel()\"\n                      style=\"cursor: pointer; color: #333; font-size: 40px\"\n                      class=\"float-right mt-n1\"\n                      >close\n                    </v-icon>\n                  </h3>\n\n                  <div v-if=\"!isHideBar\" class=\"small_sidebar mt-8 px-4 grayBg\">\n                    <v-card\n                      class=\"pa-3 no-boxshadow d-flex flex-column\"\n                      color=\"primary\"\n                      size=\"60px\"\n                      style=\"margin-bottom: 2px\"\n                    >\n                      <h3\n                        class=\"text-white text-uppercase justify-start font_13\"\n                      >\n                        {{ $t(\"amount\") }}\n                      </h3>\n                      <h3\n                        class=\"\n                          text-bold\n                          justify-end\n                          niradei_heavy\n                          font_22\n                          text-white\n                        \"\n                      >\n                        {{ Number(totalDr).toLocaleString() }}\n                      </h3>\n                    </v-card>\n                    <!-- content -->\n                    <v-row>\n                      <v-col sm=\"12\" cols=\"12\" class=\"pb-0\">\n                        <label class=\"label\">{{ $t(\"segment\") }}</label>\n                        <app-segment-dropdownlist\n                          :initSegment=\"segment\"\n                          @emitSegment=\"segment = $event\"\n                        />\n\n                        <label class=\"label\">{{ $t(\"location\") }}</label>\n                        <app-location-dropdownlist\n                          :initLocation=\"location\"\n                          @emitLocation=\"location = $event\"\n                        />\n                        <label class=\"label\">{{ $t(\"project\") }}</label>\n                        <app-project-dropdownlist\n                          :initProject=\"project\"\n                          @emitProject=\"project = $event\"\n                        />\n                      </v-col>\n                    </v-row>\n                  </div>\n                </v-col>\n              </v-row>\n            </v-card>\n          </v-form>\n        </v-col>\n      </v-row>\n      <LoadingMe\n        type=\"loading\"\n        :isLoading=\"showLoading\"\n        :fullPage=\"true\"\n        :myLoading=\"true\"\n      />\n    </v-container>\n  </v-app>\n</template>\n\n<script>\nimport { i18n } from \"@/i18n\";\nimport kendo from \"@progress/kendo-ui\";\nimport Helper from \"@/helper.js\";\nimport {\n  JournalModel,\n  JournalEntryModel,\n  AccountModel,\n  ClassModel,\n  CurrencyModel,\n  ExchangeRateModel,\n  LocationModel,\n  ProjectModel,\n  SegmentModel,\n  ContactModel,\n} from \"@/scripts/model/AppModels\";\nimport CustomerModel from \"@/scripts/model/Customer\";\n\n/* Editors */\nimport CashReceiptAccountEditor from \"@/scripts/kendo_editor/CashAccount\";\nimport RelatedExpenseAccountEditor from \"@/scripts/kendo_editor/RelatedExpenseAccount\";\nimport RevenueDefferedGrantAccountEditor from \"@/scripts/kendo_editor/RevenueDefferedGrantAccount\";\nimport ClassEditor from \"@/scripts/kendo_editor/Clazz\";\n\n/* Store */\nimport store from \"@/store\";\nconst institute = store.state.institute.institute;\n\nconst journalHandler = require(\"@/scripts/journalHandler\");\nconst AccountTypeCode = require(\"@/scripts/default_setup/AccountTypeCode\");\nimport { ShowResource } from \"@/observable/store\";\n\nconst {\n  EntityType,\n  SaveOption,\n} = require(\"@/scripts/default_setup/Collections\");\n\nexport default {\n  name: \"FundReceipt\",\n  components: {\n    LoadingMe: () => import(\"@/components/Loading\"),\n    \"app-datepicker\": () =>\n      import(\"@/components/custom_templates/DatePickerComponent\"),\n    \"app-currency-dropdownlist\": () =>\n      import(\"@/components/dropdownlist/Currency\"),\n    \"app-donor-dropdownlist\": () => import(\"@/components/dropdownlist/Donor\"),\n    \"app-fund-category-dropdownlist\": () =>\n      import(\"@/components/dropdownlist/FundCategory\"),\n    \"app-segment-dropdownlist\": () =>\n      import(\"@/components/dropdownlist/Segment\"),\n    \"app-project-dropdownlist\": () =>\n      import(\"@/components/dropdownlist/Project\"),\n    \"app-location-dropdownlist\": () =>\n      import(\"@/components/dropdownlist/Location\"),\n  },\n  props: {\n    initJournal: {\n      type: JournalModel,\n    },\n  },\n  data: () => ({\n    /* Obj */\n    fundCategory: null,\n    journal: new JournalModel(),\n    currency: new CurrencyModel(institute.baseCurrency),\n    exchangeRate: new ExchangeRateModel(institute.baseCurrency),\n    journalEntries: [],\n    cashReceiptEntries: [],\n    relatedExpenseEntries: [],\n    revenueDefferedGrantEntries: [],\n    donor: new ContactModel(),\n    location: new LocationModel(),\n    project: new ProjectModel(),\n    segment: new SegmentModel(),\n    // Accounts\n    accounts: [],\n    cashRecieptAccounts: [],\n    relatedExpenseAccounts: [],\n    revenueDefferedGrantAccounts: [],\n    // Editors\n    CashReceiptAccountEditor: CashReceiptAccountEditor,\n    RelatedExpenseAccountEditor: RelatedExpenseAccountEditor,\n    RevenueDefferedGrantAccountEditor: RevenueDefferedGrantAccountEditor,\n    ClassEditor: ClassEditor,\n    // Other\n    totalDr: 0,\n    totalCr: 0,\n    templates: [],\n    user: Helper.getUser(),\n    // Form validation\n    valid: true,\n    isEdit: false,\n    alert: false,\n    errorMessage: \"\",\n    saveMode: \"\",\n    SaveOption: SaveOption,\n    // LoadingMe\n    showLoading: false,\n    // funcion\n    isHideBar: false,\n  }),\n  methods: {\n    HideSmallSideBar() {\n      this.isHideBar = !this.isHideBar;\n    },\n    Help(key_search) {\n      ShowResource(key_search);\n    },\n    // Initial Data\n    initialData() {\n      if (this.initJournal) {\n        // Edit Mode\n        this.journal = this.initJournal;\n        this.bindData();\n      } else {\n        // Brand New Mode\n        this.setDefaultData();\n      }\n    },\n    // Set default data\n    async setDefaultData() {\n      // Brand New Mode\n      this.isEdit = false;\n\n      this.journal = new JournalModel({\n        transaction_type: EntityType.FUND_RECEIPT,\n        journal_date: new Date().toISOString().substr(0, 10),\n      });\n\n      /* Default Sidebar */\n      let locations = await this.$store.dispatch(\"locations/getList\");\n      this.location = new LocationModel(locations[0]);\n\n      let segments = await this.$store.dispatch(\"segments/getList\");\n      this.segment = new SegmentModel(segments.find((i) => i.isSystem === 1));\n\n      // Generate Number\n      this.generateNumber();\n\n      // Add two default rows\n      for (let index = 0; index < 2; index++) {\n        this.addRowCashReceipt();\n        this.addRowRelatedExpense();\n        this.addRowRevenueDefferedGrant();\n      }\n    },\n    // Bind data from prop for edit mode\n    async bindData() {\n      // Edit Mode\n      this.isEdit = true;\n\n      let totalDr = 0,\n        totalCr = 0,\n        cashReceiptEntries = [],\n        relatedExpenseEntries = [],\n        revenueDefferedGrantEntries = [];\n\n      // Donor\n      this.donor = new CustomerModel(\n        this.journal.journal_entries[0].primary_contact\n      );\n\n      /* Classes */\n      let classes = await this.$store.dispatch(\"classes/getList\");\n\n      // Currency\n      this.currency = new CurrencyModel(\n        this.journal.journal_entries[0].currency\n      );\n      this.exchangeRate = new ExchangeRateModel(\n        this.journal.journal_entries[0].currency\n      );\n      this.exchangeRate.id = this.journal.journal_entries[0].exchange_rate_uuid;\n      this.exchangeRate.rate = this.journal.journal_entries[0].exchange_rate;\n\n      this.journal.journal_entries.forEach((value) => {\n        let je = new JournalEntryModel(value);\n\n        if (value.amount > 0) {\n          // Dr side\n          if (\n            ~AccountTypeCode.CASH_ACCOUNTS.indexOf(\n              value.account.account_type.number\n            )\n          ) {\n            cashReceiptEntries.push(je);\n          } else {\n            // Classes\n            je.class1 = new ClassModel(\n              classes.find((item) => item.id === value.class_1_uuid)\n            );\n            je.class2 = new ClassModel(\n              classes.find((item) => item.id === value.class_2_uuid)\n            );\n            je.class3 = new ClassModel(\n              classes.find((item) => item.id === value.class_3_uuid)\n            );\n            je.class4 = new ClassModel(\n              classes.find((item) => item.id === value.class_4_uuid)\n            );\n            je.class5 = new ClassModel(\n              classes.find((item) => item.id === value.class_5_uuid)\n            );\n\n            relatedExpenseEntries.push(je);\n          }\n          totalDr += value.amount;\n        } else {\n          // Cr side\n          je.amount = value.amount * -1;\n          revenueDefferedGrantEntries.push(je);\n          totalCr += je.amount;\n        }\n      });\n\n      // Sidebar\n      let locations = await this.$store.dispatch(\"locations/getList\");\n      this.location = new LocationModel(\n        locations.find((i) => i.id === this.journal.location_uuid)\n      );\n\n      let segments = await this.$store.dispatch(\"segments/getList\");\n      this.segment = new SegmentModel(\n        segments.find((i) => i.id === this.journal.segment_uuid)\n      );\n\n      let projects = await this.$store.dispatch(\"projects/getList\");\n      this.project = new ProjectModel(\n        projects.find((i) => i.id === this.journal.project_uuid)\n      );\n\n      this.totalDr = totalDr;\n      this.totalCr = totalCr;\n\n      this.cashReceiptEntries = cashReceiptEntries;\n      this.relatedExpenseEntries = relatedExpenseEntries;\n      this.revenueDefferedGrantEntries = revenueDefferedGrantEntries;\n    },\n    // Number\n    async generateNumber() {\n      if (!this.isEdit) {\n        let num = await Helper.generateAccountingNumber(\n          this.journal.transaction_type,\n          this.journal.journal_date\n        );\n\n        this.journal.number = num.number;\n        this.journal.prefix_format = num.prefix_format;\n      }\n    },\n    // Get Exchange Rate\n    async getExchangeRate() {\n      if (this.journal.journal_date && this.currency.code !== \"\") {\n        this.exchangeRate = await Helper.getLastExchangeRateByDate(\n          this.journal.journal_date,\n          this.currency.code\n        );\n      } else {\n        this.exchangeRate = new ExchangeRateModel(institute.baseCurrency);\n      }\n    },\n    /* On Date Chanes */\n    onDateChanges() {\n      this.getExchangeRate();\n      this.generateNumber();\n    },\n    /* Kendo */\n    // DataSource Changes\n    onChangeCashReceiptDS(e) {\n      if (e.field) {\n        let dataRow = e.items[0];\n\n        if (e.field === \"account\") {\n          this.addExtraRowCashReceipt(dataRow.uid);\n        }\n\n        this.dataSourceAutoCalculate();\n      }\n    },\n    onChangeRelatedExpenseDS(e) {\n      if (e.field) {\n        let dataRow = e.items[0];\n\n        if (e.field === \"account\") {\n          this.addExtraRowRelatedExpense(dataRow.uid);\n        } else if (e.field === \"class1\") {\n          if (dataRow.class1 !== null) {\n            dataRow.set(\"class_1_uuid\", dataRow.class1.id);\n          } else {\n            // Set default when deselect\n            dataRow.set(\"class_1_uuid\", \"\");\n            dataRow.set(\"class1\", new ClassModel());\n          }\n        } else if (e.field === \"class2\") {\n          if (dataRow.class2 !== null) {\n            dataRow.set(\"class_2_uuid\", dataRow.class2.id);\n          } else {\n            // Set default when deselect\n            dataRow.set(\"class_2_uuid\", \"\");\n            dataRow.set(\"class2\", new ClassModel());\n          }\n        } else if (e.field === \"class3\") {\n          if (dataRow.class3 !== null) {\n            dataRow.set(\"class_3_uuid\", dataRow.class3.id);\n          } else {\n            // Set default when deselect\n            dataRow.set(\"class_3_uuid\", \"\");\n            dataRow.set(\"class3\", new ClassModel());\n          }\n        } else if (e.field === \"class4\") {\n          if (dataRow.class4 !== null) {\n            dataRow.set(\"class_4_uuid\", dataRow.class4.id);\n          } else {\n            // Set default when deselect\n            dataRow.set(\"class_4_uuid\", \"\");\n            dataRow.set(\"class4\", new ClassModel());\n          }\n        } else if (e.field === \"class5\") {\n          if (dataRow.class5 !== null) {\n            dataRow.set(\"class_5_uuid\", dataRow.class5.id);\n          } else {\n            // Set default when deselect\n            dataRow.set(\"class_5_uuid\", \"\");\n            dataRow.set(\"class5\", new ClassModel());\n          }\n        }\n\n        this.dataSourceAutoCalculate();\n      }\n    },\n    onChangeRevenueDefferedGrantDS(e) {\n      if (e.field) {\n        let dataRow = e.items[0];\n\n        if (e.field === \"account\") {\n          this.addExtraRowRevenueDefferedGrant(dataRow.uid);\n        }\n\n        this.dataSourceAutoCalculate();\n      }\n    },\n    // Auto Calculate In DataSource\n    dataSourceAutoCalculate() {\n      let cashReceiptDS = this.$refs.cashReceiptDS.kendoWidget(),\n        relatedExpenseDS = this.$refs.relatedExpenseDS.kendoWidget(),\n        revenueDefferedGrantDS =\n          this.$refs.revenueDefferedGrantDS.kendoWidget(),\n        totalDr = 0,\n        totalCr = 0;\n\n      // Sum\n      cashReceiptDS.data().forEach((value) => {\n        totalDr += kendo.parseFloat(value.amount);\n      });\n      relatedExpenseDS.data().forEach((value) => {\n        totalDr += kendo.parseFloat(value.amount);\n      });\n      revenueDefferedGrantDS.data().forEach((value) => {\n        totalCr += kendo.parseFloat(value.amount);\n      });\n\n      this.totalDr = totalDr;\n      this.totalCr = totalCr;\n    },\n    // Row Number Template\n    rowNumberCashReceipt(dataItem) {\n      let ds = this.$refs.cashReceiptDS.kendoWidget(),\n        index = ds.indexOf(dataItem);\n\n      return index + 1;\n    },\n    rowNumberRelatedExpense(dataItem) {\n      let ds = this.$refs.relatedExpenseDS.kendoWidget(),\n        index = ds.indexOf(dataItem);\n\n      return index + 1;\n    },\n    rowNumberRevenueDefferedGrant(dataItem) {\n      let ds = this.$refs.revenueDefferedGrantDS.kendoWidget(),\n        index = ds.indexOf(dataItem);\n\n      return index + 1;\n    },\n    // Add New Row\n    addRowCashReceipt() {\n      let ds = this.$refs.cashReceiptDS.kendoWidget(),\n        last = ds.total(),\n        je = new JournalEntryModel();\n\n      ds.insert(last, je);\n    },\n    addRowRelatedExpense() {\n      let ds = this.$refs.relatedExpenseDS.kendoWidget(),\n        last = ds.total(),\n        je = new JournalEntryModel();\n\n      // Classes\n      je.class1 = new ClassModel();\n      je.class2 = new ClassModel();\n      je.class3 = new ClassModel();\n      je.class4 = new ClassModel();\n      je.class5 = new ClassModel();\n\n      ds.insert(last, je);\n    },\n    addRowRevenueDefferedGrant() {\n      let ds = this.$refs.revenueDefferedGrantDS.kendoWidget(),\n        last = ds.total(),\n        je = new JournalEntryModel();\n\n      ds.insert(last, je);\n    },\n    // Add Extra Row\n    addExtraRowCashReceipt(uid) {\n      let ds = this.$refs.cashReceiptDS.kendoWidget(),\n        total = ds.total(),\n        row = ds.getByUid(uid),\n        index = ds.indexOf(row);\n\n      if (index == total - 1) {\n        this.addRowCashReceipt();\n      }\n    },\n    addExtraRowRelatedExpense(uid) {\n      let ds = this.$refs.relatedExpenseDS.kendoWidget(),\n        total = ds.total(),\n        row = ds.getByUid(uid),\n        index = ds.indexOf(row);\n\n      if (index == total - 1) {\n        this.addRowRelatedExpense();\n      }\n    },\n    addExtraRowRevenueDefferedGrant(uid) {\n      let ds = this.$refs.revenueDefferedGrantDS.kendoWidget(),\n        total = ds.total(),\n        row = ds.getByUid(uid),\n        index = ds.indexOf(row);\n\n      if (index == total - 1) {\n        this.addRowRevenueDefferedGrant();\n      }\n    },\n    // Remove Row\n    removeRowCashReceipt(e) {\n      e.preventDefault();\n\n      let grid = this.$refs.cashReceiptGrid.kendoWidget(),\n        ds = grid.dataSource,\n        dataItem = grid.dataItem(kendo.jQuery(e.currentTarget).closest(\"tr\"));\n\n      if (ds.data().length > 2) {\n        ds.remove(dataItem);\n      }\n    },\n    removeRowRelatedExpense(e) {\n      e.preventDefault();\n\n      let grid = this.$refs.relatedExpenseGrid.kendoWidget(),\n        ds = grid.dataSource,\n        dataItem = grid.dataItem(kendo.jQuery(e.currentTarget).closest(\"tr\"));\n\n      if (ds.total() > 2) {\n        ds.remove(dataItem);\n      }\n    },\n    removeRowRevenueDefferedGrant(e) {\n      e.preventDefault();\n\n      let grid = this.$refs.revenueDefferedGrantGrid.kendoWidget(),\n        ds = grid.dataSource,\n        dataItem = grid.dataItem(kendo.jQuery(e.currentTarget).closest(\"tr\"));\n\n      if (ds.total() > 2) {\n        ds.remove(dataItem);\n      }\n    },\n    // Shrink Data\n    shrinkData() {\n      // Journal Date\n      this.journal.journal_date = Helper.toISODate(this.journal.journal_date);\n\n      /* Journal Type */\n      this.journal.journal_type = this.fundCategory.name;\n\n      /* Project Segment Location */\n      this.journal.project_uuid = this.project.id;\n      this.journal.segment_uuid = this.segment.id;\n      this.journal.location_uuid = this.location.id;\n\n      // User\n      if (this.isEdit) {\n        this.journal.modified_by = this.user;\n      } else {\n        this.journal.created_by = this.user;\n      }\n\n      let entries = [],\n        cashReceiptDS = this.$refs.cashReceiptDS.kendoWidget(),\n        relatedExpenseDS = this.$refs.relatedExpenseDS.kendoWidget(),\n        revenueDefferedGrantDS =\n          this.$refs.revenueDefferedGrantDS.kendoWidget();\n\n      // Cash Receipt Accounts on Dr\n      cashReceiptDS.data().forEach((value) => {\n        // Filter selected account\n        if (value.account.number !== \"\" && value.amount > 0) {\n          // Account\n          value.set(\"account\", new AccountModel(value.account));\n          value.set(\"account_uuid\", value.account.uuid);\n\n          // Contact\n          value.set(\"primary_contact\", new ContactModel(this.donor));\n\n          // Currency\n          value.set(\"currency\", new CurrencyModel(this.currency));\n          value.set(\"exchange_rate_uuid\", this.exchangeRate.id);\n          value.set(\"exchange_rate\", this.exchangeRate.rate);\n\n          entries.push(new JournalEntryModel(value));\n        }\n      });\n\n      // Related Expense Accounts on Dr\n      relatedExpenseDS.data().forEach((value) => {\n        // Filter selected account\n        if (value.account.number !== \"\" && value.amount > 0) {\n          // Account\n          value.set(\"account\", new AccountModel(value.account));\n          value.set(\"account_uuid\", value.account.uuid);\n\n          // Contact\n          value.set(\"primary_contact\", new ContactModel(this.donor));\n\n          // Currency\n          value.set(\"currency\", new CurrencyModel(this.currency));\n          value.set(\"exchange_rate_uuid\", this.exchangeRate.id);\n          value.set(\"exchange_rate\", this.exchangeRate.rate);\n\n          entries.push(new JournalEntryModel(value));\n        }\n      });\n\n      // Revenue Deffered Grant Account on Cr\n      revenueDefferedGrantDS.data().forEach((value) => {\n        // Filter selected account\n        if (value.account.number !== \"\" && value.amount > 0) {\n          // Account\n          value.set(\"account\", new AccountModel(value.account));\n          value.set(\"account_uuid\", value.account.uuid);\n\n          // Contact\n          value.set(\"primary_contact\", new ContactModel(this.donor));\n\n          // Currency\n          value.set(\"currency\", new CurrencyModel(this.currency));\n          value.set(\"amount\", value.amount * -1); // Credit side is negative\n          value.set(\"exchange_rate_uuid\", this.exchangeRate.id);\n          value.set(\"exchange_rate\", this.exchangeRate.rate);\n\n          entries.push(new JournalEntryModel(value));\n        }\n      });\n\n      // Journal Entries\n      this.journal.journal_entries = entries;\n    },\n    // Validating\n    validateForm() {\n      let result = true,\n        msg = \"\",\n        cashReceiptDS = this.$refs.cashReceiptDS.kendoWidget(),\n        relatedExpenseDS = this.$refs.relatedExpenseDS.kendoWidget(),\n        revenueDefferedGrantDS =\n          this.$refs.revenueDefferedGrantDS.kendoWidget(),\n        countEmptyCashReceipt = 0,\n        countEmptyRevenueDefferedGrant = 0;\n\n      // Donor\n      if (this.donor.id === \"\") {\n        msg += `<p>${i18n.t(\"donor_is_required\")}</p>`;\n        result = false;\n      }\n\n      // Project\n      if (this.project.id === \"\") {\n        msg += `<p>${i18n.t(\"project_is_required\")}</p>`;\n        result = false;\n      }\n\n      // Segment\n      if (this.segment.id === \"\") {\n        msg += `<p>${i18n.t(\"segment_is_required\")}</p>`;\n        result = false;\n      }\n\n      // Location\n      if (this.location.id === \"\") {\n        msg += `<p>${i18n.t(\"location_is_required\")}</p>`;\n        result = false;\n      }\n\n      // Cash Receipt\n      cashReceiptDS.data().forEach((value, index) => {\n        // No account\n        if (value.account.name === \"\" && value.amount > 0) {\n          result = false;\n          msg += `<p>${i18n.t(\n            \"please_select_cash_receipt_account_at_row_number\"\n          )} ${index + 1}</p>`;\n        }\n\n        // No amount\n        if (value.account.name !== \"\" && value.amount === 0) {\n          result = false;\n          msg += `<p>${value.account.name} ${i18n.t(\"has_no_amount\")}</p>`;\n        }\n\n        // Count From Accounts\n        if (value.account.name !== \"\" && value.amount > 0) {\n          countEmptyCashReceipt++;\n        }\n      });\n\n      // Empty Row From Accounts\n      if (countEmptyCashReceipt === 0) {\n        msg += `<p>${i18n.t(\"please_select_cash_receipt_account\")}</p>`;\n        result = false;\n      }\n\n      // Related Expense\n      relatedExpenseDS.data().forEach((value, index) => {\n        // No account\n        if (value.account.name === \"\" && value.amount > 0) {\n          result = false;\n          msg += `<p>${i18n.t(\n            \"please_select_related_expense_account_at_row_number\"\n          )} ${index + 1}</p>`;\n        }\n\n        // No amount\n        if (value.account.name !== \"\" && value.amount === 0) {\n          result = false;\n          msg += `<p>${value.account.name} ${i18n.t(\"has_no_amount\")}</p>`;\n        }\n      });\n\n      // Related Expense\n      revenueDefferedGrantDS.data().forEach((value, index) => {\n        // No account\n        if (value.account.name === \"\" && value.amount > 0) {\n          result = false;\n          msg += `<p>${i18n.t(\n            \"please_select_revenue_deffered_grant_account_at_row_number\"\n          )} ${index + 1}</p>`;\n        }\n\n        // No amount\n        if (value.account.name !== \"\" && value.amount === 0) {\n          result = false;\n          msg += `<p>${value.account.name} ${i18n.t(\"has_no_amount\")}</p>`;\n        }\n\n        // Count To Accounts\n        if (value.account.name !== \"\" && value.amount > 0) {\n          countEmptyRevenueDefferedGrant++;\n        }\n      });\n\n      // Empty Row To\n      if (countEmptyRevenueDefferedGrant === 0) {\n        msg += `<p>${i18n.t(\n          \"please_select_revenue_deffered_grant_account\"\n        )}</p>`;\n        result = false;\n      }\n\n      // All totals\n      if (kendo.parseFloat(this.totalDr) !== kendo.parseFloat(this.totalCr)) {\n        msg += `<p>${i18n.t(\"total_dr_and_total_cr_are_not_balance\")}</p>`;\n        result = false;\n      }\n\n      // Show Alert\n      this.errorMessage = msg;\n      this.alert = false;\n      if (result === false) {\n        this.alert = true;\n      }\n\n      return result;\n    },\n    // All Saves\n    async onSaveOptionClick(mode) {\n      if (this.$refs.form.validate() && this.validateForm()) {\n        let isValidClosingDate = await Helper.validateClosingDate(\n          this.journal.journal_date\n        );\n        if (isValidClosingDate) {\n          this.saveMode = mode;\n          this.save();\n        }\n      }\n    },\n    cancel() {\n      this.$swal({\n        title: i18n.t(\"msg_title_warning\"),\n        text: i18n.t(\"msg_discard\"),\n        icon: \"warning\",\n        showCancelButton: true,\n        cancelButtonText: i18n.t(\"cancel\"),\n        confirmButtonColor: \"#4d4848\",\n        cancelButtonColor: \"#ED1A3A\",\n        confirmButtonText: i18n.t(\"discard\"),\n      }).then((result) => {\n        if (result.value) {\n          this.clear();\n          this.setDefaultData();\n          this.$router.go(-1);\n        }\n      });\n    },\n    clear() {\n      this.isEdit = false;\n      this.saveMode = \"\";\n\n      this.currency = new CurrencyModel(institute.baseCurrency);\n      this.exchangeRate = new ExchangeRateModel(institute.baseCurrency);\n\n      this.donor = new ContactModel();\n      this.segment = new SegmentModel();\n      this.project = new ProjectModel();\n      this.location = new LocationModel();\n\n      let cashReceiptDS = this.$refs.cashReceiptDS.kendoWidget();\n      cashReceiptDS.data([]);\n      let relatedExpenseDS = this.$refs.relatedExpenseDS.kendoWidget();\n      relatedExpenseDS.data([]);\n      let revenueDefferedGrantDS =\n        this.$refs.revenueDefferedGrantDS.kendoWidget();\n      revenueDefferedGrantDS.data([]);\n    },\n    confirmDelete() {\n      this.$swal({\n        title: i18n.t(\"are_you_sure_you_want_to_delete_it\"),\n        text: i18n.t(\"you_wont_be_able_to_revert_this\"),\n        icon: \"warning\",\n        showCancelButton: true,\n        confirmButtonColor: \"#4d4848\",\n        cancelButtonColor: \"#ED1A3A\",\n        confirmButtonText: \"Yes\",\n      }).then((result) => {\n        if (result.value) {\n          this.saveMode = SaveOption.DELETE;\n\n          /* Mark as deleted */\n          this.journal.is_deleted = 1;\n\n          /* Update Journal Status */\n          this.save();\n        }\n      });\n    },\n    save() {\n      let self = this;\n\n      // Draft Mode\n      if (this.saveMode === SaveOption.SAVEDRAFT) {\n        this.journal.is_draft = 1;\n      } else {\n        this.journal.is_draft = 0;\n      }\n\n      // Shrink Data\n      this.shrinkData();\n\n      // Sync Data\n      this.showLoading = true;\n      journalHandler\n        .save(new JournalModel(this.journal))\n        .then((response) => {\n          if (response) {\n            self.responseStatus(response);\n          }\n        })\n        .catch((error) => {\n          self.showLoading = false;\n          Helper.alertErrorMsg(error);\n        })\n        .finally(() => {\n          self.showLoading = false;\n        });\n    },\n    // Response Status\n    responseStatus(response) {\n      if (response.status === 200) {\n        if (\n          this.saveMode === SaveOption.SAVECLOSE ||\n          this.saveMode === SaveOption.DELETE\n        ) {\n          /* Save Close or Delete */\n          if (this.isEdit) {\n            this.goBackToViewPage();\n          } else {\n            this.$router.go(-1);\n          }\n\n          this.clear();\n          this.setDefaultData();\n        } else {\n          /* Save New */\n          this.clear();\n          this.setDefaultData();\n        }\n\n        /* Alert Success */\n        this.$snotify.success(i18n.t(\"successful\"));\n      } else {\n        /* Alert Error */\n        this.$snotify.error(i18n.t(\"error_something_wrong\"));\n      }\n    },\n    // Go back to view page after edit mode\n    getJournal() {\n      return this.journal;\n    },\n    goBackToViewPage() {\n      this.$router.replace({\n        name: \"Fund Receipt View\",\n        params: { initJournal: this.getJournal() },\n      });\n    },\n  },\n  watch: {\n    initJournal() {\n      this.initialData();\n    },\n  },\n  created() {},\n  mounted() {\n    // Initial Data\n    this.initialData();\n  },\n};\n</script>\n\n<style scoped>\n.hide_small_bar_class {\n  max-width: 0;\n  transition: 0.5s ease-in;\n  flex: 0 0 0;\n  padding: 0;\n}\n\n.hide_big_bar_class {\n  max-width: 100%;\n  transition: 0.5s ease-in;\n  flex: 0 0 100%;\n}\n\n.info_add {\n  background-color: #ffffff;\n}\n\n.small_sidebar {\n  height: 98%;\n  position: relative;\n  padding: 12px;\n  background-color: #edf1f5;\n}\n\n.iconArrow {\n  right: -35px;\n  position: absolute;\n  bottom: -10px;\n}\n\n.iconArrowHide {\n  position: absolute;\n  right: -7px;\n  bottom: -10px;\n}\n\n@media (min-width: 1264px) {\n  .container {\n    max-width: 1185px;\n    /* max-width: 1080px !important; */\n  }\n}\n\n@media (max-width: 576px) {\n  .mb-6 {\n    margin-bottom: 0 !important;\n  }\n}\n</style>\n"]}]}