{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/compliance/monthly_tax/new_tax_return/newTaxReturn.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/compliance/monthly_tax/new_tax_return/newTaxReturn.vue","mtime":1640595536796},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBMb2FkaW5nTWUgZnJvbSAnQC9jb21wb25lbnRzL0xvYWRpbmcnCmltcG9ydCBNb250aGx5UmV0dXJuIGZyb20gIkAvc2NyaXB0cy9jb21wbGlhbmNlL21vZGVsL01vbnRobHlSZXR1cm4iOwppbXBvcnQge2kxOG59IGZyb20gIkAvaTE4biI7CmltcG9ydCBrZW5kbyBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tdWknCmltcG9ydCB7dXVpZH0gZnJvbSAndnVlLXV1aWQnCmltcG9ydCB0YXhTZXR0aW5nSGFuZGxlciBmcm9tICJAL3NjcmlwdHMvdGF4U2V0dGluZ0hhbmRsZXIiOwpjb25zdCBtb250aGx5UmV0dXJuSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9jb21wbGlhbmNlL2hhbmRsZXIvbW9udGhseVJldHVybkhhbmRsZXIiKQpjb25zdCBzYWxlSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9jb21wbGlhbmNlL2hhbmRsZXIvc2FsZUhhbmRsZXIiKQpjb25zdCBwdXJjaGFzZUhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvY29tcGxpYW5jZS9oYW5kbGVyL3B1cmNoYXNlSGFuZGxlciIpCmNvbnN0IHNhbGFyeUhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvY29tcGxpYW5jZS9oYW5kbGVyL3NhbGFyeUhhbmRsZXIiKQpjb25zdCB3aXRoaG9sZGluZ0hhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvY29tcGxpYW5jZS9oYW5kbGVyL3dpdGhob2xkaW5nVGF4SGFuZGxlciIpCmNvbnN0IG1vbnRobHlSZXR1cm4gPSBuZXcgTW9udGhseVJldHVybih7fSkKY29uc3QgcHJlZml4SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9jb21wbGlhbmNlL2hhbmRsZXIvcHJlZml4SGFuZGxlciIpCmNvbnN0IHN1bW1hcnlIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2NvbXBsaWFuY2UvaGFuZGxlci9zdW1tYXJ5SGFuZGxlciIpCmNvbnN0IGN1cnJlbmN5SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9jdXJyZW5jeS9oYW5kbGVyL2N1cnJlbmN5SGFuZGxlciIpCmNvbnN0IGFwaVVybCA9IHJlcXVpcmUoJ0AvYXBpVXJsJykKLy8gY29uc3QgdGF4U2V0dGluZyA9IHJlcXVpcmUoJ0Avc3RvcmUvdGF4U2V0dGluZycpOwpjb25zdCBjdXJyZW5jeVR5cGUgPSB7CiAgICBUQVhfRVhDSEFOR0VfQ1VSUkVOQ1k6ICd0YXgtYycsCn0KLy8gY29uc3QgYXhpb3MgPSByZXF1aXJlKCdheGlvcycpCmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWU6ICJUYXhSZXR1cm4iLAogICAgY29tcG9uZW50czogewogICAgICAgICdMb2FkaW5nTWUnOiBMb2FkaW5nTWUsCiAgICAgICAgLy8gJ21vbnRoLXBpY2tlcic6ICgpID0+IGltcG9ydCgnQC9jb21wb25lbnRzL2N1c3RvbV90ZW1wbGF0ZXMvTW9udGhQaWNrZXInKSwKICAgICAgICBJbnB1dFRhYjogKCkgPT4gaW1wb3J0KCcuL2lucHV0L0lucHV0VGFiJyksCiAgICAgICAgUmV2aWV3VGFiOiAoKSA9PiBpbXBvcnQoJy4vcmV2aWV3L1Jldmlld1RhYicpLAogICAgICAgIENvbmZpcm06ICgpID0+IGltcG9ydCgnLi9jb25maXJtL0NvbmZpcm1UYWInKSwKICAgICAgICBGaW5hbGl6ZTogKCkgPT4gaW1wb3J0KCcuL2ZpbmFsaXplL0ZpbmFsaXplJykKICAgIH0sCiAgICBkYXRhOiAoKSA9PiAoewogICAgICAgIG1lbnU6IGZhbHNlLAogICAgICAgIHRlbXBsYXRlczogW10sCiAgICAgICAgbW9udGg6ICcnLAogICAgICAgIHNob3dMb2FkaW5nOiBmYWxzZSwKICAgICAgICB2YWxpZDogJycsCiAgICAgICAgYmlsbF9kYXRlOiAiIiwKICAgICAgICBqb3VybmFsX2RhdGU6ICcnLAogICAgICAgIHN0ZXBzOiAxLAogICAgICAgIHJlYWNoVG9wU3RlcDogMCwKICAgICAgICBjaGVjazogZmFsc2UsCiAgICAgICAgc2F2ZV9uZXh0OiAnc2F2ZV9uZXh0JywKICAgICAgICBhY3RpdmVDb2xvcjE6ICJwcmltYXJ5IiwKICAgICAgICBhY3RpdmVDb2xvcjI6ICJ0aGlyZCIsCiAgICAgICAgYWN0aXZlQ29sb3IzOiAidGhpcmQiLAogICAgICAgIGFjdGl2ZUNvbG9yNDogInRoaXJkIiwKICAgICAgICBpc0ZpbmFsOiBmYWxzZSwKICAgICAgICAvLyB0aGlyZAogICAgICAgIGNoZWNrMTogZmFsc2UsCiAgICAgICAgY2hlY2syOiBmYWxzZSwKICAgICAgICBjaGVjazM6IGZhbHNlLAogICAgICAgIHBheXJvbGxfaWQ6ICcnLAogICAgICAgIGxvYWRQYXlyb2xsczogW10sCiAgICAgICAgLy8gc3RhcnRfcmV0dXJuOiBmYWxzZSwKCiAgICAgICAgaXNDcmVhdGU6IGZhbHNlLAogICAgICAgIHRyYW5zYWN0aW9uVHlwZXM6IFtdLAogICAgICAgIG1vbnRobHlSZXR1cm46IG1vbnRobHlSZXR1cm4sCiAgICAgICAgLy8gaXNHZXRBbW91bnQ6IGZhbHNlLAogICAgICAgIEFsZXJ0VmFsaWRhdGUyOiBmYWxzZSwKCiAgICAgICAgY3VycmVuY3k6IHt9LAogICAgICAgIHNhbGVzOiBbXSwKICAgICAgICBwdXJjaGFzZXM6IFtdLAogICAgICAgIHNhbGFyaWVzOiBbXSwKICAgICAgICB3aXRoaG9sZGluZ3M6IFtdLAogICAgICAgIGFtb3VudFNhbGU6IDAsCiAgICAgICAgYW1vdW50U2FsZUV4Y3VsOiAwLAogICAgICAgIGFtb3VudFRvdGFsUHVyY2hhc2U6IDAsCiAgICAgICAgYW1vdW50UHVyY2hhc2VFeGN1bDogMCwKICAgICAgICBhbW91bnRXaHQ6IDAsCiAgICAgICAgYW1vdW50U2FsYXJ5OiAwLAogICAgICAgIGFtb3VudEJlbmVmaXQ6IDAsCiAgICAgICAgb3RoZXJBbW91bnQ6IDAsCiAgICAgICAgdG90YWxBbW91bnRQYWlkOiAwLAogICAgICAgIHN1bW1hcnk6IHt9LAogICAgICAgIGlzUm91dGU6IGZhbHNlLAogICAgICAgIGJhbGFuY2VWYXQ6IHt9LAogICAgICAgIGJhbGFuY2VQcGk6IHt9LAogICAgICAgIGRhdGVTYWxlOiAnJywKICAgICAgICBkYXRlUHVyY2hhc2U6ICcnLAogICAgICAgIGRhdGVXaHQ6ICcnLAogICAgICAgIGRhdGVTYWxhcnk6ICcnLAogICAgICAgIHN0YXR1c01yOiBmYWxzZSwKICAgICAgICBqb3VybmFsU3VtbWFyeTogW10sCiAgICAgICAgbGlzdFRheHM6IFtdCiAgICB9KSwKICAgIGNvbXB1dGVkOiB7CiAgICAgICAgc3RhcnRfcmV0dXJuKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5tb250aGx5UmV0dXJuLm51bWJlciAhPT0gJycgJiYgdGhpcy4kcm91dGUucGFyYW1zLmlkICE9PSAnJzsKICAgICAgICB9LAogICAgICAgIGlkKCkgewogICAgICAgICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kcm91dGUucGFyYW1zLmlkCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJycKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgRGF0ZVN0YXRlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy4kcm91dGUucGFyYW1zLmlkICE9PSB1bmRlZmluZWQgfHwgdGhpcy4kcm91dGUucXVlcnkudHlwZSA9PT0gJ2VkaXQnIHx8IHRoaXMuJHJvdXRlLnF1ZXJ5LnR5cGUgPT09ICd2aWV3JzsKICAgICAgICB9LAogICAgICAgIC8vIGxpc3RUYXhzOiB7CiAgICAgICAgLy8gICAgIHNldChsaXN0VGF4KSB7CiAgICAgICAgLy8gICAgICAgICB0YXhTZXR0aW5nLmRlZmF1bHQuY29tbWl0KCJzZXRMaXN0VGF4IiwgbGlzdFRheCkKICAgICAgICAvLyAgICAgfSwKICAgICAgICAvLyAgICAgZ2V0KCkgewogICAgICAgIC8vICAgICAgICAgcmV0dXJuIHRheFNldHRpbmcuZGVmYXVsdC5zdGF0ZS5saXN0VGF4CiAgICAgICAgLy8gICAgIH0KICAgICAgICAvLyB9LAogICAgfSwKICAgIHdhdGNoOiB7CiAgICAgICAgJ2lkJzogJ2luaXREYXRhJywKICAgIH0sCiAgICBiZWZvcmVSb3V0ZUxlYXZlICh0bywgZnJvbSAsIG5leHQpIHsKICAgICAgICBpZiAodG8ubmFtZSA9PT0gJ0FkZCBQdXJjaGFzZScgfHwgdG8ubmFtZSA9PT0gJ0FkZCBTYWxlJyB8fCB0by5uYW1lID09PSAnQWRkIFdpdGhob2xkaW5nIFRheCcpIHsKICAgICAgICAgICAgbmV4dCgpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3Qgc2FsZXMgPSB0aGlzLiRzdG9yZS5zdGF0ZS5jb21wbGlhbmNlLnNhbGUKICAgICAgICAgICAgaWYgKHNhbGVzLmxlbmd0aCA+IDAgJiYgc2FsZXMuZmlsdGVyKHAgPT4gcC5pc1NhdmUgPT09IGZhbHNlKSkgewogICAgICAgICAgICAgICAgdGhpcy4kc3dhbCh7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGkxOG4udCgnbXNnX3RpdGxlX3dhcm5pbmcnKSwKICAgICAgICAgICAgICAgICAgICB0ZXh0OiBpMThuLnQoJ21zZ19sZWF2ZScpLAogICAgICAgICAgICAgICAgICAgIGljb246ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBpMThuLnQoJ2ZvcmNlX2xlYXZlJyksCiAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzRkNDg0OCIsCiAgICAgICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjRUQxQTNBIiwKICAgICAgICAgICAgICAgICAgICBzaG93RGVueUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogaTE4bi50KCdsZWF2ZScpLAogICAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2hvd0Nsb3NlQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgICAgfSkudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChyZXMuaXNDb25maXJtZWQgfHwgcmVzLmlzRGlzbWlzc2VkICYmIHJlcy5kaXNtaXNzID09PSAnY2FuY2VsJykgewogICAgICAgICAgICAgICAgICAgICAgICBuZXh0KCkKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhcigpCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYW1vdW50U2FsZSA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hbW91bnRTYWxlRXhjdWwgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYW1vdW50UHVyY2hhc2UgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYW1vdW50V2h0ID0gMAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm90aGVyQW1vdW50ID0gMAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRvdGFsQW1vdW50UGFpZCA9IDAKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBuZXh0KGZhbHNlKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2cocmVzLCAnZGlzY2FyZCcpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHRoaXMubW9udGhseVJldHVybi5wcm9ncmVzcyA9PT0gJycgJiYgdGhpcy5pc1JvdXRlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc3dhbCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBpMThuLnQoJ21zZ190aXRsZV93YXJuaW5nJyksCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGkxOG4udCgnbXNnX2Rpc2NhcmQnKSwKICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjogIndhcm5pbmciLAogICAgICAgICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBpMThuLnQoJ2NhbmNlbCcpLAogICAgICAgICAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjNGQ0ODQ4IiwKICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjRUQxQTNBIiwKICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IGkxOG4udCgnZGlzY2FyZCcpLAogICAgICAgICAgICAgICAgICAgIH0pLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5pc0NvbmZpcm1lZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYW1vdW50U2FsZSA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYW1vdW50U2FsZUV4Y3VsID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hbW91bnRQdXJjaGFzZSA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYW1vdW50V2h0ID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vdGhlckFtb3VudCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudG90YWxBbW91bnRQYWlkID0gMAogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dChmYWxzZSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG5leHQoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKICAgIG1ldGhvZHM6IHsKICAgICAgICBhc3luYyBjaGVja01vbnRobHlSZXR1cm4oKSB7CiAgICAgICAgICAgIG1vbnRobHlSZXR1cm5IYW5kbGVyLmdldEJ5TW9udGgodGhpcy5tb250aGx5UmV0dXJuLm1vbnRoT2YpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhyZXMsICdnZXQgbW9udGgxMjMnKQogICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLmRhdGEgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXR1c01yID0gdHJ1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgZ2V0RmluYWxQdXJjaGFzZShwdXJjaGFzZSkgewogICAgICAgICAgICBpZiAodGhpcy5wdXJjaGFzZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlcyA9IHB1cmNoYXNlCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGdldEJhbGFuY2VWYXQoYmFsYW5jZSkgewogICAgICAgICAgICB0aGlzLmJhbGFuY2VWYXQgPSBiYWxhbmNlCiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLmJhbGFuY2VWYXQuY3JlZGl0LCB0aGlzLmJhbGFuY2VWYXQucGF5bWVudCwgJ2JhbGFuY2VWYXQnKQogICAgICAgIH0sCiAgICAgICAgZ2V0QmFsYW5jZVBwaShiYWxhbmNlKSB7CiAgICAgICAgICAgIHRoaXMuYmFsYW5jZVBwaSA9IGJhbGFuY2UKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHRoaXMuYmFsYW5jZVBwaSwgJ2JhbGFuY2VQcGknKQogICAgICAgIH0sCiAgICAgICAgZ2V0U3VtbWFyeShzdW1tYXJ5KSB7CiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygnbmV3IHRheCB0YWIgc3VtbWFyeScsIHN1bW1hcnkpCiAgICAgICAgICAgIHRoaXMuc3VtbWFyeSA9IHN1bW1hcnkKICAgICAgICB9LAogICAgICAgIGdldERhdGVXaHQoZGF0ZSkgewogICAgICAgICAgICB0aGlzLmRhdGVXaHQgPSBkYXRlCiAgICAgICAgfSwKICAgICAgICBnZXRTYWxhcnkoc2FsYXJ5KSB7CiAgICAgICAgICAgIHRoaXMuc2FsYXJpZXMgPSBzYWxhcnkKICAgICAgICB9LAogICAgICAgIGdldERhdGVQdXJjaGFzZShkYXRlKSB7CiAgICAgICAgICAgIHRoaXMuZGF0ZVB1cmNoYXNlID0gZGF0ZQogICAgICAgIH0sCiAgICAgICAgZ2V0RGF0ZVNhbGUoZGF0ZSkgewogICAgICAgICAgICB0aGlzLmRhdGVTYWxlID0gZGF0ZQogICAgICAgIH0sCiAgICAgICAgZ2V0VG90YWxBbW91bnRQYWlkKGFtb3VudCkgewogICAgICAgICAgICB0aGlzLnRvdGFsQW1vdW50UGFpZCA9IGFtb3VudAogICAgICAgIH0sCiAgICAgICAgZ2V0T3RoZXJBbW91bnQoYW1vdW50KSB7CiAgICAgICAgICAgIHRoaXMub3RoZXJBbW91bnQgPSBhbW91bnQKICAgICAgICB9LAogICAgICAgIGdldEFtb3VudFNhbGVFeGN1bChzYWxlRXhjdWwpIHsKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCduZXcgdGF4IHRhYiBzYWxlIGV4Y3VsJywgc2FsZUV4Y3VsKQogICAgICAgICAgICB0aGlzLmFtb3VudFNhbGVFeGN1bCA9IHNhbGVFeGN1bAogICAgICAgIH0sCiAgICAgICAgZ2V0V2l0aGhvbGRpbmcod2l0aGhvbGRpbmcpIHsKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCduZXcgdGF4IHRhYiB3aXRoaG9sZGluZycsIHdpdGhob2xkaW5nKQogICAgICAgICAgICB0aGlzLndpdGhob2xkaW5ncyA9IHdpdGhob2xkaW5nCiAgICAgICAgfSwKICAgICAgICBnZXRBbW91bnRTYWxhcnkoYW1vdW50KSB7CiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygnbmV3IHRheCB0YWIgc2FsYXJ5JywgYW1vdW50KQogICAgICAgICAgICB0aGlzLmFtb3VudFNhbGFyeSA9IGFtb3VudAogICAgICAgIH0sCiAgICAgICAgZ2V0QW1vdW50VGF4KGFtb3VudCkgewogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coJ25ldyB0YXggdGFiIGJlbmVmaXQnLCBhbW91bnQpCiAgICAgICAgICAgIHRoaXMuYW1vdW50QmVuZWZpdCA9IGFtb3VudAogICAgICAgIH0sCiAgICAgICAgZ2V0SW5wdXRQdXJjaGFzZShwdXJjaGFzZSkgewogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coJ25ldyB0YXggdGFiIHB1cmNoYXNlJywgcHVyY2hhc2UpCiAgICAgICAgICAgIHRoaXMucHVyY2hhc2VzID0gcHVyY2hhc2UKICAgICAgICB9LAogICAgICAgIGdldElucHV0U2FsZShzYWxlKSB7CiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygnbmV3IHRheCB0YWIgc2FsZScsIHNhbGUpCiAgICAgICAgICAgIHRoaXMuc2FsZXMgPSBzYWxlCiAgICAgICAgfSwKICAgICAgICBnZXRBbW91bnRXaHQoYW1vdW50KSB7CiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygnbmV3IHRheCB0YWIgd2h0JywgYW1vdW50KQogICAgICAgICAgICB0aGlzLmFtb3VudFdodCA9IGFtb3VudAogICAgICAgIH0sCiAgICAgICAgZ2V0U3RlcChzdGVwKSB7CiAgICAgICAgICAgIHRoaXMuc3RlcHMgPSBzdGVwCiAgICAgICAgICAgIGlmICh0aGlzLnJlYWNoVG9wU3RlcCA8PSB0aGlzLnN0ZXBzKSB7CiAgICAgICAgICAgICAgICB0aGlzLnJlYWNoVG9wU3RlcCA9IHRoaXMuc3RlcHMKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnN0ZXBzQ29uZGl0aW9uKHRoaXMuc3RlcHMpCiAgICAgICAgfSwKICAgICAgICBnZXRUb3RhbEFtb3VudFB1cmNoYXNlKGFtb3VudCkgewogICAgICAgICAgICB0aGlzLmFtb3VudFRvdGFsUHVyY2hhc2UgPSBhbW91bnQKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHRoaXMuYW1vdW50VG90YWxQdXJjaGFzZSwgJ05ldyBUYXggVGFiIFB1cmNoYXNlJykKICAgICAgICB9LAogICAgICAgIGdldEFtb3VudFB1cmNoYXNlRXhjdWwoYW1vdW50KSB7CiAgICAgICAgICAgIHRoaXMuYW1vdW50UHVyY2hhc2VFeGN1bCA9IGFtb3VudAogICAgICAgIH0sCiAgICAgICAgZ2V0QW1vdW50U2FsZShhbW91bnQpIHsKICAgICAgICAgICAgdGhpcy5hbW91bnRTYWxlID0gYW1vdW50CiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLmFtb3VudFNhbGUsICdOZXcgVGF4IFRhYiBTYWxlJykKICAgICAgICB9LAogICAgICAgIGFzeW5jIGluaXREYXRhKCkgewogICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZQogICAgICAgICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkICE9PSB1bmRlZmluZWQgJiYgdGhpcy4kcm91dGUucGFyYW1zLm1vbnRobHlSZXR1cm4gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5vbkxvYWRPbmVSZXR1cm4oKQogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHRoaXMuc3RlcHMpCiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy4kcm91dGUucGFyYW1zLm1vbnRobHlSZXR1cm4gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuID0gdGhpcy4kcm91dGUucGFyYW1zLm1vbnRobHlSZXR1cm4KICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vbnRobHlSZXR1cm4uc3RhdHVzLmlkID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnVmlldyBUYXggUmV0dXJuJywKICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogJ3ZpZXdfbW9udGhseV9yZXR1cm4vJyArIHRoaXMubW9udGhseVJldHVybi5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7aWQ6IHRoaXMubW9udGhseVJldHVybi5pZCwgbW9udGhseVJldHVybjogdGhpcy5tb250aGx5UmV0dXJufSwKICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnk6IHt0eXBlOiAndmlldyd9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLm1vbnRobHlSZXR1cm4sICdkYWZhc2RmMzQnKQogICAgICAgICAgICAgICAgdGhpcy5pbml0TG9jYWxTdG9yYWdlKHRoaXMubW9udGhseVJldHVybi5hYmJyLCB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyKQogICAgICAgICAgICAgICAgY29uc3Qgc3RlcCA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZTdGVwJykpCiAgICAgICAgICAgICAgICBsZXQgc3RlcHMgPSAxCiAgICAgICAgICAgICAgICBpZiAodGhpcy5tb250aGx5UmV0dXJuLnN0ZXAgIT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgc3RlcHMgPSB0aGlzLm1vbnRobHlSZXR1cm4uc3RlcAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHN0ZXAgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCdzdGVwMTInLCBzdGVwKQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vbnRobHlSZXR1cm4uc3RlcCA+IHN0ZXApIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RlcHMgPSB0aGlzLm1vbnRobHlSZXR1cm4uc3RlcAogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXBzID0gc3RlcAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuc3RlcHMgPSBzdGVwcwogICAgICAgICAgICAgICAgaWYgKHRoaXMucmVhY2hUb3BTdGVwIDw9IHRoaXMuc3RlcHMpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlYWNoVG9wU3RlcCA9IHRoaXMuc3RlcHMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuc3RlcHNDb25kaXRpb24odGhpcy5zdGVwcykKICAgICAgICAgICAgICAgIC8vIHRoaXMuc3RhcnRfcmV0dXJuID0gdHJ1ZQogICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2codGhpcy5zdGVwcykKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuY2xlYXIoKQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBjbGVhcigpIHsKICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuID0gbmV3IE1vbnRobHlSZXR1cm4oe30pCiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZQogICAgICAgIH0sCiAgICAgICAgaW5pdExvY2FsU3RvcmFnZShhYmJyLCBudW1iZXIpIHsKICAgICAgICAgICAgY29uc3Qgc2FsZSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oYWJiciArIG51bWJlciArICcmU2FsZScpKQogICAgICAgICAgICBjb25zdCBwdXJjaGFzZSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oYWJiciArIG51bWJlciArICcmUHVyY2hhc2UnKSkKICAgICAgICAgICAgY29uc3Qgd2l0aGhvbGRpbmcgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKGFiYnIgKyBudW1iZXIgKyAnJldpdGhob2xkaW5nJykpCiAgICAgICAgICAgIGNvbnN0IHNhbGFyeSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oYWJiciArIG51bWJlciArICcmU2FsYXJ5JykpCiAgICAgICAgICAgIGNvbnN0IHN0ZXAgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKGFiYnIgKyBudW1iZXIgKyAnJlN0ZXAnKSkKICAgICAgICAgICAgaWYgKHNhbGUgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGFiYnIgKyBudW1iZXIgKyAnJlNhbGUnLCBKU09OLnN0cmluZ2lmeShbXSkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHB1cmNoYXNlID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShhYmJyICsgbnVtYmVyICsgJyZQdXJjaGFzZScsIEpTT04uc3RyaW5naWZ5KFtdKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAod2l0aGhvbGRpbmcgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGFiYnIgKyBudW1iZXIgKyAnJldpdGhob2xkaW5nJywgSlNPTi5zdHJpbmdpZnkoW10pKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzYWxhcnkgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGFiYnIgKyBudW1iZXIgKyAnJlNhbGFyeScsIEpTT04uc3RyaW5naWZ5KFtdKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3RlcCA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYWJiciArIG51bWJlciArICcmU3RlcCcsIEpTT04uc3RyaW5naWZ5KDEpKQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBvbkNsb3NlKCkgewogICAgICAgICAgICBjb25zdCBzYWxlcyA9IHRoaXMuJHN0b3JlLnN0YXRlLmNvbXBsaWFuY2Uuc2FsZQogICAgICAgICAgICBjb25zdCBwdXJjaGFzZXMgPSB0aGlzLiRzdG9yZS5zdGF0ZS5jb21wbGlhbmNlLnB1cmNoYXNlCiAgICAgICAgICAgIGNvbnN0IHdpdGhob2xkaW5nID0gdGhpcy4kc3RvcmUuc3RhdGUuY29tcGxpYW5jZS53aXRoaG9sZGluZwogICAgICAgICAgICBpZiAoc2FsZXMubGVuZ3RoID4gMCAmJiBzYWxlcy5maWx0ZXIocCA9PiBwLmlzU2F2ZSA9PT0gZmFsc2UpIHx8IHB1cmNoYXNlcy5sZW5ndGggPiAwICYmIHB1cmNoYXNlcy5maWx0ZXIocCA9PiBwLmlzU2F2ZSA9PT0gZmFsc2UpIHx8IHdpdGhob2xkaW5nLmxlbmd0aCA+IDAgJiYgd2l0aGhvbGRpbmcuZmlsdGVyKHAgPT4gcC5pc1NhdmUgPT09IGZhbHNlKSkgewogICAgICAgICAgICAgICAgdGhpcy4kc3dhbCh7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGkxOG4udCgnbXNnX3RpdGxlX3dhcm5pbmcnKSwKICAgICAgICAgICAgICAgICAgICB0ZXh0OiBpMThuLnQoJ21zZ19sZWF2ZScpLAogICAgICAgICAgICAgICAgICAgIGljb246ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBpMThuLnQoJ2ZvcmNlX2xlYXZlJyksCiAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzRkNDg0OCIsCiAgICAgICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjRUQxQTNBIiwKICAgICAgICAgICAgICAgICAgICBzaG93RGVueUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogaTE4bi50KCdsZWF2ZScpLAogICAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2hvd0Nsb3NlQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgICAgfSkudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChyZXMuaXNDb25maXJtZWQgfHwgcmVzLmlzRGlzbWlzc2VkICYmIHJlcy5kaXNtaXNzID09PSAnY2FuY2VsJykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFuKCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlcywgJ2Rpc2NhcmQnKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vbnRobHlSZXR1cm4ucHJvZ3Jlc3MgPT09ICcnICYmIHRoaXMuaXNSb3V0ZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJHN3YWwoewogICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogaTE4bi50KCdtc2dfdGl0bGVfd2FybmluZycpLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBpMThuLnQoJ21zZ19kaXNjYXJkJyksCiAgICAgICAgICAgICAgICAgICAgICAgIGljb246ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogaTE4bi50KCdjYW5jZWwnKSwKICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzRkNDg0OCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI0VEMUEzQSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBpMThuLnQoJ2Rpc2NhcmQnKSwKICAgICAgICAgICAgICAgICAgICB9KS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuaXNDb25maXJtZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYW4oKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gY29uc3Qgc2FsZSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZTYWxlJykpCiAgICAgICAgICAgIC8vIGNvbnN0IHB1cmNoYXNlID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJlB1cmNoYXNlJykpCiAgICAgICAgICAgIC8vIGNvbnN0IHdpdGhob2xkaW5nID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJldpdGhob2xkaW5nJykpCiAgICAgICAgICAgIC8vIGNvbnN0IHNhbGFyeSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZTYWxhcnknKSkKICAgICAgICAgICAgLy8gY29uc3Qgc3RlcCA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZTdGVwJykpCiAgICAgICAgICAgIC8vIGlmIChzYWxlID09PSBudWxsKSB7CiAgICAgICAgICAgIC8vICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJlNhbGUnLCBKU09OLnN0cmluZ2lmeShbXSkpCiAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgLy8gaWYgKHB1cmNoYXNlID09PSBudWxsKSB7CiAgICAgICAgICAgIC8vICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJlB1cmNoYXNlJywgSlNPTi5zdHJpbmdpZnkoW10pKQogICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIC8vIGlmICh3aXRoaG9sZGluZyA9PT0gbnVsbCkgewogICAgICAgICAgICAvLyAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZXaXRoaG9sZGluZycsIEpTT04uc3RyaW5naWZ5KFtdKSkKICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAvLyBpZiAoc2FsYXJ5ID09PSBudWxsKSB7CiAgICAgICAgICAgIC8vICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJlNhbGFyeScsIEpTT04uc3RyaW5naWZ5KFtdKSkKICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAvLyBpZiAoc3RlcCA9PT0gbnVsbCkgewogICAgICAgICAgICAvLyAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZTdGVwJywgSlNPTi5zdHJpbmdpZnkoMSkpCiAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgLy8gaWYgKHNhbGUgIT09IG51bGwgfHwgcHVyY2hhc2UgIT09IG51bGwgfHwgd2l0aGhvbGRpbmcgIT09IG51bGwgfHwgc2FsYXJ5ICE9PSBudWxsKSB7CiAgICAgICAgICAgIC8vICAgICBpZiAoc2FsZS5sZW5ndGggPiAwIHx8IHB1cmNoYXNlLmxlbmd0aCA+IDAgfHwgd2l0aGhvbGRpbmcubGVuZ3RoID4gMCB8fCBzYWxhcnkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAvLyAgICAgICAgIHRoaXMuJHN3YWwoewogICAgICAgICAgICAvLyAgICAgICAgICAgICB0aXRsZTogaTE4bi50KCdtc2dfdGl0bGVfd2FybmluZycpLAogICAgICAgICAgICAvLyAgICAgICAgICAgICB0ZXh0OiBpMThuLnQoJ21zZ19sZWF2ZScpLAogICAgICAgICAgICAvLyAgICAgICAgICAgICBpY29uOiAid2FybmluZyIsCiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IGkxOG4udCgnZm9yY2VfbGVhdmUnKSwKICAgICAgICAgICAgLy8gICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzRkNDg0OCIsCiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI0VEMUEzQSIsCiAgICAgICAgICAgIC8vICAgICAgICAgICAgIHNob3dEZW55QnV0dG9uOiB0cnVlLAogICAgICAgICAgICAvLyAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogaTE4bi50KCdsZWF2ZScpLAogICAgICAgICAgICAvLyAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAvLyAgICAgICAgICAgICBzaG93Q2xvc2VCdXR0b246IHRydWUsCiAgICAgICAgICAgIC8vICAgICAgICAgfSkudGhlbihyZXMgPT4gewogICAgICAgICAgICAvLyAgICAgICAgICAgICBpZiAocmVzLmlzQ29uZmlybWVkKSB7CiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJlN0ZXAnLCB0aGlzLnN0ZXBzKQogICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgdGhpcy5jbGVhbigpCiAgICAgICAgICAgIC8vICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzLmlzRGlzbWlzc2VkICYmIHJlcy5kaXNtaXNzID09PSAnY2FuY2VsJykgewogICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZTYWxlJykKICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKHRoaXMubW9udGhseVJldHVybi5hYmJyICsgdGhpcy5tb250aGx5UmV0dXJuLm51bWJlciArICcmUHVyY2hhc2UnKQogICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZTYWxhcnknKQogICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZXaXRoaG9sZGluZycpCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJlN0ZXAnKQogICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgdGhpcy5jbGVhbigpCiAgICAgICAgICAgIC8vICAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlcywgJ2Rpc2NhcmQnKQogICAgICAgICAgICAvLyAgICAgICAgIH0pCiAgICAgICAgICAgIC8vICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyAgICAgICAgIGlmICh0aGlzLm1vbnRobHlSZXR1cm4ucHJvZ3Jlc3MgPT09ICcnICYmIHRoaXMuaXNSb3V0ZSkgewogICAgICAgICAgICAvLyAgICAgICAgICAgICB0aGlzLiRzd2FsKHsKICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgIHRpdGxlOiBpMThuLnQoJ21zZ190aXRsZV93YXJuaW5nJyksCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICB0ZXh0OiBpMThuLnQoJ21zZ19kaXNjYXJkJyksCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICBpY29uOiAid2FybmluZyIsCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogaTE4bi50KCdjYW5jZWwnKSwKICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiM0ZDQ4NDgiLAogICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjRUQxQTNBIiwKICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBpMThuLnQoJ2Rpc2NhcmQnKSwKICAgICAgICAgICAgLy8gICAgICAgICAgICAgfSkudGhlbihyZXMgPT4gewogICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgaWYgKHJlcy5pc0NvbmZpcm1lZCkgewogICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKHRoaXMubW9udGhseVJldHVybi5hYmJyICsgdGhpcy5tb250aGx5UmV0dXJuLm51bWJlciArICcmU2FsZScpCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZQdXJjaGFzZScpCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZTYWxhcnknKQogICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKHRoaXMubW9udGhseVJldHVybi5hYmJyICsgdGhpcy5tb250aGx5UmV0dXJuLm51bWJlciArICcmV2l0aGhvbGRpbmcnKQogICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKHRoaXMubW9udGhseVJldHVybi5hYmJyICsgdGhpcy5tb250aGx5UmV0dXJuLm51bWJlciArICcmU3RlcCcpCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhbigpCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2cocmVzLCAnZGlzY2FyZCcpCiAgICAgICAgICAgIC8vICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC8vICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gICAgICAgICAgICAgdGhpcy5jbGVhbigpCiAgICAgICAgICAgIC8vICAgICAgICAgfQogICAgICAgICAgICAvLyAgICAgfQogICAgICAgICAgICAvLyB9CiAgICAgICAgfSwKICAgICAgICBjbGVhbigpIHsKICAgICAgICAgICAgdGhpcy5jbGVhcigpCiAgICAgICAgICAgIHRoaXMuYW1vdW50U2FsZSA9IDAKICAgICAgICAgICAgdGhpcy5hbW91bnRTYWxlRXhjdWwgPSAwCiAgICAgICAgICAgIHRoaXMuYW1vdW50UHVyY2hhc2UgPSAwCiAgICAgICAgICAgIHRoaXMuYW1vdW50V2h0ID0gMAogICAgICAgICAgICB0aGlzLm90aGVyQW1vdW50ID0gMAogICAgICAgICAgICB0aGlzLnRvdGFsQW1vdW50UGFpZCA9IDAKICAgICAgICAgICAgLy8gdGhpcy5zdGFydF9yZXR1cm4gPSBmYWxzZQogICAgICAgICAgICBpZiAoIXRoaXMuaXNSb3V0ZSkgewogICAgICAgICAgICAgICAgdGhpcy5pc1JvdXRlID0gZmFsc2UKICAgICAgICAgICAgICAgIHdpbmRvdy5oaXN0b3J5LmdvKC0xKQoKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuaXNSb3V0ZSA9IGZhbHNlCiAgICAgICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5nbygtMSkKICAgICAgICAgICAgICAgIHdpbmRvdy5oaXN0b3J5LmdvKC0xKQogICAgICAgICAgICB9CgogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZEN1cnJlbmN5RGF0YSh0eXBlKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgncmVzb2x2ZWQnKQogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lIYW5kbGVyLmxpc3QodHlwZSkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCdyZXNwb25zZScsJycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gY3VycmVuY3lUeXBlLlRBWF9FWENIQU5HRV9DVVJSRU5DWSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVuY3kgPSByZXNwb25zZS5kYXRhLmRhdGFbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKCkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDMwMCkKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIGFzeW5jIG9ubG9hZEN1cnJlbmN5KCkgewogICAgICAgICAgICBjb25zdCBkYXRlID0gdGhpcy5tb250aGx5UmV0dXJuLm1vbnRoT2YgKyAnLScgKyAnMzAnCiAgICAgICAgICAgIGNvbnN0IGNvZGUgPSAnS0hSJwogICAgICAgICAgICBjdXJyZW5jeUhhbmRsZXIuZ2V0TGFzdEV4Y2hhbmdlUmF0ZVRheEJ5RGF0ZShkYXRlLCBjb2RlKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbmN5ID0gcmVzLmRhdGEuZGF0YVswXQogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlcywgJ2N1cnJlbmN5JykKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIGFzeW5jIG9uTG9hZE9uZVJldHVybigpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCdyZXNvbHZlZCcpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlkID0gdGhpcy4kcm91dGUucGFyYW1zLmlkCiAgICAgICAgICAgICAgICAgICAgbW9udGhseVJldHVybkhhbmRsZXIuZ2V0T25lKGlkKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhyZXMsICdkYXRhIGxvYWQgbW9udGhseSByZXR1cm4nKQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4gPSByZXMuZGF0YS5kYXRhWzBdCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vbnRobHlSZXR1cm4uc3RhdHVzLmlkID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ1ZpZXcgVGF4IFJldHVybicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogJ3ZpZXdfbW9udGhseV9yZXR1cm4vJyArIHRoaXMubW9udGhseVJldHVybi5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHtpZDogdGhpcy5tb250aGx5UmV0dXJuLmlkLCBtb250aGx5UmV0dXJuOiB0aGlzLm1vbnRobHlSZXR1cm59LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiB7dHlwZTogJ3ZpZXcnfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2codGhpcy5tb250aGx5UmV0dXJuKQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluaXRMb2NhbFN0b3JhZ2UodGhpcy5tb250aGx5UmV0dXJuLm51bWJlcikKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGVwcyA9IHRoaXMubW9udGhseVJldHVybi5zdGVwCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlYWNoVG9wU3RlcCA8PSB0aGlzLnN0ZXBzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlYWNoVG9wU3RlcCA9IHRoaXMuc3RlcHMKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0ZXBzQ29uZGl0aW9uKHRoaXMuc3RlcHMpCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuc3RhcnRfcmV0dXJuID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIGFzeW5jIHN0YXJ0UmV0dXJuKCkgewogICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZQogICAgICAgICAgICBhd2FpdCB0aGlzLmNoZWNrTW9udGhseVJldHVybigpCiAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1c01yKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LmVycm9yKCdUaGlzIG1vbnRoIG9mIGlzIGV4aXN0JykKICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzTXIgPSBmYWxzZQogICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBhd2FpdCB0aGlzLmdlbmVyYXRlTnVtYmVyKCkKICAgICAgICAgICAgLy8gdGhpcy5zdGFydF9yZXR1cm4gPSB0cnVlCiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkUHJlZml4KCkgewogICAgICAgICAgICBwcmVmaXhIYW5kbGVyLmdldCgnbW9udGhseSByZXR1cm4nKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvblR5cGVzID0gcmVzLmRhdGEuZGF0YQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRyYW5zYWN0aW9uVHlwZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4udHJhbnNhY3Rpb25UeXBlID0gdGhpcy50cmFuc2FjdGlvblR5cGVzWzBdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgZ2VuZXJhdGVOdW1iZXIoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLm1vbnRobHlSZXR1cm4udHJhbnNhY3Rpb25UeXBlLmFiYnIgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5sb2FkUHJlZml4KCkKICAgICAgICAgICAgfQogICAgICAgICAgICBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoJ3Jlc29sdmVkJyk7CiAgICAgICAgICAgICAgICAgICAgbGV0IGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFiYnI6IHRoaXMubW9udGhseVJldHVybi50cmFuc2FjdGlvblR5cGUuYWJiciwKICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0dXJlOiB0aGlzLm1vbnRobHlSZXR1cm4udHJhbnNhY3Rpb25UeXBlLnN0cnVjdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25EYXRlOiB0aGlzLm1vbnRobHlSZXR1cm4ubW9udGhPZiwKICAgICAgICAgICAgICAgICAgICAgICAgc2VxdWNlbmNpbmc6IHRoaXMubW9udGhseVJldHVybi50cmFuc2FjdGlvblR5cGUuc2VxdWNlbmNpbmcsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdNb250aGx5IFJldHVybicsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMubW9udGhseVJldHVybi5hYmJyID0gZGF0YS5hYmJyCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuLnN0cnVjdHVyZSA9IGRhdGEuc3RydWN0dXJlCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuLnNlcXVjZW5jaW5nID0gZGF0YS5zZXF1Y2VuY2luZwogICAgICAgICAgICAgICAgICAgIHRoaXMubW9udGhseVJldHVybi50eXBlID0gZGF0YS50eXBlCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuLnRyYW5zYWN0aW9uRGF0ZSA9IGRhdGEudHJhbnNhY3Rpb25EYXRlCiAgICAgICAgICAgICAgICAgICAgcHJlZml4SGFuZGxlci5sYXN0TnVtYmVyKGRhdGEpLnRoZW4oYXN5bmMgcmVzcG9uc2UgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IHJlc3BvbnNlLmRhdGEuZGF0YQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGFzdE51bWJlciA9IHRoaXMuemVyb1BhZChwYXJzZUludChyZXMubGFzdE51bWJlciksIHRoaXMubW9udGhseVJldHVybi50cmFuc2FjdGlvblR5cGUuZm9ybWF0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuLm51bWJlciA9IHJlcy5zdWZmaXggKyB0aGlzLm1vbnRobHlSZXR1cm4udHJhbnNhY3Rpb25UeXBlLm51bWJlclNlcGFyYXRvciArIGxhc3ROdW1iZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9udGhseVJldHVybi5sYXN0TnVtYmVyID0gcmVzLnN1ZmZpeCArIGxhc3ROdW1iZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyLCAnbW9udGhseSByZXR1cm4nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXdhaXQgdGhpcy5zYXZlUmV0dXJuKCkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4uaWQgPSBgbXItJHt1dWlkLnYxKCl9YAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuLnN0YXR1cyA9IHtpZDogMSwgbmFtZTogJ0RyYWZ0ZWQnfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuLmVkaXREYXRlID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnN1YnN0cigwLCAxMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9udGhseVJldHVybi5hbW91bnRQYWlkID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuLmV4Q2hhbmdlUmF0ZSA9IDQwMDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9udGhseVJldHVybi5zdGVwID0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCdtb250aGx5IHJldHVybicsIHRoaXMubW9udGhseVJldHVybikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnbmV3X3RheF9yZXR1cm4nICsgYC8ke3RoaXMubW9udGhseVJldHVybi5pZH1gLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdOZXcgVGF4IFJldHVybicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7aWQ6IHRoaXMubW9udGhseVJldHVybi5pZCwgbW9udGhseVJldHVybjogdGhpcy5tb250aGx5UmV0dXJufSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVyeToge3R5cGU6ICdlZGl0J30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzUm91dGUgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tb250aGx5UmV0dXJuLnByb2dyZXNzID09PSAnJyAmJiB0aGlzLmlzUm91dGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnJldHVyblZhbHVlID0gJ1BsZWFzZSBtYWtlIHN1cmUgeW91IGFscmVhZHkgc2F2ZSBkcmFmdCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucmV0dXJuVmFsdWUgPSAnJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5lcnJvcihlKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZW51ID0gZmFsc2UKICAgICAgICAgICAgICAgIH0sIDMwMCkKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIHplcm9QYWQobnVtLCBwbGFjZXMpIHsKICAgICAgICAgICAgcmV0dXJuIFN0cmluZyhudW0pLnBhZFN0YXJ0KHBsYWNlcywgJzAnKQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZExpc3RUYXgoKSB7CiAgICAgICAgICAgIGF3YWl0IHRheFNldHRpbmdIYW5kbGVyLmdldChhcGlVcmwudGF4X3NldHRpbmcudGF4X2xpc3RfZ2V0LCAibGlzdFRheCIsICJzZXRMaXN0VGF4IikKICAgICAgICB9LAogICAgICAgIGFzeW5jIHNhdmVSZXR1cm4oKSB7CiAgICAgICAgICAgIG1vbnRobHlSZXR1cm5IYW5kbGVyLmNyZWF0ZSh0aGlzLm1vbnRobHlSZXR1cm4pLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhyZXMpCiAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4gPSByZXMuZGF0YS5kYXRhCiAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgcGF0aDogJ25ld190YXhfcmV0dXJuJyArIGAvJHt0aGlzLm1vbnRobHlSZXR1cm4uaWR9YCwKICAgICAgICAgICAgICAgICAgICBuYW1lOiAnTmV3IFRheCBSZXR1cm4nLAogICAgICAgICAgICAgICAgICAgIHBhcmFtczoge2lkOiB0aGlzLm1vbnRobHlSZXR1cm4uaWR9LAogICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiB7dHlwZTogJ2VkaXQnfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIHRoaXMuaXNDcmVhdGUgPSB0cnVlCiAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5lcnJvcihlLm1lc3NhZ2UpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBhc3luYyBzYXZlRHJhZnQoKSB7CiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlCiAgICAgICAgICAgIHRoaXMubW9udGhseVJldHVybi5zdGVwID0gdGhpcy5zdGVwcwogICAgICAgICAgICBsZXQgcHJvZ3Jlc3NOYW1lID0gJycKICAgICAgICAgICAgaWYgKHRoaXMuc3RlcHMgPT09IDEpIHsKICAgICAgICAgICAgICAgIHByb2dyZXNzTmFtZSA9ICdJbnB1dCcKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnN0ZXBzID09PSAyKSB7CiAgICAgICAgICAgICAgICBwcm9ncmVzc05hbWUgPSAnUmV2aWV3JwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc3RlcHMgPT09IDMpIHsKICAgICAgICAgICAgICAgIHByb2dyZXNzTmFtZSA9ICdDb25maXJtJwogICAgICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuLmFtb3VudFBhaWQgPSB0aGlzLnRvdGFsQW1vdW50UGFpZC5hbW91bnQKICAgICAgICAgICAgICAgIGlmICh0aGlzLnRvdGFsQW1vdW50UGFpZC5zdW1tYXJ5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRvdGFsQW1vdW50UGFpZC5zdW1tYXJ5Lm1vbnRoT2YgPSB0aGlzLm1vbnRobHlSZXR1cm4ubW9udGhPZgogICAgICAgICAgICAgICAgICAgIHN1bW1hcnlIYW5kbGVyLmNyZWF0ZSh0aGlzLnRvdGFsQW1vdW50UGFpZC5zdW1tYXJ5KS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhyZXMsICdzdW1tYXJ5IGNyZWF0ZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmJhbGFuY2VWYXQuY3JlZGl0ICYmIHRoaXMuYmFsYW5jZVZhdC5jcmVkaXQgPiAwIHx8IHRoaXMuYmFsYW5jZVZhdC5wYXltZW50ICYmIHRoaXMuYmFsYW5jZVZhdC5wYXltZW50ID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWRpdDogdGhpcy5iYWxhbmNlVmF0LmNyZWRpdCwKICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudDogdGhpcy5iYWxhbmNlVmF0LnBheW1lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRoT2Y6IHRoaXMubW9udGhseVJldHVybi5tb250aE9mLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndmF0IG1vbnRobHknLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBuZXcgRGF0ZSgpLnRvSlNPTigpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGF3YWl0IG1vbnRobHlSZXR1cm5IYW5kbGVyLmFkZFR4blZBVChkYXRhLCB0aGlzLm1vbnRobHlSZXR1cm4ubW9udGhPZiwgJ21vbnRobHknKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhyZXMpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmJhbGFuY2VQcGkuYmFsYW5jZSAmJiB0aGlzLmJhbGFuY2VQcGkuYmFsYW5jZSA+IDAgfHwgdGhpcy5iYWxhbmNlUHBpLmNyZWRpdCAmJiB0aGlzLmJhbGFuY2VQcGkuY3JlZGl0ID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogdGhpcy5iYWxhbmNlUHBpLmJhbGFuY2UsCiAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRoT2Y6IHRoaXMubW9udGhseVJldHVybi5tb250aE9mLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAncHBpIG1vbnRobHknLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBuZXcgRGF0ZSgpLnRvSlNPTigpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGF3YWl0IG1vbnRobHlSZXR1cm5IYW5kbGVyLmFkZFR4blBQSShkYXRhLCB0aGlzLm1vbnRobHlSZXR1cm4ubW9udGhPZiwgJ21vbnRobHknKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhyZXMpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnN0ZXBzID09PSA0KSB7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmxvYWRMaXN0VGF4KCkKICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLnNhbGVzLCAnc2FsZXMnKQogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHRoaXMucHVyY2hhc2VzLCAncHVyY2hhc2VzJykKICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLndpdGhob2xkaW5ncywgJ3dpdGhob2xkaW5ncycpCiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2codGhpcy5zYWxhcmllcywgJ3NhbGFyaWVzJykKICAgICAgICAgICAgICAgIGxldCBhbXRTYWxlID0gMCwgYWNjU2FsZSA9IHt9LAogICAgICAgICAgICAgICAgICAgIGFtdFB1cmNoYXNlID0gMCwgYWNjUHVyY2hhc2UgPSB7fSwKICAgICAgICAgICAgICAgICAgICBhbXRXaHQgPSAwLCBhY2NXaHQgPSB7fSwKICAgICAgICAgICAgICAgICAgICBhbXRQUGkgPSAwLCBhY2NQUGkgPSB7fSwKICAgICAgICAgICAgICAgICAgICBhbXRPdGhlciA9IDAsIGFjY090aGVyID0ge30sCiAgICAgICAgICAgICAgICAgICAgYW10U2FsYXJ5ID0gMCwgYWNjU2FsYXJ5ID0ge30sCiAgICAgICAgICAgICAgICAgICAgYW10RkJUID0gMCwgYWNjRkJUID0ge30KICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLmxpc3RUYXhzLCBwcm9ncmVzc05hbWUsICdsaXN0VGF4JykKICAgICAgICAgICAgICAgIGFjY1NhbGUgPSB0aGlzLmxpc3RUYXhzLmZpbHRlcihvID0+IG8udGF4VHlwZS50eXBlSWQgPT09IDEgJiYgby50cmFuc2FjdGlvblR5cGUgPT09ICdTYWxlJylbMF0uYWNjb3VudAogICAgICAgICAgICAgICAgYWNjUHVyY2hhc2UgPSB0aGlzLmxpc3RUYXhzLmZpbHRlcihvID0+IG8udGF4VHlwZS50eXBlSWQgPT09IDEgJiYgby50cmFuc2FjdGlvblR5cGUgPT09ICdQdXJjaGFzZScpWzBdLmFjY291bnQKICAgICAgICAgICAgICAgIGFjY1dodCA9IHRoaXMubGlzdFRheHMuZmlsdGVyKG8gPT4gby50YXhUeXBlLnR5cGVJZCA9PT0gMiAmJiBvLnRyYW5zYWN0aW9uVHlwZSA9PT0gJ1B1cmNoYXNlJylbMF0uYWNjb3VudAogICAgICAgICAgICAgICAgYWNjUFBpID0gdGhpcy5saXN0VGF4cy5maWx0ZXIobyA9PiBvLnRheFR5cGUudHlwZUlkID09PSA2KVswXS5hY2NvdW50CiAgICAgICAgICAgICAgICBhY2NPdGhlciA9IHRoaXMubGlzdFRheHMuZmlsdGVyKG8gPT4gby50YXhUeXBlLnR5cGVJZCA9PT0gNylbMF0uYWNjb3VudAogICAgICAgICAgICAgICAgYWNjU2FsYXJ5ID0gdGhpcy5saXN0VGF4cy5maWx0ZXIobyA9PiBvLnRheFR5cGUudHlwZUlkID09PSAzKVswXS5hY2NvdW50CiAgICAgICAgICAgICAgICBhY2NGQlQgPSB0aGlzLmxpc3RUYXhzLmZpbHRlcihvID0+IG8udGF4VHlwZS50eXBlSWQgPT09IDQpWzBdLmFjY291bnQKICAgICAgICAgICAgICAgIHRoaXMuc2FsZXMuZm9yRWFjaChpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoaS5pdGVtTGluZVswXS50YXhOYW1lLmFjY291bnRJZCA9PT0gYWNjU2FsZS5pZCkgewogICAgICAgICAgICAgICAgICAgICAgICBhbXRTYWxlICs9IGkudG90YWxWQVQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGkuaXRlbUxpbmVbMF0uc3BlY2lmaWNUYXguYWNjb3VudElkID09PSBhY2NPdGhlci5pZCkgewogICAgICAgICAgICAgICAgICAgICAgICBhbXRPdGhlciArPSBpLnRvdGFsU3BlY2lmaWNUYXgKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGkuaXRlbUxpbmVbMF0ucHViVGF4LmFjY291bnRJZCA9PT0gYWNjT3RoZXIuaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYW10T3RoZXIgKz0gaS50b3RhbFB1YlRheAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoaS5pdGVtTGluZVswXS5hY2NvbVRheC5hY2NvdW50SWQgPT09IGFjY090aGVyLmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFtdE90aGVyICs9IGkudG90YWxBY2NvbVRheAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlcy5mb3JFYWNoKGkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChpLml0ZW1MaW5lWzBdLnRheE5hbWUuYWNjb3VudElkID09PSBhY2NQdXJjaGFzZS5pZCkgewogICAgICAgICAgICAgICAgICAgICAgICBhbXRQdXJjaGFzZSArPSBpLnRvdGFsVkFUCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIHRoaXMud2l0aGhvbGRpbmdzLmZvckVhY2goaSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGkuaXRlbUxpbmVbMF0udGF4TmFtZS5hY2NvdW50SWQgPT09IGFjY1dodC5pZCkgewogICAgICAgICAgICAgICAgICAgICAgICBhbXRXaHQgKz0gaS50b3RhbFZBVAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB0aGlzLnNhbGFyaWVzLmZvckVhY2goaSA9PiB7CiAgICAgICAgICAgICAgICAgICAgYW10U2FsYXJ5ICs9IGkuYW1vdW50VGF4U2FsYXJ5CiAgICAgICAgICAgICAgICAgICAgYW10RkJUICs9IGkudGF4QW1vdW50QmVuZWZpdAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIGFtdFBQaSA9IHRoaXMuYmFsYW5jZVBwaS5iYWxhbmNlCiAgICAgICAgICAgICAgICBpZiAodGhpcy5qb3VybmFsU3VtbWFyeS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmpvdXJuYWxTdW1tYXJ5ID0gWwogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogYG1yLSR7dXVpZC52MSgpfWAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZV9yYXRlOiB0aGlzLmN1cnJlbmN5LnJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogdGhpcy5jdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IGFjY1NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IGtlbmRvLnBhcnNlRmxvYXQoYW10U2FsZSkKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGBtci0ke3V1aWQudjEoKX1gLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VfcmF0ZTogdGhpcy5jdXJyZW5jeS5yYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k6IHRoaXMuY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiBhY2NQdXJjaGFzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDoga2VuZG8ucGFyc2VGbG9hdChhbXRQdXJjaGFzZSkgKiAoLTEpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBgbXItJHt1dWlkLnYxKCl9YCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlX3JhdGU6IHRoaXMuY3VycmVuY3kucmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiB0aGlzLmN1cnJlbmN5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogYWNjV2h0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBhbXRXaHQKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGBtci0ke3V1aWQudjEoKX1gLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VfcmF0ZTogdGhpcy5jdXJyZW5jeS5yYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k6IHRoaXMuY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiBhY2NPdGhlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogYW10T3RoZXIKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGBtci0ke3V1aWQudjEoKX1gLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VfcmF0ZTogdGhpcy5jdXJyZW5jeS5yYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k6IHRoaXMuY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiBhY2NQUGksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IGFtdFBQaQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogYG1yLSR7dXVpZC52MSgpfWAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZV9yYXRlOiB0aGlzLmN1cnJlbmN5LnJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogdGhpcy5jdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IGFjY1NhbGFyeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogYW10U2FsYXJ5CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBgbXItJHt1dWlkLnYxKCl9YCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlX3JhdGU6IHRoaXMuY3VycmVuY3kucmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiB0aGlzLmN1cnJlbmN5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogYWNjRkJULAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBhbXRGQlQKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLmpvdXJuYWxTdW1tYXJ5LCAnam91cm5hbFN1bW1hcnknKQogICAgICAgICAgICAgICAgYXdhaXQgbW9udGhseVJldHVybkhhbmRsZXIuY3JlYXRlSm91cm5hbCh0aGlzLmpvdXJuYWxTdW1tYXJ5KS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlcywgJ2NyZWF0ZSBqb3VybmFsIG1vbnRobHkgcmV0dXJuJykKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coYW10U2FsZSwgYWNjU2FsZSwgJ2Ftb3VudCBzYWxlIGFjYycpCiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coYW10UHVyY2hhc2UsIGFjY1B1cmNoYXNlLCAnYW1vdW50IHB1cmNoYXNlIGFjYycpCiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coYW10V2h0LCBhY2NXaHQsICdhbW91bnQgd2h0IGFjYycpCiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coYW10T3RoZXIsIGFjY090aGVyLCAnYW1vdW50IG90aGVyIGFjYycpCiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coYW10UFBpLCBhY2NQUGksICdhbW91bnQgUFBpIGFjYycpCiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coYW10U2FsYXJ5LCBhY2NTYWxhcnksICdhbW91bnQgU2FsYXJ5IGFjYycpCiAgICAgICAgICAgICAgICBwcm9ncmVzc05hbWUgPSAnRmluYWxpemUnCiAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4uYW1vdW50UGFpZCA9IHRoaXMudG90YWxBbW91bnRQYWlkLmFtb3VudAogICAgICAgICAgICAgICAgaWYgKHRoaXMudG90YWxBbW91bnRQYWlkLnN1bW1hcnkgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMudG90YWxBbW91bnRQYWlkLnN1bW1hcnkubW9udGhPZiA9IHRoaXMubW9udGhseVJldHVybi5tb250aE9mCiAgICAgICAgICAgICAgICAgICAgc3VtbWFyeUhhbmRsZXIuY3JlYXRlKHRoaXMudG90YWxBbW91bnRQYWlkLnN1bW1hcnkpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlcywgJ3N1bW1hcnkgY3JlYXRlJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYmFsYW5jZVZhdC5jcmVkaXQgJiYgdGhpcy5iYWxhbmNlVmF0LmNyZWRpdCA+IDAgfHwgdGhpcy5iYWxhbmNlVmF0LnBheW1lbnQgJiYgdGhpcy5iYWxhbmNlVmF0LnBheW1lbnQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgY3JlZGl0OiB0aGlzLmJhbGFuY2VWYXQuY3JlZGl0LAogICAgICAgICAgICAgICAgICAgICAgICBwYXltZW50OiB0aGlzLmJhbGFuY2VWYXQucGF5bWVudCwKICAgICAgICAgICAgICAgICAgICAgICAgbW9udGhPZjogdGhpcy5tb250aGx5UmV0dXJuLm1vbnRoT2YsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICd2YXQgbW9udGhseScsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9KU09OKCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgbW9udGhseVJldHVybkhhbmRsZXIuYWRkVHhuVkFUKGRhdGEsIHRoaXMubW9udGhseVJldHVybi5tb250aE9mLCAnbW9udGhseScpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlcykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYmFsYW5jZVBwaS5iYWxhbmNlICYmIHRoaXMuYmFsYW5jZVBwaS5iYWxhbmNlID4gMCB8fCB0aGlzLmJhbGFuY2VQcGkuY3JlZGl0ICYmIHRoaXMuYmFsYW5jZVBwaS5jcmVkaXQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiB0aGlzLmJhbGFuY2VQcGkuYmFsYW5jZSwKICAgICAgICAgICAgICAgICAgICAgICAgbW9udGhPZjogdGhpcy5tb250aGx5UmV0dXJuLm1vbnRoT2YsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdwcGkgbW9udGhseScsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9KU09OKCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgbW9udGhseVJldHVybkhhbmRsZXIuYWRkVHhuUFBJKGRhdGEsIHRoaXMubW9udGhseVJldHVybi5tb250aE9mLCAnbW9udGhseScpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlcykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuLmRhdGVTYWxlID0gdGhpcy5kYXRlU2FsZS5kYXRlCiAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4uZGF0ZVB1cmNoYXNlID0gdGhpcy5kYXRlUHVyY2hhc2UuZGF0ZQogICAgICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuLmRhdGVXaHQgPSB0aGlzLmRhdGVXaHQuZGF0ZQogICAgICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuLmRhdGVTYWxhcnkgPSB0aGlzLmRhdGVTYWxhcnkuZGF0ZQogICAgICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuLmFtb3VudERsU2FsZSA9IHRoaXMuZGF0ZVNhbGUuYW1vdW50CiAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4uYW1vdW50RGxQdXJjaGFzZSA9IHRoaXMuZGF0ZVB1cmNoYXNlLmFtb3VudAogICAgICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuLmFtb3VudERsV2h0ID0gdGhpcy5kYXRlV2h0LmFtb3VudAogICAgICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuLmFtb3VudERsU2FsYXJ5ID0gdGhpcy5kYXRlU2FsYXJ5LmFtb3VudAogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMubW9udGhseVJldHVybi5wcm9ncmVzcyA9IHByb2dyZXNzTmFtZQogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2codGhpcy5tb250aGx5UmV0dXJuLCAnbW9udGhseVJldHVybicpCiAgICAgICAgICAgIGF3YWl0IG1vbnRobHlSZXR1cm5IYW5kbGVyLmNyZWF0ZSh0aGlzLm1vbnRobHlSZXR1cm4pLnRoZW4oYXN5bmMgcmVzID0+IHsKICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhyZXMpCiAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4gPSByZXMuZGF0YS5kYXRhCiAgICAgICAgICAgICAgICBpZiAodGhpcy5zYWxlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2FsZUhhbmRsZXIuY3JlYXRlKHRoaXMuc2FsZXMpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZTYWxlJykKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlcykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMucHVyY2hhc2VzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBwdXJjaGFzZUhhbmRsZXIuY3JlYXRlKHRoaXMucHVyY2hhc2VzKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKHRoaXMubW9udGhseVJldHVybi5hYmJyICsgdGhpcy5tb250aGx5UmV0dXJuLm51bWJlciArICcmUHVyY2hhc2UnKQogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2cocmVzKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy53aXRoaG9sZGluZ3MubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IHdpdGhob2xkaW5nSGFuZGxlci5jcmVhdGUodGhpcy53aXRoaG9sZGluZ3MpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZXaXRoaG9sZGluZycpCiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhyZXMpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLnNhbGFyaWVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBzYWxhcnlIYW5kbGVyLmNyZWF0ZSh0aGlzLnNhbGFyaWVzKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKHRoaXMubW9udGhseVJldHVybi5hYmJyICsgdGhpcy5tb250aGx5UmV0dXJuLm51bWJlciArICcmU2FsYXJ5JykKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlcykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gbG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZTYWxlJywgSlNPTi5zdHJpbmdpZnkoW10pKQogICAgICAgICAgICAgICAgLy8gbG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZQdXJjaGFzZScsIEpTT04uc3RyaW5naWZ5KFtdKSkKICAgICAgICAgICAgICAgIC8vIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMubW9udGhseVJldHVybi5hYmJyICsgdGhpcy5tb250aGx5UmV0dXJuLm51bWJlciArICcmV2l0aGhvbGRpbmcnLCBKU09OLnN0cmluZ2lmeShbXSkpCiAgICAgICAgICAgICAgICAvLyBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJlNhbGFyeScsIEpTT04uc3RyaW5naWZ5KFtdKSkKICAgICAgICAgICAgICAgIC8vIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMubW9udGhseVJldHVybi5hYmJyICsgdGhpcy5tb250aGx5UmV0dXJuLm51bWJlciArICcmU3RlcCcsIEpTT04uc3RyaW5naWZ5KHRoaXMuc3RlcHMpKQogICAgICAgICAgICAvLyAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUuZXJyb3IoZS5tZXNzYWdlKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbmV4dFN0cGVzKCkgewogICAgICAgICAgICBpZiAodGhpcy5zdGVwcyA9PSA0KSB7CiAgICAgICAgICAgICAgICB0aGlzLnNhdmVfbmV4dCA9ICJjb25maXJtX2Nsb3NlIgogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5zYXZlRHJhZnQoKQogICAgICAgICAgICAgICAgLy8gYXdhaXQgdGhpcy5jbGVhbigpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnNhdmVfbmV4dCA9ICJjb25maXJtX25leHQiCiAgICAgICAgICAgICAgICB0aGlzLnN0ZXBzID0gdGhpcy5zdGVwcyArIDEKICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlYWNoVG9wU3RlcCA8PSB0aGlzLnN0ZXBzKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWFjaFRvcFN0ZXAgPSB0aGlzLnN0ZXBzCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnN0ZXBzQ29uZGl0aW9uKHRoaXMuc3RlcHMpCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFzeW5jIENsaWNrU3RlcHMoc3RlcCkgewogICAgICAgICAgICBpZiAodGhpcy5zdGVwcyA9PT0gc3RlcCkgewogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0ZXAgPiB0aGlzLnJlYWNoVG9wU3RlcCkgewogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0ZXAgIT09IDQpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2F2ZV9uZXh0ID0gImNvbmZpcm1fbmV4dCIKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuc2F2ZV9uZXh0ID0gImNvbmZpcm1fY2xvc2UiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5zdGVwcyA9IHN0ZXAKICAgICAgICAgICAgdGhpcy5zdGVwc0NvbmRpdGlvbih0aGlzLnN0ZXBzKQogICAgICAgIH0sCiAgICAgICAgc3RlcHNDb25kaXRpb24odmFsKSB7CiAgICAgICAgICAgIHN3aXRjaCAodmFsKSB7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVDb2xvcjEgPSAicHJpbWFyeSIKICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUNvbG9yMiA9ICJ0aGlyZCIKICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUNvbG9yMyA9ICJ0aGlyZCIKICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUNvbG9yNCA9ICJ0aGlyZCIKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlQ29sb3IxID0gInRoaXJkIgogICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlQ29sb3IyID0gInByaW1hcnkiCiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVDb2xvcjMgPSAidGhpcmQiCiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVDb2xvcjQgPSAidGhpcmQiCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUNvbG9yMSA9ICJ0aGlyZCIKICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUNvbG9yMiA9ICJ0aGlyZCIKICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUNvbG9yMyA9ICJwcmltYXJ5IgogICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlQ29sb3I0ID0gInRoaXJkIgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlQ29sb3IxID0gInRoaXJkIgogICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlQ29sb3IyID0gInRoaXJkIgogICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlQ29sb3IzID0gInRoaXJkIgogICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlQ29sb3I0ID0gInByaW1hcnkiCiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0ZpbmFsID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIHRoaXMuc2F2ZV9uZXh0ID0gImNvbmZpcm1fY2xvc2UiCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbnVtYmVyRm9ybWF0KHZhbHVlKSB7CiAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLnNhbGVGb3JtQ29udGVudC5kZWNpbWFsLCduaW1vbCcpCiAgICAgICAgICAgIGlmICh2YWx1ZSA+PSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUudG9Mb2NhbGVTdHJpbmcoKQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlCiAgICAgICAgICAgIH0KCiAgICAgICAgfSwKICAgIH0sCiAgICBjcmVhdGVkKCkgewogICAgICAgIHRoaXMubG9hZExpc3RUYXgoKQogICAgfSwKICAgIGFzeW5jIG1vdW50ZWQoKSB7CiAgICAgICAgYXdhaXQgdGhpcy5vbmxvYWRDdXJyZW5jeSgpCiAgICAgICAgLy8gYXdhaXQgdGhpcy5sb2FkQ3VycmVuY3lEYXRhKGN1cnJlbmN5VHlwZS5UQVhfRVhDSEFOR0VfQ1VSUkVOQ1kpCiAgICAgICAgYXdhaXQgdGhpcy5pbml0RGF0YSgpCiAgICAgICAgYXdhaXQgdGhpcy5sb2FkUHJlZml4KCkKICAgIH0sCn0KCg=="},{"version":3,"sources":["newTaxReturn.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"newTaxReturn.vue","sourceRoot":"src/views/compliance/monthly_tax/new_tax_return","sourcesContent":["<template>\n    <v-app>\n        <v-container>\n            <v-row>\n                <v-col cols=\"12\" sm=\"12\">\n                    <v-card\n                        outlined\n                        dense\n                        class=\"pa-4 no_border rounded-sm\"\n                        color=\"white\">\n                        <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                            <v-card outlined dense class=\"no_border\">\n                                <h2 class=\"mb-0\">{{ $t('make_new_monthly_return') }}</h2>\n                                <v-icon\n                                    @click=\"onClose\"\n                                    style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                                    class=\"float-right\"\n                                >close\n                                </v-icon>\n\n                            </v-card>\n\n                            <v-row>\n                                <v-col sm=\"12\" cols=\"12\">\n                                    <div class=\"function_content\">\n                                        <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                                            <div>\n                                                <v-row>\n                                                    <v-col sm=\"4\" class=\"py-0\">\n                                                        <label>{{ $t('for_the_month_of') }}</label>\n                                                        <v-menu\n                                                            v-model=\"menu\"\n                                                            :disabled=\"DateState\"\n                                                            class=\"mt-1\"\n                                                            :close-on-content-click=\"false\"\n                                                            max-width=\"290\">\n                                                            <template v-slot:activator=\"{ on,attrs }\">\n                                                                <v-text-field class=\"disable_alert my-0 mt-1\"\n                                                                              v-model=\"monthlyReturn.monthOf\"\n                                                                              readonly\n                                                                              outlined\n                                                                              :disabled=\"DateState\"\n                                                                              append-icon=\"event\"\n                                                                              v-on=\"on\"\n                                                                              v-bind=\"attrs\"\n                                                                              @click:clear=\"monthlyReturn.monthOf\"\n                                                                              @click:append=\"menu = true\"\n                                                                              required/>\n                                                            </template>\n                                                            <v-date-picker\n                                                                :type=\"'month'\"\n                                                                @change=\"menu = false\"\n                                                                v-model=\"monthlyReturn.monthOf\"\n                                                                no-title\n                                                            />\n                                                        </v-menu>\n                                                    </v-col>\n                                                    <v-col sm=\"5\" class=\"py-0 mt-5 px-0\">\n                                                        <v-btn :disabled=\"DateState\" @click=\"startReturn\"\n                                                               class=\"ma-1 ml-2\"\n                                                               color=\"primary white--text text-capitalize\">\n                                                            {{ $t('start_new_return') }}\n                                                        </v-btn>\n                                                    </v-col>\n                                                </v-row>\n                                            </div>\n                                            <div v-if=\"start_return\">\n                                                <v-divider/>\n                                                <v-card elevation=\"0\" class=\"pa-3 mt-3\" color=\"grayBg\">\n                                                    <v-row>\n                                                        <v-col class=\"py-0\" cols=\"12\" sm=\"4\">\n                                                            <label>{{ $t('submission_id') }}</label>\n                                                            <v-row class=\"pt-1 pb-0\">\n                                                                <v-col sm=\"3\" cols=\"3\" class=\"py-0 pr-0\">\n                                                                    <div class=\"code_text text-uppercase\">\n                                                                        {{ monthlyReturn.abbr }}\n                                                                    </div>\n                                                                </v-col>\n                                                                <v-col sm=\"9\" cols=\"8\" class=\"py-0 pl-0 pr-1\">\n                                                                    <v-text-field\n                                                                        v-model=\"monthlyReturn.number\"\n                                                                        disabled\n                                                                        class=\"custom-border \"\n                                                                        outlined\n                                                                        :rules=\"[(v) => !!v || 'Number is required']\"\n                                                                        required\n                                                                    />\n                                                                </v-col>\n                                                            </v-row>\n                                                        </v-col>\n                                                        <v-col class=\"py-0\" cols=\"12\" sm=\"4\">\n                                                            <p class=\"mb-0 mt-5\">\n                                                                {{ $t('approved_exch_rate_month') }}</p>\n                                                        </v-col>\n                                                        <v-col class=\"py-0\" cols=\"12\" sm=\"4\">\n                                                            <h3 class=\"primary--text font_20 mt-5\">\n                                                                {{ numberFormat(this.$store.state.institute.institute.baseCurrency.code !== 'KHR' ? 1/(currency.rate) : currency.rate) }}</h3>\n                                                        </v-col>\n                                                    </v-row>\n                                                </v-card>\n                                                <v-row>\n                                                    <v-col sm=\"2\" class=\"align-center justify-center d-flex \">\n                                                        <div>\n                                                            <v-card @click=\"ClickSteps(1)\" width=\"44\" height=\"44\"\n                                                                    outlined dense :color=\"activeColor1\"\n                                                                    class=\"pointer  m_auto no_border align-center justify-center d-flex rounded-circle \">\n                                                                <h3 class=\"mt-2 white--text\" style=\"font-size: 24px\">\n                                                                    1</h3>\n                                                            </v-card>\n                                                            <p class=\"text-uppercase mt-2\">{{ $t('input') }}</p>\n                                                        </div>\n                                                    </v-col>\n                                                    <v-col sm=\"2\" class=\"align-center justify-center d-flex \">\n                                                        <div>\n                                                            <v-card @click=\"ClickSteps(2)\" width=\"44\" height=\"44\"\n                                                                    outlined dense :color=\"activeColor2\"\n                                                                    class=\"pointer m_auto no_border align-center justify-center d-flex rounded-circle \">\n                                                                <h3 class=\"mt-2 white--text\" style=\"font-size: 24px\">\n                                                                    2</h3>\n                                                            </v-card>\n                                                            <p class=\"text-uppercase mt-2\">{{ $t('review') }}</p>\n                                                        </div>\n                                                    </v-col>\n                                                    <v-col sm=\"2\" class=\"align-center justify-center d-flex \">\n                                                        <div>\n                                                            <v-card @click=\"ClickSteps(3)\" width=\"44\" height=\"44\"\n                                                                    outlined dense :color=\"activeColor3\"\n                                                                    class=\"pointer m_auto  no_border align-center justify-center d-flex rounded-circle \">\n                                                                <h3 class=\"mt-2 white--text\" style=\"font-size: 24px\">\n                                                                    3</h3>\n                                                            </v-card>\n                                                            <p class=\"text-uppercase mt-2\">{{ $t('confirm') }}</p>\n                                                        </div>\n                                                    </v-col>\n                                                    <v-col sm=\"2\" class=\"align-center justify-center d-flex \">\n                                                        <div>\n                                                            <v-card @click=\"new ClickSteps(4)\" width=\"44\" height=\"44\"\n                                                                    outlined dense :color=\"activeColor4\"\n                                                                    class=\"pointer m_auto  no_border align-center justify-center d-flex rounded-circle \">\n                                                                <h3 class=\"mt-2 white--text\" style=\"font-size: 24px\">\n                                                                    4</h3>\n                                                            </v-card>\n                                                            <p class=\"text-uppercase mt-2\">{{ $t('finalize') }}</p>\n                                                        </div>\n                                                    </v-col>\n                                                </v-row>\n                                                <v-divider/>\n                                                <!-- Body function to input -->\n                                                <div v-show=\"steps===1\">\n                                                    <InputTab :currency=\"currency\" :monthlyReturn=\"monthlyReturn\"\n                                                              @getSale=\"getInputSale\"\n                                                              @getPurchase=\"getInputPurchase\"\n                                                              @getSalary=\"getSalary\"\n                                                              @getWithholding=\"getWithholding\"/>\n                                                </div>\n                                                <!-- Steps 2 Adjustemnt -->\n                                                <div v-show=\"steps===2\">\n                                                    <ReviewTab :monthlyReturn=\"monthlyReturn\"\n                                                               :sale=\"sales\"\n                                                               :currency=\"currency\"\n                                                               :purchase=\"purchases\"\n                                                               :salary=\"salaries\"\n                                                               :withholding=\"withholdings\"\n                                                               @getOtherAmount=\"getOtherAmount\"\n                                                               @getAmountWht=\"getAmountWht\"\n                                                               @getTaxSalary=\"getAmountSalary\"\n                                                               @getTaxBenefit=\"getAmountTax\"\n                                                               @getAmountSaleExcul=\"getAmountSaleExcul\"\n                                                               @getTotalAmountPurchase=\"getTotalAmountPurchase\"\n                                                               @getAmountPurchaseExcul=\"getAmountPurchaseExcul\"\n                                                               @getAmountSale=\"getAmountSale\"\n                                                               :alertForm2=\"AlertValidate2\"/>\n                                                </div>\n                                                <!-- Steps there -->\n                                                <div v-show=\"steps===3\">\n                                                    <Confirm :currency=\"currency\" :monthlyReturn=\"monthlyReturn\"\n                                                             :totalAmountPurchase=\"amountTotalPurchase\"\n                                                             :otherAmount=\"otherAmount\"\n                                                             :amountPurchaseExcul=\"amountPurchaseExcul\"\n                                                             :amountSalary=\"amountSalary\"\n                                                             :amountBenefit=\"amountBenefit\"\n                                                             :amountSaleExcul=\"amountSaleExcul\" :amountSale=\"amountSale\"\n                                                             :amountWht=\"amountWht\" @getStep=\"getStep\"\n                                                             @getTotalAmountPaid=\"getTotalAmountPaid\"\n                                                             @getBalanceVat=\"getBalanceVat\"\n                                                             @getBalancePpi=\"getBalancePpi\"/>\n                                                </div>\n                                                <div v-show=\"steps===4\">\n                                                    <Finalize :sale=\"sales\" :purchase=\"purchases\"\n                                                              :salary=\"salaries\"\n                                                              :withholding=\"withholdings\" :monthlyReturn=\"monthlyReturn\"\n                                                              @getDatePurchase=\"getDatePurchase\"\n                                                              @getPurchase=\"getFinalPurchase\"\n                                                              @getDateWht=\"getDateWht\"\n                                                              @getDateSale=\"getDateSale\"/>\n                                                </div>\n                                            </div>\n                                        </v-form>\n                                    </div>\n                                </v-col>\n                            </v-row>\n                            <div class=\"function_footer px-4\">\n                                <!-- Warning Message -->\n                                <v-btn color=\"black\" class=\"float-left  white--text\">{{\n                                        $t('cancel')\n                                    }}\n                                </v-btn>\n                                <v-btn :disabled=\"!start_return\" class=\"float-right  btn_save_close\"\n                                       @click=\"nextStpes\">\n                                    {{ $t(save_next) }}\n                                </v-btn>\n                                <v-btn v-if=\"steps >= 1 && this.monthlyReturn.number !== ''\" @click=\"saveDraft\"\n                                       class=\"float-right mx-3 capitalize white--text \" color=\"primary\">\n                                    {{ $t('save_draft') }}\n                                </v-btn>\n                            </div>\n                        </v-form>\n                    </v-card>\n                </v-col>\n            </v-row>\n            <LoadingMe\n                :isLoading=\"showLoading\"\n                :fullPage=\"true\"\n                :type=\"'loading'\"\n                :myLoading=\"true\"\n            />\n        </v-container>\n    </v-app>\n</template>\n\n<script>\nimport LoadingMe from '@/components/Loading'\nimport MonthlyReturn from \"@/scripts/compliance/model/MonthlyReturn\";\nimport {i18n} from \"@/i18n\";\nimport kendo from '@progress/kendo-ui'\nimport {uuid} from 'vue-uuid'\nimport taxSettingHandler from \"@/scripts/taxSettingHandler\";\nconst monthlyReturnHandler = require(\"@/scripts/compliance/handler/monthlyReturnHandler\")\nconst saleHandler = require(\"@/scripts/compliance/handler/saleHandler\")\nconst purchaseHandler = require(\"@/scripts/compliance/handler/purchaseHandler\")\nconst salaryHandler = require(\"@/scripts/compliance/handler/salaryHandler\")\nconst withholdingHandler = require(\"@/scripts/compliance/handler/withholdingTaxHandler\")\nconst monthlyReturn = new MonthlyReturn({})\nconst prefixHandler = require(\"@/scripts/compliance/handler/prefixHandler\")\nconst summaryHandler = require(\"@/scripts/compliance/handler/summaryHandler\")\nconst currencyHandler = require(\"@/scripts/currency/handler/currencyHandler\")\nconst apiUrl = require('@/apiUrl')\n// const taxSetting = require('@/store/taxSetting');\nconst currencyType = {\n    TAX_EXCHANGE_CURRENCY: 'tax-c',\n}\n// const axios = require('axios')\nexport default {\n    name: \"TaxReturn\",\n    components: {\n        'LoadingMe': LoadingMe,\n        // 'month-picker': () => import('@/components/custom_templates/MonthPicker'),\n        InputTab: () => import('./input/InputTab'),\n        ReviewTab: () => import('./review/ReviewTab'),\n        Confirm: () => import('./confirm/ConfirmTab'),\n        Finalize: () => import('./finalize/Finalize')\n    },\n    data: () => ({\n        menu: false,\n        templates: [],\n        month: '',\n        showLoading: false,\n        valid: '',\n        bill_date: \"\",\n        journal_date: '',\n        steps: 1,\n        reachTopStep: 0,\n        check: false,\n        save_next: 'save_next',\n        activeColor1: \"primary\",\n        activeColor2: \"third\",\n        activeColor3: \"third\",\n        activeColor4: \"third\",\n        isFinal: false,\n        // third\n        check1: false,\n        check2: false,\n        check3: false,\n        payroll_id: '',\n        loadPayrolls: [],\n        // start_return: false,\n\n        isCreate: false,\n        transactionTypes: [],\n        monthlyReturn: monthlyReturn,\n        // isGetAmount: false,\n        AlertValidate2: false,\n\n        currency: {},\n        sales: [],\n        purchases: [],\n        salaries: [],\n        withholdings: [],\n        amountSale: 0,\n        amountSaleExcul: 0,\n        amountTotalPurchase: 0,\n        amountPurchaseExcul: 0,\n        amountWht: 0,\n        amountSalary: 0,\n        amountBenefit: 0,\n        otherAmount: 0,\n        totalAmountPaid: 0,\n        summary: {},\n        isRoute: false,\n        balanceVat: {},\n        balancePpi: {},\n        dateSale: '',\n        datePurchase: '',\n        dateWht: '',\n        dateSalary: '',\n        statusMr: false,\n        journalSummary: [],\n        listTaxs: []\n    }),\n    computed: {\n        start_return() {\n            return this.monthlyReturn.number !== '' && this.$route.params.id !== '';\n        },\n        id() {\n            if (this.$route.params.id) {\n                return this.$route.params.id\n            } else {\n                return ''\n            }\n        },\n        DateState() {\n            return this.$route.params.id !== undefined || this.$route.query.type === 'edit' || this.$route.query.type === 'view';\n        },\n        // listTaxs: {\n        //     set(listTax) {\n        //         taxSetting.default.commit(\"setListTax\", listTax)\n        //     },\n        //     get() {\n        //         return taxSetting.default.state.listTax\n        //     }\n        // },\n    },\n    watch: {\n        'id': 'initData',\n    },\n    beforeRouteLeave (to, from , next) {\n        if (to.name === 'Add Purchase' || to.name === 'Add Sale' || to.name === 'Add Withholding Tax') {\n            next()\n        } else {\n            const sales = this.$store.state.compliance.sale\n            if (sales.length > 0 && sales.filter(p => p.isSave === false)) {\n                this.$swal({\n                    title: i18n.t('msg_title_warning'),\n                    text: i18n.t('msg_leave'),\n                    icon: \"warning\",\n                    cancelButtonText: i18n.t('force_leave'),\n                    confirmButtonColor: \"#4d4848\",\n                    cancelButtonColor: \"#ED1A3A\",\n                    showDenyButton: true,\n                    confirmButtonText: i18n.t('leave'),\n                    showCancelButton: true,\n                    showCloseButton: true,\n                }).then(res => {\n                    if (res.isConfirmed || res.isDismissed && res.dismiss === 'cancel') {\n                        next()\n                        this.clear()\n                        this.amountSale = 0\n                        this.amountSaleExcul = 0\n                        this.amountPurchase = 0\n                        this.amountWht = 0\n                        this.otherAmount = 0\n                        this.totalAmountPaid = 0\n                    } else {\n                        next(false)\n                    }\n                    window.console.log(res, 'discard')\n                })\n            } else {\n                if (this.monthlyReturn.progress === '' && this.isRoute) {\n                    this.$swal({\n                        title: i18n.t('msg_title_warning'),\n                        text: i18n.t('msg_discard'),\n                        icon: \"warning\",\n                        showCancelButton: true,\n                        cancelButtonText: i18n.t('cancel'),\n                        confirmButtonColor: \"#4d4848\",\n                        cancelButtonColor: \"#ED1A3A\",\n                        confirmButtonText: i18n.t('discard'),\n                    }).then(res => {\n                        if (res.isConfirmed) {\n                            next()\n                            this.clear()\n                            this.amountSale = 0\n                            this.amountSaleExcul = 0\n                            this.amountPurchase = 0\n                            this.amountWht = 0\n                            this.otherAmount = 0\n                            this.totalAmountPaid = 0\n                        } else {\n                            next(false)\n                        }\n                    })\n                } else {\n                    next()\n                }\n            }\n        }\n    },\n    methods: {\n        async checkMonthlyReturn() {\n            monthlyReturnHandler.getByMonth(this.monthlyReturn.monthOf).then(res => {\n                window.console.log(res, 'get month123')\n                if (res.data.data === 1) {\n                    this.statusMr = true\n                }\n            })\n        },\n        getFinalPurchase(purchase) {\n            if (this.purchases.length === 0) {\n                this.purchases = purchase\n            }\n        },\n        getBalanceVat(balance) {\n            this.balanceVat = balance\n            window.console.log(this.balanceVat.credit, this.balanceVat.payment, 'balanceVat')\n        },\n        getBalancePpi(balance) {\n            this.balancePpi = balance\n            window.console.log(this.balancePpi, 'balancePpi')\n        },\n        getSummary(summary) {\n            window.console.log('new tax tab summary', summary)\n            this.summary = summary\n        },\n        getDateWht(date) {\n            this.dateWht = date\n        },\n        getSalary(salary) {\n            this.salaries = salary\n        },\n        getDatePurchase(date) {\n            this.datePurchase = date\n        },\n        getDateSale(date) {\n            this.dateSale = date\n        },\n        getTotalAmountPaid(amount) {\n            this.totalAmountPaid = amount\n        },\n        getOtherAmount(amount) {\n            this.otherAmount = amount\n        },\n        getAmountSaleExcul(saleExcul) {\n            window.console.log('new tax tab sale excul', saleExcul)\n            this.amountSaleExcul = saleExcul\n        },\n        getWithholding(withholding) {\n            window.console.log('new tax tab withholding', withholding)\n            this.withholdings = withholding\n        },\n        getAmountSalary(amount) {\n            window.console.log('new tax tab salary', amount)\n            this.amountSalary = amount\n        },\n        getAmountTax(amount) {\n            window.console.log('new tax tab benefit', amount)\n            this.amountBenefit = amount\n        },\n        getInputPurchase(purchase) {\n            window.console.log('new tax tab purchase', purchase)\n            this.purchases = purchase\n        },\n        getInputSale(sale) {\n            window.console.log('new tax tab sale', sale)\n            this.sales = sale\n        },\n        getAmountWht(amount) {\n            window.console.log('new tax tab wht', amount)\n            this.amountWht = amount\n        },\n        getStep(step) {\n            this.steps = step\n            if (this.reachTopStep <= this.steps) {\n                this.reachTopStep = this.steps\n            }\n            this.stepsCondition(this.steps)\n        },\n        getTotalAmountPurchase(amount) {\n            this.amountTotalPurchase = amount\n            window.console.log(this.amountTotalPurchase, 'New Tax Tab Purchase')\n        },\n        getAmountPurchaseExcul(amount) {\n            this.amountPurchaseExcul = amount\n        },\n        getAmountSale(amount) {\n            this.amountSale = amount\n            window.console.log(this.amountSale, 'New Tax Tab Sale')\n        },\n        async initData() {\n            this.showLoading = true\n            if (this.$route.params.id !== undefined && this.$route.params.monthlyReturn === undefined) {\n                await this.onLoadOneReturn()\n                window.console.log(this.steps)\n            } else if (this.$route.params.monthlyReturn !== undefined) {\n                this.monthlyReturn = this.$route.params.monthlyReturn\n                if (this.monthlyReturn.status.id === 2) {\n                    this.$router.push({\n                        name: 'View Tax Return',\n                        path: 'view_monthly_return/' + this.monthlyReturn.id,\n                        params: {id: this.monthlyReturn.id, monthlyReturn: this.monthlyReturn},\n                        query: {type: 'view'}\n                    })\n                }\n                window.console.log(this.monthlyReturn, 'dafasdf34')\n                this.initLocalStorage(this.monthlyReturn.abbr, this.monthlyReturn.number)\n                const step = JSON.parse(localStorage.getItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Step'))\n                let steps = 1\n                if (this.monthlyReturn.step !== '') {\n                    steps = this.monthlyReturn.step\n                }\n                if (step > 0) {\n                    window.console.log('step12', step)\n                    if (this.monthlyReturn.step > step) {\n                        steps = this.monthlyReturn.step\n                    } else {\n                        steps = step\n                    }\n                }\n                this.steps = steps\n                if (this.reachTopStep <= this.steps) {\n                    this.reachTopStep = this.steps\n                }\n                this.stepsCondition(this.steps)\n                // this.start_return = true\n                this.showLoading = false\n                window.console.log(this.steps)\n            } else {\n                this.clear()\n            }\n        },\n        clear() {\n            this.monthlyReturn = new MonthlyReturn({})\n            this.showLoading = false\n        },\n        initLocalStorage(abbr, number) {\n            const sale = JSON.parse(localStorage.getItem(abbr + number + '&Sale'))\n            const purchase = JSON.parse(localStorage.getItem(abbr + number + '&Purchase'))\n            const withholding = JSON.parse(localStorage.getItem(abbr + number + '&Withholding'))\n            const salary = JSON.parse(localStorage.getItem(abbr + number + '&Salary'))\n            const step = JSON.parse(localStorage.getItem(abbr + number + '&Step'))\n            if (sale === null) {\n                localStorage.setItem(abbr + number + '&Sale', JSON.stringify([]))\n            }\n            if (purchase === null) {\n                localStorage.setItem(abbr + number + '&Purchase', JSON.stringify([]))\n            }\n            if (withholding === null) {\n                localStorage.setItem(abbr + number + '&Withholding', JSON.stringify([]))\n            }\n            if (salary === null) {\n                localStorage.setItem(abbr + number + '&Salary', JSON.stringify([]))\n            }\n            if (step === null) {\n                localStorage.setItem(abbr + number + '&Step', JSON.stringify(1))\n            }\n        },\n        onClose() {\n            const sales = this.$store.state.compliance.sale\n            const purchases = this.$store.state.compliance.purchase\n            const withholding = this.$store.state.compliance.withholding\n            if (sales.length > 0 && sales.filter(p => p.isSave === false) || purchases.length > 0 && purchases.filter(p => p.isSave === false) || withholding.length > 0 && withholding.filter(p => p.isSave === false)) {\n                this.$swal({\n                    title: i18n.t('msg_title_warning'),\n                    text: i18n.t('msg_leave'),\n                    icon: \"warning\",\n                    cancelButtonText: i18n.t('force_leave'),\n                    confirmButtonColor: \"#4d4848\",\n                    cancelButtonColor: \"#ED1A3A\",\n                    showDenyButton: true,\n                    confirmButtonText: i18n.t('leave'),\n                    showCancelButton: true,\n                    showCloseButton: true,\n                }).then(res => {\n                    if (res.isConfirmed || res.isDismissed && res.dismiss === 'cancel') {\n                        this.clean()\n                    }\n                    window.console.log(res, 'discard')\n                })\n            } else {\n                if (this.monthlyReturn.progress === '' && this.isRoute) {\n                    this.$swal({\n                        title: i18n.t('msg_title_warning'),\n                        text: i18n.t('msg_discard'),\n                        icon: \"warning\",\n                        showCancelButton: true,\n                        cancelButtonText: i18n.t('cancel'),\n                        confirmButtonColor: \"#4d4848\",\n                        cancelButtonColor: \"#ED1A3A\",\n                        confirmButtonText: i18n.t('discard'),\n                    }).then(res => {\n                        if (res.isConfirmed) {\n                            this.clean()\n                        }\n                    })\n                }\n            }\n\n            // const sale = JSON.parse(localStorage.getItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Sale'))\n            // const purchase = JSON.parse(localStorage.getItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Purchase'))\n            // const withholding = JSON.parse(localStorage.getItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Withholding'))\n            // const salary = JSON.parse(localStorage.getItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Salary'))\n            // const step = JSON.parse(localStorage.getItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Step'))\n            // if (sale === null) {\n            //     localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Sale', JSON.stringify([]))\n            // }\n            // if (purchase === null) {\n            //     localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Purchase', JSON.stringify([]))\n            // }\n            // if (withholding === null) {\n            //     localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Withholding', JSON.stringify([]))\n            // }\n            // if (salary === null) {\n            //     localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Salary', JSON.stringify([]))\n            // }\n            // if (step === null) {\n            //     localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Step', JSON.stringify(1))\n            // }\n            // if (sale !== null || purchase !== null || withholding !== null || salary !== null) {\n            //     if (sale.length > 0 || purchase.length > 0 || withholding.length > 0 || salary.length > 0) {\n            //         this.$swal({\n            //             title: i18n.t('msg_title_warning'),\n            //             text: i18n.t('msg_leave'),\n            //             icon: \"warning\",\n            //             cancelButtonText: i18n.t('force_leave'),\n            //             confirmButtonColor: \"#4d4848\",\n            //             cancelButtonColor: \"#ED1A3A\",\n            //             showDenyButton: true,\n            //             confirmButtonText: i18n.t('leave'),\n            //             showCancelButton: true,\n            //             showCloseButton: true,\n            //         }).then(res => {\n            //             if (res.isConfirmed) {\n            //                 localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Step', this.steps)\n            //                 this.clean()\n            //             } else if (res.isDismissed && res.dismiss === 'cancel') {\n            //                 localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Sale')\n            //                 localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Purchase')\n            //                 localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Salary')\n            //                 localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Withholding')\n            //                 localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Step')\n            //                 this.clean()\n            //             }\n            //             window.console.log(res, 'discard')\n            //         })\n            //     } else {\n            //         if (this.monthlyReturn.progress === '' && this.isRoute) {\n            //             this.$swal({\n            //                 title: i18n.t('msg_title_warning'),\n            //                 text: i18n.t('msg_discard'),\n            //                 icon: \"warning\",\n            //                 showCancelButton: true,\n            //                 cancelButtonText: i18n.t('cancel'),\n            //                 confirmButtonColor: \"#4d4848\",\n            //                 cancelButtonColor: \"#ED1A3A\",\n            //                 confirmButtonText: i18n.t('discard'),\n            //             }).then(res => {\n            //                 if (res.isConfirmed) {\n            //                     localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Sale')\n            //                     localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Purchase')\n            //                     localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Salary')\n            //                     localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Withholding')\n            //                     localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Step')\n            //                     this.clean()\n            //                 }\n            //                 window.console.log(res, 'discard')\n            //             })\n            //         } else {\n            //             this.clean()\n            //         }\n            //     }\n            // }\n        },\n        clean() {\n            this.clear()\n            this.amountSale = 0\n            this.amountSaleExcul = 0\n            this.amountPurchase = 0\n            this.amountWht = 0\n            this.otherAmount = 0\n            this.totalAmountPaid = 0\n            // this.start_return = false\n            if (!this.isRoute) {\n                this.isRoute = false\n                window.history.go(-1)\n\n            } else {\n                this.isRoute = false\n                window.history.go(-1)\n                window.history.go(-1)\n            }\n\n        },\n        async loadCurrencyData(type) {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved')\n                    this.showLoading = true\n                    currencyHandler.list(type).then(response => {\n                        if (response.data.statusCode === 200) {\n                            window.console.log('response','')\n                            if (type === currencyType.TAX_EXCHANGE_CURRENCY) {\n                                this.currency = response.data.data[0]\n                            }\n                        }\n                    }).catch()\n                    {\n                        this.showLoading = false\n                    }\n                }, 300)\n            })\n        },\n        async onloadCurrency() {\n            const date = this.monthlyReturn.monthOf + '-' + '30'\n            const code = 'KHR'\n            currencyHandler.getLastExchangeRateTaxByDate(date, code).then(res => {\n                this.currency = res.data.data[0]\n                window.console.log(res, 'currency')\n            })\n        },\n        async onLoadOneReturn() {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved');\n                    const id = this.$route.params.id\n                    monthlyReturnHandler.getOne(id).then(res => {\n                        window.console.log(res, 'data load monthly return')\n                        this.monthlyReturn = res.data.data[0]\n                        if (this.monthlyReturn.status.id === 2) {\n                            this.$router.push({\n                                name: 'View Tax Return',\n                                path: 'view_monthly_return/' + this.monthlyReturn.id,\n                                params: {id: this.monthlyReturn.id, monthlyReturn: this.monthlyReturn},\n                                query: {type: 'view'}\n                            })\n                        }\n                        window.console.log(this.monthlyReturn)\n                        this.initLocalStorage(this.monthlyReturn.number)\n                        this.steps = this.monthlyReturn.step\n                        if (this.reachTopStep <= this.steps) {\n                            this.reachTopStep = this.steps\n                        }\n                        this.stepsCondition(this.steps)\n                        // this.start_return = true\n                        this.showLoading = false\n                    })\n                })\n            })\n        },\n        async startReturn() {\n            this.showLoading = true\n            await this.checkMonthlyReturn()\n            if (this.statusMr) {\n                this.$snotify.error('This month of is exist')\n                this.statusMr = false\n                this.showLoading = false\n                return\n            }\n            await this.generateNumber()\n            // this.start_return = true\n        },\n        async loadPrefix() {\n            prefixHandler.get('monthly return').then(res => {\n                if (res.data.statusCode === 200) {\n                    this.transactionTypes = res.data.data\n                    if (this.transactionTypes.length > 0) {\n                        this.monthlyReturn.transactionType = this.transactionTypes[0]\n                    }\n                }\n            })\n        },\n        async generateNumber() {\n            if (this.monthlyReturn.transactionType.abbr === undefined) {\n                await this.loadPrefix()\n            }\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved');\n                    let data = {\n                        abbr: this.monthlyReturn.transactionType.abbr,\n                        structure: this.monthlyReturn.transactionType.structure,\n                        transactionDate: this.monthlyReturn.monthOf,\n                        sequcencing: this.monthlyReturn.transactionType.sequcencing,\n                        type: 'Monthly Return',\n                    }\n                    this.monthlyReturn.abbr = data.abbr\n                    this.monthlyReturn.structure = data.structure\n                    this.monthlyReturn.sequcencing = data.sequcencing\n                    this.monthlyReturn.type = data.type\n                    this.monthlyReturn.transactionDate = data.transactionDate\n                    prefixHandler.lastNumber(data).then(async response => {\n                        if (response.data.statusCode === 200) {\n                            const res = response.data.data\n                            const lastNumber = this.zeroPad(parseInt(res.lastNumber), this.monthlyReturn.transactionType.format)\n                            this.monthlyReturn.number = res.suffix + this.monthlyReturn.transactionType.numberSeparator + lastNumber\n                            this.monthlyReturn.lastNumber = res.suffix + lastNumber\n                            window.console.log(this.monthlyReturn.number, 'monthly return')\n                            // await this.saveReturn()\n\n                            this.monthlyReturn.id = `mr-${uuid.v1()}`\n                            this.monthlyReturn.status = {id: 1, name: 'Drafted'}\n                            this.monthlyReturn.editDate = new Date().toISOString().substr(0, 10)\n                            this.monthlyReturn.amountPaid = 0\n                            this.monthlyReturn.exChangeRate = 4000\n                            this.monthlyReturn.step = 1\n                            window.console.log('monthly return', this.monthlyReturn)\n                            this.$router.push({\n                                path: 'new_tax_return' + `/${this.monthlyReturn.id}`,\n                                name: 'New Tax Return',\n                                params: {id: this.monthlyReturn.id, monthlyReturn: this.monthlyReturn},\n                                query: {type: 'edit'}\n                            })\n                            this.isRoute = true\n                            if (this.monthlyReturn.progress === '' && this.isRoute) {\n                                window.addEventListener('beforeunload', function (event) {\n                                    event.returnValue = 'Please make sure you already save draft'\n                                })\n                                window.removeEventListener('beforeunload', function (event) {\n                                    event.returnValue = ''\n                                })\n                            }\n                            this.showLoading = false\n                        }\n                    }).catch(e => {\n                        window.console.error(e)\n                    })\n                    this.menu = false\n                }, 300)\n            })\n        },\n        zeroPad(num, places) {\n            return String(num).padStart(places, '0')\n        },\n        async loadListTax() {\n            await taxSettingHandler.get(apiUrl.tax_setting.tax_list_get, \"listTax\", \"setListTax\")\n        },\n        async saveReturn() {\n            monthlyReturnHandler.create(this.monthlyReturn).then(res => {\n                window.console.log(res)\n                this.monthlyReturn = res.data.data\n                this.$router.push({\n                    path: 'new_tax_return' + `/${this.monthlyReturn.id}`,\n                    name: 'New Tax Return',\n                    params: {id: this.monthlyReturn.id},\n                    query: {type: 'edit'}\n                })\n                this.isCreate = true\n                this.showLoading = false\n            }).catch(e => {\n                window.console.error(e.message)\n            })\n        },\n        async saveDraft() {\n            this.showLoading = true\n            this.monthlyReturn.step = this.steps\n            let progressName = ''\n            if (this.steps === 1) {\n                progressName = 'Input'\n            } else if (this.steps === 2) {\n                progressName = 'Review'\n            } else if (this.steps === 3) {\n                progressName = 'Confirm'\n                this.monthlyReturn.amountPaid = this.totalAmountPaid.amount\n                if (this.totalAmountPaid.summary !== undefined) {\n                    this.totalAmountPaid.summary.monthOf = this.monthlyReturn.monthOf\n                    summaryHandler.create(this.totalAmountPaid.summary).then(res => {\n                        window.console.log(res, 'summary create')\n                    })\n                }\n                if (this.balanceVat.credit && this.balanceVat.credit > 0 || this.balanceVat.payment && this.balanceVat.payment > 0) {\n                    const data = {\n                        credit: this.balanceVat.credit,\n                        payment: this.balanceVat.payment,\n                        monthOf: this.monthlyReturn.monthOf,\n                        type: 'vat monthly',\n                        date: new Date().toJSON()\n                    }\n                    await monthlyReturnHandler.addTxnVAT(data, this.monthlyReturn.monthOf, 'monthly').then(res => {\n                        window.console.log(res)\n                    })\n                }\n                if (this.balancePpi.balance && this.balancePpi.balance > 0 || this.balancePpi.credit && this.balancePpi.credit > 0) {\n                    const data = {\n                        amount: this.balancePpi.balance,\n                        monthOf: this.monthlyReturn.monthOf,\n                        type: 'ppi monthly',\n                        date: new Date().toJSON()\n                    }\n                    await monthlyReturnHandler.addTxnPPI(data, this.monthlyReturn.monthOf, 'monthly').then(res => {\n                        window.console.log(res)\n                    })\n                }\n            } else if (this.steps === 4) {\n                await this.loadListTax()\n                window.console.log(this.sales, 'sales')\n                window.console.log(this.purchases, 'purchases')\n                window.console.log(this.withholdings, 'withholdings')\n                window.console.log(this.salaries, 'salaries')\n                let amtSale = 0, accSale = {},\n                    amtPurchase = 0, accPurchase = {},\n                    amtWht = 0, accWht = {},\n                    amtPPi = 0, accPPi = {},\n                    amtOther = 0, accOther = {},\n                    amtSalary = 0, accSalary = {},\n                    amtFBT = 0, accFBT = {}\n                window.console.log(this.listTaxs, progressName, 'listTax')\n                accSale = this.listTaxs.filter(o => o.taxType.typeId === 1 && o.transactionType === 'Sale')[0].account\n                accPurchase = this.listTaxs.filter(o => o.taxType.typeId === 1 && o.transactionType === 'Purchase')[0].account\n                accWht = this.listTaxs.filter(o => o.taxType.typeId === 2 && o.transactionType === 'Purchase')[0].account\n                accPPi = this.listTaxs.filter(o => o.taxType.typeId === 6)[0].account\n                accOther = this.listTaxs.filter(o => o.taxType.typeId === 7)[0].account\n                accSalary = this.listTaxs.filter(o => o.taxType.typeId === 3)[0].account\n                accFBT = this.listTaxs.filter(o => o.taxType.typeId === 4)[0].account\n                this.sales.forEach(i => {\n                    if (i.itemLine[0].taxName.accountId === accSale.id) {\n                        amtSale += i.totalVAT\n                    }\n                    if (i.itemLine[0].specificTax.accountId === accOther.id) {\n                        amtOther += i.totalSpecificTax\n                    }\n                    if (i.itemLine[0].pubTax.accountId === accOther.id) {\n                        amtOther += i.totalPubTax\n                    }\n                    if (i.itemLine[0].accomTax.accountId === accOther.id) {\n                        amtOther += i.totalAccomTax\n                    }\n                })\n                this.purchases.forEach(i => {\n                    if (i.itemLine[0].taxName.accountId === accPurchase.id) {\n                        amtPurchase += i.totalVAT\n                    }\n                })\n                this.withholdings.forEach(i => {\n                    if (i.itemLine[0].taxName.accountId === accWht.id) {\n                        amtWht += i.totalVAT\n                    }\n                })\n                this.salaries.forEach(i => {\n                    amtSalary += i.amountTaxSalary\n                    amtFBT += i.taxAmountBenefit\n                })\n                amtPPi = this.balancePpi.balance\n                if (this.journalSummary.length === 0) {\n                    this.journalSummary = [\n                        {\n                            id: `mr-${uuid.v1()}`,\n                            exchange_rate: this.currency.rate,\n                            currency: this.currency,\n                            account: accSale,\n                            amount: kendo.parseFloat(amtSale)\n                        },\n                        {\n                            id: `mr-${uuid.v1()}`,\n                            exchange_rate: this.currency.rate,\n                            currency: this.currency,\n                            account: accPurchase,\n                            amount: kendo.parseFloat(amtPurchase) * (-1)\n                        },\n                        {\n                            id: `mr-${uuid.v1()}`,\n                            exchange_rate: this.currency.rate,\n                            currency: this.currency,\n                            account: accWht,\n                            amount: amtWht\n                        },\n                        {\n                            id: `mr-${uuid.v1()}`,\n                            exchange_rate: this.currency.rate,\n                            currency: this.currency,\n                            account: accOther,\n                            amount: amtOther\n                        },\n                        {\n                            id: `mr-${uuid.v1()}`,\n                            exchange_rate: this.currency.rate,\n                            currency: this.currency,\n                            account: accPPi,\n                            amount: amtPPi\n                        },\n                        {\n                            id: `mr-${uuid.v1()}`,\n                            exchange_rate: this.currency.rate,\n                            currency: this.currency,\n                            account: accSalary,\n                            amount: amtSalary\n                        },\n                        {\n                            id: `mr-${uuid.v1()}`,\n                            exchange_rate: this.currency.rate,\n                            currency: this.currency,\n                            account: accFBT,\n                            amount: amtFBT\n                        }\n                    ]\n                }\n                window.console.log(this.journalSummary, 'journalSummary')\n                await monthlyReturnHandler.createJournal(this.journalSummary).then(res => {\n                    window.console.log(res, 'create journal monthly return')\n                })\n                window.console.log(amtSale, accSale, 'amount sale acc')\n                window.console.log(amtPurchase, accPurchase, 'amount purchase acc')\n                window.console.log(amtWht, accWht, 'amount wht acc')\n                window.console.log(amtOther, accOther, 'amount other acc')\n                window.console.log(amtPPi, accPPi, 'amount PPi acc')\n                window.console.log(amtSalary, accSalary, 'amount Salary acc')\n                progressName = 'Finalize'\n                this.monthlyReturn.amountPaid = this.totalAmountPaid.amount\n                if (this.totalAmountPaid.summary !== undefined) {\n                    this.totalAmountPaid.summary.monthOf = this.monthlyReturn.monthOf\n                    summaryHandler.create(this.totalAmountPaid.summary).then(res => {\n                        window.console.log(res, 'summary create')\n                    })\n                }\n                if (this.balanceVat.credit && this.balanceVat.credit > 0 || this.balanceVat.payment && this.balanceVat.payment > 0) {\n                    const data = {\n                        credit: this.balanceVat.credit,\n                        payment: this.balanceVat.payment,\n                        monthOf: this.monthlyReturn.monthOf,\n                        type: 'vat monthly',\n                        date: new Date().toJSON()\n                    }\n                    await monthlyReturnHandler.addTxnVAT(data, this.monthlyReturn.monthOf, 'monthly').then(res => {\n                        window.console.log(res)\n                    })\n                }\n                if (this.balancePpi.balance && this.balancePpi.balance > 0 || this.balancePpi.credit && this.balancePpi.credit > 0) {\n                    const data = {\n                        amount: this.balancePpi.balance,\n                        monthOf: this.monthlyReturn.monthOf,\n                        type: 'ppi monthly',\n                        date: new Date().toJSON()\n                    }\n                    await monthlyReturnHandler.addTxnPPI(data, this.monthlyReturn.monthOf, 'monthly').then(res => {\n                        window.console.log(res)\n                    })\n                }\n                this.monthlyReturn.dateSale = this.dateSale.date\n                this.monthlyReturn.datePurchase = this.datePurchase.date\n                this.monthlyReturn.dateWht = this.dateWht.date\n                this.monthlyReturn.dateSalary = this.dateSalary.date\n                this.monthlyReturn.amountDlSale = this.dateSale.amount\n                this.monthlyReturn.amountDlPurchase = this.datePurchase.amount\n                this.monthlyReturn.amountDlWht = this.dateWht.amount\n                this.monthlyReturn.amountDlSalary = this.dateSalary.amount\n            }\n            this.monthlyReturn.progress = progressName\n            window.console.log(this.monthlyReturn, 'monthlyReturn')\n            await monthlyReturnHandler.create(this.monthlyReturn).then(async res => {\n                window.console.log(res)\n                this.monthlyReturn = res.data.data\n                if (this.sales.length > 0) {\n                    await saleHandler.create(this.sales).then(res => {\n                        localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Sale')\n                        window.console.log(res)\n                    })\n                }\n                if (this.purchases.length > 0) {\n                    await purchaseHandler.create(this.purchases).then(res => {\n                        localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Purchase')\n                        window.console.log(res)\n                    })\n                }\n                if (this.withholdings.length > 0) {\n                    await withholdingHandler.create(this.withholdings).then(res => {\n                        localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Withholding')\n                        window.console.log(res)\n                    })\n                }\n                if (this.salaries.length > 0) {\n                    await salaryHandler.create(this.salaries).then(res => {\n                        localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Salary')\n                        window.console.log(res)\n                    })\n                }\n                // localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Sale', JSON.stringify([]))\n                // localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Purchase', JSON.stringify([]))\n                // localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Withholding', JSON.stringify([]))\n                // localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Salary', JSON.stringify([]))\n                // localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Step', JSON.stringify(this.steps))\n            //     this.showLoading = false\n            }).catch(e => {\n                window.console.error(e.message)\n            })\n        },\n        async nextStpes() {\n            if (this.steps == 4) {\n                this.save_next = \"confirm_close\"\n                await this.saveDraft()\n                // await this.clean()\n            } else {\n                this.save_next = \"confirm_next\"\n                this.steps = this.steps + 1\n                if (this.reachTopStep <= this.steps) {\n                    this.reachTopStep = this.steps\n                }\n                this.stepsCondition(this.steps)\n            }\n        },\n        async ClickSteps(step) {\n            if (this.steps === step) {\n                return\n            }\n            if (step > this.reachTopStep) {\n                return\n            }\n            if (step !== 4) {\n                this.save_next = \"confirm_next\"\n            } else {\n                this.save_next = \"confirm_close\"\n            }\n            this.steps = step\n            this.stepsCondition(this.steps)\n        },\n        stepsCondition(val) {\n            switch (val) {\n                case 1:\n                    this.activeColor1 = \"primary\"\n                    this.activeColor2 = \"third\"\n                    this.activeColor3 = \"third\"\n                    this.activeColor4 = \"third\"\n                    break\n                case 2:\n                    this.activeColor1 = \"third\"\n                    this.activeColor2 = \"primary\"\n                    this.activeColor3 = \"third\"\n                    this.activeColor4 = \"third\"\n                    break\n                case 3:\n                    this.activeColor1 = \"third\"\n                    this.activeColor2 = \"third\"\n                    this.activeColor3 = \"primary\"\n                    this.activeColor4 = \"third\"\n                    break\n                default:\n                    this.activeColor1 = \"third\"\n                    this.activeColor2 = \"third\"\n                    this.activeColor3 = \"third\"\n                    this.activeColor4 = \"primary\"\n                    this.isFinal = true\n                    this.save_next = \"confirm_close\"\n                    break\n            }\n        },\n        numberFormat(value) {\n            // window.console.log(this.saleFormContent.decimal,'nimol')\n            if (value >= 0) {\n                return value.toLocaleString()\n            } else {\n                return value\n            }\n\n        },\n    },\n    created() {\n        this.loadListTax()\n    },\n    async mounted() {\n        await this.onloadCurrency()\n        // await this.loadCurrencyData(currencyType.TAX_EXCHANGE_CURRENCY)\n        await this.initData()\n        await this.loadPrefix()\n    },\n}\n\n</script>\n\n<style scoped>\n.function_content {\n    padding: 0 12px 12px;\n    border-bottom: 0;\n    background-color: #fff !important;\n}\n\n.m_auto {\n    margin: auto;\n}\n\n@media (min-width: 1264px) {\n    .container {\n        /* max-width: 1185px; */\n        max-width: 1080px !important;\n    }\n}\n\n.grayBg {\n    background-color: #F8F8F9;\n}\n\n@media (max-width: 576px) {\n    .mb-6 {\n        margin-bottom: 0 !important;\n    }\n}\n\n.border_grey {\n    border: 1px solid #d6d7d8;\n}\n\n.attachment_table {\n    width: 100%;\n}\n\n.my_checkbox input[type=checkbox] + label {\n    display: grid;\n    grid-template-columns: 20% 80%;\n    margin: 0.2em 0px;\n    cursor: pointer;\n    line-height: 16px;\n    padding: 0.2em;\n}\n</style>\n"]}]}