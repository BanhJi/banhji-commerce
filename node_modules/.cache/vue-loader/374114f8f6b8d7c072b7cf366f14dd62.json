{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/banking/banking/BankStatementReconciliation.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/banking/banking/BankStatementReconciliation.vue","mtime":1638499443122},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCiAgICBpbXBvcnQga2VuZG8gZnJvbSAiQHByb2dyZXNzL2tlbmRvLXVpIjsKICAgIGltcG9ydCBIZWxwZXIgZnJvbSAiQC9oZWxwZXIuanMiOwogICAgaW1wb3J0IHsgaTE4biB9IGZyb20gJ0AvaTE4bic7CiAgICBpbXBvcnQgeyAKICAgICAgICBCYW5rQWNjb3VudE1vZGVsLCAKICAgICAgICBCYW5rU3RhdGVtZW50TW9kZWwsIAogICAgICAgIFJlY29uY2lsZU1vZGVsLCAKICAgICAgICBBY2NvdW50TW9kZWwsIAogICAgICAgIEpvdXJuYWxNb2RlbCwgCiAgICAgICAgSm91cm5hbEVudHJ5TW9kZWwsCiAgICAgICAgQ3VycmVuY3lNb2RlbCwKICAgICAgICBFeGNoYW5nZVJhdGVNb2RlbCwKICAgIH0gZnJvbSAiQC9zY3JpcHRzL21vZGVsL0FwcE1vZGVscyI7CiAgICAKICAgIC8qIFN0b3JlICovCiAgICBpbXBvcnQgc3RvcmUgZnJvbSAiQC9zdG9yZSIKICAgIGNvbnN0IGluc3RpdHV0ZSA9IHN0b3JlLnN0YXRlLmluc3RpdHV0ZS5pbnN0aXR1dGUKICAgIGltcG9ydCB7IG1hcFN0YXRlIH0gZnJvbSAndnVleCc7CgogICAgY29uc3QgewogICAgICAgIHJlY29uY2lsZUhhbmRsZXIsCiAgICAgICAgam91cm5hbEhhbmRsZXIsCiAgICB9ID0gcmVxdWlyZSgiQC9zY3JpcHRzL0FwcEhhbmRsZXJzIik7CiAgICBjb25zdCB7IEVudGl0eVR5cGUsIFNhdmVPcHRpb24gfSA9IHJlcXVpcmUoIkAvc2NyaXB0cy9kZWZhdWx0X3NldHVwL0NvbGxlY3Rpb25zIik7CgogICAgZXhwb3J0IGRlZmF1bHQgewogICAgICAgIG5hbWU6ICJCYW5rU3RhdGVtZW50UmVjb25jaWxpYXRpb24iLAogICAgICAgIGNvbXBvbmVudHM6IHsKICAgICAgICAgICAgIkxvYWRpbmdNZSI6ICgpID0+IGltcG9ydCgnQC9jb21wb25lbnRzL0xvYWRpbmcnKSwKICAgICAgICAgICAgImFwcC1kYXRlcGlja2VyIjogKCkgPT4gaW1wb3J0KCdAL2NvbXBvbmVudHMvY3VzdG9tX3RlbXBsYXRlcy9EYXRlUGlja2VyQ29tcG9uZW50JyksCiAgICAgICAgICAgICJhcHAtYWRqdXN0bWVudC1hY2NvdW50LWRyb3Bkb3dubGlzdCI6ICgpID0+IGltcG9ydCgnQC9jb21wb25lbnRzL2Ryb3Bkb3dubGlzdC9BY2NvdW50JyksCiAgICAgICAgfSwKICAgICAgICBwcm9wczogewogICAgICAgICAgICBpbml0QmFua1N0YXRlbWVudDogewogICAgICAgICAgICAgICAgdHlwZTogQmFua1N0YXRlbWVudE1vZGVsLAogICAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgZGF0YSAoKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAvKiBPYmogKi8KICAgICAgICAgICAgICAgIGJhbmtBY2NvdW50ICAgICAgICAgOiBuZXcgQmFua0FjY291bnRNb2RlbCgpLAogICAgICAgICAgICAgICAgcmVjb25jaWxlICAgICAgICAgICA6IG5ldyBSZWNvbmNpbGVNb2RlbCgpLAogICAgICAgICAgICAgICAgYWRqdXN0bWVudEpvdXJuYWwgICA6IG5ldyBKb3VybmFsTW9kZWwoKSwKICAgICAgICAgICAgICAgIGFkanVzdG1lbnRFbnRyaWVzICAgOiBbXSwKICAgICAgICAgICAgICAgIC8vIEZvcm0gdmFsaWRhdGlvbgogICAgICAgICAgICAgICAgdmFsaWQ6IHRydWUsCiAgICAgICAgICAgICAgICBpc0VkaXQ6IGZhbHNlLAogICAgICAgICAgICAgICAgYWxlcnQ6IGZhbHNlLAogICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlOiAnJywKICAgICAgICAgICAgICAgIEhlbHBlciAgICAgICAgICAgICAgOiBIZWxwZXIsCiAgICAgICAgICAgICAgICB1c2VyOiBIZWxwZXIuZ2V0VXNlcigpLAogICAgICAgICAgICAgICAgU2F2ZU9wdGlvbjogU2F2ZU9wdGlvbiwKICAgICAgICAgICAgICAgIC8vIE90aGVyCiAgICAgICAgICAgICAgICBleGNoYW5nZVJhdGUgICAgICAgIDogbmV3IEV4Y2hhbmdlUmF0ZU1vZGVsKGluc3RpdHV0ZS5iYXNlQ3VycmVuY3kpLAogICAgICAgICAgICAgICAgYmFua1N0YXRlbWVudCAgICAgICA6IG5ldyBCYW5rU3RhdGVtZW50TW9kZWwoKSwKICAgICAgICAgICAgICAgIGJhbmhqaVR4bkFtb3VudCAgICAgOiAwLAogICAgICAgICAgICAgICAgYmFuaGppVHJhbnNhY3Rpb25zICA6IFtdLAogICAgICAgICAgICAgICAgYmFuaGppTWF0Y2hlZFR4bnMgICA6IFtdLAogICAgICAgICAgICAgICAgLy8gS2VuZG8KICAgICAgICAgICAgICAgIHNjaGVtYUZpZWxkczogewogICAgICAgICAgICAgICAgICAgIGpvdXJuYWxfZGF0ZSAgICA6IHsgdHlwZTogImRhdGUiIH0sCiAgICAgICAgICAgICAgICAgICAgam91cm5hbF90eXBlICAgIDogeyB0eXBlOiAic3RyaW5nIiB9LAogICAgICAgICAgICAgICAgICAgIGpvdXJuYWxfbnVtYmVyICA6IHsgdHlwZTogInN0cmluZyIgfSwKICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiAgICAgOiB7IHR5cGU6ICJzdHJpbmciIH0sCiAgICAgICAgICAgICAgICAgICAgYW1vdW50ICAgICAgICAgIDogeyB0eXBlOiAibnVtYmVyIiB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgLy8gTG9hZGluZ01lCiAgICAgICAgICAgICAgICBzaG93TG9hZGluZzogZmFsc2UsCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIG1ldGhvZHM6IHsKICAgICAgICAgICAgLyogSW5pdGlhbCBEYXRhICovCiAgICAgICAgICAgIGluaXRpYWxEYXRhKCl7CiAgICAgICAgICAgICAgICB0aGlzLmJhbmtTdGF0ZW1lbnQgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmluaXRCYW5rU3RhdGVtZW50KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGhpcy5zZXREZWZhdWx0RGF0YSgpOwogICAgICAgICAgICAgICAgdGhpcy5sb2FkQmFuaGppVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYXN5bmMgbG9hZERhdGEgKCkgewogICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIENhbGwgTGlzdAogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2JhbmtpbmcvZ2V0QmFua01hcHBpbmdzJyk7CgogICAgICAgICAgICAgICAgLy8gQ2FsbCBCYW5rIEFjY291bnQKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdiYW5raW5nL2dldEJhbmtBY2NvdW50cycpOwoKICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgLyogU2V0IGRlZmF1bHQgZGF0YSAqLwogICAgICAgICAgICBzZXREZWZhdWx0RGF0YSgpIHsKICAgICAgICAgICAgICAgIHRoaXMucmVjb25jaWxlID0gbmV3IFJlY29uY2lsZU1vZGVsKHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiBFbnRpdHlUeXBlLkJBTktfUkVDT05DSUxJQVRJT05fQkFOS19GRUVEUywgCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBHZW5lcmF0ZSBOdW1iZXIKICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVOdW1iZXIoKTsKCiAgICAgICAgICAgICAgICAvLyBHZXQgRXhjaGFuZ2UgUmF0ZQogICAgICAgICAgICAgICAgdGhpcy5nZXRFeGNoYW5nZVJhdGUoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgLy8gTnVtYmVyCiAgICAgICAgICAgIGFzeW5jIGdlbmVyYXRlTnVtYmVyKCkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzRWRpdCkgewogICAgICAgICAgICAgICAgICAgIGxldCBudW0gPSBhd2FpdCBIZWxwZXIuZ2VuZXJhdGVBY2NvdW50aW5nTnVtYmVyKHRoaXMucmVjb25jaWxlLnR5cGUsIHRoaXMucmVjb25jaWxlLmRhdGUpOwoKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlY29uY2lsZS5udW1iZXIgPSBudW0ubnVtYmVyOwogICAgICAgICAgICAgICAgICAgIHRoaXMucmVjb25jaWxlLnByZWZpeF9mb3JtYXQgPSBudW0ucHJlZml4X2Zvcm1hdDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgLy8gR2V0IEV4Y2hhbmdlIFJhdGUKICAgICAgICAgICAgYXN5bmMgZ2V0RXhjaGFuZ2VSYXRlKCkgewogICAgICAgICAgICAgICAgaWYodGhpcy5yZWNvbmNpbGUuZGF0ZSAmJiB0aGlzLmJhbmtBY2NvdW50LmN1cnJlbmN5LmNvZGUgIT09ICcnKXsKICAgICAgICAgICAgICAgICAgICB0aGlzLmV4Y2hhbmdlUmF0ZSA9IGF3YWl0IEhlbHBlci5nZXRMYXN0RXhjaGFuZ2VSYXRlQnlEYXRlKHRoaXMucmVjb25jaWxlLmRhdGUsIHRoaXMuYmFua0FjY291bnQuY3VycmVuY3kuY29kZSk7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICB0aGlzLmV4Y2hhbmdlUmF0ZSA9IG5ldyBFeGNoYW5nZVJhdGVNb2RlbChpbnN0aXR1dGUuYmFzZUN1cnJlbmN5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgLyogTG9hZCBCYW5oSmkgVHJhbnNhY3Rpb24gKi8KICAgICAgICAgICAgYXN5bmMgbG9hZEJhbmhqaVRyYW5zYWN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwoKICAgICAgICAgICAgICAgIC8qIENsZWFyICovCiAgICAgICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLmJhbmhqaVRyYW5zYWN0aW9uRFMua2VuZG9XaWRnZXQoKTsKICAgICAgICAgICAgICAgIGRzLmZpbHRlcihbXSk7CiAgICAgICAgICAgICAgICBkcy5kYXRhKFtdKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLyogRmluZCBiYW5rIGFjY291bnQgYnkgdXVpZCAqLwogICAgICAgICAgICAgICAgdGhpcy5iYW5rQWNjb3VudCA9IHRoaXMuYmFua0FjY291bnRzLmZpbmQoaT0+aS51dWlkID09PSB0aGlzLmJhbmtTdGF0ZW1lbnQuYmFua19hY2NfdXVpZCk7CgogICAgICAgICAgICAgICAgLyogTG9hZCBqb3VybmFsIGVudHJ5IGRldGFpbCBieSBhY2NvdW50IHV1aWQgKi8KICAgICAgICAgICAgICAgIGxldCBjdXJyZW50RmlzY2FsRGF0ZSA9IEhlbHBlci5nZXRGaXNjYWxEYXRlQnlEYXRlKG5ldyBEYXRlKCkpOwogICAgICAgICAgICAgICAgbGV0IHNkYXRlID0ga2VuZG8udG9TdHJpbmcobmV3IERhdGUoY3VycmVudEZpc2NhbERhdGUuc3RhcnRfZGF0ZSksICd5eXl5LU1NLWRkJykgKyAnVDAwOjAwOjAwLjAwMFonLAogICAgICAgICAgICAgICAgICAgIGVkYXRlID0ga2VuZG8udG9TdHJpbmcobmV3IERhdGUoKSwgJ3l5eXktTU0tZGQnKSArICdUMjM6NTk6NTkuOTk5Wic7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxldCBzdGF0ZW1lbnRzID0gYXdhaXQgam91cm5hbEhhbmRsZXIuZ2V0RW50cnlEZXRhaWxCeUFjY291bnQodGhpcy5iYW5rQWNjb3VudC5hY2NvdW50LnV1aWQsIHsKICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRfZGF0ZSAJOiBzZGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgZW5kX2RhdGUgCTogZWRhdGUsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgdGhpcy5iYW5oamlUcmFuc2FjdGlvbnMgPSBzdGF0ZW1lbnRzLmVudHJpZXNfZGV0YWlsLmZpbHRlcihpPT5pLmlzX3JlY29uY2lsZWQgIT09IDEpOwoKICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgLyogR3JpZCBSb3cgVGVtcGxhdGUgKi8KICAgICAgICAgICAgcm93VG1wbCAoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgICAgIGxldCBzdHIgPSBgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkeyBIZWxwZXIuZGF0ZUZvcm1hdChkYXRhSXRlbS5qb3VybmFsX2RhdGUpIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkeyBkYXRhSXRlbS5qb3VybmFsX251bWJlciB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQW1vdW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHsgTnVtYmVyKGRhdGFJdGVtLmFtb3VudCkudG9Mb2NhbGVTdHJpbmcoKSB9ICR7IGRhdGFJdGVtLmN1cnJlbmN5LmNvZGUgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6IHgtc21hbGw7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkeyBkYXRhSXRlbS5kZXNjcmlwdGlvbiB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gCgogICAgICAgICAgICAgICAgcmV0dXJuIHN0cgogICAgICAgICAgICB9LAogICAgICAgICAgICBkYXRlVGVtcGxhdGUoZGF0YUl0ZW0pewogICAgICAgICAgICAgICAgcmV0dXJuIEhlbHBlci5kYXRlRm9ybWF0KGRhdGFJdGVtLmpvdXJuYWxfZGF0ZSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uQmFuaGppTWF0Y2hlZFR4bkRTQ2hhbmdlcyAoKSB7CiAgICAgICAgICAgICAgICBsZXQgYnMgPSB0aGlzLmJhbmtTdGF0ZW1lbnQsCiAgICAgICAgICAgICAgICAgICAgZHMgPSB0aGlzLiRyZWZzLmJhbmhqaU1hdGNoZWRUeG5EUy5rZW5kb1dpZGdldCgpLAogICAgICAgICAgICAgICAgICAgIHRvdGFsID0gMDsKCiAgICAgICAgICAgICAgICBkcy5kYXRhKCkuZm9yRWFjaCh2YWx1ZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdG90YWwgKz0gdmFsdWUuYW1vdW50OwogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICB0aGlzLnJlY29uY2lsZS52YXJpYW5jZV9hbW91bnQgPSBicy5hbW91bnQgLSB0b3RhbDsKICAgICAgICAgICAgICAgIHRoaXMuYmFuaGppVHhuQW1vdW50ID0gdG90YWw7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qIE9uIEdyaWQgQ2hhbmdlICovCgkJCW9uQWRkQmFuaGppVHhuQ2xpY2sgKGUpIHsKICAgICAgICAgICAgICAgIGxldCBncmlkID0gdGhpcy4kcmVmcy5iYW5oamlUcmFuc2FjdGlvbkdyaWQua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgICAgICBpdGVtID0gZ3JpZC5kYXRhSXRlbShrZW5kby5qUXVlcnkoZS50YXJnZXQpLmNsb3Nlc3QoInRyIikpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0aGlzLmFkZEJhbmhqaVRyYW5zYWN0aW9uKGl0ZW0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICAvKiBBZGQgQmFuaGppIFRyYW5zYWN0aW9uICovCiAgICAgICAgICAgIGFkZEJhbmhqaVRyYW5zYWN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICBsZXQgZ3JpZCA9IHRoaXMuJHJlZnMuYmFuaGppTWF0Y2hlZFR4bkdyaWQua2VuZG9XaWRnZXQoKSwKCQkJCQlkcyA9IGdyaWQuZGF0YVNvdXJjZTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGV0IGV4aXN0aW5nSXRlbSA9IGRzLmRhdGEoKS5maWx0ZXIodmFsdWUgPT4gdmFsdWUuZW50cnlfdXVpZCA9PT0gaXRlbS5lbnRyeV91dWlkKTsKICAgICAgICAgICAgICAgIGlmKGV4aXN0aW5nSXRlbS5sZW5ndGggPT09IDApewogICAgICAgICAgICAgICAgICAgIGRzLmFkZChpdGVtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgLy8gUmVtb3ZlIFJvdwoJCQlyZW1vdmVSb3cgKGUpIHsKCQkJCWUucHJldmVudERlZmF1bHQoKTsKCgkJCQlsZXQgZ3JpZCA9IHRoaXMuJHJlZnMuYmFuaGppTWF0Y2hlZFR4bkdyaWQua2VuZG9XaWRnZXQoKSwKCQkJCQlkcyA9IGdyaWQuZGF0YVNvdXJjZSwKCQkJCQlpdGVtID0gZ3JpZC5kYXRhSXRlbShrZW5kby5qUXVlcnkoZS5jdXJyZW50VGFyZ2V0KS5jbG9zZXN0KCJ0ciIpKTsKCQkJCQoJCQkJZHMucmVtb3ZlKGl0ZW0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICAvKiBGaW5kIEJlc3QgTWF0Y2ggVHJhbnNhY3Rpb24gKi8KICAgICAgICAgICAgZmluZEJlc3RNYXRjaCAoKSB7CiAgICAgICAgICAgICAgICAvLyBsZXQgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICAgICBsZXQgYnRtID0gdGhpcy5iYW5rVHJhbnNhY3Rpb25NYXBwaW5ncy5maW5kKHZhbHVlID0+IHZhbHVlLmJhbmtfdXVpZCA9PT0gdGhpcy5iYW5rQWNjb3VudC5iYW5rLnV1aWQpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsZXQgZmlsdGVycyA9IFtdOwogICAgICAgICAgICAgICAgYnRtLmNyaXRlcmlhLmZvckVhY2goZWxlbWVudCA9PiB7CiAgICAgICAgICAgICAgICAgICAgbGV0IHN0YXRlbWVudFZhbHVlID0gIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGpvdXJuYWxGaWVsZE5hbWUgPSAiIjsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZihlbGVtZW50LmZpZWxkMiA9PT0gInN0YXRlbWVudF9kYXRlIil7LyogRGF0ZSAqLwogICAgICAgICAgICAgICAgICAgICAgICBqb3VybmFsRmllbGROYW1lID0gImpvdXJuYWxfZGF0ZSI7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlbWVudFZhbHVlID0gdGhpcy5iYW5rU3RhdGVtZW50WyJzdGF0ZW1lbnRfZGF0ZSJdOwogICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKGVsZW1lbnQuZmllbGQyID09PSAiYmFua19yZWYiKXsvKiBOdW1iZXIgKi8KICAgICAgICAgICAgICAgICAgICAgICAgam91cm5hbEZpZWxkTmFtZSA9ICJqb3VybmFsX251bWJlciI7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlbWVudFZhbHVlID0gdGhpcy5iYW5rU3RhdGVtZW50WyJiYW5rX3JlZiJdOwogICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKGVsZW1lbnQuZmllbGQyID09PSAiZGViaXQiKXsvKiBEZWJpdCAqLwogICAgICAgICAgICAgICAgICAgICAgICBqb3VybmFsRmllbGROYW1lID0gImFtb3VudCI7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlbWVudFZhbHVlID0gTWF0aC5hYnModGhpcy5iYW5rU3RhdGVtZW50WyJhbW91bnQiXSk7CiAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYoZWxlbWVudC5maWVsZDIgPT09ICJjcmVkaXQiKXsvKiBDcmVkaXQgKi8KICAgICAgICAgICAgICAgICAgICAgICAgam91cm5hbEZpZWxkTmFtZSA9ICJhbW91bnQiOwogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZW1lbnRWYWx1ZSA9IE1hdGguYWJzKHRoaXMuYmFua1N0YXRlbWVudFsiYW1vdW50Il0pICogLTE7CiAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYoZWxlbWVudC5maWVsZDIgPT09ICJjdXJyZW5jeSIpey8qIEN1cnJlbmN5ICovCiAgICAgICAgICAgICAgICAgICAgICAgIGpvdXJuYWxGaWVsZE5hbWUgPSAiY3VycmVuY3kuY29kZSI7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlbWVudFZhbHVlID0gdGhpcy5iYW5rU3RhdGVtZW50WyJjdXJyZW5jeSJdOwogICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKGVsZW1lbnQuZmllbGQyID09PSAiZGV0YWlscyIpey8qIERldGFpbCAqLwogICAgICAgICAgICAgICAgICAgICAgICBqb3VybmFsRmllbGROYW1lID0gImRlc2NyaXB0aW9uIjsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVtZW50VmFsdWUgPSBlbGVtZW50LnZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgZmlsdGVycy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgImZpZWxkIiAgICAgOiBqb3VybmFsRmllbGROYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAib3BlcmF0b3IiICA6IGVsZW1lbnQub3BlcmF0b3IsCiAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSIgICAgIDogc3RhdGVtZW50VmFsdWUsCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5iYW5oamlUcmFuc2FjdGlvbkRTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgICAgICBkcy5maWx0ZXIoewogICAgICAgICAgICAgICAgICAgIGxvZ2ljOiAib3IiLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcnM6IGZpbHRlcnMKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICAvLyBBZGQgSm91cm5hbAogICAgICAgICAgICBhZGRKb3VybmFsKCkgewogICAgICAgICAgICAgICAgbGV0IGVudHJpZXMgPSBbXSwKICAgICAgICAgICAgICAgICAgICBkZWJpdEFjY291bnQgPSB0aGlzLmJhbmtBY2NvdW50LmFjY291bnQsCiAgICAgICAgICAgICAgICAgICAgY3JlZGl0QWNjb3VudCA9IHRoaXMucmVjb25jaWxlLmFkanVzdG1lbnRfYWNjb3VudCwKICAgICAgICAgICAgICAgICAgICBhbW91bnQgPSBNYXRoLmFicyh0aGlzLnJlY29uY2lsZS52YXJpYW5jZV9hbW91bnQpOwoKICAgICAgICAgICAgICAgIC8vIFZhcmlhbmNlID4gMAogICAgICAgICAgICAgICAgaWYgKHRoaXMucmVjb25jaWxlLnZhcmlhbmNlX2Ftb3VudCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBkZWJpdEFjY291bnQgPSB0aGlzLnJlY29uY2lsZS5hZGp1c3RtZW50X2FjY291bnQKICAgICAgICAgICAgICAgICAgICBjcmVkaXRBY2NvdW50ID0gdGhpcy5iYW5rQWNjb3VudC5hY2NvdW50CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gRGViaXQgU2lkZQogICAgICAgICAgICAgICAgZW50cmllcy5wdXNoKG5ldyBKb3VybmFsRW50cnlNb2RlbCh7CiAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogZGViaXRBY2NvdW50LAogICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLnJlY29uY2lsZS5kZXNjcmlwdGlvbiwKICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogbmV3IEN1cnJlbmN5TW9kZWwodGhpcy5iYW5rQWNjb3VudC5jdXJyZW5jeSksCiAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBhbW91bnQsCiAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VfcmF0ZV91dWlkOiB0aGlzLmV4Y2hhbmdlUmF0ZS5pZCwKICAgICAgICAgICAgICAgICAgICBleGNoYW5nZV9yYXRlOiB0aGlzLmV4Y2hhbmdlUmF0ZS5yYXRlLAogICAgICAgICAgICAgICAgfSkpCgogICAgICAgICAgICAgICAgLy8gQ3JlZGl0IFNpZGUKICAgICAgICAgICAgICAgIGVudHJpZXMucHVzaChuZXcgSm91cm5hbEVudHJ5TW9kZWwoewogICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IGNyZWRpdEFjY291bnQsCiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoaXMucmVjb25jaWxlLmRlc2NyaXB0aW9uLAogICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiBuZXcgQ3VycmVuY3lNb2RlbCh0aGlzLmJhbmtBY2NvdW50LmN1cnJlbmN5KSwKICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IGFtb3VudCAqIC0xLCAvLyBDcmVkaXQgc2lkZSBpcyBuZWdhdGl2ZQogICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlX3JhdGVfdXVpZDogdGhpcy5leGNoYW5nZVJhdGUuaWQsCiAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VfcmF0ZTogdGhpcy5leGNoYW5nZVJhdGUucmF0ZSwKICAgICAgICAgICAgICAgIH0pKQoKICAgICAgICAgICAgICAgIC8vIEFkanVzdG1lbnQgSm91cm5hbAogICAgICAgICAgICAgICAgdGhpcy5hZGp1c3RtZW50Sm91cm5hbC5udW1iZXIgPSB0aGlzLnJlY29uY2lsZS5udW1iZXI7CiAgICAgICAgICAgICAgICB0aGlzLmFkanVzdG1lbnRKb3VybmFsLmRlc2NyaXB0aW9uID0gdGhpcy5yZWNvbmNpbGUuZGVzY3JpcHRpb247CiAgICAgICAgICAgICAgICB0aGlzLmFkanVzdG1lbnRKb3VybmFsLmpvdXJuYWxfZGF0ZSA9IEhlbHBlci50b0lTT0RhdGUodGhpcy5yZWNvbmNpbGUuZGF0ZSk7CiAgICAgICAgICAgICAgICB0aGlzLmFkanVzdG1lbnRKb3VybmFsLmpvdXJuYWxfdHlwZSA9IEVudGl0eVR5cGUuQURKVVNUTUVOVDsKICAgICAgICAgICAgICAgIHRoaXMuYWRqdXN0bWVudEpvdXJuYWwudHJhbnNhY3Rpb25fdHlwZSA9IHRoaXMucmVjb25jaWxlLnR5cGU7CiAgICAgICAgICAgICAgICB0aGlzLmFkanVzdG1lbnRKb3VybmFsLnByZWZpeF9mb3JtYXQgPSB0aGlzLnJlY29uY2lsZS5wcmVmaXhfZm9ybWF0OwogICAgICAgICAgICAgICAgdGhpcy5hZGp1c3RtZW50Sm91cm5hbC5pc19kcmFmdCA9IHRoaXMucmVjb25jaWxlLmlzX2RyYWZ0OwogICAgICAgICAgICAgICAgdGhpcy5hZGp1c3RtZW50Sm91cm5hbC5jcmVhdGVkX2J5ID0gdGhpcy5yZWNvbmNpbGUuY3JlYXRlZF9ieTsKICAgICAgICAgICAgICAgIHRoaXMuYWRqdXN0bWVudEpvdXJuYWwubW9kaWZpZWRfYnkgPSB0aGlzLnJlY29uY2lsZS5tb2RpZmllZF9ieTsKCiAgICAgICAgICAgICAgICAvLyBBZGp1c3RtZW50IEVudHJpZXMKICAgICAgICAgICAgICAgIHRoaXMuYWRqdXN0bWVudEVudHJpZXMgPSBlbnRyaWVzOwogICAgICAgICAgICB9LAogICAgICAgICAgICAvLyBTaHJpbmsgRGF0YQogICAgICAgICAgICBzaHJpbmtEYXRhKCkgewogICAgICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5iYW5oamlNYXRjaGVkVHhuRFMua2VuZG9XaWRnZXQoKTsKCiAgICAgICAgICAgICAgICAvLyBEYXRlCiAgICAgICAgICAgICAgICB0aGlzLnJlY29uY2lsZS5kYXRlID0gSGVscGVyLnRvSVNPRGF0ZSh0aGlzLnJlY29uY2lsZS5kYXRlKTsKICAgICAgICAgICAgICAgIHRoaXMucmVjb25jaWxlLmJhbmtfc3RhdGVtZW50X3V1aWQgPSB0aGlzLmJhbmtTdGF0ZW1lbnQudXVpZDsKCiAgICAgICAgICAgICAgICAvLyBSZWNvbmNpbGUgRW50cmllcwogICAgICAgICAgICAgICAgbGV0IGVudHJ5VXVpZExpc3QgPSBbXTsKICAgICAgICAgICAgICAgIGRzLmRhdGEoKS5mb3JFYWNoKHZhbHVlID0+IHsKICAgICAgICAgICAgICAgICAgICBlbnRyeVV1aWRMaXN0LnB1c2godmFsdWUuZW50cnlfdXVpZCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHRoaXMucmVjb25jaWxlLnJlY29uY2lsZV9lbnRyaWVzID0gZW50cnlVdWlkTGlzdDsKCiAgICAgICAgICAgICAgICAvLyBVc2VyCiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0VkaXQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlY29uY2lsZS5tb2RpZmllZF9ieSA9IHRoaXMudXNlcjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWNvbmNpbGUuY3JlYXRlZF9ieSA9IHRoaXMudXNlcjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgLy8gVmFsaWRhdGluZwogICAgICAgICAgICB2YWxpZGF0ZUZvcm0oKSB7CiAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gdHJ1ZSwgbXNnID0gJycsCiAgICAgICAgICAgICAgICAgICAgcmMgPSB0aGlzLnJlY29uY2lsZSwKICAgICAgICAgICAgICAgICAgICBkcyA9IHRoaXMuJHJlZnMuYmFuaGppTWF0Y2hlZFR4bkRTLmtlbmRvV2lkZ2V0KCk7CgogICAgICAgICAgICAgICAgLy8gTWF0Y2hlZCBUcmFuc2FjdGlvbnMKICAgICAgICAgICAgICAgIGlmIChkcy50b3RhbCgpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgbXNnICs9ICc8cD5QbGVhc2UgYWRkIGEgdHJhbnNhY3Rpb24uPC9wPic7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gQWRqdXN0bWVudCBBY2NvdW50CiAgICAgICAgICAgICAgICBpZiAocmMudmFyaWFuY2VfYW1vdW50ICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVjb25jaWxlLmFkanVzdG1lbnRfYWNjb3VudC51dWlkID09PSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgbXNnICs9ICc8cD5QbGVhc2Ugc2VsZWN0IGFkanVzdG1lbnQgYWNjb3VudC48L3A+JzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gU2hvdyBBbGVydAogICAgICAgICAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSBtc2c7CiAgICAgICAgICAgICAgICB0aGlzLmFsZXJ0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYWxlcnQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8vIEFsbCBTYXZlcwogICAgICAgICAgICBvblNhdmVPcHRpb25DbGljayhtb2RlKSB7CgkJCQlpZiAodGhpcy4kcmVmcy5mb3JtLnZhbGlkYXRlKCkgJiYgdGhpcy52YWxpZGF0ZUZvcm0oKSkgewoJCQkJCXRoaXMuc2F2ZU1vZGUgPSBtb2RlOwoJCQkJCXRoaXMuc2F2ZSgpOwoJCQkJfQoJCQl9LAogICAgICAgICAgICBjYW5jZWwoKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRzd2FsKHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0FyZSB5b3Ugc3VyZT8nLAogICAgICAgICAgICAgICAgICAgIHRleHQ6ICJZb3Ugd29uJ3QgYmUgYWJsZSB0byByZXZlcnQgdGhpcyEiLAogICAgICAgICAgICAgICAgICAgIGljb246ICd3YXJuaW5nJywKICAgICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogJyM0ZDQ4NDgnLAogICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAnIzMwODVkNicsCiAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICdZZXMsIGRpc2NhcmQgaXQhJwogICAgICAgICAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5nbygtMSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xlYXIoKSB7CiAgICAgICAgICAgICAgICAvLyBSZXNldCBGb3JtCiAgICAgICAgICAgICAgICAvLyB0aGlzLiRyZWZzLmZvcm0ucmVzZXQoKTsKCiAgICAgICAgICAgICAgICB0aGlzLmJhbmhqaVR4bkFtb3VudCA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLmJhbmhqaU1hdGNoZWRUeG5zID0gW107CgogICAgICAgICAgICAgICAgdGhpcy5yZWNvbmNpbGUgPSBuZXcgUmVjb25jaWxlTW9kZWwoKTsKICAgICAgICAgICAgICAgIHRoaXMucmVjb25jaWxlLmFkanVzdG1lbnRfYWNjb3VudCA9IG5ldyBBY2NvdW50TW9kZWwoKTsKICAgICAgICAgICAgICAgIHRoaXMuYWRqdXN0bWVudEpvdXJuYWwgPSBuZXcgSm91cm5hbE1vZGVsKCk7CiAgICAgICAgICAgICAgICB0aGlzLmFkanVzdG1lbnRFbnRyaWVzID0gW107CgogICAgICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5iYW5oamlNYXRjaGVkVHhuRFMua2VuZG9XaWRnZXQoKTsKICAgICAgICAgICAgICAgIGRzLmRhdGEoW10pOwoKICAgICAgICAgICAgICAgIC8vIE5ldyBEZWZhdWx0IERhdGEKICAgICAgICAgICAgICAgIHRoaXMuc2V0RGVmYXVsdERhdGEoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2F2ZSgpIHsKICAgICAgICAgICAgICAgIGxldCBzZWxmID0gdGhpczsKCiAgICAgICAgICAgICAgICAvLyBTaHJpbmsgRGF0YQogICAgICAgICAgICAgICAgdGhpcy5zaHJpbmtEYXRhKCk7CgogICAgICAgICAgICAgICAgLy8gQWRqdXN0bWVudCBKb3VybmFsCiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZWNvbmNpbGUudmFyaWFuY2VfYW1vdW50ICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRKb3VybmFsKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYWRqdXN0bWVudEpvdXJuYWwgPSBuZXcgSm91cm5hbE1vZGVsKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGp1c3RtZW50RW50cmllcyA9IFtdOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIFN5bmMgRGF0YQogICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICByZWNvbmNpbGVIYW5kbGVyLnNhdmUoewogICAgICAgICAgICAgICAgICAgIHJlY29uY2lsZTogbmV3IFJlY29uY2lsZU1vZGVsKHRoaXMucmVjb25jaWxlKSwKICAgICAgICAgICAgICAgICAgICBhZGp1c3RtZW50X2pvdXJuYWw6IG5ldyBKb3VybmFsTW9kZWwodGhpcy5hZGp1c3RtZW50Sm91cm5hbCksCiAgICAgICAgICAgICAgICAgICAgYWRqdXN0bWVudF9lbnRyaWVzOiB0aGlzLmFkanVzdG1lbnRFbnRyaWVzLAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgIHNlbGYucmVzcG9uc2VTdGF0dXMocmVzcG9uc2UpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgSGVscGVyLmFsZXJ0RXJyb3JNc2coZXJyb3IpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5maW5hbGx5KCgpPT57CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8vIFJlc3BvbnNlIFN0YXR1cwogICAgICAgICAgICByZXNwb25zZVN0YXR1cyhyZXNwb25zZSkgewogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgLyogU2F2ZSBDbG9zZSBvciBEZWxldGUgQWN0aW9uICovCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2F2ZU1vZGUgPT09IFNhdmVPcHRpb24uU0FWRUNMT1NFIHx8IHRoaXMuc2F2ZU1vZGUgPT09IFNhdmVPcHRpb24uREVMRVRFKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5nbygtMSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8qIFJlc2V0IERhdGEgKi8KICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyKCk7CgogICAgICAgICAgICAgICAgICAgIC8qIEFsZXJ0IFN1Y2Nlc3MgKi8KICAgICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LnN1Y2Nlc3MoaTE4bi50KCJzdWNjZXNzZnVsIikpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvKiBBbGVydCBFcnJvciAqLwogICAgICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoaTE4bi50KCJlcnJvcl9zb21ldGhpbmdfd3JvbmciKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB3YXRjaDogewogICAgICAgICAgICBpbml0QmFua1N0YXRlbWVudDogImluaXRpYWxEYXRhIgogICAgICAgIH0sCiAgICAgICAgY29tcHV0ZWQ6IG1hcFN0YXRlKHsKICAgICAgICAgICAgYmFua1RyYW5zYWN0aW9uTWFwcGluZ3M6IHN0YXRlID0+IHN0YXRlLmJhbmtpbmcuYmFua01hcHBpbmdzLAogICAgICAgICAgICBiYW5rQWNjb3VudHM6IHN0YXRlID0+IHN0YXRlLmJhbmtpbmcuYmFua0FjY291bnRzLAogICAgICAgIH0pLAogICAgICAgIGNyZWF0ZWQoKSB7CiAgICAgICAgICAgIHRoaXMubG9hZERhdGEoKTsKICAgICAgICB9LAogICAgICAgIG1vdW50ZWQoKSB7CiAgICAgICAgICAgIHRoaXMuaW5pdGlhbERhdGEoKTsKICAgICAgICB9LAogICAgfQo="},{"version":3,"sources":["BankStatementReconciliation.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"BankStatementReconciliation.vue","sourceRoot":"src/views/banking/banking","sourcesContent":["<template>\n    <v-container>\n        <v-card\n         elevation=\"0\"\n         class=\"pa-4\"\n         style=\"position:relative;\"\n         color=\"white\"\n        >\n            <h2>{{$t('bank_statement_reconciliation')}}</h2>\n            <v-icon \n                onclick=\"window.history.go(-1); return false;\" \n                style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                class=\"float-right\"\n            >close</v-icon>\n\n            <v-divider/>\n            <v-card-text style=\"min-height: 850px; background-color: #F8F8F9; color: #333;\">\n                <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                    <v-row>\n                        <!-- From Bank -->\n                        <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                            <v-card outlined dense color=\"grayBg\" class=\"no_border\" v-if=\"bankStatement\">\n                                <v-card outlined dense color=\"third\" class=\"pa-3 no_border\">\n                                    <v-row>\n                                        <v-col sm=\"6\" cols=\"12\" class=\"py-0\">\n                                            <h3 class=\"white--text\">{{$t('from_bank')}}</h3>\n                                        </v-col>\n                                        <v-col sm=\"6\" cols=\"12\" class=\"py-0 text-right\">\n                                            <h3 class=\"white--text\">{{ Number(bankStatement.amount).toLocaleString() }} {{ bankStatement.currency }}</h3>\n                                        </v-col>\n                                    </v-row>\n                                </v-card>\n                                <v-row>\n                                    <v-col sm=\"12\" cols=\"12\" class=\"px-6\">\n                                        <div>\n                                            {{ bankStatement.statement_date }}\n                                            {{ bankStatement.transaction_type }}\n                                        </div>\n                                        <div>\n                                            {{ bankStatement.reference }}\n                                            Amount\n                                            {{ Number(bankStatement.amount).toLocaleString() }} {{ bankStatement.currency }}\n                                        </div>\n                                        <div style=\"font-size: x-small;\">\n                                            {{ bankStatement.details }}\n                                        </div>\n                                    </v-col>\n                                </v-row>\n                            </v-card>\n                        </v-col>\n\n                        <!-- From BanhJi -->\n                        <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                            <v-card outlined dense color=\"grayBg\" class=\"no_border\">\n                                <v-card outlined dense color=\"third\" class=\"pa-3 no_border\">\n                                    <v-row>\n                                        <v-col sm=\"6\" cols=\"12\" class=\"py-0\">\n                                            <h3 class=\"white--text\">{{$t('from_banhji')}}</h3>\n                                        </v-col>\n                                        <v-col sm=\"6\" cols=\"12\" class=\"py-0 text-right\">\n                                            <h3 class=\"white--text\">{{ Number(banhjiTxnAmount).toLocaleString() }}</h3>\n                                        </v-col>\n                                    </v-row>\n                                </v-card>\n                                <v-row>\n                                    <v-col sm=\"12\" cols=\"12\" class=\"px-6\">\n                                        <kendo-datasource ref=\"banhjiMatchedTxnDS\"\n                                            :change=\"onBanhjiMatchedTxnDSChanges\"\n                                            :data=\"banhjiMatchedTxns\"\n                                            :page-size='20'\n                                            :schema-model-fields=\"schemaFields\">\n                                        </kendo-datasource>\n                                        \n                                        <kendo-grid id=\"banhjiMatchedTxnGrid\"\n                                                ref=\"banhjiMatchedTxnGrid\"\n                                                class=\"grid-center mb-3\"\n                                                :data-source-ref=\"'banhjiMatchedTxnDS'\"\n                                                :noRecords=\"true\">\n                                            <kendo-grid-column \n                                                :field=\"'entry_uuid'\"\n                                                :title=\"'&nbsp;'\"\n                                                :template=\"rowTmpl\"\n                                                :width=\"200\" />\n                                            <kendo-grid-column\n                                                :command=\"{ iconClass: 'k-icon k-i-trash', text: 'DEL', click: removeRow, class: 'btn-plus' }\"\n                                                :title=\"'&nbsp;'\"\n                                                :width=\"75\"\n                                            />\n                                        </kendo-grid>\n\n                                        <div class=\"float-right\">\n                                            <v-btn color=\"primary\"\n                                                class=\"white--text text-capitalize\"\n                                                @click=\"findBestMatch\" small>\n                                                    {{$t('find_best_match')}}\n                                            </v-btn>\n\n                                            <v-btn color=\"primary\"\n                                                class=\"white--text\"\n                                                @click=\"loadBanhjiTransaction\" small>\n                                                <v-icon>refresh</v-icon>\n                                            </v-btn>\n                                        </div>\n                                    </v-col>\n                                </v-row>\n                            </v-card>\n                        </v-col>\n\n                        <!-- Variance -->\n                        <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                            <v-card outlined dense color=\"grayBg\" class=\"no_border\">\n                                <v-card outlined dense color=\"third\" class=\"pa-3 no_border\">\n                                    <v-row>\n                                        <v-col sm=\"6\" cols=\"12\" class=\"py-0\">\n                                            <h3 class=\"white--text\">{{$t('variance')}}</h3>\n                                        </v-col>\n                                        <v-col sm=\"6\" cols=\"12\" class=\"py-0 text-right\">\n                                            <h3 class=\"white--text\">{{ Number(reconcile.variance_amount).toLocaleString() }}</h3>\n                                        </v-col>\n                                    </v-row>\n                                </v-card>\n                                <v-row>\n                                    <v-col sm=\"12\" cols=\"12\" class=\"px-6\" v-if=\"reconcile.variance_amount !== 0\">\n                                        <label class=\"label\">{{$t('adjustment_account')}}</label>\n                                        <app-adjustment-account-dropdownlist\n                                            :initAccount=\"reconcile.adjustment_account\"\n                                            @emitAccount=\"reconcile.adjustment_account = $event\"\n                                        />\n                                    </v-col>\n\n                                    <!-- Reconcile Info -->\n                                    <v-col sm=\"12\" cols=\"12\" class=\"px-6\">\n                                        <label class=\"label\">{{$t('date')}}</label>\n                                        <app-datepicker :initialDate=\"reconcile.date\"\n                                                        @emitDate=\"reconcile.date = $event\"\n                                                        @onChanged=\"getExchangeRate\" />\n\n                                        <label class=\"label\">{{$t('number')}}</label>\n                                        <v-row>\n                                            <v-col sm=\"10\" cols=\"10\" class=\"pr-0\">\n                                                <v-text-field class=\"\"\n                                                                v-model=\"reconcile.number\"\n                                                                outlined\n                                                                readonly\n                                                                required/>\n                                            </v-col>\n                                            <v-col sm=\"2\" cols=\"2\" class=\"pl-0\">\n                                                <v-icon color=\"black\" size=\"30\" class=\"border_qrcode\"\n                                                        @click=\"generateNumber\">mdi-qrcode\n                                                </v-icon>\n                                            </v-col>\n                                        </v-row>\n\n                                        <v-alert type=\"warning\"\n                                                v-model=\"alert\"\n                                                dismissible>\n                                            <span style=\"font-size: small;\" v-html=\"errorMessage\"/>\n                                        </v-alert>\n                                    \n                                        <v-btn color=\"primary\"\n                                            class=\"white--text float-right text-capitalize\"\n                                            @click=\"onSaveOptionClick(SaveOption.SAVECLOSE)\" small>\n                                                {{$t('reconcile')}}\n                                        </v-btn>\n                                    </v-col>\n                                </v-row>\n                            </v-card>\n                        </v-col>\n                        \n                        <!-- Search BanhJi Transaction Grid -->\n                        <v-col sm=\"12\" cols=\"12\">\n                            <kendo-datasource ref=\"banhjiTransactionDS\"\n                                :data=\"banhjiTransactions\"\n                                :page-size='20'\n                                :schema-model-fields=\"schemaFields\">\n                            </kendo-datasource>\n\n                            <kendo-grid id=\"banhjiTransactionGrid\"\n                                ref=\"banhjiTransactionGrid\"\n                                :data-source-ref=\"'banhjiTransactionDS'\"\n                                :pageable=\"true\"\n                                :filterable-mode=\"'row'\"\n                                :noRecords=\"true\"\n                                :scrollable=\"true\"\n                                :pageable-numeric=\"false\"\n                                :pageable-previous-next=\"false\"\n                                :pageable-messages-display=\"'Showing {2} data items'\">\n                                <kendo-grid-column \n                                    :field=\"'journal_date'\"\n                                    :title=\"$t('date')\"\n                                    :template=\"dateTemplate\"\n                                    :width=\"150\" />\n                                <kendo-grid-column \n                                    :field=\"'journal_type'\"\n                                    :title=\"$t('type')\"\n                                    :width=\"150\" />\n                                <kendo-grid-column \n                                    :field=\"'journal_number'\"\n                                    :title=\"$t('number')\"\n                                    :width=\"150\" />\n                                <kendo-grid-column \n                                    :field=\"'description'\"\n                                    :title=\"$t('description')\"\n                                    :filterable-cell-operator=\"'contains'\"\n                                    :filterable-cell-suggestion-operator=\"'contains'\" />\n                                <kendo-grid-column \n                                    :field=\"'amount'\"\n                                    :title=\"$t('amount')\"\n                                    :format=\"'{0:n}'\"\n                                    :width=\"150\"\n                                    :filterable-cell-operator=\"'gte'\" />\n                                <kendo-grid-column\n                                    :command=\"{ text: 'Add', click: onAddBanhjiTxnClick, class: 'btn-plus' }\"\n                                    :title=\"'&nbsp;'\"\n                                    :width=\"80\"\n                                />\n                            </kendo-grid>\n                        </v-col>\n                    </v-row>\n                </v-form>\n            </v-card-text>\n\n            <LoadingMe\n                :isLoading=\"showLoading\"\n                :fullPage=\"false\"\n                :myLoading=\"true\"\n                type=\"loading\"\n            />\n        </v-card>\n    </v-container>\n</template>\n<script>\n    import kendo from \"@progress/kendo-ui\";\n    import Helper from \"@/helper.js\";\n    import { i18n } from '@/i18n';\n    import { \n        BankAccountModel, \n        BankStatementModel, \n        ReconcileModel, \n        AccountModel, \n        JournalModel, \n        JournalEntryModel,\n        CurrencyModel,\n        ExchangeRateModel,\n    } from \"@/scripts/model/AppModels\";\n    \n    /* Store */\n    import store from \"@/store\"\n    const institute = store.state.institute.institute\n    import { mapState } from 'vuex';\n\n    const {\n        reconcileHandler,\n        journalHandler,\n    } = require(\"@/scripts/AppHandlers\");\n    const { EntityType, SaveOption } = require(\"@/scripts/default_setup/Collections\");\n\n    export default {\n        name: \"BankStatementReconciliation\",\n        components: {\n            \"LoadingMe\": () => import('@/components/Loading'),\n            \"app-datepicker\": () => import('@/components/custom_templates/DatePickerComponent'),\n            \"app-adjustment-account-dropdownlist\": () => import('@/components/dropdownlist/Account'),\n        },\n        props: {\n            initBankStatement: {\n                type: BankStatementModel,\n            },\n        },\n        data () {\n            return {\n                /* Obj */\n                bankAccount         : new BankAccountModel(),\n                reconcile           : new ReconcileModel(),\n                adjustmentJournal   : new JournalModel(),\n                adjustmentEntries   : [],\n                // Form validation\n                valid: true,\n                isEdit: false,\n                alert: false,\n                errorMessage: '',\n                Helper              : Helper,\n                user: Helper.getUser(),\n                SaveOption: SaveOption,\n                // Other\n                exchangeRate        : new ExchangeRateModel(institute.baseCurrency),\n                bankStatement       : new BankStatementModel(),\n                banhjiTxnAmount     : 0,\n                banhjiTransactions  : [],\n                banhjiMatchedTxns   : [],\n                // Kendo\n                schemaFields: {\n                    journal_date    : { type: \"date\" },\n                    journal_type    : { type: \"string\" },\n                    journal_number  : { type: \"string\" },\n                    description     : { type: \"string\" },\n                    amount          : { type: \"number\" }\n                },\n                // LoadingMe\n                showLoading: false,\n            }\n        },\n        methods: {\n            /* Initial Data */\n            initialData(){\n                this.bankStatement = Object.assign({}, this.initBankStatement);\n                \n                this.setDefaultData();\n                this.loadBanhjiTransaction();\n            },\n            async loadData () {\n                this.showLoading = true;\n                \n                // Call List\n                await this.$store.dispatch('banking/getBankMappings');\n\n                // Call Bank Account\n                await this.$store.dispatch('banking/getBankAccounts');\n\n                this.showLoading = false;\n            },\n            /* Set default data */\n            setDefaultData() {\n                this.reconcile = new ReconcileModel({\n                    type: EntityType.BANK_RECONCILIATION_BANK_FEEDS, \n                })\n                \n                // Generate Number\n                this.generateNumber();\n\n                // Get Exchange Rate\n                this.getExchangeRate();\n            },\n            // Number\n            async generateNumber() {\n                if (!this.isEdit) {\n                    let num = await Helper.generateAccountingNumber(this.reconcile.type, this.reconcile.date);\n\n                    this.reconcile.number = num.number;\n                    this.reconcile.prefix_format = num.prefix_format;\n                }\n            },\n            // Get Exchange Rate\n            async getExchangeRate() {\n                if(this.reconcile.date && this.bankAccount.currency.code !== ''){\n                    this.exchangeRate = await Helper.getLastExchangeRateByDate(this.reconcile.date, this.bankAccount.currency.code);\n                }else{\n                    this.exchangeRate = new ExchangeRateModel(institute.baseCurrency);\n                }\n            },\n            /* Load BanhJi Transaction */\n            async loadBanhjiTransaction () {\n                this.showLoading = true;\n\n                /* Clear */\n                let ds = this.$refs.banhjiTransactionDS.kendoWidget();\n                ds.filter([]);\n                ds.data([]);\n                \n                /* Find bank account by uuid */\n                this.bankAccount = this.bankAccounts.find(i=>i.uuid === this.bankStatement.bank_acc_uuid);\n\n                /* Load journal entry detail by account uuid */\n                let currentFiscalDate = Helper.getFiscalDateByDate(new Date());\n                let sdate = kendo.toString(new Date(currentFiscalDate.start_date), 'yyyy-MM-dd') + 'T00:00:00.000Z',\n                    edate = kendo.toString(new Date(), 'yyyy-MM-dd') + 'T23:59:59.999Z';\n                \n                let statements = await journalHandler.getEntryDetailByAccount(this.bankAccount.account.uuid, {\n                    params: {\n                        start_date \t: sdate,\n                        end_date \t: edate,\n                    }\n                });\n\n                this.banhjiTransactions = statements.entries_detail.filter(i=>i.is_reconciled !== 1);\n\n                this.showLoading = false;\n            },\n            /* Grid Row Template */\n            rowTmpl (dataItem) {\n                let str = `<div>\n                                ${ Helper.dateFormat(dataItem.journal_date) }\n                                ${ dataItem.journal_number }\n                            </div>\n                            <div>\n                                Amount\n                                ${ Number(dataItem.amount).toLocaleString() } ${ dataItem.currency.code }\n                            </div>\n                            <div style=\"font-size: x-small;\">\n                                ${ dataItem.description }\n                            </div>`\n\n                return str\n            },\n            dateTemplate(dataItem){\n                return Helper.dateFormat(dataItem.journal_date);\n            },\n            onBanhjiMatchedTxnDSChanges () {\n                let bs = this.bankStatement,\n                    ds = this.$refs.banhjiMatchedTxnDS.kendoWidget(),\n                    total = 0;\n\n                ds.data().forEach(value => {\n                    total += value.amount;\n                })\n\n                this.reconcile.variance_amount = bs.amount - total;\n                this.banhjiTxnAmount = total;\n            },\n            /* On Grid Change */\n\t\t\tonAddBanhjiTxnClick (e) {\n                let grid = this.$refs.banhjiTransactionGrid.kendoWidget(),\n                    item = grid.dataItem(kendo.jQuery(e.target).closest(\"tr\"));\n                \n                this.addBanhjiTransaction(item);\n            },\n            /* Add Banhji Transaction */\n            addBanhjiTransaction (item) {\n                let grid = this.$refs.banhjiMatchedTxnGrid.kendoWidget(),\n\t\t\t\t\tds = grid.dataSource;\n                \n                let existingItem = ds.data().filter(value => value.entry_uuid === item.entry_uuid);\n                if(existingItem.length === 0){\n                    ds.add(item);\n                }\n            },\n            // Remove Row\n\t\t\tremoveRow (e) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tlet grid = this.$refs.banhjiMatchedTxnGrid.kendoWidget(),\n\t\t\t\t\tds = grid.dataSource,\n\t\t\t\t\titem = grid.dataItem(kendo.jQuery(e.currentTarget).closest(\"tr\"));\n\t\t\t\t\n\t\t\t\tds.remove(item);\n            },\n            /* Find Best Match Transaction */\n            findBestMatch () {\n                // let self = this;\n                let btm = this.bankTransactionMappings.find(value => value.bank_uuid === this.bankAccount.bank.uuid);\n                \n                let filters = [];\n                btm.criteria.forEach(element => {\n                    let statementValue = \"\",\n                        journalFieldName = \"\";\n                    \n                    if(element.field2 === \"statement_date\"){/* Date */\n                        journalFieldName = \"journal_date\";\n                        statementValue = this.bankStatement[\"statement_date\"];\n                    }else if(element.field2 === \"bank_ref\"){/* Number */\n                        journalFieldName = \"journal_number\";\n                        statementValue = this.bankStatement[\"bank_ref\"];\n                    }else if(element.field2 === \"debit\"){/* Debit */\n                        journalFieldName = \"amount\";\n                        statementValue = Math.abs(this.bankStatement[\"amount\"]);\n                    }else if(element.field2 === \"credit\"){/* Credit */\n                        journalFieldName = \"amount\";\n                        statementValue = Math.abs(this.bankStatement[\"amount\"]) * -1;\n                    }else if(element.field2 === \"currency\"){/* Currency */\n                        journalFieldName = \"currency.code\";\n                        statementValue = this.bankStatement[\"currency\"];\n                    }else if(element.field2 === \"details\"){/* Detail */\n                        journalFieldName = \"description\";\n                        statementValue = element.value;\n                    }\n\n                    filters.push({\n                        \"field\"     : journalFieldName,\n                        \"operator\"  : element.operator,\n                        \"value\"     : statementValue,\n                    })\n                })\n\n                let ds = this.$refs.banhjiTransactionDS.kendoWidget();\n                ds.filter({\n                    logic: \"or\",\n                    filters: filters\n                });\n            },\n            // Add Journal\n            addJournal() {\n                let entries = [],\n                    debitAccount = this.bankAccount.account,\n                    creditAccount = this.reconcile.adjustment_account,\n                    amount = Math.abs(this.reconcile.variance_amount);\n\n                // Variance > 0\n                if (this.reconcile.variance_amount > 0) {\n                    debitAccount = this.reconcile.adjustment_account\n                    creditAccount = this.bankAccount.account\n                }\n\n                // Debit Side\n                entries.push(new JournalEntryModel({\n                    account: debitAccount,\n                    description: this.reconcile.description,\n                    currency: new CurrencyModel(this.bankAccount.currency),\n                    amount: amount,\n                    exchange_rate_uuid: this.exchangeRate.id,\n                    exchange_rate: this.exchangeRate.rate,\n                }))\n\n                // Credit Side\n                entries.push(new JournalEntryModel({\n                    account: creditAccount,\n                    description: this.reconcile.description,\n                    currency: new CurrencyModel(this.bankAccount.currency),\n                    amount: amount * -1, // Credit side is negative\n                    exchange_rate_uuid: this.exchangeRate.id,\n                    exchange_rate: this.exchangeRate.rate,\n                }))\n\n                // Adjustment Journal\n                this.adjustmentJournal.number = this.reconcile.number;\n                this.adjustmentJournal.description = this.reconcile.description;\n                this.adjustmentJournal.journal_date = Helper.toISODate(this.reconcile.date);\n                this.adjustmentJournal.journal_type = EntityType.ADJUSTMENT;\n                this.adjustmentJournal.transaction_type = this.reconcile.type;\n                this.adjustmentJournal.prefix_format = this.reconcile.prefix_format;\n                this.adjustmentJournal.is_draft = this.reconcile.is_draft;\n                this.adjustmentJournal.created_by = this.reconcile.created_by;\n                this.adjustmentJournal.modified_by = this.reconcile.modified_by;\n\n                // Adjustment Entries\n                this.adjustmentEntries = entries;\n            },\n            // Shrink Data\n            shrinkData() {\n                let ds = this.$refs.banhjiMatchedTxnDS.kendoWidget();\n\n                // Date\n                this.reconcile.date = Helper.toISODate(this.reconcile.date);\n                this.reconcile.bank_statement_uuid = this.bankStatement.uuid;\n\n                // Reconcile Entries\n                let entryUuidList = [];\n                ds.data().forEach(value => {\n                    entryUuidList.push(value.entry_uuid);\n                });\n                this.reconcile.reconcile_entries = entryUuidList;\n\n                // User\n                if (this.isEdit) {\n                    this.reconcile.modified_by = this.user;\n                } else {\n                    this.reconcile.created_by = this.user;\n                }\n            },\n            // Validating\n            validateForm() {\n                let result = true, msg = '',\n                    rc = this.reconcile,\n                    ds = this.$refs.banhjiMatchedTxnDS.kendoWidget();\n\n                // Matched Transactions\n                if (ds.total() === 0) {\n                    result = false;\n                    msg += '<p>Please add a transaction.</p>';\n                }\n\n                // Adjustment Account\n                if (rc.variance_amount !== 0) {\n                    if (this.reconcile.adjustment_account.uuid === '') {\n                        result = false;\n                        msg += '<p>Please select adjustment account.</p>';\n                    }\n                }\n\n                // Show Alert\n                this.errorMessage = msg;\n                this.alert = false;\n                if (result === false) {\n                    this.alert = true;\n                }\n\n                return result;\n            },\n            // All Saves\n            onSaveOptionClick(mode) {\n\t\t\t\tif (this.$refs.form.validate() && this.validateForm()) {\n\t\t\t\t\tthis.saveMode = mode;\n\t\t\t\t\tthis.save();\n\t\t\t\t}\n\t\t\t},\n            cancel() {\n                this.$swal({\n                    title: 'Are you sure?',\n                    text: \"You won't be able to revert this!\",\n                    icon: 'warning',\n                    showCancelButton: true,\n                    confirmButtonColor: '#4d4848',\n                    cancelButtonColor: '#3085d6',\n                    confirmButtonText: 'Yes, discard it!'\n                }).then((result) => {\n                    if (result.value) {\n                        this.clear();\n                        this.$router.go(-1);\n                    }\n                })\n            },\n            clear() {\n                // Reset Form\n                // this.$refs.form.reset();\n\n                this.banhjiTxnAmount = 0;\n                this.banhjiMatchedTxns = [];\n\n                this.reconcile = new ReconcileModel();\n                this.reconcile.adjustment_account = new AccountModel();\n                this.adjustmentJournal = new JournalModel();\n                this.adjustmentEntries = [];\n\n                let ds = this.$refs.banhjiMatchedTxnDS.kendoWidget();\n                ds.data([]);\n\n                // New Default Data\n                this.setDefaultData();\n            },\n            save() {\n                let self = this;\n\n                // Shrink Data\n                this.shrinkData();\n\n                // Adjustment Journal\n                if (this.reconcile.variance_amount !== 0) {\n                    this.addJournal();\n                } else {\n                    this.adjustmentJournal = new JournalModel();\n                    this.adjustmentEntries = [];\n                }\n\n                // Sync Data\n                this.showLoading = true;\n                reconcileHandler.save({\n                    reconcile: new ReconcileModel(this.reconcile),\n                    adjustment_journal: new JournalModel(this.adjustmentJournal),\n                    adjustment_entries: this.adjustmentEntries,\n                })\n                .then(function (response) {\n                    self.responseStatus(response);\n                })\n                .catch(function (error) {\n                    self.showLoading = false;\n                    Helper.alertErrorMsg(error);\n                })\n                .finally(()=>{\n                    self.showLoading = false;\n                });\n            },\n            // Response Status\n            responseStatus(response) {\n                if (response.status === 200) {\n                    /* Save Close or Delete Action */\n                    if (this.saveMode === SaveOption.SAVECLOSE || this.saveMode === SaveOption.DELETE) {\n                        this.$router.go(-1);\n                    }\n                    \n                    /* Reset Data */\n                    this.clear();\n\n                    /* Alert Success */\n                    this.$snotify.success(i18n.t(\"successful\"));\n                } else {\n                    /* Alert Error */\n                    this.$snotify.error(i18n.t(\"error_something_wrong\"));\n                }\n            },\n        },\n        watch: {\n            initBankStatement: \"initialData\"\n        },\n        computed: mapState({\n            bankTransactionMappings: state => state.banking.bankMappings,\n            bankAccounts: state => state.banking.bankAccounts,\n        }),\n        created() {\n            this.loadData();\n        },\n        mounted() {\n            this.initialData();\n        },\n    }\n</script>\n<style scoped>\n    @media (min-width: 1264px) {\n        .container {\n            max-width: 1080px !important;\n        }\n    }\n</style>"]}]}