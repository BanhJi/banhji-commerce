{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/products/warehouses/operations/TransferOrder.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/products/warehouses/operations/TransferOrder.vue","mtime":1638760538985},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8vIGltcG9ydCBrZW5kbyBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tdWknCmltcG9ydCBMb2FkaW5nTWUgZnJvbSAiQC9jb21wb25lbnRzL0xvYWRpbmciOwppbXBvcnQgRGF0ZVBpY2tlckNvbXBvbmVudCBmcm9tICJAL2NvbXBvbmVudHMvY3VzdG9tX3RlbXBsYXRlcy9EYXRlUGlja2VyQ29tcG9uZW50IjsKaW1wb3J0IFRyYW5zZmVyT3JkZXIgZnJvbSAiQC9zY3JpcHRzL21vZGVsL3RyYW5zZmVyT3JkZXIiOwppbXBvcnQga2VuZG8gZnJvbSAiQHByb2dyZXNzL2tlbmRvLXVpIjsKaW1wb3J0IHt1dWlkfSBmcm9tICJ2dWUtdXVpZCI7CmltcG9ydCB7aTE4bn0gZnJvbSAiQC9pMThuIjsKaW1wb3J0IHNhbGVPcmRlckhhbmRsZXIgZnJvbSAiQC9zY3JpcHRzL3RyYW5zYWN0aW9uSGFuZGxlciI7CmltcG9ydCAkIGZyb20gImpxdWVyeSI7CmltcG9ydCByZWNlaXB0T3JkZXJIYW5kbGVyIGZyb20gIkAvc2NyaXB0cy9yZWNlaXB0T3JkZXJIYW5kbGVyIjsKaW1wb3J0IFZ1ZSBmcm9tICJ2dWUiOwppbXBvcnQgUm93IGZyb20gIkAvdmlld3MvY3VzdG9tZXJzL3NldHRpbmdzL0NoZWNrYm94VGVtcGxhdGUiOwoKY29uc3QgdHJhbnNmZXJPcmRlckhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvdHJhbnNmZXJPcmRlckhhbmRsZXIiKTsKY29uc3QgYmlsbGluZ0hhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvaW52b2ljZS9oYW5kbGVyL2JpbGxpbmdIYW5kbGVyIik7CmNvbnN0IHByb2R1Y3RWYXJpYW50SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wcm9kdWN0VmFyaWFudEhhbmRsZXIiKTsKY29uc3QgdW9tUHJpY2VIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3VvbVByaWNlSGFuZGxlciIpOwpjb25zdCB3YXJlaG91c2VIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3dhcmVob3VzZUhhbmRsZXIiKTsKY29uc3QgcHJlZml4SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wcmVmaXhIYW5kbGVyIik7CmNvbnN0IHRyYW5zZmVyT3JkZXIgPSBuZXcgVHJhbnNmZXJPcmRlcih7fSk7CmNvbnN0IGl0ZW1MaW5lUHJlZml4ID0gImxpbi0iOwpjb25zdCByb3dUZW1wbGF0ZSA9IFZ1ZS5jb21wb25lbnQoUm93Lm5hbWUsIFJvdyk7CmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWU6ICJDcmVkaXRQdXJjaGFzZSIsCiAgICBjb21wb25lbnRzOiB7CiAgICAgICAgTG9hZGluZ01lOiBMb2FkaW5nTWUsCiAgICAgICAgImFwcC1kYXRlcGlja2VyIjogRGF0ZVBpY2tlckNvbXBvbmVudCwKICAgIH0sCiAgICBkYXRhOiAoKSA9PiAoewogICAgICAgIGlzRWRpdDogZmFsc2UsCiAgICAgICAgZGlhbG9nOiBmYWxzZSwKICAgICAgICBkaWFsb2dTOiBmYWxzZSwKICAgICAgICAvLyBMb2FkaW5nTWUKICAgICAgICBzaG93TG9hZGluZ0I6IGZhbHNlLAogICAgICAgIHNob3dMb2FkaW5nVHhuOiBmYWxzZSwKICAgICAgICBzaG93TG9hZGluZzogZmFsc2UsCiAgICAgICAgbG9hZGluZ0FsZXJ0OiBmYWxzZSwKICAgICAgICBsb2FkaW5nQ29sb3JBbGVydDogIiIsCiAgICAgICAgbG9hZGluZ1RleHRBbGVydDogIiIsCiAgICAgICAgYmlsbF9kYXRlOiAiIiwKICAgICAgICBhbGVydDogZmFsc2UsCiAgICAgICAgZGVwb3NpdGU6IDEwMDAsCiAgICAgICAgZmlsZXM6IFtdLAogICAgICAgIC8vIEZvcm0gdmFsaWRhdGlvbgogICAgICAgIHZhbGlkOiB0cnVlLAogICAgICAgIGlzQ2xvc2U6IHRydWUsCgogICAgICAgIHRlbXBsYXRlczogWwogICAgICAgICAgICB7dGl0bGU6ICJEcmFmdCJ9LAogICAgICAgICAgICB7dGl0bGU6ICJPcGVuIn0sCiAgICAgICAgICAgIHt0aXRsZTogIlBhcnRpYWxseSBDbG9zZWQifSwKICAgICAgICAgICAge3RpdGxlOiAiQ2xvc2VkIn0sCiAgICAgICAgXSwKICAgICAgICBpc0hpZGVCYXI6IGZhbHNlLAoKICAgICAgICBiYXRjaHM6IFtdLAogICAgICAgIGl0ZW1CYXRjaDoge30sCiAgICAgICAgYW10QmF0Y2g6IDAsCiAgICAgICAgcXR5UmVjZWl2ZWQ6IDAsCiAgICAgICAgdG90YWxCYXRjaDogMCwKICAgICAgICBxdHlEZWxpdmVyeTogMCwKICAgICAgICBzZXJpYWxzOiBbXSwKICAgICAgICBxdHlTZXJpYWw6IDAsCiAgICAgICAgdHJhbnNhY3Rpb25UeXBlczogW10sCiAgICAgICAgaXRlbUxpbmVzOiBbXSwKICAgICAgICBpdGVtTGluZXNTOiBbXSwKICAgICAgICBpdGVtTGluZXNPbGRTOiBbXSwKICAgICAgICBpdGVtTGluZXNCYXRjaDogW10sCiAgICAgICAgaXRlbUxpbmVzT2xkQmF0Y2g6IFtdLAogICAgICAgIGZXYXJlaG91c2VzOiBbXSwKICAgICAgICB0V2FyZWhvdXNlczogW10sCiAgICAgICAgYmFsYW5jZVdhcmVob3VzZToge2JRdHk6IDB9LAogICAgICAgIHRyYW5zZmVyT3JkZXI6IHRyYW5zZmVyT3JkZXIsCiAgICB9KSwKICAgIGJlZm9yZVJvdXRlTGVhdmUodG8sIGZyb20sIG5leHQpIHsKICAgICAgICBpZiAodGhpcy5pc0Nsb3NlKSB7CiAgICAgICAgICAgIHRoaXMuJHN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IGkxOG4udCgibXNnX3RpdGxlX3dhcm5pbmciKSwKICAgICAgICAgICAgICAgIHRleHQ6IGkxOG4udCgibXNnX2Rpc2NhcmQiKSwKICAgICAgICAgICAgICAgIGljb246ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBpMThuLnQoImNhbmNlbCIpLAogICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzRkNDg0OCIsCiAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNFRDFBM0EiLAogICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IGkxOG4udCgiZGlzY2FyZCIpLAogICAgICAgICAgICB9KS50aGVuKChyZXN1bHRDZW4pID0+IHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHRDZW4udmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zZmVyT3JkZXIgPSB0cmFuc2Zlck9yZGVyOwogICAgICAgICAgICAgICAgICAgIG5leHQoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuZXh0KCkKICAgICAgICB9CiAgICB9LAogICAgbWV0aG9kczogewogICAgICAgIGRhdGFCb3VuZFM6IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGNvbnN0IGdyaWQgPSBrZW5kby5qUXVlcnkoIiNncmlkUyIpLmRhdGEoImtlbmRvR3JpZCIpCiAgICAgICAgICAgIGNvbnN0IGl0ZW1zID0gZS5zZW5kZXIuaXRlbXMoKTsKICAgICAgICAgICAgaXRlbXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBsZXQgZGF0YUl0ZW0gPSBncmlkLmRhdGFJdGVtKHRoaXMpOwogICAgICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgICAgICAualF1ZXJ5KCJ0cltkYXRhLXVpZD0nIiArIGRhdGFJdGVtLnVpZCArICInXSIpCiAgICAgICAgICAgICAgICAgICAgLmZpbmQoIi5pc1NlcmlhbE51bWJlcjIiKQogICAgICAgICAgICAgICAgICAgIC5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFJdGVtLmJhdGNoT3JTZXJpYWwgPT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ualF1ZXJ5KHRoaXMpLnJlbW92ZUNsYXNzKCJrLXN0YXRlLWRpc2FibGVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5qUXVlcnkodGhpcykuYWRkQ2xhc3MoImstc3RhdGUtZGlzYWJsZWQiKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICB9LAogICAgICAgIGFkZFNlcmlhbCgpIHsKICAgICAgICAgICAgdGhpcy5nZXREYXRhU291cmNlUygpCiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLml0ZW1MaW5lc1MsICdpdGVtbGluZSBzJykKICAgICAgICB9LAogICAgICAgIGFzeW5jIGdldERhdGFTb3VyY2VTKCkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLmRhdGFTb3VyY2UxLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgIGxldCBkYXRhUm93ID0gZHMuZGF0YSgpOwogICAgICAgICAgICBjb25zdCBzID0gZGF0YVJvdy5maWx0ZXIoaSA9PiBpLnRpY2sgPT0gdHJ1ZSkKICAgICAgICAgICAgaWYgKHMubGVuZ3RoICE9PSB0aGlzLnF0eVNlcmlhbCkgewogICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcignUGxlYXNlIGNoZWNrIHlvdXIgcXR5IG9mIHNlcmlhbCBudW1iZXInKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGF0YVJvdy5mb3JFYWNoKChpKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoaS5zZXJpYWxOdW1iZXIxICE9PSAnJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbUxpbmVzUy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGl0ZW1MaW5lUHJlZml4ICsgdXVpZC52MSgpLAogICAgICAgICAgICAgICAgICAgICAgICBpdGVtOiBpLml0ZW0sCiAgICAgICAgICAgICAgICAgICAgICAgIHVvbTogaS51b20sCiAgICAgICAgICAgICAgICAgICAgICAgIHNlcmlhbE51bWJlcjE6IGkuc2VyaWFsTnVtYmVyMSwKICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWFsTnVtYmVyMjogaS5zZXJpYWxOdW1iZXIyLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc2VyaWFsJywKICAgICAgICAgICAgICAgICAgICAgICAgd2hJZDogdGhpcy50cmFuc2Zlck9yZGVyLnRXYXJlaG91c2UuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIHRpY2s6IGkudGljaywKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAxCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtTGluZXNPbGRTLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICBpZDogaS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbTogaS5pdGVtLAogICAgICAgICAgICAgICAgICAgICAgICB1b206IGkudW9tLAogICAgICAgICAgICAgICAgICAgICAgICBzZXJpYWxOdW1iZXIxOiBpLnNlcmlhbE51bWJlcjEsCiAgICAgICAgICAgICAgICAgICAgICAgIHNlcmlhbE51bWJlcjI6IGkuc2VyaWFsTnVtYmVyMiwKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3NlcmlhbCcsCiAgICAgICAgICAgICAgICAgICAgICAgIHdoSWQ6IGkud2hJZCwKICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0OiBpLmNyZWF0ZWRBdCwKICAgICAgICAgICAgICAgICAgICAgICAgcGs6IGkucGssCiAgICAgICAgICAgICAgICAgICAgICAgIHRpY2s6IGkudGljaywKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBpLnRpY2sgPT09IHRydWUgPyAyIDogMQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5vbkNsb3NlUygpCiAgICAgICAgfSwKICAgICAgICB1cGRhdGVTZWxlY3Rpb24oaXRlbSwgdmFsdWUpIHsKICAgICAgICAgICAgY29uc3QgZHMgPSB0aGlzLiRyZWZzLmRhdGFTb3VyY2UxLmtlbmRvV2lkZ2V0KCkKICAgICAgICAgICAgY29uc3Qgcm93cyA9IGRzLmRhdGEoKQogICAgICAgICAgICByb3dzLm1hcChyb3cgPT4gewogICAgICAgICAgICAgICAgaWYgKHJvdy5pZCA9PT0gaXRlbS5pZCkgewogICAgICAgICAgICAgICAgICAgIC8vIHJvdy5zZXQoJ3RpY2snLCB2YWx1ZSkKICAgICAgICAgICAgICAgICAgICByb3dbJ3RpY2snXSA9IHZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBnZXRSb3dUZW1wbGF0ZShlKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogcm93VGVtcGxhdGUsCiAgICAgICAgICAgICAgICB0ZW1wbGF0ZUFyZ3M6IE9iamVjdC5hc3NpZ24odGhpcy50ZW1wbGF0ZURhdGEoZSkpCiAgICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICB0ZW1wbGF0ZURhdGEoaXRlbSkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgZGF0YUl0ZW06IGl0ZW0sCiAgICAgICAgICAgICAgICBwYXJlbnRDb21wb25lbnQ6IHRoaXMKICAgICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgIG9uQ2hhbmdlU08oaXRlbSkgewogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coaXRlbSwgJ29uY2hhbmdlUE8nKQogICAgICAgICAgICB0aGlzLmRlbGl2ZXJ5T3JkZXIuaXRlbUxpbmVzID0gW10KICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIuaXRlbUxpbmVzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmRlbGl2ZXJ5T3JkZXIuaXRlbUxpbmVzLnB1c2goewogICAgICAgICAgICAgICAgICAgIC4uLnAsCiAgICAgICAgICAgICAgICAgICAgcXR5UmVjZWl2ZWQ6IHAucXR5IC0gcC50b3RhbFJlY2VpdmVkLAogICAgICAgICAgICAgICAgICAgIHNvdXJjZTogJ3NhbGUgb3JkZXInCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KQogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2codGhpcy5yZWNlaXB0T3JkZXIuaXRlbUxpbmVzLCAnaXRlbWxpbmUnKQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFNhbGVPcmRlcnMoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIGxldCBzdXBwbGllcklkID0gIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHdoSWQgPSAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgdHhuRGF0ZSA9ICIiCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGVsaXZlcnlPcmRlci5jdXN0b21lcikgewogICAgICAgICAgICAgICAgICAgICAgICBzdXBwbGllcklkID0gdGhpcy5kZWxpdmVyeU9yZGVyLmN1c3RvbWVyLmlkOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZWxpdmVyeU9yZGVyLndhcmVob3VzZSkgewogICAgICAgICAgICAgICAgICAgICAgICB3aElkID0gdGhpcy5kZWxpdmVyeU9yZGVyLndhcmVob3VzZS5pZAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZWxpdmVyeU9yZGVyLmRhdGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHhuRGF0ZSA9IHRoaXMuZGVsaXZlcnlPcmRlci5kYXRlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBsZXQgc3RyRmlsdGVyID0gIiI7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN1cHBsaWVySWQgIT09ICIiICYmIHR4bkRhdGUgIT09ICIiICYmIHdoSWQgIT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0ckZpbHRlciA9ICI/aWQ9IiArIHN1cHBsaWVySWQgKyAiJndoSWQ9IiArIHdoSWQgKyAnJndUeXBlPVJPJnR5cGU9U2FsZSBPcmRlcicKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0ckZpbHRlciAhPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZ1R4biA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgc2FsZU9yZGVySGFuZGxlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRyYW5zYWN0aW9uRmlsdGVyKHN0ckZpbHRlcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmdUeG4gPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2FsZU9yZGVycyA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZ1R4biA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgb25DbG9zZVMoKSB7CiAgICAgICAgICAgIHRoaXMuZGlhbG9nUyA9IGZhbHNlCiAgICAgICAgICAgIHRoaXMuc2VyaWFscyA9IFtdCiAgICAgICAgfSwKICAgICAgICByb3dOdW1iZXJTKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuZGF0YVNvdXJjZTEua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIGluZGV4ID0gZHMuaW5kZXhPZihkYXRhSXRlbSk7CiAgICAgICAgICAgIHJldHVybiBpbmRleCArIDE7CiAgICAgICAgfSwKICAgICAgICBkYXRhU291cmNlQ2hhbmdlZFMoZSkgewogICAgICAgICAgICBpZiAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgbGV0IGRhdGFSb3cgPSBlLml0ZW1zWzBdOwogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKGUsICJkYXRhIHNvdXJjZSBjaGFuZ2UiKTsKICAgICAgICAgICAgICAgIHN3aXRjaCAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgInNlcmlhbE51bWJlcjEiOgogICAgICAgICAgICAgICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmpRdWVyeSgidHJbZGF0YS11aWQ9JyIgKyBkYXRhUm93LnVpZCArICInXSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmluZCgiLmlzU2VyaWFsTnVtYmVyMiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFSb3cuaXRlbS5iYXRjaE9yU2VyaWFsID09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ualF1ZXJ5KHRoaXMpLnJlbW92ZUNsYXNzKCJrLXN0YXRlLWRpc2FibGVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ualF1ZXJ5KHRoaXMpLmFkZENsYXNzKCJrLXN0YXRlLWRpc2FibGVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICByZWNvcmRTZXJpYWwoZSkgewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGxldCBncmlkID0ga2VuZG8ualF1ZXJ5KCIjZ3JpZCIpLmRhdGEoImtlbmRvR3JpZCIpCiAgICAgICAgICAgIGxldCBkYXRhSXRlbSA9IGdyaWQuZGF0YUl0ZW0oJChlLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoInRyIikpCiAgICAgICAgICAgIGlmIChkYXRhSXRlbS5pdGVtLmJhdGNoT3JTZXJpYWwgPT09IDIgJiYgZGF0YUl0ZW0ucXR5ID4gMCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuaXRlbUxpbmVzUy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXJpYWxzID0gdGhpcy5pdGVtTGluZXNTLmZpbHRlcihwID0+IHAuaXRlbS5pZCA9PT0gZGF0YUl0ZW0uaXRlbS5pZCkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmVjZWlwdE9yZGVySGFuZGxlci5nZXRCYXRjaChkYXRhSXRlbS5pdGVtLmlkLCB0aGlzLnRyYW5zZmVyT3JkZXIuZldhcmVob3VzZS5pZCwgJ3NlcmlhbCcpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlcywgJ3NlcmlhbCcpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5xdHlTZXJpYWwgPSBkYXRhSXRlbS5xdHk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMuZm9yRWFjaChvID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlcmlhbHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBvLmxpbklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtOiBvLml0ZW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVvbTogby51b20sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoSWQ6IG8ud2hJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWFsTnVtYmVyMTogby5zZXJpYWxOdW1iZXIxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJpYWxOdW1iZXIyOiBvLnNlcmlhbE51bWJlcjIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogby5zdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogby5jcmVhdGVkQXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBrOiBvLmlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LmVycm9yKCdUaGlzIGl0ZW0gJyArIGRhdGFJdGVtLml0ZW0ubmFtZSArICdubyBzZXJpYWwnKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuZGlhbG9nUyA9IHRydWUKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZGF0YUJvdW5kQjogZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgY29uc3QgZ3JpZCA9IGtlbmRvLmpRdWVyeSgiI2dyaWRCYXRjaCIpLmRhdGEoImtlbmRvR3JpZCIpCiAgICAgICAgICAgIGNvbnN0IGl0ZW1zID0gZS5zZW5kZXIuaXRlbXMoKTsKICAgICAgICAgICAgaXRlbXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBsZXQgZGF0YUl0ZW0gPSBncmlkLmRhdGFJdGVtKHRoaXMpOwogICAgICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgICAgICAualF1ZXJ5KCJ0cltkYXRhLXVpZD0nIiArIGRhdGFJdGVtLnVpZCArICInXSIpCiAgICAgICAgICAgICAgICAgICAgLmZpbmQoIi5leHBpcmF0aW9uRGF0ZSIpCiAgICAgICAgICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YUl0ZW0ubnVtYmVyICE9PSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ualF1ZXJ5KHRoaXMpLnJlbW92ZUNsYXNzKCJrLXN0YXRlLWRpc2FibGVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBvblNhdmVCYXRjaCgpIHsKICAgICAgICAgICAgaWYgKCh0aGlzLnF0eVJlY2VpdmVkIC0gdGhpcy5xdHlEZWxpdmVyeSkgPiAwIHx8ICh0aGlzLnF0eURlbGl2ZXJ5ID4gdGhpcy5xdHlSZWNlaXZlZCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoJ1BsZWFzZSBjaGVjayB5b3VyIFF0eScpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmdldERhdGFTb3VyY2VCKCkKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHRoaXMuaXRlbUxpbmVzQmF0Y2gsICdpdGVtbGluZSBiJykKICAgICAgICB9LAogICAgICAgIG9uQ2xvc2VCYXRjaCgpIHsKICAgICAgICAgICAgdGhpcy5kaWFsb2cgPSBmYWxzZQogICAgICAgICAgICB0aGlzLmJhdGNocyA9IFtdCiAgICAgICAgfSwKICAgICAgICBhc3luYyBnZXREYXRhU291cmNlQigpIHsKICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5kYXRhU291cmNlMi5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICBsZXQgZGF0YVJvdyA9IGRzLmRhdGEoKTsKICAgICAgICAgICAgZGF0YVJvdy5mb3JFYWNoKChpKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoaS5xdHkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtTGluZXNCYXRjaC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGl0ZW1MaW5lUHJlZml4ICsgdXVpZC52MSgpLAogICAgICAgICAgICAgICAgICAgICAgICBpdGVtOiBpLml0ZW0sCiAgICAgICAgICAgICAgICAgICAgICAgIHVvbTogaS51b20sCiAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlcjogaS5udW1iZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIHdoSWQ6IHRoaXMudHJhbnNmZXJPcmRlci50V2FyZWhvdXNlLmlkLAogICAgICAgICAgICAgICAgICAgICAgICBleHBpcmF0aW9uRGF0ZTogaS5leHBpcmF0aW9uRGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgcXR5OiBpLlRRdHksCiAgICAgICAgICAgICAgICAgICAgICAgIERRdHk6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdiYXRjaCcsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogaS5zdGF0dXMKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1MaW5lc09sZEJhdGNoLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICBpZDogaS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbTogaS5pdGVtLAogICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IGkubnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICB3aElkOiBpLndoSWQsCiAgICAgICAgICAgICAgICAgICAgICAgIHVvbTogaS51b20sCiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGlyYXRpb25EYXRlOiBpLmV4cGlyYXRpb25EYXRlLAogICAgICAgICAgICAgICAgICAgICAgICBxdHk6IGkucXR5IC0gaS5UUXR5LAogICAgICAgICAgICAgICAgICAgICAgICBEUXR5OiBpLkRRdHksCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdiYXRjaCcsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogaS5zdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgICAgIHBrOiBpLnBrLAogICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IGkuY3JlYXRlZEF0CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLm9uQ2xvc2VCYXRjaCgpCiAgICAgICAgfSwKICAgICAgICByZW1vdmVSb3dCKGUpIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBjb25zdCBncmlkID0ga2VuZG8ualF1ZXJ5KCIjZ3JpZEJhdGNoIikuZGF0YSgia2VuZG9HcmlkIiksCiAgICAgICAgICAgICAgICBkYXRhU291cmNlID0gZ3JpZC5kYXRhU291cmNlLAogICAgICAgICAgICAgICAgZGF0YUl0ZW0gPSBncmlkLmRhdGFJdGVtKGtlbmRvLmpRdWVyeShlLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoInRyIikpOwogICAgICAgICAgICBpZiAoZGF0YVNvdXJjZS50b3RhbCgpID4gMSkgewogICAgICAgICAgICAgICAgZGF0YVNvdXJjZS5yZW1vdmUoZGF0YUl0ZW0pOwogICAgICAgICAgICAgICAgdGhpcy5jYWxjdWF0ZUJhdGNoKCkKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcm93TnVtYmVyQihkYXRhSXRlbSkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLmRhdGFTb3VyY2UyLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICBpbmRleCA9IGRzLmluZGV4T2YoZGF0YUl0ZW0pOwogICAgICAgICAgICByZXR1cm4gaW5kZXggKyAxOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgY2FsY3VhdGVCYXRjaCgpIHsKICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5kYXRhU291cmNlMi5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICBsZXQgZGF0YVJvdyA9IGRzLmRhdGEoKTsKICAgICAgICAgICAgbGV0IGFtb3VudCA9IDAKICAgICAgICAgICAgZGF0YVJvdy5mb3JFYWNoKChpKSA9PiB7CiAgICAgICAgICAgICAgICBhbW91bnQgKz0gaS5UUXR5CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLnF0eURlbGl2ZXJ5ID0gYW1vdW50CiAgICAgICAgICAgIHRoaXMudG90YWxCYXRjaCA9IHRoaXMucXR5UmVjZWl2ZWQgLSBhbW91bnQKICAgICAgICB9LAogICAgICAgIG51bWJlckVkaXRvckIoY29udGFpbmVyLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAualF1ZXJ5KCc8aW5wdXQgZGF0YS1iaW5kPSJ2YWx1ZTonICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb051bWVyaWNUZXh0Qm94KHsKICAgICAgICAgICAgICAgICAgICBkZWNpbWFsczogMzAsCiAgICAgICAgICAgICAgICAgICAgbWluOiAwLAogICAgICAgICAgICAgICAgICAgIG1heDogb3B0aW9ucy5tb2RlbC5xdHkgfHwgMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBkYXRhU291cmNlQ2hhbmdlZEIoZSkgewogICAgICAgICAgICBpZiAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgbGV0IGRhdGFSb3cgPSBlLml0ZW1zWzBdOwogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKGUsICJkYXRhIHNvdXJjZSBjaGFuZ2UiKTsKICAgICAgICAgICAgICAgIHN3aXRjaCAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgIlRRdHkiOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbGN1YXRlQmF0Y2goKQogICAgICAgICAgICAgICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmpRdWVyeSgidHJbZGF0YS11aWQ9JyIgKyBkYXRhUm93LnVpZCArICInXSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmluZCgiLmV4cGlyYXRpb25EYXRlIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVJvdy5udW1iZXIgIT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLmpRdWVyeSh0aGlzKS5yZW1vdmVDbGFzcygiay1zdGF0ZS1kaXNhYmxlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFkZFJvd0IoKSB7CiAgICAgICAgICAgIGxldCBkYXRhID0gewogICAgICAgICAgICAgICAgaWQ6IGl0ZW1MaW5lUHJlZml4ICsgdXVpZC52MSgpLAogICAgICAgICAgICAgICAgaXRlbTogdGhpcy5pdGVtQmF0Y2gsCiAgICAgICAgICAgICAgICBudW1iZXI6ICcnLAogICAgICAgICAgICAgICAgZXhwaXJhdGlvbkRhdGU6ICcnLAogICAgICAgICAgICAgICAgd2hJZDogdGhpcy5kZWxpdmVyeU9yZGVyLndhcmVob3VzZS5pZCwKICAgICAgICAgICAgICAgIHF0eTogMCwKICAgICAgICAgICAgICAgIHN0YXR1czogMQogICAgICAgICAgICB9OwogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLmRhdGFTb3VyY2UyLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICB0b3RhbCA9IGRzLnRvdGFsKCk7CiAgICAgICAgICAgIGRzLmluc2VydCh0b3RhbCwgZGF0YSk7CiAgICAgICAgfSwKICAgICAgICByZWNvcmRCYXRjaChlKSB7CiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmdCID0gdHJ1ZQogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGxldCBncmlkID0ga2VuZG8ualF1ZXJ5KCIjZ3JpZCIpLmRhdGEoImtlbmRvR3JpZCIpCiAgICAgICAgICAgIGxldCBkYXRhSXRlbSA9IGdyaWQuZGF0YUl0ZW0oJChlLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoInRyIikpCiAgICAgICAgICAgIHRoaXMuaXRlbUJhdGNoID0gZGF0YUl0ZW0uaXRlbQogICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaXRlbS5iYXRjaE9yU2VyaWFsID09PSAxICYmIGRhdGFJdGVtLnF0eSA+IDApIHsKICAgICAgICAgICAgICAgIHJlY2VpcHRPcmRlckhhbmRsZXIuZ2V0QmF0Y2goZGF0YUl0ZW0uaXRlbS5pZCwgdGhpcy50cmFuc2Zlck9yZGVyLmZXYXJlaG91c2UuaWQsICdiYXRjaCcpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2cocmVzLCAnYmF0Y2gnKQogICAgICAgICAgICAgICAgICAgIGlmIChyZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgYW1vdW50ID0gMAogICAgICAgICAgICAgICAgICAgICAgICByZXMuZm9yRWFjaChvID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYmF0Y2hzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBvLmxpbklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW06IG8uaXRlbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1b206IG8udW9tLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlcjogby5udW1iZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwaXJhdGlvbkRhdGU6IG8uZXhwaXJhdGlvbkRhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXR5OiBvLnF0eSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aElkOiBvLndoSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVFF0eTogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEUXR5OiBvLkRRdHkgfHwgMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IG8uc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogby5jcmVhdGVkQXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGs6IG8uaWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQgKz0gby5xdHkKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hbXRCYXRjaCA9IGFtb3VudAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnF0eVJlY2VpdmVkID0gZGF0YUl0ZW0ucXR5CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudG90YWxCYXRjaCA9IGRhdGFJdGVtLnF0eQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpYWxvZyA9IHRydWUKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LmVycm9yKCdUaGlzIGl0ZW0gJyArIGRhdGFJdGVtLml0ZW0ubmFtZSArICcgbm8gc3RvY2sgaW4gd2FyZWhvdXNlJykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmdCID0gZmFsc2UKICAgICAgICB9LAoKICAgICAgICBvbkNoYW5nZUZyb21XYXJlaG91c2UoKSB7CiAgICAgICAgICAgIHRoaXMudFdhcmVob3VzZXMgPSB0aGlzLmZXYXJlaG91c2VzLmZpbHRlcihwID0+IHAuaWQgIT09IHRoaXMudHJhbnNmZXJPcmRlci5mV2FyZWhvdXNlLmlkKQogICAgICAgICAgICBpZiAodGhpcy50V2FyZWhvdXNlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zZmVyT3JkZXIudFdhcmVob3VzZSA9IHRoaXMudFdhcmVob3VzZXNbMF0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbnVtYmVyRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IGRhdGEtYmluZD0idmFsdWU6JyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgICAgICAua2VuZG9OdW1lcmljVGV4dEJveCh7CiAgICAgICAgICAgICAgICAgICAgZGVjaW1hbHM6IDMwLAogICAgICAgICAgICAgICAgICAgIG1pbjogMCwKICAgICAgICAgICAgICAgICAgICBtYXg6IHRoaXMuYmFsYW5jZVdhcmVob3VzZSA/IHRoaXMuYmFsYW5jZVdhcmVob3VzZS5iUXR5IDogMCwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgZGF0YVNvdXJjZUNoYW5nZWQoZSkgewogICAgICAgICAgICBpZiAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgbGV0IGRhdGFSb3cgPSBlLml0ZW1zWzBdOwogICAgICAgICAgICAgICAgc3dpdGNoIChlLmZpZWxkKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiaXRlbSI6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0QmFsYW5jZVdhcmVob3VzZShkYXRhUm93Lml0ZW0uaWQpLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoInFvaCIsIHRoaXMuYmFsYW5jZVdhcmVob3VzZSA/IHRoaXMuYmFsYW5jZVdhcmVob3VzZS5iUXR5IDogMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmpRdWVyeSgidHJbZGF0YS11aWQ9JyIgKyBkYXRhUm93LnVpZCArICInXSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmluZCgiLmlzU2VyaWFsTnVtYmVyIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVJvdy5pdGVtLmJhdGNoT3JTZXJpYWwgPT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5qUXVlcnkodGhpcykucmVtb3ZlQ2xhc3MoImstc3RhdGUtZGlzYWJsZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImV4cGlyYXRpb25EYXRlIiwgIiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLmpRdWVyeSh0aGlzKS5hZGRDbGFzcygiay1zdGF0ZS1kaXNhYmxlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmpRdWVyeSgidHJbZGF0YS11aWQ9JyIgKyBkYXRhUm93LnVpZCArICInXSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmluZCgiLmlzQmF0Y2giKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhUm93Lml0ZW0uYmF0Y2hPclNlcmlhbCA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLmpRdWVyeSh0aGlzKS5yZW1vdmVDbGFzcygiay1zdGF0ZS1kaXNhYmxlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLmpRdWVyeSh0aGlzKS5hZGRDbGFzcygiay1zdGF0ZS1kaXNhYmxlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgRXhwaXJhdGlvbkRhdGVUb1RlbXBsYXRlKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGNvbnN0IGV4cGlyYXRpb25EYXRlID0gZGF0YUl0ZW0uZXhwaXJhdGlvbkRhdGU7CiAgICAgICAgICAgIGlmIChleHBpcmF0aW9uRGF0ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGA8c3Bhbj4kewogICAgICAgICAgICAgICAgICAgIGV4cGlyYXRpb25EYXRlCiAgICAgICAgICAgICAgICAgICAgICAgID8ga2VuZG8udG9TdHJpbmcobmV3IERhdGUoZXhwaXJhdGlvbkRhdGUpLCBgZGQtTU0teXl5eWApCiAgICAgICAgICAgICAgICAgICAgICAgIDogYGAKICAgICAgICAgICAgICAgIH08L3NwYW4+YDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBgYDsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgRXhwaXJhdGlvbkRhdGVUb0VkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCByZXF1aXJlZCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0RhdGVQaWNrZXIoKTsKICAgICAgICB9LAogICAgICAgIEl0ZW1Ecm9wRG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogImNvbnRhaW5zIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVGV4dEZpZWxkOiAibmFtZSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlRmllbGQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgaGVhZGVyVGVtcGxhdGU6CiAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJkcm9wZG93bi1oZWFkZXIgay13aWRnZXQgay1oZWFkZXIiPicgKwogICAgICAgICAgICAgICAgICAgICAgICAiPHNwYW4+SXRlbXMgPC9zcGFuPiIgKwogICAgICAgICAgICAgICAgICAgICAgICAiPHNwYW4+PC9zcGFuPiIgKwogICAgICAgICAgICAgICAgICAgICAgICAiPC9kaXY+IiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9bmFtZSM8L3NwYW4+IiwKICAgICAgICAgICAgICAgICAgICBvcHRpb25MYWJlbDogIi0tLSBTZWxlY3QgLS0tIiwKICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlOiBuZXcga2VuZG8uZGF0YS5EYXRhU291cmNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyRmlsdGVyaW5nOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc3BvcnQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHByb2R1Y3RWYXJpYW50SGFuZGxlci5pdGVtU2VhcmNoVVJMKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDoge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZToge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2t1OiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGEuZmlsdGVyKHAgPT4gcC50eXBlID09PSAnVmFyaWFudCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhLmZpbHRlcihwID0+IHAudHlwZSA9PT0gJ1ZhcmlhbnQnKS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAvLyBkYXRhOiB0aGlzLnZhcmlhbnRzCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIFVPTURyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IG5hbWU9IicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgICAgICAgICAgICBhdXRvQmluZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiAic3RhcnRzd2l0aCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogInVvbS5uYW1lIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogInVvbS5pZCIsCiAgICAgICAgICAgICAgICAgICAgY2FzY2FkZUZyb206ICJpdGVtIiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9dW9tLm5hbWUjPC9zcGFuPiIsCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6ICItLS0gU2VsZWN0IC0tLSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZTogbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZlckZpbHRlcmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNwb3J0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB1b21QcmljZUhhbmRsZXIudW9tUHJpY2VCeVByaWNlTGV2ZWxVUkwoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpZD0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5tb2RlbC5pdGVtLmlkICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiZwbElkPS0iICsgIiZkYXRlPSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zZmVyT3JkZXIuZGF0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDoge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbmFtZToge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2t1OiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhLmNvdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGF0YTogdGhpcy52YXJpYW50cwogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBVT01UZW1wbGF0ZShkYXRhSXRlbSkgewogICAgICAgICAgICBjb25zdCB1b20gPSBkYXRhSXRlbS51b207CiAgICAgICAgICAgIGlmICh1b20pIHsKICAgICAgICAgICAgICAgIHJldHVybiBgPHNwYW4+JHt1b20udW9tID8gdW9tLnVvbS5uYW1lIDogYGB9PC9zcGFuPmA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYGA7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHJlbW92ZVJvdyhlKSB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgY29uc3QgZ3JpZCA9IGtlbmRvLmpRdWVyeSgiI2dyaWQiKS5kYXRhKCJrZW5kb0dyaWQiKSwKICAgICAgICAgICAgICAgIGRhdGFTb3VyY2UgPSBncmlkLmRhdGFTb3VyY2UsCiAgICAgICAgICAgICAgICBkYXRhSXRlbSA9IGdyaWQuZGF0YUl0ZW0oa2VuZG8ualF1ZXJ5KGUuY3VycmVudFRhcmdldCkuY2xvc2VzdCgidHIiKSk7CgogICAgICAgICAgICBpZiAoZGF0YVNvdXJjZS50b3RhbCgpID4gMSkgewogICAgICAgICAgICAgICAgZGF0YVNvdXJjZS5yZW1vdmUoZGF0YUl0ZW0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICByb3dOdW1iZXIoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5kYXRhU291cmNlLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICBpbmRleCA9IGRzLmluZGV4T2YoZGF0YUl0ZW0pOwogICAgICAgICAgICByZXR1cm4gaW5kZXggKyAxOwogICAgICAgIH0sCiAgICAgICAgZGF0YUJvdW5kOiBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBjb25zdCBncmlkID0ga2VuZG8ualF1ZXJ5KCIjZ3JpZCIpLmRhdGEoImtlbmRvR3JpZCIpCiAgICAgICAgICAgIGNvbnN0IGl0ZW1zID0gZS5zZW5kZXIuaXRlbXMoKTsKICAgICAgICAgICAgaXRlbXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBsZXQgZGF0YUl0ZW0gPSBncmlkLmRhdGFJdGVtKHRoaXMpOwogICAgICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgICAgICAualF1ZXJ5KCJ0cltkYXRhLXVpZD0nIiArIGRhdGFJdGVtLnVpZCArICInXSIpCiAgICAgICAgICAgICAgICAgICAgLmZpbmQoIi5pc1NlcmlhbE51bWJlciIpCiAgICAgICAgICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaXRlbS5iYXRjaE9yU2VyaWFsID09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLmpRdWVyeSh0aGlzKS5yZW1vdmVDbGFzcygiay1zdGF0ZS1kaXNhYmxlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ualF1ZXJ5KHRoaXMpLmFkZENsYXNzKCJrLXN0YXRlLWRpc2FibGVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAgICAgLmpRdWVyeSgidHJbZGF0YS11aWQ9JyIgKyBkYXRhSXRlbS51aWQgKyAiJ10iKQogICAgICAgICAgICAgICAgICAgIC5maW5kKCIuaXNCYXRjaCIpCiAgICAgICAgICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaXRlbS5iYXRjaE9yU2VyaWFsID09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLmpRdWVyeSh0aGlzKS5yZW1vdmVDbGFzcygiay1zdGF0ZS1kaXNhYmxlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ualF1ZXJ5KHRoaXMpLmFkZENsYXNzKCJrLXN0YXRlLWRpc2FibGVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhZGRSb3coKSB7CiAgICAgICAgICAgIGxldCBkYXRhID0gewogICAgICAgICAgICAgICAgaWQ6IGl0ZW1MaW5lUHJlZml4ICsgdXVpZC52MSgpLAogICAgICAgICAgICAgICAgaXRlbToge25hbWU6ICIifSwKICAgICAgICAgICAgICAgIHF0eTogMCwKICAgICAgICAgICAgICAgIHNlcmlhbDogIiIsCiAgICAgICAgICAgICAgICB1b206IHt9LAogICAgICAgICAgICAgICAgYmF0Y2g6IHt9LAogICAgICAgICAgICAgICAgZXhwaXJhdGlvbkRhdGU6ICIiLAogICAgICAgICAgICB9OwogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLmRhdGFTb3VyY2Uua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIHRvdGFsID0gZHMudG90YWwoKTsKICAgICAgICAgICAgZHMuaW5zZXJ0KHRvdGFsLCBkYXRhKTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIG9ubG9hZFdhcmVob3VzZSgpIHsKICAgICAgICAgICAgYXdhaXQgd2FyZWhvdXNlSGFuZGxlci5nZXRXYXJlaG91c2VTZXR0aW5nQWxsKCkudGhlbihhc3luYyAocmVzKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmZXYXJlaG91c2VzID0gcmVzOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuZldhcmVob3VzZXMubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNmZXJPcmRlci5mV2FyZWhvdXNlID0gdGhpcy5mV2FyZWhvdXNlc1swXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRXYXJlaG91c2VzID0gdGhpcy5mV2FyZWhvdXNlcy5maWx0ZXIocCA9PiBwLmlkICE9PSB0aGlzLnRyYW5zZmVyT3JkZXIuZldhcmVob3VzZS5pZCkKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50V2FyZWhvdXNlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNmZXJPcmRlci50V2FyZWhvdXNlID0gdGhpcy50V2FyZWhvdXNlc1swXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZldhcmVob3VzZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNmZXJPcmRlci5mV2FyZWhvdXNlID0gdGhpcy5mV2FyZWhvdXNlc1swXTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFByZWZpeCgpIHsKICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIHByZWZpeEhhbmRsZXIuZ2V0KCJ0cmFuc2ZlciBvcmRlciIpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb25UeXBlcyA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50cmFuc2FjdGlvblR5cGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zZmVyT3JkZXIudHJhbnNhY3Rpb25UeXBlID0gdGhpcy50cmFuc2FjdGlvblR5cGVzWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlTnVtYmVyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCAzMDApOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYXdhaXQgdGhpcy5vbmxvYWRXYXJlaG91c2UoKTsKICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0sCiAgICAgICAgZ2VuZXJhdGVOdW1iZXIoKSB7CiAgICAgICAgICAgIGxldCBkYXRhID0gewogICAgICAgICAgICAgICAgYWJicjogdGhpcy50cmFuc2Zlck9yZGVyLnRyYW5zYWN0aW9uVHlwZS5hYmJyLAogICAgICAgICAgICAgICAgc3RydWN0dXJlOiB0aGlzLnRyYW5zZmVyT3JkZXIudHJhbnNhY3Rpb25UeXBlLnN0cnVjdHVyZSwKICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogdGhpcy50cmFuc2Zlck9yZGVyLmRhdGUsCiAgICAgICAgICAgICAgICBzZXF1Y2VuY2luZzogdGhpcy50cmFuc2Zlck9yZGVyLnRyYW5zYWN0aW9uVHlwZS5zZXF1Y2VuY2luZywKICAgICAgICAgICAgICAgIHR5cGU6ICJUcmFuc2ZlciBPcmRlciIsCiAgICAgICAgICAgICAgICBlbnRpdHk6IDMsCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRoaXMudHJhbnNmZXJPcmRlci5hYmJyID0gZGF0YS5hYmJyOwogICAgICAgICAgICB0aGlzLnRyYW5zZmVyT3JkZXIuc3RydWN0dXJlID0gZGF0YS5zdHJ1Y3R1cmU7CiAgICAgICAgICAgIHRoaXMudHJhbnNmZXJPcmRlci5zZXF1Y2VuY2luZyA9IGRhdGEuc2VxdWNlbmNpbmc7CiAgICAgICAgICAgIHRoaXMudHJhbnNmZXJPcmRlci50eXBlID0gZGF0YS50eXBlOwogICAgICAgICAgICB0aGlzLnRyYW5zZmVyT3JkZXIudHJhbnNhY3Rpb25EYXRlID0gZGF0YS50cmFuc2FjdGlvbkRhdGU7CiAgICAgICAgICAgIGJpbGxpbmdIYW5kbGVyCiAgICAgICAgICAgICAgICAubGFzdE51bWJlcihkYXRhKQogICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGFzdE51bWJlciA9IHRoaXMuemVyb1BhZCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlSW50KHJlcy5sYXN0TnVtYmVyKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNmZXJPcmRlci50cmFuc2FjdGlvblR5cGUuZm9ybWF0CiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNmZXJPcmRlci5udW1iZXIgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnN1ZmZpeCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zZmVyT3JkZXIudHJhbnNhY3Rpb25UeXBlLm51bWJlclNlcGFyYXRvciArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0TnVtYmVyOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zZmVyT3JkZXIubGFzdE51bWJlciA9IHJlcy5zdWZmaXggKyBsYXN0TnVtYmVyOwogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2codGhpcy5yZWNlaXB0T3JkZXIubnVtYmVyLCAiYm9tIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhlKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgemVyb1BhZChudW0sIHBsYWNlcykgewogICAgICAgICAgICByZXR1cm4gU3RyaW5nKG51bSkucGFkU3RhcnQocGxhY2VzLCAiMCIpOwogICAgICAgIH0sCiAgICAgICAgc3VmZml4KHRyYW5zYWN0aW9uRGF0ZSkgewogICAgICAgICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcobmV3IERhdGUodHJhbnNhY3Rpb25EYXRlKSwgYHl5bW1gKTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGdldEJhbGFuY2VXYXJlaG91c2UoaWQpIHsKICAgICAgICAgICAgY29uc3QgZGF0YSA9IHsKICAgICAgICAgICAgICAgIGl0bUlkOiBpZCwKICAgICAgICAgICAgICAgIGRhdGU6IHRoaXMudHJhbnNmZXJPcmRlci5kYXRlID8gdGhpcy50cmFuc2Zlck9yZGVyLmRhdGUgOiBuZXcgRGF0ZSgpLAogICAgICAgICAgICAgICAgd2hJZDogdGhpcy50cmFuc2Zlck9yZGVyLmZXYXJlaG91c2UKICAgICAgICAgICAgICAgICAgICA/IHRoaXMudHJhbnNmZXJPcmRlci5mV2FyZWhvdXNlLmlkCiAgICAgICAgICAgICAgICAgICAgOiAiIiwKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYXdhaXQgd2FyZWhvdXNlSGFuZGxlci5nZXRCYWxhbmNlKGRhdGEpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgdGhpcy5iYWxhbmNlV2FyZWhvdXNlID0gcmVzWzBdOwogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHRoaXMuYmFsYW5jZVdhcmVob3VzZSwgImJhbGFuY2Ugd2FyZWhvdXNlIik7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgZ2V0RGF0YVNvdXJjZSgpIHsKICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5kYXRhU291cmNlLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgIGxldCBkYXRhUm93ID0gZHMuZGF0YSgpOwogICAgICAgICAgICB0aGlzLml0ZW1MaW5lcyA9IFtdOwoKICAgICAgICAgICAgZGF0YVJvdy5mb3JFYWNoKChpKSA9PiB7CiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coaSwgIml0ZW0iKTsKICAgICAgICAgICAgICAgIHRoaXMuaXRlbUxpbmVzLnB1c2goewogICAgICAgICAgICAgICAgICAgIGlkOiBpLmlkLAogICAgICAgICAgICAgICAgICAgIGl0ZW06IGkuaXRlbSwKICAgICAgICAgICAgICAgICAgICBxb2g6IGkucW9oLAogICAgICAgICAgICAgICAgICAgIHVvbTogaS51b20sCiAgICAgICAgICAgICAgICAgICAgcXR5OiBpLnF0eQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgc2F2ZVByaW50KCkgewogICAgICAgIH0sCiAgICAgICAgY2FuY2VsKCkgewogICAgICAgICAgICB0aGlzLml0ZW1MaW5lcyA9IFtdCiAgICAgICAgICAgIHRoaXMuaXRlbUxpbmVzUyA9IFtdCiAgICAgICAgICAgIHRoaXMuaXRlbUxpbmVzT2xkUyA9IFtdCiAgICAgICAgICAgIHRoaXMuaXRlbUxpbmVzQmF0Y2ggPSBbXQogICAgICAgICAgICB0aGlzLml0ZW1MaW5lc09sZEJhdGNoID0gW10KICAgICAgICAgICAgdGhpcy5iYXRjaHMgPSBbXQogICAgICAgICAgICB0aGlzLnNlcmlhbHMgPSBbXQogICAgICAgICAgICB0aGlzLml0ZW1CYXRjaCA9IHt9CiAgICAgICAgICAgIHRoaXMuYW10QmF0Y2ggPSAwCiAgICAgICAgICAgIHRoaXMucXR5UmVjZWl2ZWQgPSAwCiAgICAgICAgICAgIHRoaXMudG90YWxCYXRjaCA9IDAKICAgICAgICAgICAgdGhpcy5xdHlEZWxpdmVyeSA9IDAKICAgICAgICAgICAgdGhpcy5xdHlTZXJpYWwgPSAwCiAgICAgICAgICAgIHRoaXMudHJhbnNmZXJPcmRlciA9IHRyYW5zZmVyT3JkZXI7CiAgICAgICAgICAgIHdpbmRvdy5oaXN0b3J5LmdvKC0xKTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIHNhdmVOZXcoKSB7CiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICBhd2FpdCB0aGlzLmdldERhdGFTb3VyY2UoKTsKICAgICAgICAgICAgdGhpcy50cmFuc2Zlck9yZGVyLml0ZW1MaW5lcyA9IHRoaXMuaXRlbUxpbmVzOwogICAgICAgICAgICB0aGlzLnRyYW5zZmVyT3JkZXIuaXRlbUxpbmVzU2VyaWFsID0gdGhpcy5pdGVtTGluZXNTOwogICAgICAgICAgICB0aGlzLnRyYW5zZmVyT3JkZXIuaXRlbUxpbmVzQmF0Y2ggPSB0aGlzLml0ZW1MaW5lc0JhdGNoOwogICAgICAgICAgICB0aGlzLnRyYW5zZmVyT3JkZXIuaXRlbUxpbmVzT2xkU2VyaWFsID0gdGhpcy5pdGVtTGluZXNPbGRTOwogICAgICAgICAgICB0aGlzLnRyYW5zZmVyT3JkZXIuaXRlbUxpbmVzT2xkQmF0Y2ggPSB0aGlzLml0ZW1MaW5lc09sZEJhdGNoOwogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2codGhpcy50cmFuc2Zlck9yZGVyLCAnMTIzJykKICAgICAgICAgICAgdHJhbnNmZXJPcmRlckhhbmRsZXIuc2F2ZSh0aGlzLnRyYW5zZmVyT3JkZXIpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlcyk7CiAgICAgICAgICAgICAgICB0aGlzLmlzQ2xvc2UgPSBmYWxzZQogICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5jYW5jZWwoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBzYXZlQ2xvc2UoKSB7CiAgICAgICAgfSwKICAgICAgICBlcnJvck1lc3NhZ2UoKSB7CiAgICAgICAgfSwKICAgICAgICBoaWRlX3NtYWxsc2l0ZWJhcigpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLmlzSGlkZUJhcikgewogICAgICAgICAgICAgICAgLy8gdGhpcy5jb2xfZXhwYW5kID0gMTIKICAgICAgICAgICAgICAgIC8vIHRoaXMuY29sX2hpZGUgPSAwCiAgICAgICAgICAgICAgICB0aGlzLmlzSGlkZUJhciA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyB0aGlzLmNvbF9leHBhbmQgPSA5CiAgICAgICAgICAgICAgICAvLyB0aGlzLmNvbF9oaWRlID0gMwogICAgICAgICAgICAgICAgdGhpcy5pc0hpZGVCYXIgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICB9LAogICAgd2F0Y2g6IHsKICAgICAgICAvLyBjYWxsIGFnYWluIHRoZSBtZXRob2QgaWYgdGhlIHJvdXRlIGNoYW5nZXMKICAgIH0sCiAgICBjcmVhdGVkKCkgewogICAgICAgIC8vIGZldGNoIHRoZSBkYXRhIHdoZW4gdGhlIHZpZXcgaXMgY3JlYXRlZCBhbmQgdGhlIGRhdGEgaXMKICAgICAgICAvLyBhbHJlYWR5IGJlaW5nIG9ic2VydmVkCiAgICAgICAgLy8gdGhpcy5sb2FkT2JqKCkKICAgIH0sCiAgICBhc3luYyBtb3VudGVkKCkgewogICAgICAgIHRoaXMuYWRkUm93KCk7CiAgICAgICAgYXdhaXQgdGhpcy5sb2FkUHJlZml4KCk7CiAgICB9LAp9Owo="},{"version":3,"sources":["TransferOrder.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmiBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"TransferOrder.vue","sourceRoot":"src/views/products/warehouses/operations","sourcesContent":["<template>\n    <v-app>\n        <v-container>\n            <v-row>\n                <v-col sm=\"12\" cols=\"12\">\n                    <v-card\n                        outlined\n                        dense\n                        class=\"pa-4 no_border rounded-sm\"\n                        color=\"white\"\n                    >\n                        <v-row>\n                            <v-col\n                                class=\"bigSide py-0\"\n                                sm=\"12\"\n                                cols=\"12\"\n                                style=\"transition: .3s ease-in;\"\n                                :class=\"{ hide_big_bar_class: isHideBar }\"\n                            >\n                                <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                                    <v-card outlined dense class=\"no_border\">\n                                        <h2 class=\"mb-0\">{{ $t(\"transfer_order\") }}</h2>\n                                        <v-icon\n                                            @click=\"cancel\"\n                                            style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                                            class=\"float-right\"\n                                        >close\n                                        </v-icon>\n                                    </v-card>\n                                    <v-card\n                                        outlined\n                                        dense\n                                        class=\"px-4 rounded-4 no_border mb-3\"\n                                        color=\"grayBg\"\n                                    >\n                                        <v-row>\n                                            <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                                                <label class=\"label  mb-0\">{{ $t(\"date\") }}</label>\n                                                <app-datepicker\n                                                    :initialDate=\"transferOrder.date\"\n                                                    @emitDate=\"transferOrder.date = $event\"\n                                                />\n                                                <label class=\"label  mb-0\">{{\n                                                        $t(\"from_warehouse\")\n                                                    }}</label>\n                                                <v-select\n                                                    class=\"mt-1\"\n                                                    :items=\"fWarehouses\"\n                                                    item-text=\"name\"\n                                                    item-value=\"id\"\n                                                    @change=\"onChangeFromWarehouse\"\n                                                    v-model=\"transferOrder.fWarehouse\"\n                                                    :rules=\"[(v) => !!v || 'Warehouse is required']\"\n                                                    return-object\n                                                    tage=\"Warehouse\"\n                                                    outlined\n                                                />\n                                            </v-col>\n                                            <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                                                <label class=\"label mb-0\">{{ $t(\"number\") }}</label>\n                                                <div class=\"mt-1 d-flex mr-0\">\n                                                    <div class=\"code_text flex-1 text-bold\">\n                                                        {{ transferOrder.abbr }}\n                                                    </div>\n                                                    <v-text-field\n                                                        class=\" custom-border flex-2\"\n                                                        v-model=\"transferOrder.number\"\n                                                        outlined\n                                                        disabled\n                                                        :rules=\"[(v) => !!v || 'Number is required']\"\n                                                        required\n                                                    />\n                                                    <v-icon\n                                                        color=\"black\"\n                                                        size=\"30\"\n                                                        style=\"height: 40px;\"\n                                                        class=\"border_qrcode ml-2\"\n                                                        @click=\"generateNumber\"\n                                                    >mdi-qrcode\n                                                    </v-icon>\n                                                </div>\n\n                                                <label class=\"label  mb-0\">{{\n                                                        $t(\"to_warehouse\")\n                                                    }}</label>\n                                                <v-select\n                                                    class=\"mt-1\"\n                                                    :items=\"tWarehouses\"\n                                                    item-text=\"name\"\n                                                    item-value=\"id\"\n                                                    v-model=\"transferOrder.tWarehouse\"\n                                                    :rules=\"[(v) => !!v || 'Warehouse is required']\"\n                                                    return-object\n                                                    tage=\"Warehouse\"\n                                                    outlined\n                                                />\n                                            </v-col>\n                                            <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                                                <label class=\"label  mb-0\">{{\n                                                        $t(\"description\")\n                                                    }}</label>\n                                                <v-textarea\n                                                    class=\"mt-1\"\n                                                    v-model=\"transferOrder.description\"\n                                                    outlined\n                                                    no-resize\n                                                    height=\"120px\"\n                                                    tage=\"Message on Transfer Order\"\n                                                />\n                                            </v-col>\n                                        </v-row>\n                                    </v-card>\n\n                                    <v-row color=\"white\">\n                                        <v-col sm=\"12\" cols=\"12\" class=\"pt-0\">\n                                            <kendo-datasource\n                                                ref=\"dataSource\"\n                                                @change=\"dataSourceChanged\"\n                                                :data=\"transferOrder.itemLines\"\n                                            />\n                                            <kendo-grid\n                                                id=\"grid\"\n                                                class=\"grid-function\"\n                                                :data-source-ref=\"'dataSource'\"\n                                                :sortable=\"false\"\n                                                :filterable=\"false\"\n                                                v-on:databound=\"dataBound\"\n                                                :column-menu=\"true\"\n                                                :editable=\"true\"\n                                                :scrollable-virtual=\"true\"\n                                            >\n                                                <kendo-grid-column\n                                                    :command=\"{\n                            iconClass: 'k-icon k-i-trash',\n                            text: ' ',\n                            click: removeRow,\n                            class: 'btn-plus',\n                          }\"\n                                                    :title=\"'&nbsp;'\"\n                                                    :width=\"60\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: right; background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :title=\"$t('no.')\"\n                                                    :width=\"55\"\n                                                    :template=\"rowNumber\"\n                                                    :column-menu=\"false\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5;',\n                            class: 'text-variants',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: variants' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'item'\"\n                                                    :title=\"$t('variants')\"\n                                                    :width=\"200\"\n                                                    :template=\"'<span>#=item.name#</span>'\"\n                                                    :editor=\"ItemDropDownEditor\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'uom'\"\n                                                    :template=\"UOMTemplate\"\n                                                    :editor=\"UOMDropDownEditor\"\n                                                    :title=\"$t('uom')\"\n                                                    :width=\"130\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'qoh'\"\n                                                    :title=\"$t('on_hand')\"\n                                                    :format=\"'{0:n}'\"\n                                                    :attributes=\"{ class: 'k-state-disabled' }\"\n                                                    :width=\"120\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                  :field=\"'qty'\"\n                                                  :editor=\"numberEditor\"\n                                                  :title=\"$t('qty_to_transfer')\"\n                                                  :format=\"'{0:n}'\"\n                                                  :width=\"180\"\n                                                  :attributes=\"{\n                                                    style: 'text-align: right',\n                                                  }\"\n                                                  :headerAttributes=\"{\n                                                    style: 'background-color: #EDF1F5',\n                                                  }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :command=\"[{\n                                                        iconClass: 'k-icon k-i-plus',\n                                                     text: $t('serial'),\n                                                     click: recordSerial,\n                                                     className: 'k-state-disabled isSerialNumber btn-plus',\n                                                     },{\n                                                    iconClass: 'k-icon k-i-plus',\n                                                     text: $t('batch'),\n                                                     click: recordBatch,\n                                                     className: 'k-state-disabled isBatch btn-plus'\n                                                     }]\"\n                                                    :width=\"190\"\n                                                    :hidden=\"false\"\n                                                    :headerAttributes=\"{style:'text-align: right; background-color: #EDF1F5',}\"\n                                                />\n                                            </kendo-grid>\n                                        </v-col>\n                                        <v-col cols=\"12\" class=\"pt-0\">\n                                            <v-btn\n                                                color=\"primary\"\n                                                class=\"float-left btn_plus rounded-4 white--text mr-2\"\n                                                @click=\"addRow\"\n                                            >\n                                                <v-icon size=\"\" class=\"ma-1\">mdi-plus</v-icon>\n                                            </v-btn>\n                                        </v-col>\n                                        <v-col sm=\"12\" cols=\"12\">\n                                            <v-row>\n                                                <v-col sm=\"5\" cols=\"12\" class=\"pt-0\">\n                                                    <template>\n                                                        <v-file-input\n                                                            class=\"mt-0 pt-0 \"\n                                                            sm=\"3\"\n                                                            cols=\"6\"\n                                                            v-model=\"files\"\n                                                            :placeholder=\"$t('attachment')\"\n                                                            multiple\n                                                            prepend-icon=\"mdi-paperclip\"\n                                                        >\n                                                            <template v-slot:selection=\"{ text }\">\n                                                                <v-chip small label color=\"primary\">\n                                                                    {{ text }}\n                                                                </v-chip>\n                                                            </template>\n                                                        </v-file-input>\n                                                    </template>\n                                                </v-col>\n                                            </v-row>\n                                        </v-col>\n                                    </v-row>\n                                    <v-divider/>\n                                    <v-card outlined dense class=\"no_border function_footer\">\n                                        <!-- <v-menu>\n                                          <template v-slot:activator=\"{ on }\">\n                                            <v-btn\n                                              color=\"black\"\n                                              outlined\n                                              class=\"mr-2 text-capitalize  black--text float-left\"\n                                              v-on=\"on\"\n                                            >\n                                              {{ $t(\"select_template\") }}\n                                              <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>\n                                            </v-btn>\n                                          </template>\n                                          <v-list>\n                                            <v-list-item\n                                              v-for=\"(item, index) in templates\"\n                                              :key=\"index\"\n                                            >\n                                              <v-list-item-title>{{\n                                                item.title\n                                              }}</v-list-item-title>\n                                            </v-list-item>\n                                          </v-list>\n                                        </v-menu> -->\n                                        <v-btn\n                                            color=\"primary\"\n                                            outlined\n                                            class=\"text-capitalize  black--text float-left\"\n                                        >{{ $t(\"cancel\") }}\n                                        </v-btn>\n                                        <v-menu>\n                                            <template v-slot:activator=\"{ on }\">\n                                                <v-btn\n                                                    class=\"ml-2 float-right text-capitalize  black--text\"\n                                                    v-on=\"on\"\n                                                >\n                                                    {{ $t(\"save_option\") }}\n                                                    <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>\n                                                </v-btn>\n                                            </template>\n                                            <v-list rounded>\n                                                <v-list-item-group>\n                                                    <v-list-item>\n                                                        <v-list-item-content>\n                                                            <v-list-item-title>\n                                                                {{ $t(\"save_new\") }}\n                                                            </v-list-item-title>\n                                                        </v-list-item-content>\n                                                    </v-list-item>\n                                                    <v-list-item>\n                                                        <v-list-item-content>\n                                                            <v-list-item-title\n                                                            >{{ $t(\"save_print\") }}\n                                                            </v-list-item-title>\n                                                        </v-list-item-content>\n                                                    </v-list-item>\n                                                </v-list-item-group>\n                                            </v-list>\n                                        </v-menu>\n                                        <v-btn\n                                            color=\"primary\"\n                                            @click=\"saveNew\"\n                                            class=\"float-right white--text text-capitalize \"\n                                        >\n                                            {{ $t(\"save_draft\") }}\n                                        </v-btn>\n                                    </v-card>\n                                </v-form>\n                            </v-col>\n                        </v-row>\n                    </v-card>\n                    <v-dialog v-model=\"dialogS\" max-width=\"700px\" eager persistent>\n                        <v-card>\n                            <div class=\"modal_header\">\n                                <v-card-title>{{ $t(\"serial\") }}</v-card-title>\n                                <v-icon @click=\"onCloseS\">close</v-icon>\n                            </div>\n                            <v-card-text class=\"modal_text_content pa-4\">\n                                <v-row>\n                                    <v-col sm=\"12\" cols=\"12\" class=\"pt-0\">\n                                        <kendo-datasource\n                                            ref=\"dataSource1\"\n                                            @change=\"dataSourceChangedS\"\n                                            :data=\"serials\"\n                                        />\n                                        <kendo-grid\n                                            id=\"gridS\"\n                                            class=\"grid-function\"\n                                            :data-source-ref=\"'dataSource1'\"\n                                            :sortable=\"false\"\n                                            :filterable=\"false\"\n                                            :column-menu=\"true\"\n                                            :editable=\"true\"\n                                            v-on:databound=\"dataBoundS\"\n                                            :scrollable-virtual=\"true\"\n                                        >\n                                            <kendo-grid-column\n                                                :title=\"$t('no.')\"\n                                                :width=\"55\"\n                                                :template=\"rowNumberS\"\n                                                :column-menu=\"false\"\n                                                :headerAttributes=\"{\n                                                    style: 'background-color: #EDF1F5;',\n                                                    class: 'text-variants',\n                                                  }\"\n                                                :attributes=\"{ style: 'text-align: variants' }\"\n                                            />\n                                            <kendo-grid-column\n                                                :field=\"'serialNumber1'\"\n                                                :title=\"$t('serial_number_1')\"\n                                                :width=\"150\"\n                                                :editable=\"function() {return false}\"\n                                                :attribute=\"{class: 'k-state-disabled'}\"\n                                                :headerAttributes=\"{style: 'background-color: #EDF1F5', }\"\n                                            />\n                                            <kendo-grid-column\n                                                :field=\"'serialNumber2'\"\n                                                :title=\"$t('serial_number_2')\"\n                                                :width=\"150\"\n                                                :editable=\"function() {return false}\"\n                                                :attributes=\"{ class: 'k-state-disabled isSerialNumber2'}\"\n                                                :headerAttributes=\"{style: 'background-color: #EDF1F5'}\"\n                                            />\n                                            <kendo-grid-column\n                                                :field=\"'tick'\"\n                                                :title=\"' '\"\n                                                :editable=\"function(){ return false; }\"\n                                                :template=\"getRowTemplate\"\n                                                :width=\"70\"\n                                                :attributes=\"{ class: ''}\"\n                                                :headerAttributes=\"{style: 'background-color: #EDF1F5'}\"\n                                            />\n                                        </kendo-grid>\n                                    </v-col>\n                                </v-row>\n                            </v-card-text>\n                            <v-card-actions class=\"modal_footer\">\n                                <v-row>\n                                    <v-col sm=\"6\" cols=\"6\" class=\"py-0 text-left\">\n                                        <v-btn\n                                            color=\"black\"\n                                            outlined\n                                            class=\" text-capitalize  black--text float-left\"\n                                            @click=\"onCloseS\"\n                                        >{{ $t(\"cancel\") }}\n                                        </v-btn>\n                                    </v-col>\n                                    <v-col sm=\"6\" cols=\"6\" class=\"py-0 text-right\">\n                                        <v-btn\n                                            @click=\"addSerial\"\n                                            color=\"primary\"\n                                            class=\"px-3  white--text text-capitalize\"\n                                        >{{ $t(\"add\") }}\n                                        </v-btn>\n                                    </v-col>\n                                </v-row>\n                            </v-card-actions>\n                        </v-card>\n                    </v-dialog>\n                    <v-dialog v-model=\"dialog\" max-width=\"700px\" eager persistent>\n                        <v-card>\n                            <LoadingMe\n                                :isLoading=\"showLoadingB\"\n                                :fullPage=\"false\"\n                                :type=\"'loading'\"\n                                :myLoading=\"true\"\n                            />\n                            <div class=\"modal_header\">\n                                <v-card-title>{{ $t(\"batch\") }}</v-card-title>\n                                <v-icon @click=\"onCloseBatch\">close</v-icon>\n                            </div>\n                            <v-card-text class=\"modal_text_content pa-4\">\n                                <v-row>\n                                    <v-col sm=\"12\" cols=\"12\" class=\"pt-0\">\n                                        <v-row>\n                                            <v-col sm=\"3\" cols=\"3\" class=\"py-1\">\n                                                <label class=\"label\">{{ $t(\"on_hand\") }}</label>\n                                                <h3 class=\"text-bold d-block py-1\">{{ amtBatch }}</h3>\n                                            </v-col>\n                                            <v-col sm=\"3\" cols=\"3\" class=\"py-1\">\n                                                <label class=\"label\">{{ $t(\"qty_to_transfer\") }}</label>\n                                                <h3 class=\"text-bold d-block py-1\">{{ qtyReceived }}</h3>\n                                            </v-col>\n                                            <v-col sm=\"3\" cols=\"3\" class=\"py-1\">\n                                                <label class=\"label\">{{ $t(\"qty_transferred\") }}</label>\n                                                <h3 :class=\"qtyDelivery > qtyReceived ? 'text-bold d-block py-1 red--text' : 'text-bold d-block py-1'\">{{ qtyDelivery }}</h3>\n                                            </v-col>\n                                            <v-col sm=\"3\" cols=\"3\" class=\"py-1\">\n                                                <label class=\"label\">{{ $t(\"total\") }}</label>\n                                                <h3 class=\"text-bold d-block py-1\">{{ amtBatch - qtyDelivery }}</h3>\n                                            </v-col>\n                                        </v-row>\n                                    </v-col>\n                                    <v-col sm=\"12\" cols=\"12\" class=\"pt-0\">\n                                        <kendo-datasource\n                                            ref=\"dataSource2\"\n                                            @change=\"dataSourceChangedB\"\n                                            :data=\"batchs\"\n                                        />\n                                        <kendo-grid\n                                            id=\"gridBatch\"\n                                            class=\"grid-function\"\n                                            :data-source-ref=\"'dataSource2'\"\n                                            :sortable=\"false\"\n                                            :filterable=\"false\"\n                                            :column-menu=\"true\"\n                                            :editable=\"true\"\n                                            v-on:databound=\"dataBoundB\"\n                                            :scrollable-virtual=\"true\"\n                                        >\n                                            <kendo-grid-column\n                                                :title=\"$t('no.')\"\n                                                :width=\"55\"\n                                                :template=\"rowNumberB\"\n                                                :column-menu=\"false\"\n                                                :headerAttributes=\"{\n                                                    style: 'background-color: #EDF1F5;',\n                                                    class: 'text-variants',\n                                                  }\"\n                                                :attributes=\"{ style: 'text-align: variants' }\"\n                                            />\n                                            <kendo-grid-column\n                                                :field=\"'number'\"\n                                                :title=\"$t('number')\"\n                                                :editable=\"function() {return false}\"\n                                                :width=\"150\"\n                                                :headerAttributes=\"{style: 'background-color: #EDF1F5', }\"\n                                            />\n                                            <kendo-grid-column\n                                                :field=\"'expirationDate'\"\n                                                :title=\"$t('expiration_date')\"\n                                                :width=\"150\"\n                                                :editable=\"function() {return false}\"\n                                                :template=\"ExpirationDateToTemplate\"\n                                                :editor=\"ExpirationDateToEditor\"\n                                                :attributes=\"{ class: 'k-state-disabled expirationDate'}\"\n                                                :headerAttributes=\"{style: 'background-color: #EDF1F5'}\"\n                                            />\n                                            <kendo-grid-column\n                                                :field=\"'qty'\"\n                                                :title=\"$t('qty')\"\n                                                :editable=\"function() {return false}\"\n                                                :width=\"100\"\n                                                :attributes=\"{ style: 'text-align: right' }\"\n                                                :headerAttributes=\"{style: 'background-color: #EDF1F5', }\"\n                                            />\n                                            <kendo-grid-column\n                                                :field=\"'TQty'\"\n                                                :title=\"$t('qty_transferred')\"\n                                                :editor=\"numberEditorB\"\n                                                :width=\"140\"\n                                                :attributes=\"{ style: 'text-align: right' }\"\n                                                :headerAttributes=\"{style: 'background-color: #EDF1F5', }\"\n                                            />\n                                        </kendo-grid>\n                                    </v-col>\n                                </v-row>\n                            </v-card-text>\n                            <v-card-actions class=\"modal_footer\">\n                                <v-row>\n                                    <v-col sm=\"6\" cols=\"6\" class=\"py-0 text-left\">\n                                        <v-btn\n                                            color=\"black\"\n                                            outlined\n                                            class=\" text-capitalize  black--text float-left\"\n                                            @click=\"onCloseBatch\"\n                                        >{{ $t(\"cancel\") }}\n                                        </v-btn>\n                                    </v-col>\n                                    <v-col sm=\"6\" cols=\"6\" class=\"py-0 text-right\">\n                                        <v-btn\n                                            color=\"primary\"\n                                            @click=\"onSaveBatch\"\n                                            class=\"px-3  white--text text-capitalize\"\n                                        >{{ $t(\"save\") }}\n                                        </v-btn>\n                                    </v-col>\n                                </v-row>\n                            </v-card-actions>\n                        </v-card>\n                    </v-dialog>\n                </v-col>\n            </v-row>\n            <LoadingMe\n                :isLoading=\"showLoading\"\n                :fullPage=\"true\"\n                :myLoading=\"true\"\n                :alertMessage=\"loadingAlert\"\n                :color=\"loadingColorAlert\"\n                :alertText=\"loadingTextAlert\"\n            />\n        </v-container>\n    </v-app>\n</template>\n\n<script>\n// import kendo from '@progress/kendo-ui'\nimport LoadingMe from \"@/components/Loading\";\nimport DatePickerComponent from \"@/components/custom_templates/DatePickerComponent\";\nimport TransferOrder from \"@/scripts/model/transferOrder\";\nimport kendo from \"@progress/kendo-ui\";\nimport {uuid} from \"vue-uuid\";\nimport {i18n} from \"@/i18n\";\nimport saleOrderHandler from \"@/scripts/transactionHandler\";\nimport $ from \"jquery\";\nimport receiptOrderHandler from \"@/scripts/receiptOrderHandler\";\nimport Vue from \"vue\";\nimport Row from \"@/views/customers/settings/CheckboxTemplate\";\n\nconst transferOrderHandler = require(\"@/scripts/transferOrderHandler\");\nconst billingHandler = require(\"@/scripts/invoice/handler/billingHandler\");\nconst productVariantHandler = require(\"@/scripts/productVariantHandler\");\nconst uomPriceHandler = require(\"@/scripts/uomPriceHandler\");\nconst warehouseHandler = require(\"@/scripts/warehouseHandler\");\nconst prefixHandler = require(\"@/scripts/prefixHandler\");\nconst transferOrder = new TransferOrder({});\nconst itemLinePrefix = \"lin-\";\nconst rowTemplate = Vue.component(Row.name, Row);\nexport default {\n    name: \"CreditPurchase\",\n    components: {\n        LoadingMe: LoadingMe,\n        \"app-datepicker\": DatePickerComponent,\n    },\n    data: () => ({\n        isEdit: false,\n        dialog: false,\n        dialogS: false,\n        // LoadingMe\n        showLoadingB: false,\n        showLoadingTxn: false,\n        showLoading: false,\n        loadingAlert: false,\n        loadingColorAlert: \"\",\n        loadingTextAlert: \"\",\n        bill_date: \"\",\n        alert: false,\n        deposite: 1000,\n        files: [],\n        // Form validation\n        valid: true,\n        isClose: true,\n\n        templates: [\n            {title: \"Draft\"},\n            {title: \"Open\"},\n            {title: \"Partially Closed\"},\n            {title: \"Closed\"},\n        ],\n        isHideBar: false,\n\n        batchs: [],\n        itemBatch: {},\n        amtBatch: 0,\n        qtyReceived: 0,\n        totalBatch: 0,\n        qtyDelivery: 0,\n        serials: [],\n        qtySerial: 0,\n        transactionTypes: [],\n        itemLines: [],\n        itemLinesS: [],\n        itemLinesOldS: [],\n        itemLinesBatch: [],\n        itemLinesOldBatch: [],\n        fWarehouses: [],\n        tWarehouses: [],\n        balanceWarehouse: {bQty: 0},\n        transferOrder: transferOrder,\n    }),\n    beforeRouteLeave(to, from, next) {\n        if (this.isClose) {\n            this.$swal({\n                title: i18n.t(\"msg_title_warning\"),\n                text: i18n.t(\"msg_discard\"),\n                icon: \"warning\",\n                showCancelButton: true,\n                cancelButtonText: i18n.t(\"cancel\"),\n                confirmButtonColor: \"#4d4848\",\n                cancelButtonColor: \"#ED1A3A\",\n                confirmButtonText: i18n.t(\"discard\"),\n            }).then((resultCen) => {\n                if (resultCen.value) {\n                    this.transferOrder = transferOrder;\n                    next()\n                }\n            });\n        } else {\n            next()\n        }\n    },\n    methods: {\n        dataBoundS: function (e) {\n            const grid = kendo.jQuery(\"#gridS\").data(\"kendoGrid\")\n            const items = e.sender.items();\n            items.each(function () {\n                let dataItem = grid.dataItem(this);\n                kendo\n                    .jQuery(\"tr[data-uid='\" + dataItem.uid + \"']\")\n                    .find(\".isSerialNumber2\")\n                    .each(function () {\n                        if (dataItem.batchOrSerial == 2) {\n                            kendo.jQuery(this).removeClass(\"k-state-disabled\");\n                        } else {\n                            kendo.jQuery(this).addClass(\"k-state-disabled\")\n                        }\n                    });\n            });\n\n        },\n        addSerial() {\n            this.getDataSourceS()\n            window.console.log(this.itemLinesS, 'itemline s')\n        },\n        async getDataSourceS() {\n            let ds = this.$refs.dataSource1.kendoWidget();\n            let dataRow = ds.data();\n            const s = dataRow.filter(i => i.tick == true)\n            if (s.length !== this.qtySerial) {\n                this.$snotify.error('Please check your qty of serial number')\n                return\n            }\n            dataRow.forEach((i) => {\n                if (i.serialNumber1 !== '') {\n                    this.itemLinesS.push({\n                        id: itemLinePrefix + uuid.v1(),\n                        item: i.item,\n                        uom: i.uom,\n                        serialNumber1: i.serialNumber1,\n                        serialNumber2: i.serialNumber2,\n                        type: 'serial',\n                        whId: this.transferOrder.tWarehouse.id,\n                        tick: i.tick,\n                        status: 1\n                    });\n                    this.itemLinesOldS.push({\n                        id: i.id,\n                        item: i.item,\n                        uom: i.uom,\n                        serialNumber1: i.serialNumber1,\n                        serialNumber2: i.serialNumber2,\n                        type: 'serial',\n                        whId: i.whId,\n                        createdAt: i.createdAt,\n                        pk: i.pk,\n                        tick: i.tick,\n                        status: i.tick === true ? 2 : 1\n                    });\n                }\n            });\n            this.onCloseS()\n        },\n        updateSelection(item, value) {\n            const ds = this.$refs.dataSource1.kendoWidget()\n            const rows = ds.data()\n            rows.map(row => {\n                if (row.id === item.id) {\n                    // row.set('tick', value)\n                    row['tick'] = value\n                }\n            })\n        },\n        getRowTemplate(e) {\n            return {\n                template: rowTemplate,\n                templateArgs: Object.assign(this.templateData(e))\n            };\n        },\n        templateData(item) {\n            return {\n                dataItem: item,\n                parentComponent: this\n            };\n        },\n        onChangeSO(item) {\n            window.console.log(item, 'onchangePO')\n            this.deliveryOrder.itemLines = []\n            this.saleOrder.itemLines.forEach(p => {\n                this.deliveryOrder.itemLines.push({\n                    ...p,\n                    qtyReceived: p.qty - p.totalReceived,\n                    source: 'sale order'\n                })\n            })\n            window.console.log(this.receiptOrder.itemLines, 'itemline')\n        },\n        async loadSaleOrders() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    let supplierId = \"\",\n                        whId = \"\",\n                        txnDate = \"\"\n                    if (this.deliveryOrder.customer) {\n                        supplierId = this.deliveryOrder.customer.id;\n                    }\n                    if (this.deliveryOrder.warehouse) {\n                        whId = this.deliveryOrder.warehouse.id\n                    }\n                    if (this.deliveryOrder.date) {\n                        txnDate = this.deliveryOrder.date;\n                    }\n                    let strFilter = \"\";\n                    if (supplierId !== \"\" && txnDate !== \"\" && whId !== \"\") {\n                        strFilter = \"?id=\" + supplierId + \"&whId=\" + whId + '&wType=RO&type=Sale Order'\n                    }\n                    if (strFilter !== \"\") {\n                        this.showLoadingTxn = true\n                        saleOrderHandler\n                            .transactionFilter(strFilter)\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.showLoadingTxn = false\n                                    this.showLoading = false;\n                                    this.saleOrders = res.data.data;\n                                } else {\n                                    this.showLoadingTxn = false\n                                }\n                            })\n                    }\n                }, 10);\n            });\n        },\n        onCloseS() {\n            this.dialogS = false\n            this.serials = []\n        },\n        rowNumberS(dataItem) {\n            let ds = this.$refs.dataSource1.kendoWidget(),\n                index = ds.indexOf(dataItem);\n            return index + 1;\n        },\n        dataSourceChangedS(e) {\n            if (e.field) {\n                let dataRow = e.items[0];\n                window.console.log(e, \"data source change\");\n                switch (e.field) {\n                    case \"serialNumber1\":\n                        kendo\n                            .jQuery(\"tr[data-uid='\" + dataRow.uid + \"']\")\n                            .find(\".isSerialNumber2\")\n                            .each(function () {\n                                if (dataRow.item.batchOrSerial == 2) {\n                                    kendo.jQuery(this).removeClass(\"k-state-disabled\");\n                                } else {\n                                    kendo.jQuery(this).addClass(\"k-state-disabled\");\n                                }\n                            });\n                        break;\n                }\n            }\n        },\n        recordSerial(e) {\n            e.preventDefault();\n            let grid = kendo.jQuery(\"#grid\").data(\"kendoGrid\")\n            let dataItem = grid.dataItem($(e.currentTarget).closest(\"tr\"))\n            if (dataItem.item.batchOrSerial === 2 && dataItem.qty > 0) {\n                if (this.itemLinesS.length > 0) {\n                    this.serials = this.itemLinesS.filter(p => p.item.id === dataItem.item.id)\n                } else {\n                    receiptOrderHandler.getBatch(dataItem.item.id, this.transferOrder.fWarehouse.id, 'serial').then(res => {\n                        window.console.log(res, 'serial')\n                        if (res.length > 0) {\n                            this.qtySerial = dataItem.qty;\n                            res.forEach(o => {\n                                this.serials.push({\n                                    id: o.linId,\n                                    item: o.item,\n                                    uom: o.uom,\n                                    whId: o.whId,\n                                    serialNumber1: o.serialNumber1,\n                                    serialNumber2: o.serialNumber2,\n                                    status: o.status,\n                                    createdAt: o.createdAt,\n                                    pk: o.id\n                                })\n                            })\n                        } else {\n                            this.$snotify.error('This item ' + dataItem.item.name + 'no serial')\n                        }\n                    })\n                }\n                this.dialogS = true\n            }\n        },\n        dataBoundB: function (e) {\n            const grid = kendo.jQuery(\"#gridBatch\").data(\"kendoGrid\")\n            const items = e.sender.items();\n            items.each(function () {\n                let dataItem = grid.dataItem(this);\n                kendo\n                    .jQuery(\"tr[data-uid='\" + dataItem.uid + \"']\")\n                    .find(\".expirationDate\")\n                    .each(function () {\n                        if (dataItem.number !== '') {\n                            kendo.jQuery(this).removeClass(\"k-state-disabled\");\n                        }\n                    });\n            });\n        },\n        onSaveBatch() {\n            if ((this.qtyReceived - this.qtyDelivery) > 0 || (this.qtyDelivery > this.qtyReceived)) {\n                this.$snotify.error('Please check your Qty')\n                return\n            }\n            this.getDataSourceB()\n            window.console.log(this.itemLinesBatch, 'itemline b')\n        },\n        onCloseBatch() {\n            this.dialog = false\n            this.batchs = []\n        },\n        async getDataSourceB() {\n            let ds = this.$refs.dataSource2.kendoWidget();\n            let dataRow = ds.data();\n            dataRow.forEach((i) => {\n                if (i.qty > 0) {\n                    this.itemLinesBatch.push({\n                        id: itemLinePrefix + uuid.v1(),\n                        item: i.item,\n                        uom: i.uom,\n                        number: i.number,\n                        whId: this.transferOrder.tWarehouse.id,\n                        expirationDate: i.expirationDate,\n                        qty: i.TQty,\n                        DQty: 0,\n                        type: 'batch',\n                        status: i.status\n                    });\n                    this.itemLinesOldBatch.push({\n                        id: i.id,\n                        item: i.item,\n                        number: i.number,\n                        whId: i.whId,\n                        uom: i.uom,\n                        expirationDate: i.expirationDate,\n                        qty: i.qty - i.TQty,\n                        DQty: i.DQty,\n                        type: 'batch',\n                        status: i.status,\n                        pk: i.pk,\n                        createdAt: i.createdAt\n                    });\n                }\n            });\n            this.onCloseBatch()\n        },\n        removeRowB(e) {\n            e.preventDefault();\n            const grid = kendo.jQuery(\"#gridBatch\").data(\"kendoGrid\"),\n                dataSource = grid.dataSource,\n                dataItem = grid.dataItem(kendo.jQuery(e.currentTarget).closest(\"tr\"));\n            if (dataSource.total() > 1) {\n                dataSource.remove(dataItem);\n                this.calcuateBatch()\n            }\n        },\n        rowNumberB(dataItem) {\n            let ds = this.$refs.dataSource2.kendoWidget(),\n                index = ds.indexOf(dataItem);\n            return index + 1;\n        },\n        async calcuateBatch() {\n            let ds = this.$refs.dataSource2.kendoWidget();\n            let dataRow = ds.data();\n            let amount = 0\n            dataRow.forEach((i) => {\n                amount += i.TQty\n            });\n            this.qtyDelivery = amount\n            this.totalBatch = this.qtyReceived - amount\n        },\n        numberEditorB(container, options) {\n            kendo\n                .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoNumericTextBox({\n                    decimals: 30,\n                    min: 0,\n                    max: options.model.qty || 0\n                });\n        },\n        dataSourceChangedB(e) {\n            if (e.field) {\n                let dataRow = e.items[0];\n                window.console.log(e, \"data source change\");\n                switch (e.field) {\n                    case \"TQty\":\n                        this.calcuateBatch()\n                        kendo\n                            .jQuery(\"tr[data-uid='\" + dataRow.uid + \"']\")\n                            .find(\".expirationDate\")\n                            .each(function () {\n                                if (dataRow.number !== '') {\n                                    kendo.jQuery(this).removeClass(\"k-state-disabled\");\n                                }\n                            });\n                        break;\n\n                }\n            }\n        },\n        addRowB() {\n            let data = {\n                id: itemLinePrefix + uuid.v1(),\n                item: this.itemBatch,\n                number: '',\n                expirationDate: '',\n                whId: this.deliveryOrder.warehouse.id,\n                qty: 0,\n                status: 1\n            };\n            let ds = this.$refs.dataSource2.kendoWidget(),\n                total = ds.total();\n            ds.insert(total, data);\n        },\n        recordBatch(e) {\n            this.showLoadingB = true\n            e.preventDefault();\n            let grid = kendo.jQuery(\"#grid\").data(\"kendoGrid\")\n            let dataItem = grid.dataItem($(e.currentTarget).closest(\"tr\"))\n            this.itemBatch = dataItem.item\n            if (dataItem.item.batchOrSerial === 1 && dataItem.qty > 0) {\n                receiptOrderHandler.getBatch(dataItem.item.id, this.transferOrder.fWarehouse.id, 'batch').then(res => {\n                    window.console.log(res, 'batch')\n                    if (res.length > 0) {\n                        let amount = 0\n                        res.forEach(o => {\n                            this.batchs.push({\n                                id: o.linId,\n                                item: o.item,\n                                uom: o.uom,\n                                number: o.number,\n                                expirationDate: o.expirationDate,\n                                qty: o.qty,\n                                whId: o.whId,\n                                TQty: 0,\n                                DQty: o.DQty || 0,\n                                status: o.status,\n                                createdAt: o.createdAt,\n                                pk: o.id\n                            })\n                            amount += o.qty\n                        })\n                        this.amtBatch = amount\n                        this.qtyReceived = dataItem.qty\n                        this.totalBatch = dataItem.qty\n                        this.dialog = true\n                    } else {\n                        this.$snotify.error('This item ' + dataItem.item.name + ' no stock in warehouse')\n                    }\n                })\n            }\n            this.showLoadingB = false\n        },\n\n        onChangeFromWarehouse() {\n            this.tWarehouses = this.fWarehouses.filter(p => p.id !== this.transferOrder.fWarehouse.id)\n            if (this.tWarehouses.length > 0) {\n                this.transferOrder.tWarehouse = this.tWarehouses[0]\n            }\n        },\n        numberEditor(container, options) {\n            kendo\n                .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoNumericTextBox({\n                    decimals: 30,\n                    min: 0,\n                    max: this.balanceWarehouse ? this.balanceWarehouse.bQty : 0,\n                });\n        },\n        dataSourceChanged(e) {\n            if (e.field) {\n                let dataRow = e.items[0];\n                switch (e.field) {\n                    case \"item\":\n                        this.getBalanceWarehouse(dataRow.item.id).then(() => {\n                            dataRow.set(\"qoh\", this.balanceWarehouse ? this.balanceWarehouse.bQty : 0);\n                        });\n                        kendo\n                            .jQuery(\"tr[data-uid='\" + dataRow.uid + \"']\")\n                            .find(\".isSerialNumber\")\n                            .each(function () {\n                                if (dataRow.item.batchOrSerial == 2) {\n                                    kendo.jQuery(this).removeClass(\"k-state-disabled\");\n                                    dataRow.set(\"expirationDate\", \"\");\n                                } else {\n                                    kendo.jQuery(this).addClass(\"k-state-disabled\");\n                                }\n                            });\n                        kendo\n                            .jQuery(\"tr[data-uid='\" + dataRow.uid + \"']\")\n                            .find(\".isBatch\")\n                            .each(function () {\n                                if (dataRow.item.batchOrSerial == 1) {\n                                    kendo.jQuery(this).removeClass(\"k-state-disabled\");\n                                } else {\n                                    kendo.jQuery(this).addClass(\"k-state-disabled\");\n                                }\n                            });\n                        break;\n                }\n            }\n        },\n        ExpirationDateToTemplate(dataItem) {\n            const expirationDate = dataItem.expirationDate;\n            if (expirationDate) {\n                return `<span>${\n                    expirationDate\n                        ? kendo.toString(new Date(expirationDate), `dd-MM-yyyy`)\n                        : ``\n                }</span>`;\n            } else {\n                return ``;\n            }\n        },\n        ExpirationDateToEditor(container, options) {\n            kendo\n                .jQuery('<input required name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDatePicker();\n        },\n        ItemDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"contains\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    headerTemplate:\n                        '<div class=\"dropdown-header k-widget k-header\">' +\n                        \"<span>Items </span>\" +\n                        \"<span></span>\" +\n                        \"</div>\",\n                    template: \"<span>#=name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        serverFiltering: true,\n                        transport: {\n                            read: {\n                                url: productVariantHandler.itemSearchURL(),\n                            },\n                            dataType: \"json\",\n                        },\n                        schema: {\n                            model: {\n                                id: \"id\",\n                                fields: {\n                                    id: {type: \"string\"},\n                                    name: {type: \"string\"},\n                                    sku: {type: \"string\"},\n                                },\n                            },\n                            data: function (response) {\n                                return response.data.filter(p => p.type === 'Variant')\n                            },\n                            total: function (response) {\n                                return response.data.filter(p => p.type === 'Variant').length;\n                            },\n                        },\n                        // data: this.variants\n                    }),\n                });\n        },\n        UOMDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"uom.name\",\n                    dataValueField: \"uom.id\",\n                    cascadeFrom: \"item\",\n                    template: \"<span>#=uom.name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        serverFiltering: true,\n                        transport: {\n                            read: {\n                                url: uomPriceHandler.uomPriceByPriceLevelURL(\n                                    \"id=\" +\n                                    options.model.item.id +\n                                    \"&plId=-\" + \"&date=\" +\n                                    this.transferOrder.date\n                                ),\n                            },\n                            dataType: \"json\",\n                        },\n                        schema: {\n                            model: {\n                                id: \"id\",\n                                fields: {\n                                    id: {type: \"string\"},\n                                    // name: {type: \"string\"},\n                                    // sku: {type: \"string\"},\n                                },\n                            },\n                            data: function (response) {\n                                return response.data;\n                            },\n                            total: function (response) {\n                                return response.data.count;\n                            },\n                        },\n                        // data: this.variants\n                    }),\n                });\n        },\n        UOMTemplate(dataItem) {\n            const uom = dataItem.uom;\n            if (uom) {\n                return `<span>${uom.uom ? uom.uom.name : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        removeRow(e) {\n            e.preventDefault();\n            const grid = kendo.jQuery(\"#grid\").data(\"kendoGrid\"),\n                dataSource = grid.dataSource,\n                dataItem = grid.dataItem(kendo.jQuery(e.currentTarget).closest(\"tr\"));\n\n            if (dataSource.total() > 1) {\n                dataSource.remove(dataItem);\n            }\n        },\n        rowNumber(dataItem) {\n            let ds = this.$refs.dataSource.kendoWidget(),\n                index = ds.indexOf(dataItem);\n            return index + 1;\n        },\n        dataBound: function (e) {\n            const grid = kendo.jQuery(\"#grid\").data(\"kendoGrid\")\n            const items = e.sender.items();\n            items.each(function () {\n                let dataItem = grid.dataItem(this);\n                kendo\n                    .jQuery(\"tr[data-uid='\" + dataItem.uid + \"']\")\n                    .find(\".isSerialNumber\")\n                    .each(function () {\n                        if (dataItem.item.batchOrSerial == 2) {\n                            kendo.jQuery(this).removeClass(\"k-state-disabled\");\n                        } else {\n                            kendo.jQuery(this).addClass(\"k-state-disabled\");\n                        }\n                    });\n                kendo\n                    .jQuery(\"tr[data-uid='\" + dataItem.uid + \"']\")\n                    .find(\".isBatch\")\n                    .each(function () {\n                        if (dataItem.item.batchOrSerial == 1) {\n                            kendo.jQuery(this).removeClass(\"k-state-disabled\");\n                        } else {\n                            kendo.jQuery(this).addClass(\"k-state-disabled\");\n                        }\n                    });\n            });\n        },\n        addRow() {\n            let data = {\n                id: itemLinePrefix + uuid.v1(),\n                item: {name: \"\"},\n                qty: 0,\n                serial: \"\",\n                uom: {},\n                batch: {},\n                expirationDate: \"\",\n            };\n            let ds = this.$refs.dataSource.kendoWidget(),\n                total = ds.total();\n            ds.insert(total, data);\n        },\n        async onloadWarehouse() {\n            await warehouseHandler.getWarehouseSettingAll().then(async (res) => {\n                this.fWarehouses = res;\n                if (this.fWarehouses.length > 1) {\n                    this.transferOrder.fWarehouse = this.fWarehouses[0];\n                    this.tWarehouses = this.fWarehouses.filter(p => p.id !== this.transferOrder.fWarehouse.id)\n                    if (this.tWarehouses.length > 0) {\n                        this.transferOrder.tWarehouse = this.tWarehouses[0];\n                    }\n                } else if (this.fWarehouses.length > 0) {\n                    this.transferOrder.fWarehouse = this.fWarehouses[0];\n                }\n\n            });\n        },\n        async loadPrefix() {\n            this.showLoading = true;\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    prefixHandler.get(\"transfer order\").then((res) => {\n                        if (res.data.statusCode === 200) {\n                            // this.showLoading = false\n                            this.transactionTypes = res.data.data;\n                            if (this.transactionTypes.length > 0) {\n                                this.transferOrder.transactionType = this.transactionTypes[0];\n                                if (this.$route.params.id === undefined) {\n                                    this.generateNumber();\n                                }\n                            }\n                        }\n                    });\n                }, 300);\n            });\n            await this.onloadWarehouse();\n            this.showLoading = false;\n        },\n        generateNumber() {\n            let data = {\n                abbr: this.transferOrder.transactionType.abbr,\n                structure: this.transferOrder.transactionType.structure,\n                transactionDate: this.transferOrder.date,\n                sequcencing: this.transferOrder.transactionType.sequcencing,\n                type: \"Transfer Order\",\n                entity: 3,\n            };\n            this.transferOrder.abbr = data.abbr;\n            this.transferOrder.structure = data.structure;\n            this.transferOrder.sequcencing = data.sequcencing;\n            this.transferOrder.type = data.type;\n            this.transferOrder.transactionDate = data.transactionDate;\n            billingHandler\n                .lastNumber(data)\n                .then((response) => {\n                    if (response.data.statusCode === 200) {\n                        const res = response.data.data;\n                        const lastNumber = this.zeroPad(\n                            parseInt(res.lastNumber),\n                            this.transferOrder.transactionType.format\n                        );\n                        this.transferOrder.number =\n                            res.suffix +\n                            this.transferOrder.transactionType.numberSeparator +\n                            lastNumber;\n                        this.transferOrder.lastNumber = res.suffix + lastNumber;\n                        window.console.log(this.receiptOrder.number, \"bom\");\n                    }\n                })\n                .catch((e) => {\n                    window.console.log(e);\n                });\n        },\n        zeroPad(num, places) {\n            return String(num).padStart(places, \"0\");\n        },\n        suffix(transactionDate) {\n            return kendo.toString(new Date(transactionDate), `yymm`);\n        },\n        async getBalanceWarehouse(id) {\n            const data = {\n                itmId: id,\n                date: this.transferOrder.date ? this.transferOrder.date : new Date(),\n                whId: this.transferOrder.fWarehouse\n                    ? this.transferOrder.fWarehouse.id\n                    : \"\",\n            };\n            await warehouseHandler.getBalance(data).then((res) => {\n                this.balanceWarehouse = res[0];\n                window.console.log(this.balanceWarehouse, \"balance warehouse\");\n            });\n        },\n        async getDataSource() {\n            let ds = this.$refs.dataSource.kendoWidget();\n            let dataRow = ds.data();\n            this.itemLines = [];\n\n            dataRow.forEach((i) => {\n                window.console.log(i, \"item\");\n                this.itemLines.push({\n                    id: i.id,\n                    item: i.item,\n                    qoh: i.qoh,\n                    uom: i.uom,\n                    qty: i.qty\n                });\n            });\n        },\n        savePrint() {\n        },\n        cancel() {\n            this.itemLines = []\n            this.itemLinesS = []\n            this.itemLinesOldS = []\n            this.itemLinesBatch = []\n            this.itemLinesOldBatch = []\n            this.batchs = []\n            this.serials = []\n            this.itemBatch = {}\n            this.amtBatch = 0\n            this.qtyReceived = 0\n            this.totalBatch = 0\n            this.qtyDelivery = 0\n            this.qtySerial = 0\n            this.transferOrder = transferOrder;\n            window.history.go(-1);\n        },\n        async saveNew() {\n            this.showLoading = true;\n            await this.getDataSource();\n            this.transferOrder.itemLines = this.itemLines;\n            this.transferOrder.itemLinesSerial = this.itemLinesS;\n            this.transferOrder.itemLinesBatch = this.itemLinesBatch;\n            this.transferOrder.itemLinesOldSerial = this.itemLinesOldS;\n            this.transferOrder.itemLinesOldBatch = this.itemLinesOldBatch;\n            window.console.log(this.transferOrder, '123')\n            transferOrderHandler.save(this.transferOrder).then((res) => {\n                window.console.log(res);\n                this.isClose = false\n                this.showLoading = false;\n                this.cancel();\n            });\n        },\n        saveClose() {\n        },\n        errorMessage() {\n        },\n        hide_smallsitebar() {\n            if (!this.isHideBar) {\n                // this.col_expand = 12\n                // this.col_hide = 0\n                this.isHideBar = true;\n            } else {\n                // this.col_expand = 9\n                // this.col_hide = 3\n                this.isHideBar = false;\n            }\n        },\n    },\n    watch: {\n        // call again the method if the route changes\n    },\n    created() {\n        // fetch the data when the view is created and the data is\n        // already being observed\n        // this.loadObj()\n    },\n    async mounted() {\n        this.addRow();\n        await this.loadPrefix();\n    },\n};\n</script>\n\n<style scoped>\n.function_wrapper {\n    box-shadow: none !important;\n}\n\n.v-application--is-ltr .v-text-field .v-input__append-inner {\n    margin-top: 0 !important;\n}\n\n.v-input__slot {\n    background-color: #fff !important;\n}\n\n.function_content .label {\n    margin-bottom: 10px;\n    display: inline-block;\n}\n\n.border_radius10 {\n    border-radius: 10px !important;\n    background-color: #f2f2f2;\n}\n\n.pa-3.v-card h4 {\n    font-size: 18px;\n    color: #333;\n}\n\n.pa-3.v-card p {\n    font-size: 12px;\n    color: #b5b5b5;\n}\n\n.custom_grid table th:last-child {\n    text-align: right !important;\n}\n\n@media (min-width: 1264px) {\n    .container {\n        /* max-width: 1185px; */\n        max-width: 1080px !important;\n    }\n}\n\n@media (max-width: 576px) {\n    .pt-6.col-sm-5.col-12 {\n        padding-top: 0 !important;\n    }\n\n    .code_text {\n        width: 100%;\n    }\n\n    .phone_no_pt {\n        padding-top: 0 !important;\n    }\n\n    .select_template,\n    .save_option {\n        margin-bottom: 10px;\n    }\n}\n\n.hide_small_bar_class {\n    max-width: 0;\n    transition: 0.5s ease-in;\n    flex: 0 0 0;\n}\n\n.hide_big_bar_class {\n    max-width: 100%;\n    transition: 0.5s ease-in;\n    flex: 0 0 100%;\n}\n\n.info_add {\n    background-color: #ffffff;\n}\n\n.small_sidebar {\n    height: 96%;\n    position: relative;\n    padding: 12px;\n    background-color: #edf1f5;\n}\n\n.iconArrow {\n    right: -35px;\n    position: absolute;\n    bottom: -10px;\n}\n\n.iconArrowHide {\n    position: absolute;\n    right: -7px;\n    bottom: -10px;\n}\n\n.color_grey {\n    color: #808080;\n}\n\n.card_green {\n    min-height: 70px;\n    background-color: #00b050 !important;\n    color: #ffffff;\n}\n\n.lb_bold {\n    font-size: 12px;\n}\n\n.detial_smallside_p {\n    position: absolute;\n    bottom: 10px;\n}\n\n.card_background {\n    background-color: #edf1f5;\n    min-height: 120px;\n}\n\n.deposite_input {\n    width: 100px;\n}\n\n.btn_save_draft {\n    color: #ffffff;\n    background-color: #00b0f0 !important;\n    text-transform: capitalize;\n}\n\n.save_option {\n    background-color: #203864 !important;\n}\n\n.btn_add_small {\n    height: 27px !important;\n    min-width: 25px !important;\n    font-size: 10px;\n    padding: 0 22px !important;\n    background-color: #00b050 !important;\n    color: #ffffff;\n    border-radius: 0 !important;\n}\n\n.list_site_inv {\n    background-color: #92d050;\n    color: #ffffff;\n    font-size: 12px;\n}\n\n.list_site_exp {\n    background-color: #c5e0b4;\n    color: #000000;\n    font-size: 12px;\n    line-height: 16px;\n    min-height: 40px;\n}\n\n.checkbox_inv {\n    padding: 2px;\n    margin-top: 3px;\n    margin-right: 2px;\n}\n\n.exp_select {\n    font-size: 12px !important;\n}\n\n.v-data-table__wrapper td {\n    border-bottom: 1px solid #808080;\n    border-top: 1px solid #808080;\n}\n</style>\n"]}]}