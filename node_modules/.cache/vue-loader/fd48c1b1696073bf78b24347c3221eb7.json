{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/compliance/monthly_tax/new_tax_return/newTaxReturn.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/compliance/monthly_tax/new_tax_return/newTaxReturn.vue","mtime":1638499443168},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBMb2FkaW5nTWUgZnJvbSAnQC9jb21wb25lbnRzL0xvYWRpbmcnCmltcG9ydCBNb250aGx5UmV0dXJuIGZyb20gIkAvc2NyaXB0cy9jb21wbGlhbmNlL21vZGVsL01vbnRobHlSZXR1cm4iOwppbXBvcnQge2kxOG59IGZyb20gIkAvaTE4biI7CmltcG9ydCBrZW5kbyBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tdWknCmltcG9ydCB7dXVpZH0gZnJvbSAndnVlLXV1aWQnCmltcG9ydCB0YXhTZXR0aW5nSGFuZGxlciBmcm9tICJAL3NjcmlwdHMvdGF4U2V0dGluZ0hhbmRsZXIiOwoKY29uc3QgbW9udGhseVJldHVybkhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvY29tcGxpYW5jZS9oYW5kbGVyL21vbnRobHlSZXR1cm5IYW5kbGVyIikKY29uc3Qgc2FsZUhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvY29tcGxpYW5jZS9oYW5kbGVyL3NhbGVIYW5kbGVyIikKY29uc3QgcHVyY2hhc2VIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2NvbXBsaWFuY2UvaGFuZGxlci9wdXJjaGFzZUhhbmRsZXIiKQpjb25zdCBzYWxhcnlIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2NvbXBsaWFuY2UvaGFuZGxlci9zYWxhcnlIYW5kbGVyIikKY29uc3Qgd2l0aGhvbGRpbmdIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2NvbXBsaWFuY2UvaGFuZGxlci93aXRoaG9sZGluZ1RheEhhbmRsZXIiKQpjb25zdCBtb250aGx5UmV0dXJuID0gbmV3IE1vbnRobHlSZXR1cm4oe30pCmNvbnN0IHByZWZpeEhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvY29tcGxpYW5jZS9oYW5kbGVyL3ByZWZpeEhhbmRsZXIiKQpjb25zdCBzdW1tYXJ5SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9jb21wbGlhbmNlL2hhbmRsZXIvc3VtbWFyeUhhbmRsZXIiKQpjb25zdCBjdXJyZW5jeUhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvY3VycmVuY3kvaGFuZGxlci9jdXJyZW5jeUhhbmRsZXIiKQpjb25zdCBhcGlVcmwgPSByZXF1aXJlKCdAL2FwaVVybCcpCi8vIGNvbnN0IHRheFNldHRpbmcgPSByZXF1aXJlKCdAL3N0b3JlL3RheFNldHRpbmcnKTsKY29uc3QgY3VycmVuY3lUeXBlID0gewogICAgVEFYX0VYQ0hBTkdFX0NVUlJFTkNZOiAndGF4LWMnLAp9Ci8vIGNvbnN0IGF4aW9zID0gcmVxdWlyZSgnYXhpb3MnKQpleHBvcnQgZGVmYXVsdCB7CiAgICBuYW1lOiAiVGF4UmV0dXJuIiwKICAgIGNvbXBvbmVudHM6IHsKICAgICAgICAnTG9hZGluZ01lJzogTG9hZGluZ01lLAogICAgICAgIC8vICdtb250aC1waWNrZXInOiAoKSA9PiBpbXBvcnQoJ0AvY29tcG9uZW50cy9jdXN0b21fdGVtcGxhdGVzL01vbnRoUGlja2VyJyksCiAgICAgICAgSW5wdXRUYWI6ICgpID0+IGltcG9ydCgnLi9pbnB1dC9JbnB1dFRhYicpLAogICAgICAgIFJldmlld1RhYjogKCkgPT4gaW1wb3J0KCcuL3Jldmlldy9SZXZpZXdUYWInKSwKICAgICAgICBDb25maXJtOiAoKSA9PiBpbXBvcnQoJy4vY29uZmlybS9Db25maXJtVGFiJyksCiAgICAgICAgRmluYWxpemU6ICgpID0+IGltcG9ydCgnLi9maW5hbGl6ZS9GaW5hbGl6ZScpCiAgICB9LAogICAgZGF0YTogKCkgPT4gKHsKICAgICAgICBtZW51OiBmYWxzZSwKICAgICAgICB0ZW1wbGF0ZXM6IFtdLAogICAgICAgIG1vbnRoOiAnJywKICAgICAgICBzaG93TG9hZGluZzogZmFsc2UsCiAgICAgICAgdmFsaWQ6ICcnLAogICAgICAgIGJpbGxfZGF0ZTogIiIsCiAgICAgICAgam91cm5hbF9kYXRlOiAnJywKICAgICAgICBzdGVwczogMSwKICAgICAgICByZWFjaFRvcFN0ZXA6IDAsCiAgICAgICAgY2hlY2s6IGZhbHNlLAogICAgICAgIHNhdmVfbmV4dDogJ3NhdmVfbmV4dCcsCiAgICAgICAgYWN0aXZlQ29sb3IxOiAicHJpbWFyeSIsCiAgICAgICAgYWN0aXZlQ29sb3IyOiAidGhpcmQiLAogICAgICAgIGFjdGl2ZUNvbG9yMzogInRoaXJkIiwKICAgICAgICBhY3RpdmVDb2xvcjQ6ICJ0aGlyZCIsCiAgICAgICAgaXNGaW5hbDogZmFsc2UsCiAgICAgICAgLy8gdGhpcmQKICAgICAgICBjaGVjazE6IGZhbHNlLAogICAgICAgIGNoZWNrMjogZmFsc2UsCiAgICAgICAgY2hlY2szOiBmYWxzZSwKICAgICAgICBwYXlyb2xsX2lkOiAnJywKICAgICAgICBsb2FkUGF5cm9sbHM6IFtdLAogICAgICAgIC8vIHN0YXJ0X3JldHVybjogZmFsc2UsCgogICAgICAgIGlzQ3JlYXRlOiBmYWxzZSwKICAgICAgICB0cmFuc2FjdGlvblR5cGVzOiBbXSwKICAgICAgICBtb250aGx5UmV0dXJuOiBtb250aGx5UmV0dXJuLAogICAgICAgIC8vIGlzR2V0QW1vdW50OiBmYWxzZSwKICAgICAgICBBbGVydFZhbGlkYXRlMjogZmFsc2UsCgogICAgICAgIGN1cnJlbmN5OiB7fSwKICAgICAgICBzYWxlczogW10sCiAgICAgICAgcHVyY2hhc2VzOiBbXSwKICAgICAgICBzYWxhcmllczogW10sCiAgICAgICAgd2l0aGhvbGRpbmdzOiBbXSwKICAgICAgICBhbW91bnRTYWxlOiAwLAogICAgICAgIGFtb3VudFNhbGVFeGN1bDogMCwKICAgICAgICBhbW91bnRUb3RhbFB1cmNoYXNlOiAwLAogICAgICAgIGFtb3VudFB1cmNoYXNlRXhjdWw6IDAsCiAgICAgICAgYW1vdW50V2h0OiAwLAogICAgICAgIGFtb3VudFNhbGFyeTogMCwKICAgICAgICBhbW91bnRCZW5lZml0OiAwLAogICAgICAgIG90aGVyQW1vdW50OiAwLAogICAgICAgIHRvdGFsQW1vdW50UGFpZDogMCwKICAgICAgICBzdW1tYXJ5OiB7fSwKICAgICAgICBpc1JvdXRlOiBmYWxzZSwKICAgICAgICBiYWxhbmNlVmF0OiB7fSwKICAgICAgICBiYWxhbmNlUHBpOiB7fSwKICAgICAgICBkYXRlU2FsZTogJycsCiAgICAgICAgZGF0ZVB1cmNoYXNlOiAnJywKICAgICAgICBkYXRlV2h0OiAnJywKICAgICAgICBkYXRlU2FsYXJ5OiAnJywKICAgICAgICBzdGF0dXNNcjogZmFsc2UsCiAgICAgICAgam91cm5hbFN1bW1hcnk6IFtdLAogICAgICAgIGxpc3RUYXhzOiBbXQogICAgfSksCiAgICBjb21wdXRlZDogewogICAgICAgIHN0YXJ0X3JldHVybigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgIT09ICcnICYmIHRoaXMuJHJvdXRlLnBhcmFtcy5pZCAhPT0gJyc7CiAgICAgICAgfSwKICAgICAgICBpZCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHJvdXRlLnBhcmFtcy5pZAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIERhdGVTdGF0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHJvdXRlLnBhcmFtcy5pZCAhPT0gdW5kZWZpbmVkIHx8IHRoaXMuJHJvdXRlLnF1ZXJ5LnR5cGUgPT09ICdlZGl0JyB8fCB0aGlzLiRyb3V0ZS5xdWVyeS50eXBlID09PSAndmlldyc7CiAgICAgICAgfSwKICAgICAgICAvLyBsaXN0VGF4czogewogICAgICAgIC8vICAgICBzZXQobGlzdFRheCkgewogICAgICAgIC8vICAgICAgICAgdGF4U2V0dGluZy5kZWZhdWx0LmNvbW1pdCgic2V0TGlzdFRheCIsIGxpc3RUYXgpCiAgICAgICAgLy8gICAgIH0sCiAgICAgICAgLy8gICAgIGdldCgpIHsKICAgICAgICAvLyAgICAgICAgIHJldHVybiB0YXhTZXR0aW5nLmRlZmF1bHQuc3RhdGUubGlzdFRheAogICAgICAgIC8vICAgICB9CiAgICAgICAgLy8gfSwKICAgIH0sCiAgICB3YXRjaDogewogICAgICAgICdpZCc6ICdpbml0RGF0YScsCiAgICB9LAogICAgYmVmb3JlUm91dGVMZWF2ZSAodG8sIGZyb20gLCBuZXh0KSB7CiAgICAgICAgaWYgKHRvLm5hbWUgPT09ICdBZGQgUHVyY2hhc2UnIHx8IHRvLm5hbWUgPT09ICdBZGQgU2FsZScgfHwgdG8ubmFtZSA9PT0gJ0FkZCBXaXRoaG9sZGluZyBUYXgnKSB7CiAgICAgICAgICAgIG5leHQoKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IHNhbGVzID0gdGhpcy4kc3RvcmUuc3RhdGUuY29tcGxpYW5jZS5zYWxlCiAgICAgICAgICAgIGlmIChzYWxlcy5sZW5ndGggPiAwICYmIHNhbGVzLmZpbHRlcihwID0+IHAuaXNTYXZlID09PSBmYWxzZSkpIHsKICAgICAgICAgICAgICAgIHRoaXMuJHN3YWwoewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiBpMThuLnQoJ21zZ190aXRsZV93YXJuaW5nJyksCiAgICAgICAgICAgICAgICAgICAgdGV4dDogaTE4bi50KCdtc2dfbGVhdmUnKSwKICAgICAgICAgICAgICAgICAgICBpY29uOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogaTE4bi50KCdmb3JjZV9sZWF2ZScpLAogICAgICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiM0ZDQ4NDgiLAogICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI0VEMUEzQSIsCiAgICAgICAgICAgICAgICAgICAgc2hvd0RlbnlCdXR0b246IHRydWUsCiAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IGkxOG4udCgnbGVhdmUnKSwKICAgICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHNob3dDbG9zZUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICAgIH0pLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmlzQ29uZmlybWVkIHx8IHJlcy5pc0Rpc21pc3NlZCAmJiByZXMuZGlzbWlzcyA9PT0gJ2NhbmNlbCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dCgpCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXIoKQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFtb3VudFNhbGUgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYW1vdW50U2FsZUV4Y3VsID0gMAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFtb3VudFB1cmNoYXNlID0gMAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFtb3VudFdodCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vdGhlckFtb3VudCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50b3RhbEFtb3VudFBhaWQgPSAwCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dChmYWxzZSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlcywgJ2Rpc2NhcmQnKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vbnRobHlSZXR1cm4ucHJvZ3Jlc3MgPT09ICcnICYmIHRoaXMuaXNSb3V0ZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJHN3YWwoewogICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogaTE4bi50KCdtc2dfdGl0bGVfd2FybmluZycpLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBpMThuLnQoJ21zZ19kaXNjYXJkJyksCiAgICAgICAgICAgICAgICAgICAgICAgIGljb246ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogaTE4bi50KCdjYW5jZWwnKSwKICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzRkNDg0OCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI0VEMUEzQSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBpMThuLnQoJ2Rpc2NhcmQnKSwKICAgICAgICAgICAgICAgICAgICB9KS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuaXNDb25maXJtZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhcigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFtb3VudFNhbGUgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFtb3VudFNhbGVFeGN1bCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYW1vdW50UHVyY2hhc2UgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFtb3VudFdodCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3RoZXJBbW91bnQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRvdGFsQW1vdW50UGFpZCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHQoZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBuZXh0KCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0sCiAgICBtZXRob2RzOiB7CiAgICAgICAgYXN5bmMgY2hlY2tNb250aGx5UmV0dXJuKCkgewogICAgICAgICAgICBtb250aGx5UmV0dXJuSGFuZGxlci5nZXRCeU1vbnRoKHRoaXMubW9udGhseVJldHVybi5tb250aE9mKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2cocmVzLCAnZ2V0IG1vbnRoMTIzJykKICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5kYXRhID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0dXNNciA9IHRydWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIGdldEZpbmFsUHVyY2hhc2UocHVyY2hhc2UpIHsKICAgICAgICAgICAgaWYgKHRoaXMucHVyY2hhc2VzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZXMgPSBwdXJjaGFzZQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBnZXRCYWxhbmNlVmF0KGJhbGFuY2UpIHsKICAgICAgICAgICAgdGhpcy5iYWxhbmNlVmF0ID0gYmFsYW5jZQogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2codGhpcy5iYWxhbmNlVmF0LmNyZWRpdCwgdGhpcy5iYWxhbmNlVmF0LnBheW1lbnQsICdiYWxhbmNlVmF0JykKICAgICAgICB9LAogICAgICAgIGdldEJhbGFuY2VQcGkoYmFsYW5jZSkgewogICAgICAgICAgICB0aGlzLmJhbGFuY2VQcGkgPSBiYWxhbmNlCiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLmJhbGFuY2VQcGksICdiYWxhbmNlUHBpJykKICAgICAgICB9LAogICAgICAgIGdldFN1bW1hcnkoc3VtbWFyeSkgewogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coJ25ldyB0YXggdGFiIHN1bW1hcnknLCBzdW1tYXJ5KQogICAgICAgICAgICB0aGlzLnN1bW1hcnkgPSBzdW1tYXJ5CiAgICAgICAgfSwKICAgICAgICBnZXREYXRlV2h0KGRhdGUpIHsKICAgICAgICAgICAgdGhpcy5kYXRlV2h0ID0gZGF0ZQogICAgICAgIH0sCiAgICAgICAgZ2V0U2FsYXJ5KHNhbGFyeSkgewogICAgICAgICAgICB0aGlzLnNhbGFyaWVzID0gc2FsYXJ5CiAgICAgICAgfSwKICAgICAgICBnZXREYXRlUHVyY2hhc2UoZGF0ZSkgewogICAgICAgICAgICB0aGlzLmRhdGVQdXJjaGFzZSA9IGRhdGUKICAgICAgICB9LAogICAgICAgIGdldERhdGVTYWxlKGRhdGUpIHsKICAgICAgICAgICAgdGhpcy5kYXRlU2FsZSA9IGRhdGUKICAgICAgICB9LAogICAgICAgIGdldFRvdGFsQW1vdW50UGFpZChhbW91bnQpIHsKICAgICAgICAgICAgdGhpcy50b3RhbEFtb3VudFBhaWQgPSBhbW91bnQKICAgICAgICB9LAogICAgICAgIGdldE90aGVyQW1vdW50KGFtb3VudCkgewogICAgICAgICAgICB0aGlzLm90aGVyQW1vdW50ID0gYW1vdW50CiAgICAgICAgfSwKICAgICAgICBnZXRBbW91bnRTYWxlRXhjdWwoc2FsZUV4Y3VsKSB7CiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygnbmV3IHRheCB0YWIgc2FsZSBleGN1bCcsIHNhbGVFeGN1bCkKICAgICAgICAgICAgdGhpcy5hbW91bnRTYWxlRXhjdWwgPSBzYWxlRXhjdWwKICAgICAgICB9LAogICAgICAgIGdldFdpdGhob2xkaW5nKHdpdGhob2xkaW5nKSB7CiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygnbmV3IHRheCB0YWIgd2l0aGhvbGRpbmcnLCB3aXRoaG9sZGluZykKICAgICAgICAgICAgdGhpcy53aXRoaG9sZGluZ3MgPSB3aXRoaG9sZGluZwogICAgICAgIH0sCiAgICAgICAgZ2V0QW1vdW50U2FsYXJ5KGFtb3VudCkgewogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coJ25ldyB0YXggdGFiIHNhbGFyeScsIGFtb3VudCkKICAgICAgICAgICAgdGhpcy5hbW91bnRTYWxhcnkgPSBhbW91bnQKICAgICAgICB9LAogICAgICAgIGdldEFtb3VudFRheChhbW91bnQpIHsKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCduZXcgdGF4IHRhYiBiZW5lZml0JywgYW1vdW50KQogICAgICAgICAgICB0aGlzLmFtb3VudEJlbmVmaXQgPSBhbW91bnQKICAgICAgICB9LAogICAgICAgIGdldElucHV0UHVyY2hhc2UocHVyY2hhc2UpIHsKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCduZXcgdGF4IHRhYiBwdXJjaGFzZScsIHB1cmNoYXNlKQogICAgICAgICAgICB0aGlzLnB1cmNoYXNlcyA9IHB1cmNoYXNlCiAgICAgICAgfSwKICAgICAgICBnZXRJbnB1dFNhbGUoc2FsZSkgewogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coJ25ldyB0YXggdGFiIHNhbGUnLCBzYWxlKQogICAgICAgICAgICB0aGlzLnNhbGVzID0gc2FsZQogICAgICAgIH0sCiAgICAgICAgZ2V0QW1vdW50V2h0KGFtb3VudCkgewogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coJ25ldyB0YXggdGFiIHdodCcsIGFtb3VudCkKICAgICAgICAgICAgdGhpcy5hbW91bnRXaHQgPSBhbW91bnQKICAgICAgICB9LAogICAgICAgIGdldFN0ZXAoc3RlcCkgewogICAgICAgICAgICB0aGlzLnN0ZXBzID0gc3RlcAogICAgICAgICAgICBpZiAodGhpcy5yZWFjaFRvcFN0ZXAgPD0gdGhpcy5zdGVwcykgewogICAgICAgICAgICAgICAgdGhpcy5yZWFjaFRvcFN0ZXAgPSB0aGlzLnN0ZXBzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5zdGVwc0NvbmRpdGlvbih0aGlzLnN0ZXBzKQogICAgICAgIH0sCiAgICAgICAgZ2V0VG90YWxBbW91bnRQdXJjaGFzZShhbW91bnQpIHsKICAgICAgICAgICAgdGhpcy5hbW91bnRUb3RhbFB1cmNoYXNlID0gYW1vdW50CiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLmFtb3VudFB1cmNoYXNlLCAnTmV3IFRheCBUYWIgUHVyY2hhc2UnKQogICAgICAgIH0sCiAgICAgICAgZ2V0QW1vdW50UHVyY2hhc2VFeGN1bChhbW91bnQpIHsKICAgICAgICAgICAgdGhpcy5hbW91bnRQdXJjaGFzZUV4Y3VsID0gYW1vdW50CiAgICAgICAgfSwKICAgICAgICBnZXRBbW91bnRTYWxlKGFtb3VudCkgewogICAgICAgICAgICB0aGlzLmFtb3VudFNhbGUgPSBhbW91bnQKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHRoaXMuYW1vdW50U2FsZSwgJ05ldyBUYXggVGFiIFNhbGUnKQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgaW5pdERhdGEoKSB7CiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlCiAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgIT09IHVuZGVmaW5lZCAmJiB0aGlzLiRyb3V0ZS5wYXJhbXMubW9udGhseVJldHVybiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLm9uTG9hZE9uZVJldHVybigpCiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2codGhpcy5zdGVwcykKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMubW9udGhseVJldHVybiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4gPSB0aGlzLiRyb3V0ZS5wYXJhbXMubW9udGhseVJldHVybgogICAgICAgICAgICAgICAgaWYgKHRoaXMubW9udGhseVJldHVybi5zdGF0dXMuaWQgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdWaWV3IFRheCBSZXR1cm4nLAogICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAndmlld19tb250aGx5X3JldHVybi8nICsgdGhpcy5tb250aGx5UmV0dXJuLmlkLAogICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHtpZDogdGhpcy5tb250aGx5UmV0dXJuLmlkLCBtb250aGx5UmV0dXJuOiB0aGlzLm1vbnRobHlSZXR1cm59LAogICAgICAgICAgICAgICAgICAgICAgICBxdWVyeToge3R5cGU6ICd2aWV3J30KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHRoaXMubW9udGhseVJldHVybiwgJ2RhZmFzZGYzNCcpCiAgICAgICAgICAgICAgICB0aGlzLmluaXRMb2NhbFN0b3JhZ2UodGhpcy5tb250aGx5UmV0dXJuLmFiYnIsIHRoaXMubW9udGhseVJldHVybi5udW1iZXIpCiAgICAgICAgICAgICAgICBjb25zdCBzdGVwID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJlN0ZXAnKSkKICAgICAgICAgICAgICAgIGxldCBzdGVwcyA9IDEKICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vbnRobHlSZXR1cm4uc3RlcCAhPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICBzdGVwcyA9IHRoaXMubW9udGhseVJldHVybi5zdGVwCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc3RlcCA+IDApIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coJ3N0ZXAxMicsIHN0ZXApCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubW9udGhseVJldHVybi5zdGVwID4gc3RlcCkgewogICAgICAgICAgICAgICAgICAgICAgICBzdGVwcyA9IHRoaXMubW9udGhseVJldHVybi5zdGVwCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RlcHMgPSBzdGVwCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5zdGVwcyA9IHN0ZXBzCiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZWFjaFRvcFN0ZXAgPD0gdGhpcy5zdGVwcykgewogICAgICAgICAgICAgICAgICAgIHRoaXMucmVhY2hUb3BTdGVwID0gdGhpcy5zdGVwcwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5zdGVwc0NvbmRpdGlvbih0aGlzLnN0ZXBzKQogICAgICAgICAgICAgICAgLy8gdGhpcy5zdGFydF9yZXR1cm4gPSB0cnVlCiAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLnN0ZXBzKQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5jbGVhcigpCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGNsZWFyKCkgewogICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4gPSBuZXcgTW9udGhseVJldHVybih7fSkKICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlCiAgICAgICAgfSwKICAgICAgICBpbml0TG9jYWxTdG9yYWdlKGFiYnIsIG51bWJlcikgewogICAgICAgICAgICBjb25zdCBzYWxlID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShhYmJyICsgbnVtYmVyICsgJyZTYWxlJykpCiAgICAgICAgICAgIGNvbnN0IHB1cmNoYXNlID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShhYmJyICsgbnVtYmVyICsgJyZQdXJjaGFzZScpKQogICAgICAgICAgICBjb25zdCB3aXRoaG9sZGluZyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oYWJiciArIG51bWJlciArICcmV2l0aGhvbGRpbmcnKSkKICAgICAgICAgICAgY29uc3Qgc2FsYXJ5ID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShhYmJyICsgbnVtYmVyICsgJyZTYWxhcnknKSkKICAgICAgICAgICAgY29uc3Qgc3RlcCA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oYWJiciArIG51bWJlciArICcmU3RlcCcpKQogICAgICAgICAgICBpZiAoc2FsZSA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYWJiciArIG51bWJlciArICcmU2FsZScsIEpTT04uc3RyaW5naWZ5KFtdKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocHVyY2hhc2UgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGFiYnIgKyBudW1iZXIgKyAnJlB1cmNoYXNlJywgSlNPTi5zdHJpbmdpZnkoW10pKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh3aXRoaG9sZGluZyA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYWJiciArIG51bWJlciArICcmV2l0aGhvbGRpbmcnLCBKU09OLnN0cmluZ2lmeShbXSkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHNhbGFyeSA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYWJiciArIG51bWJlciArICcmU2FsYXJ5JywgSlNPTi5zdHJpbmdpZnkoW10pKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzdGVwID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShhYmJyICsgbnVtYmVyICsgJyZTdGVwJywgSlNPTi5zdHJpbmdpZnkoMSkpCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIG9uQ2xvc2UoKSB7CiAgICAgICAgICAgIGNvbnN0IHNhbGVzID0gdGhpcy4kc3RvcmUuc3RhdGUuY29tcGxpYW5jZS5zYWxlCiAgICAgICAgICAgIGNvbnN0IHB1cmNoYXNlcyA9IHRoaXMuJHN0b3JlLnN0YXRlLmNvbXBsaWFuY2UucHVyY2hhc2UKICAgICAgICAgICAgY29uc3Qgd2l0aGhvbGRpbmcgPSB0aGlzLiRzdG9yZS5zdGF0ZS5jb21wbGlhbmNlLndpdGhob2xkaW5nCiAgICAgICAgICAgIGlmIChzYWxlcy5sZW5ndGggPiAwICYmIHNhbGVzLmZpbHRlcihwID0+IHAuaXNTYXZlID09PSBmYWxzZSkgfHwgcHVyY2hhc2VzLmxlbmd0aCA+IDAgJiYgcHVyY2hhc2VzLmZpbHRlcihwID0+IHAuaXNTYXZlID09PSBmYWxzZSkgfHwgd2l0aGhvbGRpbmcubGVuZ3RoID4gMCAmJiB3aXRoaG9sZGluZy5maWx0ZXIocCA9PiBwLmlzU2F2ZSA9PT0gZmFsc2UpKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRzd2FsKHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogaTE4bi50KCdtc2dfdGl0bGVfd2FybmluZycpLAogICAgICAgICAgICAgICAgICAgIHRleHQ6IGkxOG4udCgnbXNnX2xlYXZlJyksCiAgICAgICAgICAgICAgICAgICAgaWNvbjogIndhcm5pbmciLAogICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IGkxOG4udCgnZm9yY2VfbGVhdmUnKSwKICAgICAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjNGQ0ODQ4IiwKICAgICAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNFRDFBM0EiLAogICAgICAgICAgICAgICAgICAgIHNob3dEZW55QnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBpMThuLnQoJ2xlYXZlJyksCiAgICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzaG93Q2xvc2VCdXR0b246IHRydWUsCiAgICAgICAgICAgICAgICB9KS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5pc0NvbmZpcm1lZCB8fCByZXMuaXNEaXNtaXNzZWQgJiYgcmVzLmRpc21pc3MgPT09ICdjYW5jZWwnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYW4oKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2cocmVzLCAnZGlzY2FyZCcpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHRoaXMubW9udGhseVJldHVybi5wcm9ncmVzcyA9PT0gJycgJiYgdGhpcy5pc1JvdXRlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc3dhbCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBpMThuLnQoJ21zZ190aXRsZV93YXJuaW5nJyksCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGkxOG4udCgnbXNnX2Rpc2NhcmQnKSwKICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjogIndhcm5pbmciLAogICAgICAgICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBpMThuLnQoJ2NhbmNlbCcpLAogICAgICAgICAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjNGQ0ODQ4IiwKICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjRUQxQTNBIiwKICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IGkxOG4udCgnZGlzY2FyZCcpLAogICAgICAgICAgICAgICAgICAgIH0pLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5pc0NvbmZpcm1lZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhbigpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBjb25zdCBzYWxlID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJlNhbGUnKSkKICAgICAgICAgICAgLy8gY29uc3QgcHVyY2hhc2UgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMubW9udGhseVJldHVybi5hYmJyICsgdGhpcy5tb250aGx5UmV0dXJuLm51bWJlciArICcmUHVyY2hhc2UnKSkKICAgICAgICAgICAgLy8gY29uc3Qgd2l0aGhvbGRpbmcgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMubW9udGhseVJldHVybi5hYmJyICsgdGhpcy5tb250aGx5UmV0dXJuLm51bWJlciArICcmV2l0aGhvbGRpbmcnKSkKICAgICAgICAgICAgLy8gY29uc3Qgc2FsYXJ5ID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJlNhbGFyeScpKQogICAgICAgICAgICAvLyBjb25zdCBzdGVwID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJlN0ZXAnKSkKICAgICAgICAgICAgLy8gaWYgKHNhbGUgPT09IG51bGwpIHsKICAgICAgICAgICAgLy8gICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMubW9udGhseVJldHVybi5hYmJyICsgdGhpcy5tb250aGx5UmV0dXJuLm51bWJlciArICcmU2FsZScsIEpTT04uc3RyaW5naWZ5KFtdKSkKICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAvLyBpZiAocHVyY2hhc2UgPT09IG51bGwpIHsKICAgICAgICAgICAgLy8gICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMubW9udGhseVJldHVybi5hYmJyICsgdGhpcy5tb250aGx5UmV0dXJuLm51bWJlciArICcmUHVyY2hhc2UnLCBKU09OLnN0cmluZ2lmeShbXSkpCiAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgLy8gaWYgKHdpdGhob2xkaW5nID09PSBudWxsKSB7CiAgICAgICAgICAgIC8vICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJldpdGhob2xkaW5nJywgSlNPTi5zdHJpbmdpZnkoW10pKQogICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIC8vIGlmIChzYWxhcnkgPT09IG51bGwpIHsKICAgICAgICAgICAgLy8gICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMubW9udGhseVJldHVybi5hYmJyICsgdGhpcy5tb250aGx5UmV0dXJuLm51bWJlciArICcmU2FsYXJ5JywgSlNPTi5zdHJpbmdpZnkoW10pKQogICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIC8vIGlmIChzdGVwID09PSBudWxsKSB7CiAgICAgICAgICAgIC8vICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJlN0ZXAnLCBKU09OLnN0cmluZ2lmeSgxKSkKICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAvLyBpZiAoc2FsZSAhPT0gbnVsbCB8fCBwdXJjaGFzZSAhPT0gbnVsbCB8fCB3aXRoaG9sZGluZyAhPT0gbnVsbCB8fCBzYWxhcnkgIT09IG51bGwpIHsKICAgICAgICAgICAgLy8gICAgIGlmIChzYWxlLmxlbmd0aCA+IDAgfHwgcHVyY2hhc2UubGVuZ3RoID4gMCB8fCB3aXRoaG9sZGluZy5sZW5ndGggPiAwIHx8IHNhbGFyeS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIC8vICAgICAgICAgdGhpcy4kc3dhbCh7CiAgICAgICAgICAgIC8vICAgICAgICAgICAgIHRpdGxlOiBpMThuLnQoJ21zZ190aXRsZV93YXJuaW5nJyksCiAgICAgICAgICAgIC8vICAgICAgICAgICAgIHRleHQ6IGkxOG4udCgnbXNnX2xlYXZlJyksCiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGljb246ICJ3YXJuaW5nIiwKICAgICAgICAgICAgLy8gICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogaTE4bi50KCdmb3JjZV9sZWF2ZScpLAogICAgICAgICAgICAvLyAgICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjNGQ0ODQ4IiwKICAgICAgICAgICAgLy8gICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjRUQxQTNBIiwKICAgICAgICAgICAgLy8gICAgICAgICAgICAgc2hvd0RlbnlCdXR0b246IHRydWUsCiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBpMThuLnQoJ2xlYXZlJyksCiAgICAgICAgICAgIC8vICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICAgIC8vICAgICAgICAgICAgIHNob3dDbG9zZUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgLy8gICAgICAgICB9KS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGlmIChyZXMuaXNDb25maXJtZWQpIHsKICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMubW9udGhseVJldHVybi5hYmJyICsgdGhpcy5tb250aGx5UmV0dXJuLm51bWJlciArICcmU3RlcCcsIHRoaXMuc3RlcHMpCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICB0aGlzLmNsZWFuKCkKICAgICAgICAgICAgLy8gICAgICAgICAgICAgfSBlbHNlIGlmIChyZXMuaXNEaXNtaXNzZWQgJiYgcmVzLmRpc21pc3MgPT09ICdjYW5jZWwnKSB7CiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJlNhbGUnKQogICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZQdXJjaGFzZScpCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJlNhbGFyeScpCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJldpdGhob2xkaW5nJykKICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKHRoaXMubW9udGhseVJldHVybi5hYmJyICsgdGhpcy5tb250aGx5UmV0dXJuLm51bWJlciArICcmU3RlcCcpCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICB0aGlzLmNsZWFuKCkKICAgICAgICAgICAgLy8gICAgICAgICAgICAgfQogICAgICAgICAgICAvLyAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2cocmVzLCAnZGlzY2FyZCcpCiAgICAgICAgICAgIC8vICAgICAgICAgfSkKICAgICAgICAgICAgLy8gICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vICAgICAgICAgaWYgKHRoaXMubW9udGhseVJldHVybi5wcm9ncmVzcyA9PT0gJycgJiYgdGhpcy5pc1JvdXRlKSB7CiAgICAgICAgICAgIC8vICAgICAgICAgICAgIHRoaXMuJHN3YWwoewogICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgdGl0bGU6IGkxOG4udCgnbXNnX3RpdGxlX3dhcm5pbmcnKSwKICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgIHRleHQ6IGkxOG4udCgnbXNnX2Rpc2NhcmQnKSwKICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgIGljb246ICJ3YXJuaW5nIiwKICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBpMThuLnQoJ2NhbmNlbCcpLAogICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzRkNDg0OCIsCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNFRDFBM0EiLAogICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IGkxOG4udCgnZGlzY2FyZCcpLAogICAgICAgICAgICAvLyAgICAgICAgICAgICB9KS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICBpZiAocmVzLmlzQ29uZmlybWVkKSB7CiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZTYWxlJykKICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJlB1cmNoYXNlJykKICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJlNhbGFyeScpCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZXaXRoaG9sZGluZycpCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZTdGVwJykKICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFuKCkKICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhyZXMsICdkaXNjYXJkJykKICAgICAgICAgICAgLy8gICAgICAgICAgICAgfSkKICAgICAgICAgICAgLy8gICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyAgICAgICAgICAgICB0aGlzLmNsZWFuKCkKICAgICAgICAgICAgLy8gICAgICAgICB9CiAgICAgICAgICAgIC8vICAgICB9CiAgICAgICAgICAgIC8vIH0KICAgICAgICB9LAogICAgICAgIGNsZWFuKCkgewogICAgICAgICAgICB0aGlzLmNsZWFyKCkKICAgICAgICAgICAgdGhpcy5hbW91bnRTYWxlID0gMAogICAgICAgICAgICB0aGlzLmFtb3VudFNhbGVFeGN1bCA9IDAKICAgICAgICAgICAgdGhpcy5hbW91bnRQdXJjaGFzZSA9IDAKICAgICAgICAgICAgdGhpcy5hbW91bnRXaHQgPSAwCiAgICAgICAgICAgIHRoaXMub3RoZXJBbW91bnQgPSAwCiAgICAgICAgICAgIHRoaXMudG90YWxBbW91bnRQYWlkID0gMAogICAgICAgICAgICAvLyB0aGlzLnN0YXJ0X3JldHVybiA9IGZhbHNlCiAgICAgICAgICAgIGlmICghdGhpcy5pc1JvdXRlKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlzUm91dGUgPSBmYWxzZQogICAgICAgICAgICAgICAgd2luZG93Lmhpc3RvcnkuZ28oLTEpCgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5pc1JvdXRlID0gZmFsc2UKICAgICAgICAgICAgICAgIHdpbmRvdy5oaXN0b3J5LmdvKC0xKQogICAgICAgICAgICAgICAgd2luZG93Lmhpc3RvcnkuZ28oLTEpCiAgICAgICAgICAgIH0KCiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkQ3VycmVuY3lEYXRhKHR5cGUpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCdyZXNvbHZlZCcpCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWUKICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUhhbmRsZXIubGlzdCh0eXBlKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coJ3Jlc3BvbnNlJywnJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSBjdXJyZW5jeVR5cGUuVEFYX0VYQ0hBTkdFX0NVUlJFTkNZKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW5jeSA9IHJlc3BvbnNlLmRhdGEuZGF0YVswXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMzAwKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgb25sb2FkQ3VycmVuY3koKSB7CiAgICAgICAgICAgIGNvbnN0IGRhdGUgPSB0aGlzLm1vbnRobHlSZXR1cm4ubW9udGhPZiArICctJyArICczMCcKICAgICAgICAgICAgY29uc3QgY29kZSA9ICdLSFInCiAgICAgICAgICAgIGN1cnJlbmN5SGFuZGxlci5nZXRMYXN0RXhjaGFuZ2VSYXRlVGF4QnlEYXRlKGRhdGUsIGNvZGUpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVuY3kgPSByZXMuZGF0YS5kYXRhWzBdCiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2cocmVzLCAnY3VycmVuY3knKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgb25Mb2FkT25lUmV0dXJuKCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoJ3Jlc29sdmVkJyk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaWQgPSB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQKICAgICAgICAgICAgICAgICAgICBtb250aGx5UmV0dXJuSGFuZGxlci5nZXRPbmUoaWQpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlcywgJ2RhdGEgbG9hZCBtb250aGx5IHJldHVybicpCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9udGhseVJldHVybiA9IHJlcy5kYXRhLmRhdGFbMF0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubW9udGhseVJldHVybi5zdGF0dXMuaWQgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnVmlldyBUYXggUmV0dXJuJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAndmlld19tb250aGx5X3JldHVybi8nICsgdGhpcy5tb250aGx5UmV0dXJuLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczoge2lkOiB0aGlzLm1vbnRobHlSZXR1cm4uaWQsIG1vbnRobHlSZXR1cm46IHRoaXMubW9udGhseVJldHVybn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnk6IHt0eXBlOiAndmlldyd9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLm1vbnRobHlSZXR1cm4pCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5pdExvY2FsU3RvcmFnZSh0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyKQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0ZXBzID0gdGhpcy5tb250aGx5UmV0dXJuLnN0ZXAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVhY2hUb3BTdGVwIDw9IHRoaXMuc3RlcHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVhY2hUb3BTdGVwID0gdGhpcy5zdGVwcwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RlcHNDb25kaXRpb24odGhpcy5zdGVwcykKICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5zdGFydF9yZXR1cm4gPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgc3RhcnRSZXR1cm4oKSB7CiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlCiAgICAgICAgICAgIGF3YWl0IHRoaXMuY2hlY2tNb250aGx5UmV0dXJuKCkKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzTXIpIHsKICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoJ1RoaXMgbW9udGggb2YgaXMgZXhpc3QnKQogICAgICAgICAgICAgICAgdGhpcy5zdGF0dXNNciA9IGZhbHNlCiAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGF3YWl0IHRoaXMuZ2VuZXJhdGVOdW1iZXIoKQogICAgICAgICAgICAvLyB0aGlzLnN0YXJ0X3JldHVybiA9IHRydWUKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRQcmVmaXgoKSB7CiAgICAgICAgICAgIHByZWZpeEhhbmRsZXIuZ2V0KCdtb250aGx5IHJldHVybicpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uVHlwZXMgPSByZXMuZGF0YS5kYXRhCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudHJhbnNhY3Rpb25UeXBlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9udGhseVJldHVybi50cmFuc2FjdGlvblR5cGUgPSB0aGlzLnRyYW5zYWN0aW9uVHlwZXNbMF0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBhc3luYyBnZW5lcmF0ZU51bWJlcigpIHsKICAgICAgICAgICAgaWYgKHRoaXMubW9udGhseVJldHVybi50cmFuc2FjdGlvblR5cGUuYWJiciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmxvYWRQcmVmaXgoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgncmVzb2x2ZWQnKTsKICAgICAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgYWJicjogdGhpcy5tb250aGx5UmV0dXJuLnRyYW5zYWN0aW9uVHlwZS5hYmJyLAogICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3R1cmU6IHRoaXMubW9udGhseVJldHVybi50cmFuc2FjdGlvblR5cGUuc3RydWN0dXJlLAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbkRhdGU6IHRoaXMubW9udGhseVJldHVybi5tb250aE9mLAogICAgICAgICAgICAgICAgICAgICAgICBzZXF1Y2VuY2luZzogdGhpcy5tb250aGx5UmV0dXJuLnRyYW5zYWN0aW9uVHlwZS5zZXF1Y2VuY2luZywKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ01vbnRobHkgUmV0dXJuJywKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuLmFiYnIgPSBkYXRhLmFiYnIKICAgICAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4uc3RydWN0dXJlID0gZGF0YS5zdHJ1Y3R1cmUKICAgICAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4uc2VxdWNlbmNpbmcgPSBkYXRhLnNlcXVjZW5jaW5nCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuLnR5cGUgPSBkYXRhLnR5cGUKICAgICAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4udHJhbnNhY3Rpb25EYXRlID0gZGF0YS50cmFuc2FjdGlvbkRhdGUKICAgICAgICAgICAgICAgICAgICBwcmVmaXhIYW5kbGVyLmxhc3ROdW1iZXIoZGF0YSkudGhlbihhc3luYyByZXNwb25zZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzID0gcmVzcG9uc2UuZGF0YS5kYXRhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXN0TnVtYmVyID0gdGhpcy56ZXJvUGFkKHBhcnNlSW50KHJlcy5sYXN0TnVtYmVyKSwgdGhpcy5tb250aGx5UmV0dXJuLnRyYW5zYWN0aW9uVHlwZS5mb3JtYXQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyID0gcmVzLnN1ZmZpeCArIHRoaXMubW9udGhseVJldHVybi50cmFuc2FjdGlvblR5cGUubnVtYmVyU2VwYXJhdG9yICsgbGFzdE51bWJlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuLmxhc3ROdW1iZXIgPSByZXMuc3VmZml4ICsgbGFzdE51bWJlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHRoaXMubW9udGhseVJldHVybi5udW1iZXIsICdtb250aGx5IHJldHVybicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhd2FpdCB0aGlzLnNhdmVSZXR1cm4oKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9udGhseVJldHVybi5pZCA9IGBtci0ke3V1aWQudjEoKX1gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4uc3RhdHVzID0ge2lkOiAxLCBuYW1lOiAnRHJhZnRlZCd9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4uZWRpdERhdGUgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3Vic3RyKDAsIDEwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuLmFtb3VudFBhaWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4uZXhDaGFuZ2VSYXRlID0gNDAwMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuLnN0ZXAgPSAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coJ21vbnRobHkgcmV0dXJuJywgdGhpcy5tb250aGx5UmV0dXJuKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6ICduZXdfdGF4X3JldHVybicgKyBgLyR7dGhpcy5tb250aGx5UmV0dXJuLmlkfWAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ05ldyBUYXggUmV0dXJuJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHtpZDogdGhpcy5tb250aGx5UmV0dXJuLmlkLCBtb250aGx5UmV0dXJuOiB0aGlzLm1vbnRobHlSZXR1cm59LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiB7dHlwZTogJ2VkaXQnfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNSb3V0ZSA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vbnRobHlSZXR1cm4ucHJvZ3Jlc3MgPT09ICcnICYmIHRoaXMuaXNSb3V0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucmV0dXJuVmFsdWUgPSAnUGxlYXNlIG1ha2Ugc3VyZSB5b3UgYWxyZWFkeSBzYXZlIGRyYWZ0JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5yZXR1cm5WYWx1ZSA9ICcnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmVycm9yKGUpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB0aGlzLm1lbnUgPSBmYWxzZQogICAgICAgICAgICAgICAgfSwgMzAwKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgemVyb1BhZChudW0sIHBsYWNlcykgewogICAgICAgICAgICByZXR1cm4gU3RyaW5nKG51bSkucGFkU3RhcnQocGxhY2VzLCAnMCcpCiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkTGlzdFRheCgpIHsKICAgICAgICAgICAgYXdhaXQgdGF4U2V0dGluZ0hhbmRsZXIuZ2V0KGFwaVVybC50YXhfc2V0dGluZy50YXhfbGlzdF9nZXQsICJsaXN0VGF4IiwgInNldExpc3RUYXgiKQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgc2F2ZVJldHVybigpIHsKICAgICAgICAgICAgbW9udGhseVJldHVybkhhbmRsZXIuY3JlYXRlKHRoaXMubW9udGhseVJldHVybikudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlcykKICAgICAgICAgICAgICAgIHRoaXMubW9udGhseVJldHVybiA9IHJlcy5kYXRhLmRhdGEKICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICAgICAgICBwYXRoOiAnbmV3X3RheF9yZXR1cm4nICsgYC8ke3RoaXMubW9udGhseVJldHVybi5pZH1gLAogICAgICAgICAgICAgICAgICAgIG5hbWU6ICdOZXcgVGF4IFJldHVybicsCiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7aWQ6IHRoaXMubW9udGhseVJldHVybi5pZH0sCiAgICAgICAgICAgICAgICAgICAgcXVlcnk6IHt0eXBlOiAnZWRpdCd9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgdGhpcy5pc0NyZWF0ZSA9IHRydWUKICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICB9KS5jYXRjaChlID0+IHsKICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmVycm9yKGUubWVzc2FnZSkKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIGFzeW5jIHNhdmVEcmFmdCgpIHsKICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWUKICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuLnN0ZXAgPSB0aGlzLnN0ZXBzCiAgICAgICAgICAgIGxldCBwcm9ncmVzc05hbWUgPSAnJwogICAgICAgICAgICBpZiAodGhpcy5zdGVwcyA9PT0gMSkgewogICAgICAgICAgICAgICAgcHJvZ3Jlc3NOYW1lID0gJ0lucHV0JwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc3RlcHMgPT09IDIpIHsKICAgICAgICAgICAgICAgIHByb2dyZXNzTmFtZSA9ICdSZXZpZXcnCiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5zdGVwcyA9PT0gMykgewogICAgICAgICAgICAgICAgcHJvZ3Jlc3NOYW1lID0gJ0NvbmZpcm0nCiAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4uYW1vdW50UGFpZCA9IHRoaXMudG90YWxBbW91bnRQYWlkLmFtb3VudAogICAgICAgICAgICAgICAgaWYgKHRoaXMudG90YWxBbW91bnRQYWlkLnN1bW1hcnkgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMudG90YWxBbW91bnRQYWlkLnN1bW1hcnkubW9udGhPZiA9IHRoaXMubW9udGhseVJldHVybi5tb250aE9mCiAgICAgICAgICAgICAgICAgICAgc3VtbWFyeUhhbmRsZXIuY3JlYXRlKHRoaXMudG90YWxBbW91bnRQYWlkLnN1bW1hcnkpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlcywgJ3N1bW1hcnkgY3JlYXRlJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYmFsYW5jZVZhdC5jcmVkaXQgJiYgdGhpcy5iYWxhbmNlVmF0LmNyZWRpdCA+IDAgfHwgdGhpcy5iYWxhbmNlVmF0LnBheW1lbnQgJiYgdGhpcy5iYWxhbmNlVmF0LnBheW1lbnQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgY3JlZGl0OiB0aGlzLmJhbGFuY2VWYXQuY3JlZGl0LAogICAgICAgICAgICAgICAgICAgICAgICBwYXltZW50OiB0aGlzLmJhbGFuY2VWYXQucGF5bWVudCwKICAgICAgICAgICAgICAgICAgICAgICAgbW9udGhPZjogdGhpcy5tb250aGx5UmV0dXJuLm1vbnRoT2YsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICd2YXQgbW9udGhseScsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9KU09OKCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgbW9udGhseVJldHVybkhhbmRsZXIuYWRkVHhuVkFUKGRhdGEsIHRoaXMubW9udGhseVJldHVybi5tb250aE9mLCAnbW9udGhseScpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlcykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYmFsYW5jZVBwaS5iYWxhbmNlICYmIHRoaXMuYmFsYW5jZVBwaS5iYWxhbmNlID4gMCB8fCB0aGlzLmJhbGFuY2VQcGkuY3JlZGl0ICYmIHRoaXMuYmFsYW5jZVBwaS5jcmVkaXQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiB0aGlzLmJhbGFuY2VQcGkuYmFsYW5jZSwKICAgICAgICAgICAgICAgICAgICAgICAgbW9udGhPZjogdGhpcy5tb250aGx5UmV0dXJuLm1vbnRoT2YsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdwcGkgbW9udGhseScsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9KU09OKCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgbW9udGhseVJldHVybkhhbmRsZXIuYWRkVHhuUFBJKGRhdGEsIHRoaXMubW9udGhseVJldHVybi5tb250aE9mLCAnbW9udGhseScpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlcykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc3RlcHMgPT09IDQpIHsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMubG9hZExpc3RUYXgoKQogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHRoaXMuc2FsZXMsICdzYWxlcycpCiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2codGhpcy5wdXJjaGFzZXMsICdwdXJjaGFzZXMnKQogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHRoaXMud2l0aGhvbGRpbmdzLCAnd2l0aGhvbGRpbmdzJykKICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLnNhbGFyaWVzLCAnc2FsYXJpZXMnKQogICAgICAgICAgICAgICAgbGV0IGFtdFNhbGUgPSAwLCBhY2NTYWxlID0ge30sCiAgICAgICAgICAgICAgICAgICAgYW10UHVyY2hhc2UgPSAwLCBhY2NQdXJjaGFzZSA9IHt9LAogICAgICAgICAgICAgICAgICAgIGFtdFdodCA9IDAsIGFjY1dodCA9IHt9LAogICAgICAgICAgICAgICAgICAgIGFtdFBQaSA9IDAsIGFjY1BQaSA9IHt9LAogICAgICAgICAgICAgICAgICAgIGFtdE90aGVyID0gMCwgYWNjT3RoZXIgPSB7fSwKICAgICAgICAgICAgICAgICAgICBhbXRTYWxhcnkgPSAwLCBhY2NTYWxhcnkgPSB7fSwKICAgICAgICAgICAgICAgICAgICBhbXRGQlQgPSAwLCBhY2NGQlQgPSB7fQogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHRoaXMubGlzdFRheHMsIHByb2dyZXNzTmFtZSwgJ2xpc3RUYXgnKQogICAgICAgICAgICAgICAgYWNjU2FsZSA9IHRoaXMubGlzdFRheHMuZmlsdGVyKG8gPT4gby50YXhUeXBlLnR5cGVJZCA9PT0gMSAmJiBvLnRyYW5zYWN0aW9uVHlwZSA9PT0gJ1NhbGUnKVswXS5hY2NvdW50CiAgICAgICAgICAgICAgICBhY2NQdXJjaGFzZSA9IHRoaXMubGlzdFRheHMuZmlsdGVyKG8gPT4gby50YXhUeXBlLnR5cGVJZCA9PT0gMSAmJiBvLnRyYW5zYWN0aW9uVHlwZSA9PT0gJ1B1cmNoYXNlJylbMF0uYWNjb3VudAogICAgICAgICAgICAgICAgYWNjV2h0ID0gdGhpcy5saXN0VGF4cy5maWx0ZXIobyA9PiBvLnRheFR5cGUudHlwZUlkID09PSAyICYmIG8udHJhbnNhY3Rpb25UeXBlID09PSAnUHVyY2hhc2UnKVswXS5hY2NvdW50CiAgICAgICAgICAgICAgICBhY2NQUGkgPSB0aGlzLmxpc3RUYXhzLmZpbHRlcihvID0+IG8udGF4VHlwZS50eXBlSWQgPT09IDYpWzBdLmFjY291bnQKICAgICAgICAgICAgICAgIGFjY090aGVyID0gdGhpcy5saXN0VGF4cy5maWx0ZXIobyA9PiBvLnRheFR5cGUudHlwZUlkID09PSA3KVswXS5hY2NvdW50CiAgICAgICAgICAgICAgICBhY2NTYWxhcnkgPSB0aGlzLmxpc3RUYXhzLmZpbHRlcihvID0+IG8udGF4VHlwZS50eXBlSWQgPT09IDMpWzBdLmFjY291bnQKICAgICAgICAgICAgICAgIGFjY0ZCVCA9IHRoaXMubGlzdFRheHMuZmlsdGVyKG8gPT4gby50YXhUeXBlLnR5cGVJZCA9PT0gNClbMF0uYWNjb3VudAogICAgICAgICAgICAgICAgdGhpcy5zYWxlcy5mb3JFYWNoKGkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChpLml0ZW1MaW5lWzBdLnRheE5hbWUuYWNjb3VudElkID09PSBhY2NTYWxlLmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFtdFNhbGUgKz0gaS50b3RhbFZBVAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoaS5pdGVtTGluZVswXS5zcGVjaWZpY1RheC5hY2NvdW50SWQgPT09IGFjY090aGVyLmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFtdE90aGVyICs9IGkudG90YWxTcGVjaWZpY1RheAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoaS5pdGVtTGluZVswXS5wdWJUYXguYWNjb3VudElkID09PSBhY2NPdGhlci5pZCkgewogICAgICAgICAgICAgICAgICAgICAgICBhbXRPdGhlciArPSBpLnRvdGFsUHViVGF4CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChpLml0ZW1MaW5lWzBdLmFjY29tVGF4LmFjY291bnRJZCA9PT0gYWNjT3RoZXIuaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYW10T3RoZXIgKz0gaS50b3RhbEFjY29tVGF4CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2VzLmZvckVhY2goaSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGkuaXRlbUxpbmVbMF0udGF4TmFtZS5hY2NvdW50SWQgPT09IGFjY1B1cmNoYXNlLmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFtdFB1cmNoYXNlICs9IGkudG90YWxWQVQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgdGhpcy53aXRoaG9sZGluZ3MuZm9yRWFjaChpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoaS5pdGVtTGluZVswXS50YXhOYW1lLmFjY291bnRJZCA9PT0gYWNjV2h0LmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFtdFdodCArPSBpLnRvdGFsVkFUCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIHRoaXMuc2FsYXJpZXMuZm9yRWFjaChpID0+IHsKICAgICAgICAgICAgICAgICAgICBhbXRTYWxhcnkgKz0gaS5hbW91bnRUYXhTYWxhcnkKICAgICAgICAgICAgICAgICAgICBhbXRGQlQgKz0gaS50YXhBbW91bnRCZW5lZml0CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgYW10UFBpID0gdGhpcy5iYWxhbmNlUHBpLmJhbGFuY2UKICAgICAgICAgICAgICAgIGlmICh0aGlzLmpvdXJuYWxTdW1tYXJ5Lmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuam91cm5hbFN1bW1hcnkgPSBbCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBgbXItJHt1dWlkLnYxKCl9YCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlX3JhdGU6IHRoaXMuY3VycmVuY3kucmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiB0aGlzLmN1cnJlbmN5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogYWNjU2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDoga2VuZG8ucGFyc2VGbG9hdChhbXRTYWxlKQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogYG1yLSR7dXVpZC52MSgpfWAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZV9yYXRlOiB0aGlzLmN1cnJlbmN5LnJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogdGhpcy5jdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IGFjY1B1cmNoYXNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBrZW5kby5wYXJzZUZsb2F0KGFtdFB1cmNoYXNlKSAqICgtMSkKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGBtci0ke3V1aWQudjEoKX1gLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VfcmF0ZTogdGhpcy5jdXJyZW5jeS5yYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k6IHRoaXMuY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiBhY2NXaHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IGFtdFdodAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogYG1yLSR7dXVpZC52MSgpfWAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZV9yYXRlOiB0aGlzLmN1cnJlbmN5LnJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogdGhpcy5jdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IGFjY090aGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBhbXRPdGhlcgogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogYG1yLSR7dXVpZC52MSgpfWAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZV9yYXRlOiB0aGlzLmN1cnJlbmN5LnJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogdGhpcy5jdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IGFjY1BQaSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogYW10UFBpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBgbXItJHt1dWlkLnYxKCl9YCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlX3JhdGU6IHRoaXMuY3VycmVuY3kucmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiB0aGlzLmN1cnJlbmN5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogYWNjU2FsYXJ5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBhbXRTYWxhcnkKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGBtci0ke3V1aWQudjEoKX1gLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VfcmF0ZTogdGhpcy5jdXJyZW5jeS5yYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k6IHRoaXMuY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiBhY2NGQlQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IGFtdEZCVAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHRoaXMuam91cm5hbFN1bW1hcnksICdqb3VybmFsU3VtbWFyeScpCiAgICAgICAgICAgICAgICBhd2FpdCBtb250aGx5UmV0dXJuSGFuZGxlci5jcmVhdGVKb3VybmFsKHRoaXMuam91cm5hbFN1bW1hcnkpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2cocmVzLCAnY3JlYXRlIGpvdXJuYWwgbW9udGhseSByZXR1cm4nKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhhbXRTYWxlLCBhY2NTYWxlLCAnYW1vdW50IHNhbGUgYWNjJykKICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhhbXRQdXJjaGFzZSwgYWNjUHVyY2hhc2UsICdhbW91bnQgcHVyY2hhc2UgYWNjJykKICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhhbXRXaHQsIGFjY1dodCwgJ2Ftb3VudCB3aHQgYWNjJykKICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhhbXRPdGhlciwgYWNjT3RoZXIsICdhbW91bnQgb3RoZXIgYWNjJykKICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhhbXRQUGksIGFjY1BQaSwgJ2Ftb3VudCBQUGkgYWNjJykKICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhhbXRTYWxhcnksIGFjY1NhbGFyeSwgJ2Ftb3VudCBTYWxhcnkgYWNjJykKICAgICAgICAgICAgICAgIHByb2dyZXNzTmFtZSA9ICdGaW5hbGl6ZScKICAgICAgICAgICAgICAgIHRoaXMubW9udGhseVJldHVybi5hbW91bnRQYWlkID0gdGhpcy50b3RhbEFtb3VudFBhaWQuYW1vdW50CiAgICAgICAgICAgICAgICBpZiAodGhpcy50b3RhbEFtb3VudFBhaWQuc3VtbWFyeSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50b3RhbEFtb3VudFBhaWQuc3VtbWFyeS5tb250aE9mID0gdGhpcy5tb250aGx5UmV0dXJuLm1vbnRoT2YKICAgICAgICAgICAgICAgICAgICBzdW1tYXJ5SGFuZGxlci5jcmVhdGUodGhpcy50b3RhbEFtb3VudFBhaWQuc3VtbWFyeSkudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2cocmVzLCAnc3VtbWFyeSBjcmVhdGUnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5iYWxhbmNlVmF0LmNyZWRpdCAmJiB0aGlzLmJhbGFuY2VWYXQuY3JlZGl0ID4gMCB8fCB0aGlzLmJhbGFuY2VWYXQucGF5bWVudCAmJiB0aGlzLmJhbGFuY2VWYXQucGF5bWVudCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICBjcmVkaXQ6IHRoaXMuYmFsYW5jZVZhdC5jcmVkaXQsCiAgICAgICAgICAgICAgICAgICAgICAgIHBheW1lbnQ6IHRoaXMuYmFsYW5jZVZhdC5wYXltZW50LAogICAgICAgICAgICAgICAgICAgICAgICBtb250aE9mOiB0aGlzLm1vbnRobHlSZXR1cm4ubW9udGhPZiwKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3ZhdCBtb250aGx5JywKICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogbmV3IERhdGUoKS50b0pTT04oKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBtb250aGx5UmV0dXJuSGFuZGxlci5hZGRUeG5WQVQoZGF0YSwgdGhpcy5tb250aGx5UmV0dXJuLm1vbnRoT2YsICdtb250aGx5JykudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2cocmVzKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5iYWxhbmNlUHBpLmJhbGFuY2UgJiYgdGhpcy5iYWxhbmNlUHBpLmJhbGFuY2UgPiAwIHx8IHRoaXMuYmFsYW5jZVBwaS5jcmVkaXQgJiYgdGhpcy5iYWxhbmNlUHBpLmNyZWRpdCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IHRoaXMuYmFsYW5jZVBwaS5iYWxhbmNlLAogICAgICAgICAgICAgICAgICAgICAgICBtb250aE9mOiB0aGlzLm1vbnRobHlSZXR1cm4ubW9udGhPZiwKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3BwaSBtb250aGx5JywKICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogbmV3IERhdGUoKS50b0pTT04oKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBtb250aGx5UmV0dXJuSGFuZGxlci5hZGRUeG5QUEkoZGF0YSwgdGhpcy5tb250aGx5UmV0dXJuLm1vbnRoT2YsICdtb250aGx5JykudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2cocmVzKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4uZGF0ZVNhbGUgPSB0aGlzLmRhdGVTYWxlLmRhdGUKICAgICAgICAgICAgICAgIHRoaXMubW9udGhseVJldHVybi5kYXRlUHVyY2hhc2UgPSB0aGlzLmRhdGVQdXJjaGFzZS5kYXRlCiAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4uZGF0ZVdodCA9IHRoaXMuZGF0ZVdodC5kYXRlCiAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4uZGF0ZVNhbGFyeSA9IHRoaXMuZGF0ZVNhbGFyeS5kYXRlCiAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4uYW1vdW50RGxTYWxlID0gdGhpcy5kYXRlU2FsZS5hbW91bnQKICAgICAgICAgICAgICAgIHRoaXMubW9udGhseVJldHVybi5hbW91bnREbFB1cmNoYXNlID0gdGhpcy5kYXRlUHVyY2hhc2UuYW1vdW50CiAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4uYW1vdW50RGxXaHQgPSB0aGlzLmRhdGVXaHQuYW1vdW50CiAgICAgICAgICAgICAgICB0aGlzLm1vbnRobHlSZXR1cm4uYW1vdW50RGxTYWxhcnkgPSB0aGlzLmRhdGVTYWxhcnkuYW1vdW50CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5tb250aGx5UmV0dXJuLnByb2dyZXNzID0gcHJvZ3Jlc3NOYW1lCiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLm1vbnRobHlSZXR1cm4sICdtb250aGx5UmV0dXJuJykKICAgICAgICAgICAgYXdhaXQgbW9udGhseVJldHVybkhhbmRsZXIuY3JlYXRlKHRoaXMubW9udGhseVJldHVybikudGhlbihhc3luYyByZXMgPT4gewogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlcykKICAgICAgICAgICAgICAgIHRoaXMubW9udGhseVJldHVybiA9IHJlcy5kYXRhLmRhdGEKICAgICAgICAgICAgICAgIGlmICh0aGlzLnNhbGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBzYWxlSGFuZGxlci5jcmVhdGUodGhpcy5zYWxlcykudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJlNhbGUnKQogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2cocmVzKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5wdXJjaGFzZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IHB1cmNoYXNlSGFuZGxlci5jcmVhdGUodGhpcy5wdXJjaGFzZXMpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZQdXJjaGFzZScpCiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhyZXMpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLndpdGhob2xkaW5ncy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgd2l0aGhvbGRpbmdIYW5kbGVyLmNyZWF0ZSh0aGlzLndpdGhob2xkaW5ncykudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJldpdGhob2xkaW5nJykKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlcykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuc2FsYXJpZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IHNhbGFyeUhhbmRsZXIuY3JlYXRlKHRoaXMuc2FsYXJpZXMpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZTYWxhcnknKQogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2cocmVzKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJlNhbGUnLCBKU09OLnN0cmluZ2lmeShbXSkpCiAgICAgICAgICAgICAgICAvLyBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLm1vbnRobHlSZXR1cm4uYWJiciArIHRoaXMubW9udGhseVJldHVybi5udW1iZXIgKyAnJlB1cmNoYXNlJywgSlNPTi5zdHJpbmdpZnkoW10pKQogICAgICAgICAgICAgICAgLy8gbG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZXaXRoaG9sZGluZycsIEpTT04uc3RyaW5naWZ5KFtdKSkKICAgICAgICAgICAgICAgIC8vIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMubW9udGhseVJldHVybi5hYmJyICsgdGhpcy5tb250aGx5UmV0dXJuLm51bWJlciArICcmU2FsYXJ5JywgSlNPTi5zdHJpbmdpZnkoW10pKQogICAgICAgICAgICAgICAgLy8gbG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5tb250aGx5UmV0dXJuLmFiYnIgKyB0aGlzLm1vbnRobHlSZXR1cm4ubnVtYmVyICsgJyZTdGVwJywgSlNPTi5zdHJpbmdpZnkodGhpcy5zdGVwcykpCiAgICAgICAgICAgIC8vICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5lcnJvcihlLm1lc3NhZ2UpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBhc3luYyBuZXh0U3RwZXMoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnN0ZXBzID09IDQpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2F2ZV9uZXh0ID0gImNvbmZpcm1fY2xvc2UiCiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnNhdmVEcmFmdCgpCiAgICAgICAgICAgICAgICAvLyBhd2FpdCB0aGlzLmNsZWFuKCkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuc2F2ZV9uZXh0ID0gImNvbmZpcm1fbmV4dCIKICAgICAgICAgICAgICAgIHRoaXMuc3RlcHMgPSB0aGlzLnN0ZXBzICsgMQogICAgICAgICAgICAgICAgaWYgKHRoaXMucmVhY2hUb3BTdGVwIDw9IHRoaXMuc3RlcHMpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlYWNoVG9wU3RlcCA9IHRoaXMuc3RlcHMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuc3RlcHNDb25kaXRpb24odGhpcy5zdGVwcykKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgQ2xpY2tTdGVwcyhzdGVwKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnN0ZXBzID09PSBzdGVwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3RlcCA+IHRoaXMucmVhY2hUb3BTdGVwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3RlcCAhPT0gNCkgewogICAgICAgICAgICAgICAgdGhpcy5zYXZlX25leHQgPSAiY29uZmlybV9uZXh0IgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5zYXZlX25leHQgPSAiY29uZmlybV9jbG9zZSIKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnN0ZXBzID0gc3RlcAogICAgICAgICAgICB0aGlzLnN0ZXBzQ29uZGl0aW9uKHRoaXMuc3RlcHMpCiAgICAgICAgfSwKICAgICAgICBzdGVwc0NvbmRpdGlvbih2YWwpIHsKICAgICAgICAgICAgc3dpdGNoICh2YWwpIHsKICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUNvbG9yMSA9ICJwcmltYXJ5IgogICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlQ29sb3IyID0gInRoaXJkIgogICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlQ29sb3IzID0gInRoaXJkIgogICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlQ29sb3I0ID0gInRoaXJkIgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVDb2xvcjEgPSAidGhpcmQiCiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVDb2xvcjIgPSAicHJpbWFyeSIKICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUNvbG9yMyA9ICJ0aGlyZCIKICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUNvbG9yNCA9ICJ0aGlyZCIKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlQ29sb3IxID0gInRoaXJkIgogICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlQ29sb3IyID0gInRoaXJkIgogICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlQ29sb3IzID0gInByaW1hcnkiCiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVDb2xvcjQgPSAidGhpcmQiCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVDb2xvcjEgPSAidGhpcmQiCiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVDb2xvcjIgPSAidGhpcmQiCiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVDb2xvcjMgPSAidGhpcmQiCiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVDb2xvcjQgPSAicHJpbWFyeSIKICAgICAgICAgICAgICAgICAgICB0aGlzLmlzRmluYWwgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zYXZlX25leHQgPSAiY29uZmlybV9jbG9zZSIKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBudW1iZXJGb3JtYXQodmFsdWUpIHsKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKHRoaXMuc2FsZUZvcm1Db250ZW50LmRlY2ltYWwsJ25pbW9sJykKICAgICAgICAgICAgaWYgKHZhbHVlID49IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZS50b0xvY2FsZVN0cmluZygpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUKICAgICAgICAgICAgfQoKICAgICAgICB9LAogICAgfSwKICAgIGNyZWF0ZWQoKSB7CiAgICAgICAgdGhpcy5sb2FkTGlzdFRheCgpCiAgICB9LAogICAgYXN5bmMgbW91bnRlZCgpIHsKICAgICAgICBhd2FpdCB0aGlzLm9ubG9hZEN1cnJlbmN5KCkKICAgICAgICAvLyBhd2FpdCB0aGlzLmxvYWRDdXJyZW5jeURhdGEoY3VycmVuY3lUeXBlLlRBWF9FWENIQU5HRV9DVVJSRU5DWSkKICAgICAgICBhd2FpdCB0aGlzLmluaXREYXRhKCkKICAgICAgICBhd2FpdCB0aGlzLmxvYWRQcmVmaXgoKQogICAgfSwKfQoK"},{"version":3,"sources":["newTaxReturn.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuOA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"newTaxReturn.vue","sourceRoot":"src/views/compliance/monthly_tax/new_tax_return","sourcesContent":["<template>\n    <v-app>\n        <v-container>\n            <v-row>\n                <v-col cols=\"12\" sm=\"12\">\n                    <v-card\n                        outlined\n                        dense\n                        class=\"pa-4 no_border rounded-sm\"\n                        color=\"white\">\n                        <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                            <v-card outlined dense class=\"no_border\">\n                                <h2 class=\"mb-0\">{{ $t('make_new_monthly_return') }}</h2>\n                                <v-icon\n                                    @click=\"onClose\"\n                                    style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                                    class=\"float-right\"\n                                >close\n                                </v-icon>\n\n                            </v-card>\n\n                            <v-row>\n                                <v-col sm=\"12\" cols=\"12\">\n                                    <div class=\"function_content\">\n                                        <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                                            <div>\n                                                <v-row>\n                                                    <v-col sm=\"4\" class=\"py-0\">\n                                                        <label>{{ $t('for_the_month_of') }}</label>\n                                                        <v-menu\n                                                            v-model=\"menu\"\n                                                            :disabled=\"DateState\"\n                                                            class=\"mt-1\"\n                                                            :close-on-content-click=\"false\"\n                                                            max-width=\"290\">\n                                                            <template v-slot:activator=\"{ on,attrs }\">\n                                                                <v-text-field class=\"disable_alert my-0 mt-1\"\n                                                                              v-model=\"monthlyReturn.monthOf\"\n                                                                              readonly\n                                                                              outlined\n                                                                              :disabled=\"DateState\"\n                                                                              append-icon=\"event\"\n                                                                              v-on=\"on\"\n                                                                              v-bind=\"attrs\"\n                                                                              @click:clear=\"monthlyReturn.monthOf\"\n                                                                              @click:append=\"menu = true\"\n                                                                              required/>\n                                                            </template>\n                                                            <v-date-picker\n                                                                :type=\"'month'\"\n                                                                @change=\"menu = false\"\n                                                                v-model=\"monthlyReturn.monthOf\"\n                                                                no-title\n                                                            />\n                                                        </v-menu>\n                                                    </v-col>\n                                                    <v-col sm=\"5\" class=\"py-0 mt-5 px-0\">\n                                                        <v-btn :disabled=\"DateState\" @click=\"startReturn\"\n                                                               class=\"ma-1 ml-2\"\n                                                               color=\"primary white--text text-capitalize\">\n                                                            {{ $t('start_new_return') }}\n                                                        </v-btn>\n                                                    </v-col>\n                                                </v-row>\n                                            </div>\n                                            <div v-if=\"start_return\">\n                                                <v-divider/>\n                                                <v-card elevation=\"0\" class=\"pa-3 mt-3\" color=\"grayBg\">\n                                                    <v-row>\n                                                        <v-col class=\"py-0\" cols=\"12\" sm=\"4\">\n                                                            <label>{{ $t('submission_id') }}</label>\n                                                            <v-row class=\"pt-1 pb-0\">\n                                                                <v-col sm=\"3\" cols=\"3\" class=\"py-0 pr-0\">\n                                                                    <div class=\"code_text text-uppercase\">\n                                                                        {{ monthlyReturn.abbr }}\n                                                                    </div>\n                                                                </v-col>\n                                                                <v-col sm=\"9\" cols=\"8\" class=\"py-0 pl-0 pr-1\">\n                                                                    <v-text-field\n                                                                        v-model=\"monthlyReturn.number\"\n                                                                        disabled\n                                                                        class=\"custom-border \"\n                                                                        outlined\n                                                                        :rules=\"[(v) => !!v || 'Number is required']\"\n                                                                        required\n                                                                    />\n                                                                </v-col>\n                                                            </v-row>\n                                                        </v-col>\n                                                        <v-col class=\"py-0\" cols=\"12\" sm=\"4\">\n                                                            <p class=\"mb-0 mt-5\">\n                                                                {{ $t('approved_exch_rate_month') }}</p>\n                                                        </v-col>\n                                                        <v-col class=\"py-0\" cols=\"12\" sm=\"4\">\n                                                            <h3 class=\"primary--text font_20 mt-5\">\n                                                                {{ numberFormat(currency.rate) }}</h3>\n                                                        </v-col>\n                                                    </v-row>\n                                                </v-card>\n                                                <v-row>\n                                                    <v-col sm=\"2\" class=\"align-center justify-center d-flex \">\n                                                        <div>\n                                                            <v-card @click=\"ClickSteps(1)\" width=\"44\" height=\"44\"\n                                                                    outlined dense :color=\"activeColor1\"\n                                                                    class=\"pointer  m_auto no_border align-center justify-center d-flex rounded-circle \">\n                                                                <h3 class=\"mt-2 white--text\" style=\"font-size: 24px\">\n                                                                    1</h3>\n                                                            </v-card>\n                                                            <p class=\"text-uppercase mt-2\">{{ $t('input') }}</p>\n                                                        </div>\n                                                    </v-col>\n                                                    <v-col sm=\"2\" class=\"align-center justify-center d-flex \">\n                                                        <div>\n                                                            <v-card @click=\"ClickSteps(2)\" width=\"44\" height=\"44\"\n                                                                    outlined dense :color=\"activeColor2\"\n                                                                    class=\"pointer m_auto no_border align-center justify-center d-flex rounded-circle \">\n                                                                <h3 class=\"mt-2 white--text\" style=\"font-size: 24px\">\n                                                                    2</h3>\n                                                            </v-card>\n                                                            <p class=\"text-uppercase mt-2\">{{ $t('review') }}</p>\n                                                        </div>\n                                                    </v-col>\n                                                    <v-col sm=\"2\" class=\"align-center justify-center d-flex \">\n                                                        <div>\n                                                            <v-card @click=\"ClickSteps(3)\" width=\"44\" height=\"44\"\n                                                                    outlined dense :color=\"activeColor3\"\n                                                                    class=\"pointer m_auto  no_border align-center justify-center d-flex rounded-circle \">\n                                                                <h3 class=\"mt-2 white--text\" style=\"font-size: 24px\">\n                                                                    3</h3>\n                                                            </v-card>\n                                                            <p class=\"text-uppercase mt-2\">{{ $t('confirm') }}</p>\n                                                        </div>\n                                                    </v-col>\n                                                    <v-col sm=\"2\" class=\"align-center justify-center d-flex \">\n                                                        <div>\n                                                            <v-card @click=\"new ClickSteps(4)\" width=\"44\" height=\"44\"\n                                                                    outlined dense :color=\"activeColor4\"\n                                                                    class=\"pointer m_auto  no_border align-center justify-center d-flex rounded-circle \">\n                                                                <h3 class=\"mt-2 white--text\" style=\"font-size: 24px\">\n                                                                    4</h3>\n                                                            </v-card>\n                                                            <p class=\"text-uppercase mt-2\">{{ $t('finalize') }}</p>\n                                                        </div>\n                                                    </v-col>\n                                                </v-row>\n                                                <v-divider/>\n                                                <!-- Body function to input -->\n                                                <div v-show=\"steps===1\">\n                                                    <InputTab :currency=\"currency\" :monthlyReturn=\"monthlyReturn\"\n                                                              @getSale=\"getInputSale\"\n                                                              @getPurchase=\"getInputPurchase\"\n                                                              @getSalary=\"getSalary\"\n                                                              @getWithholding=\"getWithholding\"/>\n                                                </div>\n                                                <!-- Steps 2 Adjustemnt -->\n                                                <div v-show=\"steps===2\">\n                                                    <ReviewTab :monthlyReturn=\"monthlyReturn\"\n                                                               :sale=\"sales\"\n                                                               :currency=\"currency\"\n                                                               :purchase=\"purchases\"\n                                                               :salary=\"salaries\"\n                                                               :withholding=\"withholdings\"\n                                                               @getOtherAmount=\"getOtherAmount\"\n                                                               @getAmountWht=\"getAmountWht\"\n                                                               @getTaxSalary=\"getAmountSalary\"\n                                                               @getTaxBenefit=\"getAmountTax\"\n                                                               @getAmountSaleExcul=\"getAmountSaleExcul\"\n                                                               @getTotalAmountPurchase=\"getTotalAmountPurchase\"\n                                                               @getAmountPurchaseExcul=\"getAmountPurchaseExcul\"\n                                                               @getAmountSale=\"getAmountSale\"\n                                                               :alertForm2=\"AlertValidate2\"/>\n                                                </div>\n                                                <!-- Steps there -->\n                                                <div v-show=\"steps===3\">\n                                                    <Confirm :currency=\"currency\" :monthlyReturn=\"monthlyReturn\"\n                                                             :totalAmountPurchase=\"amountTotalPurchase\"\n                                                             :otherAmount=\"otherAmount\"\n                                                             :amountPurchaseExcul=\"amountPurchaseExcul\"\n                                                             :amountSalary=\"amountSalary\"\n                                                             :amountBenefit=\"amountBenefit\"\n                                                             :amountSaleExcul=\"amountSaleExcul\" :amountSale=\"amountSale\"\n                                                             :amountWht=\"amountWht\" @getStep=\"getStep\"\n                                                             @getTotalAmountPaid=\"getTotalAmountPaid\"\n                                                             @getBalanceVat=\"getBalanceVat\"\n                                                             @getBalancePpi=\"getBalancePpi\"/>\n                                                </div>\n                                                <div v-show=\"steps===4\">\n                                                    <Finalize :sale=\"sales\" :purchase=\"purchases\"\n                                                              :salary=\"salaries\"\n                                                              :withholding=\"withholdings\" :monthlyReturn=\"monthlyReturn\"\n                                                              @getDatePurchase=\"getDatePurchase\"\n                                                              @getPurchase=\"getFinalPurchase\"\n                                                              @getDateWht=\"getDateWht\"\n                                                              @getDateSale=\"getDateSale\"/>\n                                                </div>\n                                            </div>\n                                        </v-form>\n                                    </div>\n                                </v-col>\n                            </v-row>\n                            <div class=\"function_footer px-4\">\n                                <!-- Warning Message -->\n                                <v-btn color=\"black\" class=\"float-left  white--text\">{{\n                                        $t('cancel')\n                                    }}\n                                </v-btn>\n                                <v-btn :disabled=\"!start_return\" class=\"float-right  btn_save_close\"\n                                       @click=\"nextStpes\">\n                                    {{ $t(save_next) }}\n                                </v-btn>\n                                <v-btn v-if=\"steps >= 1 && this.monthlyReturn.number !== ''\" @click=\"saveDraft\"\n                                       class=\"float-right mx-3 capitalize white--text \" color=\"primary\">\n                                    {{ $t('save_draft') }}\n                                </v-btn>\n                            </div>\n                        </v-form>\n                    </v-card>\n                </v-col>\n            </v-row>\n            <LoadingMe\n                :isLoading=\"showLoading\"\n                :fullPage=\"true\"\n                :type=\"'loading'\"\n                :myLoading=\"true\"\n            />\n        </v-container>\n    </v-app>\n</template>\n\n<script>\nimport LoadingMe from '@/components/Loading'\nimport MonthlyReturn from \"@/scripts/compliance/model/MonthlyReturn\";\nimport {i18n} from \"@/i18n\";\nimport kendo from '@progress/kendo-ui'\nimport {uuid} from 'vue-uuid'\nimport taxSettingHandler from \"@/scripts/taxSettingHandler\";\n\nconst monthlyReturnHandler = require(\"@/scripts/compliance/handler/monthlyReturnHandler\")\nconst saleHandler = require(\"@/scripts/compliance/handler/saleHandler\")\nconst purchaseHandler = require(\"@/scripts/compliance/handler/purchaseHandler\")\nconst salaryHandler = require(\"@/scripts/compliance/handler/salaryHandler\")\nconst withholdingHandler = require(\"@/scripts/compliance/handler/withholdingTaxHandler\")\nconst monthlyReturn = new MonthlyReturn({})\nconst prefixHandler = require(\"@/scripts/compliance/handler/prefixHandler\")\nconst summaryHandler = require(\"@/scripts/compliance/handler/summaryHandler\")\nconst currencyHandler = require(\"@/scripts/currency/handler/currencyHandler\")\nconst apiUrl = require('@/apiUrl')\n// const taxSetting = require('@/store/taxSetting');\nconst currencyType = {\n    TAX_EXCHANGE_CURRENCY: 'tax-c',\n}\n// const axios = require('axios')\nexport default {\n    name: \"TaxReturn\",\n    components: {\n        'LoadingMe': LoadingMe,\n        // 'month-picker': () => import('@/components/custom_templates/MonthPicker'),\n        InputTab: () => import('./input/InputTab'),\n        ReviewTab: () => import('./review/ReviewTab'),\n        Confirm: () => import('./confirm/ConfirmTab'),\n        Finalize: () => import('./finalize/Finalize')\n    },\n    data: () => ({\n        menu: false,\n        templates: [],\n        month: '',\n        showLoading: false,\n        valid: '',\n        bill_date: \"\",\n        journal_date: '',\n        steps: 1,\n        reachTopStep: 0,\n        check: false,\n        save_next: 'save_next',\n        activeColor1: \"primary\",\n        activeColor2: \"third\",\n        activeColor3: \"third\",\n        activeColor4: \"third\",\n        isFinal: false,\n        // third\n        check1: false,\n        check2: false,\n        check3: false,\n        payroll_id: '',\n        loadPayrolls: [],\n        // start_return: false,\n\n        isCreate: false,\n        transactionTypes: [],\n        monthlyReturn: monthlyReturn,\n        // isGetAmount: false,\n        AlertValidate2: false,\n\n        currency: {},\n        sales: [],\n        purchases: [],\n        salaries: [],\n        withholdings: [],\n        amountSale: 0,\n        amountSaleExcul: 0,\n        amountTotalPurchase: 0,\n        amountPurchaseExcul: 0,\n        amountWht: 0,\n        amountSalary: 0,\n        amountBenefit: 0,\n        otherAmount: 0,\n        totalAmountPaid: 0,\n        summary: {},\n        isRoute: false,\n        balanceVat: {},\n        balancePpi: {},\n        dateSale: '',\n        datePurchase: '',\n        dateWht: '',\n        dateSalary: '',\n        statusMr: false,\n        journalSummary: [],\n        listTaxs: []\n    }),\n    computed: {\n        start_return() {\n            return this.monthlyReturn.number !== '' && this.$route.params.id !== '';\n        },\n        id() {\n            if (this.$route.params.id) {\n                return this.$route.params.id\n            } else {\n                return ''\n            }\n        },\n        DateState() {\n            return this.$route.params.id !== undefined || this.$route.query.type === 'edit' || this.$route.query.type === 'view';\n        },\n        // listTaxs: {\n        //     set(listTax) {\n        //         taxSetting.default.commit(\"setListTax\", listTax)\n        //     },\n        //     get() {\n        //         return taxSetting.default.state.listTax\n        //     }\n        // },\n    },\n    watch: {\n        'id': 'initData',\n    },\n    beforeRouteLeave (to, from , next) {\n        if (to.name === 'Add Purchase' || to.name === 'Add Sale' || to.name === 'Add Withholding Tax') {\n            next()\n        } else {\n            const sales = this.$store.state.compliance.sale\n            if (sales.length > 0 && sales.filter(p => p.isSave === false)) {\n                this.$swal({\n                    title: i18n.t('msg_title_warning'),\n                    text: i18n.t('msg_leave'),\n                    icon: \"warning\",\n                    cancelButtonText: i18n.t('force_leave'),\n                    confirmButtonColor: \"#4d4848\",\n                    cancelButtonColor: \"#ED1A3A\",\n                    showDenyButton: true,\n                    confirmButtonText: i18n.t('leave'),\n                    showCancelButton: true,\n                    showCloseButton: true,\n                }).then(res => {\n                    if (res.isConfirmed || res.isDismissed && res.dismiss === 'cancel') {\n                        next()\n                        this.clear()\n                        this.amountSale = 0\n                        this.amountSaleExcul = 0\n                        this.amountPurchase = 0\n                        this.amountWht = 0\n                        this.otherAmount = 0\n                        this.totalAmountPaid = 0\n                    } else {\n                        next(false)\n                    }\n                    window.console.log(res, 'discard')\n                })\n            } else {\n                if (this.monthlyReturn.progress === '' && this.isRoute) {\n                    this.$swal({\n                        title: i18n.t('msg_title_warning'),\n                        text: i18n.t('msg_discard'),\n                        icon: \"warning\",\n                        showCancelButton: true,\n                        cancelButtonText: i18n.t('cancel'),\n                        confirmButtonColor: \"#4d4848\",\n                        cancelButtonColor: \"#ED1A3A\",\n                        confirmButtonText: i18n.t('discard'),\n                    }).then(res => {\n                        if (res.isConfirmed) {\n                            next()\n                            this.clear()\n                            this.amountSale = 0\n                            this.amountSaleExcul = 0\n                            this.amountPurchase = 0\n                            this.amountWht = 0\n                            this.otherAmount = 0\n                            this.totalAmountPaid = 0\n                        } else {\n                            next(false)\n                        }\n                    })\n                } else {\n                    next()\n                }\n            }\n        }\n    },\n    methods: {\n        async checkMonthlyReturn() {\n            monthlyReturnHandler.getByMonth(this.monthlyReturn.monthOf).then(res => {\n                window.console.log(res, 'get month123')\n                if (res.data.data === 1) {\n                    this.statusMr = true\n                }\n            })\n        },\n        getFinalPurchase(purchase) {\n            if (this.purchases.length === 0) {\n                this.purchases = purchase\n            }\n        },\n        getBalanceVat(balance) {\n            this.balanceVat = balance\n            window.console.log(this.balanceVat.credit, this.balanceVat.payment, 'balanceVat')\n        },\n        getBalancePpi(balance) {\n            this.balancePpi = balance\n            window.console.log(this.balancePpi, 'balancePpi')\n        },\n        getSummary(summary) {\n            window.console.log('new tax tab summary', summary)\n            this.summary = summary\n        },\n        getDateWht(date) {\n            this.dateWht = date\n        },\n        getSalary(salary) {\n            this.salaries = salary\n        },\n        getDatePurchase(date) {\n            this.datePurchase = date\n        },\n        getDateSale(date) {\n            this.dateSale = date\n        },\n        getTotalAmountPaid(amount) {\n            this.totalAmountPaid = amount\n        },\n        getOtherAmount(amount) {\n            this.otherAmount = amount\n        },\n        getAmountSaleExcul(saleExcul) {\n            window.console.log('new tax tab sale excul', saleExcul)\n            this.amountSaleExcul = saleExcul\n        },\n        getWithholding(withholding) {\n            window.console.log('new tax tab withholding', withholding)\n            this.withholdings = withholding\n        },\n        getAmountSalary(amount) {\n            window.console.log('new tax tab salary', amount)\n            this.amountSalary = amount\n        },\n        getAmountTax(amount) {\n            window.console.log('new tax tab benefit', amount)\n            this.amountBenefit = amount\n        },\n        getInputPurchase(purchase) {\n            window.console.log('new tax tab purchase', purchase)\n            this.purchases = purchase\n        },\n        getInputSale(sale) {\n            window.console.log('new tax tab sale', sale)\n            this.sales = sale\n        },\n        getAmountWht(amount) {\n            window.console.log('new tax tab wht', amount)\n            this.amountWht = amount\n        },\n        getStep(step) {\n            this.steps = step\n            if (this.reachTopStep <= this.steps) {\n                this.reachTopStep = this.steps\n            }\n            this.stepsCondition(this.steps)\n        },\n        getTotalAmountPurchase(amount) {\n            this.amountTotalPurchase = amount\n            window.console.log(this.amountPurchase, 'New Tax Tab Purchase')\n        },\n        getAmountPurchaseExcul(amount) {\n            this.amountPurchaseExcul = amount\n        },\n        getAmountSale(amount) {\n            this.amountSale = amount\n            window.console.log(this.amountSale, 'New Tax Tab Sale')\n        },\n        async initData() {\n            this.showLoading = true\n            if (this.$route.params.id !== undefined && this.$route.params.monthlyReturn === undefined) {\n                await this.onLoadOneReturn()\n                window.console.log(this.steps)\n            } else if (this.$route.params.monthlyReturn !== undefined) {\n                this.monthlyReturn = this.$route.params.monthlyReturn\n                if (this.monthlyReturn.status.id === 2) {\n                    this.$router.push({\n                        name: 'View Tax Return',\n                        path: 'view_monthly_return/' + this.monthlyReturn.id,\n                        params: {id: this.monthlyReturn.id, monthlyReturn: this.monthlyReturn},\n                        query: {type: 'view'}\n                    })\n                }\n                window.console.log(this.monthlyReturn, 'dafasdf34')\n                this.initLocalStorage(this.monthlyReturn.abbr, this.monthlyReturn.number)\n                const step = JSON.parse(localStorage.getItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Step'))\n                let steps = 1\n                if (this.monthlyReturn.step !== '') {\n                    steps = this.monthlyReturn.step\n                }\n                if (step > 0) {\n                    window.console.log('step12', step)\n                    if (this.monthlyReturn.step > step) {\n                        steps = this.monthlyReturn.step\n                    } else {\n                        steps = step\n                    }\n                }\n                this.steps = steps\n                if (this.reachTopStep <= this.steps) {\n                    this.reachTopStep = this.steps\n                }\n                this.stepsCondition(this.steps)\n                // this.start_return = true\n                this.showLoading = false\n                window.console.log(this.steps)\n            } else {\n                this.clear()\n            }\n        },\n        clear() {\n            this.monthlyReturn = new MonthlyReturn({})\n            this.showLoading = false\n        },\n        initLocalStorage(abbr, number) {\n            const sale = JSON.parse(localStorage.getItem(abbr + number + '&Sale'))\n            const purchase = JSON.parse(localStorage.getItem(abbr + number + '&Purchase'))\n            const withholding = JSON.parse(localStorage.getItem(abbr + number + '&Withholding'))\n            const salary = JSON.parse(localStorage.getItem(abbr + number + '&Salary'))\n            const step = JSON.parse(localStorage.getItem(abbr + number + '&Step'))\n            if (sale === null) {\n                localStorage.setItem(abbr + number + '&Sale', JSON.stringify([]))\n            }\n            if (purchase === null) {\n                localStorage.setItem(abbr + number + '&Purchase', JSON.stringify([]))\n            }\n            if (withholding === null) {\n                localStorage.setItem(abbr + number + '&Withholding', JSON.stringify([]))\n            }\n            if (salary === null) {\n                localStorage.setItem(abbr + number + '&Salary', JSON.stringify([]))\n            }\n            if (step === null) {\n                localStorage.setItem(abbr + number + '&Step', JSON.stringify(1))\n            }\n        },\n        onClose() {\n            const sales = this.$store.state.compliance.sale\n            const purchases = this.$store.state.compliance.purchase\n            const withholding = this.$store.state.compliance.withholding\n            if (sales.length > 0 && sales.filter(p => p.isSave === false) || purchases.length > 0 && purchases.filter(p => p.isSave === false) || withholding.length > 0 && withholding.filter(p => p.isSave === false)) {\n                this.$swal({\n                    title: i18n.t('msg_title_warning'),\n                    text: i18n.t('msg_leave'),\n                    icon: \"warning\",\n                    cancelButtonText: i18n.t('force_leave'),\n                    confirmButtonColor: \"#4d4848\",\n                    cancelButtonColor: \"#ED1A3A\",\n                    showDenyButton: true,\n                    confirmButtonText: i18n.t('leave'),\n                    showCancelButton: true,\n                    showCloseButton: true,\n                }).then(res => {\n                    if (res.isConfirmed || res.isDismissed && res.dismiss === 'cancel') {\n                        this.clean()\n                    }\n                    window.console.log(res, 'discard')\n                })\n            } else {\n                if (this.monthlyReturn.progress === '' && this.isRoute) {\n                    this.$swal({\n                        title: i18n.t('msg_title_warning'),\n                        text: i18n.t('msg_discard'),\n                        icon: \"warning\",\n                        showCancelButton: true,\n                        cancelButtonText: i18n.t('cancel'),\n                        confirmButtonColor: \"#4d4848\",\n                        cancelButtonColor: \"#ED1A3A\",\n                        confirmButtonText: i18n.t('discard'),\n                    }).then(res => {\n                        if (res.isConfirmed) {\n                            this.clean()\n                        }\n                    })\n                }\n            }\n\n            // const sale = JSON.parse(localStorage.getItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Sale'))\n            // const purchase = JSON.parse(localStorage.getItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Purchase'))\n            // const withholding = JSON.parse(localStorage.getItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Withholding'))\n            // const salary = JSON.parse(localStorage.getItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Salary'))\n            // const step = JSON.parse(localStorage.getItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Step'))\n            // if (sale === null) {\n            //     localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Sale', JSON.stringify([]))\n            // }\n            // if (purchase === null) {\n            //     localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Purchase', JSON.stringify([]))\n            // }\n            // if (withholding === null) {\n            //     localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Withholding', JSON.stringify([]))\n            // }\n            // if (salary === null) {\n            //     localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Salary', JSON.stringify([]))\n            // }\n            // if (step === null) {\n            //     localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Step', JSON.stringify(1))\n            // }\n            // if (sale !== null || purchase !== null || withholding !== null || salary !== null) {\n            //     if (sale.length > 0 || purchase.length > 0 || withholding.length > 0 || salary.length > 0) {\n            //         this.$swal({\n            //             title: i18n.t('msg_title_warning'),\n            //             text: i18n.t('msg_leave'),\n            //             icon: \"warning\",\n            //             cancelButtonText: i18n.t('force_leave'),\n            //             confirmButtonColor: \"#4d4848\",\n            //             cancelButtonColor: \"#ED1A3A\",\n            //             showDenyButton: true,\n            //             confirmButtonText: i18n.t('leave'),\n            //             showCancelButton: true,\n            //             showCloseButton: true,\n            //         }).then(res => {\n            //             if (res.isConfirmed) {\n            //                 localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Step', this.steps)\n            //                 this.clean()\n            //             } else if (res.isDismissed && res.dismiss === 'cancel') {\n            //                 localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Sale')\n            //                 localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Purchase')\n            //                 localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Salary')\n            //                 localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Withholding')\n            //                 localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Step')\n            //                 this.clean()\n            //             }\n            //             window.console.log(res, 'discard')\n            //         })\n            //     } else {\n            //         if (this.monthlyReturn.progress === '' && this.isRoute) {\n            //             this.$swal({\n            //                 title: i18n.t('msg_title_warning'),\n            //                 text: i18n.t('msg_discard'),\n            //                 icon: \"warning\",\n            //                 showCancelButton: true,\n            //                 cancelButtonText: i18n.t('cancel'),\n            //                 confirmButtonColor: \"#4d4848\",\n            //                 cancelButtonColor: \"#ED1A3A\",\n            //                 confirmButtonText: i18n.t('discard'),\n            //             }).then(res => {\n            //                 if (res.isConfirmed) {\n            //                     localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Sale')\n            //                     localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Purchase')\n            //                     localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Salary')\n            //                     localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Withholding')\n            //                     localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Step')\n            //                     this.clean()\n            //                 }\n            //                 window.console.log(res, 'discard')\n            //             })\n            //         } else {\n            //             this.clean()\n            //         }\n            //     }\n            // }\n        },\n        clean() {\n            this.clear()\n            this.amountSale = 0\n            this.amountSaleExcul = 0\n            this.amountPurchase = 0\n            this.amountWht = 0\n            this.otherAmount = 0\n            this.totalAmountPaid = 0\n            // this.start_return = false\n            if (!this.isRoute) {\n                this.isRoute = false\n                window.history.go(-1)\n\n            } else {\n                this.isRoute = false\n                window.history.go(-1)\n                window.history.go(-1)\n            }\n\n        },\n        async loadCurrencyData(type) {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved')\n                    this.showLoading = true\n                    currencyHandler.list(type).then(response => {\n                        if (response.data.statusCode === 200) {\n                            window.console.log('response','')\n                            if (type === currencyType.TAX_EXCHANGE_CURRENCY) {\n                                this.currency = response.data.data[0]\n                            }\n                        }\n                    }).catch()\n                    {\n                        this.showLoading = false\n                    }\n                }, 300)\n            })\n        },\n        async onloadCurrency() {\n            const date = this.monthlyReturn.monthOf + '-' + '30'\n            const code = 'KHR'\n            currencyHandler.getLastExchangeRateTaxByDate(date, code).then(res => {\n                this.currency = res.data.data[0]\n                window.console.log(res, 'currency')\n            })\n        },\n        async onLoadOneReturn() {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved');\n                    const id = this.$route.params.id\n                    monthlyReturnHandler.getOne(id).then(res => {\n                        window.console.log(res, 'data load monthly return')\n                        this.monthlyReturn = res.data.data[0]\n                        if (this.monthlyReturn.status.id === 2) {\n                            this.$router.push({\n                                name: 'View Tax Return',\n                                path: 'view_monthly_return/' + this.monthlyReturn.id,\n                                params: {id: this.monthlyReturn.id, monthlyReturn: this.monthlyReturn},\n                                query: {type: 'view'}\n                            })\n                        }\n                        window.console.log(this.monthlyReturn)\n                        this.initLocalStorage(this.monthlyReturn.number)\n                        this.steps = this.monthlyReturn.step\n                        if (this.reachTopStep <= this.steps) {\n                            this.reachTopStep = this.steps\n                        }\n                        this.stepsCondition(this.steps)\n                        // this.start_return = true\n                        this.showLoading = false\n                    })\n                })\n            })\n        },\n        async startReturn() {\n            this.showLoading = true\n            await this.checkMonthlyReturn()\n            if (this.statusMr) {\n                this.$snotify.error('This month of is exist')\n                this.statusMr = false\n                this.showLoading = false\n                return\n            }\n            await this.generateNumber()\n            // this.start_return = true\n        },\n        async loadPrefix() {\n            prefixHandler.get('monthly return').then(res => {\n                if (res.data.statusCode === 200) {\n                    this.transactionTypes = res.data.data\n                    if (this.transactionTypes.length > 0) {\n                        this.monthlyReturn.transactionType = this.transactionTypes[0]\n                    }\n                }\n            })\n        },\n        async generateNumber() {\n            if (this.monthlyReturn.transactionType.abbr === undefined) {\n                await this.loadPrefix()\n            }\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved');\n                    let data = {\n                        abbr: this.monthlyReturn.transactionType.abbr,\n                        structure: this.monthlyReturn.transactionType.structure,\n                        transactionDate: this.monthlyReturn.monthOf,\n                        sequcencing: this.monthlyReturn.transactionType.sequcencing,\n                        type: 'Monthly Return',\n                    }\n                    this.monthlyReturn.abbr = data.abbr\n                    this.monthlyReturn.structure = data.structure\n                    this.monthlyReturn.sequcencing = data.sequcencing\n                    this.monthlyReturn.type = data.type\n                    this.monthlyReturn.transactionDate = data.transactionDate\n                    prefixHandler.lastNumber(data).then(async response => {\n                        if (response.data.statusCode === 200) {\n                            const res = response.data.data\n                            const lastNumber = this.zeroPad(parseInt(res.lastNumber), this.monthlyReturn.transactionType.format)\n                            this.monthlyReturn.number = res.suffix + this.monthlyReturn.transactionType.numberSeparator + lastNumber\n                            this.monthlyReturn.lastNumber = res.suffix + lastNumber\n                            window.console.log(this.monthlyReturn.number, 'monthly return')\n                            // await this.saveReturn()\n\n                            this.monthlyReturn.id = `mr-${uuid.v1()}`\n                            this.monthlyReturn.status = {id: 1, name: 'Drafted'}\n                            this.monthlyReturn.editDate = new Date().toISOString().substr(0, 10)\n                            this.monthlyReturn.amountPaid = 0\n                            this.monthlyReturn.exChangeRate = 4000\n                            this.monthlyReturn.step = 1\n                            window.console.log('monthly return', this.monthlyReturn)\n                            this.$router.push({\n                                path: 'new_tax_return' + `/${this.monthlyReturn.id}`,\n                                name: 'New Tax Return',\n                                params: {id: this.monthlyReturn.id, monthlyReturn: this.monthlyReturn},\n                                query: {type: 'edit'}\n                            })\n                            this.isRoute = true\n                            if (this.monthlyReturn.progress === '' && this.isRoute) {\n                                window.addEventListener('beforeunload', function (event) {\n                                    event.returnValue = 'Please make sure you already save draft'\n                                })\n                                window.removeEventListener('beforeunload', function (event) {\n                                    event.returnValue = ''\n                                })\n                            }\n                            this.showLoading = false\n                        }\n                    }).catch(e => {\n                        window.console.error(e)\n                    })\n                    this.menu = false\n                }, 300)\n            })\n        },\n        zeroPad(num, places) {\n            return String(num).padStart(places, '0')\n        },\n        async loadListTax() {\n            await taxSettingHandler.get(apiUrl.tax_setting.tax_list_get, \"listTax\", \"setListTax\")\n        },\n        async saveReturn() {\n            monthlyReturnHandler.create(this.monthlyReturn).then(res => {\n                window.console.log(res)\n                this.monthlyReturn = res.data.data\n                this.$router.push({\n                    path: 'new_tax_return' + `/${this.monthlyReturn.id}`,\n                    name: 'New Tax Return',\n                    params: {id: this.monthlyReturn.id},\n                    query: {type: 'edit'}\n                })\n                this.isCreate = true\n                this.showLoading = false\n            }).catch(e => {\n                window.console.error(e.message)\n            })\n        },\n        async saveDraft() {\n            this.showLoading = true\n            this.monthlyReturn.step = this.steps\n            let progressName = ''\n            if (this.steps === 1) {\n                progressName = 'Input'\n            } else if (this.steps === 2) {\n                progressName = 'Review'\n            } else if (this.steps === 3) {\n                progressName = 'Confirm'\n                this.monthlyReturn.amountPaid = this.totalAmountPaid.amount\n                if (this.totalAmountPaid.summary !== undefined) {\n                    this.totalAmountPaid.summary.monthOf = this.monthlyReturn.monthOf\n                    summaryHandler.create(this.totalAmountPaid.summary).then(res => {\n                        window.console.log(res, 'summary create')\n                    })\n                }\n                if (this.balanceVat.credit && this.balanceVat.credit > 0 || this.balanceVat.payment && this.balanceVat.payment > 0) {\n                    const data = {\n                        credit: this.balanceVat.credit,\n                        payment: this.balanceVat.payment,\n                        monthOf: this.monthlyReturn.monthOf,\n                        type: 'vat monthly',\n                        date: new Date().toJSON()\n                    }\n                    await monthlyReturnHandler.addTxnVAT(data, this.monthlyReturn.monthOf, 'monthly').then(res => {\n                        window.console.log(res)\n                    })\n                }\n                if (this.balancePpi.balance && this.balancePpi.balance > 0 || this.balancePpi.credit && this.balancePpi.credit > 0) {\n                    const data = {\n                        amount: this.balancePpi.balance,\n                        monthOf: this.monthlyReturn.monthOf,\n                        type: 'ppi monthly',\n                        date: new Date().toJSON()\n                    }\n                    await monthlyReturnHandler.addTxnPPI(data, this.monthlyReturn.monthOf, 'monthly').then(res => {\n                        window.console.log(res)\n                    })\n                }\n            } else if (this.steps === 4) {\n                await this.loadListTax()\n                window.console.log(this.sales, 'sales')\n                window.console.log(this.purchases, 'purchases')\n                window.console.log(this.withholdings, 'withholdings')\n                window.console.log(this.salaries, 'salaries')\n                let amtSale = 0, accSale = {},\n                    amtPurchase = 0, accPurchase = {},\n                    amtWht = 0, accWht = {},\n                    amtPPi = 0, accPPi = {},\n                    amtOther = 0, accOther = {},\n                    amtSalary = 0, accSalary = {},\n                    amtFBT = 0, accFBT = {}\n                window.console.log(this.listTaxs, progressName, 'listTax')\n                accSale = this.listTaxs.filter(o => o.taxType.typeId === 1 && o.transactionType === 'Sale')[0].account\n                accPurchase = this.listTaxs.filter(o => o.taxType.typeId === 1 && o.transactionType === 'Purchase')[0].account\n                accWht = this.listTaxs.filter(o => o.taxType.typeId === 2 && o.transactionType === 'Purchase')[0].account\n                accPPi = this.listTaxs.filter(o => o.taxType.typeId === 6)[0].account\n                accOther = this.listTaxs.filter(o => o.taxType.typeId === 7)[0].account\n                accSalary = this.listTaxs.filter(o => o.taxType.typeId === 3)[0].account\n                accFBT = this.listTaxs.filter(o => o.taxType.typeId === 4)[0].account\n                this.sales.forEach(i => {\n                    if (i.itemLine[0].taxName.accountId === accSale.id) {\n                        amtSale += i.totalVAT\n                    }\n                    if (i.itemLine[0].specificTax.accountId === accOther.id) {\n                        amtOther += i.totalSpecificTax\n                    }\n                    if (i.itemLine[0].pubTax.accountId === accOther.id) {\n                        amtOther += i.totalPubTax\n                    }\n                    if (i.itemLine[0].accomTax.accountId === accOther.id) {\n                        amtOther += i.totalAccomTax\n                    }\n                })\n                this.purchases.forEach(i => {\n                    if (i.itemLine[0].taxName.accountId === accPurchase.id) {\n                        amtPurchase += i.totalVAT\n                    }\n                })\n                this.withholdings.forEach(i => {\n                    if (i.itemLine[0].taxName.accountId === accWht.id) {\n                        amtWht += i.totalVAT\n                    }\n                })\n                this.salaries.forEach(i => {\n                    amtSalary += i.amountTaxSalary\n                    amtFBT += i.taxAmountBenefit\n                })\n                amtPPi = this.balancePpi.balance\n                if (this.journalSummary.length === 0) {\n                    this.journalSummary = [\n                        {\n                            id: `mr-${uuid.v1()}`,\n                            exchange_rate: this.currency.rate,\n                            currency: this.currency,\n                            account: accSale,\n                            amount: kendo.parseFloat(amtSale)\n                        },\n                        {\n                            id: `mr-${uuid.v1()}`,\n                            exchange_rate: this.currency.rate,\n                            currency: this.currency,\n                            account: accPurchase,\n                            amount: kendo.parseFloat(amtPurchase) * (-1)\n                        },\n                        {\n                            id: `mr-${uuid.v1()}`,\n                            exchange_rate: this.currency.rate,\n                            currency: this.currency,\n                            account: accWht,\n                            amount: amtWht\n                        },\n                        {\n                            id: `mr-${uuid.v1()}`,\n                            exchange_rate: this.currency.rate,\n                            currency: this.currency,\n                            account: accOther,\n                            amount: amtOther\n                        },\n                        {\n                            id: `mr-${uuid.v1()}`,\n                            exchange_rate: this.currency.rate,\n                            currency: this.currency,\n                            account: accPPi,\n                            amount: amtPPi\n                        },\n                        {\n                            id: `mr-${uuid.v1()}`,\n                            exchange_rate: this.currency.rate,\n                            currency: this.currency,\n                            account: accSalary,\n                            amount: amtSalary\n                        },\n                        {\n                            id: `mr-${uuid.v1()}`,\n                            exchange_rate: this.currency.rate,\n                            currency: this.currency,\n                            account: accFBT,\n                            amount: amtFBT\n                        }\n                    ]\n                }\n                window.console.log(this.journalSummary, 'journalSummary')\n                await monthlyReturnHandler.createJournal(this.journalSummary).then(res => {\n                    window.console.log(res, 'create journal monthly return')\n                })\n                window.console.log(amtSale, accSale, 'amount sale acc')\n                window.console.log(amtPurchase, accPurchase, 'amount purchase acc')\n                window.console.log(amtWht, accWht, 'amount wht acc')\n                window.console.log(amtOther, accOther, 'amount other acc')\n                window.console.log(amtPPi, accPPi, 'amount PPi acc')\n                window.console.log(amtSalary, accSalary, 'amount Salary acc')\n                progressName = 'Finalize'\n                this.monthlyReturn.amountPaid = this.totalAmountPaid.amount\n                if (this.totalAmountPaid.summary !== undefined) {\n                    this.totalAmountPaid.summary.monthOf = this.monthlyReturn.monthOf\n                    summaryHandler.create(this.totalAmountPaid.summary).then(res => {\n                        window.console.log(res, 'summary create')\n                    })\n                }\n                if (this.balanceVat.credit && this.balanceVat.credit > 0 || this.balanceVat.payment && this.balanceVat.payment > 0) {\n                    const data = {\n                        credit: this.balanceVat.credit,\n                        payment: this.balanceVat.payment,\n                        monthOf: this.monthlyReturn.monthOf,\n                        type: 'vat monthly',\n                        date: new Date().toJSON()\n                    }\n                    await monthlyReturnHandler.addTxnVAT(data, this.monthlyReturn.monthOf, 'monthly').then(res => {\n                        window.console.log(res)\n                    })\n                }\n                if (this.balancePpi.balance && this.balancePpi.balance > 0 || this.balancePpi.credit && this.balancePpi.credit > 0) {\n                    const data = {\n                        amount: this.balancePpi.balance,\n                        monthOf: this.monthlyReturn.monthOf,\n                        type: 'ppi monthly',\n                        date: new Date().toJSON()\n                    }\n                    await monthlyReturnHandler.addTxnPPI(data, this.monthlyReturn.monthOf, 'monthly').then(res => {\n                        window.console.log(res)\n                    })\n                }\n                this.monthlyReturn.dateSale = this.dateSale.date\n                this.monthlyReturn.datePurchase = this.datePurchase.date\n                this.monthlyReturn.dateWht = this.dateWht.date\n                this.monthlyReturn.dateSalary = this.dateSalary.date\n                this.monthlyReturn.amountDlSale = this.dateSale.amount\n                this.monthlyReturn.amountDlPurchase = this.datePurchase.amount\n                this.monthlyReturn.amountDlWht = this.dateWht.amount\n                this.monthlyReturn.amountDlSalary = this.dateSalary.amount\n            }\n            this.monthlyReturn.progress = progressName\n            window.console.log(this.monthlyReturn, 'monthlyReturn')\n            await monthlyReturnHandler.create(this.monthlyReturn).then(async res => {\n                window.console.log(res)\n                this.monthlyReturn = res.data.data\n                if (this.sales.length > 0) {\n                    await saleHandler.create(this.sales).then(res => {\n                        localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Sale')\n                        window.console.log(res)\n                    })\n                }\n                if (this.purchases.length > 0) {\n                    await purchaseHandler.create(this.purchases).then(res => {\n                        localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Purchase')\n                        window.console.log(res)\n                    })\n                }\n                if (this.withholdings.length > 0) {\n                    await withholdingHandler.create(this.withholdings).then(res => {\n                        localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Withholding')\n                        window.console.log(res)\n                    })\n                }\n                if (this.salaries.length > 0) {\n                    await salaryHandler.create(this.salaries).then(res => {\n                        localStorage.removeItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Salary')\n                        window.console.log(res)\n                    })\n                }\n                // localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Sale', JSON.stringify([]))\n                // localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Purchase', JSON.stringify([]))\n                // localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Withholding', JSON.stringify([]))\n                // localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Salary', JSON.stringify([]))\n                // localStorage.setItem(this.monthlyReturn.abbr + this.monthlyReturn.number + '&Step', JSON.stringify(this.steps))\n            //     this.showLoading = false\n            }).catch(e => {\n                window.console.error(e.message)\n            })\n        },\n        async nextStpes() {\n            if (this.steps == 4) {\n                this.save_next = \"confirm_close\"\n                await this.saveDraft()\n                // await this.clean()\n            } else {\n                this.save_next = \"confirm_next\"\n                this.steps = this.steps + 1\n                if (this.reachTopStep <= this.steps) {\n                    this.reachTopStep = this.steps\n                }\n                this.stepsCondition(this.steps)\n            }\n        },\n        async ClickSteps(step) {\n            if (this.steps === step) {\n                return\n            }\n            if (step > this.reachTopStep) {\n                return\n            }\n            if (step !== 4) {\n                this.save_next = \"confirm_next\"\n            } else {\n                this.save_next = \"confirm_close\"\n            }\n            this.steps = step\n            this.stepsCondition(this.steps)\n        },\n        stepsCondition(val) {\n            switch (val) {\n                case 1:\n                    this.activeColor1 = \"primary\"\n                    this.activeColor2 = \"third\"\n                    this.activeColor3 = \"third\"\n                    this.activeColor4 = \"third\"\n                    break\n                case 2:\n                    this.activeColor1 = \"third\"\n                    this.activeColor2 = \"primary\"\n                    this.activeColor3 = \"third\"\n                    this.activeColor4 = \"third\"\n                    break\n                case 3:\n                    this.activeColor1 = \"third\"\n                    this.activeColor2 = \"third\"\n                    this.activeColor3 = \"primary\"\n                    this.activeColor4 = \"third\"\n                    break\n                default:\n                    this.activeColor1 = \"third\"\n                    this.activeColor2 = \"third\"\n                    this.activeColor3 = \"third\"\n                    this.activeColor4 = \"primary\"\n                    this.isFinal = true\n                    this.save_next = \"confirm_close\"\n                    break\n            }\n        },\n        numberFormat(value) {\n            // window.console.log(this.saleFormContent.decimal,'nimol')\n            if (value >= 0) {\n                return value.toLocaleString()\n            } else {\n                return value\n            }\n\n        },\n    },\n    created() {\n        this.loadListTax()\n    },\n    async mounted() {\n        await this.onloadCurrency()\n        // await this.loadCurrencyData(currencyType.TAX_EXCHANGE_CURRENCY)\n        await this.initData()\n        await this.loadPrefix()\n    },\n}\n\n</script>\n\n<style scoped>\n.function_content {\n    padding: 0 12px 12px;\n    border-bottom: 0;\n    background-color: #fff !important;\n}\n\n.m_auto {\n    margin: auto;\n}\n\n@media (min-width: 1264px) {\n    .container {\n        /* max-width: 1185px; */\n        max-width: 1080px !important;\n    }\n}\n\n.grayBg {\n    background-color: #F8F8F9;\n}\n\n@media (max-width: 576px) {\n    .mb-6 {\n        margin-bottom: 0 !important;\n    }\n}\n\n.border_grey {\n    border: 1px solid #d6d7d8;\n}\n\n.attachment_table {\n    width: 100%;\n}\n\n.my_checkbox input[type=checkbox] + label {\n    display: grid;\n    grid-template-columns: 20% 80%;\n    margin: 0.2em 0px;\n    cursor: pointer;\n    line-height: 16px;\n    padding: 0.2em;\n}\n</style>\n"]}]}