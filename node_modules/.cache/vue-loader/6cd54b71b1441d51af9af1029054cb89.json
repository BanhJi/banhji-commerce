{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/customers/CashReceipt.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/customers/CashReceipt.vue","mtime":1642478961304},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7aTE4bn0gZnJvbSAnQC9pMThuJzsKaW1wb3J0IHtEcm9wRG93bkxpc3R9IGZyb20gJ0Bwcm9ncmVzcy9rZW5kby12dWUtZHJvcGRvd25zJwoKaW1wb3J0IERhdGVQaWNrZXJDb21wb25lbnQgZnJvbSAnQC9jb21wb25lbnRzL2N1c3RvbV90ZW1wbGF0ZXMvRGF0ZVBpY2tlckNvbXBvbmVudCcKaW1wb3J0IENhc2hSZWNlaXB0TW9kZWwgZnJvbSAiQC9zY3JpcHRzL2Nhc2gtcmVjZWlwdC9tb2RlbC9DYXNoUmVjZWlwdCI7CmltcG9ydCBJdGVtTGluZU1vZGVsIGZyb20gIkAvc2NyaXB0cy9jYXNoLXJlY2VpcHQvbW9kZWwvSXRlbUxpbmUiOwppbXBvcnQga2VuZG8gZnJvbSAiQHByb2dyZXNzL2tlbmRvLXVpIjsKaW1wb3J0IFBheW1lbnRPcHRpb25FZGl0b3IgZnJvbSAiQC9zY3JpcHRzL2tlbmRvX2VkaXRvci9QYXltZW50T3B0aW9uRWRpdG9yIjsKaW1wb3J0IEhlbHBlciBmcm9tICJAL2hlbHBlciI7Cgpjb25zdCBwcmVmaXhIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3ByZWZpeEhhbmRsZXIiKQpjb25zdCBzYWxlRm9ybUNvbnRlbnRIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3NhbGVGb3JtQ29udGVudEhhbmRsZXIiKQpjb25zdCBiaWxsaW5nSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9pbnZvaWNlL2hhbmRsZXIvYmlsbGluZ0hhbmRsZXIiKQpjb25zdCBjdXN0b21lckhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvY3VzdG9tZXJIYW5kbGVyIikKY29uc3Qgc2V0dGluZ0hhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvc2V0dGluZ3NIYW5kbGVyIikKCmNvbnN0ICQgPSBrZW5kby5qUXVlcnkgLy9yZXF1aXJlKCJqcXVlcnkiKQpjb25zdCBwYXltZW50T3B0aW9uSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wYXltZW50T3B0aW9uSGFuZGxlciIpCi8vIGNvbnN0IHBheW1lbnRPcHRpb25IYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3BheW1lbnRPcHRpb25IYW5kbGVyIikKCmNvbnN0IGNhc2hSZWNlaXB0TW9kZWwgPSBuZXcgQ2FzaFJlY2VpcHRNb2RlbChuZXcgT2JqZWN0KCkpCmNvbnN0IGl0ZW1MaW5lTW9kZWwgPSBuZXcgSXRlbUxpbmVNb2RlbCh7fSkKCmNvbnN0IGtleUZpZWxkID0gJ2lkJwpjb25zdCB0ZXh0RmllbGQgPSAnbnVtYmVyTmFtZScKY29uc3QgZGVmYXVsdEl0ZW0gPSB7W3RleHRGaWVsZF06ICdTZWxlY3QgY3VzdG9tZXIuLi4nLCBba2V5RmllbGRdOiBudWxsfQpjb25zdCBlbXB0eUl0ZW0gPSB7W3RleHRGaWVsZF06ICdsb2FkaW5nIC4uLid9CmNvbnN0IE9QVElPTl9UWVBFID0gJ0N1c3RvbWVyJwpjb25zdCBzdHJGaWx0ZXIgPSAnP29wdGlvblR5cGU9JyArIE9QVElPTl9UWVBFCgpjb25zdCBjb29raWVKUyA9IHJlcXVpcmUoIkAvY29va2llLmpzIik7CmNvbnN0IGNvb2tpZSA9IGNvb2tpZUpTLmdldENvb2tpZSgpOwovLyBmcm9tCmNvbnN0IHtnZXRGb3JtU2V0dGluZ30gPSByZXF1aXJlKCJAL3NjcmlwdHMvc2V0dGluZ3NIYW5kbGVyLmpzIikKaW1wb3J0IHtwcmludH0gZnJvbSAiQC9mb3JtL1NhbGUuanMiOwoKZXhwb3J0IGRlZmF1bHQgewogICAgbmFtZTogIkNhc2hSZWNlaXB0IiwKICAgIHByb3BzOiBbJ2lkJ10sCiAgICBjb21wb25lbnRzOiB7CiAgICAgICAgTG9hZGluZ01lOiAoKSA9PiBpbXBvcnQoYEAvY29tcG9uZW50cy9Mb2FkaW5nYCksCiAgICAgICAgJ2FwcC1kYXRlcGlja2VyJzogRGF0ZVBpY2tlckNvbXBvbmVudCwKICAgICAgICAnZHJvcGRvd25saXN0JzogRHJvcERvd25MaXN0CiAgICB9LAogICAgZGF0YTogKCkgPT4gKHsKICAgICAgICBjaGVja19pZF9lZGl0OiB0cnVlLAogICAgICAgIFBheW1lbnRPcHRpb25FZGl0b3I6IFBheW1lbnRPcHRpb25FZGl0b3IsCiAgICAgICAgc2hvd0xvYWRpbmc6IGZhbHNlLAogICAgICAgIGxvYWRpbmdBbGVydDogZmFsc2UsCiAgICAgICAgbG9hZGluZ0NvbG9yQWxlcnQ6ICcnLAogICAgICAgIGxvYWRpbmdUZXh0QWxlcnQ6ICcnLAogICAgICAgIGFsZXJ0OiBmYWxzZSwKICAgICAgICBmaWxlczogW10sCiAgICAgICAgdmFsaWQ6IHRydWUsCiAgICAgICAgbG9nZ2VkVXNlcjogewogICAgICAgICAgICBpZDogY29va2llLmNyZWF0b3IsCiAgICAgICAgICAgIG5hbWU6IGNvb2tpZS5lbWFpbAogICAgICAgIH0sCiAgICAgICAgaXRlbUxpbmVzOiBbXSwKICAgICAgICB0ZW1wbGF0ZXM6IFsKICAgICAgICAgICAge3RpdGxlOiAnRHJhZnQnfSwKICAgICAgICAgICAge3RpdGxlOiAnT3Blbid9LAogICAgICAgICAgICB7dGl0bGU6ICdQYXJ0aWFsbHkgQ2xvc2VkJ30sCiAgICAgICAgICAgIHt0aXRsZTogJ0Nsb3NlZCd9LAogICAgICAgIF0sCiAgICAgICAgY29sX2V4cGFuZDogOSwKICAgICAgICBjb2xfaGlkZTogMywKICAgICAgICBpc0hpZGVCYXI6IGZhbHNlLAogICAgICAgIHBheW1lbnRPcHRpb25zOiBbJ0ludm9pY2UnLCAnQ1JOJywgJ1BheW1lbnQgQ29kZScsICdDdXN0b21lciddLAogICAgICAgIG1QYXltZW50T3B0aW9uOiAnSW52b2ljZScsCiAgICAgICAgcGF5bWVudE1ldGhvZDogWydDYXNoJywgJ0NoZXF1ZSddLAogICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnN1YnN0cigwLCAxMCksCiAgICAgICAgY2FzaFJlY2VpcHQ6IGNhc2hSZWNlaXB0TW9kZWwsCiAgICAgICAgaXRlbUxpbmU6IGl0ZW1MaW5lTW9kZWwsCiAgICAgICAgc2FsZUZvcm1Db250ZW50OiB7fSwKICAgICAgICBzZWFyY2g6ICcnLAogICAgICAgIHRyYW5zYWN0aW9uVHlwZXM6IFtdLAogICAgICAgIGN1c3RvbWVyczogW10sCiAgICAgICAgbUN1c3RvbWVyOiB7fSwKICAgICAgICBkZWZhdWx0SXRlbTogZGVmYXVsdEl0ZW0sCiAgICAgICAgY3VzQmFzZVVybDogY3VzdG9tZXJIYW5kbGVyLnNlYXJjaCgpLAogICAgICAgIGZpbHRlcjogJycsCiAgICAgICAgbmFtZTogJycsCiAgICAgICAgcmVmZXJlbmNlTm86ICcnLAogICAgICAgIG9sZFRvdGFsOiAwLAogICAgICAgIGRhdGVGb3JtYXQ6IGl0ZW1MaW5lTW9kZWwuZGF0ZUZvcm1hdCwKICAgICAgICBncm91cDoge2ZpZWxkOiAnY3VzdG9tZXIubmFtZSd9LAogICAgICAgIGJhbmtzOiBbXSwKICAgICAgICB0eG5MaXN0OiBbXSwKICAgICAgICBjdXJyZW5jeUNvZGU6ICcnLAogICAgICAgIHRyYW5zYWN0aW9uUmF0ZTogMSwKICAgICAgICBzY2hlbWFEZWZpbml0aW9uOiB7CiAgICAgICAgICAgIG1vZGVsOiB7CiAgICAgICAgICAgICAgICBpZDogImlkIiwKICAgICAgICAgICAgICAgIGZpZWxkczogewogICAgICAgICAgICAgICAgICAgIGlkOiB7ZWRpdGFibGU6IGZhbHNlfSwKICAgICAgICAgICAgICAgICAgICBjaGVjazoge3R5cGU6ICdib29sZWFuJ30sCiAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlTm86IHtlZGl0YWJsZTogZmFsc2V9LAogICAgICAgICAgICAgICAgICAgIGFtb3VudDoge3R5cGU6ICdudW1iZXInfSwKICAgICAgICAgICAgICAgICAgICBhbW91bnRUb2JlUGFpZDoge3R5cGU6ICdudW1iZXInfSwKICAgICAgICAgICAgICAgICAgICBvdmVyRHVlOiB7dHlwZTogJ251bWJlcid9LAogICAgICAgICAgICAgICAgICAgIGNybjoge3R5cGU6ICdzdHJpbmcnfSwKICAgICAgICAgICAgICAgICAgICBwYWlkQW1vdW50OiB7dHlwZTogJ251bWJlcid9LAogICAgICAgICAgICAgICAgICAgIGRpc2NvdW50OiB7dHlwZTogJ251bWJlcid9LAogICAgICAgICAgICAgICAgICAgIHBlbmFsdHk6IHt0eXBlOiAnbnVtYmVyJ30sCiAgICAgICAgICAgICAgICAgICAgcGF5bWVudENvZGU6IHt0eXBlOiAnbnVtYmVyJ30KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYmFzZUN1cnJlbmN5OiB7fSwKICAgICAgICBiYXNlQ3VycmVuY3lDb2RlOiAnJywKICAgICAgICBqUmF3OiBbXSwKICAgICAgICBnYWluTG9zc0FjYzoge30sCiAgICAgICAgb3RoZXJSZXZlbnVlQWNjOiB7fSwKICAgICAgICBnYWluT3JMb3NzRGVzY3JpcHRpb246ICdnYWluL2xvc3Mgb24gZXhjaGFuZ2UgcmF0ZScsCiAgICAgICAgcGVuYWx0eURlc2NyaXB0aW9uOiAncGVuYWx0eScsCiAgICAgICAgY3I6IDAsCiAgICAgICAgZHI6IDAsCgogICAgfSksCiAgICBtZXRob2RzOiB7CiAgICAgICAgbmFtZVRlbXBsYXRlKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhkYXRhSXRlbSwgJzp0ZXh0LWZpZWxkJykKICAgICAgICAgICAgY29uc3QgY3VzdG9tZXIgPSBkYXRhSXRlbS5jdXN0b21lciB8fCB7fQogICAgICAgICAgICBjb25zdCBuYW1lID0gY3VzdG9tZXIubmFtZSB8fCAnJwogICAgICAgICAgICBjb25zdCBudW1iZXIgPSBjdXN0b21lci5udW1iZXIgfHwgJycKICAgICAgICAgICAgcmV0dXJuIG51bWJlciArICcgLSAnICsgbmFtZQogICAgICAgIH0sCiAgICAgICAgX3ByaW50KGlkKSB7CiAgICAgICAgICAgIGxldCBwcmludF9kYXRhID0gdGhpcy5jYXNoUmVjZWlwdDsKICAgICAgICAgICAgcHJpbnRfZGF0YVsnYmFzZUN1cnJlbmN5Q29kZSddID0gdGhpcy5iYXNlQ3VycmVuY3lDb2RlCiAgICAgICAgICAgIGxldCBwYXJhbXMgPSAiP2Zvcm1UeXBlPUNhc2hSZWNlaXB0IgogICAgICAgICAgICBnZXRGb3JtU2V0dGluZyhwYXJhbXMpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuZGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhyZXMuZGF0YS5kYXRhWyIwIl0uc2V0dGluZ3MpOwogICAgICAgICAgICAgICAgICAgICAgICBwcmludChwcmludF9kYXRhLCBpZCwgcmVzLmRhdGEuZGF0YVsiMCJdLnNldHRpbmdzKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LmVycm9yKGkxOG4udCgncGxlYXNlX3NhdmVfZm9ybV9pbl9zZXR0aW5nJykpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIHJlbW92ZUR1cGxpY2F0ZShhcnJheSkgewogICAgICAgICAgICBjb25zdCByZXN1bHQgPSBbXTsKICAgICAgICAgICAgY29uc3QgbWFwID0gbmV3IE1hcCgpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgYXJyYXkpIHsKICAgICAgICAgICAgICAgIGlmICghbWFwLmhhcyhpdGVtLmlkKSkgewogICAgICAgICAgICAgICAgICAgIG1hcC5zZXQoaXRlbS5pZCwgdHJ1ZSk7ICAgIC8vIHNldCBhbnkgdmFsdWUgdG8gTWFwCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goaXRlbSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgICAgfSwKICAgICAgICBjcm5UbXAoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgaWYgKGRhdGFJdGVtKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaGFzT3duUHJvcGVydHkoJ2NybicpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFJdGVtLmNybgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAnJwogICAgICAgIH0sCiAgICAgICAgY3VycmVuY3koZGF0YUl0ZW0pIHsKICAgICAgICAgICAgaWYgKGRhdGFJdGVtKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaGFzT3duUHJvcGVydHkoJ2N1cnJlbmN5Q29kZScpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFJdGVtLmN1cnJlbmN5Q29kZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAnJwogICAgICAgIH0sCiAgICAgICAgcGF5bWVudENvZGVUbXAoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgaWYgKGRhdGFJdGVtKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaGFzT3duUHJvcGVydHkoJ3BheW1lbnRDb2RlJykpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YUl0ZW0ucGF5bWVudENvZGUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJycKICAgICAgICB9LAogICAgICAgIHJlZmVyZW5jZU5vVG1wKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGlmIChkYXRhSXRlbSkgewogICAgICAgICAgICAgICAgaWYgKGRhdGFJdGVtLmhhc093blByb3BlcnR5KCdyZWZlcmVuY2VObycpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFJdGVtLnJlZmVyZW5jZU5vCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgfSwKICAgICAgICBwYWlkQW1vdW50VG1wKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGlmIChkYXRhSXRlbSkgewogICAgICAgICAgICAgICAgaWYgKGRhdGFJdGVtLmhhc093blByb3BlcnR5KCdwYWlkQW1vdW50JykpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcoZGF0YUl0ZW0ucGFpZEFtb3VudCB8fCAwLCBkYXRhSXRlbS5kZWNpbWFsRm9ybWF0KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgfSwKICAgICAgICBhbW91bnRUb2JlUGFpZChkYXRhSXRlbSkgewogICAgICAgICAgICBpZiAoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgICAgIGlmIChkYXRhSXRlbS5oYXNPd25Qcm9wZXJ0eSgnYW1vdW50VG9iZVBhaWQnKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyhkYXRhSXRlbS5hbW91bnRUb2JlUGFpZCB8fCAwLCBkYXRhSXRlbS5kZWNpbWFsRm9ybWF0KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgfSwKICAgICAgICBkaXNjb3VudChkYXRhSXRlbSkgewogICAgICAgICAgICBpZiAoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgICAgIGlmIChkYXRhSXRlbS5oYXNPd25Qcm9wZXJ0eSgnZGlzY291bnQnKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyhkYXRhSXRlbS5kaXNjb3VudCB8fCAwLCBkYXRhSXRlbS5kZWNpbWFsRm9ybWF0KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgfSwKICAgICAgICBhbW91bnQoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgaWYgKGRhdGFJdGVtKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaGFzT3duUHJvcGVydHkoJ2Ftb3VudCcpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGtlbmRvLnRvU3RyaW5nKGRhdGFJdGVtLmFtb3VudCB8fCAwLCBkYXRhSXRlbS5kZWNpbWFsRm9ybWF0KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgfSwKICAgICAgICBwZW5hbHR5KGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGlmIChkYXRhSXRlbSkgewogICAgICAgICAgICAgICAgaWYgKGRhdGFJdGVtLmhhc093blByb3BlcnR5KCdwZW5hbHR5JykpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcoZGF0YUl0ZW0ucGVuYWx0eSB8fCAwLCBkYXRhSXRlbS5kZWNpbWFsRm9ybWF0KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgfSwKICAgICAgICBiYW5rUmVmZXJlbmNlTm8oZGF0YUl0ZW0pIHsKICAgICAgICAgICAgaWYgKGRhdGFJdGVtKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaGFzT3duUHJvcGVydHkoJ2JhbmtSZWZlcmVuY2VObycpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFJdGVtLmJhbmtSZWZlcmVuY2VObwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAnJwogICAgICAgIH0sCiAgICAgICAgb3ZlckR1ZShkYXRhSXRlbSkgewogICAgICAgICAgICBpZiAoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgICAgIGlmIChkYXRhSXRlbS5oYXNPd25Qcm9wZXJ0eSgnb3ZlckR1ZScpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFJdGVtLm92ZXJEdWUgfHwgMAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgfSwKICAgICAgICAvLyBhc3luYyBsb2FkVHJhbnNhY3Rpb25SYXRlKGNvZGUpIHsKICAgICAgICAvLyAgICAgbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7CiAgICAgICAgLy8gICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAvLyAgICAgICAgICAgICByZXNvbHZlKCdyZXNvbHZlZCcpCiAgICAgICAgLy8gICAgICAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHRoaXMudHJhbnNhY3Rpb25EYXRlKS50b0lTT1N0cmluZygpLnN1YnN0cigwLCAxMCkKICAgICAgICAvLyAgICAgICAgICAgICAvLyBjb25zdCBwcmljZUxldmVsID0gdGhpcy5pbnZvaWNlLnByaWNlTGV2ZWwKICAgICAgICAvLyAgICAgICAgICAgICBpZiAoY29kZSAhPT0gdW5kZWZpbmVkIHx8IGNvZGUgIT09ICcnKSB7CiAgICAgICAgLy8gICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlCiAgICAgICAgLy8gICAgICAgICAgICAgICAgIGN1cnJlbmN5SGFuZGxlci5nZXRMYXN0RXhjaGFuZ2VSYXRlQnlEYXRlKGRhdGUsIGNvZGUpLnRoZW4ocmVzID0+IHsKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBleGNoYW5nZVJhdGUgPSByZXMuZGF0YS5kYXRhCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW5jeUNvZGUgPSBleGNoYW5nZVJhdGUuY29kZQogICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb25SYXRlID0gZXhjaGFuZ2VSYXRlLnJhdGUKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhc2hSZWNlaXB0LnR4blJhdGUgPSBleGNoYW5nZVJhdGUucmF0ZQogICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FzaFJlY2VpcHQuZXhjaGFuZ2VSYXRlID0gZXhjaGFuZ2VSYXRlCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgLy8gICAgICAgICAgICAgICAgIH0pCiAgICAgICAgLy8gICAgICAgICAgICAgfQogICAgICAgIC8vCiAgICAgICAgLy8gICAgICAgICB9LCAxMCkKICAgICAgICAvLyAgICAgfSkKICAgICAgICAvLyB9LAogICAgICAgIGFzeW5jIGluaXREYXRhKCkgewogICAgICAgICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHF1ZXJ5U3RyaW5nID0gdGhpcy4kcm91dGUucXVlcnkKICAgICAgICAgICAgICAgIGxldCB0eXBlID0gJycKICAgICAgICAgICAgICAgIGxldCBvcHRpb24gPSAwCiAgICAgICAgICAgICAgICBpZiAocXVlcnlTdHJpbmcuaGFzT3duUHJvcGVydHkoJ3R5cGUnKSkgewogICAgICAgICAgICAgICAgICAgIHR5cGUgPSBxdWVyeVN0cmluZy50eXBlCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uID0gcXVlcnlTdHJpbmcub3B0aW9uCiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdwbXQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubVBheW1lbnRPcHRpb24gPSBvcHRpb24KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWFyY2ggPSB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hJbnZvaWNlKCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMubG9hZENhc2hSZWNlaXB0VmlldygpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5pbml0Um93KCkKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcGFpZEFtb3VudEVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8ualF1ZXJ5KCc8aW5wdXQgZGF0YS1iaW5kPSJ2YWx1ZTonICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb051bWVyaWNUZXh0Qm94KHsKICAgICAgICAgICAgICAgICAgICBkZWNpbWFsczogMzAsCiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBgbiR7dGhpcy5zYWxlRm9ybUNvbnRlbnQuZGVjaW1hbH1gLAogICAgICAgICAgICAgICAgICAgIG1pbjogMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBkaXNjb3VudEVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8ualF1ZXJ5KCc8aW5wdXQgZGF0YS1iaW5kPSJ2YWx1ZTonICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb051bWVyaWNUZXh0Qm94KHsKICAgICAgICAgICAgICAgICAgICBkZWNpbWFsczogMzAsCiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBgbiR7dGhpcy5zYWxlRm9ybUNvbnRlbnQuZGVjaW1hbH1gLAogICAgICAgICAgICAgICAgICAgIG1pbjogMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBwZW5hbHR5RWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kby5qUXVlcnkoJzxpbnB1dCBkYXRhLWJpbmQ9InZhbHVlOicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvTnVtZXJpY1RleHRCb3goewogICAgICAgICAgICAgICAgICAgIGRlY2ltYWxzOiAzMCwKICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IGBuJHt0aGlzLnNhbGVGb3JtQ29udGVudC5kZWNpbWFsfWAsCiAgICAgICAgICAgICAgICAgICAgbWluOiAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIG9uVHJhbnNhY3Rpb25EYXRlQ2hhbmdlZCgpIHsKICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZU51bWJlcigpCiAgICAgICAgICAgIHRoaXMuc2VhcmNoSW52b2ljZSgpCiAgICAgICAgfSwKICAgICAgICBnZW5lcmF0ZU51bWJlcigpIHsKICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCkgewogICAgICAgICAgICAgICAgY29uc3QgdHJhbkRhdGUgPSBuZXcgRGF0ZSh0aGlzLmNhc2hSZWNlaXB0LnRyYW5zYWN0aW9uRGF0ZSkKICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlUmVjZWlwdCA9IG5ldyBEYXRlKHRoaXMuY2FzaFJlY2VpcHQudHJhbnNhY3Rpb25EYXRlKQogICAgICAgICAgICAgICAgY29uc3QgdHJhbkRhdGVNID0gdHJhbkRhdGUuZ2V0RnVsbFllYXIoKSArIHRyYW5EYXRlLmdldE1vbnRoKCkKICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlUmVjZWlwdE0gPSB0cmFuRGF0ZVJlY2VpcHQuZ2V0RnVsbFllYXIoKSArIHRyYW5EYXRlUmVjZWlwdC5nZXRNb250aCgpCiAgICAgICAgICAgICAgICBpZiAodHJhbkRhdGVNID09PSB0cmFuRGF0ZVJlY2VpcHRNKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXNoUmVjZWlwdC5yZWZlcmVuY2VObyA9IHRoaXMucmVmZXJlbmNlTm8KICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5jYXNoUmVjZWlwdC50cmFuc2FjdGlvbkRhdGUgIT09ICcnICYmIHRoaXMudHJhbnNhY3Rpb25UeXBlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICBhYmJyOiB0aGlzLmNhc2hSZWNlaXB0LnRyYW5zYWN0aW9uVHlwZS5hYmJyLAogICAgICAgICAgICAgICAgICAgIHN0cnVjdHVyZTogdGhpcy5jYXNoUmVjZWlwdC50cmFuc2FjdGlvblR5cGUuc3RydWN0dXJlLAogICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogdGhpcy5jYXNoUmVjZWlwdC50cmFuc2FjdGlvbkRhdGUsCiAgICAgICAgICAgICAgICAgICAgc2VxdWNlbmNpbmc6IHRoaXMuY2FzaFJlY2VpcHQudHJhbnNhY3Rpb25UeXBlLnNlcXVjZW5jaW5nLAogICAgICAgICAgICAgICAgICAgIHByZWZpeFNlcGFyYXRvcjogdGhpcy5jYXNoUmVjZWlwdC50cmFuc2FjdGlvblR5cGUucHJlZml4U2VwYXJhdG9yIHx8ICcnLAogICAgICAgICAgICAgICAgICAgIG51bWJlclNlcGFyYXRvcjogdGhpcy5jYXNoUmVjZWlwdC50cmFuc2FjdGlvblR5cGUubnVtYmVyU2VwYXJhdG9yIHx8ICcnLAogICAgICAgICAgICAgICAgICAgIGZvcm1hdDogdGhpcy5jYXNoUmVjZWlwdC50cmFuc2FjdGlvblR5cGUuZm9ybWF0IHx8IDUsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0Nhc2ggUmVjZWlwdCcsCiAgICAgICAgICAgICAgICAgICAgZW50aXR5OiAxCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBiaWxsaW5nSGFuZGxlci5sYXN0TnVtYmVyKGRhdGEpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXMgPSByZXNwb25zZS5kYXRhLmRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGFzdE51bWJlciA9IHRoaXMuemVyb1BhZChwYXJzZUludChyZXMubGFzdE51bWJlciksIHRoaXMuY2FzaFJlY2VpcHQudHJhbnNhY3Rpb25UeXBlLmZvcm1hdCkKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbnVtYmVyID0gcmVzLnN1ZmZpeCArIHRoaXMuY2FzaFJlY2VpcHQudHJhbnNhY3Rpb25UeXBlLm51bWJlclNlcGFyYXRvciArIGxhc3ROdW1iZXIKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXNoUmVjZWlwdC5udW1iZXIgPSBudW1iZXIKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2FzaFJlY2VpcHQudHJhbnNhY3Rpb25UeXBlLmhhc093blByb3BlcnR5KCdwcmVmaXhTZXBhcmF0b3InKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJlZml4U2VwID0gdGhpcy5jYXNoUmVjZWlwdC50cmFuc2FjdGlvblR5cGUucHJlZml4U2VwYXJhdG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhc2hSZWNlaXB0LnJlZmVyZW5jZU5vID0gdGhpcy5jYXNoUmVjZWlwdC50cmFuc2FjdGlvblR5cGUuYWJiciArIHByZWZpeFNlcCArIG51bWJlcgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvcnMucHVzaChlKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgemVyb1BhZChudW0sIHBsYWNlcykgewogICAgICAgICAgICByZXR1cm4gU3RyaW5nKG51bSkucGFkU3RhcnQocGxhY2VzLCAnMCcpCiAgICAgICAgfSwKICAgICAgICBnZXRDaXJjdWxhclJlcGxhY2VyKCkgewogICAgICAgICAgICBjb25zdCBzZWVuID0gbmV3IFdlYWtTZXQoKTsKICAgICAgICAgICAgcmV0dXJuIChrZXksIHZhbHVlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAib2JqZWN0IiAmJiB2YWx1ZSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGlmIChzZWVuLmhhcyh2YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBzZWVuLmFkZCh2YWx1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBhdXRvQ2FsY3VsYXRlKCkgewogICAgICAgICAgICAvL3RvZG86IG5vdGUgOiByYXRlVG9iYXNlIGlzIGNhc2ggcmVjZWlwdCByYXRlICwgdHhuUmF0ZSBpcyBpbnZvaWNlIHJhdGUKICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5jYXNoUmVjZWlwdEl0ZW1MaW5lRFMua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIHJlY2VpcHRBbW91bnQgPSAwLCBkaXNjb3VudCA9IDAsIHBlbmFsdHkgPSAwLCBjb252ZXJ0ZWRBbW91bnQgPSAwLCBleGNoYW5nZURpc2NvdW50ID0gMCwKICAgICAgICAgICAgICAgIGV4Y2hhbmdlUGVuYWx0eSA9IDAsIHBhaWRBbW91bnRUeG4gPSAwLCBleGNoYW5nZVBlbmFsdHlUeG4gPSAwLCBleGNoYW5nZURpc2NvdW50VHhuID0gMAogICAgICAgICAgICBjb25zdCByb3cgPSBkcy5kYXRhKCkuZmlsdGVyKG4gPT4gbi5wYWlkQW1vdW50ID4gMCkKICAgICAgICAgICAgdGhpcy5qUmF3ID0gW10KICAgICAgICAgICAgcm93LmZvckVhY2godmFsdWUgPT4gewogICAgICAgICAgICAgICAgbGV0IHBhaWRBbXQgPSAwLCBuYXR1cmUgPSAnJywgaW52UmF0ZSA9IDAsIHJlY2VpcHRSYXRlID0gMCwgcmF3UGFpZEFtb3VudCA9IDAsIHJhd0Rpc2NvdW50QW1vdW50ID0gMCwKICAgICAgICAgICAgICAgICAgICByYXdQZW5hbHR5QW1vdW50ID0gMCwgY3VycmVuY3lDb2RlID0gJycKICAgICAgICAgICAgICAgIGxldCBkaXNjb3VudEFtb3VudCA9IDAsIGFyQW1vdW50ID0gMCwgcmVmTm8gPSAnJywgcGF5T3B0aW9uID0ge30sIHBlbmFsdHlBbW91bnQgPSAwLAogICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5ID0ge30sIGdhaW5Mb3NzID0gMCwgbGFzdFhSYXRlID0ge30sIGxvY2F0aW9uID0ge30sIHNlZ21lbnQgPSB7fSwgcHJvamVjdCA9IHt9LAogICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uSWQgPSAnJywgc2VnbWVudElkID0gJycsIHByb2plY3RJZCA9ICcnLCB0eG5JZCA9ICcnCiAgICAgICAgICAgICAgICBpZiAodmFsdWUucmVmZXJlbmNlTm8pIHsKICAgICAgICAgICAgICAgICAgICByZWZObyA9IHZhbHVlLnJlZmVyZW5jZU5vCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodmFsdWUuaWQpIHsKICAgICAgICAgICAgICAgICAgICB0eG5JZCA9IHZhbHVlLmlkIHx8ICcnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodmFsdWUudHhuUmF0ZSkgewogICAgICAgICAgICAgICAgICAgIGludlJhdGUgPSBwYXJzZUZsb2F0KHZhbHVlLnR4blJhdGUpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodmFsdWUuY3VycmVuY3lDb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlID0gKHZhbHVlLmN1cnJlbmN5Q29kZSkgfHwgJycKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5jdXJyZW5jeSkgewogICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5ID0gKHZhbHVlLmN1cnJlbmN5KSB8fCB7fQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHZhbHVlLmxvY2F0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24gPSAodmFsdWUubG9jYXRpb24pIHx8IHt9CiAgICAgICAgICAgICAgICAgICAgaWYgKGxvY2F0aW9uLmhhc093blByb3BlcnR5KCdpZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uSWQgPSBsb2NhdGlvbi5pZAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5zZWdtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgc2VnbWVudCA9ICh2YWx1ZS5zZWdtZW50KSB8fCB7fQogICAgICAgICAgICAgICAgICAgIGlmIChzZWdtZW50Lmhhc093blByb3BlcnR5KCdpZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnRJZCA9IHNlZ21lbnQuaWQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodmFsdWUucHJvamVjdCkgewogICAgICAgICAgICAgICAgICAgIHByb2plY3QgPSAodmFsdWUucHJvamVjdCkgfHwge30KICAgICAgICAgICAgICAgICAgICBpZiAocHJvamVjdC5oYXNPd25Qcm9wZXJ0eSgnaWQnKSkgewogICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0SWQgPSBwcm9qZWN0LmlkCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHZhbHVlLmV4Y2hhbmdlUmF0ZSkgewogICAgICAgICAgICAgICAgICAgIGxhc3RYUmF0ZSA9ICh2YWx1ZS5leGNoYW5nZVJhdGUpIHx8IHt9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodmFsdWUucmF0ZVRvYmFzZSkgewogICAgICAgICAgICAgICAgICAgIHJlY2VpcHRSYXRlID0gcGFyc2VGbG9hdCh2YWx1ZS5yYXRlVG9iYXNlKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHZhbHVlLnBhaWRBbW91bnQpIHsKICAgICAgICAgICAgICAgICAgICByZWNlaXB0QW1vdW50ICs9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucGFpZEFtb3VudCkKICAgICAgICAgICAgICAgICAgICBjb252ZXJ0ZWRBbW91bnQgKz0gKGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucGFpZEFtb3VudCkgKiByZWNlaXB0UmF0ZSkKICAgICAgICAgICAgICAgICAgICBwYWlkQW1vdW50VHhuICs9IChrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnBhaWRBbW91bnQpICogaW52UmF0ZSkKICAgICAgICAgICAgICAgICAgICBwYWlkQW10ID0ga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5wYWlkQW1vdW50KSAqIHJlY2VpcHRSYXRlCiAgICAgICAgICAgICAgICAgICAgcmF3UGFpZEFtb3VudCA9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucGFpZEFtb3VudCkKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coJ2NvbnZlcnRlZEFtb3VudCcsIGNvbnZlcnRlZEFtb3VudCwgJy0nLCByZWNlaXB0UmF0ZSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5kaXNjb3VudCkgewogICAgICAgICAgICAgICAgICAgIC8vIGRpc2NvdW50ICs9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuZGlzY291bnQpCiAgICAgICAgICAgICAgICAgICAgZGlzY291bnQgKz0gKGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuZGlzY291bnQpICogcmVjZWlwdFJhdGUpCiAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VEaXNjb3VudCArPSAoa2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5leGNoYW5nZURpc2NvdW50KSAqIHJlY2VpcHRSYXRlKQogICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlRGlzY291bnRUeG4gKz0gKGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuZGlzY291bnQpICogaW52UmF0ZSkKICAgICAgICAgICAgICAgICAgICBkaXNjb3VudEFtb3VudCA9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuZGlzY291bnQpICogcmVjZWlwdFJhdGUKICAgICAgICAgICAgICAgICAgICByYXdEaXNjb3VudEFtb3VudCA9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuZGlzY291bnQpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodmFsdWUucGVuYWx0eSkgewogICAgICAgICAgICAgICAgICAgIC8vIHBlbmFsdHkgKz0ga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5wZW5hbHR5KQogICAgICAgICAgICAgICAgICAgIHBlbmFsdHkgKz0gKGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucGVuYWx0eSkgKiByZWNlaXB0UmF0ZSkKICAgICAgICAgICAgICAgICAgICBwZW5hbHR5QW1vdW50ID0gKGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucGVuYWx0eSkpICogcmVjZWlwdFJhdGUKICAgICAgICAgICAgICAgICAgICBleGNoYW5nZVBlbmFsdHkgKz0gKGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuZXhjaGFuZ2VQZW5hbHR5KSAqIHJlY2VpcHRSYXRlKQogICAgICAgICAgICAgICAgICAgIHJhd1BlbmFsdHlBbW91bnQgPSBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnBlbmFsdHkpCiAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VQZW5hbHR5VHhuICs9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucGVuYWx0eSkgKiBpbnZSYXRlCiAgICAgICAgICAgICAgICAgICAgLy8gdG9kbzogT3RoZXIgUmV2ZW51ZSBQZW5hbHR5CiAgICAgICAgICAgICAgICAgICAgaWYgKHBlbmFsdHlBbW91bnQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwZW5hbHR5QW1vdW50ICogLTEgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAnZHInCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAnY3InCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3RoZXJSZXZlbnVlQWNjLmhhc093blByb3BlcnR5KCdpZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvYmogPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRoaXMub3RoZXJSZXZlbnVlQWNjLmlkICsgJy0nICsgbmF0dXJlICsgJy0nICsgY3VycmVuY3lDb2RlICsgJy0nICsgaW52UmF0ZSArICctJyArIGxvY2F0aW9uSWQgKyAnLScgKyBwcm9qZWN0SWQgKyAnLScgKyBzZWdtZW50SWQgKyAnLScgKyB0eG5JZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eG5JZDogdHhuSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdElkOiBwcm9qZWN0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25JZDogbG9jYXRpb25JZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50SWQ6IHNlZ21lbnRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUNvZGU6IGN1cnJlbmN5Q29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFhSYXRlOiBsYXN0WFJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlTm86IHJlZk5vLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogdmFsdWUudHJhbnNhY3Rpb25EYXRlIHx8ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBheW1lbnRPcHRpb246IHZhbHVlLnBheW1lbnRPcHRpb24gfHwgJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFua1JlZmVyZW5jZU5vOiB2YWx1ZS5iYW5rUmVmZXJlbmNlTm8gfHwgJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGluZTogbmV3IEl0ZW1MaW5lTW9kZWwodmFsdWUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpcHRSYXRlOiByZWNlaXB0UmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1BlbmFsdHknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2hCYXNpY0VudHJpZXM6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IHRoaXMub3RoZXJSZXZlbnVlQWNjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRJZDogdGhpcy5vdGhlclJldmVudWVBY2MuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiByYXdQZW5hbHR5QW1vdW50ICogLTEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQ6IHBlbmFsdHlBbW91bnQgKiAtMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZUFzOiAnUGVuYWx0eScKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iakNhc2hCYXNpYyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogdGhpcy5vdGhlclJldmVudWVBY2MuaWQgKyAnLScgKyBuYXR1cmUgKyAnLScgKyBjdXJyZW5jeUNvZGUgKyAnLScgKyBpbnZSYXRlICsgJy0nICsgbG9jYXRpb25JZCArICctJyArIHByb2plY3RJZCArICctJyArIHNlZ21lbnRJZCArICctJyArIHR4bklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4bklkOiB0eG5JZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0SWQ6IHByb2plY3RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbklkOiBsb2NhdGlvbklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnRJZDogc2VnbWVudElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5Q29kZTogY3VycmVuY3lDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiBjdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0WFJhdGU6IGxhc3RYUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VObzogcmVmTm8sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25EYXRlOiB2YWx1ZS50cmFuc2FjdGlvbkRhdGUgfHwgJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudE9wdGlvbjogdmFsdWUucGF5bWVudE9wdGlvbiB8fCAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYW5rUmVmZXJlbmNlTm86IHZhbHVlLmJhbmtSZWZlcmVuY2VObyB8fCAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBsaW5lOiBuZXcgSXRlbUxpbmVNb2RlbCh2YWx1ZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWlwdFJhdGU6IHJlY2VpcHRSYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnUGVuYWx0eScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogdGhpcy5vdGhlclJldmVudWVBY2MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudElkOiB0aGlzLm90aGVyUmV2ZW51ZUFjYy5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IHJhd1BlbmFsdHlBbW91bnQgKiAtMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogcGVuYWx0eUFtb3VudCAqIC0xLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlQXM6ICdQZW5hbHR5JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmNhc2hCYXNpY0VudHJpZXMgPSBvYmpDYXNoQmFzaWMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMualJhdy5wdXNoKG9iaikKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIHRvZG86IGdhaW4gb3IgbG9zcyBleGNoYW5nZSByYXRlCiAgICAgICAgICAgICAgICBnYWluTG9zcyA9IHBhcnNlRmxvYXQoKGludlJhdGUgLSByZWNlaXB0UmF0ZSkgKiAocmF3UGFpZEFtb3VudCArIHJhd0Rpc2NvdW50QW1vdW50IC0gcmF3UGVuYWx0eUFtb3VudCkpCiAgICAgICAgICAgICAgICBpZiAoZ2Fpbkxvc3MgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZ2Fpbkxvc3MgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hdHVyZSA9ICdkcicKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAnY3InCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygnZ2Fpbkxvc3MnLCBnYWluTG9zcywgcGFpZEFtdCwgdGhpcy5nYWluTG9zc0FjYykKICAgICAgICAgICAgICAgICAgICAvLyBpZiAoZ2Fpbkxvc3MpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5nYWluTG9zc0FjYy5oYXNPd25Qcm9wZXJ0eSgnaWQnKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvYmogPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogdGhpcy5nYWluTG9zc0FjYy5pZCArICctJyArIG5hdHVyZSArICctJyArIGN1cnJlbmN5Q29kZSArICctJyArIGludlJhdGUgKyAnLScgKyBsb2NhdGlvbklkICsgJy0nICsgcHJvamVjdElkICsgJy0nICsgc2VnbWVudElkICsgJy0nICsgdHhuSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eG5JZDogdHhuSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0SWQ6IHByb2plY3RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uSWQ6IGxvY2F0aW9uSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50SWQ6IHNlZ21lbnRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5Q29kZTogY3VycmVuY3lDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k6IGN1cnJlbmN5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFhSYXRlOiBsYXN0WFJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VObzogcmVmTm8sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbkRhdGU6IHZhbHVlLnRyYW5zYWN0aW9uRGF0ZSB8fCAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBheW1lbnRPcHRpb246IHZhbHVlLnBheW1lbnRPcHRpb24gfHwgJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYW5rUmVmZXJlbmNlTm86IHZhbHVlLmJhbmtSZWZlcmVuY2VObyB8fCAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxpbmU6IG5ldyBJdGVtTGluZU1vZGVsKHZhbHVlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpcHRSYXRlOiBnYWluTG9zcyA+IDAgPyByZWNlaXB0UmF0ZSA6IGludlJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5nYWluT3JMb3NzRGVzY3JpcHRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiB0aGlzLmdhaW5Mb3NzQWNjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzaEJhc2ljRW50cmllczoge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IHRoaXMuZ2Fpbkxvc3NBY2MuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogZ2Fpbkxvc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlQXM6ICdHYWluT3JMb3NzJwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iakNhc2hCYXNpYyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB0aGlzLmdhaW5Mb3NzQWNjLmlkICsgJy0nICsgbmF0dXJlICsgJy0nICsgY3VycmVuY3lDb2RlICsgJy0nICsgaW52UmF0ZSArICctJyArIGxvY2F0aW9uSWQgKyAnLScgKyBwcm9qZWN0SWQgKyAnLScgKyBzZWdtZW50SWQgKyAnLScgKyB0eG5JZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4bklkOiB0eG5JZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3RJZDogcHJvamVjdElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25JZDogbG9jYXRpb25JZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnRJZDogc2VnbWVudElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlOiBjdXJyZW5jeUNvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0WFJhdGU6IGxhc3RYUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5vOiByZWZObywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogdmFsdWUudHJhbnNhY3Rpb25EYXRlIHx8ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudE9wdGlvbjogdmFsdWUucGF5bWVudE9wdGlvbiB8fCAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhbmtSZWZlcmVuY2VObzogdmFsdWUuYmFua1JlZmVyZW5jZU5vIHx8ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGluZTogbmV3IEl0ZW1MaW5lTW9kZWwodmFsdWUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWlwdFJhdGU6IGdhaW5Mb3NzID4gMCA/IHJlY2VpcHRSYXRlIDogaW52UmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmdhaW5Pckxvc3NEZXNjcmlwdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IHRoaXMuZ2Fpbkxvc3NBY2MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IHRoaXMuZ2Fpbkxvc3NBY2MuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogZ2Fpbkxvc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlQXM6ICdHYWluT3JMb3NzJwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5jYXNoQmFzaWNFbnRyaWVzID0gb2JqQ2FzaEJhc2ljCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMualJhdy5wdXNoKG9iaikKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vVG9kbzogQVIgIENyCiAgICAgICAgICAgICAgICBhckFtb3VudCA9IChyYXdQYWlkQW1vdW50ICsgcmF3RGlzY291bnRBbW91bnQgLSByYXdQZW5hbHR5QW1vdW50KQogICAgICAgICAgICAgICAgaWYgKGFyQW1vdW50ICogLTEgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgbmF0dXJlID0gJ2RyJwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAnY3InCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodmFsdWUuaGFzT3duUHJvcGVydHkoJ3JlY2VpdmFibGVBY2MnKSkgewogICAgICAgICAgICAgICAgICAgIGxldCBjYXNoQmFzaWNFbnRyaWVzID0gW10KICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuaGFzT3duUHJvcGVydHkoJ2Nhc2hCYXNpY0luY29tZUFjYycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNhc2hCYXNpY0luY29tZUFjYyA9IHZhbHVlLmNhc2hCYXNpY0luY29tZUFjYyB8fCBbXQogICAgICAgICAgICAgICAgICAgICAgICBjYXNoQmFzaWNJbmNvbWVBY2MuZm9yRWFjaCgoaywgaW5kZXgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFjY291bnQgPSBrLmFjY291bnQgfHwge30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFjY291bnRJZCA9IGsuYWNjb3VudElkIHx8ICcnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhbW91bnQgPSBhckFtb3VudCAqIChrLmFtb3VudFBlcmNlbnRhZ2UgfHwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY2NvdW50SWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNoQmFzaWNFbnRyaWVzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogYWNjb3VudElkICsgJy0nICsgbmF0dXJlICsgJy0nICsgY3VycmVuY3lDb2RlICsgJy0nICsgaW52UmF0ZSArICctJyArIGxvY2F0aW9uSWQgKyAnLScgKyBwcm9qZWN0SWQgKyAnLScgKyBzZWdtZW50SWQgKyAnLScgKyB0eG5JZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHhuSWQ6IHR4bklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0SWQ6IHByb2plY3RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25JZDogbG9jYXRpb25JZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudElkOiBzZWdtZW50SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5Q29kZTogY3VycmVuY3lDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RYUmF0ZTogbGFzdFhSYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VObzogcmVmTm8sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogdmFsdWUudHJhbnNhY3Rpb25EYXRlIHx8ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXltZW50T3B0aW9uOiB2YWx1ZS5wYXltZW50T3B0aW9uIHx8ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYW5rUmVmZXJlbmNlTm86IHZhbHVlLmJhbmtSZWZlcmVuY2VObyB8fCAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGluZTogbmV3IEl0ZW1MaW5lTW9kZWwodmFsdWUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNlaXB0UmF0ZTogaW52UmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuY2FzaFJlY2VpcHQuam91cm5hbE5vdGUgfHwgcmVmTm8sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IGFjY291bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRJZDogYWNjb3VudElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IGFtb3VudCAqIC0xLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogYW1vdW50ICogLTEgKiBpbnZSYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVBczogJ0luY29tZScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlY2VpdmFibGVBY2MgPSB2YWx1ZS5yZWNlaXZhYmxlQWNjCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlY2VpdmFibGVBY2MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlY2VpdmFibGVBY2MuaGFzT3duUHJvcGVydHkoJ2lkJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMualJhdy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogcmVjZWl2YWJsZUFjYy5pZCArICctJyArIG5hdHVyZSArICctJyArIGN1cnJlbmN5Q29kZSArICctJyArIGludlJhdGUgKyAnLScgKyBsb2NhdGlvbklkICsgJy0nICsgcHJvamVjdElkICsgJy0nICsgc2VnbWVudElkICsgJy0nICsgdHhuSWQgKyAnLScgKyBpbmRleCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eG5JZDogdHhuSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdElkOiBwcm9qZWN0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25JZDogbG9jYXRpb25JZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50SWQ6IHNlZ21lbnRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUNvZGU6IGN1cnJlbmN5Q29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFhSYXRlOiBsYXN0WFJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlTm86IHJlZk5vLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogdmFsdWUudHJhbnNhY3Rpb25EYXRlIHx8ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBheW1lbnRPcHRpb246IHZhbHVlLnBheW1lbnRPcHRpb24gfHwgJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFua1JlZmVyZW5jZU5vOiB2YWx1ZS5iYW5rUmVmZXJlbmNlTm8gfHwgJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGluZTogbmV3IEl0ZW1MaW5lTW9kZWwodmFsdWUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpcHRSYXRlOiBpbnZSYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmNhc2hSZWNlaXB0LmpvdXJuYWxOb3RlIHx8IHJlZk5vLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IHJlY2VpdmFibGVBY2MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzaEJhc2ljRW50cmllczogY2FzaEJhc2ljRW50cmllc1tpbmRleF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudElkOiByZWNlaXZhYmxlQWNjLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogaW5kZXggPT09IDAgPyAoYXJBbW91bnQgKiAtMSkgOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OiBpbmRleCA9PT0gMCA/IChhckFtb3VudCAqIC0xICogaW52UmF0ZSkgOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlQXM6ICdBUicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vVG9kbzogQ2FzaCBBY2NvdW50ICBEcgogICAgICAgICAgICAgICAgaWYgKHZhbHVlLnBheW1lbnRPcHRpb24pIHsKICAgICAgICAgICAgICAgICAgICBwYXlPcHRpb24gPSB2YWx1ZS5wYXltZW50T3B0aW9uCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2FzaEFtb3VudCA9IChyYXdQYWlkQW1vdW50KSAvLysgKChpbnZSYXRlIC0gcmVjZWlwdFJhdGUpICogKHJhd1BhaWRBbW91bnQgKyByYXdEaXNjb3VudEFtb3VudCkpCiAgICAgICAgICAgICAgICAgICAgLy8gY29uc3QgY2FzaEFtb3VudCA9IHJhd1BhaWRBbW91bnQgKyAoZ2Fpbkxvc3MgKSArIHJhd1BhaWRBbW91bnQKICAgICAgICAgICAgICAgICAgICBpZiAoY2FzaEFtb3VudCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmF0dXJlID0gJ2RyJwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hdHVyZSA9ICdjcicKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHBheU9wdGlvbi5oYXNPd25Qcm9wZXJ0eSgnYWNjb3VudCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBheU9wdGlvbkFjYyA9IHBheU9wdGlvbi5hY2NvdW50IHx8IHt9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXlPcHRpb25BY2MuaGFzT3duUHJvcGVydHkoJ2lkJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iaiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogcGF5T3B0aW9uQWNjLmlkICsgJy0nICsgbmF0dXJlICsgJy0nICsgY3VycmVuY3lDb2RlICsgJy0nICsgaW52UmF0ZSArICctJyArIGxvY2F0aW9uSWQgKyAnLScgKyBwcm9qZWN0SWQgKyAnLScgKyBzZWdtZW50SWQgKyAnLScgKyB0eG5JZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eG5JZDogdHhuSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdElkOiBwcm9qZWN0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25JZDogbG9jYXRpb25JZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50SWQ6IHNlZ21lbnRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUNvZGU6IGN1cnJlbmN5Q29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFhSYXRlOiBsYXN0WFJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlTm86IHJlZk5vLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogdmFsdWUudHJhbnNhY3Rpb25EYXRlIHx8ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBheW1lbnRPcHRpb246IHZhbHVlLnBheW1lbnRPcHRpb24gfHwgJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFua1JlZmVyZW5jZU5vOiB2YWx1ZS5iYW5rUmVmZXJlbmNlTm8gfHwgJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWlwdFJhdGU6IGludlJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuY2FzaFJlY2VpcHQuam91cm5hbE5vdGUgfHwgcmVmTm8sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogcGF5T3B0aW9uQWNjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRJZDogcGF5T3B0aW9uQWNjLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogY2FzaEFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNoQmFzaWNFbnRyaWVzOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogY2FzaEFtb3VudCAqIHJlY2VpcHRSYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlQXM6ICdDYXNoQWNjb3VudCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iakNhc2hCYXNpY0VudHJ5ID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBwYXlPcHRpb25BY2MuaWQgKyAnLScgKyBuYXR1cmUgKyAnLScgKyBjdXJyZW5jeUNvZGUgKyAnLScgKyBpbnZSYXRlICsgJy0nICsgbG9jYXRpb25JZCArICctJyArIHByb2plY3RJZCArICctJyArIHNlZ21lbnRJZCArICctJyArIHR4bklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4bklkOiB0eG5JZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0SWQ6IHByb2plY3RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbklkOiBsb2NhdGlvbklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnRJZDogc2VnbWVudElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5Q29kZTogY3VycmVuY3lDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiBjdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0WFJhdGU6IGxhc3RYUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VObzogcmVmTm8sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25EYXRlOiB2YWx1ZS50cmFuc2FjdGlvbkRhdGUgfHwgJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudE9wdGlvbjogdmFsdWUucGF5bWVudE9wdGlvbiB8fCAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYW5rUmVmZXJlbmNlTm86IHZhbHVlLmJhbmtSZWZlcmVuY2VObyB8fCAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNlaXB0UmF0ZTogaW52UmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5jYXNoUmVjZWlwdC5qb3VybmFsTm90ZSB8fCByZWZObywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiBwYXlPcHRpb25BY2MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudElkOiBwYXlPcHRpb25BY2MuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBjYXNoQW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OiBjYXNoQW1vdW50ICogcmVjZWlwdFJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogbmF0dXJlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVBczogJ0Nhc2hBY2NvdW50JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmNhc2hCYXNpY0VudHJpZXMgPSBvYmpDYXNoQmFzaWNFbnRyeQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gb2JqLmNhc2hCYXNpY0VudHJpZXMgPSBvYmpDYXNoQmFzaWNFbnRyeQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGV0IG9iajEgPSBvYmoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9iajFbJ2Nhc2hCYXNpY0VudHJpZXMnXSA9IG9iagogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKCdjYXNoQmFzaWNFbnRyaWVzJywgb2JqMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMualJhdy5wdXNoKG9iaikKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vVG9kbzogU2V0dGxlbWVudCBEaXNjb3VudCAgRHIKICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5wYXltZW50VGVybSkgewogICAgICAgICAgICAgICAgICAgIGlmIChkaXNjb3VudEFtb3VudCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2V0dGxlbWVudERpc2MgPSB2YWx1ZS5wYXltZW50VGVybQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGlzY291bnRBbW91bnQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAnZHInCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAnY3InCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNldHRsZW1lbnREaXNjLmhhc093blByb3BlcnR5KCdhY2NvdW50JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNldHRsZW1lbnREaXNjQWNjID0gc2V0dGxlbWVudERpc2MuYWNjb3VudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNldHRsZW1lbnREaXNjQWNjLmhhc093blByb3BlcnR5KCdpZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2JqID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogc2V0dGxlbWVudERpc2NBY2MuaWQgKyAnLScgKyBuYXR1cmUgKyAnLScgKyBjdXJyZW5jeUNvZGUgKyAnLScgKyBpbnZSYXRlICsgJy0nICsgbG9jYXRpb25JZCArICctJyArIHByb2plY3RJZCArICctJyArIHNlZ21lbnRJZCArICctJyArIHR4bklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eG5JZDogdHhuSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3RJZDogcHJvamVjdElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbklkOiBsb2NhdGlvbklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50SWQ6IHNlZ21lbnRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlOiBjdXJyZW5jeUNvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiBjdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFhSYXRlOiBsYXN0WFJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5vOiByZWZObywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25EYXRlOiB2YWx1ZS50cmFuc2FjdGlvbkRhdGUgfHwgJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBheW1lbnRPcHRpb246IHZhbHVlLnBheW1lbnRPcHRpb24gfHwgJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhbmtSZWZlcmVuY2VObzogdmFsdWUuYmFua1JlZmVyZW5jZU5vIHx8ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBsaW5lOiBuZXcgSXRlbUxpbmVNb2RlbCh2YWx1ZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpcHRSYXRlOiByZWNlaXB0UmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdSZWNlaXB0IFNldHRsZW1lbnQgRGlzY291bnQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiBzZXR0bGVtZW50RGlzY0FjYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzaEJhc2ljRW50cmllczoge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRJZDogc2V0dGxlbWVudERpc2NBY2MuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogcmF3RGlzY291bnRBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OiBkaXNjb3VudEFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogbmF0dXJlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlQXM6ICdTZXR0bGVtZW50IERpc2NvdW50JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvYmpDYXNoYmFzaWMgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBzZXR0bGVtZW50RGlzY0FjYy5pZCArICctJyArIG5hdHVyZSArICctJyArIGN1cnJlbmN5Q29kZSArICctJyArIGludlJhdGUgKyAnLScgKyBsb2NhdGlvbklkICsgJy0nICsgcHJvamVjdElkICsgJy0nICsgc2VnbWVudElkICsgJy0nICsgdHhuSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4bklkOiB0eG5JZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdElkOiBwcm9qZWN0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uSWQ6IGxvY2F0aW9uSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnRJZDogc2VnbWVudElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUNvZGU6IGN1cnJlbmN5Q29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k6IGN1cnJlbmN5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0WFJhdGU6IGxhc3RYUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlTm86IHJlZk5vLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbkRhdGU6IHZhbHVlLnRyYW5zYWN0aW9uRGF0ZSB8fCAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudE9wdGlvbjogdmFsdWUucGF5bWVudE9wdGlvbiB8fCAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFua1JlZmVyZW5jZU5vOiB2YWx1ZS5iYW5rUmVmZXJlbmNlTm8gfHwgJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxpbmU6IG5ldyBJdGVtTGluZU1vZGVsKHZhbHVlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWlwdFJhdGU6IHJlY2VpcHRSYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1JlY2VpcHQgU2V0dGxlbWVudCBEaXNjb3VudCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IHNldHRsZW1lbnREaXNjQWNjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IHNldHRsZW1lbnREaXNjQWNjLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IHJhd0Rpc2NvdW50QW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogZGlzY291bnRBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZUFzOiAnU2V0dGxlbWVudCBEaXNjb3VudCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmNhc2hCYXNpY0VudHJpZXMgPSBvYmpDYXNoYmFzaWMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmpSYXcucHVzaChvYmopCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC8vIHRoaXMuaW52b2ljZVR4bih0eG5JZHMpCgogICAgICAgICAgICB0aGlzLmNhc2hSZWNlaXB0LnRvdGFsID0gcmVjZWlwdEFtb3VudAogICAgICAgICAgICB0aGlzLmNhc2hSZWNlaXB0LmV4Y2hhbmdlQW1vdW50ID0gY29udmVydGVkQW1vdW50CiAgICAgICAgICAgIHRoaXMuY2FzaFJlY2VpcHQuZGlzY291bnQgPSBkaXNjb3VudAogICAgICAgICAgICB0aGlzLmNhc2hSZWNlaXB0LmV4Y2hhbmdlRGlzY291bnQgPSBleGNoYW5nZURpc2NvdW50CgogICAgICAgICAgICB0aGlzLmNhc2hSZWNlaXB0LnBlbmFsdHkgPSBwZW5hbHR5CgogICAgICAgICAgICB0aGlzLmNhc2hSZWNlaXB0LmV4Y2hhbmdlUGVuYWx0eVR4biA9IGV4Y2hhbmdlUGVuYWx0eVR4bgogICAgICAgICAgICB0aGlzLmNhc2hSZWNlaXB0LnBhaWRBbW91bnRUeG4gPSBwYWlkQW1vdW50VHhuCiAgICAgICAgICAgIHRoaXMuY2FzaFJlY2VpcHQuZXhjaGFuZ2VEaXNjb3VudFR4biA9IGV4Y2hhbmdlRGlzY291bnRUeG4KICAgICAgICAgICAgdGhpcy5jYXNoUmVjZWlwdC5leGNoYW5nZVBlbmFsdHkgPSBleGNoYW5nZVBlbmFsdHkKCiAgICAgICAgICAgIHRoaXMuc2hyaW5rRGF0YSh0aGlzLmpSYXcpCiAgICAgICAgICAgIC8vIGxldCBpdGVtTGluZURTID0gdGhpcy4kcmVmcy5pdGVtTGluZURTLmtlbmRvV2lkZ2V0KCkKICAgICAgICAgICAgLy8gY29uc3QgZGF0YVJvdyA9IGl0ZW1MaW5lRFMuZGF0YSgpLmZpbHRlcihuID0+IG4ucGFpZEFtb3VudCA+IDApCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLmpSYXcsICdjYXNoIGpSYXcnKQogICAgICAgIH0sCiAgICAgICAgc2hyaW5rRGF0YShvYmopIHsKICAgICAgICAgICAgY29uc3QgdW5pcXVlcyA9IHRoaXMucmVtb3ZlRHVwbGljYXRlKG9iaikgLypbLi4ubmV3IFNldChhY2NvdW50SWQubWFwKGkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBpZF86IGkuaWRfLAogICAgICAgICAgICAgICAgICAgIGlkOiBpLmlkLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IGkudHlwZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSldKi8KICAgICAgICAgICAgdW5pcXVlcy5mb3JFYWNoKG4gPT4gewogICAgICAgICAgICAgICAgY29uc3QgZm91bmQgPSBvYmouZmlsdGVyKG0gPT4gbS5pZCA9PT0gbi5pZCkKICAgICAgICAgICAgICAgIGxldCBhbW91bnQgPSAwLCBleGNoYW5nZUFtb3VudCA9IDAKICAgICAgICAgICAgICAgIGZvdW5kLmZvckVhY2goeiA9PiB7CiAgICAgICAgICAgICAgICAgICAgYW1vdW50ICs9IHBhcnNlRmxvYXQoei5hbW91bnQgfHwgMCkKICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudCArPSBwYXJzZUZsb2F0KHouZXhjaGFuZ2VBbW91bnQgfHwgMCkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBuLmV4Y2hhbmdlQW1vdW50ID0gcGFyc2VGbG9hdChleGNoYW5nZUFtb3VudCkgLy90aGlzLm51bWJlckZvcm1hdChhbW91bnQpCiAgICAgICAgICAgICAgICBuLmFtb3VudCA9IHBhcnNlRmxvYXQoYW1vdW50KSAgLy9wYXJzZUZsb2F0KHBhcnNlRmxvYXQoYW1vdW50IC8gcGFyc2VGbG9hdChuLnJlY2VpcHRSYXRlKSkpIC8vdGhpcy5udW1iZXJGb3JtYXQoYW1vdW50ICogcGFyc2VGbG9hdCh0aGlzLmludm9pY2UudHhuUmF0ZSkpIC8vLnRvRml4ZWQodGhpcy5zYWxlRm9ybUNvbnRlbnQuZGVjaW1hbCkKICAgICAgICAgICAgfSkKICAgICAgICAgICAgdGhpcy5qUmF3ID0gdW5pcXVlcwogICAgICAgICAgICBsZXQgZHIgPSAwLCBjciA9IDAKICAgICAgICAgICAgdGhpcy5qUmF3LmZvckVhY2goaiA9PiB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKGoudHlwZSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NyJzoKICAgICAgICAgICAgICAgICAgICAgICAgY3IgKz0gcGFyc2VGbG9hdChqLmV4Y2hhbmdlQW1vdW50KQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2RyJzoKICAgICAgICAgICAgICAgICAgICAgICAgZHIgKz0gcGFyc2VGbG9hdChqLmV4Y2hhbmdlQW1vdW50KQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIGNvbnN0IHR4bklkID0gdGhpcy5qUmF3Lm1hcChvID0+IG8udHhuSWQpCiAgICAgICAgICAgIHZhciB1U2V0ID0gbmV3IFNldCh0eG5JZCk7CiAgICAgICAgICAgIGNvbnN0IHVuaXF1ZVNldCA9IFsuLi51U2V0XQogICAgICAgICAgICBsZXQgalJhd3MgPSBbXQogICAgICAgICAgICB1bmlxdWVTZXQuZm9yRWFjaChuID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGZvdW5kID0gdGhpcy5qUmF3LmZpbHRlcihtID0+IG0udHhuSWQgPT09IG4pCiAgICAgICAgICAgICAgICBqUmF3cy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICBpZDogbiwKICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUNvZGU6IGZvdW5kWzBdLmN1cnJlbmN5Q29kZSwKICAgICAgICAgICAgICAgICAgICBwcm9qZWN0SWQ6IGZvdW5kWzBdLnByb2plY3RJZCwKICAgICAgICAgICAgICAgICAgICBzZWdtZW50SWQ6IGZvdW5kWzBdLnNlZ21lbnRJZCwKICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbklkOiBmb3VuZFswXS5sb2NhdGlvbklkLAogICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5vOiBmb3VuZFswXS5yZWZlcmVuY2VObywKICAgICAgICAgICAgICAgICAgICBlbnRyaWVzOiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGZvdW5kKSkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHRoaXMualJhdyA9IGpSYXdzCiAgICAgICAgICAgIHRoaXMuZHIgPSBkcgogICAgICAgICAgICB0aGlzLmNyID0gY3IKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCdkcj0nLCBkciwgJ2NyPScsIGNyLCAnZHIrY3IgPSAnLCBkciArIGNyKQogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkodGhpcy5qUmF3KSwgJ3VuaXF1ZXMnKQoKICAgICAgICB9LAogICAgICAgIGludm9pY2VUeG4oKSB7CiAgICAgICAgICAgIGxldCB0eG5JZHMgPSBbXSwgaWRzID0gW10KICAgICAgICAgICAgY29uc3QgZHMgPSB0aGlzLiRyZWZzLmNhc2hSZWNlaXB0SXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpCiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBkcy5kYXRhKCkKICAgICAgICAgICAgZGF0YS5mb3JFYWNoKHZhbHVlID0+IHsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5pZCkgewogICAgICAgICAgICAgICAgICAgIHR4bklkcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHZhbHVlLmlkLAogICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IDEKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICBpZHMgPSBPYmplY3QudmFsdWVzKHR4bklkcy5yZWR1Y2UoKHIsIG8pID0+IChyW28uaWRdID0gbywgciksIHt9KSkKICAgICAgICAgICAgaWRzLmZvckVhY2gobSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBsaW5lcyA9IGRhdGEuZmlsdGVyKG4gPT4gbi5pZCA9PT0gbS5pZCkKICAgICAgICAgICAgICAgIGxldCBwYWlkQW10ID0gMAogICAgICAgICAgICAgICAgbGV0IGFtb3VudFRvYmVQYWlkID0gMAogICAgICAgICAgICAgICAgbGluZXMuZm9yRWFjaCh4ID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoeC5wYWlkQW1vdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhaWRBbXQgKz0geC5wYWlkQW1vdW50CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh4LmFtb3VudFRvYmVQYWlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudFRvYmVQYWlkICs9IHguYW1vdW50VG9iZVBhaWQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgY29uc3QgcEFtdCA9IHRoaXMubnVtYmVyRm9ybWF0KHBhaWRBbXQpCiAgICAgICAgICAgICAgICBjb25zdCBhbXRUb2JlUGFpZCA9IHRoaXMubnVtYmVyRm9ybWF0KGFtb3VudFRvYmVQYWlkKQogICAgICAgICAgICAgICAgaWYgKHBBbXQgPT09IGFtdFRvYmVQYWlkKSB7CiAgICAgICAgICAgICAgICAgICAgbVsnc3RhdHVzJ10gPSAzIC8vUGFpZAogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBtWydzdGF0dXMnXSA9IDIgLy8gUGFydGlhbGx5IFBhaWQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgdGhpcy50eG5MaXN0ID0gaWRzCiAgICAgICAgfSwKICAgICAgICBpbml0Um93KCkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLmNhc2hSZWNlaXB0SXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpCiAgICAgICAgICAgIGRzLmluc2VydChbdGhpcy5pdGVtTGluZV0pCgogICAgICAgIH0sCiAgICAgICAgYXN5bmMgaW5pdEdyaWQodGhhdCkgewogICAgICAgICAgICBsZXQgZ3JpZCA9ICQoJyNncmlkQ2FzaFJlY2VpcHQnKS5kYXRhKCdrZW5kb0dyaWQnKQogICAgICAgICAgICBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoJ3Jlc29sdmVkJykKICAgICAgICAgICAgICAgICAgICAkKCcjaGVhZGVyLWNoYicpLmNoYW5nZShmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNoZWNrZWQgPSBldi50YXJnZXQuY2hlY2tlZAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gW10KICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnJvdy1jaGVja2JveCcpLmVhY2goZnVuY3Rpb24gKGlkeCwgaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoISgkKGl0ZW0pLmNsb3Nlc3QoJ3RyJykuaXMoJy5rLXN0YXRlLXNlbGVjdGVkJykpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoaXRlbSkuY2xpY2soKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbVJvdyA9ICQoaXRlbSkuY2xvc2VzdCgndHInKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZGF0YUl0ZW0gPSBncmlkLmRhdGFJdGVtKG1Sb3cpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaChkYXRhSXRlbSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGl0ZW0pLmNsaWNrKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5jaGVja2VkQ2hhbmdlZChkYXRhKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LCAxMCkKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIGxldCBjaGVja2VkSWRzID0ge30KICAgICAgICAgICAgbGV0IGRhdGEgPSBbXQogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBmdW5jdGlvbiBzZWxlY3RSb3codGhhdCkgewogICAgICAgICAgICAvLyAgICAgbGV0IGNoZWNrZWQgPSB0aGlzLmNoZWNrZWQsCiAgICAgICAgICAgIC8vICAgICAgICAgcm93ID0gJCh0aGlzKS5jbG9zZXN0KCJ0ciIpLAogICAgICAgICAgICAvLyAgICAgICAgIGdyaWQgPSAkKCcjaXRlbUxpbmUnKS5kYXRhKCdrZW5kb0dyaWQnKSwKICAgICAgICAgICAgLy8gICAgICAgICBkYXRhSXRlbSA9IGdyaWQuZGF0YUl0ZW0ocm93KQogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyAgICAgY2hlY2tlZElkc1tkYXRhSXRlbS5wYXltZW50Q29kZV0gPSBjaGVja2VkOwogICAgICAgICAgICAvLyAgICAgd2luZG93LmNvbnNvbGUubG9nKCdoZXJlJyxkYXRhSXRlbSkKICAgICAgICAgICAgLy8gICAgIGlmIChjaGVja2VkKSB7CiAgICAgICAgICAgIC8vICAgICAgICAgLy8tc2VsZWN0IHRoZSByb3cKICAgICAgICAgICAgLy8gICAgICAgICByb3cuYWRkQ2xhc3MoImstc3RhdGUtc2VsZWN0ZWQiKQogICAgICAgICAgICAvLyAgICAgICAgIGRhdGEucHVzaChkYXRhSXRlbSkKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gICAgICAgICB0aGF0LmNoZWNrZWRDaGFuZ2VkKGRhdGFJdGVtKQogICAgICAgICAgICAvLyAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gICAgICAgICAvLy1yZW1vdmUgc2VsZWN0aW9uCiAgICAgICAgICAgIC8vICAgICAgICAgcm93LnJlbW92ZUNsYXNzKCJrLXN0YXRlLXNlbGVjdGVkIikKICAgICAgICAgICAgLy8gICAgIH0KICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAvLyBpZiAoZ3JpZCkgewogICAgICAgICAgICAvLyAgICAgZ3JpZC50YWJsZS5vbigiY2xpY2siLCAiLnJvdy1jaGVja2JveCIsIHNlbGVjdFJvdyh0aGF0KSkKICAgICAgICAgICAgLy8gfQoKICAgICAgICB9LAogICAgICAgIGNoZWNrZWRDaGFuZ2VkKGRhdGEpIHsKICAgICAgICAgICAgZGF0YS5mb3JFYWNoKG0gPT4gewogICAgICAgICAgICAgICAgaWYgKHBhcnNlRmxvYXQobS5wYWlkQW1vdW50KSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIG0ucGFpZEFtb3VudCA9IG0uYW1vdW50VG9iZVBhaWQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5pdGVtTGluZXMuZmluZEluZGV4KGl0ZW0gPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiAoKG0ucGF5bWVudENvZGUgPT09IGl0ZW0ucGF5bWVudENvZGUpICYmIHBhcnNlRmxvYXQoaXRlbS5wYWlkQW1vdW50KSA9PT0gMCkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB0aGlzLml0ZW1MaW5lcy5zcGxpY2UoaW5kZXgsIDEsIG0pCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpCiAgICAgICAgfSwKICAgICAgICBoZWFkZXJUZW1wbGF0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIGA8aW5wdXQgdHlwZT0nY2hlY2tib3gnIGlkPSdoZWFkZXItY2hiJyBjbGFzcz0nay1jaGVja2JveCBoZWFkZXItY2hlY2tib3gnPmAKICAgICAgICB9LAogICAgICAgIGNoZWNrVGVtcGxhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIGA8aW5wdXQgdHlwZT0nY2hlY2tib3gnICM9ICR7ZGF0YUl0ZW0uY2hlY2t9ID8gXFwnY2hlY2tlZD0iY2hlY2tlZCJcXCcgOiAnJyAjIGNsYXNzPSdrLWNoZWNrYm94IHJvdy1jaGVja2JveCcgLz5gCiAgICAgICAgfSwKICAgICAgICBmb3JtYXREYXRlKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGlmIChkYXRhSXRlbS5oYXNPd25Qcm9wZXJ0eSgnZHVlRGF0ZScpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcobmV3IERhdGUoZGF0YUl0ZW0uZHVlRGF0ZSksIHRoaXMuZGF0ZUZvcm1hdCkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJycKICAgICAgICB9LAogICAgICAgIHNldHRsZW1lbnREaXNjb3VudChkYXRhSXRlbSkgewogICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaGFzT3duUHJvcGVydHkoJ3BheW1lbnRUZXJtJykpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhSXRlbS5wYXltZW50VGVybS5uYW1lIHx8ICcnCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgfSwKICAgICAgICBzdGF0dXMoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgaWYgKGRhdGFJdGVtKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaGFzT3duUHJvcGVydHkoJ3N0YXR1cycpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhdHVzID0gZGF0YUl0ZW0uc3RhdHVzCiAgICAgICAgICAgICAgICAgICAgbGV0IHN0YXR1c1RleHQgPSAnJwogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoc3RhdHVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c1RleHQgPSAnT1BFTicKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c1RleHQgPSAnUGFydGlhbGx5IFBhaWQnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0ID0gJ1ZPSUQnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0ID0gJ1BBSUQnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RhdHVzVGV4dAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAnJwogICAgICAgIH0sCiAgICAgICAgb25DdXN0b21lckNoYW5nZWQoZXZlbnQpIHsKICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBldmVudC52YWx1ZQogICAgICAgICAgICBpZiAodmFsdWUgJiYgdmFsdWVbdGV4dEZpZWxkXSA9PT0gZW1wdHlJdGVtW3RleHRGaWVsZF0pIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLm1DdXN0b21lciA9IHZhbHVlCiAgICAgICAgICAgIHRoaXMuY2FzaFJlY2VpcHQuY3VzdG9tZXIgPSB2YWx1ZQogICAgICAgIH0sCiAgICAgICAgb25DdXN0b21lckZpbHRlckNoYW5nZWQoZXZlbnQpIHsKICAgICAgICAgICAgY29uc3QgZmlsdGVyID0gZXZlbnQuZmlsdGVyLnZhbHVlCiAgICAgICAgICAgIHRoaXMubG9hZERhdGEoMCwgZmlsdGVyLCB0aGlzLmN1c0Jhc2VVcmwpCiAgICAgICAgICAgIHRoaXMuZmlsdGVyID0gZmlsdGVyCiAgICAgICAgfSwKICAgICAgICBsb2FkRGF0YShza2lwLCBmaWx0ZXIsIGJhc2VVcmwpIHsKICAgICAgICAgICAgY29uc3QgdXJsID0gYmFzZVVybCArCiAgICAgICAgICAgICAgICBgP2ZpbHRlcj0ke2ZpbHRlcn1gCiAgICAgICAgICAgIHRoaXMucmVxdWVzdFN0YXJ0ZWQgPSB0cnVlOwogICAgICAgICAgICBmZXRjaCh1cmwpCiAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLnRoZW4odGhpcy5hZnRlckZldGNoKQogICAgICAgIH0sCiAgICAgICAgYWZ0ZXJGZXRjaChqc29uKSB7CiAgICAgICAgICAgIHRoaXMuY3VzdG9tZXJzID0ganNvbi5kYXRhCiAgICAgICAgfSwKICAgICAgICBudW1iZXJGb3JtYXQodmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIGtlbmRvLnRvU3RyaW5nKHZhbHVlLCBgbiR7dGhpcy5zYWxlRm9ybUNvbnRlbnQuZGVjaW1hbH1gKQogICAgICAgIH0sCiAgICAgICAgcm93TnVtYmVyVG1wbChkYXRhSXRlbSkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLmNhc2hSZWNlaXB0SXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpLAogICAgICAgICAgICAgICAgaW5kZXggPSBkcy5pbmRleE9mKGRhdGFJdGVtKTsKICAgICAgICAgICAgcmV0dXJuIGluZGV4ICsgMTsKICAgICAgICB9LAogICAgICAgIGRhdGFTb3VyY2VDaGFuZ2VkKGUpIHsKICAgICAgICAgICAgbGV0IGRhdGFSb3cgPSBlLml0ZW1zWzBdIHx8IHt9CiAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhkYXRhUm93KS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgnb3B0aW9uVHlwZScsIE9QVElPTl9UWVBFKQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgbGV0IGFtb3VudFRvYmVQYWlkID0gMCwgcGFpZEFtb3VudCA9IDAsIHZhcmlhbmNlID0gMAogICAgICAgICAgICAgICAgc3dpdGNoIChlLmZpZWxkKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZGlzY291bnQiOgogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgnYW1vdW50VG9iZVBhaWQnLCAocGFyc2VGbG9hdChkYXRhUm93LmFtb3VudCkgKyBwYXJzZUZsb2F0KGRhdGFSb3cucGVuYWx0eSkpIC0gcGFyc2VGbG9hdChkYXRhUm93LmRpc2NvdW50KSkKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoJ2V4Y2hhbmdlRGlzY291bnQnLCAocGFyc2VGbG9hdChkYXRhUm93LmRpc2NvdW50KSAqIHBhcnNlRmxvYXQoZGF0YVJvdy5yYXRlVG9iYXNlKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCdleGNoYW5nZURpc2NvdW50VHhuJywgcGFyc2VGbG9hdChkYXRhUm93LmRpc2NvdW50KSAqIHBhcnNlRmxvYXQoZGF0YVJvdy50eG5SYXRlKSkKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKChwYXJzZUZsb2F0KGRhdGFSb3cuZGlzY291bnQpICogcGFyc2VGbG9hdChkYXRhUm93LnJhdGVUb2Jhc2UpKSwgJy0tLS0nKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgInBlbmFsdHkiOgogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgnYW1vdW50VG9iZVBhaWQnLCAocGFyc2VGbG9hdChkYXRhUm93LmFtb3VudCkgKyBwYXJzZUZsb2F0KGRhdGFSb3cucGVuYWx0eSkpIC0gcGFyc2VGbG9hdChkYXRhUm93LmRpc2NvdW50KSkKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoJ2V4Y2hhbmdlUGVuYWx0eScsIHBhcnNlRmxvYXQoZGF0YVJvdy5wZW5hbHR5KSAqIHBhcnNlRmxvYXQoZGF0YVJvdy5yYXRlVG9iYXNlKSkKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoJ2V4Y2hhbmdlUGVuYWx0eVR4bicsIHBhcnNlRmxvYXQoZGF0YVJvdy5wZW5hbHR5KSAqIHBhcnNlRmxvYXQoZGF0YVJvdy50eG5SYXRlKSkKCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSAicGFpZEFtb3VudCI6CiAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudFRvYmVQYWlkID0gcGFyc2VGbG9hdChkYXRhUm93LmFtb3VudFRvYmVQYWlkKQogICAgICAgICAgICAgICAgICAgICAgICBwYWlkQW1vdW50ID0gcGFyc2VGbG9hdChkYXRhUm93LnBhaWRBbW91bnQpCiAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhbmNlID0gcGFyc2VGbG9hdChkYXRhUm93LnBlbmFsdHkpIC0gcGFyc2VGbG9hdChkYXRhUm93LmRpc2NvdW50KQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFpZEFtb3VudCA+IGFtb3VudFRvYmVQYWlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWlkQW1vdW50ID0gYW1vdW50VG9iZVBhaWQKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwYWlkQW1vdW50IDwgdmFyaWFuY2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhaWRBbW91bnQgPSB2YXJpYW5jZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCdwYWlkQW1vdW50JywgcGFpZEFtb3VudCkKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoJ3BhaWRBbW91bnRUb2Jhc2UnLCAocGFpZEFtb3VudCAqIHBhcnNlRmxvYXQoZGF0YVJvdy5yYXRlVG9iYXNlKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCdwYWlkQW1vdW50VHhuJywgKHBhaWRBbW91bnQgKiBwYXJzZUZsb2F0KGRhdGFSb3cudHhuUmF0ZSkpKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5pbnZvaWNlVHhuKCkKICAgICAgICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpCgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzZWFyY2hPcHRpb25DaGFuZ2VkKCkgewogICAgICAgIH0sCiAgICAgICAgY2FuY2VsKCkgewogICAgICAgICAgICB0aGlzLiRzd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiBpMThuLnQoJ21zZ190aXRsZV93YXJuaW5nJyksCiAgICAgICAgICAgICAgICB0ZXh0OiBpMThuLnQoJ21zZ19kaXNjYXJkJyksCiAgICAgICAgICAgICAgICBpY29uOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogaTE4bi50KCdjYW5jZWwnKSwKICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiM0ZDQ4NDgiLAogICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjRUQxQTNBIiwKICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBpMThuLnQoJ2Rpc2NhcmQnKSwKICAgICAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhcigpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5nbygtMSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgUE1UVGVtcGxhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3QgcG10ID0gZGF0YUl0ZW0ucGF5bWVudE9wdGlvbiB8fCB7fQogICAgICAgICAgICBpZiAocG10KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYDxzcGFuPiR7cG10LmJhbmtBY2NvdW50TmFtZSB8fCBgYH08L3NwYW4+YAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGBgCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRQYXltZW50T3B0aW9uKCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoJ3Jlc29sdmVkJykKICAgICAgICAgICAgICAgICAgICB0aGlzLnBheW1lbnRNZXRob2QgPSBbXQogICAgICAgICAgICAgICAgICAgIHBheW1lbnRPcHRpb25IYW5kbGVyLmxpc3Qoc3RyRmlsdGVyKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXltZW50TWV0aG9kID0gcmVzLmRhdGEuZGF0YQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMTApCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkT3RoZXJBY2NvdW50KCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoJ3Jlc29sdmVkJykKICAgICAgICAgICAgICAgICAgICBzZXR0aW5nSGFuZGxlci5nZXRPdGhlckFjY291bnQoKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSByZXMuZGF0YS5kYXRhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gcmVzcG9uc2UuZmlsdGVyKG8gPT4gby5iYW5oamlBY2NDb2RlID09PSAnNzQwMDEwJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyhkYXRhLCAnIHRoaXMuZ2Fpbkxvc3NBYycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nYWluTG9zc0FjYyA9IGRhdGFbMF0uYWNjb3VudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLmdhaW5Mb3NzQWNjLCAnZGF0YVswXS5hY2NvdW50JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFfID0gcmVzcG9uc2UuZmlsdGVyKG8gPT4gby5iYW5oamlBY2NDb2RlID09PSAnNzQwMDQwJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhXy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vdGhlclJldmVudWVBY2MgPSBkYXRhX1swXS5hY2NvdW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaCgpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMCkKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIFBheW1lbnRNZXRob2REcm9wRG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8ualF1ZXJ5KCc8aW5wdXQgbmFtZT0iJyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgICAgICAua2VuZG9Ecm9wRG93bkxpc3QoewogICAgICAgICAgICAgICAgICAgIGF1dG9CaW5kOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGF1dG9XaWR0aDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDQwMCwKICAgICAgICAgICAgICAgICAgICBkYXRhVGV4dEZpZWxkOiAibmFtZSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlRmllbGQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICI8c3Bhbj4jPW5hbWUjPC9zcGFuPiIsCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6ICItLVNlbGVjdC0tIiwKICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlOiBuZXcga2VuZG8uZGF0YS5EYXRhU291cmNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogdGhpcy5wYXltZW50TWV0aG9kCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBoaWRlU21hbGxTaWRlYmFyKCkgewogICAgICAgICAgICB0aGlzLmlzSGlkZUJhciA9ICF0aGlzLmlzSGlkZUJhcjsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRQcmVmaXgoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgncmVzb2x2ZWQnKTsKICAgICAgICAgICAgICAgICAgICBwcmVmaXhIYW5kbGVyLmdldCgnY2FzaCByZWNlaXB0JykudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb25UeXBlcyA9IHJlcy5kYXRhLmRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRyYW5zYWN0aW9uVHlwZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FzaFJlY2VpcHQudHJhbnNhY3Rpb25UeXBlID0gdGhpcy50cmFuc2FjdGlvblR5cGVzWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLiRyb3V0ZS5wYXJhbXMuaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZU51bWJlcigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRTYWxlRm9ybUNvbnRlbnQoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgncmVzb2x2ZWQnKTsKICAgICAgICAgICAgICAgICAgICBzYWxlRm9ybUNvbnRlbnRIYW5kbGVyLmxpc3QoKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSByZXMuZGF0YS5kYXRhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYWxlRm9ybUNvbnRlbnQgPSBkYXRhWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwgMTApCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBhc3luYyBzZWFyY2hJbnZvaWNlKCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoJ3Jlc29sdmVkJyk7CiAgICAgICAgICAgICAgICAgICAgbGV0IGRhdGEgPSB7fQogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHRoaXMubVBheW1lbnRPcHRpb24sICdwYXltZW50ICcpCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubVBheW1lbnRPcHRpb24gPT09ICdJbnZvaWNlJykgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoOiB0aGlzLnNlYXJjaCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdpbnZvaWNlJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogdGhpcy5jYXNoUmVjZWlwdC50cmFuc2FjdGlvbkRhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMubVBheW1lbnRPcHRpb24gPT09ICdDUk4nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2g6IHRoaXMuc2VhcmNoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2NybicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbkRhdGU6IHRoaXMuY2FzaFJlY2VpcHQudHJhbnNhY3Rpb25EYXRlLAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm1QYXltZW50T3B0aW9uID09PSAnUGF5bWVudCBDb2RlJykgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoOiB0aGlzLnNlYXJjaCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdwYXltZW50IGNvZGUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25EYXRlOiB0aGlzLmNhc2hSZWNlaXB0LnRyYW5zYWN0aW9uRGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5tUGF5bWVudE9wdGlvbiA9PT0gJ0N1c3RvbWVyJykgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoOiB0aGlzLm1DdXN0b21lci5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjdXN0b21lcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbkRhdGU6IHRoaXMuY2FzaFJlY2VpcHQudHJhbnNhY3Rpb25EYXRlLAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbUxpbmVzID0gW10KICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5zZWFyY2gpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc2VhcmNoLmxlbmd0aCA+IDQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpbGxpbmdIYW5kbGVyLnNlYXJjaChkYXRhKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gcmVzLmRhdGEuZGF0YQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gcmVzLmRhdGEucmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtTGluZXMgPSByZXNwb25zZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iaiA9IHJlc3BvbnNlWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KCdjdXN0b21lcicpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FzaFJlY2VpcHQuY3VzdG9tZXIgPSBvYmouY3VzdG9tZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5jdXN0b21lci5oYXNPd25Qcm9wZXJ0eSgnbmFtZScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5hbWUgPSBvYmouY3VzdG9tZXIubmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFzZUN1cnJlbmN5ID0gcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJhc2VDdXJyZW5jeSA9IGJhc2VDdXJyZW5jeQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXNoUmVjZWlwdC5jdXJyZW5jeSA9IGJhc2VDdXJyZW5jeQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJhc2VDdXJyZW5jeSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiYXNlQ3VycmVuY3kuaGFzT3duUHJvcGVydHkoJ2NvZGUnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJhc2VDdXJyZW5jeUNvZGUgPSBiYXNlQ3VycmVuY3kuY29kZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiAoY29kZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgdGhpcy5sb2FkVHJhbnNhY3Rpb25SYXRlKGJhc2VDdXJyZW5jeS5jb2RlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDEwKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgb25TYXZlQ2xvc2Uoc2F2ZSkgewogICAgICAgICAgICBpZiAoIXRoaXMuJHJlZnMuZm9ybS52YWxpZGF0ZSgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRyZWZzLmZvcm0udmFsaWRhdGUoKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IGl0ZW1MaW5lRFMgPSB0aGlzLiRyZWZzLmNhc2hSZWNlaXB0SXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpCiAgICAgICAgICAgIGxldCBkYXRhVmFsaWRhdGUgPSAwCiAgICAgICAgICAgIGNvbnN0IGRhdGFSb3cgPSBpdGVtTGluZURTLmRhdGEoKS5maWx0ZXIobiA9PiBuLnBhaWRBbW91bnQgPiAwKS5tYXAobyA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEl0ZW1MaW5lTW9kZWwobykKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIGlmIChkYXRhUm93Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGRhdGFSb3cuZm9yRWFjaCgodmFsdWUsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnBheW1lbnRPcHRpb24uaWQgPT0gdW5kZWZpbmVkIHx8IHZhbHVlLnBheW1lbnRPcHRpb24uaWQgPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcignUGxlYXNlIGNoZWNrIHBheW1lbnQgb3B0aW9uIGFnYWluJyArIChpbmRleCArIDEpKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFWYWxpZGF0ZSArPSAxCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBpZiAoZGF0YVJvdy5sZW5ndGggPT09IGRhdGFWYWxpZGF0ZSkgewogICAgICAgICAgICAgICAgICAgIGxldCBpc0F1dG9HZW5lcmF0ZSA9IDEKICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmF1dG9DYWxjdWxhdGUoKQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJhbkRhdGUgPSBuZXcgRGF0ZSh0aGlzLmNhc2hSZWNlaXB0LnRyYW5zYWN0aW9uRGF0ZSkKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJhbkRhdGVSZWNlaXB0ID0gbmV3IERhdGUodGhpcy5jYXNoUmVjZWlwdC50cmFuc2FjdGlvbkRhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlTSA9IHRyYW5EYXRlLmdldEZ1bGxZZWFyKCkgKyB0cmFuRGF0ZS5nZXRNb250aCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlUmVjZWlwdE0gPSB0cmFuRGF0ZVJlY2VpcHQuZ2V0RnVsbFllYXIoKSArIHRyYW5EYXRlUmVjZWlwdC5nZXRNb250aCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmFuRGF0ZU0gPT09IHRyYW5EYXRlUmVjZWlwdE0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzQXV0b0dlbmVyYXRlID0gMAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vdG9kbzogbWF0Y2ggQ2FzaCByZWNlaXB0IG1vZGVsCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXNoUmVjZWlwdC5wYWlkT3B0aW9uID0gdGhpcy5tUGF5bWVudE9wdGlvbgogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FzaFJlY2VpcHQudHJhbnNhY3Rpb25EYXRlVFogPSBIZWxwZXIudG9JU09EYXRlKHRoaXMuY2FzaFJlY2VpcHQudHJhbnNhY3Rpb25EYXRlKQogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FzaFJlY2VpcHQucGFpZE9wdGlvblRleHQgPSB0aGlzLnNlYXJjaCA/IHRoaXMuc2VhcmNoIDogdGhpcy5tQ3VzdG9tZXIKICAgICAgICAgICAgICAgICAgICB0aGlzLmNhc2hSZWNlaXB0Lml0ZW1MaW5lID0gZGF0YVJvdwogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FzaFJlY2VpcHRbJ2pSYXcnXSA9IHRoaXMualJhdwogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FzaFJlY2VpcHQubG9nZ2VkVXNlciA9IHRoaXMubG9nZ2VkVXNlcgogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FzaFJlY2VpcHRbJ29sZFRvdGFsJ10gPSB0aGlzLm9sZFRvdGFsCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXNoUmVjZWlwdFsnaXNBdXRvR2VuZXJhdGUnXSA9IGlzQXV0b0dlbmVyYXRlCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXNoUmVjZWlwdFsndHhuTGlzdCddID0gdGhpcy50eG5MaXN0CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXNoUmVjZWlwdFsndHJhbnNhY3Rpb25EYXRlJ10gPSB0aGlzLmNhc2hSZWNlaXB0LnRyYW5zYWN0aW9uRGF0ZQogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FzaFJlY2VpcHRbJ2FjdGlvblR5cGUnXSA9IHRoaXMuJHJvdXRlLnBhcmFtcy5pZCA/IHRoaXMuJHJvdXRlLnF1ZXJ5LnR5cGUgOiAnbmV3JwoKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIC8vIGxldCBkYXRhID0gdGhpcy5jYXNoUmVjZWlwdAogICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShkYXRhKSwgJy0tLS0nLCBpc0F1dG9HZW5lcmF0ZSkKICAgICAgICAgICAgICAgICAgICBiaWxsaW5nSGFuZGxlci5jcmVhdGVSZWNlaXB0KHRoaXMuY2FzaFJlY2VpcHQpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXNDb2RlID09PSAyMDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5jbG9zZShyZXNwb25zZS5kYXRhLmRhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LnN1Y2Nlc3MoJ1N1Y2Nlc3NmdWxseScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2F2ZSA9PSAnbmV3JykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzYXZlID09ICdwcmludCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcmludCg0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoJ1NvbWV0aGluZyB3ZW50IHdyb25nJykKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvcnMucHVzaChlKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRDYXNoUmVjZWlwdFZpZXcoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgncmVzb2x2ZWQnKQogICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbUxpbmVzID0gW10KICAgICAgICAgICAgICAgICAgICBiaWxsaW5nSGFuZGxlci50eG5WaWV3KHRoaXMuJHJvdXRlLnBhcmFtcy5pZCkudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gcmVzLmRhdGEuZGF0YQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhc2hSZWNlaXB0ID0gcmVzcG9uc2VbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZmVyZW5jZU5vID0gdGhpcy5jYXNoUmVjZWlwdC5yZWZlcmVuY2VObwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub2xkVG90YWwgPSB0aGlzLmNhc2hSZWNlaXB0LnRvdGFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtTGluZXMgPSByZXNwb25zZVswXS5pdGVtTGluZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNhc2hSZWNlaXB0Lmhhc093blByb3BlcnR5KCdjdXN0b21lcicpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNhc2hSZWNlaXB0LmN1c3RvbWVyLmhhc093blByb3BlcnR5KCduYW1lJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubmFtZSA9IHRoaXMuY2FzaFJlY2VpcHQuY3VzdG9tZXIubmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMTApCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBjbGVhcigpIHsKICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5jYXNoUmVjZWlwdEl0ZW1MaW5lRFMua2VuZG9XaWRnZXQoKTsKICAgICAgICAgICAgZHMuZGF0YShbXSk7CiAgICAgICAgICAgIHRoaXMuaWQgPSB1bmRlZmluZWQKICAgICAgICAgICAgdGhpcy5tQ3VzdG9tZXIgPSB7fQogICAgICAgICAgICB0aGlzLm5hbWUgPSAnJwogICAgICAgICAgICB0aGlzLm1QYXltZW50T3B0aW9uID0gJ0ludm9pY2UnCiAgICAgICAgICAgIHRoaXMuY2FzaFJlY2VpcHQgPSBuZXcgQ2FzaFJlY2VpcHRNb2RlbCgpCiAgICAgICAgICAgIHRoaXMuY2FzaFJlY2VpcHQudHJhbnNhY3Rpb25UeXBlID0gdGhpcy50cmFuc2FjdGlvblR5cGVzWzBdCiAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVOdW1iZXIoKQogICAgICAgIH0sCiAgICAgICAgY2xvc2UoKSB7CiAgICAgICAgICAgIHRoaXMuJHJvdXRlci5nbygtMSk7CiAgICAgICAgfQogICAgfSwKICAgIHdhdGNoOiB7CiAgICAgICAgLy8gaWQoKSB7CiAgICAgICAgLy8gICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgIC8vICAgICAgICAgdGhpcy5jbGVhcigpCiAgICAgICAgLy8gICAgIH0gZWxzZSB7CiAgICAgICAgLy8gICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZQogICAgICAgIC8vICAgICAgICAgdGhpcy5sb2FkT3RoZXJBY2NvdW50KCkKICAgICAgICAvLyAgICAgICAgIHRoaXMuaW5pdERhdGEoKQogICAgICAgIC8vICAgICB9CiAgICAgICAgLy8gfSwKICAgICAgICBjaGVja0lkKCl7CiAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgdGhpcy5jbGVhcigpCiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrX2lkX2VkaXQgPSBmYWxzZQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWUKICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tfaWRfZWRpdCA9IHRydWUKICAgICAgICAgICAgICAgIHRoaXMubG9hZENhc2hSZWNlaXB0VmlldygpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9LAogICAgY3JlYXRlZCgpIHsKICAgICAgICAvLyBmZXRjaCB0aGUgZGF0YSB3aGVuIHRoZSB2aWV3IGlzIGNyZWF0ZWQgYW5kIHRoZSBkYXRhIGlzCiAgICAgICAgLy8gYWxyZWFkeSBiZWluZyBvYnNlcnZlZAogICAgICAgIC8vIHRoaXMubG9hZE9iaigpCiAgICAgICAgLy8gdGhpcy5sb2FkUGF5bWVudE9wdGlvbigpCiAgICB9LAogICAgbW91bnRlZDogYXN5bmMgZnVuY3Rpb24gKCkgewogICAgICAgIGF3YWl0IHRoaXMubG9hZE90aGVyQWNjb3VudCgpCiAgICAgICAgYXdhaXQgdGhpcy5sb2FkUHJlZml4KCkKICAgICAgICBhd2FpdCB0aGlzLmxvYWRTYWxlRm9ybUNvbnRlbnQoKQogICAgICAgIHRoaXMubG9hZERhdGEoMCwgdGhpcy5maWx0ZXIsIHRoaXMuY3VzQmFzZVVybCkKICAgICAgICBhd2FpdCB0aGlzLmluaXRHcmlkKHRoaXMpCiAgICAgICAgYXdhaXQgdGhpcy5pbml0RGF0YSgpCiAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRoaXMuY2hlY2tfaWRfZWRpdCA9IGZhbHNlCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5jaGVja19pZF9lZGl0ID0gdHJ1ZQogICAgICAgIH0KCiAgICB9LAogICAgY29tcHV0ZWQ6IHsKICAgICAgICBkaXNhYmxlZE1lKCkgewogICAgICAgICAgICByZXR1cm4gISF0aGlzLiRyb3V0ZS5wYXJhbXMuaWQ7CiAgICAgICAgfSwKICAgICAgICBzaG93TWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm1QYXltZW50T3B0aW9uID09PSAnQ3VzdG9tZXInIC8vIG9yIHNvbWUgb3RoZXIgbW9yZSBjb21wbGljYXRlZCBsb2dpYwogICAgICAgIH0sCiAgICAgICAgY2hlY2tJZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHJvdXRlLnBhcmFtcy5pZDsKICAgICAgICB9CiAgICB9Cn07Cg=="},{"version":3,"sources":["CashReceipt.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAygBA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CashReceipt.vue","sourceRoot":"src/views/customers","sourcesContent":["<template>\n    <v-app>\n        <v-container>\n            <v-row>\n                <v-col sm=\"12\" cols=\"12\">\n                    <v-card outlined dense class=\"pa-4 no_border rounded-sm\" color=\"white\">\n                        <v-row>\n                            <v-col class=\"bigSide py-0\" sm=\"12\" cols=\"12\" style=\"transition: .3s ease-in;\"\n                                   :class=\"{'hide_big_bar_class':isHideBar}\">\n                                <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                                    <v-card outlined dense class=\"no_border\">\n                                        <h2 class=\"mb-0\">{{ $t('cash_receipt') }} #{{ cashReceipt.referenceNo }}</h2>\n                                        <v-icon v-if=\"!isHideBar\"\n                                                @click=\"cancel()\"\n                                                style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                                                class=\"float-right\"\n                                        >close\n                                        </v-icon>\n                                        <!--                                        <span style=\"transition: .3s ease-in; z-index:10;\"-->\n                                        <!--                                              :class=\"{'iconArrow': !isHideBar,'iconArrowHide': isHideBar }\">-->\n                                        <!--                                            <v-icon size=\"22\"-->\n                                        <!--                                                    class=\"arr_icon\"-->\n                                        <!--                                                    @click=\"hideSmallSidebar\"-->\n                                        <!--                                                    v-if=\"isHideBar\"> mdi-chevron-left-circle-->\n                                        <!--                                            </v-icon>-->\n                                        <!--                                            <v-icon size=\"22\"-->\n                                        <!--                                                    class=\"arr_icon\"-->\n                                        <!--                                                    @click=\"hideSmallSidebar\"-->\n                                        <!--                                                    v-if=\"!isHideBar\"> mdi-chevron-right-circle-->\n                                        <!--                                            </v-icon></span>-->\n                                    </v-card>\n                                    <v-card outlined dense class=\"px-3 no_border\" color=\"grayBg\" height=\"175px\">\n                                        <v-row>\n                                            <v-col sm=\"7\" cols=\"12\" class=\"pb-0\">\n                                                <label class=\"label\">{{ $t('select_option') }}</label>\n                                                <v-select class=\"mt-1\"\n                                                          v-model=\"mPaymentOption\"\n                                                          :items=\"paymentOptions\"\n                                                          @change=\"searchOptionChanged\"\n                                                          :placeholder=\"$t('search')\"\n                                                          outlined>\n                                                </v-select>\n\n                                                <v-row class=\"pt-3\" v-if=\"!showMe\">\n                                                    <v-col cols=\"10\" class=\"pr-1\">\n                                                        <v-text-field\n                                                            class=\"\"\n                                                            v-model=\"search\"\n                                                            outlined\n                                                            :placeholder=\"$t('search')\"\n                                                        />\n                                                    </v-col>\n                                                    <v-col cols=\"2\" class=\"pl-1\">\n                                                        <v-btn color=\"primary white--text\" @click=\"searchInvoice\">\n                                                            <i class=\"b-search\"\n                                                               style=\"font-size: 18px; color:#fff !important;\"/>\n                                                        </v-btn>\n                                                    </v-col>\n                                                </v-row>\n                                                <v-row class=\"pt-3\" v-if=\"showMe\">\n                                                    <v-col cols=\"10\" class=\"kendo_dropdown_custom mt-2 pb-3 pt-0 pr-0\">\n                                                        <dropdownlist\n                                                            :data-items=\"customers\"\n                                                            @change=\"onCustomerChanged\"\n                                                            :value=\"mCustomer\"\n                                                            :data-item-key=\"'id'\"\n                                                            :text-field=\"'numberName'\"\n                                                            :default-item=\"defaultItem\"\n                                                            :filterable=\"true\"\n                                                            @filterchange=\"onCustomerFilterChanged\">\n                                                        </dropdownlist>\n                                                    </v-col>\n                                                    <v-col cols=\"2\" class=\"pl-1\">\n                                                        <v-btn color=\"primary white--text\" @click=\"searchInvoice\">\n                                                            <i class=\"b-search\"\n                                                               style=\"font-size: 18px; color:#fff !important;\"/>\n                                                        </v-btn>\n                                                    </v-col>\n                                                </v-row>\n                                            </v-col>\n                                            <v-col sm=\"5\" cosl=\"12\">\n                                                <label class=\"label\">{{ $t('date') }}</label>\n                                                <app-datepicker :initialDate=\"cashReceipt.transactionDate\"\n                                                                :disabled=\"disabledMe\"\n                                                                @onChanged=\"onTransactionDateChanged\"\n                                                                @emitDate=\"cashReceipt.transactionDate = $event\"/>\n                                                <label class=\"label\">{{ $t('customer_name') }}</label>\n                                                <v-text-field\n                                                    class=\"mt-1\"\n                                                    v-model=\"name\"\n                                                    readonly=\"readonly\"\n                                                    outlined\n                                                />\n                                                <v-row>\n                                                    <v-col sm=\"6\" cols=\"12\" class=\"py-0\">\n\n\n                                                    </v-col>\n                                                    <!--                                                    <v-col sm=\"6\" cols=\"12\" class=\"py-0\">-->\n                                                    <!--                                                        <div class=\"d-flex justify-space-between\">-->\n                                                    <!--                                                            <div>-->\n                                                    <!--                                                                <p class=\"label mb-0\">{{ $t('currency') }}</p>-->\n                                                    <!--                                                                <p class=\"label mb-0\">{{ currencyCode }}</p>-->\n                                                    <!--                                                            </div>-->\n                                                    <!--                                                            <div>-->\n                                                    <!--                                                                <p class=\"label mb-0\">{{ $t('rate') }}</p>-->\n                                                    <!--                                                                <p class=\"label mb-0\">{{ transactionRate }}</p>-->\n                                                    <!--                                                            </div>-->\n                                                    <!--                                                        </div>-->\n                                                    <!--                                                    </v-col>-->\n                                                </v-row>\n                                            </v-col>\n                                        </v-row>\n                                    </v-card>\n\n                                    <v-row class=\"pt-3\" style=\"background-color: #fff;\">\n                                        <v-col sm=\"12\" cols=\"12\" class=\"pt-0\">\n                                            <LoadingMe\n                                                :isLoading=\"showLoading\"\n                                                :fullPage=\"false\"\n                                                :myLoading=\"true\"\n                                                :alertMessage=\"loadingAlert\"\n                                                :color=\"loadingColorAlert\"\n                                                :alertText=\"loadingTextAlert\"/>\n                                            <kendo-datasource ref=\"cashReceiptItemLineDS\"\n                                                              :change=\"dataSourceChanged\"\n                                                              :data=\"itemLines\"/>\n                                            <kendo-grid id=\"gridCashReceipt\" class=\"grid-function\"\n                                                        :data-source-ref=\"'cashReceiptItemLineDS'\"\n                                                        :sortable=\"false\"\n                                                        :groupable=\"false\"\n                                                        :filterable=\"false\"\n                                                        :column-menu=\"true\"\n                                                        :resizable=\"true\"\n                                                        :editable=\"true\"\n                                                        :noRecords=\"true\">\n                                                <!--                                                <kendo-grid-column-->\n                                                <!--                                                    :title=\"$t('no.')\"-->\n                                                <!--                                                    :width=\"55\"-->\n                                                <!--                                                    :column-menu=\"false\"-->\n                                                <!--                                                    :template=\"rowNumberTmpl\"-->\n                                                <!--                                                    :headerAttributes=\"{-->\n                                                <!--                                                                    style: 'background-color: #EDF1F5;',-->\n                                                <!--                                                                    class: 'text-products'-->\n                                                <!--                                                                }\"-->\n                                                <!--                                                    :attributes=\"{-->\n                                                <!--                                                                    style: 'text-align: products'-->\n                                                <!--                                                                }\"/>-->\n                                                <!--                        <kendo-grid-column-->\n                                                <!--                            :field=\"'check'\"-->\n                                                <!--                            :title=\"''\"-->\n                                                <!--                            :headerTemplate=\"headerTemplate\"-->\n                                                <!--                            :template=\"checkTemplate\"-->\n                                                <!--                            :width=\"60\"-->\n                                                <!--                            :column-menu=\"false\"-->\n                                                <!--                            :editable=\"()=>{ return false}\"-->\n                                                <!--                            :locked=\"true\"-->\n                                                <!--                            :headerAttributes=\"{ style: 'background-color: #EDF1F5;', class: 'text-center'\t}\"-->\n                                                <!--                            :attributes=\"{style: 'text-align: center'}\"/>-->\n                                                <kendo-grid-column\n                                                    :field=\"'referenceNo'\"\n                                                    :title=\"$t('invoice_no')\"\n                                                    :width=\"200\"\n                                                    :editable=\"()=>{ return false}\"\n                                                    :template=\"referenceNoTmp\"\n                                                    :locked=\"true\"\n                                                    :headerAttributes=\"{\n                                                                    style: 'background-color: #EDF1F5'\n                                                                }\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'crn'\"\n                                                    :title=\"$t('crn')\"\n                                                    :width=\"100\"\n                                                    :template=\"crnTmp\"\n                                                    :hidden=\"true\"\n                                                    :editable=\"()=>{ return false}\"\n                                                    :locked=\"true\"\n                                                    :headerAttributes=\"{\n                                                                    style: 'background-color: #EDF1F5'\n                                                                }\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'paymentCode'\"\n                                                    :title=\"$t('payment_code')\"\n                                                    :width=\"180\"\n                                                    :template=\"paymentCodeTmp\"\n                                                    :editable=\"()=>{ return false}\"\n                                                    :locked=\"true\"\n                                                    :lockable=\"false\"\n                                                    :headerAttributes=\"{\n                                                                    style: 'background-color: #EDF1F5'\n                                                                }\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'dueDate'\"\n                                                    :title=\"$t('due_date')\"\n                                                    :width=\"150\"\n                                                    :lockable=\"false\"\n                                                    :template=\"formatDate\"\n                                                    :editable=\"()=>{ return false}\"\n                                                    :headerAttributes=\"{\n                                                                    style: 'background-color: #EDF1F5'\n                                                                }\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'txnNote'\"\n                                                    :title=\"$t('note')\"\n                                                    :width=\"200\"\n                                                    :editable=\"()=>{ return false}\"\n                                                    :hidden=\"true\"\n                                                    :lockable=\"false\"\n                                                    :headerAttributes=\"{ style: 'text-align: left; background-color: #EDF1F5',}\"\n                                                    :attributes=\"{ style: 'text-align: left; ' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'overDue'\"\n                                                    :title=\"$t('over_due')\"\n                                                    :width=\"150\"\n                                                    :lockable=\"false\"\n                                                    :hidden=\"true\"\n                                                    :editable=\"()=>{ return false}\"\n                                                    :template=\"overDue\"\n                                                    :headerAttributes=\"{\n                                                                    style: 'background-color: #EDF1F5'\n                                                                }\"/>\n\n                                                <kendo-grid-column\n                                                    :field=\"'paymentTerm'\"\n                                                    :title=\"$t('payment_term')\"\n                                                    :width=\"220\"\n                                                    :lockable=\"false\"\n                                                    :hidden=\"true\"\n                                                    :template=\"settlementDiscount\"\n                                                    :editable=\"()=>{ return false}\"\n                                                    :headerAttributes=\"{style: 'text-align: right; background-color: #EDF1F5'}\"\n                                                    :attributes=\"{style: 'text-align: right; '}\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'paymentOption'\"\n                                                    :title=\"$t('payment_option')\"\n                                                    :width=\"200\"\n                                                    :lockable=\"false\"\n                                                    :template=\"PMTTemplate\"\n                                                    :editor=\"PaymentOptionEditor\"\n                                                    :headerAttributes=\"{style: 'text-align: right; background-color: #EDF1F5'}\"\n                                                    :attributes=\"{style: 'text-align: right; '}\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'bankReferenceNo'\"\n                                                    :title=\"$t('bank_reference_no')\"\n                                                    :width=\"180\"\n                                                    :lockable=\"false\"\n                                                    :template=\"bankReferenceNo\"\n                                                    :headerAttributes=\"{style: 'text-align: right; background-color: #EDF1F5'}\"\n                                                    :attributes=\"{style: 'text-align: right; '}\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'status'\"\n                                                    :title=\"$t('status')\"\n                                                    :width=\"100\"\n                                                    :lockable=\"false\"\n                                                    :template=\"status\"\n                                                    :hidden=\"true\"\n                                                    :editable=\"()=>{ return false}\"\n                                                    :headerAttributes=\"{style: 'text-align: right; background-color: #EDF1F5'}\"\n                                                    :attributes=\"{style: 'text-align: right; '}\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'currencyCode'\"\n                                                    :title=\"$t('currency')\"\n                                                    :width=\"150\"\n                                                    :lockable=\"false\"\n                                                    :editable=\"()=>{ return false}\"\n                                                    :template=\"currency\"\n                                                    :headerAttributes=\"{\n                                                                    style: 'background-color: #EDF1F5'\n                                                                }\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'amount'\"\n                                                    :title=\"$t('amount')\"\n                                                    :width=\"150\"\n                                                    :lockable=\"false\"\n                                                    :editable=\"()=>{ return false}\"\n                                                    :template=\"amount\"\n                                                    :attributes=\"{style: 'text-align: right; '}\"\n                                                    :headerAttributes=\"{\n                                                                    style: 'background-color: #EDF1F5'\n                                                                }\"/>\n\n                                                <kendo-grid-column\n                                                    :field=\"'penalty'\"\n                                                    :title=\"$t('penalty')\"\n                                                    :width=\"150\"\n                                                    :lockable=\"false\"\n                                                    :editor=\"penaltyEditor\"\n                                                    :template=\"penalty\"\n                                                    :headerAttributes=\"{style: 'text-align: right; background-color: #EDF1F5'}\"\n                                                    :attributes=\"{style: 'text-align: right; '}\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'discount'\"\n                                                    :title=\"$t('discount')\"\n                                                    :editor=\"discountEditor\"\n                                                    :template=\"discount\"\n                                                    :width=\"150\"\n                                                    :lockable=\"false\"\n                                                    :headerAttributes=\"{\n                                                                        style: 'text-align: right; background-color: #EDF1F5'\n                                                                    }\"\n                                                    :attributes=\"{\n                                                                        style: 'text-align: right'\n                                                                    }\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'amountTobePaid'\"\n                                                    :title=\"$t('amount_to_be_paid')\"\n                                                    :width=\"210\"\n                                                    :lockable=\"false\"\n                                                    :editable=\"()=>{ return false}\"\n                                                    :template=\"amountTobePaid\"\n                                                    :attributes=\"{style: 'text-align: right; '}\"\n                                                    :headerAttributes=\"{\n                                                                    style: 'background-color: #EDF1F5'\n                                                                }\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'paidAmount'\"\n                                                    :title=\"$t('paid_amount')\"\n                                                    :width=\"200\"\n                                                    :lockable=\"false\"\n                                                    :editor=\"paidAmountEditor\"\n                                                    :template=\"paidAmountTmp\"\n                                                    :headerAttributes=\"{style: 'text-align: right; background-color: #EDF1F5'}\"\n                                                    :attributes=\"{style: 'text-align: right; '}\"/>\n                                            </kendo-grid>\n\n                                        </v-col>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"pb-0\">\n                                            <v-row>\n                                                <v-col sm=\"6\" cols=\"12\" class=\"\">\n                                                    <v-card class=\"no-boxshadow pa-3\" color=\"grayBg\">\n                                                        <v-row>\n                                                            <v-col class=\"py-0\" sm=\"6\" cols=\"6\">\n                                                                <label>{{ $t('message_on_receipt') }}</label>\n                                                                <v-textarea class=\"mt-1\"\n                                                                            outlined\n                                                                            v-model=\"cashReceipt.transactionNote\"\n                                                                            no-resize\n                                                                            height=\"70px\"\n                                                                            rows=\"3\"\n                                                                            placeholder=\"This will appear on the invoice\"\n                                                                />\n                                                            </v-col>\n                                                            <v-col class=\"py-0\" sm=\"6\" cols=\"6\">\n                                                                <label>{{ $t('message_for_journal') }}</label>\n                                                                <v-textarea class=\"mt-1\"\n                                                                            outlined\n                                                                            v-model=\"cashReceipt.journalNote\"\n                                                                            no-resize\n                                                                            height=\"70px\"\n                                                                            rows=\"3\"\n                                                                            placeholder=\"This will appear on the invoice\"\n                                                                />\n                                                            </v-col>\n                                                        </v-row>\n                                                    </v-card>\n                                                    <!--                                                    <template>-->\n                                                    <!--                                                        <v-file-input class=\"mt-0 pt-0 \" sm=\"3\" cols=\"6\"-->\n                                                    <!--                                                                      v-model=\"files\"-->\n                                                    <!--                                                                      :placeholder=\"$t('attachment')\"-->\n                                                    <!--                                                                      multiple-->\n                                                    <!--                                                                      prepend-icon=\"mdi-paperclip\">-->\n                                                    <!--                                                            <template v-slot:selection=\"{ text }\">-->\n                                                    <!--                                                                <v-chip-->\n                                                    <!--                                                                    small-->\n                                                    <!--                                                                    label-->\n                                                    <!--                                                                    color=\"primary\">-->\n                                                    <!--                                                                    {{ text }}-->\n                                                    <!--                                                                </v-chip>-->\n                                                    <!--                                                            </template>-->\n                                                    <!--                                                        </v-file-input>-->\n                                                    <!--                                                    </template>-->\n                                                </v-col>\n                                                <v-col sm=\"6\" cols=\"12\">\n                                                    <v-simple-table>\n                                                        <template v-slot:default>\n                                                            <tbody>\n                                                            <tr>\n                                                                <td class=\"text-left text-uppercase\">{{ $t('penalty') }}\n                                                                </td>\n                                                                <td class=\"text-center\">:</td>\n                                                                <td class=\"text-left primary--text text-bold\">\n                                                                    {{ numberFormat(cashReceipt.penalty) }}\n                                                                </td>\n                                                            </tr>\n                                                            <tr>\n                                                                <td class=\"text-left text-uppercase\">{{\n                                                                        $t('discount')\n                                                                    }}\n                                                                </td>\n                                                                <td class=\"text-center\">:</td>\n                                                                <td class=\"text-left primary--text text-bold\">\n                                                                    {{ numberFormat(cashReceipt.discount) }}\n                                                                </td>\n                                                            </tr>\n                                                            <!--                                                            <tr>-->\n                                                            <!--                                                                <td class=\"text-left text-uppercase\">{{ $t('total') }}-->\n                                                            <!--                                                                </td>-->\n                                                            <!--                                                                <td class=\"text-center\">:</td>-->\n                                                            <!--                                                                <td class=\"text-left primary--text text-bold\">-->\n                                                            <!--                                                                    {{ numberFormat(cashReceipt.total) }}-->\n                                                            <!--                                                                </td>-->\n                                                            <!--                                                            </tr>-->\n                                                            <tr>\n                                                                <td class=\"text-left text-uppercase\">\n                                                                    {{ $t('exchange_amount') }} - {{ baseCurrencyCode }}\n                                                                </td>\n                                                                <td class=\"text-center\">:</td>\n                                                                <td class=\"text-left primary--text text-bold\">\n                                                                    {{ numberFormat(cashReceipt.exchangeAmount) }}\n                                                                </td>\n                                                            </tr>\n\n                                                            <tr hidden>\n                                                                <td class=\"text-left text-uppercase\">\n                                                                    {{ $t('dr') }}\n                                                                </td>\n                                                                <td class=\"text-center\">:</td>\n                                                                <td class=\"text-left primary--text text-bold\">\n                                                                    {{ numberFormat(dr) }}\n                                                                </td>\n                                                            </tr>\n                                                            <tr hidden>\n                                                                <td class=\"text-left text-uppercase\">\n                                                                    {{ $t('cr') }}\n                                                                </td>\n                                                                <td class=\"text-center\">:</td>\n                                                                <td class=\"text-left primary--text text-bold\">\n                                                                    {{ numberFormat(cr) }}\n                                                                </td>\n                                                            </tr>\n                                                            </tbody>\n                                                        </template>\n                                                    </v-simple-table>\n                                                </v-col>\n                                            </v-row>\n                                        </v-col>\n\n                                    </v-row>\n\n                                    <v-divider/>\n                                    <v-card outlined dense class=\"no_border function_footer\">\n                                        <!--                    <v-menu>-->\n                                        <!--                      <template v-slot:activator=\"{ on }\">-->\n                                        <!--                        <v-btn color=\"black\" outlined-->\n                                        <!--                               class=\"mr-2 text-capitalize  black&#45;&#45;text float-left\"-->\n                                        <!--                               v-on=\"on\">-->\n                                        <!--                          {{ $t('select_template') }}-->\n                                        <!--                          <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>-->\n                                        <!--                        </v-btn>-->\n                                        <!--                      </template>-->\n                                        <!--                      <v-list>-->\n                                        <!--                        <v-list-item v-for=\"(item, index) in templates\" :key=\"index\">-->\n                                        <!--                          <v-list-item-title>{{ item.title }}</v-list-item-title>-->\n                                        <!--                        </v-list-item>-->\n                                        <!--                      </v-list>-->\n                                        <!--                    </v-menu>-->\n                                        <v-btn color=\"black\"\n                                               outlined\n                                               class=\"text-capitalize  black--text float-left\"\n                                               @click=\"cancel\">{{ $t('cancel') }}\n                                        </v-btn>\n                                        <!--                    <v-menu>-->\n                                        <!--                      <template v-slot:activator=\"{ on }\">-->\n                                        <!--                        <v-btn color=\"primary\"-->\n                                        <!--                               class=\"ml-2 float-right text-capitalize  white&#45;&#45;text\"-->\n                                        <!--                               v-on=\"on\">-->\n                                        <!--                          {{ $t('save_option') }}-->\n                                        <!--                          <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>-->\n                                        <!--                        </v-btn>-->\n                                        <!--                      </template>-->\n                                        <!--                      <v-list rounded>-->\n                                        <!--                        <v-list-item-group>-->\n                                        <!--                          <v-list-item>-->\n                                        <!--                            <v-list-item-content>-->\n                                        <!--                              <v-list-item-title>{{ $t('save_print') }}-->\n                                        <!--                              </v-list-item-title>-->\n                                        <!--                            </v-list-item-content>-->\n                                        <!--                          </v-list-item>-->\n                                        <!--                          <v-list-item>-->\n                                        <!--                            <v-list-item-content>-->\n                                        <!--                              <v-list-item-title>{{ $t('save_draft') }}-->\n                                        <!--                              </v-list-item-title>-->\n                                        <!--                            </v-list-item-content>-->\n                                        <!--                          </v-list-item>-->\n                                        <!--                        </v-list-item-group>-->\n                                        <!--                      </v-list>-->\n                                        <!--                    </v-menu>-->\n                                        <v-btn v-if=\"!check_id_edit\"  color=\"primary\"\n                                               class=\"float-right white--text text-capitalize \"\n                                               @click=\"onSaveClose('close')\">\n                                            {{ $t('save_close') }}\n                                        </v-btn>\n                                        <v-btn v-if=\"!check_id_edit\" color=\"secondary\"\n                                               style=\"margin-right: 10px !important\"\n                                               class=\"white--text float-right text-capitalize\"\n                                               @click=\"onSaveClose('new')\">{{ $t(\"save_new\") }}\n                                        </v-btn>\n                                        <v-btn v-if=\"!check_id_edit\" color=\"secondary\"\n                                               style=\"margin-right: 10px !important\"\n                                               class=\"white--text float-right text-capitalize\"\n                                               @click=\"onSaveClose('print')\">{{ $t(\"save_print\") }}\n                                        </v-btn>\n                                        <v-btn v-if=\"check_id_edit\" color=\"secondary\"\n                                               class=\"white--text mx-2 float-right text-capitalize\"\n                                               @click=\"_print(4)\">\n                                            {{ $t(\"print\") }}\n                                        </v-btn>\n                                    </v-card>\n                                </v-form>\n                            </v-col>\n                        </v-row>\n\n                    </v-card>\n                </v-col>\n            </v-row>\n        </v-container>\n    </v-app>\n</template>\n\n<script>\nimport {i18n} from '@/i18n';\nimport {DropDownList} from '@progress/kendo-vue-dropdowns'\n\nimport DatePickerComponent from '@/components/custom_templates/DatePickerComponent'\nimport CashReceiptModel from \"@/scripts/cash-receipt/model/CashReceipt\";\nimport ItemLineModel from \"@/scripts/cash-receipt/model/ItemLine\";\nimport kendo from \"@progress/kendo-ui\";\nimport PaymentOptionEditor from \"@/scripts/kendo_editor/PaymentOptionEditor\";\nimport Helper from \"@/helper\";\n\nconst prefixHandler = require(\"@/scripts/prefixHandler\")\nconst saleFormContentHandler = require(\"@/scripts/saleFormContentHandler\")\nconst billingHandler = require(\"@/scripts/invoice/handler/billingHandler\")\nconst customerHandler = require(\"@/scripts/customerHandler\")\nconst settingHandler = require(\"@/scripts/settingsHandler\")\n\nconst $ = kendo.jQuery //require(\"jquery\")\nconst paymentOptionHandler = require(\"@/scripts/paymentOptionHandler\")\n// const paymentOptionHandler = require(\"@/scripts/paymentOptionHandler\")\n\nconst cashReceiptModel = new CashReceiptModel(new Object())\nconst itemLineModel = new ItemLineModel({})\n\nconst keyField = 'id'\nconst textField = 'numberName'\nconst defaultItem = {[textField]: 'Select customer...', [keyField]: null}\nconst emptyItem = {[textField]: 'loading ...'}\nconst OPTION_TYPE = 'Customer'\nconst strFilter = '?optionType=' + OPTION_TYPE\n\nconst cookieJS = require(\"@/cookie.js\");\nconst cookie = cookieJS.getCookie();\n// from\nconst {getFormSetting} = require(\"@/scripts/settingsHandler.js\")\nimport {print} from \"@/form/Sale.js\";\n\nexport default {\n    name: \"CashReceipt\",\n    props: ['id'],\n    components: {\n        LoadingMe: () => import(`@/components/Loading`),\n        'app-datepicker': DatePickerComponent,\n        'dropdownlist': DropDownList\n    },\n    data: () => ({\n        check_id_edit: true,\n        PaymentOptionEditor: PaymentOptionEditor,\n        showLoading: false,\n        loadingAlert: false,\n        loadingColorAlert: '',\n        loadingTextAlert: '',\n        alert: false,\n        files: [],\n        valid: true,\n        loggedUser: {\n            id: cookie.creator,\n            name: cookie.email\n        },\n        itemLines: [],\n        templates: [\n            {title: 'Draft'},\n            {title: 'Open'},\n            {title: 'Partially Closed'},\n            {title: 'Closed'},\n        ],\n        col_expand: 9,\n        col_hide: 3,\n        isHideBar: false,\n        paymentOptions: ['Invoice', 'CRN', 'Payment Code', 'Customer'],\n        mPaymentOption: 'Invoice',\n        paymentMethod: ['Cash', 'Cheque'],\n        transactionDate: new Date().toISOString().substr(0, 10),\n        cashReceipt: cashReceiptModel,\n        itemLine: itemLineModel,\n        saleFormContent: {},\n        search: '',\n        transactionTypes: [],\n        customers: [],\n        mCustomer: {},\n        defaultItem: defaultItem,\n        cusBaseUrl: customerHandler.search(),\n        filter: '',\n        name: '',\n        referenceNo: '',\n        oldTotal: 0,\n        dateFormat: itemLineModel.dateFormat,\n        group: {field: 'customer.name'},\n        banks: [],\n        txnList: [],\n        currencyCode: '',\n        transactionRate: 1,\n        schemaDefinition: {\n            model: {\n                id: \"id\",\n                fields: {\n                    id: {editable: false},\n                    check: {type: 'boolean'},\n                    referenceNo: {editable: false},\n                    amount: {type: 'number'},\n                    amountTobePaid: {type: 'number'},\n                    overDue: {type: 'number'},\n                    crn: {type: 'string'},\n                    paidAmount: {type: 'number'},\n                    discount: {type: 'number'},\n                    penalty: {type: 'number'},\n                    paymentCode: {type: 'number'}\n                }\n            }\n        },\n        baseCurrency: {},\n        baseCurrencyCode: '',\n        jRaw: [],\n        gainLossAcc: {},\n        otherRevenueAcc: {},\n        gainOrLossDescription: 'gain/loss on exchange rate',\n        penaltyDescription: 'penalty',\n        cr: 0,\n        dr: 0,\n\n    }),\n    methods: {\n        nameTemplate(dataItem) {\n            window.console.log(dataItem, ':text-field')\n            const customer = dataItem.customer || {}\n            const name = customer.name || ''\n            const number = customer.number || ''\n            return number + ' - ' + name\n        },\n        _print(id) {\n            let print_data = this.cashReceipt;\n            print_data['baseCurrencyCode'] = this.baseCurrencyCode\n            let params = \"?formType=CashReceipt\"\n            getFormSetting(params).then(res => {\n                if (res.data.statusCode === 200) {\n                    if (res.data.data.length > 0) {\n                        window.console.log(res.data.data[\"0\"].settings);\n                        print(print_data, id, res.data.data[\"0\"].settings);\n                    } else {\n                        this.$snotify.error(i18n.t('please_save_form_in_setting'))\n                    }\n                }\n            });\n        },\n        removeDuplicate(array) {\n            const result = [];\n            const map = new Map();\n            for (const item of array) {\n                if (!map.has(item.id)) {\n                    map.set(item.id, true);    // set any value to Map\n                    result.push(item)\n                }\n            }\n            return result\n        },\n        crnTmp(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty('crn')) {\n                    return dataItem.crn\n                }\n            }\n            return ''\n        },\n        currency(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty('currencyCode')) {\n                    return dataItem.currencyCode\n                }\n            }\n            return ''\n        },\n        paymentCodeTmp(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty('paymentCode')) {\n                    return dataItem.paymentCode\n                }\n            }\n            return ''\n        },\n        referenceNoTmp(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty('referenceNo')) {\n                    return dataItem.referenceNo\n                }\n            }\n            return ''\n        },\n        paidAmountTmp(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty('paidAmount')) {\n                    return kendo.toString(dataItem.paidAmount || 0, dataItem.decimalFormat)\n                }\n            }\n            return 0\n        },\n        amountTobePaid(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty('amountTobePaid')) {\n                    return kendo.toString(dataItem.amountTobePaid || 0, dataItem.decimalFormat)\n                }\n            }\n            return 0\n        },\n        discount(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty('discount')) {\n                    return kendo.toString(dataItem.discount || 0, dataItem.decimalFormat)\n                }\n            }\n            return 0\n        },\n        amount(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty('amount')) {\n                    return kendo.toString(dataItem.amount || 0, dataItem.decimalFormat)\n                }\n            }\n            return 0\n        },\n        penalty(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty('penalty')) {\n                    return kendo.toString(dataItem.penalty || 0, dataItem.decimalFormat)\n                }\n            }\n            return 0\n        },\n        bankReferenceNo(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty('bankReferenceNo')) {\n                    return dataItem.bankReferenceNo\n                }\n            }\n            return ''\n        },\n        overDue(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty('overDue')) {\n                    return dataItem.overDue || 0\n                }\n            }\n            return 0\n        },\n        // async loadTransactionRate(code) {\n        //     new Promise(resolve => {\n        //         setTimeout(() => {\n        //             resolve('resolved')\n        //             const date = new Date(this.transactionDate).toISOString().substr(0, 10)\n        //             // const priceLevel = this.invoice.priceLevel\n        //             if (code !== undefined || code !== '') {\n        //                 this.showLoading = true\n        //                 currencyHandler.getLastExchangeRateByDate(date, code).then(res => {\n        //                     if (res.data.statusCode === 200) {\n        //                         this.showLoading = false\n        //                         const exchangeRate = res.data.data\n        //                         this.currencyCode = exchangeRate.code\n        //                         this.transactionRate = exchangeRate.rate\n        //                         this.cashReceipt.txnRate = exchangeRate.rate\n        //                         this.cashReceipt.exchangeRate = exchangeRate\n        //                         this.showLoading = false\n        //                     }\n        //                 })\n        //             }\n        //\n        //         }, 10)\n        //     })\n        // },\n        async initData() {\n            if (this.$route.params.id !== undefined) {\n                const queryString = this.$route.query\n                let type = ''\n                let option = 0\n                if (queryString.hasOwnProperty('type')) {\n                    type = queryString.type\n                    option = queryString.option\n                    if (type === 'pmt') {\n                        this.mPaymentOption = option\n                        this.search = this.$route.params.id\n                        this.searchInvoice()\n                    }\n                } else {\n                    await this.loadCashReceiptView()\n                }\n\n            } else {\n                this.initRow()\n            }\n        },\n        paidAmountEditor(container, options) {\n            kendo.jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoNumericTextBox({\n                    decimals: 30,\n                    format: `n${this.saleFormContent.decimal}`,\n                    min: 0\n                });\n        },\n        discountEditor(container, options) {\n            kendo.jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoNumericTextBox({\n                    decimals: 30,\n                    format: `n${this.saleFormContent.decimal}`,\n                    min: 0\n                });\n        },\n        penaltyEditor(container, options) {\n            kendo.jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoNumericTextBox({\n                    decimals: 30,\n                    format: `n${this.saleFormContent.decimal}`,\n                    min: 0\n                });\n        },\n        onTransactionDateChanged() {\n            this.generateNumber()\n            this.searchInvoice()\n        },\n        generateNumber() {\n            if (this.$route.params.id) {\n                const tranDate = new Date(this.cashReceipt.transactionDate)\n                const tranDateReceipt = new Date(this.cashReceipt.transactionDate)\n                const tranDateM = tranDate.getFullYear() + tranDate.getMonth()\n                const tranDateReceiptM = tranDateReceipt.getFullYear() + tranDateReceipt.getMonth()\n                if (tranDateM === tranDateReceiptM) {\n                    this.cashReceipt.referenceNo = this.referenceNo\n                    return\n                }\n            }\n            if (this.cashReceipt.transactionDate !== '' && this.transactionTypes.length > 0) {\n                let data = {\n                    abbr: this.cashReceipt.transactionType.abbr,\n                    structure: this.cashReceipt.transactionType.structure,\n                    transactionDate: this.cashReceipt.transactionDate,\n                    sequcencing: this.cashReceipt.transactionType.sequcencing,\n                    prefixSeparator: this.cashReceipt.transactionType.prefixSeparator || '',\n                    numberSeparator: this.cashReceipt.transactionType.numberSeparator || '',\n                    format: this.cashReceipt.transactionType.format || 5,\n                    type: 'Cash Receipt',\n                    entity: 1\n                }\n                billingHandler.lastNumber(data).then(response => {\n                    if (response.data.statusCode === 200) {\n                        const res = response.data.data\n                        const lastNumber = this.zeroPad(parseInt(res.lastNumber), this.cashReceipt.transactionType.format)\n                        const number = res.suffix + this.cashReceipt.transactionType.numberSeparator + lastNumber\n                        this.cashReceipt.number = number\n                        if (this.cashReceipt.transactionType.hasOwnProperty('prefixSeparator')) {\n                            const prefixSep = this.cashReceipt.transactionType.prefixSeparator\n                            this.cashReceipt.referenceNo = this.cashReceipt.transactionType.abbr + prefixSep + number\n                        }\n                    }\n                }).catch(e => {\n                    this.errors.push(e)\n                })\n            }\n        },\n        zeroPad(num, places) {\n            return String(num).padStart(places, '0')\n        },\n        getCircularReplacer() {\n            const seen = new WeakSet();\n            return (key, value) => {\n                if (typeof value === \"object\" && value !== null) {\n                    if (seen.has(value)) {\n                        return;\n                    }\n                    seen.add(value);\n                }\n                return value;\n            };\n        },\n        autoCalculate() {\n            //todo: note : rateTobase is cash receipt rate , txnRate is invoice rate\n            let ds = this.$refs.cashReceiptItemLineDS.kendoWidget(),\n                receiptAmount = 0, discount = 0, penalty = 0, convertedAmount = 0, exchangeDiscount = 0,\n                exchangePenalty = 0, paidAmountTxn = 0, exchangePenaltyTxn = 0, exchangeDiscountTxn = 0\n            const row = ds.data().filter(n => n.paidAmount > 0)\n            this.jRaw = []\n            row.forEach(value => {\n                let paidAmt = 0, nature = '', invRate = 0, receiptRate = 0, rawPaidAmount = 0, rawDiscountAmount = 0,\n                    rawPenaltyAmount = 0, currencyCode = ''\n                let discountAmount = 0, arAmount = 0, refNo = '', payOption = {}, penaltyAmount = 0,\n                    currency = {}, gainLoss = 0, lastXRate = {}, location = {}, segment = {}, project = {},\n                    locationId = '', segmentId = '', projectId = '', txnId = ''\n                if (value.referenceNo) {\n                    refNo = value.referenceNo\n                }\n                if (value.id) {\n                    txnId = value.id || ''\n                }\n                if (value.txnRate) {\n                    invRate = parseFloat(value.txnRate)\n                }\n                if (value.currencyCode) {\n                    currencyCode = (value.currencyCode) || ''\n                }\n                if (value.currency) {\n                    currency = (value.currency) || {}\n                }\n                if (value.location) {\n                    location = (value.location) || {}\n                    if (location.hasOwnProperty('id')) {\n                        locationId = location.id\n                    }\n                }\n                if (value.segment) {\n                    segment = (value.segment) || {}\n                    if (segment.hasOwnProperty('id')) {\n                        segmentId = segment.id\n                    }\n                }\n                if (value.project) {\n                    project = (value.project) || {}\n                    if (project.hasOwnProperty('id')) {\n                        projectId = project.id\n                    }\n                }\n                if (value.exchangeRate) {\n                    lastXRate = (value.exchangeRate) || {}\n                }\n                if (value.rateTobase) {\n                    receiptRate = parseFloat(value.rateTobase)\n                }\n                if (value.paidAmount) {\n                    receiptAmount += kendo.parseFloat(value.paidAmount)\n                    convertedAmount += (kendo.parseFloat(value.paidAmount) * receiptRate)\n                    paidAmountTxn += (kendo.parseFloat(value.paidAmount) * invRate)\n                    paidAmt = kendo.parseFloat(value.paidAmount) * receiptRate\n                    rawPaidAmount = kendo.parseFloat(value.paidAmount)\n                    window.console.log('convertedAmount', convertedAmount, '-', receiptRate)\n                }\n                if (value.discount) {\n                    // discount += kendo.parseFloat(value.discount)\n                    discount += (kendo.parseFloat(value.discount) * receiptRate)\n                    exchangeDiscount += (kendo.parseFloat(value.exchangeDiscount) * receiptRate)\n                    exchangeDiscountTxn += (kendo.parseFloat(value.discount) * invRate)\n                    discountAmount = kendo.parseFloat(value.discount) * receiptRate\n                    rawDiscountAmount = kendo.parseFloat(value.discount)\n                }\n                if (value.penalty) {\n                    // penalty += kendo.parseFloat(value.penalty)\n                    penalty += (kendo.parseFloat(value.penalty) * receiptRate)\n                    penaltyAmount = (kendo.parseFloat(value.penalty)) * receiptRate\n                    exchangePenalty += (kendo.parseFloat(value.exchangePenalty) * receiptRate)\n                    rawPenaltyAmount = kendo.parseFloat(value.penalty)\n                    exchangePenaltyTxn += kendo.parseFloat(value.penalty) * invRate\n                    // todo: Other Revenue Penalty\n                    if (penaltyAmount > 0) {\n                        if (penaltyAmount * -1 > 0) {\n                            nature = 'dr'\n                        } else {\n                            nature = 'cr'\n                        }\n                        if (this.otherRevenueAcc.hasOwnProperty('id')) {\n                            const obj = {\n                                id: this.otherRevenueAcc.id + '-' + nature + '-' + currencyCode + '-' + invRate + '-' + locationId + '-' + projectId + '-' + segmentId + '-' + txnId,\n                                txnId: txnId,\n                                projectId: projectId,\n                                locationId: locationId,\n                                segmentId: segmentId,\n                                currencyCode: currencyCode,\n                                currency: currency,\n                                lastXRate: lastXRate,\n                                referenceNo: refNo,\n                                transactionDate: value.transactionDate || '',\n                                paymentOption: value.paymentOption || '',\n                                bankReferenceNo: value.bankReferenceNo || '',\n                                // line: new ItemLineModel(value),\n                                receiptRate: receiptRate,\n                                description: 'Penalty',\n                                cashBasicEntries: {},\n                                account: this.otherRevenueAcc,\n                                accountId: this.otherRevenueAcc.id,\n                                amount: rawPenaltyAmount * -1,\n                                exchangeAmount: penaltyAmount * -1,\n                                type: nature,\n                                typeAs: 'Penalty'\n                            }\n                            const objCashBasic = {\n                                id: this.otherRevenueAcc.id + '-' + nature + '-' + currencyCode + '-' + invRate + '-' + locationId + '-' + projectId + '-' + segmentId + '-' + txnId,\n                                txnId: txnId,\n                                projectId: projectId,\n                                locationId: locationId,\n                                segmentId: segmentId,\n                                currencyCode: currencyCode,\n                                currency: currency,\n                                lastXRate: lastXRate,\n                                referenceNo: refNo,\n                                transactionDate: value.transactionDate || '',\n                                paymentOption: value.paymentOption || '',\n                                bankReferenceNo: value.bankReferenceNo || '',\n                                // line: new ItemLineModel(value),\n                                receiptRate: receiptRate,\n                                description: 'Penalty',\n                                account: this.otherRevenueAcc,\n                                accountId: this.otherRevenueAcc.id,\n                                amount: rawPenaltyAmount * -1,\n                                exchangeAmount: penaltyAmount * -1,\n                                type: nature,\n                                typeAs: 'Penalty'\n                            }\n                            obj.cashBasicEntries = objCashBasic\n                            this.jRaw.push(obj)\n                        }\n                    }\n                }\n                // todo: gain or loss exchange rate\n                gainLoss = parseFloat((invRate - receiptRate) * (rawPaidAmount + rawDiscountAmount - rawPenaltyAmount))\n                if (gainLoss !== 0) {\n                    if (gainLoss > 0) {\n                        nature = 'dr'\n                    } else {\n                        nature = 'cr'\n                    }\n                    window.console.log('gainLoss', gainLoss, paidAmt, this.gainLossAcc)\n                    // if (gainLoss) {\n                    if (this.gainLossAcc.hasOwnProperty('id')) {\n                        const obj = {\n                            id: this.gainLossAcc.id + '-' + nature + '-' + currencyCode + '-' + invRate + '-' + locationId + '-' + projectId + '-' + segmentId + '-' + txnId,\n                            txnId: txnId,\n                            projectId: projectId,\n                            locationId: locationId,\n                            segmentId: segmentId,\n                            currencyCode: currencyCode,\n                            currency: currency,\n                            lastXRate: lastXRate,\n                            referenceNo: refNo,\n                            transactionDate: value.transactionDate || '',\n                            paymentOption: value.paymentOption || '',\n                            bankReferenceNo: value.bankReferenceNo || '',\n                            // line: new ItemLineModel(value),\n                            receiptRate: gainLoss > 0 ? receiptRate : invRate,\n                            description: this.gainOrLossDescription,\n                            account: this.gainLossAcc,\n                            cashBasicEntries: {},\n                            accountId: this.gainLossAcc.id,\n                            amount: 0,\n                            exchangeAmount: gainLoss,\n                            type: nature,\n                            typeAs: 'GainOrLoss'\n                        }\n                        const objCashBasic = {\n                            id: this.gainLossAcc.id + '-' + nature + '-' + currencyCode + '-' + invRate + '-' + locationId + '-' + projectId + '-' + segmentId + '-' + txnId,\n                            txnId: txnId,\n                            projectId: projectId,\n                            locationId: locationId,\n                            segmentId: segmentId,\n                            currencyCode: currencyCode,\n                            currency: currency,\n                            lastXRate: lastXRate,\n                            referenceNo: refNo,\n                            transactionDate: value.transactionDate || '',\n                            paymentOption: value.paymentOption || '',\n                            bankReferenceNo: value.bankReferenceNo || '',\n                            // line: new ItemLineModel(value),\n                            receiptRate: gainLoss > 0 ? receiptRate : invRate,\n                            description: this.gainOrLossDescription,\n                            account: this.gainLossAcc,\n                            accountId: this.gainLossAcc.id,\n                            amount: 0,\n                            exchangeAmount: gainLoss,\n                            type: nature,\n                            typeAs: 'GainOrLoss'\n                        }\n                        obj.cashBasicEntries = objCashBasic\n                        this.jRaw.push(obj)\n                    }\n                    // }\n                }\n\n                //Todo: AR  Cr\n                arAmount = (rawPaidAmount + rawDiscountAmount - rawPenaltyAmount)\n                if (arAmount * -1 > 0) {\n                    nature = 'dr'\n                } else {\n                    nature = 'cr'\n                }\n                if (value.hasOwnProperty('receivableAcc')) {\n                    let cashBasicEntries = []\n                    if (value.hasOwnProperty('cashBasicIncomeAcc')) {\n                        const cashBasicIncomeAcc = value.cashBasicIncomeAcc || []\n                        cashBasicIncomeAcc.forEach((k, index) => {\n                            const account = k.account || {}\n                            const accountId = k.accountId || ''\n                            const amount = arAmount * (k.amountPercentage || 0)\n                            if (accountId) {\n                                cashBasicEntries.push({\n                                    id: accountId + '-' + nature + '-' + currencyCode + '-' + invRate + '-' + locationId + '-' + projectId + '-' + segmentId + '-' + txnId,\n                                    txnId: txnId,\n                                    projectId: projectId,\n                                    locationId: locationId,\n                                    segmentId: segmentId,\n                                    currencyCode: currencyCode,\n                                    currency: currency,\n                                    lastXRate: lastXRate,\n                                    referenceNo: refNo,\n                                    transactionDate: value.transactionDate || '',\n                                    paymentOption: value.paymentOption || '',\n                                    bankReferenceNo: value.bankReferenceNo || '',\n                                    // line: new ItemLineModel(value),\n                                    receiptRate: invRate,\n                                    description: this.cashReceipt.journalNote || refNo,\n                                    account: account,\n                                    accountId: accountId,\n                                    amount: amount * -1,\n                                    exchangeAmount: amount * -1 * invRate,\n                                    type: nature,\n                                    typeAs: 'Income'\n                                })\n                                const receivableAcc = value.receivableAcc\n                                if (receivableAcc) {\n                                    if (receivableAcc.hasOwnProperty('id')) {\n                                        this.jRaw.push({\n                                            id: receivableAcc.id + '-' + nature + '-' + currencyCode + '-' + invRate + '-' + locationId + '-' + projectId + '-' + segmentId + '-' + txnId + '-' + index,\n                                            txnId: txnId,\n                                            projectId: projectId,\n                                            locationId: locationId,\n                                            segmentId: segmentId,\n                                            currencyCode: currencyCode,\n                                            currency: currency,\n                                            lastXRate: lastXRate,\n                                            referenceNo: refNo,\n                                            transactionDate: value.transactionDate || '',\n                                            paymentOption: value.paymentOption || '',\n                                            bankReferenceNo: value.bankReferenceNo || '',\n                                            // line: new ItemLineModel(value),\n                                            receiptRate: invRate,\n                                            description: this.cashReceipt.journalNote || refNo,\n                                            account: receivableAcc,\n                                            cashBasicEntries: cashBasicEntries[index],\n                                            accountId: receivableAcc.id,\n                                            amount: index === 0 ? (arAmount * -1) : 0,\n                                            exchangeAmount: index === 0 ? (arAmount * -1 * invRate) : 0,\n                                            type: nature,\n                                            typeAs: 'AR'\n                                        })\n                                    }\n                                }\n                            }\n                        })\n                    }\n                }\n\n                //Todo: Cash Account  Dr\n                if (value.paymentOption) {\n                    payOption = value.paymentOption\n                    const cashAmount = (rawPaidAmount) //+ ((invRate - receiptRate) * (rawPaidAmount + rawDiscountAmount))\n                    // const cashAmount = rawPaidAmount + (gainLoss ) + rawPaidAmount\n                    if (cashAmount > 0) {\n                        nature = 'dr'\n                    } else {\n                        nature = 'cr'\n                    }\n                    if (payOption.hasOwnProperty('account')) {\n                        const payOptionAcc = payOption.account || {}\n                        if (payOptionAcc.hasOwnProperty('id')) {\n                            const obj = {\n                                id: payOptionAcc.id + '-' + nature + '-' + currencyCode + '-' + invRate + '-' + locationId + '-' + projectId + '-' + segmentId + '-' + txnId,\n                                txnId: txnId,\n                                projectId: projectId,\n                                locationId: locationId,\n                                segmentId: segmentId,\n                                currencyCode: currencyCode,\n                                currency: currency,\n                                lastXRate: lastXRate,\n                                referenceNo: refNo,\n                                transactionDate: value.transactionDate || '',\n                                paymentOption: value.paymentOption || '',\n                                bankReferenceNo: value.bankReferenceNo || '',\n                                receiptRate: invRate,\n                                description: this.cashReceipt.journalNote || refNo,\n                                account: payOptionAcc,\n                                accountId: payOptionAcc.id,\n                                amount: cashAmount,\n                                cashBasicEntries: {},\n                                exchangeAmount: cashAmount * receiptRate,\n                                type: nature,\n                                typeAs: 'CashAccount'\n                            }\n                            const objCashBasicEntry = {\n                                id: payOptionAcc.id + '-' + nature + '-' + currencyCode + '-' + invRate + '-' + locationId + '-' + projectId + '-' + segmentId + '-' + txnId,\n                                txnId: txnId,\n                                projectId: projectId,\n                                locationId: locationId,\n                                segmentId: segmentId,\n                                currencyCode: currencyCode,\n                                currency: currency,\n                                lastXRate: lastXRate,\n                                referenceNo: refNo,\n                                transactionDate: value.transactionDate || '',\n                                paymentOption: value.paymentOption || '',\n                                bankReferenceNo: value.bankReferenceNo || '',\n                                receiptRate: invRate,\n                                description: this.cashReceipt.journalNote || refNo,\n                                account: payOptionAcc,\n                                accountId: payOptionAcc.id,\n                                amount: cashAmount,\n                                exchangeAmount: cashAmount * receiptRate,\n                                type: nature,\n                                typeAs: 'CashAccount'\n                            }\n                            obj.cashBasicEntries = objCashBasicEntry\n                            // obj.cashBasicEntries = objCashBasicEntry\n                            // let obj1 = obj\n                            // obj1['cashBasicEntries'] = obj\n                            // window.console.log('cashBasicEntries', obj1)\n                            this.jRaw.push(obj)\n                        }\n                    }\n                }\n                //Todo: Settlement Discount  Dr\n                if (value.paymentTerm) {\n                    if (discountAmount > 0) {\n                        const settlementDisc = value.paymentTerm\n                        if (discountAmount > 0) {\n                            nature = 'dr'\n                        } else {\n                            nature = 'cr'\n                        }\n                        if (settlementDisc.hasOwnProperty('account')) {\n                            const settlementDiscAcc = settlementDisc.account\n                            if (settlementDiscAcc.hasOwnProperty('id')) {\n                                const obj = {\n                                    id: settlementDiscAcc.id + '-' + nature + '-' + currencyCode + '-' + invRate + '-' + locationId + '-' + projectId + '-' + segmentId + '-' + txnId,\n                                    txnId: txnId,\n                                    projectId: projectId,\n                                    locationId: locationId,\n                                    segmentId: segmentId,\n                                    currencyCode: currencyCode,\n                                    currency: currency,\n                                    lastXRate: lastXRate,\n                                    referenceNo: refNo,\n                                    transactionDate: value.transactionDate || '',\n                                    paymentOption: value.paymentOption || '',\n                                    bankReferenceNo: value.bankReferenceNo || '',\n                                    // line: new ItemLineModel(value),\n                                    receiptRate: receiptRate,\n                                    description: 'Receipt Settlement Discount',\n                                    account: settlementDiscAcc,\n                                    cashBasicEntries: {},\n                                    accountId: settlementDiscAcc.id,\n                                    amount: rawDiscountAmount,\n                                    exchangeAmount: discountAmount,\n                                    type: nature,\n                                    typeAs: 'Settlement Discount'\n                                }\n                                const objCashbasic = {\n                                    id: settlementDiscAcc.id + '-' + nature + '-' + currencyCode + '-' + invRate + '-' + locationId + '-' + projectId + '-' + segmentId + '-' + txnId,\n                                    txnId: txnId,\n                                    projectId: projectId,\n                                    locationId: locationId,\n                                    segmentId: segmentId,\n                                    currencyCode: currencyCode,\n                                    currency: currency,\n                                    lastXRate: lastXRate,\n                                    referenceNo: refNo,\n                                    transactionDate: value.transactionDate || '',\n                                    paymentOption: value.paymentOption || '',\n                                    bankReferenceNo: value.bankReferenceNo || '',\n                                    // line: new ItemLineModel(value),\n                                    receiptRate: receiptRate,\n                                    description: 'Receipt Settlement Discount',\n                                    account: settlementDiscAcc,\n                                    accountId: settlementDiscAcc.id,\n                                    amount: rawDiscountAmount,\n                                    exchangeAmount: discountAmount,\n                                    type: nature,\n                                    typeAs: 'Settlement Discount'\n                                }\n                                obj.cashBasicEntries = objCashbasic\n                                this.jRaw.push(obj)\n                            }\n                        }\n                    }\n                }\n            })\n            // this.invoiceTxn(txnIds)\n\n            this.cashReceipt.total = receiptAmount\n            this.cashReceipt.exchangeAmount = convertedAmount\n            this.cashReceipt.discount = discount\n            this.cashReceipt.exchangeDiscount = exchangeDiscount\n\n            this.cashReceipt.penalty = penalty\n\n            this.cashReceipt.exchangePenaltyTxn = exchangePenaltyTxn\n            this.cashReceipt.paidAmountTxn = paidAmountTxn\n            this.cashReceipt.exchangeDiscountTxn = exchangeDiscountTxn\n            this.cashReceipt.exchangePenalty = exchangePenalty\n\n            this.shrinkData(this.jRaw)\n            // let itemLineDS = this.$refs.itemLineDS.kendoWidget()\n            // const dataRow = itemLineDS.data().filter(n => n.paidAmount > 0)\n            //\n            // window.console.log(this.jRaw, 'cash jRaw')\n        },\n        shrinkData(obj) {\n            const uniques = this.removeDuplicate(obj) /*[...new Set(accountId.map(i => {\n                return {\n                    id_: i.id_,\n                    id: i.id,\n                    type: i.type\n                }\n            }))]*/\n            uniques.forEach(n => {\n                const found = obj.filter(m => m.id === n.id)\n                let amount = 0, exchangeAmount = 0\n                found.forEach(z => {\n                    amount += parseFloat(z.amount || 0)\n                    exchangeAmount += parseFloat(z.exchangeAmount || 0)\n                })\n                n.exchangeAmount = parseFloat(exchangeAmount) //this.numberFormat(amount)\n                n.amount = parseFloat(amount)  //parseFloat(parseFloat(amount / parseFloat(n.receiptRate))) //this.numberFormat(amount * parseFloat(this.invoice.txnRate)) //.toFixed(this.saleFormContent.decimal)\n            })\n            this.jRaw = uniques\n            let dr = 0, cr = 0\n            this.jRaw.forEach(j => {\n                switch (j.type) {\n                    case 'cr':\n                        cr += parseFloat(j.exchangeAmount)\n                        break\n                    case 'dr':\n                        dr += parseFloat(j.exchangeAmount)\n                        break\n                    default:\n                        break\n                }\n            })\n            const txnId = this.jRaw.map(o => o.txnId)\n            var uSet = new Set(txnId);\n            const uniqueSet = [...uSet]\n            let jRaws = []\n            uniqueSet.forEach(n => {\n                const found = this.jRaw.filter(m => m.txnId === n)\n                jRaws.push({\n                    id: n,\n                    currencyCode: found[0].currencyCode,\n                    projectId: found[0].projectId,\n                    segmentId: found[0].segmentId,\n                    locationId: found[0].locationId,\n                    referenceNo: found[0].referenceNo,\n                    entries: JSON.parse(JSON.stringify(found))\n                })\n            })\n            this.jRaw = jRaws\n            this.dr = dr\n            this.cr = cr\n            window.console.log('dr=', dr, 'cr=', cr, 'dr+cr = ', dr + cr)\n            window.console.log(JSON.stringify(this.jRaw), 'uniques')\n\n        },\n        invoiceTxn() {\n            let txnIds = [], ids = []\n            const ds = this.$refs.cashReceiptItemLineDS.kendoWidget()\n            const data = ds.data()\n            data.forEach(value => {\n                if (value.id) {\n                    txnIds.push({\n                        id: value.id,\n                        status: 1\n                    })\n                }\n            })\n            ids = Object.values(txnIds.reduce((r, o) => (r[o.id] = o, r), {}))\n            ids.forEach(m => {\n                const lines = data.filter(n => n.id === m.id)\n                let paidAmt = 0\n                let amountTobePaid = 0\n                lines.forEach(x => {\n                    if (x.paidAmount) {\n                        paidAmt += x.paidAmount\n                    }\n                    if (x.amountTobePaid) {\n                        amountTobePaid += x.amountTobePaid\n                    }\n                })\n                const pAmt = this.numberFormat(paidAmt)\n                const amtTobePaid = this.numberFormat(amountTobePaid)\n                if (pAmt === amtTobePaid) {\n                    m['status'] = 3 //Paid\n                } else {\n                    m['status'] = 2 // Partially Paid\n                }\n            })\n            this.txnList = ids\n        },\n        initRow() {\n            let ds = this.$refs.cashReceiptItemLineDS.kendoWidget()\n            ds.insert([this.itemLine])\n\n        },\n        async initGrid(that) {\n            let grid = $('#gridCashReceipt').data('kendoGrid')\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved')\n                    $('#header-chb').change(function (ev) {\n                        let checked = ev.target.checked\n                        data = []\n                        $('.row-checkbox').each(function (idx, item) {\n                            if (checked) {\n                                if (!($(item).closest('tr').is('.k-state-selected'))) {\n                                    $(item).click()\n                                    let mRow = $(item).closest('tr')\n                                    let dataItem = grid.dataItem(mRow)\n                                    data.push(dataItem)\n                                }\n\n                            } else {\n                                $(item).click()\n                            }\n                        })\n                        that.checkedChanged(data)\n                    })\n                }, 10)\n            })\n\n            //\n            // let checkedIds = {}\n            let data = []\n            //\n            // function selectRow(that) {\n            //     let checked = this.checked,\n            //         row = $(this).closest(\"tr\"),\n            //         grid = $('#itemLine').data('kendoGrid'),\n            //         dataItem = grid.dataItem(row)\n            //\n            //     checkedIds[dataItem.paymentCode] = checked;\n            //     window.console.log('here',dataItem)\n            //     if (checked) {\n            //         //-select the row\n            //         row.addClass(\"k-state-selected\")\n            //         data.push(dataItem)\n            //\n            //         that.checkedChanged(dataItem)\n            //     } else {\n            //         //-remove selection\n            //         row.removeClass(\"k-state-selected\")\n            //     }\n            // }\n            // if (grid) {\n            //     grid.table.on(\"click\", \".row-checkbox\", selectRow(that))\n            // }\n\n        },\n        checkedChanged(data) {\n            data.forEach(m => {\n                if (parseFloat(m.paidAmount) === 0) {\n                    m.paidAmount = m.amountTobePaid\n                }\n                const index = this.itemLines.findIndex(item => {\n                    return ((m.paymentCode === item.paymentCode) && parseFloat(item.paidAmount) === 0)\n                })\n                this.itemLines.splice(index, 1, m)\n            })\n            this.autoCalculate()\n        },\n        headerTemplate() {\n            return `<input type='checkbox' id='header-chb' class='k-checkbox header-checkbox'>`\n        },\n        checkTemplate(dataItem) {\n            return `<input type='checkbox' #= ${dataItem.check} ? \\\\'checked=\"checked\"\\\\' : '' # class='k-checkbox row-checkbox' />`\n        },\n        formatDate(dataItem) {\n            if (dataItem.hasOwnProperty('dueDate')) {\n                return kendo.toString(new Date(dataItem.dueDate), this.dateFormat)\n            }\n            return ''\n        },\n        settlementDiscount(dataItem) {\n            if (dataItem.hasOwnProperty('paymentTerm')) {\n                return dataItem.paymentTerm.name || ''\n            }\n            return ''\n        },\n        status(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty('status')) {\n                    const status = dataItem.status\n                    let statusText = ''\n                    switch (status) {\n                        case 1:\n                            statusText = 'OPEN'\n                            break\n                        case 2:\n                            statusText = 'Partially Paid'\n                            break\n                        case 4:\n                            statusText = 'VOID'\n                            break\n                        case 3:\n                            statusText = 'PAID'\n                            break\n                    }\n                    return statusText\n                }\n            }\n            return ''\n        },\n        onCustomerChanged(event) {\n            const value = event.value\n            if (value && value[textField] === emptyItem[textField]) {\n                return;\n            }\n            this.mCustomer = value\n            this.cashReceipt.customer = value\n        },\n        onCustomerFilterChanged(event) {\n            const filter = event.filter.value\n            this.loadData(0, filter, this.cusBaseUrl)\n            this.filter = filter\n        },\n        loadData(skip, filter, baseUrl) {\n            const url = baseUrl +\n                `?filter=${filter}`\n            this.requestStarted = true;\n            fetch(url)\n                .then((response) => {\n                    return response.json()\n                })\n                .then(this.afterFetch)\n        },\n        afterFetch(json) {\n            this.customers = json.data\n        },\n        numberFormat(value) {\n            return kendo.toString(value, `n${this.saleFormContent.decimal}`)\n        },\n        rowNumberTmpl(dataItem) {\n            let ds = this.$refs.cashReceiptItemLineDS.kendoWidget(),\n                index = ds.indexOf(dataItem);\n            return index + 1;\n        },\n        dataSourceChanged(e) {\n            let dataRow = e.items[0] || {}\n            if (Object.keys(dataRow).length > 0) {\n                dataRow.set('optionType', OPTION_TYPE)\n            }\n\n            if (e.field) {\n                let amountTobePaid = 0, paidAmount = 0, variance = 0\n                switch (e.field) {\n                    case \"discount\":\n                        dataRow.set('amountTobePaid', (parseFloat(dataRow.amount) + parseFloat(dataRow.penalty)) - parseFloat(dataRow.discount))\n                        dataRow.set('exchangeDiscount', (parseFloat(dataRow.discount) * parseFloat(dataRow.rateTobase)))\n                        dataRow.set('exchangeDiscountTxn', parseFloat(dataRow.discount) * parseFloat(dataRow.txnRate))\n                        window.console.log((parseFloat(dataRow.discount) * parseFloat(dataRow.rateTobase)), '----')\n                        break\n                    case \"penalty\":\n                        dataRow.set('amountTobePaid', (parseFloat(dataRow.amount) + parseFloat(dataRow.penalty)) - parseFloat(dataRow.discount))\n                        dataRow.set('exchangePenalty', parseFloat(dataRow.penalty) * parseFloat(dataRow.rateTobase))\n                        dataRow.set('exchangePenaltyTxn', parseFloat(dataRow.penalty) * parseFloat(dataRow.txnRate))\n\n                        break\n                    case \"paidAmount\":\n                        amountTobePaid = parseFloat(dataRow.amountTobePaid)\n                        paidAmount = parseFloat(dataRow.paidAmount)\n                        variance = parseFloat(dataRow.penalty) - parseFloat(dataRow.discount)\n                        if (paidAmount > amountTobePaid) {\n                            paidAmount = amountTobePaid\n                        } else if (paidAmount < variance) {\n                            paidAmount = variance\n                        }\n                        dataRow.set('paidAmount', paidAmount)\n                        dataRow.set('paidAmountTobase', (paidAmount * parseFloat(dataRow.rateTobase)))\n                        dataRow.set('paidAmountTxn', (paidAmount * parseFloat(dataRow.txnRate)))\n                        break\n                    default:\n                        break\n                }\n\n                this.invoiceTxn()\n                this.autoCalculate()\n\n            }\n        },\n        searchOptionChanged() {\n        },\n        cancel() {\n            this.$swal({\n                title: i18n.t('msg_title_warning'),\n                text: i18n.t('msg_discard'),\n                icon: \"warning\",\n                showCancelButton: true,\n                cancelButtonText: i18n.t('cancel'),\n                confirmButtonColor: \"#4d4848\",\n                cancelButtonColor: \"#ED1A3A\",\n                confirmButtonText: i18n.t('discard'),\n            }).then((result) => {\n                if (result.value) {\n                    this.clear();\n                    this.$router.go(-1);\n                }\n            });\n        },\n        PMTTemplate(dataItem) {\n            const pmt = dataItem.paymentOption || {}\n            if (pmt) {\n                return `<span>${pmt.bankAccountName || ``}</span>`\n            } else {\n                return ``\n            }\n        },\n        async loadPaymentOption() {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved')\n                    this.paymentMethod = []\n                    paymentOptionHandler.list(strFilter).then(res => {\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false\n                            this.paymentMethod = res.data.data\n                        }\n                    }).catch()\n                    {\n                        this.showLoading = false\n                    }\n                }, 10)\n            })\n        },\n        async loadOtherAccount() {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved')\n                    settingHandler.getOtherAccount().then(res => {\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false\n                            const response = res.data.data\n                            const data = response.filter(o => o.banhjiAccCode === '740010')\n                            // window.console.log(data, ' this.gainLossAc')\n                            if (data.length > 0) {\n                                this.gainLossAcc = data[0].account\n                                window.console.log(this.gainLossAcc, 'data[0].account')\n                            }\n                            const data_ = response.filter(o => o.banhjiAccCode === '740040')\n                            if (data_.length > 0) {\n                                this.otherRevenueAcc = data_[0].account\n                            }\n                        }\n                    }).catch()\n                    {\n                        this.showLoading = false\n                    }\n                }, 10)\n            })\n        },\n        PaymentMethodDropDownEditor(container, options) {\n            kendo.jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=name#</span>\",\n                    optionLabel: \"--Select--\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.paymentMethod\n                    })\n                })\n        },\n        hideSmallSidebar() {\n            this.isHideBar = !this.isHideBar;\n        },\n        async loadPrefix() {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved');\n                    prefixHandler.get('cash receipt').then(res => {\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false\n                            this.transactionTypes = res.data.data\n                            if (this.transactionTypes.length > 0) {\n                                this.cashReceipt.transactionType = this.transactionTypes[0]\n                                if (!this.$route.params.id) {\n                                    this.generateNumber()\n                                }\n                            }\n                        }\n                    })\n                }, 10);\n            })\n        },\n        async loadSaleFormContent() {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved');\n                    saleFormContentHandler.list().then(res => {\n                        if (res.data.statusCode === 200) {\n                            const data = res.data.data\n                            if (data.length > 0) {\n                                this.saleFormContent = data[0]\n                            }\n                        }\n                    })\n                }, 10)\n            })\n        },\n        async searchInvoice() {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved');\n                    let data = {}\n                    this.showLoading = true\n                    window.console.log(this.mPaymentOption, 'payment ')\n                    if (this.mPaymentOption === 'Invoice') {\n                        data = {\n                            search: this.search,\n                            type: 'invoice',\n                            transactionDate: this.cashReceipt.transactionDate,\n                        }\n                    } else if (this.mPaymentOption === 'CRN') {\n                        data = {\n                            search: this.search,\n                            type: 'crn',\n                            transactionDate: this.cashReceipt.transactionDate,\n                        }\n                    } else if (this.mPaymentOption === 'Payment Code') {\n                        data = {\n                            search: this.search,\n                            type: 'payment code',\n                            transactionDate: this.cashReceipt.transactionDate,\n                        }\n                    } else if (this.mPaymentOption === 'Customer') {\n                        data = {\n                            search: this.mCustomer.id,\n                            type: 'customer',\n                            transactionDate: this.cashReceipt.transactionDate,\n                        }\n                    }\n                    this.itemLines = []\n                    if (data.search) {\n                        if (data.search.length > 4) {\n                            this.showLoading = true\n                            try {\n                                billingHandler.search(data).then(res => {\n                                    if (res.data.statusCode === 200) {\n                                        const response = res.data.data\n                                        const result = res.data.result\n                                        this.showLoading = false\n                                        if (response.length > 0) {\n                                            this.itemLines = response\n                                            const obj = response[0]\n                                            this.autoCalculate()\n                                            if (obj.hasOwnProperty('customer')) {\n                                                this.cashReceipt.customer = obj.customer\n                                                if (obj.customer.hasOwnProperty('name')) {\n                                                    this.name = obj.customer.name\n                                                }\n                                            }\n                                        }\n                                        const baseCurrency = result\n                                        this.baseCurrency = baseCurrency\n                                        this.cashReceipt.currency = baseCurrency\n                                        if (baseCurrency) {\n                                            if (baseCurrency.hasOwnProperty('code')) {\n                                                this.baseCurrencyCode = baseCurrency.code\n                                                // if (code) {\n                                                //     this.loadTransactionRate(baseCurrency.code)\n                                                // }\n                                            }\n                                        }\n                                    }\n                                })\n                            } catch (e) {\n                                this.showLoading = false\n                            }\n                        } else {\n                            this.showLoading = false\n                        }\n\n                    } else {\n                        this.showLoading = false\n                    }\n                }, 10)\n            })\n        },\n        async onSaveClose(save) {\n            if (!this.$refs.form.validate()) {\n                this.$refs.form.validate()\n                return\n            }\n            let itemLineDS = this.$refs.cashReceiptItemLineDS.kendoWidget()\n            let dataValidate = 0\n            const dataRow = itemLineDS.data().filter(n => n.paidAmount > 0).map(o => {\n                return new ItemLineModel(o)\n            })\n\n            if (dataRow.length > 0) {\n                dataRow.forEach((value, index) => {\n                    if (value.paymentOption.id == undefined || value.paymentOption.id == '') {\n                        this.$snotify.error('Please check payment option again' + (index + 1))\n                    } else {\n                        dataValidate += 1\n                    }\n                });\n                if (dataRow.length === dataValidate) {\n                    let isAutoGenerate = 1\n                    // this.autoCalculate()\n                    if (this.$route.params.id) {\n                        const tranDate = new Date(this.cashReceipt.transactionDate)\n                        const tranDateReceipt = new Date(this.cashReceipt.transactionDate)\n                        const tranDateM = tranDate.getFullYear() + tranDate.getMonth()\n                        const tranDateReceiptM = tranDateReceipt.getFullYear() + tranDateReceipt.getMonth()\n                        if (tranDateM === tranDateReceiptM) {\n                            isAutoGenerate = 0\n                        }\n                    }\n                    //todo: match Cash receipt model\n                    this.cashReceipt.paidOption = this.mPaymentOption\n                    this.cashReceipt.transactionDateTZ = Helper.toISODate(this.cashReceipt.transactionDate)\n                    this.cashReceipt.paidOptionText = this.search ? this.search : this.mCustomer\n                    this.cashReceipt.itemLine = dataRow\n                    this.cashReceipt['jRaw'] = this.jRaw\n                    this.cashReceipt.loggedUser = this.loggedUser\n                    this.cashReceipt['oldTotal'] = this.oldTotal\n                    this.cashReceipt['isAutoGenerate'] = isAutoGenerate\n                    this.cashReceipt['txnList'] = this.txnList\n                    this.cashReceipt['transactionDate'] = this.cashReceipt.transactionDate\n                    this.cashReceipt['actionType'] = this.$route.params.id ? this.$route.query.type : 'new'\n\n                    this.showLoading = true\n                    // let data = this.cashReceipt\n                    // window.console.log(JSON.stringify(data), '----', isAutoGenerate)\n                    billingHandler.createReceipt(this.cashReceipt).then(response => {\n                        if (response.data.statusCode === 201) {\n                            this.showLoading = false\n                            // this.close(response.data.data)\n                            this.$snotify.success('Successfully')\n                            if (save == 'new') {\n                                this.clear()\n                            } else if (save == 'print') {\n                                this._print(4);\n                                this.clear();\n                            } else {\n                                this.clear()\n                                this.close()\n                            }\n                        }\n                    }).catch(e => {\n                        this.$snotify.error('Something went wrong')\n                        this.errors.push(e)\n                    })\n                }\n            }\n        },\n        async loadCashReceiptView() {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved')\n                    this.itemLines = []\n                    billingHandler.txnView(this.$route.params.id).then(res => {\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false\n                            const response = res.data.data\n                            if (response.length > 0) {\n                                this.cashReceipt = response[0]\n                                this.referenceNo = this.cashReceipt.referenceNo\n                                this.oldTotal = this.cashReceipt.total\n                                this.itemLines = response[0].itemLine\n                                if (this.cashReceipt.hasOwnProperty('customer')) {\n                                    if (this.cashReceipt.customer.hasOwnProperty('name')) {\n                                        this.name = this.cashReceipt.customer.name\n                                    }\n                                }\n                            }\n                        }\n                    }).catch()\n                    {\n                        this.showLoading = false\n                    }\n                }, 10)\n            })\n        },\n        clear() {\n            let ds = this.$refs.cashReceiptItemLineDS.kendoWidget();\n            ds.data([]);\n            this.id = undefined\n            this.mCustomer = {}\n            this.name = ''\n            this.mPaymentOption = 'Invoice'\n            this.cashReceipt = new CashReceiptModel()\n            this.cashReceipt.transactionType = this.transactionTypes[0]\n            this.generateNumber()\n        },\n        close() {\n            this.$router.go(-1);\n        }\n    },\n    watch: {\n        // id() {\n        //     if (this.$route.params.id === undefined) {\n        //         this.clear()\n        //     } else {\n        //         this.showLoading = true\n        //         this.loadOtherAccount()\n        //         this.initData()\n        //     }\n        // },\n        checkId(){\n            if (this.$route.params.id === undefined) {\n                this.clear()\n                this.check_id_edit = false\n            } else {\n                this.showLoading = true\n                this.check_id_edit = true\n                this.loadCashReceiptView()\n            }\n        }\n    },\n    created() {\n        // fetch the data when the view is created and the data is\n        // already being observed\n        // this.loadObj()\n        // this.loadPaymentOption()\n    },\n    mounted: async function () {\n        await this.loadOtherAccount()\n        await this.loadPrefix()\n        await this.loadSaleFormContent()\n        this.loadData(0, this.filter, this.cusBaseUrl)\n        await this.initGrid(this)\n        await this.initData()\n        if (this.$route.params.id === undefined) {\n            this.check_id_edit = false\n        } else {\n            this.check_id_edit = true\n        }\n\n    },\n    computed: {\n        disabledMe() {\n            return !!this.$route.params.id;\n        },\n        showMe() {\n            return this.mPaymentOption === 'Customer' // or some other more complicated logic\n        },\n        checkId() {\n            return this.$route.params.id;\n        }\n    }\n};\n</script>\n\n<style scoped>\n.k-dropdown {\n    width: 100%;\n    margin-top: 3px;\n}\n\n.function_wrapper {\n    box-shadow: none !important;\n}\n\n.v-application--is-ltr .v-text-field .v-input__append-inner {\n    margin-top: 0 !important;\n}\n\n.v-input__slot {\n    background-color: #fff !important;\n}\n\n.function_content .label {\n    margin-bottom: 10px;\n    display: inline-block;\n}\n\n.border_radius10 {\n    border-radius: 10px !important;\n    background-color: #F2F2F2;\n}\n\n.pa-3.v-card h4 {\n    font-size: 18px;\n    color: #333;\n}\n\n.pa-3.v-card p {\n    font-size: 12px;\n    color: #B5B5B5;\n}\n\n.attachment_file {\n    background-color: #EFEDED;\n    border-radius: 0 !important;\n}\n\n.attachment_table.v-data-table table {\n    border: thin solid rgba(0, 0, 0, 0.12);\n}\n\n.attachment_table table tr th {\n    border-left: thin solid rgba(0, 0, 0, 0.12);\n    height: 35px;\n    border-right: thin solid rgba(0, 0, 0, 0.12);\n}\n\n.block_debit,\n.block_credit {\n    border-bottom: 1px solid #fff;\n}\n\n.block_debit p.number,\n.block_credit p.number {\n    font-size: 25px;\n    color: #7F7F7F;\n}\n\n.block_debit h5,\n.block_credit h5,\n.block_difference h5 {\n    text-transform: uppercase;\n    color: #7F7F7F;\n    font-size: 15px;\n    font-weight: normal;\n}\n\n.block_difference h5 {\n    font-size: 18px;\n}\n\n.block_difference h5 span {\n    font-size: 15px;\n}\n\n.custom_grid table th:last-child {\n    text-align: right !important;\n}\n\n.primary--text {\n    color: #03b154;\n}\n\n@media (min-width: 1264px) {\n    .container {\n        max-width: 1250px;\n    }\n}\n\n@media (max-width: 576px) {\n    .pt-6.col-sm-5.col-12 {\n        padding-top: 0 !important;\n    }\n\n    .code_text {\n        width: 100%;\n    }\n\n    .phone_no_pt {\n        padding-top: 0 !important;\n    }\n\n    .select_template,\n    .save_option {\n        margin-bottom: 10px;\n    }\n}\n\n.hide_small_bar_class {\n    max-width: 0;\n    transition: .5s ease-in;\n    flex: 0 0 0;\n}\n\n.hide_big_bar_class {\n    max-width: 100%;\n    transition: .5s ease-in;\n    flex: 0 0 100%;\n}\n\n.info_add {\n    background-color: #ffffff;\n}\n\n.small_sidebar {\n    height: 98%;\n    position: relative;\n    padding: 12px;\n    background-color: #EDF1F5;\n}\n\n.iconArrow {\n    right: -35px;\n    position: absolute;\n    bottom: -10px;\n}\n\n.iconArrowHide {\n    position: absolute;\n    right: -7px;\n    bottom: -10px;\n}\n\n.color_grey {\n    color: #808080;\n}\n\n.card_green {\n    min-height: 70px;\n    background-color: #00b050 !important;\n    color: #ffffff;\n}\n\n.lb_bold {\n    font-size: 12px;\n}\n\n.detial_smallside_p {\n    position: absolute;\n    bottom: 10px;\n}\n\n.card_background {\n    background-color: #EDF1F5;\n    min-height: 120px;\n}\n\n.deposite_input {\n    width: 100px;\n}\n\n.btn_save_draft {\n    color: #ffffff;\n    background-color: #00b0f0 !important;\n    text-transform: capitalize;\n}\n\n.save_option {\n    background-color: #203864 !important;\n}\n\n.btn_add_small {\n    height: 27px !important;\n    min-width: 25px !important;\n    font-size: 10px;\n    padding: 0 22px !important;\n    background-color: #00b050 !important;\n    color: #ffffff;\n    border-radius: 0 !important;\n}\n\n.list_site_inv {\n    background-color: #92d050;\n    color: #ffffff;\n    font-size: 12px;\n}\n\n.list_site_exp {\n    background-color: #c5e0b4;\n    color: #000000;\n    font-size: 12px;\n    line-height: 16px;\n    min-height: 40px;\n}\n\n.checkbox_inv {\n    padding: 2px;\n    margin-top: 3px;\n    margin-right: 2px;\n}\n\n.exp_select {\n    font-size: 12px !important;\n}\n\n.theme--light.v-data-table td {\n    border-bottom: 1px solid #808080;\n    border-top: 1px solid #808080;\n}\n\n.theme--light.v-data-table > .v-data-table__wrapper > table > tbody > tr:hover:not(.v-data-table__expanded__content):not(.v-data-table__empty-wrapper) {\n    background-color: transparent !important;\n}\n\n</style>"]}]}