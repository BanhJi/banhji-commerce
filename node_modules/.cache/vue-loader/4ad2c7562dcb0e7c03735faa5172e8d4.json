{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/customers/SaleReturn.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/customers/SaleReturn.vue","mtime":1639966363924},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8vIGltcG9ydCBrZW5kbyBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tdWknCmltcG9ydCB7aTE4bn0gZnJvbSAiQC9pMThuIjsKaW1wb3J0IExvYWRpbmdNZSBmcm9tICJAL2NvbXBvbmVudHMvTG9hZGluZyI7CmltcG9ydCBEYXRlUGlja2VyQ29tcG9uZW50IGZyb20gIkAvY29tcG9uZW50cy9jdXN0b21fdGVtcGxhdGVzL0RhdGVQaWNrZXJDb21wb25lbnQiOwppbXBvcnQgQ3JlZGl0TWVtb01vZGVsIGZyb20gIkAvc2NyaXB0cy9zYWxlX3JldHVybi9tb2RlbC9DcmVkaXRNZW1vIjsKaW1wb3J0IGtlbmRvIGZyb20gIkBwcm9ncmVzcy9rZW5kby11aSI7CmltcG9ydCB7dXVpZH0gZnJvbSAidnVlLXV1aWQiOwppbXBvcnQgU2FsZUZvcm1Db250ZW50TW9kZWwgZnJvbSAiQC9zY3JpcHRzL21vZGVsL1NhbGVGb3JtQ29udGVudCI7CmltcG9ydCB7RHJvcERvd25MaXN0fSBmcm9tICJAcHJvZ3Jlc3Mva2VuZG8tdnVlLWRyb3Bkb3ducyI7CmltcG9ydCBJdGVtTGluZU1vZGVsIGZyb20gIkAvc2NyaXB0cy9zYWxlX3JldHVybi9tb2RlbC9JdGVtTGluZSI7Ci8vIGltcG9ydCBBY2NvdW50TGluZU1vZGVsIGZyb20gIkAvc2NyaXB0cy9zYWxlX3JldHVybi9tb2RlbC9BY2NvdW50TGluZSI7CmltcG9ydCBBcHBseVRvTGluZU1vZGVsIGZyb20gIkAvc2NyaXB0cy9zYWxlX3JldHVybi9tb2RlbC9BcHBseVRvTGluZSI7CmltcG9ydCBEZXBvc2l0TGluZU1vZGVsIGZyb20gIkAvc2NyaXB0cy9zYWxlX3JldHVybi9tb2RlbC9EZXBvc2l0TGluZSI7CmltcG9ydCB7ZGF0YVN0b3JlLCBTaG93UmVzb3VyY2V9IGZyb20gIkAvb2JzZXJ2YWJsZS9zdG9yZSI7CmltcG9ydCBQYXltZW50T3B0aW9uRWRpdG9yIGZyb20gIkAvc2NyaXB0cy9rZW5kb19lZGl0b3IvUGF5bWVudE9wdGlvbkVkaXRvciI7Cgpjb25zdCBkZWZhdWx0SXRlbSA9IHtbIm51bWJlck5hbWUiXTogIlNlbGVjdCBjdXN0b21lci4uLiIsIFsiaWQiXTogbnVsbH07CmNvbnN0IGN1c3RvbWVySGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9jdXN0b21lckhhbmRsZXIiKTsKY29uc3QgcHJlZml4SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wcmVmaXhIYW5kbGVyIik7CmNvbnN0IGVtcHR5SXRlbSA9IHtbIm51bWJlck5hbWUiXTogImxvYWRpbmcgLi4uIn07CmNvbnN0IGJpbGxpbmdIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2ludm9pY2UvaGFuZGxlci9iaWxsaW5nSGFuZGxlciIpOwpjb25zdCBzYWxlRm9ybUNvbnRlbnRIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3NhbGVGb3JtQ29udGVudEhhbmRsZXIiKTsKY29uc3QgZW1wbG95ZWVIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2VtcGxveWVlSGFuZGxlciIpOwpjb25zdCBsb2NhdGlvbkhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvbG9jYXRpb25IYW5kbGVyIik7CmNvbnN0IHByb2R1Y3RWYXJpYW50SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wcm9kdWN0VmFyaWFudEhhbmRsZXIiKTsKY29uc3QgZGlzY291bnRJdGVtSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9kaXNjb3VudEl0ZW1IYW5kbGVyIik7CmNvbnN0IGFjY291bnRIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2hhbmRsZXIvYWNjb3VudGluZy9hY2NvdW50Iik7CmNvbnN0IHVvbVByaWNlSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy91b21QcmljZUhhbmRsZXIiKTsKY29uc3Qgc2V0dGluZ3NIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3NldHRpbmdzSGFuZGxlciIpOwpjb25zdCBwcm9qZWN0SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wcm9qZWN0SGFuZGxlciIpOwpjb25zdCBwcmljZUxldmVsSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wcmljZUxldmVsSGFuZGxlciIpOwpjb25zdCBzZXR0aW5nSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9zZXR0aW5nSGFuZGxlciIpOwpjb25zdCBwYXltZW50VGVybUhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvcGF5bWVudFRlcm1IYW5kbGVyIik7CmNvbnN0IGN1cnJlbmN5SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9jdXJyZW5jeS9oYW5kbGVyL2N1cnJlbmN5SGFuZGxlciIpOwpjb25zdCBzYWxlVW5pdEl0ZW1IYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3NhbGVVbml0SXRlbUhhbmRsZXIiKTsKY29uc3QgcGF5bWVudE9wdGlvbkhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvcGF5bWVudE9wdGlvbkhhbmRsZXIiKTsKCmltcG9ydCBTYWxlRGVwb3NpdEl0ZW1MaW5lTW9kZWwgZnJvbSAiQC9zY3JpcHRzL3NhbGVfZGVwb3NpdC9tb2RlbC9JdGVtTGluZSI7CmltcG9ydCBvdGhlckNoYXJnZUhhbmRsZXIgZnJvbSAiQC9zY3JpcHRzL290aGVyQ2hhcmdlSGFuZGxlciI7CmltcG9ydCBPdGhlckNoYXJnZU1vZGVsIGZyb20gIkAvc2NyaXB0cy9tb2RlbC9PdGhlckNoYXJnZSI7Cgpjb25zdCBzYWxlRm9ybUNvbnRlbnRNb2RlbCA9IG5ldyBTYWxlRm9ybUNvbnRlbnRNb2RlbCh7fSk7CmNvbnN0IGl0ZW1MaW5lTW9kZWwgPSBuZXcgSXRlbUxpbmVNb2RlbCh7fSk7Ci8vIGNvbnN0IGFjY291bnRMaW5lTW9kZWwgPSBuZXcgQWNjb3VudExpbmVNb2RlbCh7fSkKY29uc3QgYXBwbHlUb0xpbmVNb2RlbCA9IG5ldyBBcHBseVRvTGluZU1vZGVsKHt9KTsKY29uc3QgZGVwb3NpdExpbmVNb2RlbCA9IG5ldyBEZXBvc2l0TGluZU1vZGVsKHt9KTsKY29uc3QgJCA9IHJlcXVpcmUoImpxdWVyeSIpOwpjb25zdCBpdGVtTGluZVByZWZpeCA9ICJsaW4tIjsKY29uc3QgdGV4dEZpZWxkID0gIm51bWJlck5hbWUiOwoKY29uc3QgY3JlZGl0TWVtb01vZGVsID0gbmV3IENyZWRpdE1lbW9Nb2RlbCh7fSk7CmNvbnN0IHNhbGVEZXBvc2l0SXRlbUxpbmVNb2RlbCA9IG5ldyBTYWxlRGVwb3NpdEl0ZW1MaW5lTW9kZWwoe30pOwpjb25zdCBPUFRJT05fVFlQRSA9ICJDdXN0b21lciI7CmNvbnN0IHN0ck9wdGlvbkZpbHRlciA9ICI/b3B0aW9uVHlwZT0iICsgT1BUSU9OX1RZUEU7CmNvbnN0IERJU0NPVU5UX1RZUEUgPSAiP3R5cGU9U2FsZSI7CmNvbnN0IGNvb2tpZUpTID0gcmVxdWlyZSgiQC9jb29raWUuanMiKTsKY29uc3QgY29va2llID0gY29va2llSlMuZ2V0Q29va2llKCk7CmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWU6ICJDcmVkaXRNZW1vIiwKICAgIHByb3BzOiBbImlkIl0sCiAgICBjb21wb25lbnRzOiB7CiAgICAgICAgTG9hZGluZ01lOiBMb2FkaW5nTWUsCiAgICAgICAgImFwcC1kYXRlcGlja2VyIjogRGF0ZVBpY2tlckNvbXBvbmVudCwKICAgICAgICBkcm9wZG93bmxpc3Q6IERyb3BEb3duTGlzdCwKICAgIH0sCiAgICBkYXRhOiAoKSA9PiAoewogICAgICAgIGlzTG9hZGluZzogMCwKICAgICAgICBQYXltZW50T3B0aW9uRWRpdG9yOiBQYXltZW50T3B0aW9uRWRpdG9yLAogICAgICAgIGNyZWRpdE1lbW86IGNyZWRpdE1lbW9Nb2RlbCwKICAgICAgICBzYWxlRm9ybUNvbnRlbnQ6IHNhbGVGb3JtQ29udGVudE1vZGVsLAogICAgICAgIGl0ZW1MaW5lOiBpdGVtTGluZU1vZGVsLAogICAgICAgIC8vIGFjY291bnRMaW5lOiBhY2NvdW50TGluZU1vZGVsLAogICAgICAgIGFwcGx5VG9MaW5lOiBhcHBseVRvTGluZU1vZGVsLAogICAgICAgIGRlcG9zaXRMaW5lOiBkZXBvc2l0TGluZU1vZGVsLAogICAgICAgIHNhbGVEZXBvc2l0TGluZTogc2FsZURlcG9zaXRJdGVtTGluZU1vZGVsLAoKICAgICAgICBjdXN0b21lckxpc3Q6IFtdLAogICAgICAgIGNhc2hSZWZ1bmRMaW5lczogW10sCiAgICAgICAgaXRlbUxpbmVzOiBbXSwKICAgICAgICB0YXhMaXN0VG90YWw6IFtdLAogICAgICAgIG90aGVyQ2hhcmdlTGlzdDogW10sCiAgICAgICAgY3VzdG9tZXI6IHt9LAogICAgICAgIGRlZmF1bHRJdGVtOiBkZWZhdWx0SXRlbSwKICAgICAgICBkYXRhSXRlbUtleTogImlkIiwKICAgICAgICB0ZXh0RmllbGQ6ICJudW1iZXJOYW1lIiwKICAgICAgICBmaWx0ZXI6ICIiLAogICAgICAgIGN1c0Jhc2VVcmw6IGN1c3RvbWVySGFuZGxlci5zZWFyY2h2MSgpLAogICAgICAgIGVtcEJhc2VVcmw6IGVtcGxveWVlSGFuZGxlci5zZWFyY2goKSwKICAgICAgICBsb2dnZWRVc2VyOiB7CiAgICAgICAgICAgIGlkOiBjb29raWUuY3JlYXRvciwKICAgICAgICAgICAgbmFtZTogY29va2llLmVtYWlsLAogICAgICAgIH0sCiAgICAgICAgZW1wbG95ZWVzOiBbXSwKICAgICAgICBtRW1wbG95ZWU6IHt9LAogICAgICAgIGN1c3RvbWVyUHJvamVjdHM6IFtdLAogICAgICAgIHByaWNlTGV2ZWw6IFtdLAogICAgICAgIGxvY2F0aW9uczogW10sCiAgICAgICAgb3RoZXJUYXg6IFtdLAogICAgICAgIHZhdFRheDogW10sCiAgICAgICAgc3BlY2lmaWNUYXg6IFtdLAogICAgICAgIHB1YmxpY0xpZ2h0aW5nVGF4OiBbXSwKICAgICAgICBzYWxlVW5pdEl0ZW1MaXN0OiBbXSwKICAgICAgICBjdXN0b21lckRpc2NvdW50SXRlbTogW10sCiAgICAgICAgY3VzdG9tZXJTYWxlVW5pdDogW10sCiAgICAgICAgdHJhbnNhY3Rpb25UeXBlOiBbXSwKICAgICAgICBzZWdtZW50czogW10sCiAgICAgICAgZXhjaGFuZ2VSYXRlOiBbXSwKICAgICAgICBjdXJyZW5jeUNvZGU6ICIiLAogICAgICAgIHRyYW5zYWN0aW9uUmF0ZTogMSwKICAgICAgICBhY2NvdW50TGluZXM6IFtdLAogICAgICAgIHRyYW5zYWN0aW9uUmF0ZURhdGU6ICIiLAogICAgICAgIGFjY291bnRzOiBbXSwKICAgICAgICBkZXBvc2l0TGluZXM6IFtdLAogICAgICAgIG9mZnNldExpc3Q6IFtdLAogICAgICAgIG9mZnNldEludm9pY2VzOiBbXSwKICAgICAgICBvZmZzZXRJbnZvaWNlTGlzdDogW10sCiAgICAgICAgb2Zmc2V0SW52b2ljZToge30sCiAgICAgICAgZGVjaW1hbEZvcm1hdDogIm4yIiwKICAgICAgICAvLyBMb2FkaW5nTWUKICAgICAgICBzaG93TG9hZGluZzogZmFsc2UsCiAgICAgICAgYmlsbF9kYXRlOiAiIiwKICAgICAgICBhbGVydDogZmFsc2UsCiAgICAgICAgdmFsaWQ6IHRydWUsCiAgICAgICAgc3VwcGxpZXJzOiBbXSwKICAgICAgICBqb3VybmFsX3R5cGVzOiBbXSwKICAgICAgICBzdXBwbGllcnNfaXRlbTogW10sCiAgICAgICAgcGF5bWVudE1ldGhvZDogW10sCiAgICAgICAgZXhwZW5zZTogWyJFcXVhbCIsICJ3ZWlnaHRlZCJdLAogICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnN1YnN0cigwLCAxMCksCiAgICAgICAgdGVtcGxhdGVzOiBbCiAgICAgICAgICAgIHt0aXRsZTogIkRyYWZ0In0sCiAgICAgICAgICAgIHt0aXRsZTogIk9wZW4ifSwKICAgICAgICAgICAge3RpdGxlOiAiUGFydGlhbGx5IENsb3NlZCJ9LAogICAgICAgICAgICB7dGl0bGU6ICJDbG9zZWQifSwKICAgICAgICBdLAogICAgICAgIGlzSGlkZUJhcjogZmFsc2UsCiAgICAgICAgZGlhbG9nVGF4OiBmYWxzZSwKICAgICAgICBiYXNlQ3VycmVuY3lDb2RlOiAiIiwKICAgICAgICBhY2NDYXNoOiBbXSwKICAgICAgICBhY2NEZXBvc2l0OiBbXSwKICAgICAgICBhY2NEZXBvc2l0czogW10sCiAgICAgICAgalJhdzogW10sCiAgICAgICAgalJhdzE6IFtdLAogICAgICAgIGpSYXcyOiBbXSwKICAgICAgICBqUmF3MzogW10sCiAgICAgICAgalJhdzQ6IFtdLAogICAgICAgIGpSYXc1OiBbXSwKICAgICAgICB0YXhMaXN0RGV0YWlsOiBbXSwKICAgICAgICBnYWluTG9zc0FjYzoge30sCiAgICAgICAgb3RoZXJSZXZlbnVlQWNjOiB7fSwKICAgICAgICB2YXJpYW5jZUFjY3M6IFtdLAogICAgICAgIHJlZkZyb206IFtdLAogICAgICAgIHJlZlRvOiBbXSwKICAgICAgICBpc1ByaWNlTGV2ZWxDaGFuZ2VkOiBmYWxzZSwKICAgICAgICBjcjogMCwKICAgICAgICBkcjogMCwKICAgIH0pLAogICAgY29tcHV0ZWQ6IHsKICAgICAgICBkaXNhYmxlZE1lKCkgewogICAgICAgICAgICByZXR1cm4gISF0aGlzLiRyb3V0ZS5wYXJhbXMuaWQ7CiAgICAgICAgfSwKICAgICAgICAvLyAgICAgICAgICQoIiNnZXRJbmZvQnV0dG9uIikuYmluZCgiY2xpY2siLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8KICAgICAgICAvLyAgICAgdmFyIGdyaWQgPSBrZW5kby5qUXVlcnkoIiNncmlkMSIpLmRhdGEoImtlbmRvR3JpZCIpOwogICAgICAgIC8vICAgICB2YXIgcm93ID0gJCgiaW5wdXQ6Y2hlY2tlZCIsIGdyaWQudGJvZHkpLmNsb3Nlc3QoInRyIik7CiAgICAgICAgLy8gICAgIHZhciBpdGVtID0gZ3JpZC5kYXRhSXRlbShyb3cpOwogICAgICAgIC8vICAgICBhbGVydCAoSlNPTi5zdHJpbmdpZnkoaXRlbSkpOwogICAgICAgIC8vIH0pOwogICAgICAgIHJhZGlvQnV0dG9uKCkgewogICAgICAgICAgICByZXR1cm4gYDxpbnB1dCB0eXBlPSJyYWRpbyIgY2xhc3M9ImRldGFpbEdyaWRSb3dTZWxlY3RvciIgdGl0bGU9IlNlbGVjdCBMaW5lcyIgbmFtZT0icmFkaW9MaW5lU2VsZWN0b3IiIC8+YDsKICAgICAgICB9LAogICAgICAgIGFtb3VudEhlYWRlclRlbXBsYXRlKCkgewogICAgICAgICAgICBpZiAodGhpcy5jdXN0b21lcikgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuY3VzdG9tZXIuaGFzT3duUHJvcGVydHkoImJhc2VDdXJyZW5jeSIpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFzZUN1cnJlbmN5ID0gdGhpcy5jdXN0b21lci5iYXNlQ3VycmVuY3k7CiAgICAgICAgICAgICAgICAgICAgaWYgKGJhc2VDdXJyZW5jeS5oYXNPd25Qcm9wZXJ0eSgiY29kZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiQW1vdW50ICgiICsgYmFzZUN1cnJlbmN5LmNvZGUgKyAiKSI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAiQW1vdW50IjsKICAgICAgICB9LAogICAgICAgIGFtb3VudExpbmVIZWFkZXJUZW1wbGF0ZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVuY3lDb2RlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIkFtb3VudCAoIiArIHRoaXMuY3VycmVuY3lDb2RlICsgIikiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAiQW1vdW50IjsKICAgICAgICB9LAogICAgICAgIGhpZGRlbkJ1dHRvbigpIHsKICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKICAgIG1ldGhvZHM6IHsKICAgICAgICBzdGF0dXMoc3RhdHVzKSB7CiAgICAgICAgICAgIGxldCBzdGF0dXNUZXh0ID0gJycKICAgICAgICAgICAgc3dpdGNoIChzdGF0dXMpIHsKICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0ID0gJ09wZW4nCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0ID0gJ1BhcnRpYWxseSBQYWlkJwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dCA9ICdQYWlkJwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dCA9ICdWb2lkJwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHN0YXR1c1RleHQKICAgICAgICB9LAogICAgICAgIG9uUHJpY2VMZXZlbENoYW5nZSgpIHsKICAgICAgICAgICAgdGhpcy5pc1ByaWNlTGV2ZWxDaGFuZ2VkID0gdHJ1ZQogICAgICAgICAgICB0aGlzLmxvYWRUcmFuc2FjdGlvblJhdGUoKQogICAgICAgICAgICB0aGlzLmNsZWFyVU9NSXRlbSgpCiAgICAgICAgfSwKICAgICAgICBhc3luYyBjbGVhclVPTUl0ZW0oKSB7CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuaXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpCiAgICAgICAgICAgIGRzLmRhdGEoKS5tYXAobiA9PiB7CiAgICAgICAgICAgICAgICBuLnNldCgndW9tJywge30pCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHRoaXMuaXNQcmljZUxldmVsQ2hhbmdlZCA9IGZhbHNlCiAgICAgICAgfSwKICAgICAgICBxb2hUZW1wbGF0ZShkYXRhSXRlbSkgewogICAgICAgICAgICBjb25zdCBidW9tID0gZGF0YUl0ZW0uYnVvbSB8fCB7fTsKICAgICAgICAgICAgY29uc3QgcW9oID0gZGF0YUl0ZW0ucW9oIHx8IDA7CiAgICAgICAgICAgIGlmIChidW9tLmhhc093blByb3BlcnR5KCJuYW1lIikpIHsKICAgICAgICAgICAgICAgIHJldHVybiBxb2ggKyBgIGAgKyBidW9tLm5hbWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGBgOwogICAgICAgIH0sCiAgICAgICAgZm9ybWF0VmFyaWFuY2UobnVtKSB7CiAgICAgICAgICAgIGlmIChudW0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IHZhcmlhbmNlTnVtYmVyID0gdGhpcy5udW1iZXJUb1N0cmluZyhudW0pOwogICAgICAgICAgICAgICAgcmV0dXJuIHZhcmlhbmNlTnVtYmVyOwogICAgICAgICAgICAgICAgLy8gICBpZiAodmFyaWFuY2VOdW1iZXIpIHsKICAgICAgICAgICAgICAgIC8vICAgICBjb25zdCBzdHJEaWdpdCA9IHZhcmlhbmNlTnVtYmVyLnNwbGl0KCcuJykKICAgICAgICAgICAgICAgIC8vICAgICBjb25zdCBoZWFkID0gc3RyRGlnaXRbMF0KICAgICAgICAgICAgICAgIC8vICAgICBjb25zdCByaWdodEhlYWQgPSBzdHJEaWdpdFsxXQogICAgICAgICAgICAgICAgLy8gICAgIGNvbnN0IG51bXMgPSB0aGlzLmNvdW50WmVyb3MocmlnaHRIZWFkKQogICAgICAgICAgICAgICAgLy8gICAgIGNvbnN0IHN1YnN0cmluZ1JpZ2h0ID0gcmlnaHRIZWFkLnN1YnN0cmluZygwLCBudW1zICsgMSkKICAgICAgICAgICAgICAgIC8vICAgICByZXR1cm4gaGVhZCArICcuJyArIHN1YnN0cmluZ1JpZ2h0CiAgICAgICAgICAgICAgICAvLyAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvLyByZXR1cm4gMAogICAgICAgIH0sCiAgICAgICAgY291bnRaZXJvcyhudW0pIHsKICAgICAgICAgICAgaWYgKG51bSkgewogICAgICAgICAgICAgICAgbGV0IHNwbGl0dGVkID0gbnVtLnNwbGl0KCIiKTsKICAgICAgICAgICAgICAgIGxldCBpID0gMDsKICAgICAgICAgICAgICAgIHdoaWxlIChzcGxpdHRlZC5zaGlmdCgpID09IDApIHsKICAgICAgICAgICAgICAgICAgICBpICs9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gaTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9LAogICAgICAgIG51bWJlclRvU3RyaW5nKG51bSkgewogICAgICAgICAgICBpZiAobnVtKSB7CiAgICAgICAgICAgICAgICBsZXQgbnVtU3RyID0gU3RyaW5nKG51bSk7CiAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMobnVtKSA8IDEuMCkgewogICAgICAgICAgICAgICAgICAgIGxldCBlID0gcGFyc2VJbnQobnVtLnRvU3RyaW5nKCkuc3BsaXQoImUtIilbMV0pOwogICAgICAgICAgICAgICAgICAgIGlmIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBuZWdhdGl2ZSA9IG51bSA8IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZWdhdGl2ZSkgbnVtICo9IC0xOwogICAgICAgICAgICAgICAgICAgICAgICBudW0gKj0gTWF0aC5wb3coMTAsIGUgLSAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgbnVtU3RyID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICIwLiIgKyBuZXcgQXJyYXkoZSkuam9pbigiMCIpICsgbnVtLnRvU3RyaW5nKCkuc3Vic3RyaW5nKDIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAobmVnYXRpdmUpIG51bVN0ciA9ICItIiArIG51bVN0cjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGxldCBlID0gcGFyc2VJbnQobnVtLnRvU3RyaW5nKCkuc3BsaXQoIisiKVsxXSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGUgPiAyMCkgewogICAgICAgICAgICAgICAgICAgICAgICBlIC09IDIwOwogICAgICAgICAgICAgICAgICAgICAgICBudW0gLz0gTWF0aC5wb3coMTAsIGUpOwogICAgICAgICAgICAgICAgICAgICAgICBudW1TdHIgPSBudW0udG9TdHJpbmcoKSArIG5ldyBBcnJheShlICsgMSkuam9pbigiMCIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIGNvbnN0IHplcm9zID0gdGhpcy5udW1iZXJPZlplcm9zKG51bVN0cikKICAgICAgICAgICAgICAgIHJldHVybiBudW1TdHI7IC8vcGFyc2VGbG9hdChudW1TdHIpLnRvRml4ZWQoemVyb3MgKyAxKQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzaG93V2FyaW5nTWVzc2FnZSh0aXRsZSwgdGV4dCwgY29uZmlybUJ1dHRvblRleHQpIHsKICAgICAgICAgICAgdGhpcy4kc3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogdGl0bGUsCiAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0LAogICAgICAgICAgICAgICAgaWNvbjogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjNGQ0ODQ4IiwKICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI0VEMUEzQSIsCiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogY29uZmlybUJ1dHRvblRleHQsCiAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygiMSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIG9uVmFyaWFuY2VBY2NDaGFuZ2VkKCkgewogICAgICAgICAgICB0aGlzLmF1dG9DYWxjdWxhdGUoKTsKICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlQXBwbHlUbygpOwogICAgICAgICAgICB0aGlzLmF1dG9DYWxjdWxhdGVEZXBvc2l0KCk7CiAgICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZUNhc2hSZWZ1bmQoKTsKICAgICAgICAgICAgdGhpcy5jYWxjdWxhdGVBbW91bnQoKTsKICAgICAgICB9LAogICAgICAgIHNocmlua0RhdGEoKSB7CiAgICAgICAgICAgIHRoaXMualJhdyA9IFtdOwogICAgICAgICAgICBjb25zdCBvYmogPSB0aGlzLmpSYXcuY29uY2F0KAogICAgICAgICAgICAgICAgdGhpcy5qUmF3MSwKICAgICAgICAgICAgICAgIHRoaXMualJhdzIsCiAgICAgICAgICAgICAgICB0aGlzLmpSYXczLAogICAgICAgICAgICAgICAgdGhpcy5qUmF3NCwKICAgICAgICAgICAgICAgIHRoaXMualJhdzUKICAgICAgICAgICAgKTsKICAgICAgICAgICAgY29uc3QgdW5pcXVlcyA9IHRoaXMucmVtb3ZlRHVwbGljYXRlKAogICAgICAgICAgICAgICAgb2JqCiAgICAgICAgICAgICk7IC8qWy4uLm5ldyBTZXQoYWNjb3VudElkLm1hcChpID0+IHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgaWRfOiBpLmlkXywKICAgICAgICAgICAgICAgICAgICBpZDogaS5pZCwKICAgICAgICAgICAgICAgICAgICB0eXBlOiBpLnR5cGUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkpXSovCgogICAgICAgICAgICB1bmlxdWVzLmZvckVhY2goKG4pID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGZvdW5kID0gb2JqLmZpbHRlcigobSkgPT4gbS5pZCA9PT0gbi5pZCk7CiAgICAgICAgICAgICAgICBsZXQgYW1vdW50ID0gMCwKICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudCA9IDA7CiAgICAgICAgICAgICAgICBmb3VuZC5mb3JFYWNoKCh6KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgYW1vdW50ICs9IHBhcnNlRmxvYXQoei5hbW91bnQgfHwgMCk7CiAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQgKz0gcGFyc2VGbG9hdCh6LmV4Y2hhbmdlQW1vdW50IHx8IDApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBuLmV4Y2hhbmdlQW1vdW50ID0gcGFyc2VGbG9hdChleGNoYW5nZUFtb3VudCk7IC8vdGhpcy5udW1iZXJGb3JtYXQoYW1vdW50KQogICAgICAgICAgICAgICAgbi5hbW91bnQgPSBwYXJzZUZsb2F0KGFtb3VudCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmpSYXcgPSB1bmlxdWVzOwogICAgICAgICAgICBsZXQgZHIgPSAwLAogICAgICAgICAgICAgICAgY3IgPSAwOwogICAgICAgICAgICB0aGlzLmpSYXcuZm9yRWFjaCgoaikgPT4gewogICAgICAgICAgICAgICAgc3dpdGNoIChqLnR5cGUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICJjciI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNyICs9IHBhcnNlRmxvYXQoai5hbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJkciI6CiAgICAgICAgICAgICAgICAgICAgICAgIGRyICs9IHBhcnNlRmxvYXQoai5hbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuZHIgPSBkcjsKICAgICAgICAgICAgdGhpcy5jciA9IGNyOwogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coImRyPSIsIGRyLCAiY3I9IiwgY3IsICJkcitjciA9ICIsIGRyICsgY3IpOwogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkodGhpcy5qUmF3KSwgInVuaXF1ZXMiLCB0aGlzLmNyZWRpdE1lbW8pOwogICAgICAgIH0sCiAgICAgICAgb2Zmc2V0SW52b2ljZUNoYW5nZWQoKSB7CiAgICAgICAgICAgIC8vdG9kbzogYWRkIGludm9pY2UgdG8gbGluZQogICAgICAgICAgICBpZiAodGhpcy5vZmZzZXRJbnZvaWNlKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0eG5JZCA9IHRoaXMub2Zmc2V0SW52b2ljZS5pZCB8fCB7fTsKICAgICAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5sb2NhdGlvbiA9IHRoaXMub2Zmc2V0SW52b2ljZS5sb2NhdGlvbiB8fCB7fTsKICAgICAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5zZWdtZW50ID0gdGhpcy5vZmZzZXRJbnZvaWNlLnNlZ21lbnQgfHwge307CiAgICAgICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8ucHJvamVjdCA9IHRoaXMub2Zmc2V0SW52b2ljZS5wcm9qZWN0IHx8IHt9OwogICAgICAgICAgICAgICAgdGhpcy5vZmZzZXRMaXN0ID0gW107CiAgICAgICAgICAgICAgICBpZiAodHhuSWQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9mZnNldExpc3QgPSB0aGlzLm9mZnNldEludm9pY2VMaXN0LmZpbHRlcigKICAgICAgICAgICAgICAgICAgICAgICAgKG8pID0+IG8uaWQgPT09IHR4bklkCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZkZyb20ucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB0aGlzLm9mZnNldEludm9pY2UuaWQgfHwgJycsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZTogdGhpcy5vZmZzZXRJbnZvaWNlLnJlZmVyZW5jZU5vIHx8ICcnLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnSW52b2ljZScKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygncmVmRicsIHRoaXMucmVmRnJvbSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcHJpY2VUZW1wbGF0ZShkYXRhSXRlbSkgewogICAgICAgICAgICBpZiAoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgICAgIGlmIChkYXRhSXRlbS5oYXNPd25Qcm9wZXJ0eSgicHJpY2UiKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyhkYXRhSXRlbS5wcmljZSB8fCAwLCBkYXRhSXRlbS5kZWNpbWFsRm9ybWF0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9LAogICAgICAgIGFtdFRlbXBsYXRlKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGlmIChkYXRhSXRlbSkgewogICAgICAgICAgICAgICAgaWYgKGRhdGFJdGVtLmhhc093blByb3BlcnR5KCJhbW91bnQiKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyhkYXRhSXRlbS5hbW91bnQgfHwgMCwgZGF0YUl0ZW0uZGVjaW1hbEZvcm1hdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfSwKICAgICAgICBIZWxwKGtleV9zZWFyY2gpIHsKICAgICAgICAgICAgU2hvd1Jlc291cmNlKGtleV9zZWFyY2gpOwogICAgICAgIH0sCiAgICAgICAgbWV0aG9kVGVtcGxhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3QgbWV0aG9kID0gZGF0YUl0ZW0ucGF5bWVudE9wdGlvbjsKICAgICAgICAgICAgaWYgKG1ldGhvZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGA8c3Bhbj4ke21ldGhvZC5iYW5rQWNjb3VudE5hbWUgfHwgYGB9PC9zcGFuPmA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYGA7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFtb3VudFRlbXBsYXRlKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGNvbnN0IGFtdCA9IGRhdGFJdGVtLmFtb3VudDsKICAgICAgICAgICAgaWYgKGFtdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGtlbmRvLnRvU3RyaW5nKHBhcnNlRmxvYXQoYW10KSwgYCR7dGhpcy5kZWNpbWFsRm9ybWF0fWApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIG1ldGhvZERyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IG5hbWU9IicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgICAgICAgICAgICBhdXRvQmluZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiAic3RhcnRzd2l0aCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogIm5hbWUiLAogICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZUZpZWxkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAiPHNwYW4+Iz1jb2RlIyAtICM9IG5hbWUjPC9zcGFuPiIsCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6ICItLVNlbGVjdC0tIiwKICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlOiBuZXcga2VuZG8uZGF0YS5EYXRhU291cmNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogdGhpcy5wYXltZW50TWV0aG9kLAogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBudW1iZXJGb3JtYXQodmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIGtlbmRvLnRvU3RyaW5nKHZhbHVlLCBgJHt0aGlzLmRlY2ltYWxGb3JtYXR9YCk7CiAgICAgICAgfSwKICAgICAgICBvbkRlcG9zaXRMaW5lRFNDaGFuZ2UoZSkgewogICAgICAgICAgICBpZiAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgbGV0IGRhdGFSb3cgPSBlLml0ZW1zWzBdOwogICAgICAgICAgICAgICAgc3dpdGNoIChlLmZpZWxkKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiYW1vdW50IjoKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImV4Y2hhbmdlQW1vdW50IiwgZGF0YVJvdy5hbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpOwogICAgICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlQXBwbHlUbygpOwogICAgICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlRGVwb3NpdCgpOwogICAgICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlQ2FzaFJlZnVuZCgpOwogICAgICAgICAgICAgICAgdGhpcy5jYWxjdWxhdGVBbW91bnQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgb25BcHBseVRvTGluZUNoYW5nZShlKSB7CiAgICAgICAgICAgIGlmIChlLmZpZWxkKSB7CiAgICAgICAgICAgICAgICBsZXQgZGF0YVJvdyA9IGUuaXRlbXNbMF0sCiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gMCwKICAgICAgICAgICAgICAgICAgICBhbW91bnQgPSAwOwogICAgICAgICAgICAgICAgc3dpdGNoIChlLmZpZWxkKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAicGFpZEFtb3VudCI6CiAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudCA9IHBhcnNlRmxvYXQoZGF0YVJvdy5hbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSBwYXJzZUZsb2F0KGRhdGFSb3cucGFpZEFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvZmZzZXQgPiBhbW91bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJwYWlkQW1vdW50IiwgYW1vdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJwYWlkQW1vdW50VG9iYXNlIiwgYW1vdW50ICogZGF0YVJvdy50eG5SYXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwYWlkQW1vdW50VG9iYXNlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnBhaWRBbW91bnQgKiBkYXRhUm93LnR4blJhdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGFpZEFtb3VudFR4biIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ICogcGFyc2VGbG9hdChkYXRhUm93LnR4blJhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyhkYXRhUm93LnBhaWRBbW91bnQgKiAxIC8gZGF0YVJvdy5yYXRlVG9iYXNlLCAnQVBQTFkgUk8nKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpOwogICAgICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlQXBwbHlUbygpOwogICAgICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlRGVwb3NpdCgpOwogICAgICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlQ2FzaFJlZnVuZCgpOwogICAgICAgICAgICAgICAgdGhpcy5jYWxjdWxhdGVBbW91bnQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgb25DYXNoUmVmdW5kQ2hhbmdlKGUpIHsKICAgICAgICAgICAgaWYgKGUuZmllbGQpIHsKICAgICAgICAgICAgICAgIGxldCBkYXRhUm93ID0gZS5pdGVtc1swXSwgcE9wdGlvbiA9IHt9CiAgICAgICAgICAgICAgICBzd2l0Y2ggKGUuZmllbGQpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICJwYXltZW50T3B0aW9uIjoKICAgICAgICAgICAgICAgICAgICAgICAgcE9wdGlvbiA9IGRhdGFSb3cucGF5bWVudE9wdGlvbiB8fCB7fQogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiYWNjb3VudCIsIHBPcHRpb24uYWNjb3VudCB8fCB7fSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChlLmZpZWxkKSB7CiAgICAgICAgICAgICAgICAvLyB0aGlzLmF1dG9DYWxjdWxhdGVDYXNoUmVmdW5kKCkKICAgICAgICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpOwogICAgICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlQXBwbHlUbygpOwogICAgICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlRGVwb3NpdCgpOwogICAgICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlQ2FzaFJlZnVuZCgpOwogICAgICAgICAgICAgICAgdGhpcy5jYWxjdWxhdGVBbW91bnQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbm93VGltZXMoKSB7CiAgICAgICAgICAgIGNvbnN0IHBlcmZEYXRhID0gd2luZG93LnBlcmZvcm1hbmNlLnRpbWluZzsKICAgICAgICAgICAgY29uc3QgcGFnZUxvYWRUaW1lID0gcGVyZkRhdGEubG9hZEV2ZW50RW5kIC0gcGVyZkRhdGEubmF2aWdhdGlvblN0YXJ0OwogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2cocGFnZUxvYWRUaW1lLCAiLS0iKTsKICAgICAgICB9LAogICAgICAgIG9uRW1wbG95ZWVDaGFuZ2VkKGV2ZW50KSB7CiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZXZlbnQudmFsdWU7CiAgICAgICAgICAgIGlmICh2YWx1ZSAmJiB2YWx1ZVt0ZXh0RmllbGRdID09PSBlbXB0eUl0ZW1bdGV4dEZpZWxkXSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMubUVtcGxveWVlID0gdmFsdWU7CiAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5lbXBsb3llZSA9IHZhbHVlOwogICAgICAgIH0sCiAgICAgICAgYWZ0ZXJGZXRjaF8oanNvbikgewogICAgICAgICAgICB0aGlzLmVtcGxveWVlcyA9IGpzb24uZGF0YTsKICAgICAgICB9LAogICAgICAgIG9uRW1wbG95ZWVGaWx0ZXJDaGFuZ2VkKGV2ZW50KSB7CiAgICAgICAgICAgIGNvbnN0IGZpbHRlciA9IGV2ZW50LmZpbHRlci52YWx1ZTsKICAgICAgICAgICAgdGhpcy5yZXF1ZXN0RGF0YV8oMCwgZmlsdGVyLCB0aGlzLmVtcEJhc2VVcmwpOwogICAgICAgICAgICB0aGlzLmZpbHRlcl8gPSBmaWx0ZXI7CiAgICAgICAgfSwKICAgICAgICBhdXRvQ2FsY3VsYXRlRGlzY291bnQoZGlzY291bnRJdGVtLCBzdWJUb3RhbCkgewogICAgICAgICAgICBpZiAoZGlzY291bnRJdGVtKSB7CiAgICAgICAgICAgICAgICBjb25zdCBuYXR1cmUgPSBkaXNjb3VudEl0ZW0ubmF0dXJlIHx8ICcnCiAgICAgICAgICAgICAgICBjb25zdCBhbW91bnQgPSBkaXNjb3VudEl0ZW0uYW1vdW50IHx8IDAKICAgICAgICAgICAgICAgIGlmIChuYXR1cmUgPT09ICdBbW91bnQnKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoYW1vdW50KQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuYXR1cmUgPT09ICdQZXJjZW50YWdlJykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAoc3ViVG90YWwgKiAocGFyc2VGbG9hdChhbW91bnQpIC8gMTAwKSkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGF1dG9DYWxjdWxhdGVUYXgodGF4LCBhbW91bnQpIHsKICAgICAgICAgICAgaWYgKHRheCkgewogICAgICAgICAgICAgICAgdmFyIGZvcm11bGEgPSB0YXguZm9ybXVsYTsKICAgICAgICAgICAgICAgIHZhciBpbkFtdCA9IGtlbmRvLnBhcnNlRmxvYXQoYW1vdW50KTsKICAgICAgICAgICAgICAgIHZhciBuQW10ID0ga2VuZG8ucGFyc2VGbG9hdChhbW91bnQpOwogICAgICAgICAgICAgICAgdmFyIHRheEJhc2UgPSBrZW5kby5wYXJzZUZsb2F0KHRheC50YXhCYXNlKSAvIDEwMDsKICAgICAgICAgICAgICAgIHZhciByYXRlID0ga2VuZG8ucGFyc2VGbG9hdCh0YXgucmF0ZSkgLyAxMDA7CiAgICAgICAgICAgICAgICB2YXIgdG90YWwgPSBldmFsKGZvcm11bGEpOwogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKGluQW10LCBuQW10LCB0YXhCYXNlLCByYXRlLCBmb3JtdWxhLCB0b3RhbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdG90YWw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gcmV0dXJuIDAKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRUcmFuc2FjdGlvblJhdGUoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSh0aGlzLnRyYW5zYWN0aW9uRGF0ZSkKICAgICAgICAgICAgICAgICAgICAgICAgLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICAgICAgLnN1YnN0cigwLCAxMCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJpY2VMZXZlbCA9IHRoaXMuY3JlZGl0TWVtby5wcmljZUxldmVsOwogICAgICAgICAgICAgICAgICAgIGxldCBjb2RlID0gIiI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vZmZzZXRJbnZvaWNlcyA9IFtdOwogICAgICAgICAgICAgICAgICAgIHRoaXMub2Zmc2V0TGlzdCA9IFtdOwogICAgICAgICAgICAgICAgICAgIGlmIChwcmljZUxldmVsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcmljZUxldmVsLmhhc093blByb3BlcnR5KCJjdXJyZW5jeSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8uY3VycmVuY3kgPSBwcmljZUxldmVsLmN1cnJlbmN5OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByaWNlTGV2ZWwuY3VycmVuY3kuaGFzT3duUHJvcGVydHkoImNvZGUiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUgPSBwcmljZUxldmVsLmN1cnJlbmN5LmNvZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvZGUgIT09IHVuZGVmaW5lZCB8fCBjb2RlICE9PSAiIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0TGFzdEV4Y2hhbmdlUmF0ZUJ5RGF0ZShkYXRlLCBjb2RlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5leGNoYW5nZVJhdGUgPSByZXMuZGF0YS5kYXRhWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW5jeUNvZGUgPSB0aGlzLmV4Y2hhbmdlUmF0ZS5jb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvblJhdGUgPSB0aGlzLmV4Y2hhbmdlUmF0ZS5yYXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcmVkaXRNZW1vLnR4blJhdGUgPSB0aGlzLmV4Y2hhbmdlUmF0ZS5yYXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvblJhdGVEYXRlID0gdGhpcy5leGNoYW5nZVJhdGUuZWZmZWN0aXZlRGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5leGNoYW5nZVJhdGUgPSB0aGlzLmV4Y2hhbmdlUmF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygndGhpcy5jdXN0b21lcicsIHRoaXMuY3VzdG9tZXIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1c3RvbWVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaEludm9pY2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gMAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDUwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkUGF5bWVudFRlcm0oKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIHBheW1lbnRUZXJtSGFuZGxlci5nZXRBbGwoKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBheW1lbnRUZXJtcyA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBheW1lbnRUZXJtcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8ucGF5bWVudFRlcm0gPSB0aGlzLnBheW1lbnRUZXJtc1swXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgNTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGVycm9yTWVzc2FnZSgpIHsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRUYXgoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIHNldHRpbmdIYW5kbGVyLmdldCgpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRheCA9IHJlczsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vdGhlclRheCA9IHRoaXMudGF4LmZpbHRlcigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChtKSA9PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChtLnRheFR5cGUudHlwZUlkID09PSA3IHx8IG0udGF4VHlwZS50eXBlSWQgPT09IDEwKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0udHJhbnNhY3Rpb25UeXBlID09PSAiU2FsZSIKICAgICAgICAgICAgICAgICAgICAgICAgKTsgLy8gdmFsdWFibGUgdGF4CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3BlY2lmaWNUYXggPSB0aGlzLnRheC5maWx0ZXIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAobSkgPT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobS50YXhUeXBlLnR5cGVJZCA9PT0gOCB8fCBtLnRheFR5cGUudHlwZUlkID09PSAxMCkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLnRyYW5zYWN0aW9uVHlwZSA9PT0gIlNhbGUiCiAgICAgICAgICAgICAgICAgICAgICAgICk7IC8vIHZhbHVhYmxlIHRheAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnB1YmxpY0xpZ2h0aW5nVGF4ID0gdGhpcy50YXguZmlsdGVyKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKG0pID0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG0udGF4VHlwZS50eXBlSWQgPT09IDkgfHwgbS50YXhUeXBlLnR5cGVJZCA9PT0gMTApICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbS50cmFuc2FjdGlvblR5cGUgPT09ICJTYWxlIgogICAgICAgICAgICAgICAgICAgICAgICApOyAvLyB2YWx1YWJsZSB0YXgKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52YXRUYXggPSB0aGlzLnRheC5maWx0ZXIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAobSkgPT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobS50YXhUeXBlLnR5cGVJZCA9PT0gMSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLnRheFR5cGUudHlwZUlkID09PSA4IHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0udGF4VHlwZS50eXBlSWQgPT09IDEwKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0udHJhbnNhY3Rpb25UeXBlID09PSAiU2FsZSIKICAgICAgICAgICAgICAgICAgICAgICAgKTsgLy8gdmFsdWFibGUgdGF4CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCA1MCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZExvY2F0aW9uKCkgewogICAgICAgICAgICB0aGlzLmxvY2F0aW9ucyA9IFtdCiAgICAgICAgICAgIGNvbnN0IHJvbGVUeXBlID0gZGF0YVN0b3JlLnJvbGVUeXBlIHx8IDAKICAgICAgICAgICAgaWYgKHJvbGVUeXBlID09PSAwKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YVN0b3JlLnJvbGVEYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm9sZURhdGEgPSBkYXRhU3RvcmUucm9sZURhdGEgfHwgW10KICAgICAgICAgICAgICAgICAgICBjb25zdCBsb2NhdGlvbiA9IHJvbGVEYXRhLmZpbHRlcihpdG0gPT4gaXRtLnR5cGUgPT09ICdsb2NhdGlvbicpCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9jYXRpb25EZWZhdWx0ID0gbG9jYXRpb24uZmlsdGVyKG0gPT4gbS5pc0RlZmF1bHQgPT09IDEpCiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2NhdGlvbnMgPSBsb2NhdGlvbgogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09IHVuZGVmaW5lZCB8fCB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2NhdGlvbkRlZmF1bHQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcmVkaXRNZW1vLmxvY2F0aW9uID0gbG9jYXRpb25EZWZhdWx0WzBdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHJvbGVUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvY2F0aW9ucyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbkhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5saXN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9jYXRpb25zID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgoKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRQcm9qZWN0QnlDdXN0b21lcigpIHsKICAgICAgICAgICAgdGhpcy5jdXN0b21lclByb2plY3RzID0gW10KICAgICAgICAgICAgY29uc3Qgcm9sZVR5cGUgPSBkYXRhU3RvcmUucm9sZVR5cGUgfHwgMAogICAgICAgICAgICBpZiAocm9sZVR5cGUgPT09IDApIHsKICAgICAgICAgICAgICAgIGlmIChkYXRhU3RvcmUucm9sZURhdGEpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCByb2xlRGF0YSA9IGRhdGFTdG9yZS5yb2xlRGF0YSB8fCBbXQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2plY3QgPSByb2xlRGF0YS5maWx0ZXIoaXRtID0+IGl0bS50eXBlID09PSAncHJvamVjdCcpCiAgICAgICAgICAgICAgICAgICAgcHJvamVjdC5mb3JFYWNoKGsgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXN0b21lcnMgPSBrLmN1c3RvbWVycyB8fCBbXQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9DdXN0b21lciA9IGN1c3RvbWVycy5maWx0ZXIobiA9PiBuLmN1c3RvbWVyLmlkID09PSB0aGlzLmN1c3RvbWVyLmlkKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvQ3VzdG9tZXIubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXN0b21lclByb2plY3RzLnB1c2goaykKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCA9PT0gdW5kZWZpbmVkIHx8IHRoaXMuJHJvdXRlLnBhcmFtcy5pZCA9PT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvamVjdERlZmF1bHQgPSB0aGlzLmN1c3RvbWVyUHJvamVjdHMuZmlsdGVyKG0gPT4gbS5pc0RlZmF1bHQgPT09IDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9qZWN0RGVmYXVsdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8ucHJvamVjdCA9IHByb2plY3REZWZhdWx0WzBdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHJvbGVUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0SGFuZGxlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldEJ5Q3VzdG9tZXIodGhpcy5jdXN0b21lci5pZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3VzdG9tZXJQcm9qZWN0cyA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFNlZ21lbnQoKSB7CiAgICAgICAgICAgIHRoaXMuc2VnbWVudHMgPSBbXQogICAgICAgICAgICBjb25zdCByb2xlVHlwZSA9IGRhdGFTdG9yZS5yb2xlVHlwZSB8fCAwCiAgICAgICAgICAgIGlmIChyb2xlVHlwZSA9PT0gMCkgewogICAgICAgICAgICAgICAgaWYgKGRhdGFTdG9yZS5yb2xlRGF0YSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvbGVEYXRhID0gZGF0YVN0b3JlLnJvbGVEYXRhIHx8IFtdCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VnbWVudCA9IHJvbGVEYXRhLmZpbHRlcihpdG0gPT4gaXRtLnR5cGUgPT09ICdzZWdtZW50JykKICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWdtZW50RGVmYXVsdCA9IHNlZ21lbnQuZmlsdGVyKG0gPT4gbS5pc0RlZmF1bHQgPT09IDEpCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWdtZW50cyA9IHNlZ21lbnQKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkID09PSB1bmRlZmluZWQgfHwgdGhpcy4kcm91dGUucGFyYW1zLmlkID09PSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VnbWVudERlZmF1bHQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcmVkaXRNZW1vLnNlZ21lbnQgPSBzZWdtZW50RGVmYXVsdFswXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChyb2xlVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWdtZW50cyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5nc0hhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRTZWcoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWdtZW50cyA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZEFjY291bnQoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIGFjY291bnRIYW5kbGVyLmdldEFsbCgpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY2NDYXNoID0gcmVzLmRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChtKSA9PiBtLmFjY291bnRfdHlwZS5udW1iZXIgPD0gNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKChpdGVtKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogaXRlbS51dWlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXVpZDogaXRlbS51dWlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogaXRlbS5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxfbmFtZTogaXRlbS5sb2NhbF9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyOiBpdGVtLm51bWJlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX3RheGFibGU6IGl0ZW0uaXNfdGF4YWJsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhbmhqaUFjY0NvZGU6IGl0ZW0uYmFuaGppQWNjQ29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwX2NvZGU6IGl0ZW0uZ3JvdXBfY29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudF9hY2NvdW50OiBpdGVtLnBhcmVudF9hY2NvdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZV9jb2RlOiBpdGVtLnR5cGVfY29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRfdHlwZTogaXRlbS5hY2NvdW50X3R5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY2NEZXBvc2l0cyA9IHJlcy5kYXRhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcigobSkgPT4gbS5hY2NvdW50X3R5cGUubnVtYmVyID09PSAyMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKChpdGVtKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogaXRlbS51dWlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXVpZDogaXRlbS51dWlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogaXRlbS5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxfbmFtZTogaXRlbS5sb2NhbF9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyOiBpdGVtLm51bWJlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX3RheGFibGU6IGl0ZW0uaXNfdGF4YWJsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhbmhqaUFjY0NvZGU6IGl0ZW0uYmFuaGppQWNjQ29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwX2NvZGU6IGl0ZW0uZ3JvdXBfY29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudF9hY2NvdW50OiBpdGVtLnBhcmVudF9hY2NvdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZV9jb2RlOiBpdGVtLnR5cGVfY29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRfdHlwZTogaXRlbS5hY2NvdW50X3R5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZhcmlhbmNlQWNjcyA9IHJlcy5kYXRhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG0pID0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLmFjY291bnRfdHlwZS5udW1iZXIgPj0gMzMgJiYgbS5hY2NvdW50X3R5cGUubnVtYmVyIDw9IDQ4CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKGl0ZW0pID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBpdGVtLnV1aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dWlkOiBpdGVtLnV1aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBpdGVtLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9uYW1lOiBpdGVtLmxvY2FsX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IGl0ZW0ubnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNfdGF4YWJsZTogaXRlbS5pc190YXhhYmxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFuaGppQWNjQ29kZTogaXRlbS5iYW5oamlBY2NDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBfY29kZTogaXRlbS5ncm91cF9jb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50X2FjY291bnQ6IGl0ZW0ucGFyZW50X2FjY291bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlX2NvZGU6IGl0ZW0udHlwZV9jb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudF90eXBlOiBpdGVtLmFjY291bnRfdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuYWNjb3VudHMgPSBhd2FpdCBQcm9taXNlLmFsbChyZXMubWFwKGl0ZW0gPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgIGlkOiBpdGVtLnV1aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgIG5hbWU6IGl0ZW0ubmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgbnVtYmVyOiBpdGVtLm51bWJlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSkoKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sIDUwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkUHJpY2VMZXZlbCgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyRmlsdGVyID0gJz9uYXR1cmU9c2FsZScKICAgICAgICAgICAgICAgICAgICBwcmljZUxldmVsSGFuZGxlci5nZXQoc3RyRmlsdGVyKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmljZUxldmVsID0gcmVzOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmljZUxldmVsLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5wcmljZUxldmVsID0gdGhpcy5wcmljZUxldmVsWzBdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCA1MCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZERpc2NvdW50SXRlbSgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgZGlzY291bnRJdGVtSGFuZGxlci5saXN0KCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3BlY2lmaWNEaXNjb3VudEl0ZW0gPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCA1MCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFNhbGVGb3JtQ29udGVudCgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgc2FsZUZvcm1Db250ZW50SGFuZGxlci5saXN0KCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2FsZUZvcm1Db250ZW50ID0gZGF0YVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRlY2ltYWxGb3JtYXQgPSAibiIgKyBkYXRhWzBdLmRlY2ltYWwgfHwgIm4yIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZFJvdygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkUm93RGVwb3NpdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkUm93Q2FzaFJlZnVuZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCA1MCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgaW5pdERhdGEoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5sb2FkVmlld0NyZWRpdE1lbW8oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBlbHNlIHsKICAgICAgICAgICAgLy8gICAgIHRoaXMuYWRkUm93RGVwb3NpdCgpCiAgICAgICAgICAgIC8vICAgICB0aGlzLmFkZFJvd0Nhc2hSZWZ1bmQoKQogICAgICAgICAgICAvLyB9CiAgICAgICAgfSwKICAgICAgICB0YXhNYXBwaW5nKG9ialRheCwgdGF4KSB7CiAgICAgICAgICAgIGNvbnN0IHRheElkID0gdGF4LmlkIHx8ICcnCiAgICAgICAgICAgIGNvbnN0IHRheF8gPSBvYmpUYXguZmlsdGVyKHQgPT4gdC5pZCA9PT0gdGF4SWQpWzBdCiAgICAgICAgICAgIHJldHVybiB0YXhfIHx8IHsKICAgICAgICAgICAgICAgIGlkOiAnJywKICAgICAgICAgICAgICAgIGRlZmF1bHRUYXg6ICcnCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGRhdGFTb3VyY2VDaGFuZ2VkKGUpIHsKICAgICAgICAgICAgaWYgKGUuZmllbGQpIHsKICAgICAgICAgICAgICAgIGxldCBkYXRhUm93ID0gZS5pdGVtc1swXSwKICAgICAgICAgICAgICAgICAgICBidW9tID0ge30sIHZUYXggPSB7fSwgc3BUYXggPSB7fSwgb3RUYXggPSB7fSwgcGxUYXggPSB7fSwKICAgICAgICAgICAgICAgICAgICBjb252ZXJzaW9uUmF0ZSA9IDEsCiAgICAgICAgICAgICAgICAgICAgd2FjID0gMCwKICAgICAgICAgICAgICAgICAgICBxb2ggPSAwLAogICAgICAgICAgICAgICAgICAgIGFtb3VudCA9IDAsCiAgICAgICAgICAgICAgICAgICAgeEFtb3VudCA9IDAsCiAgICAgICAgICAgICAgICAgICAgcHJpY2UgPSAwOwogICAgICAgICAgICAgICAgc3dpdGNoIChlLmZpZWxkKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiaXRlbSI6CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuYXR0cmlidXRlXyA9IHRoaXMuYXR0cmlidXRlcy5maWx0ZXIobSA9PiBtLnR5cGUuaWQgPT09IGRhdGFSb3cudmFyaWFudC5pZCkKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImRlc2NyaXB0aW9uIiwgZGF0YVJvdy5pdGVtLmRlc2NyaXB0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnVvbSA9IGRhdGFSb3cuaXRlbS51b20gfHwge307CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJidW9tIiwgYnVvbSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgInByaWNlIjoKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudCA9IHBhcnNlRmxvYXQoZGF0YVJvdy5wcmljZSkgKiBwYXJzZUZsb2F0KGRhdGFSb3cucXR5KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhBbW91bnQgPSBhbW91bnQgKiBwYXJzZUZsb2F0KHRoaXMuY3JlZGl0TWVtby50eG5SYXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJwcmljZSIsIHBhcnNlRmxvYXQoZGF0YVJvdy5wcmljZSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImFtb3VudCIsIGFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiZXhjaGFuZ2VBbW91bnQiLCB4QW1vdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZygncHJpY2UnLGRhdGFSb3cucHJpY2UpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoInByaWNlIiwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiYW1vdW50IiwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiZXhjaGFuZ2VBbW91bnQiLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJ1b20iOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1ByaWNlTGV2ZWxDaGFuZ2VkID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidW9tID0gZGF0YVJvdy51b20uYnVvbSB8fCB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidW9tID0gZGF0YVJvdy51b20uYnVvbSB8fCB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxb2ggPSBkYXRhUm93LnVvbS5xb2ggfHwgMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzaW9uUmF0ZSA9IGRhdGFSb3cudW9tLmNvbnZlcnNpb25SYXRlIHx8IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FjID0gZGF0YVJvdy51b20ud2FjIHx8IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImJ1b20iLCBidW9tKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgid2FjIiwgd2FjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgicW9oIiwgcW9oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiB0b2RvOiBtYXBwaW5nIHRheCBvYmplY3QgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2VGF4ID0gdGhpcy50YXhNYXBwaW5nKHRoaXMudmF0VGF4LCBkYXRhUm93LnVvbS52YXRUYXggfHwge30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3RUYXggPSB0aGlzLnRheE1hcHBpbmcodGhpcy5vdGhlclRheCwgZGF0YVJvdy51b20ub3RoZXJUYXggfHwge30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BUYXggPSB0aGlzLnRheE1hcHBpbmcodGhpcy5zcGVjaWZpY1RheCwgZGF0YVJvdy51b20uc3BlY2lmaWNUYXggfHwge30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxUYXggPSB0aGlzLnRheE1hcHBpbmcodGhpcy5wdWJsaWNMaWdodGluZ1RheCwgZGF0YVJvdy51b20ucHVibGljTGlnaHRpbmdUYXggfHwge30pCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJ2YXRUYXgiLCB2VGF4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgic3BlY2lmaWNUYXgiLCBvdFRheCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoIm90aGVyVGF4Iiwgc3BUYXgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJwdWJsaWNMaWdodGluZ1RheCIsIHBsVGF4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiY29udmVyc2lvblJhdGUiLCBwYXJzZUZsb2F0KGNvbnZlcnNpb25SYXRlKSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRhdGFSb3cuc2V0KCdwcmljZScsIHBhcnNlRmxvYXQoZGF0YVJvdy51b20ucHJpY2UpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRhdGFSb3cuc2V0KCdhbW91bnQnLCBwYXJzZUZsb2F0KGRhdGFSb3cudW9tLnByaWNlKSAqIHBhcnNlRmxvYXQoZGF0YVJvdy5xdHkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhUm93LnVvbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coZGF0YVJvdywgImRhdGFSb3ciKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50ID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQoZGF0YVJvdy51b20ucHJpY2UpICogcGFyc2VGbG9hdChkYXRhUm93LnF0eSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhBbW91bnQgPSBhbW91bnQgKiBwYXJzZUZsb2F0KHRoaXMuY3JlZGl0TWVtby50eG5SYXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpY2UgPSBwYXJzZUZsb2F0KGRhdGFSb3cudW9tLnByaWNlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJwcmljZSIsIHByaWNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImFtb3VudCIsIGFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJleGNoYW5nZUFtb3VudCIsIHhBbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhkYXRhUm93LCAiZGF0YVJvdy0tIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudCA9IHBhcnNlRmxvYXQoZGF0YVJvdy5wcmljZSkgKiBwYXJzZUZsb2F0KGRhdGFSb3cucXR5KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeEFtb3VudCA9IGFtb3VudCAqIHBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLnR4blJhdGUpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoInByaWNlIiwgcGFyc2VGbG9hdChkYXRhUm93LnByaWNlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJhbW91bnQiLCBhbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiZXhjaGFuZ2VBbW91bnQiLCB4QW1vdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiYnVvbSIsIHt9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiY29udmVyc2lvblJhdGUiLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgicHJpY2UiLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiYW1vdW50IiwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoInFvaCIsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJ3YWMiLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiZXhjaGFuZ2VBbW91bnQiLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJxdHkiOgogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50ID0gcGFyc2VGbG9hdChkYXRhUm93LnByaWNlKSAqIHBhcnNlRmxvYXQoZGF0YVJvdy5xdHkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgeEFtb3VudCA9IGFtb3VudCAqIHBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLnR4blJhdGUpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJwcmljZSIsIHBhcnNlRmxvYXQoZGF0YVJvdy5wcmljZSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImFtb3VudCIsIGFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiZXhjaGFuZ2VBbW91bnQiLCB4QW1vdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgicHJpY2UiLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJhbW91bnQiLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJleGNoYW5nZUFtb3VudCIsIDApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgIm90aGVyVGF4IjoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKCItLSIsIGRhdGFSb3cpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGUuZmllbGQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmF1dG9DYWxjdWxhdGUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmF1dG9DYWxjdWxhdGVBcHBseVRvKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlRGVwb3NpdCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZUNhc2hSZWZ1bmQoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZUFtb3VudCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBvbkFjY291bnRMaW5lRFNDaGFuZ2VkKGUpIHsKICAgICAgICAgICAgaWYgKGUuZmllbGQpIHsKICAgICAgICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZUFjY291bnRMaW5lKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGF1dG9DYWxjdWxhdGUoKSB7CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuaXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpLAogICAgICAgICAgICAgICAgc3ViVG90YWwgPSAwLAogICAgICAgICAgICAgICAgdG90YWxUYXggPSAwLAogICAgICAgICAgICAgICAgZGlzY291bnRUb3RhbCA9IDAsCiAgICAgICAgICAgICAgICBzcFRheCA9IDAsCiAgICAgICAgICAgICAgICBwbHRheCA9IDAsCiAgICAgICAgICAgICAgICBvdGhlclRheCA9IDAsCiAgICAgICAgICAgICAgICB2YXRUYXggPSAwLAogICAgICAgICAgICAgICAgdGF4TGlzdCA9IFtdLAogICAgICAgICAgICAgICAgZGlzY291bnRJdGVtID0gW10sCiAgICAgICAgICAgICAgICB0YXhMaXN0RGV0YWlsID0gW10sCiAgICAgICAgICAgICAgICBzYWxlVW5pdCA9IFtdLAogICAgICAgICAgICAgICAgaW5jbHVzaXZlVGF4ID0gMCwKICAgICAgICAgICAgICAgIHdpdGhob2xkaW5nVGF4QW1vdW50ID0gMCwKICAgICAgICAgICAgICAgIGl0ZW1TdWJ0b3RhbCA9IDAsCiAgICAgICAgICAgICAgICB0eG5JdG1TdWJ0b3RhbCA9IDAsCiAgICAgICAgICAgICAgICBzZXJ2aWNlU3VidG90YWwgPSAwLAogICAgICAgICAgICAgICAgaXRlbURpc2NvdW50ID0gMCwKICAgICAgICAgICAgICAgIHNlcnZpY2VEaXNjb3VudCA9IDAsCiAgICAgICAgICAgICAgICB0eG5EaXNjb3VudCA9IDA7CiAgICAgICAgICAgIGxldCBuYXR1cmUgPSAiIiwKICAgICAgICAgICAgICAgIGN1cnJlbmN5ID0gdGhpcy5jcmVkaXRNZW1vLmN1cnJlbmN5LAogICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlID0gdGhpcy5jcmVkaXRNZW1vLmN1cnJlbmN5CiAgICAgICAgICAgICAgICAgICAgPyB0aGlzLmNyZWRpdE1lbW8uY3VycmVuY3kuY29kZQogICAgICAgICAgICAgICAgICAgIDogIiI7CiAgICAgICAgICAgIHRoaXMualJhdzEgPSBbXTsKICAgICAgICAgICAgLy8gY29uc3Qgcm93cyA9IGRzLmRhdGEoKS5maWx0ZXIobSA9PiBwYXJzZUZsb2F0KG0uYW1vdW50KSA+IDApCiAgICAgICAgICAgIC8vIGlmIChyb3dzKSB7CgogICAgICAgICAgICBkcy5kYXRhKCkuZm9yRWFjaCgodmFsdWUpID0+IHsKICAgICAgICAgICAgICAgIGxldCBtb2RpZmllclByaWNlID0gMCwgaW5jVGF4ID0gMCwgd2hUYXhBbW91bnQgPSAwLCB0YXhUeXBlSWQgPSAwOwogICAgICAgICAgICAgICAgaWYgKHZhbHVlLm1vZGlmaWVyKSB7CiAgICAgICAgICAgICAgICAgICAgbW9kaWZpZXJQcmljZSA9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUubW9kaWZpZXIucHJpY2UpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIHN1YlRvdGFsICs9IChrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmFtb3VudCkgKyBtb2RpZmllclByaWNlKQogICAgICAgICAgICAgICAgbGV0IGRpc2NvdW50ID0gMDsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5kaXNjb3VudEl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXNJdGVtRmllbGQgPSB2YWx1ZS5kaXNjb3VudEl0ZW07CiAgICAgICAgICAgICAgICAgICAgbGV0IHN1YlRvID0KICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5wcmljZSkgKiBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnF0eSk7CiAgICAgICAgICAgICAgICAgICAgZGlzY291bnQgPSB0aGlzLmF1dG9DYWxjdWxhdGVEaXNjb3VudCh2YWx1ZS5kaXNjb3VudEl0ZW0sIHN1YlRvKTsKICAgICAgICAgICAgICAgICAgICB2YWx1ZVsiZGlzY291bnRBbW91bnQiXSA9IGRpc2NvdW50OwogICAgICAgICAgICAgICAgICAgIHZhbHVlWyJkaXNjb3VudEV4Y2hhbmdlQW1vdW50Il0gPQogICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLnR4blJhdGUpOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5kaXNjb3VudEl0ZW0uaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGlzY291bnRJdGVtLnB1c2godmFsdWUuZGlzY291bnRJdGVtKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZGlzY291bnRUb3RhbCArPSBkaXNjb3VudCA/IGRpc2NvdW50IDogMDsKICAgICAgICAgICAgICAgICAgICBpZiAoZGlzY291bnQgKiAtMSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmF0dXJlID0gImRyIjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAiY3IiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoZGlzSXRlbUZpZWxkLmFjY291bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpc0l0ZW1GaWVsZC5hY2NvdW50Lmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmpSYXcxLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBkaXNJdGVtRmllbGQuYWNjb3VudC5pZCArICItIiArIG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBuZXcgSXRlbUxpbmVNb2RlbCh2YWx1ZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlOiBjdXJyZW5jeUNvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k6IGN1cnJlbmN5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lbW9SYXRlOiBrZW5kby5wYXJzZUZsb2F0KHRoaXMuY3JlZGl0TWVtby50eG5SYXRlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0WFJhdGU6IHRoaXMuY3JlZGl0TWVtby5leGNoYW5nZVJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICJEaXNjb3VudCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogZGlzSXRlbUZpZWxkLmFjY291bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudElkOiBkaXNJdGVtRmllbGQuYWNjb3VudC5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IGRpc2NvdW50ICogLTEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50ICoga2VuZG8ucGFyc2VGbG9hdCh0aGlzLmNyZWRpdE1lbW8udHhuUmF0ZSkgKiAtMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZUFzOiAiZGlzY291bnQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodmFsdWUuc2FsZVVuaXQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuc2FsZVVuaXQuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2FsZVVuaXQucHVzaCh2YWx1ZS5zYWxlVW5pdCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHZhbHVlLnNwZWNpZmljVGF4KSB7CiAgICAgICAgICAgICAgICAgICAgc3BUYXggPSB0aGlzLmF1dG9DYWxjdWxhdGVUYXgoCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLnNwZWNpZmljVGF4LAogICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmFtb3VudCkgLSBrZW5kby5wYXJzZUZsb2F0KGRpc2NvdW50KQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKCdzcCAnLCBkaXNjb3VudCkKICAgICAgICAgICAgICAgICAgICBzcFRheCA9IGtlbmRvLnBhcnNlRmxvYXQoc3BUYXgpID8ga2VuZG8ucGFyc2VGbG9hdChzcFRheCkgOiAwOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRheCA9IHZhbHVlLnNwZWNpZmljVGF4OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhc2VBbW91bnQgPSB0YXguYmFzZUFtb3VudDsKICAgICAgICAgICAgICAgICAgICBpZiAoYmFzZUFtb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmFzZUFtb3VudC50b0xvd2VyQ2FzZSgpID09PSAiaW5jbHVzaXZlIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5jbHVzaXZlVGF4ICs9IHNwVGF4OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5zcGVjaWZpY1RheC5oYXNPd25Qcm9wZXJ0eSgidGF4VHlwZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRheExpc3QucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB2YWx1ZS5zcGVjaWZpY1RheC50YXhUeXBlLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IHNwVGF4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHZhbHVlLnNwZWNpZmljVGF4LnRheFR5cGUuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXhfID0gdmFsdWUuc3BlY2lmaWNUYXggfHwge30KICAgICAgICAgICAgICAgICAgICAgICAgdGF4X1sndGF4QW1vdW50XyddID0gc3BUYXgKICAgICAgICAgICAgICAgICAgICAgICAgdGF4X1snYW1vdW50J10gPSB2YWx1ZS5hbW91bnQgfHwgMAogICAgICAgICAgICAgICAgICAgICAgICB0YXhfWydkaXNjb3VudCddID0gZGlzY291bnQgfHwgMAogICAgICAgICAgICAgICAgICAgICAgICB0YXhfWyd0eG5SYXRlJ10gPSB0aGlzLmNyZWRpdE1lbW8udHhuUmF0ZSB8fCAxCiAgICAgICAgICAgICAgICAgICAgICAgIHRheExpc3REZXRhaWwucHVzaCh0YXhfKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHNwVGF4ID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAiZHIiOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hdHVyZSA9ICJjciI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNwZWNpZmljVGF4RmllbGQgPSB2YWx1ZS5zcGVjaWZpY1RheDsKICAgICAgICAgICAgICAgICAgICBpZiAoc3BlY2lmaWNUYXhGaWVsZC5hY2NvdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzcGVjaWZpY1RheEZpZWxkLmFjY291bnQuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMualJhdzEucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHNwZWNpZmljVGF4RmllbGQuYWNjb3VudC5pZCArICItIiArIG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBuZXcgSXRlbUxpbmVNb2RlbCh2YWx1ZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVtb1JhdGU6IGtlbmRvLnBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLnR4blJhdGUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RYUmF0ZTogdGhpcy5jcmVkaXRNZW1vLmV4Y2hhbmdlUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUNvZGU6IGN1cnJlbmN5Q29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICJUYXgiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IHNwZWNpZmljVGF4RmllbGQuYWNjb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IHNwZWNpZmljVGF4RmllbGQuYWNjb3VudC5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IHNwVGF4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcFRheCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLnR4blJhdGUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlQXM6ICJ0YXgiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodmFsdWUucHVibGljTGlnaHRpbmdUYXgpIHsKICAgICAgICAgICAgICAgICAgICBwbHRheCA9IHRoaXMuYXV0b0NhbGN1bGF0ZVRheCgKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUucHVibGljTGlnaHRpbmdUYXgsCiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuYW1vdW50KSAtIGtlbmRvLnBhcnNlRmxvYXQoZGlzY291bnQpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBwbHRheCA9IGtlbmRvLnBhcnNlRmxvYXQocGx0YXgpID8ga2VuZG8ucGFyc2VGbG9hdChwbHRheCkgOiAwOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRheCA9IHZhbHVlLnB1YmxpY0xpZ2h0aW5nVGF4OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhc2VBbW91bnQgPSB0YXguYmFzZUFtb3VudDsKICAgICAgICAgICAgICAgICAgICBpZiAoYmFzZUFtb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmFzZUFtb3VudC50b0xvd2VyQ2FzZSgpID09PSAiaW5jbHVzaXZlIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5jbHVzaXZlVGF4ICs9IHBsdGF4OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5wdWJsaWNMaWdodGluZ1RheC5oYXNPd25Qcm9wZXJ0eSgidGF4VHlwZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRheExpc3QucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB2YWx1ZS5wdWJsaWNMaWdodGluZ1RheC50YXhUeXBlLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IHBsdGF4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHZhbHVlLnB1YmxpY0xpZ2h0aW5nVGF4LnRheFR5cGUuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXhfID0gdmFsdWUucHVibGljTGlnaHRpbmdUYXggfHwge30KICAgICAgICAgICAgICAgICAgICAgICAgdGF4X1sndGF4QW1vdW50XyddID0gcGx0YXgKICAgICAgICAgICAgICAgICAgICAgICAgdGF4X1snYW1vdW50J10gPSB2YWx1ZS5hbW91bnQgfHwgMAogICAgICAgICAgICAgICAgICAgICAgICB0YXhfWydkaXNjb3VudCddID0gZGlzY291bnQgfHwgMAogICAgICAgICAgICAgICAgICAgICAgICB0YXhfWyd0eG5SYXRlJ10gPSB0aGlzLmNyZWRpdE1lbW8udHhuUmF0ZSB8fCAxCiAgICAgICAgICAgICAgICAgICAgICAgIHRheExpc3REZXRhaWwucHVzaCh0YXhfKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHBsdGF4ID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAiZHIiOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hdHVyZSA9ICJjciI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNvbnN0IFBMVGF4RmllbGQgPSB2YWx1ZS5wdWJsaWNMaWdodGluZ1RheDsKICAgICAgICAgICAgICAgICAgICBpZiAoUExUYXhGaWVsZC5hY2NvdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChQTFRheEZpZWxkLmFjY291bnQuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMualJhdzEucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IFBMVGF4RmllbGQuYWNjb3VudC5pZCArICItIiArIG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBuZXcgSXRlbUxpbmVNb2RlbCh2YWx1ZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVtb1JhdGU6IGtlbmRvLnBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLnR4blJhdGUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RYUmF0ZTogdGhpcy5jcmVkaXRNZW1vLmV4Y2hhbmdlUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUNvZGU6IGN1cnJlbmN5Q29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICJUYXgiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IFBMVGF4RmllbGQuYWNjb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IFBMVGF4RmllbGQuYWNjb3VudC5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IHBsdGF4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbHRheCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLnR4blJhdGUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlQXM6ICJ0YXgiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodmFsdWUub3RoZXJUYXgpIHsKICAgICAgICAgICAgICAgICAgICBvdGhlclRheCA9IHRoaXMuYXV0b0NhbGN1bGF0ZVRheCgKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUub3RoZXJUYXgsCiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuYW1vdW50KSAtIGtlbmRvLnBhcnNlRmxvYXQoZGlzY291bnQpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBvdGhlclRheCA9IGtlbmRvLnBhcnNlRmxvYXQob3RoZXJUYXgpCiAgICAgICAgICAgICAgICAgICAgICAgID8ga2VuZG8ucGFyc2VGbG9hdChvdGhlclRheCkKICAgICAgICAgICAgICAgICAgICAgICAgOiAwOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRheCA9IHZhbHVlLm90aGVyVGF4OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhc2VBbW91bnQgPSB0YXguYmFzZUFtb3VudDsKICAgICAgICAgICAgICAgICAgICBpZiAoYmFzZUFtb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmFzZUFtb3VudC50b0xvd2VyQ2FzZSgpID09PSAiaW5jbHVzaXZlIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5jbHVzaXZlVGF4ICs9IG90aGVyVGF4OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5vdGhlclRheC5oYXNPd25Qcm9wZXJ0eSgidGF4VHlwZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRheExpc3QucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB2YWx1ZS5vdGhlclRheC50YXhUeXBlLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IG90aGVyVGF4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHZhbHVlLm90aGVyVGF4LnRheFR5cGUuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXhfID0gdmFsdWUub3RoZXJUYXggfHwge30KICAgICAgICAgICAgICAgICAgICAgICAgdGF4X1sndGF4QW1vdW50XyddID0gb3RoZXJUYXgKICAgICAgICAgICAgICAgICAgICAgICAgdGF4X1snYW1vdW50J10gPSB2YWx1ZS5hbW91bnQgfHwgMAogICAgICAgICAgICAgICAgICAgICAgICB0YXhfWydkaXNjb3VudCddID0gZGlzY291bnQgfHwgMAogICAgICAgICAgICAgICAgICAgICAgICB0YXhfWyd0eG5SYXRlJ10gPSB0aGlzLmNyZWRpdE1lbW8udHhuUmF0ZSB8fCAxCiAgICAgICAgICAgICAgICAgICAgICAgIHRheExpc3REZXRhaWwucHVzaCh0YXhfKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKG90aGVyVGF4ID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAiZHIiOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hdHVyZSA9ICJjciI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG90aGVyVGF4RmllbGQgPSB2YWx1ZS5vdGhlclRheDsKICAgICAgICAgICAgICAgICAgICBpZiAob3RoZXJUYXhGaWVsZC5hY2NvdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvdGhlclRheEZpZWxkLmFjY291bnQuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMualJhdzEucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IG90aGVyVGF4RmllbGQuYWNjb3VudC5pZCArICItIiArIG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBuZXcgSXRlbUxpbmVNb2RlbCh2YWx1ZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVtb1JhdGU6IGtlbmRvLnBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLnR4blJhdGUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RYUmF0ZTogdGhpcy5jcmVkaXRNZW1vLmV4Y2hhbmdlUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUNvZGU6IGN1cnJlbmN5Q29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICJUYXgiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IG90aGVyVGF4RmllbGQuYWNjb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IG90aGVyVGF4RmllbGQuYWNjb3VudC5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IG90aGVyVGF4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdGhlclRheCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLnR4blJhdGUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlQXM6ICJ0YXgiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHZhbHVlLnZhdFRheCkgewogICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZygnVmF0IFRheCcsIHZhbHVlLnZhdFRheCkKICAgICAgICAgICAgICAgICAgICBsZXQgYW10ID0KICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdChzcFRheCA/IHNwVGF4IDogMCkgKwogICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHBsdGF4ID8gcGx0YXggOiAwKSArCiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQob3RoZXJUYXggPyBvdGhlclRheCA6IDApICsKICAgICAgICAgICAgICAgICAgICAgICAgKGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuYW1vdW50ID8gdmFsdWUuYW1vdW50IDogMCkgLQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGRpc2NvdW50ID8gZGlzY291bnQgOiAwKSk7CiAgICAgICAgICAgICAgICAgICAgdmF0VGF4ID0gdGhpcy5hdXRvQ2FsY3VsYXRlVGF4KHZhbHVlLnZhdFRheCwgYW10KTsKICAgICAgICAgICAgICAgICAgICB2YXRUYXggPSBrZW5kby5wYXJzZUZsb2F0KHZhdFRheCkgPyBrZW5kby5wYXJzZUZsb2F0KHZhdFRheCkgOiAwOwogICAgICAgICAgICAgICAgICAgIHZhbHVlWyJ2YXRUYXhBbW91bnQiXSA9IHZhdFRheDsKICAgICAgICAgICAgICAgICAgICB2YWx1ZVsidmF0VGF4RXhjaGFuZ2VBbW91bnQiXSA9CiAgICAgICAgICAgICAgICAgICAgICAgIHZhdFRheCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLnR4blJhdGUpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRheCA9IHZhbHVlLnZhdFRheDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiYXNlQW1vdW50ID0gdGF4LmJhc2VBbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKGJhc2VBbW91bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJhc2VBbW91bnQudG9Mb3dlckNhc2UoKSA9PT0gImluY2x1c2l2ZSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluY2x1c2l2ZVRheCArPSB2YXRUYXg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNUYXggPSBzcFRheDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUudmF0VGF4Lmhhc093blByb3BlcnR5KCJ0YXhUeXBlIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGF4TGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHZhbHVlLnZhdFRheC50YXhUeXBlLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IHZhdFRheCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB2YWx1ZS52YXRUYXgudGF4VHlwZS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhdFRheF8gPSB2YWx1ZS52YXRUYXggfHwge30KICAgICAgICAgICAgICAgICAgICAgICAgdmF0VGF4X1sndGF4QW1vdW50XyddID0gdmF0VGF4CiAgICAgICAgICAgICAgICAgICAgICAgIHZhdFRheF9bJ2Ftb3VudCddID0gdmFsdWUuYW1vdW50IHx8IDAKICAgICAgICAgICAgICAgICAgICAgICAgdmF0VGF4X1snZGlzY291bnQnXSA9IGRpc2NvdW50IHx8IDAKICAgICAgICAgICAgICAgICAgICAgICAgdmF0VGF4X1sndHhuUmF0ZSddID0gdGhpcy5jcmVkaXRNZW1vLnR4blJhdGUgfHwgMQogICAgICAgICAgICAgICAgICAgICAgICB2YXRUYXhfWydpc1ZhdCddID0gMQogICAgICAgICAgICAgICAgICAgICAgICB2YXRUYXhfLmRldGFpbCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwZWNpZmljVGF4OiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpY0xpZ2h0aW5nVGF4OiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG90aGVyVGF4OiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB0YXhMaXN0RGV0YWlsLnB1c2godmF0VGF4Xyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS52YXRUYXguaGFzT3duUHJvcGVydHkoInRheFR5cGUiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXhUeXBlID0gdmFsdWUudmF0VGF4LnRheFR5cGUgfHwge307CiAgICAgICAgICAgICAgICAgICAgICAgIHRheFR5cGVJZCA9IHRheFR5cGUudHlwZUlkIHx8IDA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxldCB0YXhBbW91bnQgPSB2YXRUYXg7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRheFR5cGVJZCA9PT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICB3aXRoaG9sZGluZ1RheEFtb3VudCArPSB2YXRUYXg7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoVGF4QW1vdW50ID0gdmF0VGF4OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodGF4QW1vdW50ID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAiZHIiOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hdHVyZSA9ICJjciI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh2YXRUYXggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hdHVyZSA9ICJkciI7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmF0dXJlID0gImNyIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmF0VGF4RmllbGQgPSB2YWx1ZS52YXRUYXg7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhdFRheEZpZWxkLmFjY291bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhdFRheEZpZWxkLmFjY291bnQuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMualJhdzEucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHZhdFRheEZpZWxkLmFjY291bnQuaWQgKyAiLSIgKyBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogbmV3IEl0ZW1MaW5lTW9kZWwodmFsdWUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lbW9SYXRlOiBrZW5kby5wYXJzZUZsb2F0KHRoaXMuY3JlZGl0TWVtby50eG5SYXRlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0WFJhdGU6IHRoaXMuY3JlZGl0TWVtby5leGNoYW5nZVJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlOiBjdXJyZW5jeUNvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k6IGN1cnJlbmN5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAiVGF4IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiB2YXRUYXhGaWVsZC5hY2NvdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRJZDogdmF0VGF4RmllbGQuYWNjb3VudC5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IHZhdFRheCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmF0VGF4ICoga2VuZG8ucGFyc2VGbG9hdCh0aGlzLmNyZWRpdE1lbW8udHhuUmF0ZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogbmF0dXJlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVBczogInRheCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRvdGFsVGF4ICs9CiAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdChzcFRheCA/IHNwVGF4IDogMCkgKwogICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQocGx0YXggPyBwbHRheCA6IDApICsKICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KG90aGVyVGF4ID8gb3RoZXJUYXggOiAwKSArCiAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YXRUYXggPyB2YXRUYXggOiAwKTsKICAgICAgICAgICAgICAgIHN1YlRvdGFsICs9CiAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5hbW91bnQpICsgbW9kaWZpZXJQcmljZSAtIGluY1RheDsKICAgICAgICAgICAgICAgIGNvbnN0IGFtdCA9CiAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5hbW91bnQpICsgbW9kaWZpZXJQcmljZSAtIGluY1RheCArIHdoVGF4QW1vdW50OwogICAgICAgICAgICAgICAgY29uc3QgeEFtb3VudCA9CiAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdChhbXQpICoga2VuZG8ucGFyc2VGbG9hdCh0aGlzLmNyZWRpdE1lbW8udHhuUmF0ZSk7CiAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gdmFsdWUuaXRlbTsKICAgICAgICAgICAgICAgIGNvbnN0IGl0bVR5cGUgPSBpdGVtLnR5cGUgfHwgIiI7CiAgICAgICAgICAgICAgICBpZiAoaXRtVHlwZSA9PT0gIlZhcmlhbnQiKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbVN1YnRvdGFsICs9CiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuY29zdCkgKiBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnF0eSk7CiAgICAgICAgICAgICAgICAgICAgaXRlbURpc2NvdW50ICs9IGtlbmRvLnBhcnNlRmxvYXQoZGlzY291bnQpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdG1UeXBlID09PSAiU2VydmljZSIpIHsKICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlU3VidG90YWwgKz0KICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5jb3N0KSAqIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucXR5KTsKICAgICAgICAgICAgICAgICAgICBpdGVtRGlzY291bnQgKz0ga2VuZG8ucGFyc2VGbG9hdChkaXNjb3VudCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHR4bkl0bVN1YnRvdGFsICs9CiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuY29zdCkgKiBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnF0eSk7CiAgICAgICAgICAgICAgICAgICAgaXRlbURpc2NvdW50ICs9IGtlbmRvLnBhcnNlRmxvYXQoZGlzY291bnQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3Qgd2FjID0gcGFyc2VGbG9hdCh2YWx1ZS53YWMgfHwgMCkKICAgICAgICAgICAgICAgIGNvbnN0IHF0eSA9IHBhcnNlRmxvYXQodmFsdWUucXR5IHx8IDEpCiAgICAgICAgICAgICAgICBpZiAoYW10ID4gMCkgewogICAgICAgICAgICAgICAgICAgIG5hdHVyZSA9ICJkciI7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG5hdHVyZSA9ICJjciI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnR5cGUgPT09ICJTZXJ2aWNlIikgewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgaW5jb21lQWNjID0gaXRlbS5pbmNvbWVBY2M7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmhhc093blByb3BlcnR5KCJpbmNvbWVBY2MiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uaW5jb21lQWNjLmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5qUmF3MS5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGluY29tZUFjYy5pZCArICItIiArIG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogbmV3IEl0ZW1MaW5lTW9kZWwodmFsdWUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZW1vUmF0ZToga2VuZG8ucGFyc2VGbG9hdCh0aGlzLmNyZWRpdE1lbW8udHhuUmF0ZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RYUmF0ZTogdGhpcy5jcmVkaXRNZW1vLmV4Y2hhbmdlUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlOiBjdXJyZW5jeUNvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiBjdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuY3JlZGl0TWVtby5qb3VybmFsTm90ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogaW5jb21lQWNjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IGluY29tZUFjYy5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBhbXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OiB4QW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVBczogIml0ZW0iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmhhc093blByb3BlcnR5KCJkZWZlcnJlZEluY29tZUFjYyIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5kZWZlcnJlZEluY29tZUFjYy5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkZWZlcnJlZEluQWNjID0gaXRlbS5kZWZlcnJlZEluY29tZUFjYzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmpSYXcxLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogZGVmZXJyZWRJbkFjYy5pZCArICItIiArIG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogbmV3IEl0ZW1MaW5lTW9kZWwodmFsdWUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZW1vUmF0ZToga2VuZG8ucGFyc2VGbG9hdCh0aGlzLmNyZWRpdE1lbW8udHhuUmF0ZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RYUmF0ZTogdGhpcy5jcmVkaXRNZW1vLmV4Y2hhbmdlUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlOiBjdXJyZW5jeUNvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiBjdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuY3JlZGl0TWVtby5qb3VybmFsTm90ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogZGVmZXJyZWRJbkFjYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudElkOiBkZWZlcnJlZEluQWNjLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IGFtdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQ6IHhBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZUFzOiAiaXRlbSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0udHlwZSA9PT0gIlZhcmlhbnQiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmhhc093blByb3BlcnR5KCJpbmNvbWVBY2MiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uaW5jb21lQWNjLmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGluY29tZUFjYyA9IGl0ZW0uaW5jb21lQWNjOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMualJhdzEucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBpbmNvbWVBY2MuaWQgKyAiLSIgKyBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IG5ldyBJdGVtTGluZU1vZGVsKHZhbHVlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVtb1JhdGU6IGtlbmRvLnBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLnR4blJhdGUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0WFJhdGU6IHRoaXMuY3JlZGl0TWVtby5leGNoYW5nZVJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5Q29kZTogY3VycmVuY3lDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmNyZWRpdE1lbW8uam91cm5hbE5vdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IGl0ZW0uaW5jb21lQWNjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IGl0ZW0uaW5jb21lQWNjLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IGFtdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQ6IHhBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZUFzOiAiaXRlbSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uaGFzT3duUHJvcGVydHkoImludmVudG9yeUFjYyIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAiY3IiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uaW52ZW50b3J5QWNjLmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGludmVudG9yeUFjYyA9IGl0ZW0uaW52ZW50b3J5QWNjOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMualJhdzEucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBpbnZlbnRvcnlBY2MuaWQgKyAiLSIgKyBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IG5ldyBJdGVtTGluZU1vZGVsKHZhbHVlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVtb1JhdGU6IGtlbmRvLnBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLnR4blJhdGUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0WFJhdGU6IHRoaXMuY3JlZGl0TWVtby5leGNoYW5nZVJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5Q29kZTogY3VycmVuY3lDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmNyZWRpdE1lbW8uam91cm5hbE5vdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IGl0ZW0uaW52ZW50b3J5QWNjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IGl0ZW0uaW52ZW50b3J5QWNjLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IChxdHkgKiB3YWMpICogLTEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OiAocXR5ICogd2FjKSAqIC0xLCAvL3hBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZUFzOiAiaXRlbSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uaGFzT3duUHJvcGVydHkoImNvc3RPZkdvb2RzU29sZEFjYyIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAiZHIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uY29zdE9mR29vZHNTb2xkQWNjLmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNvc3RPZkdvb2RzU29sZEFjYyA9IGl0ZW0uY29zdE9mR29vZHNTb2xkQWNjOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMualJhdzEucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBjb3N0T2ZHb29kc1NvbGRBY2MuaWQgKyAiLSIgKyBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IG5ldyBJdGVtTGluZU1vZGVsKHZhbHVlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVtb1JhdGU6IGtlbmRvLnBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLnR4blJhdGUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0WFJhdGU6IHRoaXMuY3JlZGl0TWVtby5leGNoYW5nZVJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5Q29kZTogY3VycmVuY3lDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmNyZWRpdE1lbW8uam91cm5hbE5vdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IGl0ZW0uY29zdE9mR29vZHNTb2xkQWNjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IGl0ZW0uY29zdE9mR29vZHNTb2xkQWNjLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IHF0eSAqIHdhYywgLy8gcXR5KmF2Z19jb3N0ICwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQ6IHF0eSAqIHdhYywgLy94QW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVBczogIml0ZW0iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLnR5cGUgPT09ICJGaXhlZCBBc3NldCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uaGFzT3duUHJvcGVydHkoImFzc2V0QWNjIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmFzc2V0QWNjLmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGFzc2V0QWNjID0gaXRlbS5hc3NldEFjYzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmpSYXcxLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogYXNzZXRBY2MuaWQgKyAiLSIgKyBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IG5ldyBJdGVtTGluZU1vZGVsKHZhbHVlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVtb1JhdGU6IGtlbmRvLnBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLnR4blJhdGUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0WFJhdGU6IHRoaXMuY3JlZGl0TWVtby5leGNoYW5nZVJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5Q29kZTogY3VycmVuY3lDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmNyZWRpdE1lbW8uam91cm5hbE5vdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IGl0ZW0uYXNzZXRBY2MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRJZDogaXRlbS5hc3NldEFjYy5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBhbXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OiB4QW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVBczogIml0ZW0iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLnR5cGUgPT09ICJUcmFuc2FjdGlvbiBJdGVtIikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5oYXNPd25Qcm9wZXJ0eSgiYWNjb3VudCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5hY2NvdW50Lmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5qUmF3MS5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGl0ZW0uYWNjb3VudC5pZCArICItIiArIG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogbmV3IEl0ZW1MaW5lTW9kZWwodmFsdWUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZW1vUmF0ZToga2VuZG8ucGFyc2VGbG9hdCh0aGlzLmNyZWRpdE1lbW8udHhuUmF0ZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RYUmF0ZTogdGhpcy5jcmVkaXRNZW1vLmV4Y2hhbmdlUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlOiBjdXJyZW5jeUNvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiBjdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuY3JlZGl0TWVtby5qb3VybmFsTm90ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogaXRlbS5hY2NvdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IGl0ZW0uYWNjb3VudC5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBhbXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OiB4QW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVBczogIml0ZW0iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9pbmNsdWRlIFRheCBBbW91bnQKICAgICAgICAgICAgICAgIGNvbnN0IGFtb3VudE5vZGlzY291bnQgPSBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnByaWNlKSAqIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucXR5KSAtIGRpc2NvdW50OwogICAgICAgICAgICAgICAgY29uc3QgaW5jbHVkZVRheEFtb3VudCA9IGFtb3VudE5vZGlzY291bnQgKyB2YXRUYXggKyBwbHRheCArIHNwVGF4ICsgb3RoZXJUYXg7CiAgICAgICAgICAgICAgICB2YWx1ZVsiaW5jbHVkZVRheEFtb3VudCJdID0gaW5jbHVkZVRheEFtb3VudDsKICAgICAgICAgICAgICAgIHZhbHVlWyJpbmNsdWRlVGF4RXhjaGFuZ2VBbW91bnQiXSA9IGluY2x1ZGVUYXhBbW91bnQgKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMuY3JlZGl0TWVtby50eG5SYXRlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIC8vIH0KCiAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5pdGVtU3VidG90YWwgPSBpdGVtU3VidG90YWw7CiAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5pbmNsdXNpdmVUYXhBbW91bnQgPSBpbmNsdXNpdmVUYXg7CiAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5leGNoYW5nZUl0ZW1TdWJ0b3RhbCA9CiAgICAgICAgICAgICAgICBpdGVtU3VidG90YWwgKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMuY3JlZGl0TWVtby50eG5SYXRlKTsKICAgICAgICAgICAgdGhpcy5jcmVkaXRNZW1vLnNlcnZpY2VTdWJ0b3RhbCA9IHNlcnZpY2VTdWJ0b3RhbDsKICAgICAgICAgICAgdGhpcy5jcmVkaXRNZW1vLmV4Y2hhbmdlU2VydmljZVN1YnRvdGFsID0KICAgICAgICAgICAgICAgIHNlcnZpY2VTdWJ0b3RhbCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLnR4blJhdGUpOwogICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8udHhuSXRtU3VidG90YWwgPSB0eG5JdG1TdWJ0b3RhbDsKICAgICAgICAgICAgdGhpcy5jcmVkaXRNZW1vLmV4Y2hhbmdlVHhuSXRtU3VidG90YWwgPQogICAgICAgICAgICAgICAgdHhuSXRtU3VidG90YWwgKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMuY3JlZGl0TWVtby50eG5SYXRlKTsKICAgICAgICAgICAgdGhpcy5jcmVkaXRNZW1vLml0ZW1EaXNjb3VudCA9IGl0ZW1EaXNjb3VudDsKICAgICAgICAgICAgdGhpcy5jcmVkaXRNZW1vLmV4Y2hhbmdlSXRlbURpc2NvdW50ID0KICAgICAgICAgICAgICAgIGl0ZW1EaXNjb3VudCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLnR4blJhdGUpOwogICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8uc2VydmljZURpc2NvdW50ID0gc2VydmljZURpc2NvdW50OwogICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8uZXhjaGFuZ2VTZXJ2aWNlRGlzY291bnQgPQogICAgICAgICAgICAgICAgc2VydmljZURpc2NvdW50ICoga2VuZG8ucGFyc2VGbG9hdCh0aGlzLmNyZWRpdE1lbW8udHhuUmF0ZSk7CiAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby50eG5JdG1EaXNjb3VudCA9IHR4bkRpc2NvdW50OwogICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8uZXhjaGFuZ2VUeG5JdG1EaXNjb3VudCA9CiAgICAgICAgICAgICAgICB0eG5EaXNjb3VudCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLnR4blJhdGUpOwoKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKHNwVGF4LCBwbHRheCwgb3RoZXJUYXgsIHZhdFRheCkKICAgICAgICAgICAgbGV0IHRvdGFsID0KICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQoc3ViVG90YWwpIC0KICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQoZGlzY291bnRUb3RhbCkgKwogICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh0b3RhbFRheCk7CiAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby53aXRoaG9sZGluZ1RheEFtb3VudCA9IHdpdGhob2xkaW5nVGF4QW1vdW50CiAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5pdGVtTGluZVN1YlRvdGFsID0gc3ViVG90YWw7CiAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5pdGVtTGluZVRheEFtb3VudCA9IGtlbmRvLnBhcnNlRmxvYXQodG90YWxUYXgpOwogICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8uaXRlbUxpbmVEaXNjb3VudEFtb3VudCA9IGtlbmRvLnBhcnNlRmxvYXQoZGlzY291bnRUb3RhbCk7CiAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5pdGVtTGluZUFtb3VudCA9IGtlbmRvLnBhcnNlRmxvYXQodG90YWwpIC0gcGFyc2VGbG9hdCh3aXRoaG9sZGluZ1RheEFtb3VudCk7CiAgICAgICAgICAgIC8vIHRoaXMuYXV0b0NhbGN1bGF0ZVRheEJ5VHlwZSh0YXhMaXN0KQogICAgICAgICAgICB0aGlzLmN1c3RvbWVyRGlzY291bnRJdGVtID0gdGhpcy5yZW1vdmVEdXBsaWNhdGUoZGlzY291bnRJdGVtKTsKICAgICAgICAgICAgdGhpcy5jdXN0b21lclNhbGVVbml0ID0gdGhpcy5yZW1vdmVEdXBsaWNhdGUoc2FsZVVuaXQpOwogICAgICAgICAgICB0aGlzLnRheExpc3REZXRhaWwgPSB0YXhMaXN0RGV0YWlsCiAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5pdGVtTGluZUV4Y2hhbmdlQW1vdW50ID0KICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLml0ZW1MaW5lQW1vdW50KSAqCiAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHRoaXMuY3JlZGl0TWVtby50eG5SYXRlKTsKICAgICAgICAgICAgdGhpcy5zaHJpbmtEaXNjb3VudEl0ZW0oZGlzY291bnRJdGVtKTsKICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlVGF4RGV0YWlsKCk7CiAgICAgICAgICAgIC8vIHRoaXMuY3JlZGl0TWVtby5hbW91bnQgPSBrZW5kby5wYXJzZUZsb2F0KHRoaXMuY3JlZGl0TWVtby5pdGVtTGluZUFtb3VudCkKICAgICAgICAgICAgLy8gdGhpcy5jcmVkaXRNZW1vLnZhcmlhbmNlID0ga2VuZG8ucGFyc2VGbG9hdCh0aGlzLmNyZWRpdE1lbW8uaXRlbUxpbmVBbW91bnQpCiAgICAgICAgICAgIC8vIHRoaXMuY2FsY3VsYXRlQW1vdW50KCkKICAgICAgICB9LAogICAgICAgIHNocmlua0Rpc2NvdW50SXRlbShkaXNjb3VudEl0ZW0pIHsKICAgICAgICAgICAgbGV0IHVuaXF1ZURpc2NvdW50SXRlbXMgPSBbXTsKICAgICAgICAgICAgY29uc3QgdW5pcXVlID0gdGhpcy5yZW1vdmVEdXBsaWNhdGUoZGlzY291bnRJdGVtKTsKICAgICAgICAgICAgdW5pcXVlLmZvckVhY2goKG0pID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGZvdW5kID0gZGlzY291bnRJdGVtLmZpbHRlcigobikgPT4gbi5pZCA9PT0gbS5pZCk7CiAgICAgICAgICAgICAgICBsZXQgYW1vdW50ID0gMCwKICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudCA9IDA7CiAgICAgICAgICAgICAgICBmb3VuZC5tYXAoKG8pID0+IHsKICAgICAgICAgICAgICAgICAgICBhbW91bnQgKz0gby5hbW91bnQgfHwgMDsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZm91bmQubWFwKChvKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQgKz0gby5leGNoYW5nZUFtb3VudCB8fCAwOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB1bmlxdWVEaXNjb3VudEl0ZW1zLnB1c2goewogICAgICAgICAgICAgICAgICAgIGlkOiBtLmlkLAogICAgICAgICAgICAgICAgICAgIG5hbWU6IG0ubmFtZSwKICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IGFtb3VudCwKICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogZXhjaGFuZ2VBbW91bnQsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuY3VzdG9tZXJEaXNjb3VudEl0ZW0gPSB1bmlxdWVEaXNjb3VudEl0ZW1zOwogICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8uY3VzdG9tZXJEaXNjb3VudEl0ZW0gPSB1bmlxdWVEaXNjb3VudEl0ZW1zOwogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2codW5pcXVlRGlzY291bnRJdGVtcywgInVuaXF1ZURpc2NvdW50SXRlbXMiKTsKICAgICAgICB9LAogICAgICAgIGF1dG9DYWxjdWxhdGVBcHBseVRvKCkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLmFwcGx5VG9MaW5lRFMua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIGNvbnZlcnRlZEFtb3VudCA9IDAsCiAgICAgICAgICAgICAgICBhbW91bnQgPSAwOwogICAgICAgICAgICB0aGlzLmpSYXc1ID0gW107CiAgICAgICAgICAgIGxldCB0eG5SYXRlID0gMSwKICAgICAgICAgICAgICAgIGN1cnJlbmN5ID0gdGhpcy5jcmVkaXRNZW1vLmN1cnJlbmN5LAogICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlID0gdGhpcy5jcmVkaXRNZW1vLmN1cnJlbmN5CiAgICAgICAgICAgICAgICAgICAgPyB0aGlzLmNyZWRpdE1lbW8uY3VycmVuY3kuY29kZQogICAgICAgICAgICAgICAgICAgIDogIiI7CiAgICAgICAgICAgIGRzLmRhdGEoKS5mb3JFYWNoKCh2YWx1ZSkgPT4gewogICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0QW1vdW50ID0ga2VuZG8ucGFyc2VGbG9hdCgKICAgICAgICAgICAgICAgICAgICB2YWx1ZS5wYWlkQW1vdW50ID8gdmFsdWUucGFpZEFtb3VudCA6IDAKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBpZiAob2Zmc2V0QW1vdW50ID4gMCkgewogICAgICAgICAgICAgICAgICAgIGFtb3VudCArPSBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnBhaWRBbW91bnQpOwogICAgICAgICAgICAgICAgICAgIGNvbnZlcnRlZEFtb3VudCArPQogICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnBhaWRBbW91bnQpICoKICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS50eG5SYXRlKTsKICAgICAgICAgICAgICAgICAgICB0eG5SYXRlID0ga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS50eG5SYXRlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5hcHBseVRvRXhjaGFuZ2VBbW91bnQgPSBjb252ZXJ0ZWRBbW91bnQ7CiAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5hcHBseVRvQW1vdW50ID0gYW1vdW50OwogICAgICAgICAgICAvL3RvZG86IEFSCiAgICAgICAgICAgIGNvbnN0IHJlY2VpdmFibGVBY2MgPSB0aGlzLmN1c3RvbWVyLnJlY2VpdmFibGVBY2MgfHwge307CiAgICAgICAgICAgIGxldCBuYXR1cmUgPSAiIjsKICAgICAgICAgICAgaWYgKHRoaXMuY3JlZGl0TWVtby5pdGVtTGluZUFtb3VudCAqIC0xID4gMCkgewogICAgICAgICAgICAgICAgbmF0dXJlID0gImRyIjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG5hdHVyZSA9ICJjciI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHJlY2VpdmFibGVBY2MpIHsKICAgICAgICAgICAgICAgIGlmIChyZWNlaXZhYmxlQWNjLmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5qUmF3NS5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHJlY2VpdmFibGVBY2MuaWQgKyAiLSIgKyBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IG5ldyBJdGVtTGluZU1vZGVsKCksCiAgICAgICAgICAgICAgICAgICAgICAgIG1lbW9SYXRlOiB0eG5SYXRlLAogICAgICAgICAgICAgICAgICAgICAgICBsYXN0WFJhdGU6IHRoaXMuY3JlZGl0TWVtby5leGNoYW5nZVJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5Q29kZTogY3VycmVuY3lDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmNyZWRpdE1lbW8udHJhbnNhY3Rpb25Ob3RlLAogICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiByZWNlaXZhYmxlQWNjLAogICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IHJlY2VpdmFibGVBY2MuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OiB0aGlzLmNyZWRpdE1lbW8uYXBwbHlUb0V4Y2hhbmdlQW1vdW50ICogLTEsCiAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogdGhpcy5jcmVkaXRNZW1vLmFwcGx5VG9BbW91bnQgKiAtMSwKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogbmF0dXJlLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlQXM6ICJhciIsCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gdGhpcy5jYWxjdWxhdGVBbW91bnQoKQogICAgICAgIH0sCiAgICAgICAgY2FsY3VsYXRlQW1vdW50KCkgewogICAgICAgICAgICBsZXQgb2Zmc2V0WEFtb3VudCA9IDAsCiAgICAgICAgICAgICAgICBvZmZzZXRBbW91bnQgPSAwOyAvLyBhcHBseXRvX2Ftb3VudCArIGRlcG9zaXQgKyBjYXNoIHJlZnVuZAogICAgICAgICAgICBjb25zdCBhcHBseVRvRXhjaGFuZ2VBbW91bnQgPSBrZW5kby5wYXJzZUZsb2F0KAogICAgICAgICAgICAgICAgdGhpcy5jcmVkaXRNZW1vLmFwcGx5VG9FeGNoYW5nZUFtb3VudAogICAgICAgICAgICApOwogICAgICAgICAgICBjb25zdCBleGNoYW5nZURlcG9zaXRBbW91bnQgPSBrZW5kby5wYXJzZUZsb2F0KAogICAgICAgICAgICAgICAgdGhpcy5jcmVkaXRNZW1vLmV4Y2hhbmdlRGVwb3NpdERlZHVjdGlvbgogICAgICAgICAgICApOwogICAgICAgICAgICBjb25zdCBleGNoYW5nZVJlZnVuZEFtb3VudCA9IGtlbmRvLnBhcnNlRmxvYXQoCiAgICAgICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8uZXhjaGFuZ2VSZWZ1bmRBbW91bnQKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGNvbnN0IGFwcGx5VG9BbW91bnQgPSBrZW5kby5wYXJzZUZsb2F0KHRoaXMuY3JlZGl0TWVtby5hcHBseVRvQW1vdW50KTsKICAgICAgICAgICAgY29uc3QgZGVwb3NpdEFtb3VudCA9IGtlbmRvLnBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLmRlcG9zaXRBbW91bnQpOwogICAgICAgICAgICBjb25zdCByZWZ1bmRBbW91bnQgPSBrZW5kby5wYXJzZUZsb2F0KHRoaXMuY3JlZGl0TWVtby5yZWZ1bmRBbW91bnQpOwoKICAgICAgICAgICAgY29uc3QgaXRlbUxpbmVFeGNoYW5nZSA9IGtlbmRvLnBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLml0ZW1MaW5lRXhjaGFuZ2VBbW91bnQpOwogICAgICAgICAgICBjb25zdCBpdGVtTGluZUFtb3VudCA9IGtlbmRvLnBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLml0ZW1MaW5lQW1vdW50KQoKICAgICAgICAgICAgb2Zmc2V0WEFtb3VudCA9IGtlbmRvLnBhcnNlRmxvYXQoYXBwbHlUb0V4Y2hhbmdlQW1vdW50ICsgZXhjaGFuZ2VEZXBvc2l0QW1vdW50ICsgZXhjaGFuZ2VSZWZ1bmRBbW91bnQpOwogICAgICAgICAgICBvZmZzZXRBbW91bnQgPSBrZW5kby5wYXJzZUZsb2F0KGFwcGx5VG9BbW91bnQgKyBkZXBvc2l0QW1vdW50ICsgcmVmdW5kQW1vdW50KTsKCiAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5hbW91bnQgPSBvZmZzZXRBbW91bnQ7CiAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5leGNoYW5nZUFtb3VudCA9IG9mZnNldFhBbW91bnQ7CiAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5leGNoYW5nZVZhcmlhbmNlID0gaXRlbUxpbmVFeGNoYW5nZSAtIG9mZnNldFhBbW91bnQ7CiAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby52YXJpYW5jZSA9IGl0ZW1MaW5lQW1vdW50IC0gb2Zmc2V0QW1vdW50OwogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coInZhcmlhbmNlIiwgdGhpcy5jcmVkaXRNZW1vLnZhcmlhbmNlLCAnZXhjaGFuZ2VWYXJpYW5jZScsIHRoaXMuY3JlZGl0TWVtby5leGNoYW5nZVZhcmlhbmNlKTsKICAgICAgICAgICAgLy8gaWYgKG9mZnNldEFtb3VudCA+IGl0ZW1MaW5lQW1vdW50KSB7CiAgICAgICAgICAgIC8vICAgdGhpcy5zaG93V2FyaW5nTWVzc2FnZSgnQ3JlZGl0IE1lbW8nLCAnUmV0dXJuIGFtb3VudCBhbmQgT2Zmc2V0IGFtb3VudCBtdXN0IGJlIGVxdWFsIScsICdPSycpCiAgICAgICAgICAgIC8vICAgLy8gcmV0dXJuCiAgICAgICAgICAgIC8vIH0KCiAgICAgICAgICAgIHRoaXMualJhdzQgPSBbXTsKICAgICAgICAgICAgbGV0IGN1cnJlbmN5ID0gdGhpcy5jcmVkaXRNZW1vLmN1cnJlbmN5LAogICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlID0gdGhpcy5jcmVkaXRNZW1vLmN1cnJlbmN5CiAgICAgICAgICAgICAgICAgICAgPyB0aGlzLmNyZWRpdE1lbW8uY3VycmVuY3kuY29kZQogICAgICAgICAgICAgICAgICAgIDogIiI7CiAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyhvZmZzZXRBbW91bnQsICdvZmZzZXRBbW91bnQnKQogICAgICAgICAgICBpZiAodGhpcy5jcmVkaXRNZW1vLmV4Y2hhbmdlVmFyaWFuY2UgIT09IDApIHsKICAgICAgICAgICAgICAgIHRoaXMualJhdzQgPSBbXTsKICAgICAgICAgICAgICAgIGxldCBuYXR1cmUgPSAiIjsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmNyZWRpdE1lbW8udmFyaWFuY2VBY2MpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jcmVkaXRNZW1vLmV4Y2hhbmdlVmFyaWFuY2UgKiAtMSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmF0dXJlID0gImRyIjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAiY3IiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjb25zdCB2YXJpYW5jZUFjYyA9IHRoaXMuY3JlZGl0TWVtby52YXJpYW5jZUFjYzsKICAgICAgICAgICAgICAgICAgICBpZiAodmFyaWFuY2VBY2MuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5qUmF3NC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB2YXJpYW5jZUFjYy5pZCArICItIiArIG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IG5ldyBJdGVtTGluZU1vZGVsKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZW1vUmF0ZTogdGhpcy5jcmVkaXRNZW1vLnR4blJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0WFJhdGU6IHRoaXMuY3JlZGl0TWVtby5leGNoYW5nZVJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUNvZGU6IGN1cnJlbmN5Q29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiBjdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAiVmFyaWFuY2UiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogdmFyaWFuY2VBY2MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IHZhcmlhbmNlQWNjLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiB0aGlzLmNyZWRpdE1lbW8udmFyaWFuY2UgKiAtMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OiB0aGlzLmNyZWRpdE1lbW8uZXhjaGFuZ2VWYXJpYW5jZSAqIC0xLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogbmF0dXJlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZUFzOiAiR2Fpbkxvc3MiLAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5zaHJpbmtEYXRhKCk7CiAgICAgICAgICAgIHJldHVybiBvZmZzZXRBbW91bnQ7CiAgICAgICAgfSwKICAgICAgICBhdXRvQ2FsY3VsYXRlRGVwb3NpdCgpIHsKICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5kZXBvc2l0TGluZURTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICBhbW91bnQgPSAwLAogICAgICAgICAgICAgICAgY29udmVydGVkQW1vdW50ID0gMDsKICAgICAgICAgICAgbGV0IG5hdHVyZSA9ICIiOwogICAgICAgICAgICB0aGlzLmpSYXcyID0gW107CiAgICAgICAgICAgIGxldCBjdXJyZW5jeSA9IHRoaXMuY3JlZGl0TWVtby5jdXJyZW5jeSwKICAgICAgICAgICAgICAgIGN1cnJlbmN5Q29kZSA9IHRoaXMuY3JlZGl0TWVtby5jdXJyZW5jeQogICAgICAgICAgICAgICAgICAgID8gdGhpcy5jcmVkaXRNZW1vLmN1cnJlbmN5LmNvZGUKICAgICAgICAgICAgICAgICAgICA6ICIiOwogICAgICAgICAgICBkcy5kYXRhKCkuZm9yRWFjaCgodmFsdWUpID0+IHsKICAgICAgICAgICAgICAgIGxldCBkZXNjcmlwdGlvbiA9ICIiOwogICAgICAgICAgICAgICAgaWYgKHZhbHVlLmFtb3VudCkgewogICAgICAgICAgICAgICAgICAgIGFtb3VudCArPSBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgY29udmVydGVkQW1vdW50ICs9CiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuYW1vdW50KSAqCiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLnR4blJhdGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHZhbHVlLmRlc2NyaXB0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gPSB2YWx1ZS5kZXNjcmlwdGlvbiB8fCAiIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5hY2NvdW50KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWNjb3VudCA9IHZhbHVlLmFjY291bnQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFjY291bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjY291bnQuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhbW91bnQgKiAtMSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAiZHIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAiY3IiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5qUmF3Mi5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogYWNjb3VudC5pZCArICItIiArIG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogIkRlcG9zaXQgIiArIGRlc2NyaXB0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IG5ldyBJdGVtTGluZU1vZGVsKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVtb1JhdGU6IHRoaXMuY3JlZGl0TWVtby50eG5SYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RYUmF0ZTogdGhpcy5jcmVkaXRNZW1vLmV4Y2hhbmdlUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUNvZGU6IGN1cnJlbmN5Q29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogYWNjb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IGFjY291bnQuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBhbW91bnQgKiAtMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50ICoga2VuZG8ucGFyc2VGbG9hdCh0aGlzLmNyZWRpdE1lbW8udHhuUmF0ZSkgKiAtMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZUFzOiAiZGVwb3NpdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8uZGVwb3NpdEFtb3VudCA9IGFtb3VudDsKICAgICAgICAgICAgdGhpcy5jcmVkaXRNZW1vLmV4Y2hhbmdlRGVwb3NpdERlZHVjdGlvbiA9IGNvbnZlcnRlZEFtb3VudDsKICAgICAgICAgICAgLy8gdGhpcy5jYWxjdWxhdGVBbW91bnQoKQogICAgICAgIH0sCiAgICAgICAgY2hlY2tBbW91bnQoYW1vdW50UmV0dXJuLCBvZmZzZXRBbW91bnQpIHsKICAgICAgICAgICAgcmV0dXJuIG9mZnNldEFtb3VudCA+IGFtb3VudFJldHVybjsKICAgICAgICB9LAogICAgICAgIGF1dG9DYWxjdWxhdGVDYXNoUmVmdW5kKCkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLmNhc2hSZWZ1bmREUy5rZW5kb1dpZGdldCgpLAogICAgICAgICAgICAgICAgYW1vdW50ID0gMCwKICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50ID0gMDsKICAgICAgICAgICAgbGV0IG5hdHVyZSA9ICIiOwogICAgICAgICAgICB0aGlzLmpSYXczID0gW107CiAgICAgICAgICAgIGxldCBjdXJyZW5jeSA9IHRoaXMuY3JlZGl0TWVtby5jdXJyZW5jeSwKICAgICAgICAgICAgICAgIGN1cnJlbmN5Q29kZSA9IHRoaXMuY3JlZGl0TWVtby5jdXJyZW5jeQogICAgICAgICAgICAgICAgICAgID8gdGhpcy5jcmVkaXRNZW1vLmN1cnJlbmN5LmNvZGUKICAgICAgICAgICAgICAgICAgICA6ICIiOwogICAgICAgICAgICBkcy5kYXRhKCkuZm9yRWFjaCgodmFsdWUpID0+IHsKICAgICAgICAgICAgICAgIGxldCBkZXNjcmlwdGlvbiA9ICIiOwogICAgICAgICAgICAgICAgaWYgKHZhbHVlLmFtb3VudCkgewogICAgICAgICAgICAgICAgICAgIGFtb3VudCArPSBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQgKz0KICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5hbW91bnQpICoKICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh0aGlzLmNyZWRpdE1lbW8udHhuUmF0ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodmFsdWUuZGVzY3JpcHRpb24pIHsKICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9IHZhbHVlLmRlc2NyaXB0aW9uIHx8ICIiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy90b2RvOiBDYXNoIEFjY291bnQKICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5hY2NvdW50KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWNjb3VudCA9IHZhbHVlLmFjY291bnQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFjY291bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjY291bnQuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhbW91bnQgKiAtMSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAiZHIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAiY3IiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5qUmF3My5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogYWNjb3VudC5pZCArICItIiArIG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogIkRlcG9zaXQgIiArIGRlc2NyaXB0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IG5ldyBJdGVtTGluZU1vZGVsKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVtb1JhdGU6IHRoaXMuY3JlZGl0TWVtby50eG5SYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RYUmF0ZTogdGhpcy5jcmVkaXRNZW1vLmV4Y2hhbmdlUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUNvZGU6IGN1cnJlbmN5Q29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogYWNjb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IGFjY291bnQuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLnR4blJhdGUpICogYW1vdW50ICogLTEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBhbW91bnQgKiAtMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZUFzOiAiQ2FzaEFjY291bnQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8ucmVmdW5kQW1vdW50ID0gYW1vdW50OwogICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8uZXhjaGFuZ2VSZWZ1bmRBbW91bnQgPSBleGNoYW5nZUFtb3VudDsKICAgICAgICAgICAgLy8gdGhpcy5jYWxjdWxhdGVBbW91bnQoKQogICAgICAgIH0sCiAgICAgICAgYXV0b0NhbGN1bGF0ZUFjY291bnRMaW5lKCkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLmFjY291bnRMaW5lRFMua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIHN1YlRvdGFsID0gMCwKICAgICAgICAgICAgICAgIHRvdGFsVGF4ID0gMCwKICAgICAgICAgICAgICAgIGRpc2NvdW50VG90YWwgPSAwLAogICAgICAgICAgICAgICAgdmF0VGF4ID0gMCwKICAgICAgICAgICAgICAgIHRheExpc3QgPSBbXSwKICAgICAgICAgICAgICAgIGRpc2NvdW50SXRlbSA9IFtdOwoKICAgICAgICAgICAgZHMuZGF0YSgpLmZvckVhY2goKHZhbHVlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAodmFsdWUuYW1vdW50KSB7CiAgICAgICAgICAgICAgICAgICAgc3ViVG90YWwgKz0ga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5hbW91bnQpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGxldCBkaXNjb3VudCA9IDA7CiAgICAgICAgICAgICAgICBpZiAodmFsdWUuZGlzY291bnRJdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IHN1YlRvID0ga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5hbW91bnQgPyB2YWx1ZS5hbW91bnQgOiAwKTsKICAgICAgICAgICAgICAgICAgICBkaXNjb3VudCA9IHRoaXMuYXV0b0NhbGN1bGF0ZURpc2NvdW50KHZhbHVlLmRpc2NvdW50SXRlbSwgc3ViVG8pOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5kaXNjb3VudEl0ZW0uaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGlzY291bnRJdGVtLnB1c2godmFsdWUuZGlzY291bnRJdGVtKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZGlzY291bnRUb3RhbCArPSBkaXNjb3VudCA/IGRpc2NvdW50IDogMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh2YWx1ZS52YXRUYXgpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgYW10ID0KICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5hbW91bnQgPyB2YWx1ZS5hbW91bnQgOiAwKSAtCiAgICAgICAgICAgICAgICAgICAgICAgIChkaXNjb3VudCA/IGRpc2NvdW50IDogMCk7CiAgICAgICAgICAgICAgICAgICAgdmF0VGF4ID0gdGhpcy5hdXRvQ2FsY3VsYXRlVGF4KHZhbHVlLnZhdFRheCwgYW10KTsKICAgICAgICAgICAgICAgICAgICB2YXRUYXggPSBrZW5kby5wYXJzZUZsb2F0KHZhdFRheCkgPyBrZW5kby5wYXJzZUZsb2F0KHZhdFRheCkgOiAwOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS52YXRUYXguaGFzT3duUHJvcGVydHkoInRheFR5cGUiKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0YXhMaXN0LnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdmFsdWUudmF0VGF4LnRheFR5cGUubmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogdmF0VGF4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHZhbHVlLnZhdFRheC50YXhUeXBlLmlkLAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0b3RhbFRheCArPSBrZW5kby5wYXJzZUZsb2F0KHZhdFRheCA/IHZhdFRheCA6IDApOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc3QgYW1vdW50ID0gdGhpcy5jcmVkaXRNZW1vLml0ZW1MaW5lQW1vdW50OwogICAgICAgICAgICBjb25zdCB0YXhBbW91bnQgPSB0aGlzLmNyZWRpdE1lbW8uaXRlbUxpbmVUYXhBbW91bnQ7CiAgICAgICAgICAgIGNvbnN0IGRpc2NvdW50ID0gdGhpcy5jcmVkaXRNZW1vLml0ZW1MaW5lRGlzY291bnRBbW91bnQ7CiAgICAgICAgICAgIC8vIGNvbnN0IHN1YlRvdGFsID0gdGhpcy5jcmVkaXRNZW1vLml0ZW1MaW5lU3ViVG90YWwKCiAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5hY2NvdW50TGluZUFtb3VudCA9CiAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHN1YlRvdGFsKSAtCiAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KGRpc2NvdW50VG90YWwpICsKICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodG90YWxUYXgpOwogICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8uYWNjb3VudExpbmVUYXhBbW91bnQgPSBrZW5kby5wYXJzZUZsb2F0KHRvdGFsVGF4KTsKICAgICAgICAgICAgdGhpcy5jcmVkaXRNZW1vLmFjY291bnRMaW5lRGlzY291bnRBbW91bnQgPSBrZW5kby5wYXJzZUZsb2F0KAogICAgICAgICAgICAgICAgZGlzY291bnRUb3RhbAogICAgICAgICAgICApOwoKICAgICAgICAgICAgdGhpcy5jcmVkaXRNZW1vLmFtb3VudCA9CiAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KGFtb3VudCkgKwogICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh0aGlzLmNyZWRpdE1lbW8uYWNjb3VudExpbmVBbW91bnQpOwogICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8udGF4QW1vdW50ID0KICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodGF4QW1vdW50KSArCiAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHRoaXMuY3JlZGl0TWVtby5hY2NvdW50TGluZVRheEFtb3VudCk7CiAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5kaXNjb3VudCA9CiAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KGRpc2NvdW50KSArCiAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHRoaXMuY3JlZGl0TWVtby5hY2NvdW50TGluZURpc2NvdW50QW1vdW50KTsKICAgICAgICAgICAgLy8gdGhpcy5hdXRvQ2FsY3VsYXRlVGF4QnlUeXBlKHRheExpc3QpCiAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLmNyZWRpdE1lbW8uYWNjb3VudExpbmVBbW91bnQsIHRoaXMuY3JlZGl0TWVtby5hY2NvdW50TGluZVRheEFtb3VudCwgdGhpcy5jcmVkaXRNZW1vLmFjY291bnRMaW5lRGlzY291bnRBbW91bnQsICctLScpCiAgICAgICAgfSwKICAgICAgICByZW1vdmVEdXBsaWNhdGUoYXJyYXkpIHsKICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gW107CiAgICAgICAgICAgIGNvbnN0IG1hcCA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGFycmF5KSB7CiAgICAgICAgICAgICAgICBpZiAoIW1hcC5oYXMoaXRlbS5pZCkpIHsKICAgICAgICAgICAgICAgICAgICBtYXAuc2V0KGl0ZW0uaWQsIHRydWUpOyAvLyBzZXQgYW55IHZhbHVlIHRvIE1hcAogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfSwKICAgICAgICBhdXRvQ2FsY3VsYXRlVGF4QnlUeXBlKHRheCkgewogICAgICAgICAgICAvLyByZXR1cm4gYnkgYSBrZXkKICAgICAgICAgICAgY29uc3QgZ3JvdXBBbGwgPSAobGlzdCkgPT4KICAgICAgICAgICAgICAgIGxpc3QucmVkdWNlKCh0YXgsIGl0ZW0pID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXhBbW91bnQgPSB0YXhbaXRlbS5uYW1lXSB8fCAwOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCB0YXgsIHsKICAgICAgICAgICAgICAgICAgICAgICAgW2l0ZW0ubmFtZV06IHRheEFtb3VudCArIHBhcnNlRmxvYXQoaXRlbS5hbW91bnQpLAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwge30pOwogICAgICAgICAgICB0aGlzLnRheExpc3RUb3RhbCA9IGdyb3VwQWxsKHRheCk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkRW1wbG95ZWVDZW50ZXIoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZW1wbG95ZWVzID0gW107CiAgICAgICAgICAgICAgICAgICAgZW1wbG95ZWVIYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgIC5jZW50ZXIodW5kZWZpbmVkKQogICAgICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW1wbG95ZWVzID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5lbXBsb3llZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8uZW1wbG95ZWUgPSB0aGlzLmVtcGxveWVlc1swXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaCgpOwogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDUwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkUHJlZml4KCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBwcmVmaXhIYW5kbGVyLmdldCgic2FsZSByZXR1cm4iKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvblR5cGUgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudHJhbnNhY3Rpb25UeXBlLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8udHJhbnNhY3Rpb25UeXBlID0gdGhpcy50cmFuc2FjdGlvblR5cGVbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVOdW1iZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sIDUwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkU2FsZVVuaXRJdGVtcygpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgc2FsZVVuaXRJdGVtSGFuZGxlci5saXN0KCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNhbGVVbml0SXRlbUxpc3QgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgNTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIG9uRmlsdGVyQ2hhbmdlKGV2ZW50KSB7CiAgICAgICAgICAgIGNvbnN0IGZpbHRlciA9IGV2ZW50LmZpbHRlci52YWx1ZTsKICAgICAgICAgICAgdGhpcy5yZXF1ZXN0RGF0YSgwLCBmaWx0ZXIsIHRoaXMuY3VzQmFzZVVybCk7CiAgICAgICAgICAgIHRoaXMuZmlsdGVyID0gZmlsdGVyOwogICAgICAgIH0sCiAgICAgICAgcmVxdWVzdERhdGEoc2tpcCwgZmlsdGVyLCBiYXNlVXJsKSB7CiAgICAgICAgICAgIGNvbnN0IHVybCA9IGJhc2VVcmwgKyBgP2ZpbHRlcj0ke2ZpbHRlcn1gOwogICAgICAgICAgICBmZXRjaCh1cmwpCiAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC50aGVuKHRoaXMuYWZ0ZXJGZXRjaCk7CiAgICAgICAgfSwKICAgICAgICBhZnRlckZldGNoKGpzb24pIHsKICAgICAgICAgICAgdGhpcy5jdXN0b21lckxpc3QgPSBqc29uLmRhdGE7CiAgICAgICAgfSwKICAgICAgICBvbkNoYW5nZShldmVudCkgewogICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGV2ZW50LnZhbHVlOwogICAgICAgICAgICBpZiAodmFsdWUgJiYgdmFsdWVbIm51bWJlck5hbWUiXSA9PT0gZW1wdHlJdGVtWyJudW1iZXJOYW1lIl0pIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IDAKICAgICAgICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgICAgICAgICB0aGlzLmN1c3RvbWVyID0gdmFsdWU7CiAgICAgICAgICAgICAgICBjb25zdCBzYWxlRGVwb3NpdEFjYyA9IHZhbHVlLmhhc093blByb3BlcnR5KCJzYWxlRGVwb3NpdEFjYyIpCiAgICAgICAgICAgICAgICAgICAgPyB2YWx1ZS5zYWxlRGVwb3NpdEFjYwogICAgICAgICAgICAgICAgICAgIDoge307CiAgICAgICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8uY3VzdG9tZXIgPSB2YWx1ZTsKICAgICAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5wcmljZUxldmVsID0gdmFsdWUuaGFzT3duUHJvcGVydHkoInByaWNlTGV2ZWwiKQogICAgICAgICAgICAgICAgICAgID8gdmFsdWUucHJpY2VMZXZlbAogICAgICAgICAgICAgICAgICAgIDoge307CiAgICAgICAgICAgICAgICB0aGlzLmRlY2ltYWxGb3JtYXQgPSB2YWx1ZS5kZWNpbWFsRm9ybWF0OwogICAgICAgICAgICAgICAgaWYgKHZhbHVlLmJhc2VDdXJyZW5jeSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYmFzZUN1cnJlbmN5Q29kZSA9IHZhbHVlLmJhc2VDdXJyZW5jeS5oYXNPd25Qcm9wZXJ0eSgiY29kZSIpCiAgICAgICAgICAgICAgICAgICAgICAgID8gdmFsdWUuYmFzZUN1cnJlbmN5LmNvZGUKICAgICAgICAgICAgICAgICAgICAgICAgOiAiIjsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFjY0RlcG9zaXQgPSB0aGlzLmFjY0RlcG9zaXRzLmZpbHRlcigKICAgICAgICAgICAgICAgICAgICAgICAgKG8pID0+IG8uaWQgPT09IHNhbGVEZXBvc2l0QWNjLmlkCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLmxvYWRUcmFuc2FjdGlvblJhdGUoKTsKICAgICAgICAgICAgICAgIHRoaXMubG9hZFByb2plY3RCeUN1c3RvbWVyKCk7CiAgICAgICAgICAgICAgICAvLyB0aGlzLnNlYXJjaEludm9pY2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaGlkZVNtYWxsU2lkZWJhcigpIHsKICAgICAgICAgICAgdGhpcy5pc0hpZGVCYXIgPSAhdGhpcy5pc0hpZGVCYXI7CiAgICAgICAgfSwKICAgICAgICBnZW5lcmF0ZU51bWJlcigpIHsKICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCkgewogICAgICAgICAgICAgICAgY29uc3QgdHJhbkRhdGUgPSBuZXcgRGF0ZSh0aGlzLnRyYW5zYWN0aW9uRGF0ZSk7CiAgICAgICAgICAgICAgICBjb25zdCB0cmFuRGF0ZUludm9pY2UgPSBuZXcgRGF0ZSh0aGlzLmNyZWRpdE1lbW8udHJhbnNhY3Rpb25EYXRlKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlTSA9IHRyYW5EYXRlLmdldEZ1bGxZZWFyKCkgKyB0cmFuRGF0ZS5nZXRNb250aCgpOwogICAgICAgICAgICAgICAgY29uc3QgdHJhbkRhdGVJbnZvaWNlTSA9CiAgICAgICAgICAgICAgICAgICAgdHJhbkRhdGVJbnZvaWNlLmdldEZ1bGxZZWFyKCkgKyB0cmFuRGF0ZUludm9pY2UuZ2V0TW9udGgoKTsKICAgICAgICAgICAgICAgIGlmICh0cmFuRGF0ZU0gPT09IHRyYW5EYXRlSW52b2ljZU0pIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8ucmVmZXJlbmNlTm8gPSB0aGlzLnJlZmVyZW5jZU5vOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMudHJhbnNhY3Rpb25EYXRlICE9PSAiIiAmJiB0aGlzLnRyYW5zYWN0aW9uVHlwZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICBhYmJyOiB0aGlzLmNyZWRpdE1lbW8udHJhbnNhY3Rpb25UeXBlLmFiYnIsCiAgICAgICAgICAgICAgICAgICAgc3RydWN0dXJlOiB0aGlzLmNyZWRpdE1lbW8udHJhbnNhY3Rpb25UeXBlLnN0cnVjdHVyZSwKICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbkRhdGU6IHRoaXMudHJhbnNhY3Rpb25EYXRlLAogICAgICAgICAgICAgICAgICAgIHNlcXVjZW5jaW5nOiB0aGlzLmNyZWRpdE1lbW8udHJhbnNhY3Rpb25UeXBlLnNlcXVjZW5jaW5nLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJDcmVkaXQgTWVtbyIsCiAgICAgICAgICAgICAgICAgICAgZW50aXR5OiAxLAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGJpbGxpbmdIYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgLmxhc3ROdW1iZXIoZGF0YSkKICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXMgPSByZXNwb25zZS5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXN0TnVtYmVyID0gdGhpcy56ZXJvUGFkKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlSW50KHJlcy5sYXN0TnVtYmVyKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8udHJhbnNhY3Rpb25UeXBlLmZvcm1hdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG51bWJlciA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnN1ZmZpeCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcmVkaXRNZW1vLnRyYW5zYWN0aW9uVHlwZS5udW1iZXJTZXBhcmF0b3IgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3ROdW1iZXI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8ubnVtYmVyID0gbnVtYmVyOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvcnMucHVzaChlKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgemVyb1BhZChudW0sIHBsYWNlcykgewogICAgICAgICAgICByZXR1cm4gU3RyaW5nKG51bSkucGFkU3RhcnQocGxhY2VzLCAiMCIpOwogICAgICAgIH0sCiAgICAgICAgc3VmZml4KHRyYW5zYWN0aW9uRGF0ZSkgewogICAgICAgICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcobmV3IERhdGUodHJhbnNhY3Rpb25EYXRlKSwgYHl5bW1gKTsKICAgICAgICB9LAogICAgICAgIGNhbmNlbCgpIHsKICAgICAgICAgICAgdGhpcy4kc3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogaTE4bi50KCJtc2dfdGl0bGVfd2FybmluZyIpLAogICAgICAgICAgICAgICAgdGV4dDogaTE4bi50KCJtc2dfZGlzY2FyZCIpLAogICAgICAgICAgICAgICAgaWNvbjogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IGkxOG4udCgiY2FuY2VsIiksCiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjNGQ0ODQ4IiwKICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI0VEMUEzQSIsCiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogaTE4bi50KCJkaXNjYXJkIiksCiAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdENhbikgPT4gewogICAgICAgICAgICAgICAgaWYgKHJlc3VsdENhbi52YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIuZ28oLTEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIHJlbW92ZVJvdyhlKSB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgY29uc3QgZ3JpZCA9IGtlbmRvLmpRdWVyeSgiI2dyaWRJdGVtTGluZSIpLmRhdGEoImtlbmRvR3JpZCIpLAogICAgICAgICAgICAgICAgZGF0YVNvdXJjZSA9IGdyaWQuZGF0YVNvdXJjZSwKICAgICAgICAgICAgICAgIGRhdGFJdGVtID0gZ3JpZC5kYXRhSXRlbSgkKGUuY3VycmVudFRhcmdldCkuY2xvc2VzdCgidHIiKSk7CgogICAgICAgICAgICBpZiAoZGF0YVNvdXJjZS50b3RhbCgpID4gMSkgewogICAgICAgICAgICAgICAgZGF0YVNvdXJjZS5yZW1vdmUoZGF0YUl0ZW0pOwogICAgICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHJlbW92ZVJvd0FjYyhlKSB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgY29uc3QgZ3JpZCA9ICQoIiMiKS5kYXRhKCJrZW5kb0dyaWQiKSwKICAgICAgICAgICAgICAgIGRhdGFTb3VyY2UgPSBncmlkLmRhdGFTb3VyY2UsCiAgICAgICAgICAgICAgICBkYXRhSXRlbSA9IGdyaWQuZGF0YUl0ZW0oJChlLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoInRyIikpOwoKICAgICAgICAgICAgaWYgKGRhdGFTb3VyY2UudG90YWwoKSA+IDEpIHsKICAgICAgICAgICAgICAgIGRhdGFTb3VyY2UucmVtb3ZlKGRhdGFJdGVtKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgdmF0VGVtcGxhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3QgdmF0ID0gZGF0YUl0ZW0udmF0VGF4OwogICAgICAgICAgICBpZiAodmF0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYDxzcGFuPiR7dmF0LmRlZmF1bHRUYXggPyB2YXQuZGVmYXVsdFRheCA6IGBgfTwvc3Bhbj5gOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGBgOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhY2NvdW50VGVtcGxhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3QgYWNjb3VudCA9IGRhdGFJdGVtLmFjY291bnQ7CiAgICAgICAgICAgIGlmIChhY2NvdW50KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYDxzcGFuPiR7YWNjb3VudC5uYW1lID8gYWNjb3VudC5uYW1lIDogYGB9PC9zcGFuPmA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYGA7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGl0ZW1UZW1wbGF0ZShkYXRhSXRlbSkgewogICAgICAgICAgICBjb25zdCBpdGVtID0gZGF0YUl0ZW0uaXRlbTsKICAgICAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBgPHNwYW4+JHtpdGVtLm5hbWUgPyBpdGVtLm5hbWUgOiBgYH08L3NwYW4+YDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBgYDsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgVU9NVGVtcGxhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3QgdW9tID0gZGF0YUl0ZW0udW9tOwogICAgICAgICAgICBjb25zdCBjb2RlID0gdW9tLmNvZGUgfHwgJycKICAgICAgICAgICAgaWYgKHVvbSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGA8c3Bhbj4ke3VvbS51b20gPyBjb2RlIDogYGB9PC9zcGFuPmA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYGA7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHNhbGVVbml0VGVtcGxhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3Qgc2FsZVVuaXQgPSBkYXRhSXRlbS5zYWxlVW5pdDsKICAgICAgICAgICAgaWYgKHNhbGVVbml0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYDxzcGFuPiR7c2FsZVVuaXQubmFtZSA/IHNhbGVVbml0Lm5hbWUgOiBgYH08L3NwYW4+YDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBgYDsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZW1wSW1wbChkYXRhSXRlbSkgewogICAgICAgICAgICBsZXQgZW1wSWRzID0gW107CiAgICAgICAgICAgIGRhdGFJdGVtLmVtcGxveWVlLmZvckVhY2goKG0pID0+IHsKICAgICAgICAgICAgICAgIGVtcElkcy5wdXNoKG0uZmlyc3ROYW1lICsgIiAtICIgKyBtLmxhc3ROYW1lKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyhlbXBJZHMuam9pbignLCAnKSkKICAgICAgICAgICAgcmV0dXJuIGA8c3Bhbj4ke2VtcElkcy5qb2luKCIsICIpfTwvc3Bhbj5gOwogICAgICAgIH0sCiAgICAgICAgZGlzY291bnRJdGVtVGVtcGxhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3QgZGlzY291bnRJdGVtID0gZGF0YUl0ZW0uZGlzY291bnRJdGVtOwogICAgICAgICAgICBpZiAoZGlzY291bnRJdGVtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYDxzcGFuPiR7ZGlzY291bnRJdGVtLmNvZGUgPyBkaXNjb3VudEl0ZW0uY29kZSA6IGBgfSAtICR7CiAgICAgICAgICAgICAgICAgICAgZGlzY291bnRJdGVtLm5hbWUgPyBkaXNjb3VudEl0ZW0ubmFtZSA6IGBgCiAgICAgICAgICAgICAgICB9PC9zcGFuPmA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYGA7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIEl0ZW1Ecm9wRG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogImNvbnRhaW5zIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVGV4dEZpZWxkOiAibmFtZSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlRmllbGQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgaGVhZGVyVGVtcGxhdGU6CiAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJkcm9wZG93bi1oZWFkZXIgay13aWRnZXQgay1oZWFkZXIiPicgKwogICAgICAgICAgICAgICAgICAgICAgICAiPHNwYW4+SXRlbXMgPC9zcGFuPiIgKwogICAgICAgICAgICAgICAgICAgICAgICAiPHNwYW4+PC9zcGFuPiIgKwogICAgICAgICAgICAgICAgICAgICAgICAiPC9kaXY+IiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9bmFtZSM8L3NwYW4+IiwKICAgICAgICAgICAgICAgICAgICBvcHRpb25MYWJlbDogIi0tLSBTZWxlY3QgLS0tIiwKICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlOiBuZXcga2VuZG8uZGF0YS5EYXRhU291cmNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyRmlsdGVyaW5nOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc3BvcnQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHByb2R1Y3RWYXJpYW50SGFuZGxlci5pdGVtU2VhcmNoVVJMKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDoge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZToge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2t1OiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhLmNvdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGF0YTogdGhpcy52YXJpYW50cwogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBPdGhlckNoYXJnZURyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IG5hbWU9IicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgICAgICAgICAgICBhdXRvQmluZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiAic3RhcnRzd2l0aCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogIm5hbWUiLAogICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZUZpZWxkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAiPHNwYW4+Iz1uYW1lIzwvc3Bhbj4iLAogICAgICAgICAgICAgICAgICAgIG9wdGlvbkxhYmVsOiAiLS1TZWxlY3QtLSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZTogbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHRoaXMub3RoZXJDaGFyZ2VMaXN0LAogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBVT01Ecm9wRG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogInN0YXJ0c3dpdGgiLAogICAgICAgICAgICAgICAgICAgIGRhdGFUZXh0RmllbGQ6ICJjb2RlIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogInVvbUNvbnZlcnRJZCIsCiAgICAgICAgICAgICAgICAgICAgY2FzY2FkZUZyb206ICJpdGVtIiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9Y29kZSB8fCBgTm8gUHJpY2UgTGV2ZWxgIzwvc3Bhbj4iLAogICAgICAgICAgICAgICAgICAgIG9wdGlvbkxhYmVsOiAiLS0tIFNlbGVjdCAtLS0iLAogICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IG5ldyBrZW5kby5kYXRhLkRhdGFTb3VyY2UoewogICAgICAgICAgICAgICAgICAgICAgICBzZXJ2ZXJGaWx0ZXJpbmc6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zcG9ydDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVybDogdW9tUHJpY2VIYW5kbGVyLmdldFVSTChvcHRpb25zLm1vZGVsLml0ZW0uaWQsIHRoaXMuY3JlZGl0TWVtby5wcmljZUxldmVsLmlkLCBvcHRpb25zLm1vZGVsLml0ZW0udHlwZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB1b21QcmljZUhhbmRsZXIudW9tUHJpY2VCeVByaWNlTGV2ZWxVUkwoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpZD0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5tb2RlbC5pdGVtLmlkICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiZwbElkPSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8ucHJpY2VMZXZlbC5pZCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICImZGF0ZT0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbkRhdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAianNvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWw6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogImlkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHt0eXBlOiAic3RyaW5nIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5hbWU6IHt0eXBlOiAic3RyaW5nIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNrdToge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YS5jb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRhdGE6IHRoaXMudmFyaWFudHMKICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgRGlzY291bnRJdGVtRHJvcERvd25FZGl0b3IoY29udGFpbmVyLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAualF1ZXJ5KCc8aW5wdXQgbmFtZT0iJyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgICAgICAua2VuZG9Ecm9wRG93bkxpc3QoewogICAgICAgICAgICAgICAgICAgIGF1dG9CaW5kOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGF1dG9XaWR0aDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDQwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXI6ICJzdGFydHN3aXRoIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVGV4dEZpZWxkOiAibmFtZSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlRmllbGQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgY2FzY2FkZUZyb206ICJpdGVtIiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9Y29kZSMgLSAjPW5hbWUjPC9zcGFuPiIsCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6ICItLS0gU2VsZWN0IC0tLSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZTogbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZlckZpbHRlcmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNwb3J0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBkaXNjb3VudEl0ZW1IYW5kbGVyLmdldFVSTChESVNDT1VOVF9UWVBFKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogImpzb24iLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBzY2hlbWE6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBuYW1lOiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBza3U6IHt0eXBlOiAic3RyaW5nIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGEuY291bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBTcGVjaWZpY1RheERyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IG5hbWU9IicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgICAgICAgICAgICBhdXRvQmluZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiAic3RhcnRzd2l0aCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogImRlZmF1bHRUYXgiLAogICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZUZpZWxkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAiPHNwYW4+Iz1kZWZhdWx0VGF4Izwvc3Bhbj4iLAogICAgICAgICAgICAgICAgICAgIG9wdGlvbkxhYmVsOiAiLS0tIFNlbGVjdCAtLS0iLAogICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IG5ldyBrZW5kby5kYXRhLkRhdGFTb3VyY2UoewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLnNwZWNpZmljVGF4LmZpbHRlcigobSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMubW9kZWwuaGFzT3duUHJvcGVydHkoInZhdFRheCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmF0ID0gb3B0aW9ucy5tb2RlbC52YXRUYXg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm1vZGVsLnZhdFRheCAhPT0gbnVsbCB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5tb2RlbC52YXRUYXggIT09ICJudWxsIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLm1vZGVsLnZhdFRheC5iYXNlQW1vdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5iYXNlQW1vdW50LnRvTG93ZXJDYXNlKCkgPT09CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubW9kZWwudmF0VGF4LmJhc2VBbW91bnQudG9Mb3dlckNhc2UoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgUHVibGljTGlnaHRpbmdUYXhEcm9wRG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogInN0YXJ0c3dpdGgiLAogICAgICAgICAgICAgICAgICAgIGRhdGFUZXh0RmllbGQ6ICJkZWZhdWx0VGF4IiwKICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogImlkIiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9ZGVmYXVsdFRheCM8L3NwYW4+IiwKICAgICAgICAgICAgICAgICAgICBvcHRpb25MYWJlbDogIi0tLSBTZWxlY3QgLS0tIiwKICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlOiBuZXcga2VuZG8uZGF0YS5EYXRhU291cmNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogdGhpcy5wdWJsaWNMaWdodGluZ1RheC5maWx0ZXIoKG0pID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLm1vZGVsLmhhc093blByb3BlcnR5KCJ2YXRUYXgiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhdCA9IG9wdGlvbnMubW9kZWwudmF0VGF4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5tb2RlbC52YXRUYXggIT09IG51bGwgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubW9kZWwudmF0VGF4ICE9PSAibnVsbCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5tb2RlbC52YXRUYXguYmFzZUFtb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0uYmFzZUFtb3VudC50b0xvd2VyQ2FzZSgpID09PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm1vZGVsLnZhdFRheC5iYXNlQW1vdW50LnRvTG93ZXJDYXNlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIE90aGVyVGF4RHJvcERvd25FZGl0b3IoY29udGFpbmVyLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAualF1ZXJ5KCc8aW5wdXQgbmFtZT0iJyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgICAgICAua2VuZG9Ecm9wRG93bkxpc3QoewogICAgICAgICAgICAgICAgICAgIGF1dG9CaW5kOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGF1dG9XaWR0aDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDQwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXI6ICJzdGFydHN3aXRoIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVGV4dEZpZWxkOiAiZGVmYXVsdFRheCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlRmllbGQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICI8c3Bhbj4jPWRlZmF1bHRUYXgjPC9zcGFuPiIsCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6ICItLS0gU2VsZWN0IC0tLSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZTogbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHRoaXMub3RoZXJUYXguZmlsdGVyKChtKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5tb2RlbC5oYXNPd25Qcm9wZXJ0eSgidmF0VGF4IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YXQgPSBvcHRpb25zLm1vZGVsLnZhdFRheDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmF0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubW9kZWwudmF0VGF4ICE9PSBudWxsICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm1vZGVsLnZhdFRheCAhPT0gIm51bGwiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMubW9kZWwudmF0VGF4LmJhc2VBbW91bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLmJhc2VBbW91bnQudG9Mb3dlckNhc2UoKSA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5tb2RlbC52YXRUYXguYmFzZUFtb3VudC50b0xvd2VyQ2FzZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBWYXRUYXhEcm9wRG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogInN0YXJ0c3dpdGgiLAogICAgICAgICAgICAgICAgICAgIGRhdGFUZXh0RmllbGQ6ICJkZWZhdWx0VGF4IiwKICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogImlkIiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9ZGVmYXVsdFRheCM8L3NwYW4+IiwKICAgICAgICAgICAgICAgICAgICBvcHRpb25MYWJlbDogIi0tU2VsZWN0LS0iLAogICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IG5ldyBrZW5kby5kYXRhLkRhdGFTb3VyY2UoewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLnZhdFRheCwKICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgQWNjb3VudERyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IG5hbWU9IicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgICAgICAgICAgICBhdXRvQmluZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiAic3RhcnRzd2l0aCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogIm5hbWUiLAogICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZUZpZWxkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAiPHNwYW4+Iz1udW1iZXIjIC0gIz1uYW1lIyA8L3NwYW4+IiwKICAgICAgICAgICAgICAgICAgICBvcHRpb25MYWJlbDogIi0tU2VsZWN0LS0iLAogICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IG5ldyBrZW5kby5kYXRhLkRhdGFTb3VyY2UoewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLmFjY291bnRzLAogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBBY2NvdW50RHJvcERvd25FZGl0b3JSZWZ1bmQoY29udGFpbmVyLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAualF1ZXJ5KCc8aW5wdXQgbmFtZT0iJyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgICAgICAua2VuZG9Ecm9wRG93bkxpc3QoewogICAgICAgICAgICAgICAgICAgIGF1dG9CaW5kOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGF1dG9XaWR0aDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDQwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXI6ICJzdGFydHN3aXRoIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVGV4dEZpZWxkOiAibmFtZSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlRmllbGQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICI8c3Bhbj4jPW51bWJlciMgLSAjPW5hbWUjIDwvc3Bhbj4iLAogICAgICAgICAgICAgICAgICAgIG9wdGlvbkxhYmVsOiAiLS1TZWxlY3QtLSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZTogbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHRoaXMuYWNjQ2FzaCwKICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgQWNjb3VudERyb3BEb3duRWRpdG9yRGVwb3NpdChjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogInN0YXJ0c3dpdGgiLAogICAgICAgICAgICAgICAgICAgIGRhdGFUZXh0RmllbGQ6ICJuYW1lIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogImlkIiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9bnVtYmVyIyAtICM9bmFtZSMgPC9zcGFuPiIsCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6ICItLVNlbGVjdC0tIiwKICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlOiBuZXcga2VuZG8uZGF0YS5EYXRhU291cmNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogdGhpcy5hY2NEZXBvc2l0LAogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBTYWxlVW5pdERyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IG5hbWU9IicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgICAgICAgICAgICBhdXRvQmluZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiAic3RhcnRzd2l0aCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogIm5hbWUiLAogICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZUZpZWxkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAiPHNwYW4+Iz1jb2RlIyAtICM9bmFtZSM8L3NwYW4+IiwKICAgICAgICAgICAgICAgICAgICBvcHRpb25MYWJlbDogIi0tLSBTZWxlY3QgLS0tIiwKICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlOiBuZXcga2VuZG8uZGF0YS5EYXRhU291cmNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogdGhpcy5zYWxlVW5pdEl0ZW1MaXN0LAogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBBbW91bnRFZGl0b3IoY29udGFpbmVyLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAualF1ZXJ5KCc8aW5wdXQgZGF0YS1iaW5kPSJ2YWx1ZTonICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb051bWVyaWNUZXh0Qm94KHsKICAgICAgICAgICAgICAgICAgICBkZWNpbWFsczogMzAsCiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBgJHt0aGlzLmRlY2ltYWxGb3JtYXR9YCwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgcm93TnVtYmVyVG1wbChkYXRhSXRlbSkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLml0ZW1MaW5lRFMua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIGluZGV4ID0gZHMuaW5kZXhPZihkYXRhSXRlbSk7CiAgICAgICAgICAgIHJldHVybiBpbmRleCArIDE7CiAgICAgICAgfSwKICAgICAgICByb3dOdW1iZXJUbXBsQWNjKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuYWNjb3VudExpbmVEUy5rZW5kb1dpZGdldCgpLAogICAgICAgICAgICAgICAgaW5kZXggPSBkcy5pbmRleE9mKGRhdGFJdGVtKTsKICAgICAgICAgICAgcmV0dXJuIGluZGV4ICsgMTsKICAgICAgICB9LAogICAgICAgIHJvd051bWJlclRtcGxEZXBvc2l0KGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuZGVwb3NpdExpbmVEUy5rZW5kb1dpZGdldCgpLAogICAgICAgICAgICAgICAgaW5kZXggPSBkcy5pbmRleE9mKGRhdGFJdGVtKTsKICAgICAgICAgICAgcmV0dXJuIGluZGV4ICsgMTsKICAgICAgICB9LAogICAgICAgIHJvd051bWJlclRtcGxBcHBseShkYXRhSXRlbSkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLmFwcGx5VG9MaW5lRFMua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIGluZGV4ID0gZHMuaW5kZXhPZihkYXRhSXRlbSk7CiAgICAgICAgICAgIHJldHVybiBpbmRleCArIDE7CiAgICAgICAgfSwKICAgICAgICBhZGRSb3dPZmZzZXRJbnZvaWNlKCkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLmFwcGx5VG9MaW5lRFMua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIHRvdGFsID0gZHMudG90YWwoKTsKICAgICAgICAgICAgZHMuaW5zZXJ0KHRvdGFsLCB0aGlzLmFwcGx5VG9MaW5lKTsKICAgICAgICB9LAogICAgICAgIGFkZFJvdygpIHsKICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5pdGVtTGluZURTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICB0b3RhbCA9IGRzLnRvdGFsKCk7CiAgICAgICAgICAgIHRoaXMuaXRlbUxpbmUuaWQgPSBpdGVtTGluZVByZWZpeCArIHV1aWQudjEoKTsKICAgICAgICAgICAgdGhpcy5pdGVtTGluZS5kZWNpbWFsRm9ybWF0ID0gdGhpcy5kZWNpbWFsRm9ybWF0OwogICAgICAgICAgICBkcy5pbnNlcnQodG90YWwsIHRoaXMuaXRlbUxpbmUpOwogICAgICAgICAgICAvLyB0aGlzLml0ZW1MaW5lcy5wdXNoKHRoaXMuaXRlbUxpbmUpCiAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZygnaXRlbSBMaW5lJywgdGhpcy5pdGVtTGluZSkKICAgICAgICB9LAogICAgICAgIGFkZFJvd0FjYygpIHsKICAgICAgICAgICAgLy8gbGV0IGRzID0gdGhpcy4kcmVmcy5hY2NvdW50TGluZURTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgIC8vICAgICB0b3RhbCA9IGRzLnRvdGFsKCkKICAgICAgICAgICAgLy8gdGhpcy5hY2NvdW50TGluZS5pZCA9IGl0ZW1MaW5lUHJlZml4ICsgdXVpZC52MSgpCiAgICAgICAgICAgIC8vIGRzLmluc2VydCh0b3RhbCwgdGhpcy5hY2NvdW50TGluZSkKICAgICAgICB9LAogICAgICAgIGFkZFJvd0RlcG9zaXQoKSB7CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuZGVwb3NpdExpbmVEUy5rZW5kb1dpZGdldCgpLAogICAgICAgICAgICAgICAgdG90YWwgPSBkcy50b3RhbCgpOwogICAgICAgICAgICB0aGlzLmRlcG9zaXRMaW5lLmlkID0gaXRlbUxpbmVQcmVmaXggKyB1dWlkLnYxKCk7CiAgICAgICAgICAgIHRoaXMuZGVwb3NpdExpbmUuZGVjaW1hbEZvcm1hdCA9IHRoaXMuZGVjaW1hbEZvcm1hdDsKICAgICAgICAgICAgZHMuaW5zZXJ0KHRvdGFsLCB0aGlzLmRlcG9zaXRMaW5lKTsKICAgICAgICB9LAogICAgICAgIGFkZFJvd0Nhc2hSZWZ1bmQoKSB7CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuY2FzaFJlZnVuZERTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICB0b3RhbCA9IGRzLnRvdGFsKCk7CiAgICAgICAgICAgIHRoaXMuc2FsZURlcG9zaXRMaW5lLmlkID0gaXRlbUxpbmVQcmVmaXggKyB1dWlkLnYxKCk7CiAgICAgICAgICAgIHRoaXMuc2FsZURlcG9zaXRMaW5lLmRlY2ltYWxGb3JtYXQgPSB0aGlzLmRlY2ltYWxGb3JtYXQ7CiAgICAgICAgICAgIHRoaXMuc2FsZURlcG9zaXRMaW5lLm9wdGlvblR5cGUgPSBPUFRJT05fVFlQRQogICAgICAgICAgICBkcy5pbnNlcnQodG90YWwsIHRoaXMuc2FsZURlcG9zaXRMaW5lKTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRPdGhlckFjY291bnQoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzSGFuZGxlcgogICAgICAgICAgICAgICAgICAgICAgICAuZ2V0T3RoZXJBY2NvdW50KCkKICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJlc3BvbnNlLmZpbHRlcigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG8pID0+IG8uYmFuaGppQWNjQ29kZSA9PT0gIjc0MDAxMCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nYWluTG9zc0FjYyA9IGRhdGFbMF0uYWNjb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YV8gPSByZXNwb25zZS5maWx0ZXIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChvKSA9PiBvLmJhbmhqaUFjY0NvZGUgPT09ICI3NDAwNDAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YV8ubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm90aGVyUmV2ZW51ZUFjYyA9IGRhdGFfWzBdLmFjY291bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKTsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgUHVyY2hhc2VEaXNjb3VudEl0ZW1FZGl0b3IoKSB7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBzZWFyY2hJbnZvaWNlKCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IHt9OwogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHByaWNlTGV2ZWwgPSB0aGlzLmNyZWRpdE1lbW8ucHJpY2VMZXZlbDsKICAgICAgICAgICAgICAgICAgICBsZXQgY29kZSA9ICIiOwogICAgICAgICAgICAgICAgICAgIGlmIChwcmljZUxldmVsLmhhc093blByb3BlcnR5KCJjdXJyZW5jeSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5jdXJyZW5jeSA9IHByaWNlTGV2ZWwuY3VycmVuY3k7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcmljZUxldmVsLmN1cnJlbmN5Lmhhc093blByb3BlcnR5KCJjb2RlIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUgPSBwcmljZUxldmVsLmN1cnJlbmN5LmNvZGU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoOiB0aGlzLmN1c3RvbWVyLmlkLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiY3VzdG9tZXIiLAogICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IDMsCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogdGhpcy50cmFuc2FjdGlvbkRhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiBjb2RlLAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vZmZzZXRJbnZvaWNlcyA9IFtdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gMQogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGlmIChjb2RlICE9PSAiIikgewogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmlsbGluZ0hhbmRsZXIuc2VhcmNoKGRhdGEpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zdCByZXN1bHQgPSByZXMuZGF0YS5yZXN1bHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB1bmlxdWVJZHMgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub2Zmc2V0SW52b2ljZUxpc3QgPSByZXNwb25zZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub2Zmc2V0SW52b2ljZUxpc3QuZm9yRWFjaCgobykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXF1ZUlkcy5wdXNoKG8uaWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1bmlxdWUgPSBbLi4ubmV3IFNldCh1bmlxdWVJZHMpXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub2Zmc2V0SW52b2ljZXMgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXF1ZS5mb3JFYWNoKCh0eG5JZCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZvdW5kID0gdGhpcy5vZmZzZXRJbnZvaWNlTGlzdC5maWx0ZXIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChqKSA9PiBqLmlkID09PSB0eG5JZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQuZm9yRWFjaCgoaykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9mZnNldEludm9pY2VzLnB1c2goayk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnN0IHVuaXF1ZSA9IFsuLi5uZXcgU2V0KHRoaXMub2Zmc2V0SW52b2ljZUxpc3QubWFwKGl0ZW0gPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgIGlkOiBpdGVtLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICByZWZlcmVuY2VObzogaXRlbS5yZWZlcmVuY2VObwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIH0pKV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuYXV0b0NhbGN1bGF0ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmFkZFJvd09mZnNldEludm9pY2UoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IDAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCA1MCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFBheW1lbnRPcHRpb24oKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMucGF5bWVudE1ldGhvZCA9IFtdOwogICAgICAgICAgICAgICAgICAgIHBheW1lbnRPcHRpb25IYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgIC5saXN0KHN0ck9wdGlvbkZpbHRlcikKICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBheW1lbnRNZXRob2QgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKTsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCA1MCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgb25TYXZlQ2xvc2Uoc2F2ZSkgewogICAgICAgICAgICBpZiAoIXRoaXMuJHJlZnMuZm9ybS52YWxpZGF0ZSgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRyZWZzLmZvcm0udmFsaWRhdGUoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgbERTID0gdGhpcy4kcmVmcy5pdGVtTGluZURTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgIGxldCBkYXRhVmFsaWRhdGUgPSAwOwogICAgICAgICAgICBjb25zdCBpdG1MaW5lUiA9IGxEUy5kYXRhKCkuZmlsdGVyKChuKSA9PiBuLmFtb3VudCA+IDApOwogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coJ2l0bUxpbmVSJywgaXRtTGluZVIpCiAgICAgICAgICAgIGlmIChpdG1MaW5lUi5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBpdG1MaW5lUi5mb3JFYWNoKCh2YWx1ZSwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLml0ZW0uaWQgPT09IHVuZGVmaW5lZCB8fAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZS51b20udW9tLmlkID09PSB1bmRlZmluZWQgfHwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUuaXRlbS5pZCA9PT0gIiIgfHwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUudW9tLnVvbS5pZCA9PT0gIiIKICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJQbGVhc2Ugc2VsZWN0IHJldHVybiBpdGVtIGF0IHJvdyAiICsgKGluZGV4ICsgMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhVmFsaWRhdGUgKz0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGlmIChpdG1MaW5lUi5sZW5ndGggPT09IGRhdGFWYWxpZGF0ZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLmNyZWRpdE1lbW8ucHJpY2VMZXZlbCkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kciAhPT0gMCAmJiB0aGlzLmNyICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2codGhpcy5jcmVkaXRNZW1vLnByaWNlTGV2ZWwsICJwcmljZSBsZXZlbCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGlzQXV0b0dlbmVyYXRlID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0QW1vdW50ID0gcGFyc2VGbG9hdCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5hcHBseVRvQW1vdW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1MaW5lQW1vdW50ID0gcGFyc2VGbG9hdCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtby5pdGVtTGluZUFtb3VudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YXJpYW5jZSA9IHBhcnNlRmxvYXQodGhpcy5jcmVkaXRNZW1vLnZhcmlhbmNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc3QgbERTID0gdGhpcy4kcmVmcy5pdGVtTGluZURTLmtlbmRvV2lkZ2V0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc3QgaXRtTGluZVIgPSBsRFMuZGF0YSgpLmZpbHRlcihuID0+IG4uYW1vdW50ID4gMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc3QgYXBwbHlUb0RTID0gdGhpcy4kcmVmcy5hcHBseVRvTGluZURTLmtlbmRvV2lkZ2V0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc3QgYXBwbHlUb0xpbmVSID0gYXBwbHlUb0RTLmRhdGEoKS5maWx0ZXIobiA9PiBuLnBhaWRBbW91bnQgPiAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zdCBkZXBvc2l0TGluZURTID0gdGhpcy4kcmVmcy5kZXBvc2l0TGluZURTLmtlbmRvV2lkZ2V0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc3QgZGVwb3NpdExpbmVSID0gZGVwb3NpdExpbmVEUy5kYXRhKCkuZmlsdGVyKG4gPT4gbi5hbW91bnQgPiAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbm9EZXBvc2l0QWNjID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vQ2FzaEFjY291bnQgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9WYXJpYW5jZUFjYyA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIChpdG1MaW5lUi5sZW5ndGggPiAwICYmIGRlcG9zaXRMaW5lUi5sZW5ndGggPiAwICYmIGFwcGx5VG9MaW5lUi5sZW5ndGggPiAwKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3RvZG86IGNoZWNrIG9mZnNldCBhbW91bnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm9mZnNldEFtb3VudCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXRBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaXRlbUxpbmVBbW91bnQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbUxpbmVBbW91bnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9mZnNldEFtb3VudCA+IGl0ZW1MaW5lQW1vdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dXYXJpbmdNZXNzYWdlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJDcmVkaXQgTWVtbyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlJldHVybiBhbW91bnQgYW5kIE9mZnNldCBhbW91bnQgbXVzdCBiZSBlcXVhbCEiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJPSyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy90b2RvOiBjaGVjayBjdXN0b21lciBjcmVkaXQgY2FzZSBhbW91bnQ+MCBhbmQgdW5zZWxlY3RlZCBhY2NvdW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuZGVwb3NpdExpbmVEUy5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcm93cyA9IGRzLmRhdGEoKS5maWx0ZXIoKG4pID0+IG4uYW1vdW50ID4gMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd3MuZm9yRWFjaCgoaXRtKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhY2NvdW50ID0gaXRtLmFjY291bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWFjY291bnQuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dXYXJpbmdNZXNzYWdlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQ3JlZGl0IE1lbW8iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiUGxlYXNlIHNlbGVjdCBkZXBvc2l0IGFjY291bnQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiT0siCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub0RlcG9zaXRBY2MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdG9kbzogY2hlY2sgQ2FzaCByZWZ1bmQgY2FzZSBhbW91bnQ+MCBhbmQgdW5zZWxlY3RlZCBhY2NvdW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkc1JlZnVuZCA9IHRoaXMuJHJlZnMuY2FzaFJlZnVuZERTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd3MgPSBkc1JlZnVuZC5kYXRhKCkuZmlsdGVyKChuKSA9PiBuLmFtb3VudCA+IDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dzLmZvckVhY2goKGl0bSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYWNjb3VudCA9IGl0bS5hY2NvdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFhY2NvdW50Lmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93V2FyaW5nTWVzc2FnZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkNyZWRpdCBNZW1vIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlBsZWFzZSBzZWxlY3QgY2FzaCBhY2NvdW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIk9LIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9DYXNoQWNjb3VudCA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy90b2RvOiBjaGVjayB2YXJpYW5jZSBhY2NvdW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YXJpYW5jZSAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFyaWFuY2VBY2MgPSB0aGlzLmNyZWRpdE1lbW8udmFyaWFuY2VBY2M7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXZhcmlhbmNlQWNjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgKCF2YXJpYW5jZS5oYXNPd25Qcm9wZXJ0eSgnaWQnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1dhcmluZ01lc3NhZ2UoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJDcmVkaXQgTWVtbyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJQbGVhc2Ugc2VsZWN0IHZhcmlhbmNlIGFjY291bnQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiT0siCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub1ZhcmlhbmNlQWNjID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vVmFyaWFuY2VBY2MgPT09IDAgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vRGVwb3NpdEFjYyA9PT0gMCAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9DYXNoQWNjb3VudCA9PT0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmFuRGF0ZSA9IG5ldyBEYXRlKHRoaXMudHJhbnNhY3Rpb25EYXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmFuRGF0ZUludm9pY2UgPSBuZXcgRGF0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcmVkaXRNZW1vLnRyYW5zYWN0aW9uRGF0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJhbkRhdGVNID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbkRhdGUuZ2V0RnVsbFllYXIoKSArIHRyYW5EYXRlLmdldE1vbnRoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJhbkRhdGVJbnZvaWNlTSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5EYXRlSW52b2ljZS5nZXRGdWxsWWVhcigpICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbkRhdGVJbnZvaWNlLmdldE1vbnRoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyYW5EYXRlTSA9PT0gdHJhbkRhdGVJbnZvaWNlTSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0F1dG9HZW5lcmF0ZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGl0ZW1MaW5lRFMgPSB0aGlzLiRyZWZzLml0ZW1MaW5lRFMua2VuZG9XaWRnZXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBhcHBseVRvTGluZURTID0gdGhpcy4kcmVmcy5hcHBseVRvTGluZURTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgY2FzaFJlZnVuZERTID0gdGhpcy4kcmVmcy5jYXNoUmVmdW5kRFMua2VuZG9XaWRnZXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkZXBvc2l0TGluZURTID0gdGhpcy4kcmVmcy5kZXBvc2l0TGluZURTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpdGVtTGluZVIgPSBpdGVtTGluZURTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGEoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoKG8pID0+IG8uYW1vdW50KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKG4pID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJDaGFyZ2UgPSBuZXcgT3RoZXJDaGFyZ2VNb2RlbChuLm90aGVyQ2hhcmdlIHx8IHt9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuWydvdGhlckNoYXJnZSddID0gb3RoZXJDaGFyZ2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBJdGVtTGluZU1vZGVsKG4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXBwbHlUb0xpbmVSID0gYXBwbHlUb0xpbmVEUwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5kYXRhKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChvKSA9PiBvLnBhaWRBbW91bnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCgobikgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEFwcGx5VG9MaW5lTW9kZWwobik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkZXBvc2l0TGluZVIgPSBkZXBvc2l0TGluZURTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGEoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoKG8pID0+IG8uYW1vdW50KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKG4pID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEZXBvc2l0TGluZU1vZGVsKG4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2FzaFJlZnVuZFIgPSBjYXNoUmVmdW5kRFMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZGF0YSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcigobykgPT4gby5hbW91bnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCgobikgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gey4uLm59OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRoaXMuY3JlZGl0TWVtby5pZCA/IHRoaXMuY3JlZGl0TWVtby5pZCA6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJDcmVkaXQgTWVtbyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXVpZDogdGhpcy5jcmVkaXRNZW1vLnV1aWQgPyB0aGlzLmNyZWRpdE1lbW8udXVpZCA6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvdXJuYWxfdXVpZDogdGhpcy5jcmVkaXRNZW1vLmpvdXJuYWxfdXVpZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHRoaXMuY3JlZGl0TWVtby5qb3VybmFsX3V1aWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IHRoaXMuY3JlZGl0TWVtby5udW1iZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJicjogdGhpcy5jcmVkaXRNZW1vLnRyYW5zYWN0aW9uVHlwZS5hYmJyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogdGhpcy50cmFuc2FjdGlvbkRhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tZXI6IHRoaXMuY3VzdG9tZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25UeXBlOiB0aGlzLmNyZWRpdE1lbW8udHJhbnNhY3Rpb25UeXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiB0aGlzLmNyZWRpdE1lbW8uY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHhuUmF0ZTogdGhpcy5jcmVkaXRNZW1vLnR4blJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmF0ZTogMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogdGhpcy5jcmVkaXRNZW1vLmV4Y2hhbmdlQW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlUmF0ZTogdGhpcy5jcmVkaXRNZW1vLmV4Y2hhbmdlUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IHRoaXMuY3JlZGl0TWVtby5hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWFuY2U6IHRoaXMuY3JlZGl0TWVtby52YXJpYW5jZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmljZUxldmVsOiB0aGlzLmNyZWRpdE1lbW8ucHJpY2VMZXZlbCwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbUxpbmU6IGl0ZW1MaW5lUiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXBvc2l0TGluZTogZGVwb3NpdExpbmVSLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2hSZWZ1bmRMaW5lOiBjYXNoUmVmdW5kUiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBseVRvTGluZTogYXBwbHlUb0xpbmVSLAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50OiB0aGlzLmNyZWRpdE1lbW8uc2VnbWVudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogdGhpcy5jcmVkaXRNZW1vLmxvY2F0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3Q6IHRoaXMuY3JlZGl0TWVtby5wcm9qZWN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtcGxveWVlOiB0aGlzLmNyZWRpdE1lbW8uZW1wbG95ZWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25Ob3RlOiB0aGlzLmNyZWRpdE1lbW8udHJhbnNhY3Rpb25Ob3RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvdXJuYWxOb3RlOiB0aGlzLmNyZWRpdE1lbW8uam91cm5hbE5vdGUsCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1MaW5lQW1vdW50OiB0aGlzLmNyZWRpdE1lbW8uaXRlbUxpbmVBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbUxpbmVFeGNoYW5nZUFtb3VudDogdGhpcy5jcmVkaXRNZW1vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5pdGVtTGluZUV4Y2hhbmdlQW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1MaW5lRGlzY291bnRBbW91bnQ6IHRoaXMuY3JlZGl0TWVtbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuaXRlbUxpbmVEaXNjb3VudEFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtTGluZVRheEFtb3VudDogdGhpcy5jcmVkaXRNZW1vLml0ZW1MaW5lVGF4QW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1MaW5lU3ViVG90YWw6IHRoaXMuY3JlZGl0TWVtby5pdGVtTGluZVN1YlRvdGFsLAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBseVRvQW1vdW50OiB0aGlzLmNyZWRpdE1lbW8uYXBwbHlUb0Ftb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBseVRvRXhjaGFuZ2VBbW91bnQ6IHRoaXMuY3JlZGl0TWVtbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwbHlUb0V4Y2hhbmdlQW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlcG9zaXREZWR1Y3Rpb246IHRoaXMuY3JlZGl0TWVtby5kZXBvc2l0RGVkdWN0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlcG9zaXRBbW91bnQ6IHRoaXMuY3JlZGl0TWVtby5kZXBvc2l0QW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlRGVwb3NpdERlZHVjdGlvbjogdGhpcy5jcmVkaXRNZW1vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5leGNoYW5nZURlcG9zaXREZWR1Y3Rpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmdW5kQW1vdW50OiB0aGlzLmNyZWRpdE1lbW8ucmVmdW5kQW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhbmNlQWNjOiB0aGlzLmNyZWRpdE1lbW8udmFyaWFuY2VBY2MsCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVPcHRpb246IHRoaXMuY3JlZGl0TWVtby5zYXZlT3B0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHByb3ZlZEJ5OiB0aGlzLmNyZWRpdE1lbW8uYXBwcm92ZWRCeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtVGVtcGxhdGU6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogdGhpcy5jcmVkaXRNZW1vLmNyZWF0ZWRBdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFzb246IHRoaXMuY3JlZGl0TWVtby5yZWFzb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VkVXNlcjogdGhpcy5sb2dnZWRVc2VyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzQXV0b0dlbmVyYXRlOiBpc0F1dG9HZW5lcmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqUmF3OiB0aGlzLmpSYXcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVN1YnRvdGFsOiB0aGlzLmNyZWRpdE1lbW8uaXRlbVN1YnRvdGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlSXRlbVN1YnRvdGFsOiB0aGlzLmNyZWRpdE1lbW8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmV4Y2hhbmdlSXRlbVN1YnRvdGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZpY2VTdWJ0b3RhbDogdGhpcy5jcmVkaXRNZW1vLnNlcnZpY2VTdWJ0b3RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZVNlcnZpY2VTdWJ0b3RhbDogdGhpcy5jcmVkaXRNZW1vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5leGNoYW5nZVNlcnZpY2VTdWJ0b3RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eG5JdG1TdWJ0b3RhbDogdGhpcy5jcmVkaXRNZW1vLnR4bkl0bVN1YnRvdGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlVHhuSXRtU3VidG90YWw6IHRoaXMuY3JlZGl0TWVtbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZXhjaGFuZ2VUeG5JdG1TdWJ0b3RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtRGlzY291bnQ6IHRoaXMuY3JlZGl0TWVtby5pdGVtRGlzY291bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VJdGVtRGlzY291bnQ6IHRoaXMuY3JlZGl0TWVtbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZXhjaGFuZ2VJdGVtRGlzY291bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VydmljZURpc2NvdW50OiB0aGlzLmNyZWRpdE1lbW8uc2VydmljZURpc2NvdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlU2VydmljZURpc2NvdW50OiB0aGlzLmNyZWRpdE1lbW8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmV4Y2hhbmdlU2VydmljZURpc2NvdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4bkl0bURpc2NvdW50OiB0aGlzLmNyZWRpdE1lbW8udHhuSXRtRGlzY291bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VUeG5JdG1EaXNjb3VudDogdGhpcy5jcmVkaXRNZW1vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5leGNoYW5nZVR4bkl0bURpc2NvdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZkZyb206IHRoaXMuY3JlZGl0TWVtby5yZWZGcm9tIHx8IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZlRvOiB0aGlzLmNyZWRpdE1lbW8ucmVmVG8gfHwgW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FsZVRheERldGFpbDogdGhpcy5jcmVkaXRNZW1vLnNhbGVUYXhEZXRhaWwgfHwgW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tZXJEaXNjb3VudEl0ZW06IHRoaXMuY3JlZGl0TWVtby5jdXN0b21lckRpc2NvdW50SXRlbSB8fCBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZVZhcmlhbmNlOiB0aGlzLmNyZWRpdE1lbW8uZXhjaGFuZ2VWYXJpYW5jZSB8fCAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvblR5cGU6IHRoaXMuJHJvdXRlLnBhcmFtcy5pZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHRoaXMuJHJvdXRlLnF1ZXJ5LnR5cGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAibmV3IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhkYXRhLCAiYXBwbHlUb0xpbmVSIiwgYXBwbHlUb0xpbmVSKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYXBwbHlUb0xpbmVSIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeShhcHBseVRvTGluZVIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KGRhdGEpLCAiZGF0YSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmlsbGluZ0hhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY3JlYXRlQ3JlZGl0TWVtbyhkYXRhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXNDb2RlID09PSAyMDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuc3VjY2VzcygiU3VjY2Vzc2Z1bGx5Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2F2ZSA9PSAnbmV3JykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LmVycm9yKCJTb21ldGhpbmcgd2VudCB3cm9uZyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9ycy5wdXNoKGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dXYXJpbmdNZXNzYWdlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJDcmVkaXQgTWVtbyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlBsZWFzZSBjaGVjayBiZWZvcmUgc2F2ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIk9LIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1dhcmluZ01lc3NhZ2UoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQ3JlZGl0IE1lbW8iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlBsZWFzZSBjaGVjayBiZWZvcmUgc2F2ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiT0siCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcigiUGxlYXNlIHNlbGVjdCByZXR1cm4gaXRlbSAiKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFZpZXdDcmVkaXRNZW1vKCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJGaWx0ZXIgPSAiP2lkPSIgKyB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGJpbGxpbmdIYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY3JlZGl0TWVtb0xpc3Qoc3RyRmlsdGVyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzYWxlUmV0dXJuID0gcmVzLmRhdGEuZGF0YVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcmVkaXRNZW1vID0gc2FsZVJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtTGluZXMgPSBzYWxlUmV0dXJuLml0ZW1MaW5lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9mZnNldEludm9pY2VzID0gc2FsZVJldHVybi5hcHBseVRvTGluZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXNoUmVmdW5kTGluZXMgPSBzYWxlUmV0dXJuLmNhc2hSZWZ1bmRMaW5lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRlcG9zaXRMaW5lcyA9IHNhbGVSZXR1cm4uZGVwb3NpdExpbmU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3VzdG9tZXIgPSB0aGlzLmNyZWRpdE1lbW8uY3VzdG9tZXI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubUVtcGxveWVlID0gdGhpcy5jcmVkaXRNZW1vLmVtcGxveWVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uRGF0ZSA9IHRoaXMuY3JlZGl0TWVtby50cmFuc2FjdGlvbkRhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYmFzZUN1cnJlbmN5Q29kZSA9IHNhbGVSZXR1cm4uYmFzZUN1cnJlbmN5Q29kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXN0b21lckRpc2NvdW50SXRlbSA9IHRoaXMuY3JlZGl0TWVtby5jdXN0b21lckRpc2NvdW50SXRlbSB8fCBbXTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNhc2hSZWZ1bmRMaW5lcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2FsZURlcG9zaXRMaW5lLmlkID0gaXRlbUxpbmVQcmVmaXggKyB1dWlkLnYxKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhc2hSZWZ1bmRMaW5lcy5wdXNoKHRoaXMuc2FsZURlcG9zaXRMaW5lKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuYWRkUm93Q2FzaFJlZnVuZCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGVwb3NpdExpbmVzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYWxlRGVwb3NpdExpbmUuaWQgPSBpdGVtTGluZVByZWZpeCArIHV1aWQudjEoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGVwb3NpdExpbmVzLnB1c2godGhpcy5zYWxlRGVwb3NpdExpbmUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5hZGRSb3dEZXBvc2l0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKTsKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCA1MCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgY2xvc2UoKSB7CiAgICAgICAgICAgIHdpbmRvdy5oaXN0b3J5LmdvKC0xKTsKICAgICAgICB9LAogICAgICAgIGNsZWFyKCkgewogICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIGxldCBpdGVtTGluZURTID0gdGhpcy4kcmVmcy5pdGVtTGluZURTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgIGl0ZW1MaW5lRFMuZGF0YShbXSk7CiAgICAgICAgICAgIGxldCBjYXNoUmVmdW5kRFMgPSB0aGlzLiRyZWZzLmNhc2hSZWZ1bmREUy5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICBjYXNoUmVmdW5kRFMuZGF0YShbXSk7CiAgICAgICAgICAgIGxldCBkZXBvc2l0TGluZURTID0gdGhpcy4kcmVmcy5kZXBvc2l0TGluZURTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgIGRlcG9zaXRMaW5lRFMuZGF0YShbXSk7CiAgICAgICAgICAgIGxldCBhcHBseVRvTGluZURTID0gdGhpcy4kcmVmcy5hcHBseVRvTGluZURTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgIGFwcGx5VG9MaW5lRFMuZGF0YShbXSk7CiAgICAgICAgICAgIHRoaXMub2Zmc2V0SW52b2ljZSA9IHt9CiAgICAgICAgICAgIHRoaXMub2Zmc2V0SW52b2ljZXMgPSBbXTsKICAgICAgICAgICAgY29uc3QgY3VzVHlwZSA9IHRoaXMuY3JlZGl0TWVtby50cmFuc2FjdGlvblR5cGUKICAgICAgICAgICAgdGhpcy5jdXN0b21lciA9IHt9CiAgICAgICAgICAgIHRoaXMuY3JlZGl0TWVtbyA9IG5ldyBDcmVkaXRNZW1vTW9kZWwoKQogICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8udHJhbnNhY3Rpb25UeXBlID0gY3VzVHlwZQogICAgICAgICAgICB0aGlzLmFkZFJvdygpCgogICAgICAgIH0sCiAgICAgICAgYXV0b0NhbGN1bGF0ZVRheERldGFpbCgpIHsKICAgICAgICAgICAgbGV0IGlkcyA9IFtdCiAgICAgICAgICAgIHRoaXMudGF4TGlzdERldGFpbC5mb3JFYWNoKG4gPT4gewogICAgICAgICAgICAgICAgaWRzLnB1c2gobi5pZCB8fCAnJykKICAgICAgICAgICAgfSkKICAgICAgICAgICAgY29uc3QgdW5pcXVlID0gWy4uLm5ldyBTZXQoaWRzKV0KICAgICAgICAgICAgbGV0IHJlc3VsdCA9IFtdCiAgICAgICAgICAgIHVuaXF1ZS5mb3JFYWNoKG0gPT4gewogICAgICAgICAgICAgICAgbGV0IGFtb3VudCA9IDAsIHJvdyA9IHt9LCBkaXNjb3VudCA9IDAsIHhEaXNjb3VudCA9IDAsIHhBbW91bnQgPSAwLCB0YXhBbW91bnQgPSAwLCB4VGF4QW1vdW50ID0gMAogICAgICAgICAgICAgICAgbGV0IHRheERldGFpbCA9IFtdLCBpc1ZhdCA9IDAKICAgICAgICAgICAgICAgIGNvbnN0IGZvdW5kID0gdGhpcy50YXhMaXN0RGV0YWlsLmZpbHRlcihuID0+IG4uaWQgPT09IG0pCiAgICAgICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coJ3RheExpc3REZXRhaWxpZHMnLCBmb3VuZCkKICAgICAgICAgICAgICAgIGZvdW5kLmZvckVhY2goayA9PiB7CiAgICAgICAgICAgICAgICAgICAgcm93ID0gawogICAgICAgICAgICAgICAgICAgIGlmIChrLmlzVmF0ID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlzVmF0ID0gMQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkZXRhaWxfID0gay5kZXRhaWwgfHwge30KICAgICAgICAgICAgICAgICAgICAgICAgdGF4RGV0YWlsLnB1c2goZGV0YWlsXykKCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRheEFtb3VudCArPSBrLnRheEFtb3VudF8gfHwgMAogICAgICAgICAgICAgICAgICAgIHhUYXhBbW91bnQgKz0gKGsudGF4QW1vdW50XyB8fCAwKSAqIChrLnR4blJhdGUgfHwgMSkKICAgICAgICAgICAgICAgICAgICBhbW91bnQgKz0gKGsuYW1vdW50IHx8IDApCiAgICAgICAgICAgICAgICAgICAgeEFtb3VudCArPSAoay5hbW91bnQgfHwgMCkgKiAoay50eG5SYXRlIHx8IDEpCiAgICAgICAgICAgICAgICAgICAgZGlzY291bnQgKz0gKGsuZGlzY291bnQgfHwgMCkKICAgICAgICAgICAgICAgICAgICB4RGlzY291bnQgKz0gKGsuZGlzY291bnQgfHwgMCkgKiAoay50eG5SYXRlIHx8IDEpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgbGV0IHNwVGF4QW10ID0gMCwgc3BYVGF4QW10ID0gMCwgcGxUYXhBbXQgPSAwLCBwbFhUYXhBbXQgPSAwLCBvdFRheEFtdCA9IDAsIG90WFRheEFtdCA9IDAsCiAgICAgICAgICAgICAgICAgICAgc3BUYXhOYW1lID0gJycsIHBsVGF4TmFtZSA9ICcnLCBvdFRheE5hbWUgPSAnJywKICAgICAgICAgICAgICAgICAgICBzcFRheE5hbWVMb2NhbGUgPSAnJywgcGxUYXhOYW1lTG9jYWxlID0gJycsIG90VGF4TmFtZUxvY2FsZSA9ICcnLAogICAgICAgICAgICAgICAgICAgIHNwQWNjSWQgPSAnJywgcGxBY2NJZCA9ICcnLCBvdEFjY0lkID0gJycsCiAgICAgICAgICAgICAgICAgICAgc3BSYXRlID0gJycsIHBsUmF0ZSA9ICcnLCBvdFJhdGUgPSAnJwogICAgICAgICAgICAgICAgdGF4RGV0YWlsLmZvckVhY2gobiA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3BUYXggPSBuLnNwZWNpZmljVGF4IHx8IHt9CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGxUYXggPSBuLnB1YmxpY0xpZ2h0aW5nVGF4IHx8IHt9CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJUYXggPSBuLm90aGVyVGF4IHx8IHt9CiAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKHNwVGF4KS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNwVGF4QW10ICs9IChzcFRheC50YXhBbW91bnRfIHx8IDApCiAgICAgICAgICAgICAgICAgICAgICAgIHNwWFRheEFtdCArPSAoKHNwVGF4LnRheEFtb3VudF8gfHwgMCkgKiAoc3BUYXgudGF4UmF0ZSB8fCAxKSkKICAgICAgICAgICAgICAgICAgICAgICAgc3BUYXhOYW1lID0gc3BUYXguZGVmYXVsdFRheCB8fCAnJwogICAgICAgICAgICAgICAgICAgICAgICBzcFRheE5hbWVMb2NhbGUgPSBzcFRheC5kZWZhdWx0VGF4TG9jYWxlIHx8ICcnCiAgICAgICAgICAgICAgICAgICAgICAgIHNwQWNjSWQgPSBzcFRheC5hY2NvdW50ID8gc3BUYXguYWNjb3VudC5pZCA6ICcnCiAgICAgICAgICAgICAgICAgICAgICAgIHNwUmF0ZSA9IHNwVGF4LnJhdGUgfHwgMQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMocGxUYXgpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGxUYXhBbXQgKz0gKHBsVGF4LnRheEFtb3VudF8gfHwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgcGxYVGF4QW10ICs9ICgocGxUYXgudGF4QW1vdW50XyB8fCAwKSAqIChwbFRheC50YXhSYXRlIHx8IDEpKQogICAgICAgICAgICAgICAgICAgICAgICBwbFRheE5hbWUgPSBwbFRheC5kZWZhdWx0VGF4IHx8ICcnCiAgICAgICAgICAgICAgICAgICAgICAgIHBsVGF4TmFtZUxvY2FsZSA9IHBsVGF4LmRlZmF1bHRUYXhMb2NhbGUgfHwgJycKICAgICAgICAgICAgICAgICAgICAgICAgcGxBY2NJZCA9IHBsVGF4LmFjY291bnQgPyBwbFRheC5hY2NvdW50LmlkIDogJycKICAgICAgICAgICAgICAgICAgICAgICAgcGxSYXRlID0gcGxUYXgucmF0ZSB8fCAxCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhvdGhlclRheCkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBvdFRheEFtdCArPSAob3RoZXJUYXgudGF4QW1vdW50XyB8fCAwKQogICAgICAgICAgICAgICAgICAgICAgICBvdFhUYXhBbXQgKz0gKChvdGhlclRheC50YXhBbW91bnRfIHx8IDApICogKHBsVGF4LnRheFJhdGUgfHwgMSkpCiAgICAgICAgICAgICAgICAgICAgICAgIG90VGF4TmFtZSA9IG90aGVyVGF4LmRlZmF1bHRUYXggfHwgJycKICAgICAgICAgICAgICAgICAgICAgICAgb3RUYXhOYW1lTG9jYWxlID0gb3RoZXJUYXguZGVmYXVsdFRheExvY2FsZSB8fCAnJwogICAgICAgICAgICAgICAgICAgICAgICBvdEFjY0lkID0gb3RoZXJUYXguYWNjb3VudCA/IG90aGVyVGF4LmFjY291bnQuaWQgOiAnJwogICAgICAgICAgICAgICAgICAgICAgICBvdFJhdGUgPSBvdGhlclRheC5yYXRlIHx8IDEKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgaWYgKGlzVmF0ID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgcm93LmRldGFpbCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgc3BlY2lmaWNUYXg6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHNwVGF4TmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVMb2NhbGU6IHNwVGF4TmFtZUxvY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogc3BUYXhBbXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogc3BYVGF4QW10LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudElkOiBzcEFjY0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmF0ZTogc3BSYXRlLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWNMaWdodGluZ1RheDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcGxUYXhOYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZUxvY2FsZTogcGxUYXhOYW1lTG9jYWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBwbFRheEFtdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OiBwbFhUYXhBbXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IHBsQWNjSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYXRlOiBwbFJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIG90aGVyVGF4OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBvdFRheE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lTG9jYWxlOiBvdFRheE5hbWVMb2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IG90VGF4QW10LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQ6IG90WFRheEFtdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRJZDogb3RBY2NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhdGU6IG90UmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcm93LmRldGFpbCA9IHt9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcm93WydhbW91bnQnXSA9IGFtb3VudAogICAgICAgICAgICAgICAgcm93WydleGNoYW5nZUFtb3VudCddID0geEFtb3VudAogICAgICAgICAgICAgICAgcm93Wyd0YXhBbW91bnQnXSA9IHRheEFtb3VudAogICAgICAgICAgICAgICAgcm93WydleGNoYW5nZVRheEFtb3VudCddID0geFRheEFtb3VudAogICAgICAgICAgICAgICAgcm93WydkaXNjb3VudCddID0gZGlzY291bnQKICAgICAgICAgICAgICAgIHJvd1snZXhjaGFuZ2VEaXNjb3VudCddID0geERpc2NvdW50CiAgICAgICAgICAgICAgICByb3dbJ2N1cnJlbmN5J10gPSB0aGlzLmNyZWRpdE1lbW8uZXhjaGFuZ2VSYXRlIHx8IHt9CiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChyb3cpCiAgICAgICAgICAgICAgICB0YXhEZXRhaWwgPSBbXQogICAgICAgICAgICB9KQogICAgICAgICAgICB0aGlzLmNyZWRpdE1lbW8uc2FsZVRheERldGFpbCA9IHJlc3VsdAogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coJ2NyZWRpdE1lbW8uc2FsZVRheERldGFpbCcsIHJlc3VsdCkKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRPdGhlckNoYXJnZSgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgb3RoZXJDaGFyZ2VIYW5kbGVyLmxpc3QoKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vdGhlckNoYXJnZUxpc3QgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICB9LAogICAgd2F0Y2g6IHsKICAgICAgICBpZCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNsZWFyKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRWaWV3Q3JlZGl0TWVtbygpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAvLyBjYWxsIGFnYWluIHRoZSBtZXRob2QgaWYgdGhlIHJvdXRlIGNoYW5nZXMKICAgIH0sCiAgICBjcmVhdGVkKCkgewogICAgICAgIHRoaXMubG9hZFRheCgpOwogICAgICAgIHRoaXMubG9hZFNhbGVVbml0SXRlbXMoKTsKICAgICAgICB0aGlzLmxvYWRQcmVmaXgoKTsKICAgICAgICB0aGlzLmxvYWRTZWdtZW50KCk7CiAgICAgICAgdGhpcy5sb2FkTG9jYXRpb24oKTsKICAgICAgICB0aGlzLmxvYWRQYXltZW50T3B0aW9uKCk7CiAgICB9LAogICAgbW91bnRlZDogYXN5bmMgZnVuY3Rpb24gKCkgewogICAgICAgIGF3YWl0IHRoaXMubG9hZE90aGVyQWNjb3VudCgpOwogICAgICAgIHRoaXMucmVxdWVzdERhdGEoMCwgdGhpcy5maWx0ZXIsIHRoaXMuY3VzQmFzZVVybCk7CiAgICAgICAgLy8gYXdhaXQgdGhpcy5sb2FkRGlzY291bnRJdGVtKCkKICAgICAgICBhd2FpdCB0aGlzLmxvYWRFbXBsb3llZUNlbnRlcigpOwogICAgICAgIGF3YWl0IHRoaXMubG9hZFBheW1lbnRUZXJtKCk7CiAgICAgICAgYXdhaXQgdGhpcy5sb2FkQWNjb3VudCgpOwogICAgICAgIGF3YWl0IHRoaXMubG9hZFByaWNlTGV2ZWwoKTsKICAgICAgICBhd2FpdCB0aGlzLmxvYWRPdGhlckNoYXJnZSgpOwogICAgICAgIC8vIGF3YWl0IHRoaXMubG9hZE90aGVyQ2hhcmdlKCkKICAgICAgICBhd2FpdCB0aGlzLmxvYWRTYWxlRm9ybUNvbnRlbnQoKTsKICAgICAgICBhd2FpdCB0aGlzLmluaXREYXRhKCk7CiAgICAgICAgdGhpcy5ub3dUaW1lcygpOwogICAgfSwKfTsK"},{"version":3,"sources":["SaleReturn.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAw2CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"SaleReturn.vue","sourceRoot":"src/views/customers","sourcesContent":["<template>\n    <v-app>\n        <v-container>\n            <v-row>\n                <v-col sm=\"12\" cols=\"12\">\n                    <v-card\n                        outlined\n                        dense\n                        class=\"pa-4 no_border rounded-sm\"\n                        color=\"white\"\n                    >\n                        <v-row>\n                            <v-col\n                                class=\"bigSide py-0\"\n                                sm=\"8\"\n                                cols=\"12\"\n                                style=\"transition: .3s ease-in;\"\n                                :class=\"{ hide_big_bar_class: isHideBar }\"\n                            >\n                                <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                                    <v-card outlined dense class=\"no_border\">\n                                        <h2 class=\"mb-0\">{{ $t(\"credit_memo\") }}</h2>\n                                        <v-icon\n                                            v-if=\"isHideBar\"\n                                            @click=\"cancel()\"\n                                            style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                                            class=\"float-right\"\n                                        >close\n                                        </v-icon>\n                                        <span\n                                            style=\"transition: .3s ease-in; z-index:10;\"\n                                            :class=\"{\n                        iconArrow: !isHideBar,\n                        iconArrowHide: isHideBar,\n                      }\"\n                                        >\n\n                                            <v-icon\n                                                size=\"22\"\n                                                class=\"arr_icon\"\n                                                @click=\"hideSmallSidebar\"\n                                                v-if=\"isHideBar\">mdi-chevron-left-circle\n                                            </v-icon>\n                                            <v-icon\n                                                size=\"22\"\n                                                class=\"arr_icon\"\n                                                @click=\"hideSmallSidebar\"\n                                                v-if=\"!isHideBar\">mdi-chevron-right-circle\n                                            </v-icon>\n                    </span>\n                                    </v-card>\n                                    <v-card outlined dense class=\"px-3 rounded-4 no_border\" color=\"grayBg\">\n                                        <v-row>\n                                            <v-col sm=\"4\" cols=\"12\" class=\"pt-4 pl-4\">\n                                                <label class=\"label  mb-0 mt-1\">{{\n                                                        $t(\"customer\")\n                                                    }}</label>\n                                                <v-col\n                                                    sm=\"12\"\n                                                    cols=\"12\"\n                                                    class=\"kendo_dropdown_custom pa-0 mt-1 pb-4\"\n                                                >\n                                                    <dropdownlist\n                                                        :data-items=\"customerList\"\n                                                        @change=\"onChange\"\n                                                        :value=\"customer\"\n                                                        :data-item-key=\"dataItemKey\"\n                                                        :text-field=\"textField\"\n                                                        :default-item=\"defaultItem\"\n                                                        :filterable=\"true\"\n                                                        @filterchange=\"onFilterChange\"\n                                                    >\n                                                    </dropdownlist>\n                                                </v-col>\n                                                <label class=\"label mb-0\">{{\n                                                        $t(\"reason_credit_note\")\n                                                    }}</label>\n                                                <v-textarea\n                                                    class=\"mt-1\"\n                                                    outlined\n                                                    :rules=\"[(v) => !!v || 'Reason is required']\"\n                                                    v-model=\"creditMemo.reason\"\n                                                    no-resize\n                                                    height=\"40px\"\n                                                />\n                                            </v-col>\n                                            <v-col sm=\"4\" cols=\"12\" class=\"pt-4 pr-4\">\n                                                <label class=\"label  mb-0\">{{ $t(\"date\") }}</label>\n                                                <app-datepicker\n                                                    :initialDate=\"transactionDate\"\n                                                    :disabled=\"disabledMe\"\n                                                    @onChanged=\"onPriceLevelChange\"\n                                                    @emitDate=\"transactionDate = $event\"\n                                                />\n                                                <label class=\"label mb-0\">{{\n                                                        $t(\"price_level\")\n                                                    }}</label>\n                                                <v-select\n                                                    class=\"mt-1\"\n                                                    v-model=\"creditMemo.priceLevel\"\n                                                    :items=\"priceLevel\"\n                                                    item-value=\"id\"\n                                                    @change=\"onPriceLevelChange\"\n                                                    item-text=\"name\"\n                                                    return-object\n                                                    placeholder=\"Price Level\"\n                                                    tage=\"Default Price Level\"\n                                                    outlined\n                                                />\n                                            </v-col>\n                                            <v-col sm=\"4\" cols=\"12\" class=\"pt-4 pr-4\">\n                                                <label class=\"label mb-0 mt-1\">{{\n                                                        $t(\"number\")\n                                                    }}</label>\n                                                <v-row class=\"mt-1 mr-0\">\n                                                    <v-col sm=\"3\" cols=\"3\" class=\"py-0 pr-0\">\n                                                        <div class=\"code_text text-bold\">\n                                                            {{ creditMemo.transactionType.abbr }}\n                                                        </div>\n                                                    </v-col>\n                                                    <v-col sm=\"7\" cols=\"7\" class=\"py-0 pl-0 pr-1\">\n                                                        <v-text-field\n                                                            class=\" custom-border \"\n                                                            v-model=\"creditMemo.number\"\n                                                            :disabled=\"true\"\n                                                            outlined\n                                                            :rules=\"[(v) => !!v || 'Number is required']\"\n                                                            required\n                                                        />\n                                                    </v-col>\n                                                    <v-col sm=\"2\" cols=\"2\" class=\"py-0 px-0\">\n                                                        <v-icon\n                                                            color=\"black\"\n                                                            size=\"30\"\n                                                            class=\"border_qrcode\"\n                                                            @click=\"generateNumber\"\n                                                        >mdi-qrcode\n                                                        </v-icon>\n                                                    </v-col>\n                                                </v-row>\n                                                <div class=\"d-flex justify-space-between\">\n                                                    <div>\n                                                        <p class=\"label mb-0\">{{ $t(\"currency\") }}</p>\n                                                        <p class=\"label mb-0 pt-3\">{{ currencyCode }}</p>\n                                                    </div>\n                                                    <div class=\"pl-3\">\n                                                        <p class=\"label mb-0 text-right\">\n                                                            {{ $t(\"rate\") }}\n                                                        </p>\n                                                        <v-text-field\n                                                            class=\"mt-1\"\n                                                            type=\"number\"\n                                                            v-model=\"creditMemo.txnRate\"\n                                                            outlined\n                                                            min=\"0.000000001\"\n                                                            step=\"0.5\"\n                                                            :rules=\"[\n                                (v) => !!v || 'Number is required',\n                                (v) =>\n                                  v > 0 || 'Number must be greater than 0!',\n                              ]\"\n                                                            required\n                                                        />\n                                                    </div>\n                                                </div>\n                                            </v-col>\n                                        </v-row>\n                                    </v-card>\n\n                                    <v-row class=\"pt-3\" style=\"background-color: #fff;\">\n                                        <v-col sm=\"12\" cols=\"12\" class=\"pt-0\">\n                                            <kendo-datasource\n                                                ref=\"itemLineDS\"\n                                                :data=\"itemLines\"\n                                                :change=\"dataSourceChanged\"\n                                            />\n                                            <kendo-grid\n                                                id=\"gridItemLine\"\n                                                class=\"grid-function\"\n                                                :data-source-ref=\"'itemLineDS'\"\n                                                :sortable=\"false\"\n                                                :column-menu=\"true\"\n                                                :editable=\"true\"\n                                                :noRecords=\"true\"\n                                                :scrollable-virtual=\"true\"\n                                            >\n                                                <kendo-grid-column\n                                                    :command=\"{\n                            iconClass: 'k-icon k-i-trash',\n                            text: ' ',\n                            click: removeRow,\n                            class: 'btn-plus',\n                          }\"\n                                                    :title=\"''\"\n                                                    :width=\"63\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :title=\"$t('no.')\"\n                                                    :width=\"53\"\n                                                    :column-menu=\"false\"\n                                                    :template=\"rowNumberTmpl\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5;',\n                            class: 'text-products',\n                          }\"\n                                                    :attributes=\"{\n                            style: 'text-align: products',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'item'\"\n                                                    :title=\"$t('item')\"\n                                                    :template=\"itemTemplate\"\n                                                    :editor=\"ItemDropDownEditor\"\n                                                    :width=\"200\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'description'\"\n                                                    :title=\"$t('description')\"\n                                                    :template=\"'<span>#=description#</span>'\"\n                                                    :hidden=\"true\"\n                                                    :width=\"160\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'qoh'\"\n                                                    :title=\"$t('on_hand')\"\n                                                    :template=\"qohTemplate\"\n                                                    :width=\"170\"\n                                                    :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: right; ' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'qty'\"\n                                                    :title=\"$t('qty')\"\n                                                    :template=\"'<span>#=qty#</span>'\"\n                                                    :width=\"80\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: right; ' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'uom'\"\n                                                    :title=\"$t('uom')\"\n                                                    :width=\"100\"\n                                                    :template=\"UOMTemplate\"\n                                                    :editor=\"UOMDropDownEditor\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{\n                            style: 'text-align: left',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'price'\"\n                                                    :title=\"$t('price')\"\n                                                    :width=\"200\"\n                                                    :template=\"priceTemplate\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{\n                            style: 'text-align: right',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'amount'\"\n                                                    :title=\"$t('amount')\"\n                                                    :headerTemplate=\"amountLineHeaderTemplate\"\n                                                    :width=\"200\"\n                                                    :editor=\"AmountEditor\"\n                                                    :template=\"amtTemplate\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{\n                            style: 'text-align: right',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'discountItem'\"\n                                                    :title=\"$t('discount_item')\"\n                                                    :width=\"200\"\n                                                    :template=\"discountItemTemplate\"\n                                                    :editor=\"DiscountItemDropDownEditor\"\n                                                    :hidden=\"true\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{\n                            style: 'text-align: left',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'vatTax'\"\n                                                    :title=\"$t('vat')\"\n                                                    :width=\"200\"\n                                                    :template=\"vatTemplate\"\n                                                    :editor=\"VatTaxDropDownEditor\"\n                                                    :hidden=\"true\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: left' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'specificTax'\"\n                                                    :title=\"$t('specific_tax')\"\n                                                    :width=\"200\"\n                                                    :template=\"\n                            '<span>#=specificTax.defaultTax?specificTax.defaultTax:``#</span>'\n                          \"\n                                                    :editor=\"SpecificTaxDropDownEditor\"\n                                                    :hidden=\"true\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: left' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'otherTax'\"\n                                                    :title=\"$t('other_tax')\"\n                                                    :width=\"200\"\n                                                    :template=\"\n                            '<span>#=otherTax.defaultTax?otherTax.defaultTax:``#</span>'\n                          \"\n                                                    :editor=\"OtherTaxDropDownEditor\"\n                                                    :hidden=\"true\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: left' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'publicLightingTax'\"\n                                                    :title=\"$t('pl_tax')\"\n                                                    :width=\"200\"\n                                                    :template=\"\n                            '<span>#=publicLightingTax.defaultTax?publicLightingTax.defaultTax:``#</span>'\n                          \"\n                                                    :editor=\"PublicLightingTaxDropDownEditor\"\n                                                    :hidden=\"true\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: left' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'otherCharge'\"\n                                                    :title=\"$t('other_charge')\"\n                                                    :width=\"200\"\n                                                    :hidden=\"true\"\n                                                    :template=\"'<span>#=otherCharge.name || ``#'\"\n                                                    :editor=\"OtherChargeDropDownEditor\"\n                                                    :headerAttributes=\"{style:'text-align: left; background-color: #EDF1F5'}\"\n                                                    :attributes=\"{ style: 'text-align: left' }\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'saleUnit'\"\n                                                    :title=\"$t('sale_unit')\"\n                                                    :width=\"200\"\n                                                    :template=\"saleUnitTemplate\"\n                                                    :editor=\"SaleUnitDropDownEditor\"\n                                                    :hidden=\"true\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: left' }\"\n                                                />\n                                            </kendo-grid>\n                                        </v-col>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                            <v-row>\n                                                <v-col sm=\"7\" cols=\"12\" class=\"py-0\">\n                                                    <v-btn\n                                                        class=\"float-left btn_plus mr-2\"\n                                                        @click=\"addRow\"\n                                                    >\n                                                        <v-icon size=\"\" class=\"ma-1\">mdi-plus</v-icon>\n                                                    </v-btn>\n                                                </v-col>\n                                                <v-col sm=\"5\" cols=\"12\" class=\"py-0\">\n                                                    <v-simple-table>\n                                                        <template v-slot:default>\n                                                            <tbody>\n                                                            <tr hidden=\"true\">\n                                                                <td class=\"text-left\">\n                                                                    {{ $t(\"subtotal\") }}\n                                                                </td>\n                                                                <td class=\"text-center\">:</td>\n                                                                <td class=\"text-right\">\n                                                                    {{ numberFormat(creditMemo.subTotal) }}\n                                                                </td>\n                                                            </tr>\n                                                            <tr hidden=\"true\">\n                                                                <td class=\"text-left\">\n                                                                    {{ $t(\"discount\") }}\n                                                                </td>\n                                                                <td class=\"text-center\">:</td>\n                                                                <td class=\"text-right\">\n                                                                    ({{ numberFormat(creditMemo.discount) }})\n                                                                </td>\n                                                            </tr>\n                                                            <tr hidden=\"true\">\n                                                                <td class=\"text-left\">\n                                                                    {{ $t(\"total_tax\") }}\n                                                                </td>\n\n                                                                <td class=\"text-center\">:</td>\n                                                                <td class=\"text-right\">\n                                                                    {{ numberFormat(creditMemo.taxAmount) }}\n                                                                </td>\n                                                            </tr>\n                                                            <tr>\n                                                                <td class=\"text-left text-uppercase\">\n                                                                    {{ $t(\"total\") }}\n                                                                </td>\n                                                                <td class=\"text-center\">:</td>\n                                                                <td\n                                                                    class=\"text-right primary--text text-bold\"\n                                                                >\n                                                                    {{\n                                                                        numberFormat(\n                                                                            creditMemo.itemLineExchangeAmount\n                                                                        )\n                                                                    }}\n                                                                </td>\n                                                            </tr>\n                                                            </tbody>\n                                                        </template>\n                                                    </v-simple-table>\n                                                </v-col>\n                                            </v-row>\n                                        </v-col>\n                                    </v-row>\n                                    <v-row>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                            <v-col sm=\"12\" cols=\"12\" class=\"pt-0\">\n                                                <h3 class=\"mb-0 text-uppercase color_grey mb-3\">\n                                                    {{ $t(\"apply_to\") }}\n                                                </h3>\n                                                <label class=\"label font_14\">{{\n                                                        $t(\"invoice_to_be_offset\")\n                                                    }}</label>\n                                                <v-select\n                                                    class=\" mt-1\"\n                                                    v-model=\"offsetInvoice\"\n                                                    :items=\"offsetInvoices\"\n                                                    @change=\"offsetInvoiceChanged\"\n                                                    :item-text=\"(item) => `${item.referenceNo} - ${status(item.status)}`\"\n                                                    item-value=\"id\"\n                                                    return-object\n                                                    tage=\"Offset Invoice\"\n                                                    placeholder=\"Offset Invoice\"\n                                                    :loading=\"isLoading === 1\"\n                                                    :rules=\"[(v) => !!v || 'is required']\"\n                                                    outlined\n                                                />\n                                                <kendo-datasource\n                                                    ref=\"applyToLineDS\"\n                                                    :data=\"offsetList\"\n                                                    :change=\"onApplyToLineChange\"/>\n                                                <kendo-grid\n                                                    id=\"gridApplyTo\"\n                                                    ref=\"gridApplyTo\"\n                                                    class=\"grid-function\"\n                                                    :data-source-ref=\"'applyToLineDS'\"\n                                                    :sortable=\"false\"\n                                                    :filterable=\"false\"\n                                                    :column-menu=\"true\"\n                                                    :editable=\"true\"\n                                                    :noRecords=\"true\"\n                                                    :scrollable-virtual=\"true\"\n                                                >\n                                                    <!--                                                    <kendo-grid-norecords>-->\n                                                    <!--                                                        <div class=\"k-loading-mask customPosition\"><span-->\n                                                    <!--                                                            class='k-loading-text'></span>-->\n                                                    <!--                                                            <div class='k-loading-image'/>-->\n                                                    <!--                                                            <div class='k-loading-color'/>-->\n                                                    <!--                                                        </div>-->\n                                                    <!--                                                    </kendo-grid-norecords>-->\n                                                    <kendo-grid-column\n                                                        :title=\"$t('no')\"\n                                                        :template=\"rowNumberTmplApply\"\n                                                        :width=\"55\"\n                                                        :editable=\"\n                              () => {\n                                return false;\n                              }\n                            \"\n                                                        :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5;',\n                              class: 'text-products',\n                            }\"\n                                                        :attributes=\"{ style: 'text-align: left' }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'referenceNo'\"\n                                                        :title=\"$t('number')\"\n                                                        :width=\"200\"\n                                                        :editable=\"\n                              () => {\n                                return false;\n                              }\n                            \"\n                                                        :template=\"'<span>#=referenceNo||``#</span>'\"\n                                                        :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'paymentCode'\"\n                                                        :title=\"$t('prc')\"\n                                                        :editable=\"\n                              () => {\n                                return false;\n                              }\n                            \"\n                                                        :width=\"200\"\n                                                        :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'currencyCode'\"\n                                                        :title=\"$t('currency')\"\n                                                        :width=\"200\"\n                                                        :editable=\"\n                              () => {\n                                return false;\n                              }\n                            \"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{ style: 'text-align: right' }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'amount'\"\n                                                        :title=\"$t('amount')\"\n                                                        :width=\"200\"\n                                                        :template=\"\n                              '<span>#=kendo.toString(amount || 0, decimalFormat)#</span>'\n                            \"\n                                                        :editable=\"\n                              () => {\n                                return false;\n                              }\n                            \"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{ style: 'text-align: right' }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'txnRate'\"\n                                                        :title=\"$t('rate')\"\n                                                        :width=\"200\"\n                                                        :hidden=\"true\"\n                                                        :editable=\"\n                              () => {\n                                return false;\n                              }\n                            \"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{ style: 'text-align: right' }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'paidAmount'\"\n                                                        :title=\"$t('offset_amount')\"\n                                                        :editor=\"AmountEditor\"\n                                                        :width=\"200\"\n                                                        :template=\"\n                              '<span>#=kendo.toString(paidAmount || 0, decimalFormat)#</span>'\n                            \"\n                                                        :editable=\"\n                              () => {\n                                return true;\n                              }\n                            \"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{ style: 'text-align: right' }\"\n                                                    />\n                                                </kendo-grid>\n                                                <v-row>\n                                                    <v-col sm=\"7\" cols=\"7\" class=\"pt-0\"></v-col>\n                                                    <v-col sm=\"5\" cols=\"5\" class=\"pt-0\">\n                                                        <v-simple-table>\n                                                            <template v-slot:default>\n                                                                <tbody>\n                                                                <tr>\n                                                                    <td class=\"text-left text-uppercase\">\n                                                                        {{ $t(\"total\") }}\n                                                                    </td>\n                                                                    <td class=\"text-center\">:</td>\n                                                                    <td\n                                                                        class=\"text-right primary--text text-bold\"\n                                                                    >\n                                                                        {{\n                                                                            numberFormat(\n                                                                                creditMemo.applyToExchangeAmount\n                                                                            )\n                                                                        }}\n                                                                    </td>\n                                                                </tr>\n                                                                </tbody>\n                                                            </template>\n                                                        </v-simple-table>\n                                                    </v-col>\n                                                </v-row>\n                                            </v-col>\n                                            <v-col sm=\"12\" cols=\"12\" class=\"pt-0\">\n                                                <h3 class=\"mb-0 text-uppercase color_grey mb-3\">\n                                                    {{ $t(\"customer_credit\") }}\n                                                </h3>\n                                                <kendo-datasource\n                                                    ref=\"depositLineDS\"\n                                                    :data=\"depositLines\"\n                                                    :change=\"onDepositLineDSChange\"\n                                                />\n                                                <kendo-grid\n                                                    id=\"gridDeposit\"\n                                                    ref=\"gridDeposit\"\n                                                    class=\"grid-function\"\n                                                    :data-source-ref=\"'depositLineDS'\"\n                                                    :sortable=\"false\"\n                                                    :filterable=\"false\"\n                                                    :column-menu=\"true\"\n                                                    :editable=\"true\"\n                                                    :noRecords=\"true\"\n                                                    :scrollable-virtual=\"true\"\n                                                >\n                                                    <kendo-grid-column\n                                                        :field=\"'account'\"\n                                                        :title=\"$t('account')\"\n                                                        :width=\"200\"\n                                                        :editable=\"()=>{ return true}\"\n                                                        :editor=\"AccountDropDownEditorDeposit\"\n                                                        :template=\"'<span>#=account.name||``#</span>'\"\n                                                        :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'description'\"\n                                                        :title=\"$t('description')\"\n                                                        :width=\"200\"\n                                                        :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'amount'\"\n                                                        :title=\"$t('amount')\"\n                                                        :width=\"200\"\n                                                        :headerTemplate=\"amountLineHeaderTemplate\"\n                                                        :editor=\"AmountEditor\"\n                                                        :template=\"amountTemplate\"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{ style: 'text-align: right' }\"\n                                                    />\n                                                </kendo-grid>\n                                            </v-col>\n\n                                            <v-col sm=\"12\" cols=\"12\" class=\"pt-0\">\n                                                <h3 class=\"mb-0 text-uppercase color_grey mb-3\">\n                                                    {{ $t(\"cash_refund\") }}\n                                                </h3>\n                                                <kendo-datasource\n                                                    ref=\"cashRefundDS\"\n                                                    :change=\"onCashRefundChange\"\n                                                    :data=\"cashRefundLines\"\n                                                />\n                                                <kendo-grid\n                                                    id=\"gridCashRefund\"\n                                                    class=\"grid-function\"\n                                                    :data-source-ref=\"'cashRefundDS'\"\n                                                    :sortable=\"false\"\n                                                    :filterable=\"false\"\n                                                    :column-menu=\"true\"\n                                                    :editable=\"true\"\n                                                    :scrollable-virtual=\"true\">\n                                                    <kendo-grid-column\n                                                        :field=\"'paymentOption'\"\n                                                        :title=\"$t('payment_option')\"\n                                                        :width=\"250\"\n                                                        :template=\"methodTemplate\"\n                                                        :editor=\"PaymentOptionEditor\"\n                                                        :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'account'\"\n                                                        :title=\"$t('account')\"\n                                                        :width=\"200\"\n                                                        :template=\"accountTemplate\"\n                                                        :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'description'\"\n                                                        :title=\"$t('description')\"\n                                                        :width=\"200\"\n                                                        :template=\"'<span>#=description#</span>'\"\n                                                        :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'refNo'\"\n                                                        :title=\"$t('payment_ref')\"\n                                                        :width=\"200\"\n                                                        :hidden=\"true\"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{\n                              style: 'text-align: right',\n                            }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'amount'\"\n                                                        :title=\"$t('amount')\"\n                                                        :headerTemplate=\"amountLineHeaderTemplate\"\n                                                        :width=\"200\"\n                                                        :template=\"amountTemplate\"\n                                                        :editor=\"AmountEditor\"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{\n                              style: 'text-align: right',\n                            }\"\n                                                    />\n                                                </kendo-grid>\n                                            </v-col>\n                                        </v-col>\n                                    </v-row>\n                                    <v-row class=\"pt-3\" style=\"background-color: #fff;\">\n                                        <!--                                        <v-col sm=\"12\" cols=\"12\" class=\"pt-0\">-->\n                                        <!--                                            <kendo-datasource-->\n                                        <!--                                                ref=\"accountLineDS\"-->\n                                        <!--                                                :data=\"accountLines\"-->\n                                        <!--                                                :change=\"onAccountLineDSChanged\"/>-->\n                                        <!--                                            <kendo-grid-->\n                                        <!--                                                id=\"gridAccountLine\"-->\n                                        <!--                                                ref=\"gridAccountLine\"-->\n                                        <!--                                                class=\"grid-function\"-->\n                                        <!--                                                :data-source-ref=\"'accountLineDS'\"-->\n                                        <!--                                                :sortable=\"false\"-->\n                                        <!--                                                :filterable=\"false\"-->\n                                        <!--                                                :column-menu=\"true\"-->\n                                        <!--                                                :editable=\"true\"-->\n                                        <!--                                                :noRecords=\"true\"-->\n                                        <!--                                                :scrollable-virtual=\"true\">-->\n                                        <!--                                                <kendo-grid-column-->\n                                        <!--                                                    :title=\"$t('no.')\"-->\n                                        <!--                                                    :template=\"rowNumberTmplAcc\"-->\n                                        <!--                                                    :width=\"55\"-->\n                                        <!--                                                    :column-menu=\"false\"-->\n                                        <!--                                                    :headerAttributes=\"{ style: 'background-color: #EDF1F5;',class: 'text-products', }\"-->\n                                        <!--                                                    :attributes=\"{  style: 'text-align: products', }\"/>-->\n                                        <!--                                                <kendo-grid-column-->\n                                        <!--                                                    :field=\"'account'\"-->\n                                        <!--                                                    :title=\"$t('account')\"-->\n                                        <!--                                                    :width=\"200\"-->\n                                        <!--                                                    :template=\"accountTemplate\"-->\n                                        <!--                                                    :editor=\"AccountDropDownEditor\"-->\n                                        <!--                                                    :headerAttributes=\"{  style: 'background-color: #EDF1F5', }\"/>-->\n                                        <!--                                                <kendo-grid-column-->\n                                        <!--                                                    :field=\"'description'\"-->\n                                        <!--                                                    :title=\"$t('description')\"-->\n                                        <!--                                                    :width=\"200\"-->\n                                        <!--                                                    :headerAttributes=\"{ style: 'background-color: #EDF1F5', }\"/>-->\n                                        <!--                                                <kendo-grid-column-->\n                                        <!--                                                    :field=\"'amount'\"-->\n                                        <!--                                                    :title=\"$t('amount')\"-->\n                                        <!--                                                    :format=\"'{0:n}'\"-->\n                                        <!--                                                    :width=\"150\"-->\n                                        <!--                                                    :editor=\"AmountEditor\"-->\n                                        <!--                                                    :headerAttributes=\"{ style: 'text-align: right; background-color: #EDF1F5', }\"-->\n                                        <!--                                                    :attributes=\"{ style: 'text-align: right',  }\"/>-->\n                                        <!--                                                <kendo-grid-column-->\n                                        <!--                                                    :field=\"'discountItem'\"-->\n                                        <!--                                                    :title=\"$t('discount')\"-->\n                                        <!--                                                    :template=\"'<span>#=discountItem.name||``#</span>'\"-->\n                                        <!--                                                    :editor=\"DiscountItemDropDownEditor\"-->\n                                        <!--                                                    :width=\"150\"-->\n                                        <!--                                                    :headerAttributes=\"{ style: 'text-align: right; background-color: #EDF1F5',  }\"-->\n                                        <!--                                                    :attributes=\"{  style: 'text-align: right',  }\"/>-->\n                                        <!--                                                <kendo-grid-column-->\n                                        <!--                                                    :field=\"'vatTax'\"-->\n                                        <!--                                                    :title=\"$t('tax')\"-->\n                                        <!--                                                    :template=\"'<span>#=vatTax.defaultTax||``#</span>'\"-->\n                                        <!--                                                    :editor=\"VatTaxDropDownEditor\"-->\n                                        <!--                                                    :width=\"150\"-->\n                                        <!--                                                    :headerAttributes=\"{ style:'text-align: right; background-color: #EDF1F5', }\"-->\n                                        <!--                                                    :attributes=\"{  style: 'text-align: right', }\"/>-->\n                                        <!--                                                <kendo-grid-column-->\n                                        <!--                                                    :command=\"{ iconClass: 'k-icon k-i-trash', text: 'Delete', click: removeRowAcc, class: 'btn-plus', }\"-->\n                                        <!--                                                    :title=\"$t('action')\"-->\n                                        <!--                                                    :width=\"100\"-->\n                                        <!--                                                    :headerAttributes=\"{ style:'text-align: right; background-color: #EDF1F5', }\"/>-->\n                                        <!--                                            </kendo-grid>-->\n                                        <!--                                        </v-col>-->\n                                        <v-col sm=\"12\" cols=\"12\" class=\"pb-0\">\n                                            <v-row>\n                                                <!--                                                <v-col sm=\"9\" cols=\"12\" class=\"\">-->\n                                                <!--                                                    <v-btn class=\"float-left btn_plus mr-2 rounded-0\"-->\n                                                <!--                                                           @click=\"addRowAcc\">-->\n                                                <!--                                                        <v-icon size=\"\" class=\"ma-1\">mdi-plus</v-icon>-->\n                                                <!--                                                    </v-btn>-->\n                                                <!--                                                    &lt;!&ndash;                                                    <v-btn class=\"float-left add_account mr-2 rounded-0 white&#45;&#45;text\"&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                           to=\"add_item\">&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                        {{ $t('add_account') }}&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                    </v-btn>&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                    <v-btn&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                        class=\"float-left add_account mr-2  rounded-0 btn_save_draft\">&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                        {{ $t('sub_total') }}&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                    </v-btn>&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                    <template>&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                        <v-file-input class=\"mt-0 pt-0 \" sm=\"3\" cols=\"6\"&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                                      v-model=\"files\"&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                                      :placeholder=\"$t('attachment')\"&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                                      multiple&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                                      prepend-icon=\"mdi-paperclip\"&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                        >&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                            <template v-slot:selection=\"{ text }\">&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                                <v-chip&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                                    small&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                                    label&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                                    color=\"primary\"&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                                >&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                                    {{ text }}&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                                </v-chip>&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                            </template>&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                        </v-file-input>&ndash;&gt;-->\n                                                <!--                                                    &lt;!&ndash;                                                    </template>&ndash;&gt;-->\n                                                <!--                                                </v-col>-->\n\n                                                <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                                    <v-row>\n                                                        <v-col sm=\"6\" cols=\"6\" class=\"pt-0\">\n                                                            <v-card class=\"no-boxshadow pa-3\" color=\"grayBg\">\n                                                                <v-row>\n                                                                    <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                                                        <label>{{ $t(\"message_on_memo\") }}</label>\n                                                                        <v-textarea\n                                                                            class=\"mt-1\"\n                                                                            v-model=\"creditMemo.transactionNote\"\n                                                                            outlined\n                                                                            no-resize\n                                                                            height=\"70px\"\n                                                                            tage=\"Memo Message\"\n                                                                            placeholder=\"This will appear on the Credit Memo\"\n                                                                        />\n                                                                        <label>{{\n                                                                                $t(\"message_for_journal\")\n                                                                            }}</label>\n                                                                        <v-textarea\n                                                                            class=\"mt-1\"\n                                                                            v-model=\"creditMemo.journalNote\"\n                                                                            outlined\n                                                                            no-resize\n                                                                            height=\"70px\"\n                                                                            tage=\"Message on Order\"\n                                                                            placeholder=\"This will appear on the journal\"\n                                                                        />\n                                                                    </v-col>\n                                                                </v-row>\n                                                            </v-card>\n                                                        </v-col>\n                                                        <v-col sm=\"6\" cols=\"6\" class=\"pt-0\">\n                                                            <v-simple-table>\n                                                                <template v-slot:default>\n                                                                    <tbody>\n                                                                    <tr>\n                                                                        <td class=\"text-left\">\n                                                                            {{ $t(\"amount_return\") }} ({{\n                                                                                currencyCode\n                                                                            }})\n                                                                        </td>\n                                                                        <td class=\"text-center\">:</td>\n                                                                        <td class=\"text-right\">\n                                                                            {{\n                                                                                numberFormat(\n                                                                                    creditMemo.itemLineAmount\n                                                                                )\n                                                                            }}\n                                                                        </td>\n                                                                    </tr>\n                                                                    <tr>\n                                                                        <td class=\"text-left\">\n                                                                            {{ $t(\"offset_amount\") }} ({{\n                                                                                currencyCode\n                                                                            }})\n                                                                        </td>\n                                                                        <td class=\"text-center\">:</td>\n                                                                        <td class=\"text-right\">\n                                                                            {{ numberFormat(creditMemo.amount) }}\n                                                                        </td>\n                                                                    </tr>\n                                                                    <tr>\n                                                                        <td class=\"text-left\">\n                                                                            {{ $t(\"amount_return\") }} ({{\n                                                                                baseCurrencyCode\n                                                                            }})\n                                                                        </td>\n                                                                        <td class=\"text-center\">:</td>\n                                                                        <td class=\"text-right\">\n                                                                            {{\n                                                                                numberFormat(\n                                                                                    creditMemo.itemLineExchangeAmount\n                                                                                )\n                                                                            }}\n                                                                        </td>\n                                                                    </tr>\n                                                                    <tr>\n                                                                        <td class=\"text-left\">\n                                                                            {{ $t(\"offset_amount\") }} ({{\n                                                                                baseCurrencyCode\n                                                                            }})\n                                                                        </td>\n                                                                        <td class=\"text-center\">:</td>\n                                                                        <td class=\"text-right\">\n                                                                            {{\n                                                                                numberFormat(\n                                                                                    creditMemo.exchangeAmount\n                                                                                )\n                                                                            }}\n                                                                        </td>\n                                                                    </tr>\n                                                                    <tr>\n                                                                        <td class=\"text-left\">\n                                                                            {{ $t(\"variance\") }}\n                                                                            <v-select\n                                                                                class=\"mt-1\"\n                                                                                v-model=\"creditMemo.varianceAcc\"\n                                                                                :items=\"varianceAccs\"\n                                                                                item-value=\"id\"\n                                                                                :item-text=\"\n                                            (item) =>\n                                              `${item.number} - ${item.name}`\n                                          \"\n                                                                                @change=\"onVarianceAccChanged\"\n                                                                                return-object\n                                                                                tage=\"variance account\"\n                                                                                placeholder=\"account\"\n                                                                                clearable\n                                                                                outlined=\"\"\n                                                                            />\n                                                                        </td>\n                                                                        <td class=\"text-center\">:</td>\n                                                                        <td class=\"text-right\">\n                                                                            {{\n                                                                                numberFormat(creditMemo.exchangeVariance)\n                                                                            }}\n                                                                        </td>\n                                                                    </tr>\n                                                                    <tr hidden>\n                                                                        <td class=\"text-left\">{{ $t(\"dr\") }}</td>\n                                                                        <td class=\"text-center\">:</td>\n                                                                        <td class=\"text-right\">\n                                                                            {{ numberFormat(dr) }}\n                                                                        </td>\n                                                                    </tr>\n                                                                    <tr hidden>\n                                                                        <td class=\"text-left\">{{ $t(\"cr\") }}</td>\n                                                                        <td class=\"text-center\">:</td>\n                                                                        <td class=\"text-right\">\n                                                                            {{ numberFormat(cr) }}\n                                                                        </td>\n                                                                    </tr>\n                                                                    </tbody>\n                                                                </template>\n                                                            </v-simple-table>\n                                                        </v-col>\n                                                    </v-row>\n                                                </v-col>\n                                            </v-row>\n                                        </v-col>\n                                    </v-row>\n\n                                    <v-divider/>\n\n                                    <v-card outlined dense class=\"no_border function_footer\">\n                                        <v-alert type=\"warning\" v-model=\"alert\" dismissible>\n                                            <span v-html=\"errorMessage\"/>\n                                        </v-alert>\n                                        <v-menu>\n                                            <template v-slot:activator=\"{ on }\">\n                                                <v-btn\n                                                    class=\"mr-2  float-left select_template rounded-0\"\n                                                    v-on=\"on\"\n                                                >\n                                                    {{ $t(\"select_template\") }}\n                                                    <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>\n                                                </v-btn>\n                                            </template>\n                                            <v-list>\n                                                <v-list-item\n                                                    v-for=\"(item, index) in templates\"\n                                                    :key=\"index\"\n                                                >\n                                                    <v-list-item-title>{{\n                                                            item.title\n                                                        }}\n                                                    </v-list-item-title>\n                                                </v-list-item>\n                                            </v-list>\n                                        </v-menu>\n                                        <v-btn\n                                            color=\"primary\"\n                                            outlined\n                                            class=\"float-left  black--text text-capitalize\"\n                                            @click=\"cancel\"\n                                        >{{ $t(\"cancel\") }}\n                                        </v-btn>\n                                        <!--                    <v-menu>-->\n                                        <!--                      <template v-slot:activator=\"{ on }\">-->\n                                        <!--                        <v-btn color=\"primary\"-->\n                                        <!--                               class=\"ml-2  float-right white&#45;&#45;text text-capitalize\" v-on=\"on\">-->\n                                        <!--                          {{ $t('save_option') }}-->\n                                        <!--                          <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>-->\n                                        <!--                        </v-btn>-->\n                                        <!--                      </template>-->\n                                        <!--                      <v-list rounded>-->\n                                        <!--                        <v-list-item-group>-->\n                                        <!--                          <v-list-item>-->\n                                        <!--                            <v-list-item-content>-->\n                                        <!--                              <v-list-item-title>-->\n                                        <!--                                {{ $t('save_new') }}-->\n                                        <!--                              </v-list-item-title>-->\n                                        <!--                            </v-list-item-content>-->\n                                        <!--                          </v-list-item>-->\n                                        <!--                          <v-list-item>-->\n                                        <!--                            <v-list-item-content>-->\n                                        <!--                              <v-list-item-title>{{ $t('save_draft') }}-->\n                                        <!--                              </v-list-item-title>-->\n                                        <!--                            </v-list-item-content>-->\n                                        <!--                          </v-list-item>-->\n                                        <!--                        </v-list-item-group>-->\n                                        <!--                      </v-list>-->\n                                        <!--                    </v-menu>-->\n                                        <v-btn\n                                            color=\"primary\"\n                                            @click=\"onSaveClose('close')\"\n                                            class=\"float-right  white--text text-capitalize\">{{ $t(\"save_close\") }}\n                                        </v-btn>\n                                        <v-btn color=\"secondary\"\n                                               style=\"margin-right: 10px !important\"\n                                               class=\"white--text float-right text-capitalize\"\n                                               @click=\"onSaveClose('new')\" :hidden=\"hiddenButton\">{{ $t(\"save_new\") }}\n                                        </v-btn>\n                                    </v-card>\n                                </v-form>\n                            </v-col>\n\n                            <v-col\n                                class=\"smallSide\"\n                                sm=\"4\"\n                                style=\"transition: .3s ease-in;\"\n                                :class=\"{ hide_small_bar_class: isHideBar }\"\n                            >\n                                <h3\n                                    style=\"color: #b3b5bc; font-size:20px;\"\n                                    v-if=\"!isHideBar\"\n                                    class=\"text-uppercase float-right mt-n3\"\n                                >\n                  <span class=\"pointer\" @click=\"Help('credit memo')\">\n                    {{ $t(\"help\") }}\n                  </span>\n                                    <v-icon\n                                        @click=\"cancel()\"\n                                        style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                                        class=\"float-right mt-n1\"\n                                    >close\n                                    </v-icon>\n                                </h3>\n\n                                <div\n                                    v-if=\"!isHideBar\"\n                                    class=\"small_sidebar rounded-4 mt-8 px-4 pt-4 grayBg\"\n                                >\n                                    <v-card outlined dense class=\"pa-3 no_border my_card rounded-4 white--text\"\n                                            color=\"primary\" height=\"60px\">\n                                        <h3 class=\"text-left font_13 flex-1 text-uppercase\">{{\n                                                $t('offset_amount')\n                                            }}</h3>\n                                        <h3 class=\"text-right flex-1 font_20 niradei_heavy\">\n                                            {{ numberFormat(creditMemo.exchangeAmount) }}</h3>\n                                    </v-card>\n                                    <v-row>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"pt-5\">\n                                            <!-- <h4 class=\"text-uppercase mb-1\">{{ $t('analysis') }}</h4> -->\n                                            <label class=\"label mb-0\">{{ $t(\"segment\") }}</label>\n                                            <v-select\n                                                class=\"mt-1\"\n                                                v-model=\"creditMemo.segment\"\n                                                :items=\"segments\"\n                                                item-value=\"id\"\n                                                :disabled=\"true\"\n                                                :item-text=\"(item) => `${item.code} - ${item.name}`\"\n                                                return-object\n                                                tage=\"sub Of\"\n                                                placeholder=\"Sub Of\"\n                                                outlined=\"\"\n                                            />\n                                            <label class=\"label mb-0\">{{ $t(\"location\") }}</label>\n                                            <v-select\n                                                class=\"mt-1\"\n                                                v-model=\"creditMemo.location\"\n                                                :items=\"locations\"\n                                                item-value=\"id\"\n                                                :disabled=\"true\"\n                                                :item-text=\"(item) => `${item.code} - ${item.name}`\"\n                                                return-object\n                                                tage=\"Location\"\n                                                placeholder=\"bu/location\"\n                                                outlined=\"\"\n                                            />\n                                            <label class=\"label font_14\">{{ $t(\"project\") }}</label>\n                                            <v-select\n                                                class=\" mt-1\"\n                                                v-model=\"creditMemo.project\"\n                                                :items=\"customerProjects\"\n                                                :item-text=\"(item) => `${item.code} - ${item.name}`\"\n                                                item-value=\"id\"\n                                                :disabled=\"true\"\n                                                tage=\"Customer Project\"\n                                                placeholder=\"project\"\n                                                outlined\n                                            />\n                                            <label class=\"label font_14\">{{ $t(\"employee\") }}</label>\n                                            <v-col\n                                                sm=\"12\"\n                                                cols=\"12\"\n                                                class=\"kendo_dropdown_custom pl-0 pb-3 pt-0\"\n                                            >\n                                                <dropdownlist\n                                                    :data-items=\"employees\"\n                                                    @change=\"onEmployeeChanged\"\n                                                    :value=\"mEmployee\"\n                                                    :data-item-key=\"'id'\"\n                                                    :text-field=\"'name'\"\n                                                    :default-item=\"defaultItem\"\n                                                    :filterable=\"true\"\n                                                    @filterchange=\"onEmployeeFilterChanged\"\n                                                >\n                                                </dropdownlist>\n                                            </v-col>\n                                        </v-col>\n                                    </v-row>\n                                    <v-divider class=\"mb-3\"/>\n                                    <!--                                    <v-card class=\"pa-3 mb-2 no-boxshadow\"-->\n                                    <!--                                            style=\"min-height: 70px; background-color: #ffffff !important;\">-->\n                                    <!--                                        &lt;!&ndash;                                        <h3 class=\"text-uppercase mb-2 font_18\">{{ $t('offset_amount') }}</h3>&ndash;&gt;-->\n                                    <!--                                        &lt;!&ndash;                                        <h3 class=\"text-bold float-right\" style=\"font-size: 22px\">200</h3>&ndash;&gt;-->\n                                    <!--                                    </v-card>-->\n                                    <!--                                    <v-row>-->\n                                    <!--                                        <v-col sm=\"12\" cols=\"12\" class=\"pt-1\">-->\n                                    <!--                                            <label-->\n                                    <!--                                                class=\"label text-bold text-uppercase font_14\">{{-->\n                                    <!--                                                    $t('invoice_to_offset')-->\n                                    <!--                                                }}</label>-->\n                                    <!--                                            <v-select class=\" mt-1\"-->\n                                    <!--                                                      :items=\"transaction\"-->\n                                    <!--                                                      :rules=\"[v => !!v || 'Payble Account is required']\"-->\n                                    <!--                                                      return-object-->\n                                    <!--                                                      tage=\"Invoice to Offset\"-->\n                                    <!--                                                      outlined-->\n                                    <!--                                            >-->\n                                    <!--                                                <template v-slot:item=\"{ item }\">-->\n                                    <!--                                                    <p class=\"d-block text-center\">{{ item.id }}. {{ item.name }}</p>-->\n                                    <!--                                                    <br>-->\n                                    <!--                                                    <div class=\"item_list d-flex\">-->\n                                    <!--                                                        <span>-->\n                                    <!--                                                            {{ item.no }}-->\n                                    <!--                                                        </span>-->\n                                    <!--                                                        <v-btn>Add</v-btn>-->\n                                    <!--                                                    </div>-->\n                                    <!--                                                </template>-->\n                                    <!--                                            </v-select>-->\n\n                                    <!--                                            <v-row>-->\n                                    <!--                                                <v-col sm=\"9\" cols=\"9\" class=\"py-1 pr-0\">-->\n                                    <!--                                                    <v-card outlined-->\n                                    <!--                                                            class=\"px-3 py-1 text-white no-boxshadow no_border justify-left d-flex\"-->\n                                    <!--                                                            style=\"background-color: #92d050; height: 30px\">-->\n                                    <!--                                                        <input type=\"checkbox\" class=\"checkbox_inv float-left\"/>-->\n                                    <!--                                                        <p class=\"mb-0\" style=\"width: 100%\">-->\n                                    <!--                                                            <span class=\"pl-3 float-left\">No. 00224</span>-->\n                                    <!--                                                            <span class=\"float-right\">2,500.00</span>-->\n                                    <!--                                                        </p>-->\n                                    <!--                                                    </v-card>-->\n                                    <!--                                                </v-col>-->\n                                    <!--                                                <v-col sm=\"3\" cols=\"3\" class=\"py-1  pl-1\">-->\n                                    <!--                                                    <v-btn-->\n                                    <!--                                                        class=\"text-white text-bold rounded-0 float-right text-uppercase\"-->\n                                    <!--                                                        style=\"height: 30px !important; background-color: rgb(0, 176, 80) !important\">-->\n                                    <!--                                                        {{ $t('add') }}-->\n                                    <!--                                                    </v-btn>-->\n                                    <!--                                                </v-col>-->\n                                    <!--                                            </v-row>-->\n                                    <!--                                            <v-row>-->\n                                    <!--                                                <v-col sm=\"9\" cols=\"9\" class=\"py-1 pr-0\">-->\n                                    <!--                                                    <v-card outlined-->\n                                    <!--                                                            class=\"px-3 py-1 text-white no-boxshadow no_border justify-left d-flex\"-->\n                                    <!--                                                            style=\"background-color: #92d050; height: 30px\">-->\n                                    <!--                                                        <input type=\"checkbox\" class=\"checkbox_inv float-left\"/>-->\n                                    <!--                                                        <p class=\"mb-0\" style=\"width: 100%\">-->\n                                    <!--                                                            <span class=\"pl-3 float-left\">No. 00224</span>-->\n                                    <!--                                                            <span class=\"float-right\">2,500.00</span>-->\n                                    <!--                                                        </p>-->\n                                    <!--                                                    </v-card>-->\n                                    <!--                                                </v-col>-->\n                                    <!--                                                <v-col sm=\"3\" cols=\"3\" class=\"py-1  pl-1\">-->\n                                    <!--                                                    <v-btn-->\n                                    <!--                                                        class=\"text-white text-bold rounded-0 float-right text-uppercase\"-->\n                                    <!--                                                        style=\"height: 30px !important; background-color: rgb(0, 176, 80) !important\">-->\n                                    <!--                                                        {{ $t('add') }}-->\n                                    <!--                                                    </v-btn>-->\n                                    <!--                                                </v-col>-->\n                                    <!--                                            </v-row>-->\n                                    <!--                                            <v-row>-->\n                                    <!--                                                <v-col sm=\"9\" cols=\"9\" class=\"py-1 pr-0\">-->\n                                    <!--                                                    <v-card outlined-->\n                                    <!--                                                            class=\"px-3 py-1 text-white no-boxshadow no_border justify-left d-flex\"-->\n                                    <!--                                                            style=\"background-color: #92d050; height: 30px\">-->\n                                    <!--                                                        <input type=\"checkbox\" class=\"checkbox_inv float-left\"/>-->\n                                    <!--                                                        <p class=\"mb-0\" style=\"width: 100%\">-->\n                                    <!--                                                            <span class=\"pl-3 float-left\">No. 00224</span>-->\n                                    <!--                                                            <span class=\"float-right\">2,500.00</span>-->\n                                    <!--                                                        </p>-->\n                                    <!--                                                    </v-card>-->\n                                    <!--                                                </v-col>-->\n                                    <!--                                                <v-col sm=\"3\" cols=\"3\" class=\"py-1  pl-1\">-->\n                                    <!--                                                    <v-btn-->\n                                    <!--                                                        class=\"text-white text-bold rounded-0 float-right text-uppercase\"-->\n                                    <!--                                                        style=\"height: 30px !important; background-color: rgb(0, 176, 80) !important\">-->\n                                    <!--                                                        {{ $t('add') }}-->\n                                    <!--                                                    </v-btn>-->\n                                    <!--                                                </v-col>-->\n                                    <!--                                            </v-row>-->\n                                    <!--                                            <v-row>-->\n                                    <!--                                                <v-col sm=\"9\" cols=\"9\" class=\"py-1 pr-0\">-->\n                                    <!--                                                    <v-card outlined-->\n                                    <!--                                                            class=\"px-3 py-1 text-white no-boxshadow no_border justify-left d-flex\"-->\n                                    <!--                                                            style=\"background-color: #92d050; height: 30px\">-->\n                                    <!--                                                        <input type=\"checkbox\" class=\"checkbox_inv float-left\"/>-->\n                                    <!--                                                        <p class=\"mb-0\" style=\"width: 100%\">-->\n                                    <!--                                                            <span class=\"pl-3 float-left\">No. 00224</span>-->\n                                    <!--                                                            <span class=\"float-right\">2,500.00</span>-->\n                                    <!--                                                        </p>-->\n                                    <!--                                                    </v-card>-->\n                                    <!--                                                </v-col>-->\n                                    <!--                                                <v-col sm=\"3\" cols=\"3\" class=\"py-1  pl-1\">-->\n                                    <!--                                                    <v-btn-->\n                                    <!--                                                        class=\"text-white text-bold rounded-0 float-right text-uppercase\"-->\n                                    <!--                                                        style=\"height: 30px !important; background-color: rgb(0, 176, 80) !important\">-->\n                                    <!--                                                        {{ $t('add') }}-->\n                                    <!--                                                    </v-btn>-->\n                                    <!--                                                </v-col>-->\n                                    <!--                                            </v-row>-->\n                                    <!--                                        </v-col>-->\n                                    <!--                                    </v-row>-->\n\n                                    <!--                                    <h4 class=\"mb-2 text-uppercase\">{{ $t('add_to_deposit') }}</h4>-->\n                                    <!--                                    <label class=\"label font_14\">{{ $t('sale_channel') }}</label>-->\n                                    <!--                                    <v-select class=\" mt-1\"-->\n                                    <!--                                              :items=\"suppliers\"-->\n                                    <!--                                              :rules=\"[v => !!v || 'Payble Account is required']\"-->\n                                    <!--                                              return-object-->\n                                    <!--                                              tage=\"Add to Deposit\"-->\n                                    <!--                                              outlined-->\n                                    <!--                                    />-->\n                                    <!--                                    <label class=\"label font_14\">{{ $t('deposit_amount') }}</label>-->\n                                    <!--                                    <v-text-field class=\" mt-1 mb-16\"-->\n                                    <!--                                                  tage=\"Deposit Amount\"-->\n                                    <!--                                                  outlined-->\n                                    <!--                                    />-->\n\n                                    <p class=\"mb-0 detial_smallside_p font_14\">\n                                        {{ $t(\"sale_return_funct_desc\") }}\n                                    </p>\n                                </div>\n                            </v-col>\n                        </v-row>\n                    </v-card>\n                </v-col>\n            </v-row>\n            <LoadingMe\n                :isLoading=\"showLoading\"\n                :fullPage=\"false\"\n                :myLoading=\"true\"\n            />\n            <v-dialog v-model=\"dialogTax\" max-width=\"450px\">\n                <v-card>\n                    <div class=\"modal_header\">\n                        <v-card-title>{{ $t(\"tax_list\") }}</v-card-title>\n                        <v-icon class=\"btn_close\" @click=\"dialogTax = false\">close</v-icon>\n                    </div>\n                    <v-card-text class=\"modal_text_content\">\n                        <v-row>\n                            <v-col sm=\"12\" cols=\"12\" class=\"pb-0\">\n                                <v-simple-table>\n                                    <template v-slot:default>\n                                        <tbody>\n                                        <tr\n                                            v-for=\"(value, name) in taxListTotal\"\n                                            v-bind:key=\"name\"\n                                        >\n                                            <td class=\"text-left\" width=\"180px\">{{ name }}</td>\n                                            <td class=\"text-center\">:</td>\n                                            <td class=\"text-right\">\n                                                {{ numberFormat(value) }}\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td class=\"text-left\" width=\"180px\">\n                                                {{ $t(\"total\") }}\n                                            </td>\n                                            <td class=\"text-center\">:</td>\n                                            <td class=\"text-right\">\n                                                {{ numberFormat(creditMemo.taxAmount) }}\n                                            </td>\n                                        </tr>\n                                        </tbody>\n                                    </template>\n                                </v-simple-table>\n                            </v-col>\n                        </v-row>\n                    </v-card-text>\n                    <v-divider/>\n                </v-card>\n            </v-dialog>\n        </v-container>\n    </v-app>\n</template>\n\n<script>\n// import kendo from '@progress/kendo-ui'\nimport {i18n} from \"@/i18n\";\nimport LoadingMe from \"@/components/Loading\";\nimport DatePickerComponent from \"@/components/custom_templates/DatePickerComponent\";\nimport CreditMemoModel from \"@/scripts/sale_return/model/CreditMemo\";\nimport kendo from \"@progress/kendo-ui\";\nimport {uuid} from \"vue-uuid\";\nimport SaleFormContentModel from \"@/scripts/model/SaleFormContent\";\nimport {DropDownList} from \"@progress/kendo-vue-dropdowns\";\nimport ItemLineModel from \"@/scripts/sale_return/model/ItemLine\";\n// import AccountLineModel from \"@/scripts/sale_return/model/AccountLine\";\nimport ApplyToLineModel from \"@/scripts/sale_return/model/ApplyToLine\";\nimport DepositLineModel from \"@/scripts/sale_return/model/DepositLine\";\nimport {dataStore, ShowResource} from \"@/observable/store\";\nimport PaymentOptionEditor from \"@/scripts/kendo_editor/PaymentOptionEditor\";\n\nconst defaultItem = {[\"numberName\"]: \"Select customer...\", [\"id\"]: null};\nconst customerHandler = require(\"@/scripts/customerHandler\");\nconst prefixHandler = require(\"@/scripts/prefixHandler\");\nconst emptyItem = {[\"numberName\"]: \"loading ...\"};\nconst billingHandler = require(\"@/scripts/invoice/handler/billingHandler\");\nconst saleFormContentHandler = require(\"@/scripts/saleFormContentHandler\");\nconst employeeHandler = require(\"@/scripts/employeeHandler\");\nconst locationHandler = require(\"@/scripts/locationHandler\");\nconst productVariantHandler = require(\"@/scripts/productVariantHandler\");\nconst discountItemHandler = require(\"@/scripts/discountItemHandler\");\nconst accountHandler = require(\"@/scripts/handler/accounting/account\");\nconst uomPriceHandler = require(\"@/scripts/uomPriceHandler\");\nconst settingsHandler = require(\"@/scripts/settingsHandler\");\nconst projectHandler = require(\"@/scripts/projectHandler\");\nconst priceLevelHandler = require(\"@/scripts/priceLevelHandler\");\nconst settingHandler = require(\"@/scripts/settingHandler\");\nconst paymentTermHandler = require(\"@/scripts/paymentTermHandler\");\nconst currencyHandler = require(\"@/scripts/currency/handler/currencyHandler\");\nconst saleUnitItemHandler = require(\"@/scripts/saleUnitItemHandler\");\nconst paymentOptionHandler = require(\"@/scripts/paymentOptionHandler\");\n\nimport SaleDepositItemLineModel from \"@/scripts/sale_deposit/model/ItemLine\";\nimport otherChargeHandler from \"@/scripts/otherChargeHandler\";\nimport OtherChargeModel from \"@/scripts/model/OtherCharge\";\n\nconst saleFormContentModel = new SaleFormContentModel({});\nconst itemLineModel = new ItemLineModel({});\n// const accountLineModel = new AccountLineModel({})\nconst applyToLineModel = new ApplyToLineModel({});\nconst depositLineModel = new DepositLineModel({});\nconst $ = require(\"jquery\");\nconst itemLinePrefix = \"lin-\";\nconst textField = \"numberName\";\n\nconst creditMemoModel = new CreditMemoModel({});\nconst saleDepositItemLineModel = new SaleDepositItemLineModel({});\nconst OPTION_TYPE = \"Customer\";\nconst strOptionFilter = \"?optionType=\" + OPTION_TYPE;\nconst DISCOUNT_TYPE = \"?type=Sale\";\nconst cookieJS = require(\"@/cookie.js\");\nconst cookie = cookieJS.getCookie();\nexport default {\n    name: \"CreditMemo\",\n    props: [\"id\"],\n    components: {\n        LoadingMe: LoadingMe,\n        \"app-datepicker\": DatePickerComponent,\n        dropdownlist: DropDownList,\n    },\n    data: () => ({\n        isLoading: 0,\n        PaymentOptionEditor: PaymentOptionEditor,\n        creditMemo: creditMemoModel,\n        saleFormContent: saleFormContentModel,\n        itemLine: itemLineModel,\n        // accountLine: accountLineModel,\n        applyToLine: applyToLineModel,\n        depositLine: depositLineModel,\n        saleDepositLine: saleDepositItemLineModel,\n\n        customerList: [],\n        cashRefundLines: [],\n        itemLines: [],\n        taxListTotal: [],\n        otherChargeList: [],\n        customer: {},\n        defaultItem: defaultItem,\n        dataItemKey: \"id\",\n        textField: \"numberName\",\n        filter: \"\",\n        cusBaseUrl: customerHandler.searchv1(),\n        empBaseUrl: employeeHandler.search(),\n        loggedUser: {\n            id: cookie.creator,\n            name: cookie.email,\n        },\n        employees: [],\n        mEmployee: {},\n        customerProjects: [],\n        priceLevel: [],\n        locations: [],\n        otherTax: [],\n        vatTax: [],\n        specificTax: [],\n        publicLightingTax: [],\n        saleUnitItemList: [],\n        customerDiscountItem: [],\n        customerSaleUnit: [],\n        transactionType: [],\n        segments: [],\n        exchangeRate: [],\n        currencyCode: \"\",\n        transactionRate: 1,\n        accountLines: [],\n        transactionRateDate: \"\",\n        accounts: [],\n        depositLines: [],\n        offsetList: [],\n        offsetInvoices: [],\n        offsetInvoiceList: [],\n        offsetInvoice: {},\n        decimalFormat: \"n2\",\n        // LoadingMe\n        showLoading: false,\n        bill_date: \"\",\n        alert: false,\n        valid: true,\n        suppliers: [],\n        journal_types: [],\n        suppliers_item: [],\n        paymentMethod: [],\n        expense: [\"Equal\", \"weighted\"],\n        transactionDate: new Date().toISOString().substr(0, 10),\n        templates: [\n            {title: \"Draft\"},\n            {title: \"Open\"},\n            {title: \"Partially Closed\"},\n            {title: \"Closed\"},\n        ],\n        isHideBar: false,\n        dialogTax: false,\n        baseCurrencyCode: \"\",\n        accCash: [],\n        accDeposit: [],\n        accDeposits: [],\n        jRaw: [],\n        jRaw1: [],\n        jRaw2: [],\n        jRaw3: [],\n        jRaw4: [],\n        jRaw5: [],\n        taxListDetail: [],\n        gainLossAcc: {},\n        otherRevenueAcc: {},\n        varianceAccs: [],\n        refFrom: [],\n        refTo: [],\n        isPriceLevelChanged: false,\n        cr: 0,\n        dr: 0,\n    }),\n    computed: {\n        disabledMe() {\n            return !!this.$route.params.id;\n        },\n        //         $(\"#getInfoButton\").bind(\"click\", function () {\n        //\n        //     var grid = kendo.jQuery(\"#grid1\").data(\"kendoGrid\");\n        //     var row = $(\"input:checked\", grid.tbody).closest(\"tr\");\n        //     var item = grid.dataItem(row);\n        //     alert (JSON.stringify(item));\n        // });\n        radioButton() {\n            return `<input type=\"radio\" class=\"detailGridRowSelector\" title=\"Select Lines\" name=\"radioLineSelector\" />`;\n        },\n        amountHeaderTemplate() {\n            if (this.customer) {\n                if (this.customer.hasOwnProperty(\"baseCurrency\")) {\n                    const baseCurrency = this.customer.baseCurrency;\n                    if (baseCurrency.hasOwnProperty(\"code\")) {\n                        return \"Amount (\" + baseCurrency.code + \")\";\n                    }\n                }\n            }\n            return \"Amount\";\n        },\n        amountLineHeaderTemplate() {\n            if (this.currencyCode) {\n                return \"Amount (\" + this.currencyCode + \")\";\n            }\n            return \"Amount\";\n        },\n        hiddenButton() {\n            if (this.$route.params.id) {\n                return true\n            } else {\n                return false\n            }\n        }\n    },\n    methods: {\n        status(status) {\n            let statusText = ''\n            switch (status) {\n                case 1:\n                    statusText = 'Open'\n                    break\n                case 2:\n                    statusText = 'Partially Paid'\n                    break\n                case 3:\n                    statusText = 'Paid'\n                    break\n                case 4:\n                    statusText = 'Void'\n                    break\n            }\n            return statusText\n        },\n        onPriceLevelChange() {\n            this.isPriceLevelChanged = true\n            this.loadTransactionRate()\n            this.clearUOMItem()\n        },\n        async clearUOMItem() {\n            let ds = this.$refs.itemLineDS.kendoWidget()\n            ds.data().map(n => {\n                n.set('uom', {})\n            })\n            this.isPriceLevelChanged = false\n        },\n        qohTemplate(dataItem) {\n            const buom = dataItem.buom || {};\n            const qoh = dataItem.qoh || 0;\n            if (buom.hasOwnProperty(\"name\")) {\n                return qoh + ` ` + buom.name;\n            }\n            return ``;\n        },\n        formatVariance(num) {\n            if (num) {\n                const varianceNumber = this.numberToString(num);\n                return varianceNumber;\n                //   if (varianceNumber) {\n                //     const strDigit = varianceNumber.split('.')\n                //     const head = strDigit[0]\n                //     const rightHead = strDigit[1]\n                //     const nums = this.countZeros(rightHead)\n                //     const substringRight = rightHead.substring(0, nums + 1)\n                //     return head + '.' + substringRight\n                //   }\n            }\n            // return 0\n        },\n        countZeros(num) {\n            if (num) {\n                let splitted = num.split(\"\");\n                let i = 0;\n                while (splitted.shift() == 0) {\n                    i += 1;\n                }\n                return i;\n            }\n            return 0;\n        },\n        numberToString(num) {\n            if (num) {\n                let numStr = String(num);\n                if (Math.abs(num) < 1.0) {\n                    let e = parseInt(num.toString().split(\"e-\")[1]);\n                    if (e) {\n                        let negative = num < 0;\n                        if (negative) num *= -1;\n                        num *= Math.pow(10, e - 1);\n                        numStr =\n                            \"0.\" + new Array(e).join(\"0\") + num.toString().substring(2);\n                        if (negative) numStr = \"-\" + numStr;\n                    }\n                } else {\n                    let e = parseInt(num.toString().split(\"+\")[1]);\n                    if (e > 20) {\n                        e -= 20;\n                        num /= Math.pow(10, e);\n                        numStr = num.toString() + new Array(e + 1).join(\"0\");\n                    }\n                }\n                // const zeros = this.numberOfZeros(numStr)\n                return numStr; //parseFloat(numStr).toFixed(zeros + 1)\n            }\n        },\n        showWaringMessage(title, text, confirmButtonText) {\n            this.$swal({\n                title: title,\n                text: text,\n                icon: \"warning\",\n                showCancelButton: false,\n                confirmButtonColor: \"#4d4848\",\n                cancelButtonColor: \"#ED1A3A\",\n                confirmButtonText: confirmButtonText,\n            }).then((result) => {\n                if (result.value) {\n                    window.console.log(\"1\");\n                }\n            });\n        },\n        onVarianceAccChanged() {\n            this.autoCalculate();\n            this.autoCalculateApplyTo();\n            this.autoCalculateDeposit();\n            this.autoCalculateCashRefund();\n            this.calculateAmount();\n        },\n        shrinkData() {\n            this.jRaw = [];\n            const obj = this.jRaw.concat(\n                this.jRaw1,\n                this.jRaw2,\n                this.jRaw3,\n                this.jRaw4,\n                this.jRaw5\n            );\n            const uniques = this.removeDuplicate(\n                obj\n            ); /*[...new Set(accountId.map(i => {\n                return {\n                    id_: i.id_,\n                    id: i.id,\n                    type: i.type\n                }\n            }))]*/\n\n            uniques.forEach((n) => {\n                const found = obj.filter((m) => m.id === n.id);\n                let amount = 0,\n                    exchangeAmount = 0;\n                found.forEach((z) => {\n                    amount += parseFloat(z.amount || 0);\n                    exchangeAmount += parseFloat(z.exchangeAmount || 0);\n                });\n                n.exchangeAmount = parseFloat(exchangeAmount); //this.numberFormat(amount)\n                n.amount = parseFloat(amount);\n            });\n            this.jRaw = uniques;\n            let dr = 0,\n                cr = 0;\n            this.jRaw.forEach((j) => {\n                switch (j.type) {\n                    case \"cr\":\n                        cr += parseFloat(j.amount);\n                        break;\n                    case \"dr\":\n                        dr += parseFloat(j.amount);\n                        break;\n                    default:\n                        break;\n                }\n            });\n            this.dr = dr;\n            this.cr = cr;\n            window.console.log(\"dr=\", dr, \"cr=\", cr, \"dr+cr = \", dr + cr);\n            window.console.log(JSON.stringify(this.jRaw), \"uniques\", this.creditMemo);\n        },\n        offsetInvoiceChanged() {\n            //todo: add invoice to line\n            if (this.offsetInvoice) {\n                const txnId = this.offsetInvoice.id || {};\n                this.creditMemo.location = this.offsetInvoice.location || {};\n                this.creditMemo.segment = this.offsetInvoice.segment || {};\n                this.creditMemo.project = this.offsetInvoice.project || {};\n                this.offsetList = [];\n                if (txnId) {\n                    this.offsetList = this.offsetInvoiceList.filter(\n                        (o) => o.id === txnId\n                    );\n                    this.refFrom.push({\n                        id: this.offsetInvoice.id || '',\n                        reference: this.offsetInvoice.referenceNo || '',\n                        type: 'Invoice'\n                    })\n                    window.console.log('refF', this.refFrom)\n                }\n            }\n        },\n        priceTemplate(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty(\"price\")) {\n                    return kendo.toString(dataItem.price || 0, dataItem.decimalFormat);\n                }\n            }\n            return 0;\n        },\n        amtTemplate(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty(\"amount\")) {\n                    return kendo.toString(dataItem.amount || 0, dataItem.decimalFormat);\n                }\n            }\n            return 0;\n        },\n        Help(key_search) {\n            ShowResource(key_search);\n        },\n        methodTemplate(dataItem) {\n            const method = dataItem.paymentOption;\n            if (method) {\n                return `<span>${method.bankAccountName || ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        amountTemplate(dataItem) {\n            const amt = dataItem.amount;\n            if (amt) {\n                return kendo.toString(parseFloat(amt), `${this.decimalFormat}`);\n            } else {\n                return 0;\n            }\n        },\n        methodDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=code# - #= name#</span>\",\n                    optionLabel: \"--Select--\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.paymentMethod,\n                    }),\n                });\n        },\n        numberFormat(value) {\n            return kendo.toString(value, `${this.decimalFormat}`);\n        },\n        onDepositLineDSChange(e) {\n            if (e.field) {\n                let dataRow = e.items[0];\n                switch (e.field) {\n                    case \"amount\":\n                        dataRow.set(\"exchangeAmount\", dataRow.amount);\n                        break;\n                    default:\n                        break;\n                }\n                this.autoCalculate();\n                this.autoCalculateApplyTo();\n                this.autoCalculateDeposit();\n                this.autoCalculateCashRefund();\n                this.calculateAmount();\n            }\n        },\n        onApplyToLineChange(e) {\n            if (e.field) {\n                let dataRow = e.items[0],\n                    offset = 0,\n                    amount = 0;\n                switch (e.field) {\n                    case \"paidAmount\":\n                        amount = parseFloat(dataRow.amount);\n                        offset = parseFloat(dataRow.paidAmount);\n                        if (offset > amount) {\n                            dataRow.set(\"paidAmount\", amount);\n                            dataRow.set(\"paidAmountTobase\", amount * dataRow.txnRate);\n                        } else {\n                            dataRow.set(\n                                \"paidAmountTobase\",\n                                dataRow.paidAmount * dataRow.txnRate\n                            );\n                            dataRow.set(\n                                \"paidAmountTxn\",\n                                offset * parseFloat(dataRow.txnRate)\n                            );\n                        }\n                        // window.console.log(dataRow.paidAmount * 1 / dataRow.rateTobase, 'APPLY RO')\n                        break;\n                    default:\n                        break;\n                }\n                this.autoCalculate();\n                this.autoCalculateApplyTo();\n                this.autoCalculateDeposit();\n                this.autoCalculateCashRefund();\n                this.calculateAmount();\n            }\n        },\n        onCashRefundChange(e) {\n            if (e.field) {\n                let dataRow = e.items[0], pOption = {}\n                switch (e.field) {\n                    case \"paymentOption\":\n                        pOption = dataRow.paymentOption || {}\n                        dataRow.set(\"account\", pOption.account || {});\n                        break;\n                    default:\n                        break;\n                }\n            }\n            if (e.field) {\n                // this.autoCalculateCashRefund()\n                this.autoCalculate();\n                this.autoCalculateApplyTo();\n                this.autoCalculateDeposit();\n                this.autoCalculateCashRefund();\n                this.calculateAmount();\n            }\n        },\n        nowTimes() {\n            const perfData = window.performance.timing;\n            const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;\n            window.console.log(pageLoadTime, \"--\");\n        },\n        onEmployeeChanged(event) {\n            const value = event.value;\n            if (value && value[textField] === emptyItem[textField]) {\n                return;\n            }\n            this.mEmployee = value;\n            this.creditMemo.employee = value;\n        },\n        afterFetch_(json) {\n            this.employees = json.data;\n        },\n        onEmployeeFilterChanged(event) {\n            const filter = event.filter.value;\n            this.requestData_(0, filter, this.empBaseUrl);\n            this.filter_ = filter;\n        },\n        autoCalculateDiscount(discountItem, subTotal) {\n            if (discountItem) {\n                const nature = discountItem.nature || ''\n                const amount = discountItem.amount || 0\n                if (nature === 'Amount') {\n                    return parseFloat(amount)\n                } else if (nature === 'Percentage') {\n                    return (subTotal * (parseFloat(amount) / 100))\n                } else {\n                    return 0\n                }\n            } else {\n                return 0\n            }\n        },\n        autoCalculateTax(tax, amount) {\n            if (tax) {\n                var formula = tax.formula;\n                var inAmt = kendo.parseFloat(amount);\n                var nAmt = kendo.parseFloat(amount);\n                var taxBase = kendo.parseFloat(tax.taxBase) / 100;\n                var rate = kendo.parseFloat(tax.rate) / 100;\n                var total = eval(formula);\n                window.console.log(inAmt, nAmt, taxBase, rate, formula, total);\n                return total;\n            }\n            // return 0\n        },\n        async loadTransactionRate() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const date = new Date(this.transactionDate)\n                        .toISOString()\n                        .substr(0, 10);\n                    const priceLevel = this.creditMemo.priceLevel;\n                    let code = \"\";\n                    this.offsetInvoices = [];\n                    this.offsetList = [];\n                    if (priceLevel) {\n                        if (priceLevel.hasOwnProperty(\"currency\")) {\n                            this.creditMemo.currency = priceLevel.currency;\n                            if (priceLevel.currency.hasOwnProperty(\"code\")) {\n                                code = priceLevel.currency.code;\n                            }\n                        }\n                        if (code !== undefined || code !== \"\") {\n                            this.showLoading = true;\n                            currencyHandler\n                                .getLastExchangeRateByDate(date, code)\n                                .then((res) => {\n                                    if (res.data.statusCode === 200) {\n                                        this.showLoading = false;\n                                        this.exchangeRate = res.data.data[0];\n                                        this.currencyCode = this.exchangeRate.code;\n                                        this.transactionRate = this.exchangeRate.rate;\n                                        this.creditMemo.txnRate = this.exchangeRate.rate;\n                                        this.transactionRateDate = this.exchangeRate.effectiveDate;\n                                        this.creditMemo.exchangeRate = this.exchangeRate;\n                                        this.showLoading = false;\n                                    }\n                                });\n                        }\n                        window.console.log('this.customer', this.customer)\n                        if (this.customer) {\n                            this.searchInvoice();\n                        }\n                    } else {\n                        this.isLoading = 0\n                    }\n                }, 50);\n            });\n        },\n        async loadPaymentTerm() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    paymentTermHandler.getAll().then((res) => {\n                        this.showLoading = false;\n                        this.paymentTerms = res.data.data;\n                        if (this.paymentTerms.length > 0) {\n                            this.creditMemo.paymentTerm = this.paymentTerms[0];\n                        }\n                    });\n                }, 50);\n            });\n        },\n        errorMessage() {\n        },\n        async loadTax() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    settingHandler.get().then((res) => {\n                        this.tax = res;\n                        this.otherTax = this.tax.filter(\n                            (m) =>\n                                (m.taxType.typeId === 7 || m.taxType.typeId === 10) &&\n                                m.transactionType === \"Sale\"\n                        ); // valuable tax\n                        this.specificTax = this.tax.filter(\n                            (m) =>\n                                (m.taxType.typeId === 8 || m.taxType.typeId === 10) &&\n                                m.transactionType === \"Sale\"\n                        ); // valuable tax\n                        this.publicLightingTax = this.tax.filter(\n                            (m) =>\n                                (m.taxType.typeId === 9 || m.taxType.typeId === 10) &&\n                                m.transactionType === \"Sale\"\n                        ); // valuable tax\n                        this.vatTax = this.tax.filter(\n                            (m) =>\n                                (m.taxType.typeId === 1 ||\n                                    m.taxType.typeId === 8 ||\n                                    m.taxType.typeId === 10) &&\n                                m.transactionType === \"Sale\"\n                        ); // valuable tax\n                    });\n                }, 50);\n            });\n        },\n        async loadLocation() {\n            this.locations = []\n            const roleType = dataStore.roleType || 0\n            if (roleType === 0) {\n                if (dataStore.roleData) {\n                    const roleData = dataStore.roleData || []\n                    const location = roleData.filter(itm => itm.type === 'location')\n                    const locationDefault = location.filter(m => m.isDefault === 1)\n                    this.locations = location\n                    if (this.$route.params.id === undefined || this.$route.params.id === '') {\n                        if (locationDefault.length > 0) {\n                            this.creditMemo.location = locationDefault[0];\n                        }\n                    }\n                }\n            } else if (roleType === 1) {\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        this.locations = [];\n                        locationHandler\n                            .list()\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.locations = res.data.data;\n                                }\n                            })\n                    }, 10);\n                });\n            }\n\n\n        },\n        async loadProjectByCustomer() {\n            this.customerProjects = []\n            const roleType = dataStore.roleType || 0\n            if (roleType === 0) {\n                if (dataStore.roleData) {\n                    const roleData = dataStore.roleData || []\n                    const project = roleData.filter(itm => itm.type === 'project')\n                    project.forEach(k => {\n                        const customers = k.customers || []\n                        const proCustomer = customers.filter(n => n.customer.id === this.customer.id)\n                        if (proCustomer.length > 0) {\n                            this.customerProjects.push(k)\n                        }\n                    })\n                    if (this.$route.params.id === undefined || this.$route.params.id === '') {\n                        const projectDefault = this.customerProjects.filter(m => m.isDefault === 1)\n                        if (projectDefault.length > 0) {\n                            this.creditMemo.project = projectDefault[0];\n                        }\n                    }\n                }\n            } else if (roleType === 1) {\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        projectHandler\n                            .getByCustomer(this.customer.id)\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.customerProjects = res.data.data;\n                                }\n                            })\n                    }, 10);\n                });\n            }\n        },\n        async loadSegment() {\n            this.segments = []\n            const roleType = dataStore.roleType || 0\n            if (roleType === 0) {\n                if (dataStore.roleData) {\n                    const roleData = dataStore.roleData || []\n                    const segment = roleData.filter(itm => itm.type === 'segment')\n                    const segmentDefault = segment.filter(m => m.isDefault === 1)\n                    this.segments = segment\n                    if (this.$route.params.id === undefined || this.$route.params.id === '') {\n                        if (segmentDefault.length > 0) {\n                            this.creditMemo.segment = segmentDefault[0];\n                        }\n                    }\n                }\n            } else if (roleType === 1) {\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        this.segments = [];\n                        settingsHandler\n                            .getSeg()\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.segments = res.data.data;\n                                }\n                            })\n                    }, 10);\n                });\n            }\n        },\n        async loadAccount() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    accountHandler.getAll().then((res) => {\n                        (async () => {\n                            this.accCash = res.data\n                                .filter((m) => m.account_type.number <= 5)\n                                .map((item) => {\n                                    return {\n                                        id: item.uuid,\n                                        uuid: item.uuid,\n                                        name: item.name,\n                                        local_name: item.local_name,\n                                        number: item.number,\n                                        is_taxable: item.is_taxable,\n                                        banhjiAccCode: item.banhjiAccCode,\n                                        group_code: item.group_code,\n                                        parent_account: item.parent_account,\n                                        type_code: item.type_code,\n                                        account_type: item.account_type,\n                                    };\n                                });\n\n                            this.accDeposits = res.data\n                                .filter((m) => m.account_type.number === 20)\n                                .map((item) => {\n                                    return {\n                                        id: item.uuid,\n                                        uuid: item.uuid,\n                                        name: item.name,\n                                        local_name: item.local_name,\n                                        number: item.number,\n                                        is_taxable: item.is_taxable,\n                                        banhjiAccCode: item.banhjiAccCode,\n                                        group_code: item.group_code,\n                                        parent_account: item.parent_account,\n                                        type_code: item.type_code,\n                                        account_type: item.account_type,\n                                    };\n                                });\n                            this.varianceAccs = res.data\n                                .filter(\n                                    (m) =>\n                                        m.account_type.number >= 33 && m.account_type.number <= 48\n                                )\n                                .map((item) => {\n                                    return {\n                                        id: item.uuid,\n                                        uuid: item.uuid,\n                                        name: item.name,\n                                        local_name: item.local_name,\n                                        number: item.number,\n                                        is_taxable: item.is_taxable,\n                                        banhjiAccCode: item.banhjiAccCode,\n                                        group_code: item.group_code,\n                                        parent_account: item.parent_account,\n                                        type_code: item.type_code,\n                                        account_type: item.account_type,\n                                    };\n                                });\n                            // this.accounts = await Promise.all(res.map(item => {\n                            //     return {\n                            //         id: item.uuid,\n                            //         name: item.name,\n                            //         number: item.number\n                            //     }\n                            // }));\n                        })();\n                    });\n                }, 50);\n            });\n        },\n        async loadPriceLevel() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const strFilter = '?nature=sale'\n                    priceLevelHandler.get(strFilter).then((res) => {\n                        this.priceLevel = res;\n                        if (this.priceLevel.length > 0) {\n                            this.creditMemo.priceLevel = this.priceLevel[0];\n                        }\n                    });\n                }, 50);\n            });\n        },\n        async loadDiscountItem() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    discountItemHandler.list().then((res) => {\n                        if (res.data.statusCode === 200) {\n                            this.specificDiscountItem = res.data.data;\n                        }\n                    });\n                }, 50);\n            });\n        },\n        async loadSaleFormContent() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    saleFormContentHandler.list().then((res) => {\n                        if (res.data.statusCode === 200) {\n                            const data = res.data.data;\n                            if (data.length > 0) {\n                                this.saleFormContent = data[0];\n                                this.decimalFormat = \"n\" + data[0].decimal || \"n2\";\n                                this.addRow();\n                                this.addRowDeposit();\n                                this.addRowCashRefund();\n                            }\n                        }\n                    });\n                }, 50);\n            });\n        },\n        async initData() {\n            if (this.$route.params.id !== undefined) {\n                await this.loadViewCreditMemo();\n            }\n            // else {\n            //     this.addRowDeposit()\n            //     this.addRowCashRefund()\n            // }\n        },\n        taxMapping(objTax, tax) {\n            const taxId = tax.id || ''\n            const tax_ = objTax.filter(t => t.id === taxId)[0]\n            return tax_ || {\n                id: '',\n                defaultTax: ''\n            }\n        },\n        dataSourceChanged(e) {\n            if (e.field) {\n                let dataRow = e.items[0],\n                    buom = {}, vTax = {}, spTax = {}, otTax = {}, plTax = {},\n                    conversionRate = 1,\n                    wac = 0,\n                    qoh = 0,\n                    amount = 0,\n                    xAmount = 0,\n                    price = 0;\n                switch (e.field) {\n                    case \"item\":\n                        // this.attribute_ = this.attributes.filter(m => m.type.id === dataRow.variant.id)\n                        dataRow.set(\"description\", dataRow.item.description);\n                        buom = dataRow.item.uom || {};\n                        dataRow.set(\"buom\", buom);\n                        break;\n                    case \"price\":\n                        try {\n                            amount = parseFloat(dataRow.price) * parseFloat(dataRow.qty);\n                            xAmount = amount * parseFloat(this.creditMemo.txnRate);\n                            dataRow.set(\"price\", parseFloat(dataRow.price));\n                            dataRow.set(\"amount\", amount);\n                            dataRow.set(\"exchangeAmount\", xAmount);\n                            // window.console.log('price',dataRow.price)\n                        } catch {\n                            dataRow.set(\"price\", 0);\n                            dataRow.set(\"amount\", 0);\n                            dataRow.set(\"exchangeAmount\", 0);\n                        }\n                        break;\n                    case \"uom\":\n                        if (this.isPriceLevelChanged === false) {\n                            try {\n                                buom = dataRow.uom.buom || {};\n                                buom = dataRow.uom.buom || {};\n                                qoh = dataRow.uom.qoh || 0;\n                                conversionRate = dataRow.uom.conversionRate || 1;\n                                wac = dataRow.uom.wac || 0;\n                                dataRow.set(\"buom\", buom);\n                                dataRow.set(\"wac\", wac);\n                                dataRow.set(\"qoh\", qoh);\n                                /* todo: mapping tax object */\n                                vTax = this.taxMapping(this.vatTax, dataRow.uom.vatTax || {})\n                                otTax = this.taxMapping(this.otherTax, dataRow.uom.otherTax || {})\n                                spTax = this.taxMapping(this.specificTax, dataRow.uom.specificTax || {})\n                                plTax = this.taxMapping(this.publicLightingTax, dataRow.uom.publicLightingTax || {})\n\n                                dataRow.set(\"vatTax\", vTax);\n                                dataRow.set(\"specificTax\", otTax);\n                                dataRow.set(\"otherTax\", spTax);\n                                dataRow.set(\"publicLightingTax\", plTax);\n                                dataRow.set(\"conversionRate\", parseFloat(conversionRate));\n\n                                // dataRow.set('price', parseFloat(dataRow.uom.price))\n                                // dataRow.set('amount', parseFloat(dataRow.uom.price) * parseFloat(dataRow.qty))\n                                if (dataRow.uom) {\n                                    window.console.log(dataRow, \"dataRow\");\n                                    amount =\n                                        parseFloat(dataRow.uom.price) * parseFloat(dataRow.qty);\n                                    xAmount = amount * parseFloat(this.creditMemo.txnRate);\n                                    price = parseFloat(dataRow.uom.price);\n\n                                    dataRow.set(\"price\", price);\n                                    dataRow.set(\"amount\", amount);\n                                    dataRow.set(\"exchangeAmount\", xAmount);\n                                } else {\n                                    window.console.log(dataRow, \"dataRow--\");\n                                    amount = parseFloat(dataRow.price) * parseFloat(dataRow.qty);\n                                    xAmount = amount * parseFloat(this.creditMemo.txnRate);\n\n                                    dataRow.set(\"price\", parseFloat(dataRow.price));\n                                    dataRow.set(\"amount\", amount);\n                                    dataRow.set(\"exchangeAmount\", xAmount);\n                                }\n                            } catch {\n                                dataRow.set(\"buom\", {});\n                                dataRow.set(\"conversionRate\", 1);\n                                dataRow.set(\"price\", 0);\n                                dataRow.set(\"amount\", 0);\n                                dataRow.set(\"qoh\", 0);\n                                dataRow.set(\"wac\", 0);\n                                dataRow.set(\"exchangeAmount\", 0);\n                            }\n                        }\n                        break;\n                    case \"qty\":\n                        try {\n                            amount = parseFloat(dataRow.price) * parseFloat(dataRow.qty);\n                            xAmount = amount * parseFloat(this.creditMemo.txnRate);\n\n                            dataRow.set(\"price\", parseFloat(dataRow.price));\n                            dataRow.set(\"amount\", amount);\n                            dataRow.set(\"exchangeAmount\", xAmount);\n                        } catch {\n                            dataRow.set(\"price\", 0);\n                            dataRow.set(\"amount\", 0);\n                            dataRow.set(\"exchangeAmount\", 0);\n                        }\n                        break;\n                    case \"otherTax\":\n                        // window.console.log(\"--\", dataRow)\n                        break;\n                    default:\n                        break;\n                }\n                if (e.field) {\n                    this.autoCalculate();\n                    this.autoCalculateApplyTo();\n                    this.autoCalculateDeposit();\n                    this.autoCalculateCashRefund();\n                    this.calculateAmount();\n                }\n            }\n        },\n        onAccountLineDSChanged(e) {\n            if (e.field) {\n                this.autoCalculateAccountLine();\n            }\n        },\n        autoCalculate() {\n            let ds = this.$refs.itemLineDS.kendoWidget(),\n                subTotal = 0,\n                totalTax = 0,\n                discountTotal = 0,\n                spTax = 0,\n                pltax = 0,\n                otherTax = 0,\n                vatTax = 0,\n                taxList = [],\n                discountItem = [],\n                taxListDetail = [],\n                saleUnit = [],\n                inclusiveTax = 0,\n                withholdingTaxAmount = 0,\n                itemSubtotal = 0,\n                txnItmSubtotal = 0,\n                serviceSubtotal = 0,\n                itemDiscount = 0,\n                serviceDiscount = 0,\n                txnDiscount = 0;\n            let nature = \"\",\n                currency = this.creditMemo.currency,\n                currencyCode = this.creditMemo.currency\n                    ? this.creditMemo.currency.code\n                    : \"\";\n            this.jRaw1 = [];\n            // const rows = ds.data().filter(m => parseFloat(m.amount) > 0)\n            // if (rows) {\n\n            ds.data().forEach((value) => {\n                let modifierPrice = 0, incTax = 0, whTaxAmount = 0, taxTypeId = 0;\n                if (value.modifier) {\n                    modifierPrice = kendo.parseFloat(value.modifier.price);\n                }\n\n                // subTotal += (kendo.parseFloat(value.amount) + modifierPrice)\n                let discount = 0;\n                if (value.discountItem) {\n                    const disItemField = value.discountItem;\n                    let subTo =\n                        kendo.parseFloat(value.price) * kendo.parseFloat(value.qty);\n                    discount = this.autoCalculateDiscount(value.discountItem, subTo);\n                    value[\"discountAmount\"] = discount;\n                    value[\"discountExchangeAmount\"] =\n                        discount * kendo.parseFloat(this.creditMemo.txnRate);\n                    if (value.discountItem.hasOwnProperty(\"id\")) {\n                        discountItem.push(value.discountItem);\n                    }\n                    discountTotal += discount ? discount : 0;\n                    if (discount * -1 > 0) {\n                        nature = \"dr\";\n                    } else {\n                        nature = \"cr\";\n                    }\n                    if (disItemField.account) {\n                        if (disItemField.account.hasOwnProperty(\"id\")) {\n                            this.jRaw1.push({\n                                id: disItemField.account.id + \"-\" + nature,\n                                line: new ItemLineModel(value),\n                                currencyCode: currencyCode,\n                                currency: currency,\n                                memoRate: kendo.parseFloat(this.creditMemo.txnRate),\n                                lastXRate: this.creditMemo.exchangeRate,\n                                description: \"Discount\",\n                                account: disItemField.account,\n                                accountId: disItemField.account.id,\n                                amount: discount * -1,\n                                exchangeAmount:\n                                    discount * kendo.parseFloat(this.creditMemo.txnRate) * -1,\n                                type: nature,\n                                typeAs: \"discount\",\n                            });\n                        }\n                    }\n                }\n                if (value.saleUnit) {\n                    if (value.saleUnit.hasOwnProperty(\"id\")) {\n                        saleUnit.push(value.saleUnit);\n                    }\n                }\n                if (value.specificTax) {\n                    spTax = this.autoCalculateTax(\n                        value.specificTax,\n                        kendo.parseFloat(value.amount) - kendo.parseFloat(discount)\n                    );\n                    // window.console.log('sp ', discount)\n                    spTax = kendo.parseFloat(spTax) ? kendo.parseFloat(spTax) : 0;\n                    const tax = value.specificTax;\n                    const baseAmount = tax.baseAmount;\n                    if (baseAmount) {\n                        if (baseAmount.toLowerCase() === \"inclusive\") {\n                            inclusiveTax += spTax;\n                        }\n                    }\n                    if (value.specificTax.hasOwnProperty(\"taxType\")) {\n                        taxList.push({\n                            name: value.specificTax.taxType.name,\n                            amount: spTax,\n                            id: value.specificTax.taxType.id,\n                        });\n                        const tax_ = value.specificTax || {}\n                        tax_['taxAmount_'] = spTax\n                        tax_['amount'] = value.amount || 0\n                        tax_['discount'] = discount || 0\n                        tax_['txnRate'] = this.creditMemo.txnRate || 1\n                        taxListDetail.push(tax_);\n                    }\n                    if (spTax > 0) {\n                        nature = \"dr\";\n                    } else {\n                        nature = \"cr\";\n                    }\n                    const specificTaxField = value.specificTax;\n                    if (specificTaxField.account) {\n                        if (specificTaxField.account.hasOwnProperty(\"id\")) {\n                            this.jRaw1.push({\n                                id: specificTaxField.account.id + \"-\" + nature,\n                                line: new ItemLineModel(value),\n                                memoRate: kendo.parseFloat(this.creditMemo.txnRate),\n                                lastXRate: this.creditMemo.exchangeRate,\n                                currencyCode: currencyCode,\n                                currency: currency,\n                                description: \"Tax\",\n                                account: specificTaxField.account,\n                                accountId: specificTaxField.account.id,\n                                amount: spTax,\n                                exchangeAmount:\n                                    spTax * kendo.parseFloat(this.creditMemo.txnRate),\n                                type: nature,\n                                typeAs: \"tax\",\n                            });\n                        }\n                    }\n                }\n                if (value.publicLightingTax) {\n                    pltax = this.autoCalculateTax(\n                        value.publicLightingTax,\n                        kendo.parseFloat(value.amount) - kendo.parseFloat(discount)\n                    );\n                    pltax = kendo.parseFloat(pltax) ? kendo.parseFloat(pltax) : 0;\n                    const tax = value.publicLightingTax;\n                    const baseAmount = tax.baseAmount;\n                    if (baseAmount) {\n                        if (baseAmount.toLowerCase() === \"inclusive\") {\n                            inclusiveTax += pltax;\n                        }\n                    }\n                    if (value.publicLightingTax.hasOwnProperty(\"taxType\")) {\n                        taxList.push({\n                            name: value.publicLightingTax.taxType.name,\n                            amount: pltax,\n                            id: value.publicLightingTax.taxType.id,\n                        });\n                        const tax_ = value.publicLightingTax || {}\n                        tax_['taxAmount_'] = pltax\n                        tax_['amount'] = value.amount || 0\n                        tax_['discount'] = discount || 0\n                        tax_['txnRate'] = this.creditMemo.txnRate || 1\n                        taxListDetail.push(tax_);\n                    }\n                    if (pltax > 0) {\n                        nature = \"dr\";\n                    } else {\n                        nature = \"cr\";\n                    }\n                    const PLTaxField = value.publicLightingTax;\n                    if (PLTaxField.account) {\n                        if (PLTaxField.account.hasOwnProperty(\"id\")) {\n                            this.jRaw1.push({\n                                id: PLTaxField.account.id + \"-\" + nature,\n                                line: new ItemLineModel(value),\n                                memoRate: kendo.parseFloat(this.creditMemo.txnRate),\n                                lastXRate: this.creditMemo.exchangeRate,\n                                currencyCode: currencyCode,\n                                currency: currency,\n                                description: \"Tax\",\n                                account: PLTaxField.account,\n                                accountId: PLTaxField.account.id,\n                                amount: pltax,\n                                exchangeAmount:\n                                    pltax * kendo.parseFloat(this.creditMemo.txnRate),\n                                type: nature,\n                                typeAs: \"tax\",\n                            });\n                        }\n                    }\n                }\n                if (value.otherTax) {\n                    otherTax = this.autoCalculateTax(\n                        value.otherTax,\n                        kendo.parseFloat(value.amount) - kendo.parseFloat(discount)\n                    );\n                    otherTax = kendo.parseFloat(otherTax)\n                        ? kendo.parseFloat(otherTax)\n                        : 0;\n                    const tax = value.otherTax;\n                    const baseAmount = tax.baseAmount;\n                    if (baseAmount) {\n                        if (baseAmount.toLowerCase() === \"inclusive\") {\n                            inclusiveTax += otherTax;\n                        }\n                    }\n                    if (value.otherTax.hasOwnProperty(\"taxType\")) {\n                        taxList.push({\n                            name: value.otherTax.taxType.name,\n                            amount: otherTax,\n                            id: value.otherTax.taxType.id,\n                        });\n                        const tax_ = value.otherTax || {}\n                        tax_['taxAmount_'] = otherTax\n                        tax_['amount'] = value.amount || 0\n                        tax_['discount'] = discount || 0\n                        tax_['txnRate'] = this.creditMemo.txnRate || 1\n                        taxListDetail.push(tax_);\n                    }\n                    if (otherTax > 0) {\n                        nature = \"dr\";\n                    } else {\n                        nature = \"cr\";\n                    }\n                    const otherTaxField = value.otherTax;\n                    if (otherTaxField.account) {\n                        if (otherTaxField.account.hasOwnProperty(\"id\")) {\n                            this.jRaw1.push({\n                                id: otherTaxField.account.id + \"-\" + nature,\n                                line: new ItemLineModel(value),\n                                memoRate: kendo.parseFloat(this.creditMemo.txnRate),\n                                lastXRate: this.creditMemo.exchangeRate,\n                                currencyCode: currencyCode,\n                                currency: currency,\n                                description: \"Tax\",\n                                account: otherTaxField.account,\n                                accountId: otherTaxField.account.id,\n                                amount: otherTax,\n                                exchangeAmount:\n                                    otherTax * kendo.parseFloat(this.creditMemo.txnRate),\n                                type: nature,\n                                typeAs: \"tax\",\n                            });\n                        }\n                    }\n                }\n\n                if (value.vatTax) {\n                    // window.console.log('Vat Tax', value.vatTax)\n                    let amt =\n                        kendo.parseFloat(spTax ? spTax : 0) +\n                        kendo.parseFloat(pltax ? pltax : 0) +\n                        kendo.parseFloat(otherTax ? otherTax : 0) +\n                        (kendo.parseFloat(value.amount ? value.amount : 0) -\n                            (discount ? discount : 0));\n                    vatTax = this.autoCalculateTax(value.vatTax, amt);\n                    vatTax = kendo.parseFloat(vatTax) ? kendo.parseFloat(vatTax) : 0;\n                    value[\"vatTaxAmount\"] = vatTax;\n                    value[\"vatTaxExchangeAmount\"] =\n                        vatTax * kendo.parseFloat(this.creditMemo.txnRate);\n                    const tax = value.vatTax;\n                    const baseAmount = tax.baseAmount;\n                    if (baseAmount) {\n                        if (baseAmount.toLowerCase() === \"inclusive\") {\n                            inclusiveTax += vatTax;\n                            incTax = spTax;\n                        }\n                    }\n                    if (value.vatTax.hasOwnProperty(\"taxType\")) {\n                        taxList.push({\n                            name: value.vatTax.taxType.name,\n                            amount: vatTax,\n                            id: value.vatTax.taxType.id,\n                        });\n                        const vatTax_ = value.vatTax || {}\n                        vatTax_['taxAmount_'] = vatTax\n                        vatTax_['amount'] = value.amount || 0\n                        vatTax_['discount'] = discount || 0\n                        vatTax_['txnRate'] = this.creditMemo.txnRate || 1\n                        vatTax_['isVat'] = 1\n                        vatTax_.detail = {\n                            specificTax: {},\n                            publicLightingTax: {},\n                            otherTax: {},\n                        }\n                        taxListDetail.push(vatTax_);\n                    }\n                    if (value.vatTax.hasOwnProperty(\"taxType\")) {\n                        const taxType = value.vatTax.taxType || {};\n                        taxTypeId = taxType.typeId || 0;\n                    }\n                    let taxAmount = vatTax;\n                    if (taxTypeId === 2) {\n                        withholdingTaxAmount += vatTax;\n                        whTaxAmount = vatTax;\n                    }\n                    if (taxAmount > 0) {\n                        nature = \"dr\";\n                    } else {\n                        nature = \"cr\";\n                    }\n                    if (vatTax > 0) {\n                        nature = \"dr\";\n                    } else {\n                        nature = \"cr\";\n                    }\n                    const vatTaxField = value.vatTax;\n                    if (vatTaxField.account) {\n                        if (vatTaxField.account.hasOwnProperty(\"id\")) {\n                            this.jRaw1.push({\n                                id: vatTaxField.account.id + \"-\" + nature,\n                                line: new ItemLineModel(value),\n                                memoRate: kendo.parseFloat(this.creditMemo.txnRate),\n                                lastXRate: this.creditMemo.exchangeRate,\n                                currencyCode: currencyCode,\n                                currency: currency,\n                                description: \"Tax\",\n                                account: vatTaxField.account,\n                                accountId: vatTaxField.account.id,\n                                amount: vatTax,\n                                exchangeAmount:\n                                    vatTax * kendo.parseFloat(this.creditMemo.txnRate),\n                                type: nature,\n                                typeAs: \"tax\",\n                            });\n                        }\n                    }\n                }\n                totalTax +=\n                    kendo.parseFloat(spTax ? spTax : 0) +\n                    kendo.parseFloat(pltax ? pltax : 0) +\n                    kendo.parseFloat(otherTax ? otherTax : 0) +\n                    kendo.parseFloat(vatTax ? vatTax : 0);\n                subTotal +=\n                    kendo.parseFloat(value.amount) + modifierPrice - incTax;\n                const amt =\n                    kendo.parseFloat(value.amount) + modifierPrice - incTax + whTaxAmount;\n                const xAmount =\n                    kendo.parseFloat(amt) * kendo.parseFloat(this.creditMemo.txnRate);\n                const item = value.item;\n                const itmType = item.type || \"\";\n                if (itmType === \"Variant\") {\n                    itemSubtotal +=\n                        kendo.parseFloat(value.cost) * kendo.parseFloat(value.qty);\n                    itemDiscount += kendo.parseFloat(discount);\n                } else if (itmType === \"Service\") {\n                    serviceSubtotal +=\n                        kendo.parseFloat(value.cost) * kendo.parseFloat(value.qty);\n                    itemDiscount += kendo.parseFloat(discount);\n                } else {\n                    txnItmSubtotal +=\n                        kendo.parseFloat(value.cost) * kendo.parseFloat(value.qty);\n                    itemDiscount += kendo.parseFloat(discount);\n                }\n                const wac = parseFloat(value.wac || 0)\n                const qty = parseFloat(value.qty || 1)\n                if (amt > 0) {\n                    nature = \"dr\";\n                } else {\n                    nature = \"cr\";\n                }\n                if (item) {\n                    if (item.type === \"Service\") {\n                        let incomeAcc = item.incomeAcc;\n                        if (item.hasOwnProperty(\"incomeAcc\")) {\n                            if (item.incomeAcc.hasOwnProperty(\"id\")) {\n                                this.jRaw1.push({\n                                    id: incomeAcc.id + \"-\" + nature,\n                                    line: new ItemLineModel(value),\n                                    memoRate: kendo.parseFloat(this.creditMemo.txnRate),\n                                    lastXRate: this.creditMemo.exchangeRate,\n                                    currencyCode: currencyCode,\n                                    currency: currency,\n                                    description: this.creditMemo.journalNote,\n                                    account: incomeAcc,\n                                    accountId: incomeAcc.id,\n                                    amount: amt,\n                                    exchangeAmount: xAmount,\n                                    type: nature,\n                                    typeAs: \"item\",\n                                });\n                            }\n                        }\n                        if (item.hasOwnProperty(\"deferredIncomeAcc\")) {\n                            if (item.deferredIncomeAcc.hasOwnProperty(\"id\")) {\n                                let deferredInAcc = item.deferredIncomeAcc;\n                                this.jRaw1.push({\n                                    id: deferredInAcc.id + \"-\" + nature,\n                                    line: new ItemLineModel(value),\n                                    memoRate: kendo.parseFloat(this.creditMemo.txnRate),\n                                    lastXRate: this.creditMemo.exchangeRate,\n                                    currencyCode: currencyCode,\n                                    currency: currency,\n                                    description: this.creditMemo.journalNote,\n                                    account: deferredInAcc,\n                                    accountId: deferredInAcc.id,\n                                    amount: amt,\n                                    exchangeAmount: xAmount,\n                                    type: nature,\n                                    typeAs: \"item\",\n                                });\n                            }\n                        }\n                    } else if (item.type === \"Variant\") {\n                        if (item.hasOwnProperty(\"incomeAcc\")) {\n                            if (item.incomeAcc.hasOwnProperty(\"id\")) {\n                                let incomeAcc = item.incomeAcc;\n                                this.jRaw1.push({\n                                    id: incomeAcc.id + \"-\" + nature,\n                                    line: new ItemLineModel(value),\n                                    memoRate: kendo.parseFloat(this.creditMemo.txnRate),\n                                    lastXRate: this.creditMemo.exchangeRate,\n                                    currencyCode: currencyCode,\n                                    currency: currency,\n                                    description: this.creditMemo.journalNote,\n                                    account: item.incomeAcc,\n                                    accountId: item.incomeAcc.id,\n                                    amount: amt,\n                                    exchangeAmount: xAmount,\n                                    type: nature,\n                                    typeAs: \"item\",\n                                });\n                            }\n                        }\n                        if (item.hasOwnProperty(\"inventoryAcc\")) {\n                            nature = \"cr\";\n                            if (item.inventoryAcc.hasOwnProperty(\"id\")) {\n                                let inventoryAcc = item.inventoryAcc;\n                                this.jRaw1.push({\n                                    id: inventoryAcc.id + \"-\" + nature,\n                                    line: new ItemLineModel(value),\n                                    memoRate: kendo.parseFloat(this.creditMemo.txnRate),\n                                    lastXRate: this.creditMemo.exchangeRate,\n                                    currencyCode: currencyCode,\n                                    currency: currency,\n                                    description: this.creditMemo.journalNote,\n                                    account: item.inventoryAcc,\n                                    accountId: item.inventoryAcc.id,\n                                    amount: (qty * wac) * -1,\n                                    exchangeAmount: (qty * wac) * -1, //xAmount,\n                                    type: nature,\n                                    typeAs: \"item\",\n                                });\n                            }\n                        }\n                        if (item.hasOwnProperty(\"costOfGoodsSoldAcc\")) {\n                            nature = \"dr\";\n                            if (item.costOfGoodsSoldAcc.hasOwnProperty(\"id\")) {\n                                let costOfGoodsSoldAcc = item.costOfGoodsSoldAcc;\n                                this.jRaw1.push({\n                                    id: costOfGoodsSoldAcc.id + \"-\" + nature,\n                                    line: new ItemLineModel(value),\n                                    memoRate: kendo.parseFloat(this.creditMemo.txnRate),\n                                    lastXRate: this.creditMemo.exchangeRate,\n                                    currencyCode: currencyCode,\n                                    currency: currency,\n                                    description: this.creditMemo.journalNote,\n                                    account: item.costOfGoodsSoldAcc,\n                                    accountId: item.costOfGoodsSoldAcc.id,\n                                    amount: qty * wac, // qty*avg_cost ,\n                                    exchangeAmount: qty * wac, //xAmount,\n                                    type: nature,\n                                    typeAs: \"item\",\n                                });\n                            }\n                        }\n                    } else if (item.type === \"Fixed Asset\") {\n                        if (item.hasOwnProperty(\"assetAcc\")) {\n                            if (item.assetAcc.hasOwnProperty(\"id\")) {\n                                let assetAcc = item.assetAcc;\n                                this.jRaw1.push({\n                                    id: assetAcc.id + \"-\" + nature,\n                                    line: new ItemLineModel(value),\n                                    memoRate: kendo.parseFloat(this.creditMemo.txnRate),\n                                    lastXRate: this.creditMemo.exchangeRate,\n                                    currencyCode: currencyCode,\n                                    currency: currency,\n                                    description: this.creditMemo.journalNote,\n                                    account: item.assetAcc,\n                                    accountId: item.assetAcc.id,\n                                    amount: amt,\n                                    exchangeAmount: xAmount,\n                                    type: nature,\n                                    typeAs: \"item\",\n                                });\n                            }\n                        }\n                    } else if (item.type === \"Transaction Item\") {\n                        if (item.hasOwnProperty(\"account\")) {\n                            if (item.account.hasOwnProperty(\"id\")) {\n                                this.jRaw1.push({\n                                    id: item.account.id + \"-\" + nature,\n                                    line: new ItemLineModel(value),\n                                    memoRate: kendo.parseFloat(this.creditMemo.txnRate),\n                                    lastXRate: this.creditMemo.exchangeRate,\n                                    currencyCode: currencyCode,\n                                    currency: currency,\n                                    description: this.creditMemo.journalNote,\n                                    account: item.account,\n                                    accountId: item.account.id,\n                                    amount: amt,\n                                    exchangeAmount: xAmount,\n                                    type: nature,\n                                    typeAs: \"item\",\n                                });\n                            }\n                        }\n                    }\n                }\n                //include Tax Amount\n                const amountNodiscount = kendo.parseFloat(value.price) * kendo.parseFloat(value.qty) - discount;\n                const includeTaxAmount = amountNodiscount + vatTax + pltax + spTax + otherTax;\n                value[\"includeTaxAmount\"] = includeTaxAmount;\n                value[\"includeTaxExchangeAmount\"] = includeTaxAmount * kendo.parseFloat(this.creditMemo.txnRate);\n            });\n            // }\n\n            this.creditMemo.itemSubtotal = itemSubtotal;\n            this.creditMemo.inclusiveTaxAmount = inclusiveTax;\n            this.creditMemo.exchangeItemSubtotal =\n                itemSubtotal * kendo.parseFloat(this.creditMemo.txnRate);\n            this.creditMemo.serviceSubtotal = serviceSubtotal;\n            this.creditMemo.exchangeServiceSubtotal =\n                serviceSubtotal * kendo.parseFloat(this.creditMemo.txnRate);\n            this.creditMemo.txnItmSubtotal = txnItmSubtotal;\n            this.creditMemo.exchangeTxnItmSubtotal =\n                txnItmSubtotal * kendo.parseFloat(this.creditMemo.txnRate);\n            this.creditMemo.itemDiscount = itemDiscount;\n            this.creditMemo.exchangeItemDiscount =\n                itemDiscount * kendo.parseFloat(this.creditMemo.txnRate);\n            this.creditMemo.serviceDiscount = serviceDiscount;\n            this.creditMemo.exchangeServiceDiscount =\n                serviceDiscount * kendo.parseFloat(this.creditMemo.txnRate);\n            this.creditMemo.txnItmDiscount = txnDiscount;\n            this.creditMemo.exchangeTxnItmDiscount =\n                txnDiscount * kendo.parseFloat(this.creditMemo.txnRate);\n\n            // window.console.log(spTax, pltax, otherTax, vatTax)\n            let total =\n                kendo.parseFloat(subTotal) -\n                kendo.parseFloat(discountTotal) +\n                kendo.parseFloat(totalTax);\n            this.creditMemo.withholdingTaxAmount = withholdingTaxAmount\n            this.creditMemo.itemLineSubTotal = subTotal;\n            this.creditMemo.itemLineTaxAmount = kendo.parseFloat(totalTax);\n            this.creditMemo.itemLineDiscountAmount = kendo.parseFloat(discountTotal);\n            this.creditMemo.itemLineAmount = kendo.parseFloat(total) - parseFloat(withholdingTaxAmount);\n            // this.autoCalculateTaxByType(taxList)\n            this.customerDiscountItem = this.removeDuplicate(discountItem);\n            this.customerSaleUnit = this.removeDuplicate(saleUnit);\n            this.taxListDetail = taxListDetail\n            this.creditMemo.itemLineExchangeAmount =\n                kendo.parseFloat(this.creditMemo.itemLineAmount) *\n                kendo.parseFloat(this.creditMemo.txnRate);\n            this.shrinkDiscountItem(discountItem);\n            this.autoCalculateTaxDetail();\n            // this.creditMemo.amount = kendo.parseFloat(this.creditMemo.itemLineAmount)\n            // this.creditMemo.variance = kendo.parseFloat(this.creditMemo.itemLineAmount)\n            // this.calculateAmount()\n        },\n        shrinkDiscountItem(discountItem) {\n            let uniqueDiscountItems = [];\n            const unique = this.removeDuplicate(discountItem);\n            unique.forEach((m) => {\n                const found = discountItem.filter((n) => n.id === m.id);\n                let amount = 0,\n                    exchangeAmount = 0;\n                found.map((o) => {\n                    amount += o.amount || 0;\n                });\n                found.map((o) => {\n                    exchangeAmount += o.exchangeAmount || 0;\n                });\n                uniqueDiscountItems.push({\n                    id: m.id,\n                    name: m.name,\n                    amount: amount,\n                    exchangeAmount: exchangeAmount,\n                });\n            });\n            this.customerDiscountItem = uniqueDiscountItems;\n            this.creditMemo.customerDiscountItem = uniqueDiscountItems;\n            window.console.log(uniqueDiscountItems, \"uniqueDiscountItems\");\n        },\n        autoCalculateApplyTo() {\n            let ds = this.$refs.applyToLineDS.kendoWidget(),\n                convertedAmount = 0,\n                amount = 0;\n            this.jRaw5 = [];\n            let txnRate = 1,\n                currency = this.creditMemo.currency,\n                currencyCode = this.creditMemo.currency\n                    ? this.creditMemo.currency.code\n                    : \"\";\n            ds.data().forEach((value) => {\n                const offsetAmount = kendo.parseFloat(\n                    value.paidAmount ? value.paidAmount : 0\n                );\n                if (offsetAmount > 0) {\n                    amount += kendo.parseFloat(value.paidAmount);\n                    convertedAmount +=\n                        kendo.parseFloat(value.paidAmount) *\n                        kendo.parseFloat(value.txnRate);\n                    txnRate = kendo.parseFloat(value.txnRate);\n                }\n            });\n            this.creditMemo.applyToExchangeAmount = convertedAmount;\n            this.creditMemo.applyToAmount = amount;\n            //todo: AR\n            const receivableAcc = this.customer.receivableAcc || {};\n            let nature = \"\";\n            if (this.creditMemo.itemLineAmount * -1 > 0) {\n                nature = \"dr\";\n            } else {\n                nature = \"cr\";\n            }\n            if (receivableAcc) {\n                if (receivableAcc.hasOwnProperty(\"id\")) {\n                    this.jRaw5.push({\n                        id: receivableAcc.id + \"-\" + nature,\n                        line: new ItemLineModel(),\n                        memoRate: txnRate,\n                        lastXRate: this.creditMemo.exchangeRate,\n                        currencyCode: currencyCode,\n                        currency: currency,\n                        description: this.creditMemo.transactionNote,\n                        account: receivableAcc,\n                        accountId: receivableAcc.id,\n                        exchangeAmount: this.creditMemo.applyToExchangeAmount * -1,\n                        amount: this.creditMemo.applyToAmount * -1,\n                        type: nature,\n                        typeAs: \"ar\",\n                    });\n                }\n            }\n            // this.calculateAmount()\n        },\n        calculateAmount() {\n            let offsetXAmount = 0,\n                offsetAmount = 0; // applyto_amount + deposit + cash refund\n            const applyToExchangeAmount = kendo.parseFloat(\n                this.creditMemo.applyToExchangeAmount\n            );\n            const exchangeDepositAmount = kendo.parseFloat(\n                this.creditMemo.exchangeDepositDeduction\n            );\n            const exchangeRefundAmount = kendo.parseFloat(\n                this.creditMemo.exchangeRefundAmount\n            );\n\n            const applyToAmount = kendo.parseFloat(this.creditMemo.applyToAmount);\n            const depositAmount = kendo.parseFloat(this.creditMemo.depositAmount);\n            const refundAmount = kendo.parseFloat(this.creditMemo.refundAmount);\n\n            const itemLineExchange = kendo.parseFloat(this.creditMemo.itemLineExchangeAmount);\n            const itemLineAmount = kendo.parseFloat(this.creditMemo.itemLineAmount)\n\n            offsetXAmount = kendo.parseFloat(applyToExchangeAmount + exchangeDepositAmount + exchangeRefundAmount);\n            offsetAmount = kendo.parseFloat(applyToAmount + depositAmount + refundAmount);\n\n            this.creditMemo.amount = offsetAmount;\n            this.creditMemo.exchangeAmount = offsetXAmount;\n            this.creditMemo.exchangeVariance = itemLineExchange - offsetXAmount;\n            this.creditMemo.variance = itemLineAmount - offsetAmount;\n            window.console.log(\"variance\", this.creditMemo.variance, 'exchangeVariance', this.creditMemo.exchangeVariance);\n            // if (offsetAmount > itemLineAmount) {\n            //   this.showWaringMessage('Credit Memo', 'Return amount and Offset amount must be equal!', 'OK')\n            //   // return\n            // }\n\n            this.jRaw4 = [];\n            let currency = this.creditMemo.currency,\n                currencyCode = this.creditMemo.currency\n                    ? this.creditMemo.currency.code\n                    : \"\";\n            // window.console.log(offsetAmount, 'offsetAmount')\n            if (this.creditMemo.exchangeVariance !== 0) {\n                this.jRaw4 = [];\n                let nature = \"\";\n                if (this.creditMemo.varianceAcc) {\n                    if (this.creditMemo.exchangeVariance * -1 > 0) {\n                        nature = \"dr\";\n                    } else {\n                        nature = \"cr\";\n                    }\n                    const varianceAcc = this.creditMemo.varianceAcc;\n                    if (varianceAcc.hasOwnProperty(\"id\")) {\n                        this.jRaw4.push({\n                            id: varianceAcc.id + \"-\" + nature,\n                            line: new ItemLineModel(),\n                            memoRate: this.creditMemo.txnRate,\n                            lastXRate: this.creditMemo.exchangeRate,\n                            currencyCode: currencyCode,\n                            currency: currency,\n                            description: \"Variance\",\n                            account: varianceAcc,\n                            accountId: varianceAcc.id,\n                            amount: this.creditMemo.variance * -1,\n                            exchangeAmount: this.creditMemo.exchangeVariance * -1,\n                            type: nature,\n                            typeAs: \"GainLoss\",\n                        });\n                    }\n                }\n            }\n            this.shrinkData();\n            return offsetAmount;\n        },\n        autoCalculateDeposit() {\n            let ds = this.$refs.depositLineDS.kendoWidget(),\n                amount = 0,\n                convertedAmount = 0;\n            let nature = \"\";\n            this.jRaw2 = [];\n            let currency = this.creditMemo.currency,\n                currencyCode = this.creditMemo.currency\n                    ? this.creditMemo.currency.code\n                    : \"\";\n            ds.data().forEach((value) => {\n                let description = \"\";\n                if (value.amount) {\n                    amount += kendo.parseFloat(value.amount);\n                    convertedAmount +=\n                        kendo.parseFloat(value.amount) *\n                        kendo.parseFloat(this.creditMemo.txnRate);\n                }\n                if (value.description) {\n                    description = value.description || \"\";\n                }\n                if (value.account) {\n                    const account = value.account;\n                    if (account) {\n                        if (account.hasOwnProperty(\"id\")) {\n                            if (amount * -1 > 0) {\n                                nature = \"dr\";\n                            } else {\n                                nature = \"cr\";\n                            }\n                            this.jRaw2.push({\n                                id: account.id + \"-\" + nature,\n                                description: \"Deposit \" + description,\n                                line: new ItemLineModel(),\n                                memoRate: this.creditMemo.txnRate,\n                                lastXRate: this.creditMemo.exchangeRate,\n                                currencyCode: currencyCode,\n                                currency: currency,\n                                account: account,\n                                accountId: account.id,\n                                amount: amount * -1,\n                                exchangeAmount:\n                                    amount * kendo.parseFloat(this.creditMemo.txnRate) * -1,\n                                type: nature,\n                                typeAs: \"deposit\",\n                            });\n                        }\n                    }\n                }\n            });\n\n            this.creditMemo.depositAmount = amount;\n            this.creditMemo.exchangeDepositDeduction = convertedAmount;\n            // this.calculateAmount()\n        },\n        checkAmount(amountReturn, offsetAmount) {\n            return offsetAmount > amountReturn;\n        },\n        autoCalculateCashRefund() {\n            let ds = this.$refs.cashRefundDS.kendoWidget(),\n                amount = 0,\n                exchangeAmount = 0;\n            let nature = \"\";\n            this.jRaw3 = [];\n            let currency = this.creditMemo.currency,\n                currencyCode = this.creditMemo.currency\n                    ? this.creditMemo.currency.code\n                    : \"\";\n            ds.data().forEach((value) => {\n                let description = \"\";\n                if (value.amount) {\n                    amount += kendo.parseFloat(value.amount);\n                    exchangeAmount +=\n                        kendo.parseFloat(value.amount) *\n                        kendo.parseFloat(this.creditMemo.txnRate);\n                }\n                if (value.description) {\n                    description = value.description || \"\";\n                }\n                //todo: Cash Account\n                if (value.account) {\n                    const account = value.account;\n                    if (account) {\n                        if (account.hasOwnProperty(\"id\")) {\n                            if (amount * -1 > 0) {\n                                nature = \"dr\";\n                            } else {\n                                nature = \"cr\";\n                            }\n                            this.jRaw3.push({\n                                id: account.id + \"-\" + nature,\n                                description: \"Deposit \" + description,\n                                line: new ItemLineModel(),\n                                memoRate: this.creditMemo.txnRate,\n                                lastXRate: this.creditMemo.exchangeRate,\n                                currencyCode: currencyCode,\n                                currency: currency,\n                                account: account,\n                                accountId: account.id,\n                                exchangeAmount:\n                                    kendo.parseFloat(this.creditMemo.txnRate) * amount * -1,\n                                amount: amount * -1,\n                                type: nature,\n                                typeAs: \"CashAccount\",\n                            });\n                        }\n                    }\n                }\n            });\n            this.creditMemo.refundAmount = amount;\n            this.creditMemo.exchangeRefundAmount = exchangeAmount;\n            // this.calculateAmount()\n        },\n        autoCalculateAccountLine() {\n            let ds = this.$refs.accountLineDS.kendoWidget(),\n                subTotal = 0,\n                totalTax = 0,\n                discountTotal = 0,\n                vatTax = 0,\n                taxList = [],\n                discountItem = [];\n\n            ds.data().forEach((value) => {\n                if (value.amount) {\n                    subTotal += kendo.parseFloat(value.amount);\n                }\n\n                let discount = 0;\n                if (value.discountItem) {\n                    let subTo = kendo.parseFloat(value.amount ? value.amount : 0);\n                    discount = this.autoCalculateDiscount(value.discountItem, subTo);\n                    if (value.discountItem.hasOwnProperty(\"id\")) {\n                        discountItem.push(value.discountItem);\n                    }\n                    discountTotal += discount ? discount : 0;\n                }\n                if (value.vatTax) {\n                    let amt =\n                        kendo.parseFloat(value.amount ? value.amount : 0) -\n                        (discount ? discount : 0);\n                    vatTax = this.autoCalculateTax(value.vatTax, amt);\n                    vatTax = kendo.parseFloat(vatTax) ? kendo.parseFloat(vatTax) : 0;\n                    if (value.vatTax.hasOwnProperty(\"taxType\")) {\n                        taxList.push({\n                            name: value.vatTax.taxType.name,\n                            amount: vatTax,\n                            id: value.vatTax.taxType.id,\n                        });\n                    }\n                }\n                totalTax += kendo.parseFloat(vatTax ? vatTax : 0);\n            });\n            const amount = this.creditMemo.itemLineAmount;\n            const taxAmount = this.creditMemo.itemLineTaxAmount;\n            const discount = this.creditMemo.itemLineDiscountAmount;\n            // const subTotal = this.creditMemo.itemLineSubTotal\n\n            this.creditMemo.accountLineAmount =\n                kendo.parseFloat(subTotal) -\n                kendo.parseFloat(discountTotal) +\n                kendo.parseFloat(totalTax);\n            this.creditMemo.accountLineTaxAmount = kendo.parseFloat(totalTax);\n            this.creditMemo.accountLineDiscountAmount = kendo.parseFloat(\n                discountTotal\n            );\n\n            this.creditMemo.amount =\n                kendo.parseFloat(amount) +\n                kendo.parseFloat(this.creditMemo.accountLineAmount);\n            this.creditMemo.taxAmount =\n                kendo.parseFloat(taxAmount) +\n                kendo.parseFloat(this.creditMemo.accountLineTaxAmount);\n            this.creditMemo.discount =\n                kendo.parseFloat(discount) +\n                kendo.parseFloat(this.creditMemo.accountLineDiscountAmount);\n            // this.autoCalculateTaxByType(taxList)\n            // window.console.log(this.creditMemo.accountLineAmount, this.creditMemo.accountLineTaxAmount, this.creditMemo.accountLineDiscountAmount, '--')\n        },\n        removeDuplicate(array) {\n            const result = [];\n            const map = new Map();\n            for (const item of array) {\n                if (!map.has(item.id)) {\n                    map.set(item.id, true); // set any value to Map\n                    result.push(item);\n                }\n            }\n            return result;\n        },\n        autoCalculateTaxByType(tax) {\n            // return by a key\n            const groupAll = (list) =>\n                list.reduce((tax, item) => {\n                    const taxAmount = tax[item.name] || 0;\n                    return Object.assign({}, tax, {\n                        [item.name]: taxAmount + parseFloat(item.amount),\n                    });\n                }, {});\n            this.taxListTotal = groupAll(tax);\n        },\n        async loadEmployeeCenter() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    this.employees = [];\n                    employeeHandler\n                        .center(undefined)\n                        .then((res) => {\n                            if (res.data.statusCode === 200) {\n                                this.showLoading = false;\n                                this.employees = res.data.data;\n                                if (this.employees.length > 0) {\n                                    this.creditMemo.employee = this.employees[0];\n                                }\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 50);\n            });\n        },\n        async loadPrefix() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    prefixHandler.get(\"sale return\").then((res) => {\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false;\n                            this.transactionType = res.data.data;\n                            if (this.transactionType.length > 0) {\n                                this.creditMemo.transactionType = this.transactionType[0];\n                                if (this.$route.params.id === undefined) {\n                                    this.generateNumber();\n                                }\n                            }\n                        }\n                    });\n                }, 50);\n            });\n        },\n        async loadSaleUnitItems() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    saleUnitItemHandler.list().then((res) => {\n                        if (res.data.statusCode === 200)\n                            this.saleUnitItemList = res.data.data;\n                    });\n                }, 50);\n            });\n        },\n        onFilterChange(event) {\n            const filter = event.filter.value;\n            this.requestData(0, filter, this.cusBaseUrl);\n            this.filter = filter;\n        },\n        requestData(skip, filter, baseUrl) {\n            const url = baseUrl + `?filter=${filter}`;\n            fetch(url)\n                .then((response) => {\n                    return response.json();\n                })\n                .then(this.afterFetch);\n        },\n        afterFetch(json) {\n            this.customerList = json.data;\n        },\n        onChange(event) {\n            const value = event.value;\n            if (value && value[\"numberName\"] === emptyItem[\"numberName\"]) {\n                return;\n            }\n            this.isLoading = 0\n            if (value) {\n                this.customer = value;\n                const saleDepositAcc = value.hasOwnProperty(\"saleDepositAcc\")\n                    ? value.saleDepositAcc\n                    : {};\n                this.creditMemo.customer = value;\n                this.creditMemo.priceLevel = value.hasOwnProperty(\"priceLevel\")\n                    ? value.priceLevel\n                    : {};\n                this.decimalFormat = value.decimalFormat;\n                if (value.baseCurrency) {\n                    this.baseCurrencyCode = value.baseCurrency.hasOwnProperty(\"code\")\n                        ? value.baseCurrency.code\n                        : \"\";\n                    this.accDeposit = this.accDeposits.filter(\n                        (o) => o.id === saleDepositAcc.id\n                    );\n                }\n\n                this.loadTransactionRate();\n                this.loadProjectByCustomer();\n                // this.searchInvoice();\n            }\n        },\n        hideSmallSidebar() {\n            this.isHideBar = !this.isHideBar;\n        },\n        generateNumber() {\n            if (this.$route.params.id) {\n                const tranDate = new Date(this.transactionDate);\n                const tranDateInvoice = new Date(this.creditMemo.transactionDate);\n                const tranDateM = tranDate.getFullYear() + tranDate.getMonth();\n                const tranDateInvoiceM =\n                    tranDateInvoice.getFullYear() + tranDateInvoice.getMonth();\n                if (tranDateM === tranDateInvoiceM) {\n                    this.creditMemo.referenceNo = this.referenceNo;\n                    return;\n                }\n            }\n\n            if (this.transactionDate !== \"\" && this.transactionType.length > 0) {\n                let data = {\n                    abbr: this.creditMemo.transactionType.abbr,\n                    structure: this.creditMemo.transactionType.structure,\n                    transactionDate: this.transactionDate,\n                    sequcencing: this.creditMemo.transactionType.sequcencing,\n                    type: \"Credit Memo\",\n                    entity: 1,\n                };\n                billingHandler\n                    .lastNumber(data)\n                    .then((response) => {\n                        if (response.data.statusCode === 200) {\n                            const res = response.data.data;\n                            const lastNumber = this.zeroPad(\n                                parseInt(res.lastNumber),\n                                this.creditMemo.transactionType.format\n                            );\n                            const number =\n                                res.suffix +\n                                this.creditMemo.transactionType.numberSeparator +\n                                lastNumber;\n                            this.creditMemo.number = number;\n                        }\n                    })\n                    .catch((e) => {\n                        this.errors.push(e);\n                    });\n            }\n        },\n        zeroPad(num, places) {\n            return String(num).padStart(places, \"0\");\n        },\n        suffix(transactionDate) {\n            return kendo.toString(new Date(transactionDate), `yymm`);\n        },\n        cancel() {\n            this.$swal({\n                title: i18n.t(\"msg_title_warning\"),\n                text: i18n.t(\"msg_discard\"),\n                icon: \"warning\",\n                showCancelButton: true,\n                cancelButtonText: i18n.t(\"cancel\"),\n                confirmButtonColor: \"#4d4848\",\n                cancelButtonColor: \"#ED1A3A\",\n                confirmButtonText: i18n.t(\"discard\"),\n            }).then((resultCan) => {\n                if (resultCan.value) {\n                    this.clear();\n                    this.$router.go(-1);\n                }\n            });\n        },\n        removeRow(e) {\n            e.preventDefault();\n            const grid = kendo.jQuery(\"#gridItemLine\").data(\"kendoGrid\"),\n                dataSource = grid.dataSource,\n                dataItem = grid.dataItem($(e.currentTarget).closest(\"tr\"));\n\n            if (dataSource.total() > 1) {\n                dataSource.remove(dataItem);\n                this.autoCalculate();\n            }\n        },\n        removeRowAcc(e) {\n            e.preventDefault();\n            const grid = $(\"#\").data(\"kendoGrid\"),\n                dataSource = grid.dataSource,\n                dataItem = grid.dataItem($(e.currentTarget).closest(\"tr\"));\n\n            if (dataSource.total() > 1) {\n                dataSource.remove(dataItem);\n            }\n        },\n        vatTemplate(dataItem) {\n            const vat = dataItem.vatTax;\n            if (vat) {\n                return `<span>${vat.defaultTax ? vat.defaultTax : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        accountTemplate(dataItem) {\n            const account = dataItem.account;\n            if (account) {\n                return `<span>${account.name ? account.name : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        itemTemplate(dataItem) {\n            const item = dataItem.item;\n            if (item) {\n                return `<span>${item.name ? item.name : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        UOMTemplate(dataItem) {\n            const uom = dataItem.uom;\n            const code = uom.code || ''\n            if (uom) {\n                return `<span>${uom.uom ? code : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        saleUnitTemplate(dataItem) {\n            const saleUnit = dataItem.saleUnit;\n            if (saleUnit) {\n                return `<span>${saleUnit.name ? saleUnit.name : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        empImpl(dataItem) {\n            let empIds = [];\n            dataItem.employee.forEach((m) => {\n                empIds.push(m.firstName + \" - \" + m.lastName);\n            });\n            // window.console.log(empIds.join(', '))\n            return `<span>${empIds.join(\", \")}</span>`;\n        },\n        discountItemTemplate(dataItem) {\n            const discountItem = dataItem.discountItem;\n            if (discountItem) {\n                return `<span>${discountItem.code ? discountItem.code : ``} - ${\n                    discountItem.name ? discountItem.name : ``\n                }</span>`;\n            } else {\n                return ``;\n            }\n        },\n        ItemDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"contains\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    headerTemplate:\n                        '<div class=\"dropdown-header k-widget k-header\">' +\n                        \"<span>Items </span>\" +\n                        \"<span></span>\" +\n                        \"</div>\",\n                    template: \"<span>#=name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        serverFiltering: true,\n                        transport: {\n                            read: {\n                                url: productVariantHandler.itemSearchURL(),\n                            },\n                            dataType: \"json\",\n                        },\n                        schema: {\n                            model: {\n                                id: \"id\",\n                                fields: {\n                                    id: {type: \"string\"},\n                                    name: {type: \"string\"},\n                                    sku: {type: \"string\"},\n                                },\n                            },\n                            data: function (response) {\n                                return response.data;\n                            },\n                            total: function (response) {\n                                return response.data.count;\n                            },\n                        },\n                        // data: this.variants\n                    }),\n                });\n        },\n        OtherChargeDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=name#</span>\",\n                    optionLabel: \"--Select--\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.otherChargeList,\n                    }),\n                });\n        },\n        UOMDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"code\",\n                    dataValueField: \"uomConvertId\",\n                    cascadeFrom: \"item\",\n                    template: \"<span>#=code || `No Price Level`#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        serverFiltering: true,\n                        transport: {\n                            read: {\n                                // url: uomPriceHandler.getURL(options.model.item.id, this.creditMemo.priceLevel.id, options.model.item.type),\n                                url: uomPriceHandler.uomPriceByPriceLevelURL(\n                                    \"id=\" +\n                                    options.model.item.id +\n                                    \"&plId=\" +\n                                    this.creditMemo.priceLevel.id +\n                                    \"&date=\" +\n                                    this.transactionDate\n                                ),\n                            },\n                            dataType: \"json\",\n                        },\n                        schema: {\n                            model: {\n                                id: \"id\",\n                                fields: {\n                                    id: {type: \"string\"},\n                                    // name: {type: \"string\"},\n                                    // sku: {type: \"string\"},\n                                },\n                            },\n                            data: function (response) {\n                                return response.data;\n                            },\n                            total: function (response) {\n                                return response.data.count;\n                            },\n                        },\n                        // data: this.variants\n                    }),\n                });\n        },\n        DiscountItemDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    cascadeFrom: \"item\",\n                    template: \"<span>#=code# - #=name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        serverFiltering: true,\n                        transport: {\n                            read: {\n                                url: discountItemHandler.getURL(DISCOUNT_TYPE),\n                            },\n                            dataType: \"json\",\n                        },\n                        schema: {\n                            model: {\n                                id: \"id\",\n                                fields: {\n                                    id: {type: \"string\"},\n                                    // name: {type: \"string\"},\n                                    // sku: {type: \"string\"},\n                                },\n                            },\n                            data: function (response) {\n                                return response.data;\n                            },\n                            total: function (response) {\n                                return response.data.count;\n                            },\n                        },\n                    }),\n                });\n        },\n        SpecificTaxDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"defaultTax\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=defaultTax#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.specificTax.filter((m) => {\n                            if (options.model.hasOwnProperty(\"vatTax\")) {\n                                const vat = options.model.vatTax;\n                                if (vat) {\n                                    if (\n                                        options.model.vatTax !== null ||\n                                        options.model.vatTax !== \"null\"\n                                    ) {\n                                        if (options.model.vatTax.baseAmount) {\n                                            return (\n                                                m.baseAmount.toLowerCase() ===\n                                                options.model.vatTax.baseAmount.toLowerCase()\n                                            );\n                                        } else {\n                                            return m;\n                                        }\n                                    }\n                                } else {\n                                    return m;\n                                }\n                            }\n                        }),\n                    }),\n                });\n        },\n        PublicLightingTaxDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"defaultTax\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=defaultTax#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.publicLightingTax.filter((m) => {\n                            if (options.model.hasOwnProperty(\"vatTax\")) {\n                                const vat = options.model.vatTax;\n                                if (vat) {\n                                    if (\n                                        options.model.vatTax !== null &&\n                                        options.model.vatTax !== \"null\"\n                                    ) {\n                                        if (options.model.vatTax.baseAmount) {\n                                            return (\n                                                m.baseAmount.toLowerCase() ===\n                                                options.model.vatTax.baseAmount.toLowerCase()\n                                            );\n                                        } else {\n                                            return m;\n                                        }\n                                    }\n                                } else {\n                                    return m;\n                                }\n                            }\n                        }),\n                    }),\n                });\n        },\n        OtherTaxDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"defaultTax\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=defaultTax#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.otherTax.filter((m) => {\n                            if (options.model.hasOwnProperty(\"vatTax\")) {\n                                const vat = options.model.vatTax;\n                                if (vat) {\n                                    if (\n                                        options.model.vatTax !== null &&\n                                        options.model.vatTax !== \"null\"\n                                    ) {\n                                        if (options.model.vatTax.baseAmount) {\n                                            return (\n                                                m.baseAmount.toLowerCase() ===\n                                                options.model.vatTax.baseAmount.toLowerCase()\n                                            );\n                                        } else {\n                                            return m;\n                                        }\n                                    }\n                                } else {\n                                    return m;\n                                }\n                            }\n                        }),\n                    }),\n                });\n        },\n        VatTaxDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"defaultTax\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=defaultTax#</span>\",\n                    optionLabel: \"--Select--\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.vatTax,\n                    }),\n                });\n        },\n        AccountDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=number# - #=name# </span>\",\n                    optionLabel: \"--Select--\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.accounts,\n                    }),\n                });\n        },\n        AccountDropDownEditorRefund(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=number# - #=name# </span>\",\n                    optionLabel: \"--Select--\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.accCash,\n                    }),\n                });\n        },\n        AccountDropDownEditorDeposit(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=number# - #=name# </span>\",\n                    optionLabel: \"--Select--\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.accDeposit,\n                    }),\n                });\n        },\n        SaleUnitDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=code# - #=name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.saleUnitItemList,\n                    }),\n                });\n        },\n        AmountEditor(container, options) {\n            kendo\n                .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoNumericTextBox({\n                    decimals: 30,\n                    format: `${this.decimalFormat}`,\n                });\n        },\n        rowNumberTmpl(dataItem) {\n            let ds = this.$refs.itemLineDS.kendoWidget(),\n                index = ds.indexOf(dataItem);\n            return index + 1;\n        },\n        rowNumberTmplAcc(dataItem) {\n            let ds = this.$refs.accountLineDS.kendoWidget(),\n                index = ds.indexOf(dataItem);\n            return index + 1;\n        },\n        rowNumberTmplDeposit(dataItem) {\n            let ds = this.$refs.depositLineDS.kendoWidget(),\n                index = ds.indexOf(dataItem);\n            return index + 1;\n        },\n        rowNumberTmplApply(dataItem) {\n            let ds = this.$refs.applyToLineDS.kendoWidget(),\n                index = ds.indexOf(dataItem);\n            return index + 1;\n        },\n        addRowOffsetInvoice() {\n            let ds = this.$refs.applyToLineDS.kendoWidget(),\n                total = ds.total();\n            ds.insert(total, this.applyToLine);\n        },\n        addRow() {\n            let ds = this.$refs.itemLineDS.kendoWidget(),\n                total = ds.total();\n            this.itemLine.id = itemLinePrefix + uuid.v1();\n            this.itemLine.decimalFormat = this.decimalFormat;\n            ds.insert(total, this.itemLine);\n            // this.itemLines.push(this.itemLine)\n            // window.console.log('item Line', this.itemLine)\n        },\n        addRowAcc() {\n            // let ds = this.$refs.accountLineDS.kendoWidget(),\n            //     total = ds.total()\n            // this.accountLine.id = itemLinePrefix + uuid.v1()\n            // ds.insert(total, this.accountLine)\n        },\n        addRowDeposit() {\n            let ds = this.$refs.depositLineDS.kendoWidget(),\n                total = ds.total();\n            this.depositLine.id = itemLinePrefix + uuid.v1();\n            this.depositLine.decimalFormat = this.decimalFormat;\n            ds.insert(total, this.depositLine);\n        },\n        addRowCashRefund() {\n            let ds = this.$refs.cashRefundDS.kendoWidget(),\n                total = ds.total();\n            this.saleDepositLine.id = itemLinePrefix + uuid.v1();\n            this.saleDepositLine.decimalFormat = this.decimalFormat;\n            this.saleDepositLine.optionType = OPTION_TYPE\n            ds.insert(total, this.saleDepositLine);\n        },\n        async loadOtherAccount() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    settingsHandler\n                        .getOtherAccount()\n                        .then((res) => {\n                            if (res.data.statusCode === 200) {\n                                this.showLoading = false;\n                                const response = res.data.data;\n                                const data = response.filter(\n                                    (o) => o.banhjiAccCode === \"740010\"\n                                );\n                                if (data.length > 0) {\n                                    this.gainLossAcc = data[0].account;\n                                }\n                                const data_ = response.filter(\n                                    (o) => o.banhjiAccCode === \"740040\"\n                                );\n                                if (data_.length > 0) {\n                                    this.otherRevenueAcc = data_[0].account;\n                                }\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 10);\n            });\n        },\n        PurchaseDiscountItemEditor() {\n        },\n        async searchInvoice() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    let data = {};\n                    this.showLoading = true;\n                    const priceLevel = this.creditMemo.priceLevel;\n                    let code = \"\";\n                    if (priceLevel.hasOwnProperty(\"currency\")) {\n                        this.creditMemo.currency = priceLevel.currency;\n                        if (priceLevel.currency.hasOwnProperty(\"code\")) {\n                            code = priceLevel.currency.code;\n                        }\n                    }\n                    data = {\n                        search: this.customer.id,\n                        type: \"customer\",\n                        status: 3,\n                        transactionDate: this.transactionDate,\n                        currency: code,\n                    };\n                    this.offsetInvoices = [];\n                    this.isLoading = 1\n                    this.showLoading = true;\n                    if (code !== \"\") {\n                        try {\n                            billingHandler.search(data).then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    const response = res.data.data;\n                                    // const result = res.data.result\n                                    this.isLoading = 0\n                                    this.showLoading = false;\n                                    if (response.length > 0) {\n                                        let uniqueIds = [];\n                                        this.offsetInvoiceList = response;\n                                        this.offsetInvoiceList.forEach((o) => {\n                                            uniqueIds.push(o.id);\n                                        });\n                                        const unique = [...new Set(uniqueIds)];\n                                        this.offsetInvoices = [];\n                                        unique.forEach((txnId) => {\n                                            const found = this.offsetInvoiceList.filter(\n                                                (j) => j.id === txnId\n                                            );\n                                            found.forEach((k) => {\n                                                this.offsetInvoices.push(k);\n                                            });\n                                        });\n                                        // const unique = [...new Set(this.offsetInvoiceList.map(item => {\n                                        //     return {\n                                        //         id: item.id,\n                                        //         referenceNo: item.referenceNo\n                                        //     }\n                                        // }))]\n                                        // this.autoCalculate()\n                                        // this.addRowOffsetInvoice()\n                                    } else {\n                                        this.isLoading = 0\n                                    }\n                                }\n                            });\n                        } catch (e) {\n                            this.isLoading = 0\n                            this.showLoading = false;\n                        }\n                    } else {\n                        this.isLoading = 0\n                    }\n                }, 50);\n            });\n        },\n        async loadPaymentOption() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    this.paymentMethod = [];\n                    paymentOptionHandler\n                        .list(strOptionFilter)\n                        .then((res) => {\n                            if (res.data.statusCode === 200) {\n                                this.showLoading = false;\n                                this.paymentMethod = res.data.data;\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 50);\n            });\n        },\n        async onSaveClose(save) {\n            if (!this.$refs.form.validate()) {\n                this.$refs.form.validate();\n                return;\n            }\n\n            const lDS = this.$refs.itemLineDS.kendoWidget();\n            let dataValidate = 0;\n            const itmLineR = lDS.data().filter((n) => n.amount > 0);\n            window.console.log('itmLineR', itmLineR)\n            if (itmLineR.length > 0) {\n                itmLineR.forEach((value, index) => {\n                    if (\n                        value.item.id === undefined ||\n                        value.uom.uom.id === undefined ||\n                        value.item.id === \"\" ||\n                        value.uom.uom.id === \"\"\n                    ) {\n                        this.$snotify.error(\n                            \"Please select return item at row \" + (index + 1)\n                        );\n                    } else {\n                        dataValidate += 1;\n                    }\n                });\n                if (itmLineR.length === dataValidate) {\n                    if (Object.keys(this.creditMemo.priceLevel).length > 0) {\n                        if (this.dr !== 0 && this.cr !== 0) {\n                            window.console.log(this.creditMemo.priceLevel, \"price level\");\n                            new Promise((resolve) => {\n                                setTimeout(() => {\n                                    resolve(\"resolved\");\n                                    let isAutoGenerate = 1;\n                                    const offsetAmount = parseFloat(\n                                        this.creditMemo.applyToAmount\n                                    );\n                                    const itemLineAmount = parseFloat(\n                                        this.creditMemo.itemLineAmount\n                                    );\n                                    const variance = parseFloat(this.creditMemo.variance);\n                                    // const lDS = this.$refs.itemLineDS.kendoWidget()\n                                    // const itmLineR = lDS.data().filter(n => n.amount > 0)\n                                    // const applyToDS = this.$refs.applyToLineDS.kendoWidget()\n                                    // const applyToLineR = applyToDS.data().filter(n => n.paidAmount > 0)\n                                    // const depositLineDS = this.$refs.depositLineDS.kendoWidget()\n                                    // const depositLineR = depositLineDS.data().filter(n => n.amount > 0)\n                                    let noDepositAcc = 0,\n                                        noCashAccount = 0,\n                                        noVarianceAcc = 0;\n                                    // if (itmLineR.length > 0 && depositLineR.length > 0 && applyToLineR.length > 0) {\n\n                                    //todo: check offset amount\n                                    window.console.log(\n                                        \"offsetAmount\",\n                                        offsetAmount,\n                                        \"itemLineAmount\",\n                                        itemLineAmount\n                                    );\n                                    if (offsetAmount > itemLineAmount) {\n                                        this.showWaringMessage(\n                                            \"Credit Memo\",\n                                            \"Return amount and Offset amount must be equal!\",\n                                            \"OK\"\n                                        );\n                                        return;\n                                    }\n                                    //todo: check customer credit case amount>0 and unselected account\n                                    let ds = this.$refs.depositLineDS.kendoWidget();\n                                    let rows = ds.data().filter((n) => n.amount > 0);\n                                    rows.forEach((itm) => {\n                                        const account = itm.account;\n                                        if (!account.hasOwnProperty(\"id\")) {\n                                            this.showWaringMessage(\n                                                \"Credit Memo\",\n                                                \"Please select deposit account\",\n                                                \"OK\"\n                                            );\n                                            noDepositAcc = 1;\n                                            return;\n                                        }\n                                    });\n                                    //todo: check Cash refund case amount>0 and unselected account\n                                    let dsRefund = this.$refs.cashRefundDS.kendoWidget();\n                                    rows = dsRefund.data().filter((n) => n.amount > 0);\n                                    rows.forEach((itm) => {\n                                        const account = itm.account;\n                                        if (!account.hasOwnProperty(\"id\")) {\n                                            this.showWaringMessage(\n                                                \"Credit Memo\",\n                                                \"Please select cash account\",\n                                                \"OK\"\n                                            );\n                                            noCashAccount = 1;\n                                            return;\n                                        }\n                                    });\n                                    //todo: check variance account\n                                    if (variance !== 0) {\n                                        const varianceAcc = this.creditMemo.varianceAcc;\n                                        if (!varianceAcc) {\n                                            // if (!variance.hasOwnProperty('id')) {\n                                            this.showWaringMessage(\n                                                \"Credit Memo\",\n                                                \"Please select variance account\",\n                                                \"OK\"\n                                            );\n                                            noVarianceAcc = 1;\n                                            return;\n                                            // }\n                                        }\n                                    }\n                                    if (\n                                        noVarianceAcc === 0 &&\n                                        noDepositAcc === 0 &&\n                                        noCashAccount === 0\n                                    ) {\n                                        if (this.$route.params.id) {\n                                            const tranDate = new Date(this.transactionDate);\n                                            const tranDateInvoice = new Date(\n                                                this.creditMemo.transactionDate\n                                            );\n                                            const tranDateM =\n                                                tranDate.getFullYear() + tranDate.getMonth();\n                                            const tranDateInvoiceM =\n                                                tranDateInvoice.getFullYear() +\n                                                tranDateInvoice.getMonth();\n                                            if (tranDateM === tranDateInvoiceM) {\n                                                isAutoGenerate = 0;\n                                            }\n                                        }\n                                        let itemLineDS = this.$refs.itemLineDS.kendoWidget();\n                                        let applyToLineDS = this.$refs.applyToLineDS.kendoWidget();\n                                        let cashRefundDS = this.$refs.cashRefundDS.kendoWidget();\n                                        let depositLineDS = this.$refs.depositLineDS.kendoWidget();\n                                        const itemLineR = itemLineDS\n                                            .data()\n                                            .filter((o) => o.amount)\n                                            .map((n) => {\n                                                const otherCharge = new OtherChargeModel(n.otherCharge || {})\n                                                n['otherCharge'] = otherCharge\n                                                return new ItemLineModel(n);\n                                            });\n                                        const applyToLineR = applyToLineDS\n                                            .data()\n                                            .filter((o) => o.paidAmount)\n                                            .map((n) => {\n                                                return new ApplyToLineModel(n);\n                                            });\n                                        const depositLineR = depositLineDS\n                                            .data()\n                                            .filter((o) => o.amount)\n                                            .map((n) => {\n                                                return new DepositLineModel(n);\n                                            });\n                                        const cashRefundR = cashRefundDS\n                                            .data()\n                                            .filter((o) => o.amount)\n                                            .map((n) => {\n                                                return {...n};\n                                            });\n                                        let data = {\n                                            id: this.creditMemo.id ? this.creditMemo.id : \"\",\n                                            type: \"Credit Memo\",\n                                            uuid: this.creditMemo.uuid ? this.creditMemo.uuid : \"\",\n                                            journal_uuid: this.creditMemo.journal_uuid\n                                                ? this.creditMemo.journal_uuid\n                                                : \"\",\n                                            number: this.creditMemo.number,\n                                            abbr: this.creditMemo.transactionType.abbr,\n                                            transactionDate: this.transactionDate,\n                                            customer: this.customer,\n                                            transactionType: this.creditMemo.transactionType,\n                                            currency: this.creditMemo.currency,\n                                            txnRate: this.creditMemo.txnRate,\n                                            rate: 1,\n                                            exchangeAmount: this.creditMemo.exchangeAmount,\n                                            exchangeRate: this.creditMemo.exchangeRate,\n                                            amount: this.creditMemo.amount,\n                                            variance: this.creditMemo.variance,\n                                            priceLevel: this.creditMemo.priceLevel,\n\n                                            itemLine: itemLineR,\n                                            depositLine: depositLineR,\n                                            cashRefundLine: cashRefundR,\n                                            applyToLine: applyToLineR,\n\n                                            segment: this.creditMemo.segment,\n                                            location: this.creditMemo.location,\n                                            project: this.creditMemo.project,\n                                            employee: this.creditMemo.employee,\n                                            transactionNote: this.creditMemo.transactionNote,\n                                            journalNote: this.creditMemo.journalNote,\n\n                                            itemLineAmount: this.creditMemo.itemLineAmount,\n                                            itemLineExchangeAmount: this.creditMemo\n                                                .itemLineExchangeAmount,\n                                            itemLineDiscountAmount: this.creditMemo\n                                                .itemLineDiscountAmount,\n                                            itemLineTaxAmount: this.creditMemo.itemLineTaxAmount,\n                                            itemLineSubTotal: this.creditMemo.itemLineSubTotal,\n\n                                            applyToAmount: this.creditMemo.applyToAmount,\n                                            applyToExchangeAmount: this.creditMemo\n                                                .applyToExchangeAmount,\n                                            depositDeduction: this.creditMemo.depositDeduction,\n                                            depositAmount: this.creditMemo.depositAmount,\n                                            exchangeDepositDeduction: this.creditMemo\n                                                .exchangeDepositDeduction,\n                                            refundAmount: this.creditMemo.refundAmount,\n                                            varianceAcc: this.creditMemo.varianceAcc,\n\n                                            saveOption: this.creditMemo.saveOption,\n                                            status: 1,\n                                            approvedBy: this.creditMemo.approvedBy,\n                                            formTemplate: {},\n                                            createdAt: this.creditMemo.createdAt,\n                                            reason: this.creditMemo.reason,\n                                            loggedUser: this.loggedUser,\n                                            isAutoGenerate: isAutoGenerate,\n                                            jRaw: this.jRaw,\n                                            itemSubtotal: this.creditMemo.itemSubtotal,\n                                            exchangeItemSubtotal: this.creditMemo\n                                                .exchangeItemSubtotal,\n                                            serviceSubtotal: this.creditMemo.serviceSubtotal,\n                                            exchangeServiceSubtotal: this.creditMemo\n                                                .exchangeServiceSubtotal,\n                                            txnItmSubtotal: this.creditMemo.txnItmSubtotal,\n                                            exchangeTxnItmSubtotal: this.creditMemo\n                                                .exchangeTxnItmSubtotal,\n                                            itemDiscount: this.creditMemo.itemDiscount,\n                                            exchangeItemDiscount: this.creditMemo\n                                                .exchangeItemDiscount,\n                                            serviceDiscount: this.creditMemo.serviceDiscount,\n                                            exchangeServiceDiscount: this.creditMemo\n                                                .exchangeServiceDiscount,\n                                            txnItmDiscount: this.creditMemo.txnItmDiscount,\n                                            exchangeTxnItmDiscount: this.creditMemo\n                                                .exchangeTxnItmDiscount,\n                                            refFrom: this.creditMemo.refFrom || [],\n                                            refTo: this.creditMemo.refTo || [],\n                                            saleTaxDetail: this.creditMemo.saleTaxDetail || [],\n                                            customerDiscountItem: this.creditMemo.customerDiscountItem || [],\n                                            exchangeVariance: this.creditMemo.exchangeVariance || 0,\n                                            actionType: this.$route.params.id\n                                                ? this.$route.query.type\n                                                : \"new\",\n                                        };\n                                        this.showLoading = true;\n                                        window.console.log(data, \"applyToLineR\", applyToLineR);\n                                        window.console.log(\n                                            \"applyToLineR\",\n                                            JSON.stringify(applyToLineR)\n                                        );\n                                        window.console.log(JSON.stringify(data), \"data\");\n                                        billingHandler\n                                            .createCreditMemo(data)\n                                            .then((response) => {\n                                                if (response.data.statusCode === 201) {\n                                                    this.showLoading = false;\n                                                    this.$snotify.success(\"Successfully\");\n                                                    if (save == 'new') {\n                                                        this.clear()\n                                                    } else {\n                                                        this.clear();\n                                                        this.close();\n                                                    }\n                                                }\n                                            })\n                                            .catch((e) => {\n                                                this.showLoading = false;\n                                                this.$snotify.error(\"Something went wrong\");\n                                                this.errors.push(e);\n                                            });\n                                    }\n                                }, 10);\n                            });\n                        } else {\n                            this.showWaringMessage(\n                                \"Credit Memo\",\n                                \"Please check before save\",\n                                \"OK\"\n                            );\n                        }\n                    } else {\n                        this.showWaringMessage(\n                            \"Credit Memo\",\n                            \"Please check before save\",\n                            \"OK\"\n                        );\n                    }\n                }\n            } else {\n                this.$snotify.error(\"Please select return item \");\n                return;\n            }\n        },\n        async loadViewCreditMemo() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    if (this.$route.params.id) {\n                        this.showLoading = true;\n                        const strFilter = \"?id=\" + this.$route.params.id;\n                        billingHandler\n                            .creditMemoList(strFilter)\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    const saleReturn = res.data.data[0];\n                                    this.creditMemo = saleReturn;\n                                    this.itemLines = saleReturn.itemLine;\n                                    this.offsetInvoices = saleReturn.applyToLine;\n                                    this.cashRefundLines = saleReturn.cashRefundLine;\n                                    this.depositLines = saleReturn.depositLine;\n                                    this.customer = this.creditMemo.customer;\n                                    this.mEmployee = this.creditMemo.employee;\n                                    this.transactionDate = this.creditMemo.transactionDate;\n                                    this.baseCurrencyCode = saleReturn.baseCurrencyCode;\n                                    this.customerDiscountItem = this.creditMemo.customerDiscountItem || [];\n\n                                    if (this.cashRefundLines.length === 0) {\n                                        this.saleDepositLine.id = itemLinePrefix + uuid.v1();\n                                        this.cashRefundLines.push(this.saleDepositLine);\n                                        // this.addRowCashRefund()\n                                    }\n                                    if (this.depositLines.length === 0) {\n                                        this.saleDepositLine.id = itemLinePrefix + uuid.v1();\n                                        this.depositLines.push(this.saleDepositLine);\n                                        // this.addRowDeposit()\n                                    }\n                                }\n                            })\n                            .catch();\n                        {\n                            // this.showLoading = false\n                        }\n                    }\n                }, 50);\n            });\n        },\n        close() {\n            window.history.go(-1);\n        },\n        clear() {\n            this.showLoading = false;\n            let itemLineDS = this.$refs.itemLineDS.kendoWidget();\n            itemLineDS.data([]);\n            let cashRefundDS = this.$refs.cashRefundDS.kendoWidget();\n            cashRefundDS.data([]);\n            let depositLineDS = this.$refs.depositLineDS.kendoWidget();\n            depositLineDS.data([]);\n            let applyToLineDS = this.$refs.applyToLineDS.kendoWidget();\n            applyToLineDS.data([]);\n            this.offsetInvoice = {}\n            this.offsetInvoices = [];\n            const cusType = this.creditMemo.transactionType\n            this.customer = {}\n            this.creditMemo = new CreditMemoModel()\n            this.creditMemo.transactionType = cusType\n            this.addRow()\n\n        },\n        autoCalculateTaxDetail() {\n            let ids = []\n            this.taxListDetail.forEach(n => {\n                ids.push(n.id || '')\n            })\n            const unique = [...new Set(ids)]\n            let result = []\n            unique.forEach(m => {\n                let amount = 0, row = {}, discount = 0, xDiscount = 0, xAmount = 0, taxAmount = 0, xTaxAmount = 0\n                let taxDetail = [], isVat = 0\n                const found = this.taxListDetail.filter(n => n.id === m)\n                // window.console.log('taxListDetailids', found)\n                found.forEach(k => {\n                    row = k\n                    if (k.isVat === 1) {\n                        isVat = 1\n                        const detail_ = k.detail || {}\n                        taxDetail.push(detail_)\n\n                    }\n                    taxAmount += k.taxAmount_ || 0\n                    xTaxAmount += (k.taxAmount_ || 0) * (k.txnRate || 1)\n                    amount += (k.amount || 0)\n                    xAmount += (k.amount || 0) * (k.txnRate || 1)\n                    discount += (k.discount || 0)\n                    xDiscount += (k.discount || 0) * (k.txnRate || 1)\n                })\n                let spTaxAmt = 0, spXTaxAmt = 0, plTaxAmt = 0, plXTaxAmt = 0, otTaxAmt = 0, otXTaxAmt = 0,\n                    spTaxName = '', plTaxName = '', otTaxName = '',\n                    spTaxNameLocale = '', plTaxNameLocale = '', otTaxNameLocale = '',\n                    spAccId = '', plAccId = '', otAccId = '',\n                    spRate = '', plRate = '', otRate = ''\n                taxDetail.forEach(n => {\n                    const spTax = n.specificTax || {}\n                    const plTax = n.publicLightingTax || {}\n                    const otherTax = n.otherTax || {}\n                    if (Object.keys(spTax).length > 0) {\n                        spTaxAmt += (spTax.taxAmount_ || 0)\n                        spXTaxAmt += ((spTax.taxAmount_ || 0) * (spTax.taxRate || 1))\n                        spTaxName = spTax.defaultTax || ''\n                        spTaxNameLocale = spTax.defaultTaxLocale || ''\n                        spAccId = spTax.account ? spTax.account.id : ''\n                        spRate = spTax.rate || 1\n                    }\n                    if (Object.keys(plTax).length > 0) {\n                        plTaxAmt += (plTax.taxAmount_ || 0)\n                        plXTaxAmt += ((plTax.taxAmount_ || 0) * (plTax.taxRate || 1))\n                        plTaxName = plTax.defaultTax || ''\n                        plTaxNameLocale = plTax.defaultTaxLocale || ''\n                        plAccId = plTax.account ? plTax.account.id : ''\n                        plRate = plTax.rate || 1\n                    }\n                    if (Object.keys(otherTax).length > 0) {\n                        otTaxAmt += (otherTax.taxAmount_ || 0)\n                        otXTaxAmt += ((otherTax.taxAmount_ || 0) * (plTax.taxRate || 1))\n                        otTaxName = otherTax.defaultTax || ''\n                        otTaxNameLocale = otherTax.defaultTaxLocale || ''\n                        otAccId = otherTax.account ? otherTax.account.id : ''\n                        otRate = otherTax.rate || 1\n                    }\n                })\n                if (isVat === 1) {\n                    row.detail = {\n                        specificTax: {\n                            name: spTaxName,\n                            nameLocale: spTaxNameLocale,\n                            amount: spTaxAmt,\n                            exchangeAmount: spXTaxAmt,\n                            accountId: spAccId,\n                            rate: spRate,\n                        },\n                        publicLightingTax: {\n                            name: plTaxName,\n                            nameLocale: plTaxNameLocale,\n                            amount: plTaxAmt,\n                            exchangeAmount: plXTaxAmt,\n                            accountId: plAccId,\n                            rate: plRate,\n                        },\n                        otherTax: {\n                            name: otTaxName,\n                            nameLocale: otTaxNameLocale,\n                            amount: otTaxAmt,\n                            exchangeAmount: otXTaxAmt,\n                            accountId: otAccId,\n                            rate: otRate,\n                        }\n                    }\n                } else {\n                    row.detail = {}\n                }\n\n                row['amount'] = amount\n                row['exchangeAmount'] = xAmount\n                row['taxAmount'] = taxAmount\n                row['exchangeTaxAmount'] = xTaxAmount\n                row['discount'] = discount\n                row['exchangeDiscount'] = xDiscount\n                row['currency'] = this.creditMemo.exchangeRate || {}\n                result.push(row)\n                taxDetail = []\n            })\n            this.creditMemo.saleTaxDetail = result\n            window.console.log('creditMemo.saleTaxDetail', result)\n        },\n        async loadOtherCharge() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    otherChargeHandler.list().then((res) => {\n                        if (res.data.statusCode === 200) {\n                            this.otherChargeList = res.data.data;\n                        }\n                    });\n                }, 10);\n            });\n        },\n    },\n    watch: {\n        id() {\n            if (this.$route.params.id === undefined) {\n                this.clear();\n            } else {\n                this.loadViewCreditMemo();\n            }\n        },\n        // call again the method if the route changes\n    },\n    created() {\n        this.loadTax();\n        this.loadSaleUnitItems();\n        this.loadPrefix();\n        this.loadSegment();\n        this.loadLocation();\n        this.loadPaymentOption();\n    },\n    mounted: async function () {\n        await this.loadOtherAccount();\n        this.requestData(0, this.filter, this.cusBaseUrl);\n        // await this.loadDiscountItem()\n        await this.loadEmployeeCenter();\n        await this.loadPaymentTerm();\n        await this.loadAccount();\n        await this.loadPriceLevel();\n        await this.loadOtherCharge();\n        // await this.loadOtherCharge()\n        await this.loadSaleFormContent();\n        await this.initData();\n        this.nowTimes();\n    },\n};\n</script>\n\n<style scoped>\n.function_wrapper {\n    box-shadow: none !important;\n}\n\n.v-application--is-ltr .v-text-field .v-input__append-inner {\n    marn-top: 0 !important;\n}\n\n.v-input__slot {\n    background-color: #fff !important;\n}\n\n.function_content .label {\n    margin-bottom: 10px;\n    display: inline-block;\n}\n\n.border_radius10 {\n    border-radius: 10px !important;\n    background-color: #f2f2f2;\n}\n\n.pa-3.v-card h4 {\n    font-size: 18px;\n    color: #333;\n}\n\n.pa-3.v-card p {\n    font-size: 12px;\n    color: #b5b5b5;\n}\n\n.attachment_file {\n    background-color: #efeded;\n    border-radius: 0 !important;\n}\n\n.attachment_table.v-data-table table {\n    border: thin solid rgba(0, 0, 0, 0.12);\n}\n\n.attachment_table table tr th {\n    border-left: thin solid rgba(0, 0, 0, 0.12);\n    height: 35px;\n    border-right: thin solid rgba(0, 0, 0, 0.12);\n}\n\n.block_debit,\n.block_credit {\n    border-bottom: 1px solid #fff;\n}\n\n.block_debit p.number,\n.block_credit p.number {\n    font-size: 25px;\n    color: #7f7f7f;\n}\n\n.block_debit h5,\n.block_credit h5,\n.block_difference h5 {\n    text-transform: uppercase;\n    color: #7f7f7f;\n    font-size: 15px;\n    font-weight: normal;\n}\n\n.block_difference h5 {\n    font-size: 18px;\n}\n\n.block_difference h5 span {\n    font-size: 15px;\n}\n\n.custom_grid table th:last-child {\n    text-align: right !important;\n}\n\n.primary--text {\n    color: #03b154;\n}\n\n@media (min-width: 1264px) {\n    .container {\n        max-width: 1250px;\n    }\n}\n\n@media (max-width: 576px) {\n    .pt-6.col-sm-5.col-12 {\n        padding-top: 0 !important;\n    }\n\n    .code_text {\n        width: 100%;\n    }\n\n    .phone_no_pt {\n        padding-top: 0 !important;\n    }\n\n    .select_template,\n    .save_option {\n        margin-bottom: 10px;\n    }\n}\n\n.hide_small_bar_class {\n    max-width: 0;\n    transition: 0.5s ease-in;\n    flex: 0 0 0;\n}\n\n.hide_big_bar_class {\n    max-width: 100%;\n    transition: 0.5s ease-in;\n    flex: 0 0 100%;\n}\n\n.info_add {\n    background-color: #ffffff;\n}\n\n.small_sidebar {\n    height: 98%;\n    position: relative;\n    padding: 12px;\n    background-color: #edf1f5;\n}\n\n.iconArrow {\n    right: -35px;\n    position: absolute;\n    bottom: -10px;\n}\n\n.iconArrowHide {\n    position: absolute;\n    right: -7px;\n    bottom: -10px;\n}\n\n.color_grey {\n    color: #808080;\n}\n\n.card_green {\n    min-height: 70px;\n    background-color: #00b050 !important;\n    color: #ffffff;\n}\n\n.lb_bold {\n    font-size: 12px;\n}\n\n.detial_smallside_p {\n    position: absolute;\n    bottom: 10px;\n}\n\n.card_background {\n    background-color: #edf1f5;\n    min-height: 120px;\n}\n\n.deposite_input {\n    width: 100px;\n}\n\n.btn_save_draft {\n    color: #ffffff;\n    background-color: #00b0f0 !important;\n    text-transform: capitalize;\n}\n\n.save_option {\n    background-color: #203864 !important;\n}\n\n.btn_add_small {\n    height: 27px !important;\n    min-width: 25px !important;\n    font-size: 10px;\n    padding: 0 22px !important;\n    background-color: #00b050 !important;\n    color: #ffffff;\n    border-radius: 0 !important;\n}\n\n.list_site_inv {\n    background-color: #92d050;\n    color: #ffffff;\n    font-size: 12px;\n}\n\n.list_site_exp {\n    background-color: #c5e0b4;\n    color: #000000;\n    font-size: 12px;\n    line-height: 16px;\n    min-height: 40px;\n}\n\n.checkbox_inv {\n    padding: 2px;\n    margin-top: 3px;\n    margin-right: 2px;\n}\n\n.exp_select {\n    font-size: 12px !important;\n}\n\n.my_card h3 {\n    display: block !important;\n}\n</style>\n"]}]}