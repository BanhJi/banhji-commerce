{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/suppliers/ExpenseVerify.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/suppliers/ExpenseVerify.vue","mtime":1638499443340},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7aTE4bn0gZnJvbSAiQC9pMThuIjsKaW1wb3J0IGtlbmRvIGZyb20gIkBwcm9ncmVzcy9rZW5kby11aSI7CmltcG9ydCBIZWxwZXIgZnJvbSAiQC9oZWxwZXIuanMiOwoKaW1wb3J0IHsKICAgIEV4cGVuc2VNb2RlbCwKICAgIEV4cGVuc2VFbnRyeU1vZGVsLAogICAgQWNjb3VudE1vZGVsLAogICAgQ3VycmVuY3lNb2RlbCwKICAgIEVtcGxveWVlTW9kZWwsCiAgICBDb250YWN0TW9kZWwsCiAgICBKb3VybmFsTW9kZWwsCiAgICBKb3VybmFsRW50cnlNb2RlbCwKICAgIENsYXNzTW9kZWwsCiAgICBVb21Nb2RlbCwKICAgIExvY2F0aW9uTW9kZWwsCiAgICBTZWdtZW50TW9kZWwsCiAgICBQcm9qZWN0TW9kZWwsCiAgICBEaXNjb3VudEl0ZW1Nb2RlbCwKICAgIFRheE1vZGVsLCBFeHBlbnNlcywgUGF5bWVudFRlcm1Nb2RlbCwKfSBmcm9tICJAL3NjcmlwdHMvbW9kZWwvQXBwTW9kZWxzIjsKaW1wb3J0IEV4cGVuc2VTdW1tYXJ5TW9kZWwgZnJvbSAiQC9zY3JpcHRzL21vZGVsL0V4cGVuc2VTdW1tYXJ5IjsKLy8gaW1wb3J0IEV4cGVuc2VTdW1tYXJ5RGV0YWlsTW9kZWwgZnJvbSAiQC9zY3JpcHRzL21vZGVsL0V4cGVuc2VTdW1tYXJ5RGV0YWlsIjsKaW1wb3J0IEV4cGVuc2VTdW1tYXJ5RGV0YWlsRXh0ZW5kZWRNb2RlbCBmcm9tICJAL3NjcmlwdHMvbW9kZWwvRXhwZW5zZVN1bW1hcnlEZXRhaWxFeHRlbmRlZCI7CmltcG9ydCB7U2hvd1Jlc291cmNlfSBmcm9tICJAL29ic2VydmFibGUvc3RvcmUiOwoKLyogRWRpdG9ycyAqLwppbXBvcnQgQWNjb3VudEVkaXRvciBmcm9tICJAL3NjcmlwdHMva2VuZG9fZWRpdG9yL0FjY291bnQiOwppbXBvcnQgQ2xhc3NFZGl0b3IgZnJvbSAiQC9zY3JpcHRzL2tlbmRvX2VkaXRvci9DbGF6eiI7CmltcG9ydCBVb21FZGl0b3IgZnJvbSAiQC9zY3JpcHRzL2tlbmRvX2VkaXRvci9Vb20iOwppbXBvcnQgUHVyY2hhc2VEaXNjb3VudEl0ZW1FZGl0b3IgZnJvbSAiQC9zY3JpcHRzL2tlbmRvX2VkaXRvci9QdXJjaGFzZURpc2NvdW50SXRlbSI7CmltcG9ydCBQdXJjaGFzZVRheEVkaXRvciBmcm9tICJAL3NjcmlwdHMva2VuZG9fZWRpdG9yL1B1cmNoYXNlVGF4IjsKaW1wb3J0IE51bWJlckVkaXRvciBmcm9tICJAL3NjcmlwdHMva2VuZG9fZWRpdG9yL051bWJlcklucHV0Qm94IjsKaW1wb3J0IFN1cHBsaWVyRWRpdG9yIGZyb20gIkAvc2NyaXB0cy9rZW5kb19lZGl0b3IvU3VwcGxpZXIiOwppbXBvcnQgQWNjb3VudE1hcHBpbmdNb2RlbCBmcm9tICJAL3NjcmlwdHMvYWNjb3VudC1tYXAvQWNjb3VudCI7CmltcG9ydCBiaWxsaW5nSGFuZGxlciBmcm9tICJAL3NjcmlwdHMvaW52b2ljZS9oYW5kbGVyL2JpbGxpbmdIYW5kbGVyIjsKaW1wb3J0IHt1dWlkfSBmcm9tICJ2dWUtdXVpZCI7CgovKiBTdG9yZSAqLwovLyBpbXBvcnQgc3RvcmUgZnJvbSAiQC9zdG9yZSI7Ci8vIGNvbnN0IGluc3RpdHV0ZSA9IHN0b3JlLnN0YXRlLmluc3RpdHV0ZS5pbnN0aXR1dGU7CgovKiBIYW5kbGVycyAqLwpjb25zdCB7CiAgICBjYXNoQWR2YW5jZUhhbmRsZXIsCn0gPSByZXF1aXJlKCJAL3NjcmlwdHMvQXBwSGFuZGxlcnMiKTsKCmNvbnN0IGV4cGVuc2VIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2V4cGVuc2VIYW5kbGVyIik7CmNvbnN0IGV4cGVuc2VTdW1tYXJ5SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9leHBlbnNlU3VtbWFyeUhhbmRsZXIiKTsKCmNvbnN0IHsKICAgIEVudGl0eVR5cGUsCiAgICBTYXZlT3B0aW9uLAogICAgQWNjb3VudFR5cGVDb2RlLAogICAgVGF4VHlwZSwKICAgIFNldHRpbmcsCn0gPSByZXF1aXJlKCJAL3NjcmlwdHMvZGVmYXVsdF9zZXR1cC9Db2xsZWN0aW9ucyIpOwoKZXhwb3J0IGRlZmF1bHQgewogICAgbmFtZTogIkV4cGVuc2VTdW1tYXJ5VmVyaWZ5IiwKICAgIGNvbXBvbmVudHM6IHsKICAgICAgICBMb2FkaW5nTWU6ICgpID0+IGltcG9ydCgiQC9jb21wb25lbnRzL0xvYWRpbmciKSwKICAgICAgICAiYXBwLWRhdGVwaWNrZXIiOiAoKSA9PiBpbXBvcnQoIkAvY29tcG9uZW50cy9jdXN0b21fdGVtcGxhdGVzL0RhdGVQaWNrZXJDb21wb25lbnQiKSwKICAgICAgICAiYXBwLW1vbnRob2YtcGlja2VyIjogKCkgPT4KICAgICAgICAgICAgaW1wb3J0KCJAL2NvbXBvbmVudHMva2VuZG9fdGVtcGxhdGVzL01vbnRoT2ZQaWNrZXIiKSwKICAgICAgICAiYXBwLWxvY2F0aW9uLWRyb3Bkb3dubGlzdCI6ICgpID0+CiAgICAgICAgICAgIGltcG9ydCgiQC9jb21wb25lbnRzL2Ryb3Bkb3dubGlzdC9Mb2NhdGlvbiIpLAogICAgICAgICJhcHAtcHJvamVjdC1kcm9wZG93bmxpc3QiOiAoKSA9PgogICAgICAgICAgICBpbXBvcnQoIkAvY29tcG9uZW50cy9kcm9wZG93bmxpc3QvUHJvamVjdCIpLAogICAgICAgICJhcHAtc2VnbWVudC1kcm9wZG93bmxpc3QiOiAoKSA9PgogICAgICAgICAgICBpbXBvcnQoIkAvY29tcG9uZW50cy9kcm9wZG93bmxpc3QvU2VnbWVudCIpLAogICAgfSwKICAgIHByb3BzOiB7CiAgICAgICAgaW5pdEV4cGVuc2VTdW1tYXJ5OiB7CiAgICAgICAgICAgIHR5cGU6IEV4cGVuc2VTdW1tYXJ5TW9kZWwsCiAgICAgICAgfSwKICAgIH0sCiAgICBkYXRhOiAoKSA9PiAoewogICAgICAgIC8vIE9iagogICAgICAgIG51bWJlcnM6IG51bGwsCiAgICAgICAgdmVyaWZpZWRFeHBlbnNlczogW10sCiAgICAgICAgZXhwZW5zZVN1bW1hcnk6IG5ldyBFeHBlbnNlU3VtbWFyeU1vZGVsKCksCiAgICAgICAgZW1wbG95ZWU6IG5ldyBFbXBsb3llZU1vZGVsKCksCiAgICAgICAgdHJhbnNhY3Rpb25BY2NvdW50OiBuZXcgQWNjb3VudE1vZGVsKCksCiAgICAgICAgYWR2YW5jZVNldHRsZW1lbnRDbGVhcmluZ0FjY291bnQ6IG5ldyBBY2NvdW50TW9kZWwoKSwKICAgICAgICBsb2NhdGlvbjogbmV3IExvY2F0aW9uTW9kZWwoKSwKICAgICAgICBzZWdtZW50OiBuZXcgU2VnbWVudE1vZGVsKCksCiAgICAgICAgcHJvamVjdDogbmV3IFByb2plY3RNb2RlbCgpLAogICAgICAgIC8vIExpc3QKICAgICAgICBzZWxlY3RlZEV4cGVuc2VJZHM6IFtdLAogICAgICAgIGNhc2hBZHZhbmNlczogW10sCiAgICAgICAgYWNjb3VudHM6IFtdLAogICAgICAgIHRyYW5zYWN0aW9uQWNjb3VudHM6IFtdLAogICAgICAgIGV4cGVuc2VFbnRyaWVzOiBbXSwKICAgICAgICAvLyBPdGhlcgogICAgICAgIHN1YlRvdGFsOiAwLAogICAgICAgIGRpc2NvdW50QW1vdW50OiAwLAogICAgICAgIHB1cmNoYXNlVGF4OiAwLAogICAgICAgIHdoZFRheDogMCwKICAgICAgICB0b3RhbEFtb3VudDogMCwKICAgICAgICBhbW91bnREdWU6IDAsCiAgICAgICAgZmlsZXM6IFtdLAogICAgICAgIHVzZXI6IEhlbHBlci5nZXRVc2VyKCksCiAgICAgICAgdGVtcGxhdGVzOiBbXSwKICAgICAgICBtYXhEZWNpbWFsOiBTZXR0aW5nLk1BWF9ESUNFTUFMLAogICAgICAgIGRpc2FibGVQcm9qZWN0OiBmYWxzZSwKICAgICAgICAvLyBGb3JtIHZhbGlkYXRpb24KICAgICAgICB2YWxpZDogdHJ1ZSwKICAgICAgICBpc0VkaXQ6IGZhbHNlLAogICAgICAgIGFsZXJ0OiBmYWxzZSwKICAgICAgICBlcnJvck1lc3NhZ2U6ICIiLAogICAgICAgIHNhdmVNb2RlOiAiIiwKICAgICAgICBTYXZlT3B0aW9uOiBTYXZlT3B0aW9uLAogICAgICAgIC8vIEVkaXRvcnMKICAgICAgICBBY2NvdW50RWRpdG9yOiBBY2NvdW50RWRpdG9yLAogICAgICAgIE51bWJlckVkaXRvcjogTnVtYmVyRWRpdG9yLAogICAgICAgIENsYXNzRWRpdG9yOiBDbGFzc0VkaXRvciwKICAgICAgICBVb21FZGl0b3I6IFVvbUVkaXRvciwKICAgICAgICBQdXJjaGFzZURpc2NvdW50SXRlbUVkaXRvcjogUHVyY2hhc2VEaXNjb3VudEl0ZW1FZGl0b3IsCiAgICAgICAgUHVyY2hhc2VUYXhFZGl0b3I6IFB1cmNoYXNlVGF4RWRpdG9yLAogICAgICAgIFN1cHBsaWVyRWRpdG9yOiBTdXBwbGllckVkaXRvciwKICAgICAgICAvLyBTaWRlYmFyCiAgICAgICAgaXNIaWRlQmFyOiBmYWxzZSwKICAgICAgICAvLyBMb2FkaW5nTWUKICAgICAgICBzaG93TG9hZGluZzogZmFsc2UsCiAgICAgICAgc2hvd0Nhc2hBZHZhbmNlTG9hZGluZzogZmFsc2UsCiAgICAgICAgLy8gS2VuZG8gZGF0YVNvdXJjZQogICAgICAgIHNjaGVtYURlZmluaXRpb246IHsKICAgICAgICAgICAgbW9kZWw6IHtpZDogInV1aWQifSwKICAgICAgICB9LAogICAgICAgIHR4bkV4cGVuc2U6IG5ldyBFeHBlbnNlcygpLAogICAgICAgIHR4bkV4cGVuc2VMaXN0OiBbXSwKICAgICAgICBwYXltZW50VGVybTogbmV3IFBheW1lbnRUZXJtTW9kZWwoKSwKICAgIH0pLAogICAgbWV0aG9kczogewogICAgICAgIEhlbHAoa2V5X3NlYXJjaCkgewogICAgICAgICAgICBTaG93UmVzb3VyY2Uoa2V5X3NlYXJjaCk7CiAgICAgICAgfSwKICAgICAgICAvLyBJbml0aWFsIERhdGEKICAgICAgICBpbml0aWFsRGF0YSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuaW5pdEV4cGVuc2VTdW1tYXJ5KSB7CiAgICAgICAgICAgICAgICB0aGlzLmV4cGVuc2VTdW1tYXJ5ID0gdGhpcy5pbml0RXhwZW5zZVN1bW1hcnk7CiAgICAgICAgICAgICAgICB0aGlzLmJpbmREYXRhKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIC8vIFNldCBkZWZhdWx0IGRhdGEKICAgICAgICBhc3luYyBzZXREZWZhdWx0RGF0YSgpIHsKICAgICAgICAgICAgdGhpcy5leHBlbnNlU3VtbWFyeSA9IG5ldyBFeHBlbnNlU3VtbWFyeU1vZGVsKCk7CiAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVOdW1iZXIoKTsKICAgICAgICB9LAogICAgICAgIC8qIExvYWQgRGF0YSAqLwogICAgICAgIGFzeW5jIGxvYWREYXRhKCkgewogICAgICAgICAgICAvLyBDYWxsIEFjY291bnQgTGlzdAogICAgICAgICAgICB0aGlzLmFjY291bnRzID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goImFjY291bnRpbmcvZ2V0QWNjb3VudHMiKTsKCiAgICAgICAgICAgIC8vIEFkdmFuY2UgU2V0dGxlbWVudCBDbGVhcmluZyBBY2NvdW50IGJ5IGJhbmhqaV9hY2NvdW50X251bWJlcgogICAgICAgICAgICBsZXQgYWR2U2V0Q2xyQWNjID0gdGhpcy5hY2NvdW50cy5maW5kKCh2YWx1ZSkgPT4gdmFsdWUubnVtYmVyID09PSBBY2NvdW50VHlwZUNvZGUuQURWQU5DRV9TRVRUTEVNRU5UX0NMRUFSSU5HX0NPREUpOyAvLyBXaWxsIGNoYW5nZSBsYXRlcgogICAgICAgICAgICB0aGlzLmFkdmFuY2VTZXR0bGVtZW50Q2xlYXJpbmdBY2NvdW50ID0gbmV3IEFjY291bnRNb2RlbChhZHZTZXRDbHJBY2MpOwoKICAgICAgICAgICAgLy8gRmlsdGVyIFRyYW5zYWN0aW9uIEFjY291bnRzCiAgICAgICAgICAgIHRoaXMuZmlsdGVyVHJhbnNhY3Rpb25BY2NvdW50KCk7CiAgICAgICAgfSwKICAgICAgICAvLyBCaW5kIGRhdGEgZnJvbSBwcm9wIGZvciBlZGl0IG1vZGUKICAgICAgICBhc3luYyBiaW5kRGF0YSgpIHsKICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CgogICAgICAgICAgICB0aGlzLmdlbmVyYXRlTnVtYmVyKCk7CgogICAgICAgICAgICAvKiBEYXRlICovCiAgICAgICAgICAgIHRoaXMuZXhwZW5zZVN1bW1hcnkuZGF0ZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zdWJzdHIoMCwgMTApOwoKICAgICAgICAgICAgLy8gQ29udGFjdHMKICAgICAgICAgICAgdGhpcy5lbXBsb3llZSA9IG5ldyBFbXBsb3llZU1vZGVsKHRoaXMuZXhwZW5zZVN1bW1hcnkuZW1wbG95ZWUpOwoKICAgICAgICAgICAgLy8gU2lkZWJhcgogICAgICAgICAgICBsZXQgbG9jYXRpb25zID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goImxvY2F0aW9ucy9nZXRMaXN0Iik7CiAgICAgICAgICAgIHRoaXMubG9jYXRpb24gPSBuZXcgTG9jYXRpb25Nb2RlbCgKICAgICAgICAgICAgICAgIGxvY2F0aW9ucy5maW5kKChpKSA9PiBpLmlkID09PSB0aGlzLmV4cGVuc2VTdW1tYXJ5LmxvY2F0aW9uX3V1aWQpCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBsZXQgc2VnbWVudHMgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgic2VnbWVudHMvZ2V0TGlzdCIpOwogICAgICAgICAgICB0aGlzLnNlZ21lbnQgPSBuZXcgU2VnbWVudE1vZGVsKAogICAgICAgICAgICAgICAgc2VnbWVudHMuZmluZCgoaSkgPT4gaS5pZCA9PT0gdGhpcy5leHBlbnNlU3VtbWFyeS5zZWdtZW50X3V1aWQpCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBsZXQgcHJvamVjdHMgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgicHJvamVjdHMvZ2V0TGlzdCIpOwogICAgICAgICAgICB0aGlzLnByb2plY3QgPSBuZXcgUHJvamVjdE1vZGVsKAogICAgICAgICAgICAgICAgcHJvamVjdHMuZmluZCgoaSkgPT4gaS5pZCA9PT0gdGhpcy5leHBlbnNlU3VtbWFyeS5wcm9qZWN0X3V1aWQpCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAvLyBDYXNoIEFkdmFuY2UKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgdGhpcy5lbXBsb3llZS5pZCAhPT0gIiIgJiYKICAgICAgICAgICAgICAgIHRoaXMuc2VnbWVudC5pZCAhPT0gIiIgJiYKICAgICAgICAgICAgICAgIHRoaXMuZXhwZW5zZVN1bW1hcnkudXNlX2Zvcl9vcHRpb24gPT09IDIKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICBsZXQgY2FzaEFkdmFuY2VzID0gYXdhaXQgY2FzaEFkdmFuY2VIYW5kbGVyLmdldEJ5RW1wbG95ZWVJZCgKICAgICAgICAgICAgICAgICAgICB0aGlzLmVtcGxveWVlLmlkCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgdGhpcy5jYXNoQWR2YW5jZXMgPSBjYXNoQWR2YW5jZXMuZGF0YS5maWx0ZXIoCiAgICAgICAgICAgICAgICAgICAgKGkpID0+IGkuc2VnbWVudF91dWlkID09PSB0aGlzLnNlZ21lbnQuaWQKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEVudHJpZXMKICAgICAgICAgICAgbGV0IGVudHJpZXMgPSBbXSwKCQkJCXN1YlRvdGFsID0gMCwKCQkJCWRpc2NvdW50QW1vdW50ID0gMCwKCQkJCXB1cmNoYXNlVGF4QW1vdW50ID0gMCwKCQkJCXdoZFRheEFtb3VudCA9IDAsCgkJCQlkaXNjb3VudEl0ZW1zID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goImRpc2NvdW50SXRlbXMvZ2V0TGlzdCIpLAoJCQkJdGF4SXRlbXMgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgidGF4ZXMvZ2V0TGlzdCIpLAoJCQkJdW9tcyA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJ1bml0T2ZNZWFzdXJlbWVudHMvZ2V0TGlzdCIpLAoJCQkJY2xhenogPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgiY2xhc3Nlcy9nZXRMaXN0Iik7CgogICAgICAgICAgICB0aGlzLmV4cGVuc2VTdW1tYXJ5LnN1bW1hcnlfZGV0YWlscy5mb3JFYWNoKCh2YWx1ZSkgPT4gewogICAgICAgICAgICAgICAgLy8gUHVyY2hhc2UgVGF4CiAgICAgICAgICAgICAgICBpZiAodmFsdWUuYWNjb3VudC5hY2NvdW50X3R5cGUubnVtYmVyID09PSBBY2NvdW50VHlwZUNvZGUuUFVSQ0hBU0VfVEFYKSB7CiAgICAgICAgICAgICAgICAgICAgcHVyY2hhc2VUYXhBbW91bnQgKz0gdmFsdWUuYW1vdW50OwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuYW1vdW50ID4gMCAmJiB2YWx1ZS5hY2NvdW50Lm51bWJlciAhPT0gQWNjb3VudFR5cGVDb2RlLlRBWF9SRUxBVEVEX0VYUEVOU0VfQ09ERSkgewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgZW50cnkgPSBuZXcgRXhwZW5zZVN1bW1hcnlEZXRhaWxFeHRlbmRlZE1vZGVsKHZhbHVlKTsKCgkJCQkJCS8vIERhdGUKCQkJCQkJZW50cnkuYmlsbF9kYXRlID0gbmV3IERhdGUodmFsdWUuYmlsbF9kYXRlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN1YnRvdGFsCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YlRvdGFsICs9IHZhbHVlLmFtb3VudDsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVPTQogICAgICAgICAgICAgICAgICAgICAgICBlbnRyeS51b20gPSBuZXcgVW9tTW9kZWwoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1b21zLmZpbmQoKGl0ZW0pID0+IGl0ZW0uaWQgPT09IHZhbHVlLnVvbV91dWlkKQogICAgICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGlzY291bnQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmhhc093blByb3BlcnR5KCdkaXNjb3VudCcpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmRpc2NvdW50Lmhhc093blByb3BlcnR5KCd1dWlkJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW50cnkuZGlzY291bnQgPSBuZXcgRGlzY291bnRJdGVtTW9kZWwoZGlzY291bnRJdGVtcy5maW5kKChpKSA9PiBpLmlkID09PSB2YWx1ZS5kaXNjb3VudC51dWlkKSk7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBUYXgKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmhhc093blByb3BlcnR5KCd0YXhfaXRlbScpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnRheF9pdGVtLmhhc093blByb3BlcnR5KCd1dWlkJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRyeS50YXhfaXRlbSA9IHRheEl0ZW1zLmZpbmQoKGkpID0+IGkuaWQgPT09IHZhbHVlLnRheF9pdGVtLnV1aWQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBBcHBseSBJbmNsdXNpdmUgVGF4IHRvIGFtb3VudCAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbnRyeS50YXhfaXRlbS5oYXNPd25Qcm9wZXJ0eSgndGF4VHlwZScpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW50cnkudGF4X2l0ZW0udGF4VHlwZS5oYXNPd25Qcm9wZXJ0eSgndHlwZUlkJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW50cnkudGF4X2l0ZW0udGF4VHlwZS50eXBlSWQgPT09IDEgJiYgZW50cnkudGF4X2l0ZW0uYmFzZUFtb3VudC50b0xvd2VyQ2FzZSgpID09PSBUYXhUeXBlLklOQ0xVU0lWRSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJUb3RhbCArPSBlbnRyeS50YXhfYW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2xhc3NlcwogICAgICAgICAgICAgICAgICAgICAgICBlbnRyeS5jbGFzczEgPSBuZXcgQ2xhc3NNb2RlbCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXp6LmZpbmQoKGl0ZW0pID0+IGl0ZW0uaWQgPT09IHZhbHVlLmNsYXNzXzFfdXVpZCkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW50cnkuY2xhc3MyID0gbmV3IENsYXNzTW9kZWwoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGF6ei5maW5kKChpdGVtKSA9PiBpdGVtLmlkID09PSB2YWx1ZS5jbGFzc18yX3V1aWQpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5LmNsYXNzMyA9IG5ldyBDbGFzc01vZGVsKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhenouZmluZCgoaXRlbSkgPT4gaXRlbS5pZCA9PT0gdmFsdWUuY2xhc3NfM191dWlkKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICBlbnRyeS5jbGFzczQgPSBuZXcgQ2xhc3NNb2RlbCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXp6LmZpbmQoKGl0ZW0pID0+IGl0ZW0uaWQgPT09IHZhbHVlLmNsYXNzXzRfdXVpZCkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW50cnkuY2xhc3M1ID0gbmV3IENsYXNzTW9kZWwoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGF6ei5maW5kKChpdGVtKSA9PiBpdGVtLmlkID09PSB2YWx1ZS5jbGFzc181X3V1aWQpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CgkJCQkJCQogICAgICAgICAgICAgICAgICAgICAgICBlbnRyaWVzLnB1c2goZW50cnkpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERpc2NvdW50CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5hY2NvdW50LmFjY291bnRfdHlwZS5udW1iZXIgPT09IEFjY291bnRUeXBlQ29kZS5ESVNDT1VOVCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzY291bnRBbW91bnQgKz0gdmFsdWUuYW1vdW50ICogLTE7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdIRCBUYXgKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmFjY291bnQuYWNjb3VudF90eXBlLm51bWJlciA9PT0gQWNjb3VudFR5cGVDb2RlLldIRF9UQVgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoZFRheEFtb3VudCArPSB2YWx1ZS5hbW91bnQgKiAtMTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVHJhbnNhY3Rpb24gQWNjb3VudCAoUGF5YWJsZSBBY2NvdW50IC8gQ2xlYXJpbmcgQWNjb3VudCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmFjY291bnQudXVpZCA9PT0gdGhpcy5leHBlbnNlLnRyYW5zYWN0aW9uX2FjY291bnQudXVpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hbW91bnREdWUgPSB2YWx1ZS5hbW91bnQgKiAtMTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBCaW5kIEV4cGVuc2UgRW50cmllcwogICAgICAgICAgICB0aGlzLmV4cGVuc2VFbnRyaWVzID0gZW50cmllczsKCiAgICAgICAgICAgIC8vIENhbGN1bGF0aW9uCiAgICAgICAgICAgIHRoaXMuc3ViVG90YWwgPSBzdWJUb3RhbDsKICAgICAgICAgICAgdGhpcy5kaXNjb3VudEFtb3VudCA9IGRpc2NvdW50QW1vdW50OwogICAgICAgICAgICB0aGlzLnB1cmNoYXNlVGF4ID0gcHVyY2hhc2VUYXhBbW91bnQ7CiAgICAgICAgICAgIHRoaXMud2hkVGF4ID0gd2hkVGF4QW1vdW50OwogICAgICAgICAgICB0aGlzLnRvdGFsQW1vdW50ID0gc3ViVG90YWwgLSB0aGlzLmRpc2NvdW50QW1vdW50OwoKICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0sCiAgICAgICAgLy8gTnVtYmVyCiAgICAgICAgYXN5bmMgZ2VuZXJhdGVOdW1iZXIoKSB7CiAgICAgICAgICAgIHRoaXMubnVtYmVycyA9IGF3YWl0IEhlbHBlci5nZW5lcmF0ZUFjY291bnRpbmdOdW1iZXIoCiAgICAgICAgICAgICAgICBFbnRpdHlUeXBlLkVYUEVOU0VTLAogICAgICAgICAgICAgICAgdGhpcy5leHBlbnNlU3VtbWFyeS5kYXRlCiAgICAgICAgICAgICk7CiAgICAgICAgfSwKICAgICAgICBhcHBseVByZWZpeE51bWJlcihsYXN0TnVtYmVyKSB7CiAgICAgICAgICAgIC8qIFByZWZpeCAqLwogICAgICAgICAgICBsZXQgcGYgPSB0aGlzLm51bWJlcnMucHJlZml4OwoKICAgICAgICAgICAgLy8gU3RydWN0dXJlCiAgICAgICAgICAgIGxldCBzdHJ1Y3R1cmUgPSAnJywgdHhuRGF0ZSA9IG5ldyBEYXRlKHRoaXMuZXhwZW5zZVN1bW1hcnkuZGF0ZSk7CiAgICAgICAgICAgIHN3aXRjaCAocGYuc3RydWN0dXJlLnRvTG93ZXJDYXNlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgJ3l5eXknOgogICAgICAgICAgICAgICAgICAgIHN0cnVjdHVyZSA9IHR4bkRhdGUuZ2V0RnVsbFllYXIoKS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAneXknOgogICAgICAgICAgICAgICAgICAgIHN0cnVjdHVyZSA9IHR4bkRhdGUuZ2V0RnVsbFllYXIoKS50b1N0cmluZygpLnN1YnN0cigyKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ3l5eXltbSc6CiAgICAgICAgICAgICAgICAgICAgc3RydWN0dXJlID0gdHhuRGF0ZS5nZXRGdWxsWWVhcigpLnRvU3RyaW5nKCkgKyAodHhuRGF0ZS5nZXRNb250aCgpICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAneXltbSc6CiAgICAgICAgICAgICAgICAgICAgc3RydWN0dXJlID0gdHhuRGF0ZS5nZXRGdWxsWWVhcigpLnRvU3RyaW5nKCkuc3Vic3RyKDIpICsgKHR4bkRhdGUuZ2V0TW9udGgoKSArIDEpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBkZWZhdWx0Oi8vIE5vbmUgc3RydWN0dXJlCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFN0YXJ0aW5nIE51bWJlcgogICAgICAgICAgICBpZiAobGFzdE51bWJlciA9PT0gMCkgewogICAgICAgICAgICAgICAgbGFzdE51bWJlciA9IHBmLm51bWJlcjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIFNlcXVlbmNpbmcgTnVtYmVyIChSZXNldCBOdW1iZXIpCiAgICAgICAgICAgICAgICBwZi5zZXF1Y2VuY2luZyA9ICdwcmVmaXgnOy8vIHdpbGwgY2hhbmdlIGxhdGVyCiAgICAgICAgICAgICAgICBzd2l0Y2ggKHBmLnNlcXVjZW5jaW5nLnRvTG93ZXJDYXNlKCkpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICdtb250aCc6Ly8gTW9udGgKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdE51bWJlciA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ3llYXInOi8vIFllYXIKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdE51bWJlciA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6Ly8gUHJlZml4CiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3ROdW1iZXIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCBudW1iZXIgPSBwZi5hYmJyICsgcGYucHJlZml4U2VwYXJhdG9yICsgc3RydWN0dXJlICsgcGYubnVtYmVyU2VwYXJhdG9yICsgbGFzdE51bWJlci50b1N0cmluZygpLnBhZFN0YXJ0KHBmLmZvcm1hdCwgJzAnKTsKCiAgICAgICAgICAgIHJldHVybiBudW1iZXI7CiAgICAgICAgfSwKICAgICAgICAvLyBMb2FkIENhc2ggQWR2YW5jZQogICAgICAgIGxvYWRDYXNoQWR2YW5jZSgpIHsKICAgICAgICAgICAgLyogQ2xlYXIgKi8KICAgICAgICAgICAgdGhpcy5jYXNoQWR2YW5jZXMgPSBbXTsKICAgICAgICAgICAgdGhpcy5leHBlbnNlU3VtbWFyeS51c2VfZm9yX3RyYW5zYWN0aW9uX3V1aWQgPSAiIjsKCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIHRoaXMuZW1wbG95ZWUuaWQgIT09ICIiICYmCiAgICAgICAgICAgICAgICB0aGlzLnNlZ21lbnQuaWQgIT09ICIiICYmCiAgICAgICAgICAgICAgICB0aGlzLmV4cGVuc2VTdW1tYXJ5LnVzZV9mb3Jfb3B0aW9uID09PSAyCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy5zaG93Q2FzaEFkdmFuY2VMb2FkaW5nID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICBjYXNoQWR2YW5jZUhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAuZ2V0QnlFbXBsb3llZUlkKHRoaXMuZW1wbG95ZWUuaWQpCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIEZpbHRlciBieSBzZWdtZW50ICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhc2hBZHZhbmNlcyA9IHJlcy5kYXRhLmZpbHRlcigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaXRlbSkgPT4gaXRlbS5zZWdtZW50X3V1aWQgPT09IHRoaXMuc2VnbWVudC5pZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmZpbmFsbHkoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dDYXNoQWR2YW5jZUxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgLyogT24gQ2FzaCBBZHZhbmNlIENoYW5nZXMgKi8KICAgICAgICBvbkNhc2hBZHZhbmNlQ2hhbmdlcygpIHsKICAgICAgICAgICAgdGhpcy5zZXRDYXNoQWR2YW5jZVByb2plY3QoKTsKICAgICAgICAgICAgdGhpcy5kaXNhYmxlUHJvamVjdCA9IGZhbHNlOwogICAgICAgIH0sCiAgICAgICAgLyogT24gRGF0ZSBDaGFuZXMgKi8KCQlvbkRhdGVDaGFuZ2VzICgpIHsKCQkJdGhpcy5leHBlbnNlU3VtbWFyeS5tb250aF9vZiA9IG5ldyBEYXRlKHRoaXMuZXhwZW5zZVN1bW1hcnkuZGF0ZSkudG9JU09TdHJpbmcoKS5zdWJzdHIoMCwgNyk7CgkJCXRoaXMuZ2VuZXJhdGVOdW1iZXIoKTsKCQl9LAogICAgICAgIC8qIEJpbmQgcHJvamVjdCBmcm9tIGNhc2ggYWR2YW5jZSAqLwogICAgICAgIGFzeW5jIHNldENhc2hBZHZhbmNlUHJvamVjdCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuZXhwZW5zZVN1bW1hcnkudXNlX2Zvcl90cmFuc2FjdGlvbl91dWlkICE9PSAiIikgewogICAgICAgICAgICAgICAgbGV0IGNhc2hBZHZhbmNlID0gdGhpcy5jYXNoQWR2YW5jZXMuZmluZCgKICAgICAgICAgICAgICAgICAgICAoaSkgPT4gaS51dWlkID09PSB0aGlzLmV4cGVuc2VTdW1tYXJ5LnVzZV9mb3JfdHJhbnNhY3Rpb25fdXVpZAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBpZiAoY2FzaEFkdmFuY2UucHJvamVjdF91dWlkICE9PSAiIikgewogICAgICAgICAgICAgICAgICAgIGxldCBwcm9qZWN0cyA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJwcm9qZWN0cy9nZXRMaXN0Iik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9qZWN0ID0gcHJvamVjdHMuZmluZCgKICAgICAgICAgICAgICAgICAgICAgICAgKGkpID0+IGkuaWQgPT09IGNhc2hBZHZhbmNlLnByb2plY3RfdXVpZAogICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZVByb2plY3QgPSB0cnVlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGVQcm9qZWN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIC8vIE9uIEVtcGxveWVlIFJhZGlvIENoYW5nZXMKICAgICAgICBvblVzZUZvck9wdGlvbkNoYW5nZXMoKSB7CiAgICAgICAgICAgIC8vIENsZWFyIFNlbGVjdGVkIENhc2ggQWR2YW5jZQogICAgICAgICAgICB0aGlzLmV4cGVuc2VTdW1tYXJ5LnVzZV9mb3JfdHJhbnNhY3Rpb25fdXVpZCA9ICIiOwogICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uQWNjb3VudCA9IG5ldyBBY2NvdW50TW9kZWwoKTsKCiAgICAgICAgICAgIC8qIExvYWQgQ2FzaCBBZHZhbmNlICovCiAgICAgICAgICAgIGlmICh0aGlzLmV4cGVuc2VTdW1tYXJ5LnVzZV9mb3Jfb3B0aW9uID09PSAyKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRDYXNoQWR2YW5jZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmZpbHRlclRyYW5zYWN0aW9uQWNjb3VudCgpOwogICAgICAgIH0sCiAgICAgICAgLy8gRmlsdGVyIFRyYW5zYXRpb24gQWNjb3VudAogICAgICAgIGZpbHRlclRyYW5zYWN0aW9uQWNjb3VudCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuZXhwZW5zZVN1bW1hcnkudXNlX2Zvcl9vcHRpb24gPT09IDApIHsKICAgICAgICAgICAgICAgIC8vIENyZWRpdCAoUGF5YWJsZSBBY2NvdW50KQogICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbkFjY291bnRzID0gdGhpcy5hY2NvdW50cy5maWx0ZXIoKGkpID0+IH5BY2NvdW50VHlwZUNvZGUuUEFZQUJMRV9BQ0NPVU5UUy5pbmRleE9mKGkuYWNjb3VudF90eXBlLm51bWJlcikpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZXhwZW5zZS51c2VfZm9yX29wdGlvbiA9PT0gMykgewogICAgICAgICAgICAgICAgLy8gQ2FzaCBBY2NvdW50CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uQWNjb3VudHMgPSB0aGlzLmFjY291bnRzLmZpbHRlcigoaSkgPT4gfkFjY291bnRUeXBlQ29kZS5DQVNIX0FDQ09VTlRTLmluZGV4T2YoaS5hY2NvdW50X3R5cGUubnVtYmVyKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBSZWltYnVyc2VtZW50IC8gQ2FzaCBBZHZhbmNlCiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uQWNjb3VudCA9IHRoaXMuYWR2YW5jZVNldHRsZW1lbnRDbGVhcmluZ0FjY291bnQ7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uQWNjb3VudHMgPSBbdGhpcy5hZHZhbmNlU2V0dGxlbWVudENsZWFyaW5nQWNjb3VudF07CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIC8qIEtlbmRvICovCiAgICAgICAgLy8gRGF0YVNvdXJjZSBDaGFuZ2VzCiAgICAgICAgYXN5bmMgb25FeHBlbnNlQWNjb3VudERTQ2hhbmdlcyhlKSB7CiAgICAgICAgICAgIGlmIChlLmZpZWxkKSB7CiAgICAgICAgICAgICAgICBsZXQgZGF0YVJvdyA9IGUuaXRlbXNbMF07CgogICAgICAgICAgICAgICAgaWYgKGUuZmllbGQgPT09ICJzdXBwbGllciIpIHsKCQkJCQlkYXRhUm93LnNldCgiYWNjb3VudCIsIG5ldyBBY2NvdW50TW9kZWwoZGF0YVJvdy5zdXBwbGllci5hY2NvdW50VGF4LmV4cGVuc2VBY2MpKTsKCQkJCX0gZWxzZSBpZiAoZS5maWVsZCA9PT0gImFjY291bnQiKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRFeHRyYVJvdyhkYXRhUm93LnVpZCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUuZmllbGQgPT09ICJiaWxsX2RhdGUiIHx8IGUuZmllbGQgPT09ICJiaWxsX2N1cnJlbmN5IikgewoJCQkJCWxldCB4cmF0ZSA9IGF3YWl0IHRoaXMuZ2V0RXhjaGFuZ2VSYXRlKGRhdGFSb3cuYmlsbF9kYXRlLCBkYXRhUm93LmJpbGxfY3VycmVuY3kuY29kZSk7CgoJCQkJCWRhdGFSb3cuc2V0KCJleGNoYW5nZV9yYXRlX3V1aWQiLCB4cmF0ZS5pZCk7CgkJCQkJZGF0YVJvdy5zZXQoImV4Y2hhbmdlX3JhdGUiLCB4cmF0ZS5yYXRlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS5maWVsZCA9PT0gInF1YW50aXR5IiB8fCBlLmZpZWxkID09PSAicHJpY2UiKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGFtdCA9CiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQoZGF0YVJvdy5xdWFudGl0eSkgKgogICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KGRhdGFSb3cucHJpY2UpOwogICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJhbW91bnQiLCBhbXQpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLmZpZWxkID09PSAidW9tIikgewogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhUm93LnVvbSkgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgidW9tX3V1aWQiLCBkYXRhUm93LnVvbS5pZCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLmZpZWxkID09PSAiY2xhc3MxIikgewogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhUm93LmNsYXNzMSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiY2xhc3NfMV91dWlkIiwgZGF0YVJvdy5jbGFzczEuaWQpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCBkZWZhdWx0IHdoZW4gZGVzZWxlY3QKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNsYXNzXzFfdXVpZCIsICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNsYXNzMSIsIG5ldyBDbGFzc01vZGVsKCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS5maWVsZCA9PT0gImNsYXNzMiIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVJvdy5jbGFzczIgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNsYXNzXzJfdXVpZCIsIGRhdGFSb3cuY2xhc3MyLmlkKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgZGVmYXVsdCB3aGVuIGRlc2VsZWN0CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjbGFzc18yX3V1aWQiLCAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjbGFzczIiLCBuZXcgQ2xhc3NNb2RlbCgpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUuZmllbGQgPT09ICJjbGFzczMiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFSb3cuY2xhc3MzICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjbGFzc18zX3V1aWQiLCBkYXRhUm93LmNsYXNzMy5pZCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IGRlZmF1bHQgd2hlbiBkZXNlbGVjdAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiY2xhc3NfM191dWlkIiwgIiIpOwogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiY2xhc3MzIiwgbmV3IENsYXNzTW9kZWwoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLmZpZWxkID09PSAiY2xhc3M0IikgewogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhUm93LmNsYXNzNCAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiY2xhc3NfNF91dWlkIiwgZGF0YVJvdy5jbGFzczQuaWQpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCBkZWZhdWx0IHdoZW4gZGVzZWxlY3QKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNsYXNzXzRfdXVpZCIsICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNsYXNzNCIsIG5ldyBDbGFzc01vZGVsKCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS5maWVsZCA9PT0gImNsYXNzNSIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVJvdy5jbGFzczUgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNsYXNzXzVfdXVpZCIsIGRhdGFSb3cuY2xhc3M1LmlkKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgZGVmYXVsdCB3aGVuIGRlc2VsZWN0CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjbGFzc181X3V1aWQiLCAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjbGFzczUiLCBuZXcgQ2xhc3NNb2RlbCgpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGNhbGN1bGF0ZURpc2NvdW50KGRpc2NvdW50SXRlbSwgc3ViVG90YWwpIHsKICAgICAgICAgICAgaWYgKGRpc2NvdW50SXRlbSkgewogICAgICAgICAgICAgICAgY29uc3QgbmF0dXJlID0gZGlzY291bnRJdGVtLm5hdHVyZTsKICAgICAgICAgICAgICAgIGNvbnN0IGFtb3VudCA9IGRpc2NvdW50SXRlbS5hbW91bnQ7CiAgICAgICAgICAgICAgICBpZiAobmF0dXJlID09PSAiQW1vdW50IikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBrZW5kby5wYXJzZUZsb2F0KGFtb3VudCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5hdHVyZSA9PT0gIlBlcmNlbnRhZ2UiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1YlRvdGFsICogKGtlbmRvLnBhcnNlRmxvYXQoYW1vdW50KSAvIDEwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGF1dG9DYWxjdWxhdGVUYXgodGF4LCBhbW91bnQpIHsKICAgICAgICAgICAgaWYgKHRheCkgewogICAgICAgICAgICAgICAgdmFyIGZvcm11bGEgPSB0YXguZm9ybXVsYTsKICAgICAgICAgICAgICAgIHZhciBpbkFtdCA9IGtlbmRvLnBhcnNlRmxvYXQoYW1vdW50KTsKICAgICAgICAgICAgICAgIHZhciBuQW10ID0ga2VuZG8ucGFyc2VGbG9hdChhbW91bnQpOwogICAgICAgICAgICAgICAgdmFyIHRheEJhc2UgPSBrZW5kby5wYXJzZUZsb2F0KHRheC50YXhCYXNlKSAvIDEwMDsKICAgICAgICAgICAgICAgIHZhciByYXRlID0ga2VuZG8ucGFyc2VGbG9hdCh0YXgucmF0ZSkgLyAxMDA7CiAgICAgICAgICAgICAgICB2YXIgdG90YWwgPSBldmFsKGZvcm11bGEpOwogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKGluQW10LCBuQW10LCB0YXhCYXNlLCByYXRlLCBmb3JtdWxhLCB0b3RhbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdG90YWw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gcmV0dXJuIDAKICAgICAgICB9LAogICAgICAgIC8vIEF1dG8gQ2FsY3VsYXRlIEluIERhdGFTb3VyY2UKICAgICAgICBhdXRvQ2FsY3VsYXRlKCkgewogICAgICAgICAgICBsZXQgZXhwRFMgPSB0aGlzLiRyZWZzLmV4cGVuc2VBY2NvdW50RFMua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIHN1YlRvdGFsID0gMCwKICAgICAgICAgICAgICAgIGRpc2NvdW50ID0gMCwKICAgICAgICAgICAgICAgIHB1cmNoYXNlVGF4ID0gMCwKICAgICAgICAgICAgICAgIHdoZFRheCA9IDAsCiAgICAgICAgICAgICAgICBpbmNsdXNpdmVUYXggPSAwLAogICAgICAgICAgICAgICAgZGlzY291bnRJdGVtID0gW107CgogICAgICAgICAgICAvLyBFeHBlbnNlCiAgICAgICAgICAgIGV4cERTLmRhdGEoKS5mb3JFYWNoKCh2YWx1ZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKH50aGlzLnNlbGVjdGVkRXhwZW5zZUlkcy5pbmRleE9mKHZhbHVlLnV1aWQpKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGFtdCA9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucHJpY2UpICoga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5xdWFudGl0eSk7CgogICAgICAgICAgICAgICAgICAgIC8qIEV4Y2hhbmdlZCBBbW91bnQgKi8KICAgICAgICAgICAgICAgICAgICB2YWx1ZS5leGNoYW5nZWRfYW1vdW50ID0gYW10ICogdmFsdWUuZXhjaGFuZ2VfcmF0ZTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvKiBTdWJ0b3RhbCAqLwogICAgICAgICAgICAgICAgICAgIHN1YlRvdGFsICs9IGFtdDsKCiAgICAgICAgICAgICAgICAgICAgLy8gRGlzY291bnQKICAgICAgICAgICAgICAgICAgICBsZXQgZGlzY291bnRBbW91bnQgPSAwOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5oYXNPd25Qcm9wZXJ0eSgnZGlzY291bnQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmRpc2NvdW50Lmhhc093blByb3BlcnR5KCdpZCcpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmRpc2NvdW50LmlkICE9PSAiIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50QW1vdW50ID0gdGhpcy5jYWxjdWxhdGVEaXNjb3VudCh2YWx1ZS5kaXNjb3VudCwgYW10KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudCArPSBkaXNjb3VudEFtb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudEl0ZW0ucHVzaCh2YWx1ZS5kaXNjb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIFRheAogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5oYXNPd25Qcm9wZXJ0eSgndGF4X2l0ZW0nKSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnRheF9pdGVtLmhhc093blByb3BlcnR5KCdpZCcpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnRheF9pdGVtLmlkICE9PSAiIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBhbXRBZnRlckRpc2NvdW50ID0gYW10IC0gZGlzY291bnRBbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGF4QW1vdW50ID0gdGhpcy5hdXRvQ2FsY3VsYXRlVGF4KHZhbHVlLnRheF9pdGVtLCBhbXRBZnRlckRpc2NvdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUudGF4X2l0ZW0uYmFzZUFtb3VudC50b0xvd2VyQ2FzZSgpID09PSBUYXhUeXBlLklOQ0xVU0lWRSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNsdXNpdmVUYXggKz0gdGF4QW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnRheF9pdGVtLmhhc093blByb3BlcnR5KCd0YXhUeXBlJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS50YXhfaXRlbS50YXhUeXBlLmhhc093blByb3BlcnR5KCd0eXBlSWQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS50YXhfaXRlbS50YXhUeXBlLnR5cGVJZCA9PT0gMikgey8qIFdIRCBUYXggKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGRUYXggKz0gdGF4QW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsvKiBQdXJjaGFzZSBUYXggKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXJjaGFzZVRheCArPSB0YXhBbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIFNldCBUYXggQW1vdW50ICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnRheF9pdGVtLnRheFR5cGUudHlwZUlkID09PSAxICYmIHZhbHVlLnRheF9pdGVtLmJhc2VBbW91bnQudG9Mb3dlckNhc2UoKSA9PT0gVGF4VHlwZS5JTkNMVVNJVkUpIHsvKiBJbmNsdXNpdmUgVGF4ICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLnNldCgidGF4X2Ftb3VudCIsIHRheEFtb3VudCAqIC0xKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZS5zZXQoInRheF9hbW91bnQiLCB0YXhBbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvKiBBcHBseSBJbmNsdXNpdmUgVGF4ICovCiAgICAgICAgICAgIHN1YlRvdGFsIC09IGluY2x1c2l2ZVRheDsKCgkJCXRoaXMuc3ViVG90YWwgPSBzdWJUb3RhbDsKICAgICAgICAgICAgdGhpcy5kaXNjb3VudEFtb3VudCA9IGRpc2NvdW50OwogICAgICAgICAgICB0aGlzLnB1cmNoYXNlVGF4ID0gcHVyY2hhc2VUYXg7CiAgICAgICAgICAgIHRoaXMud2hkVGF4ID0gd2hkVGF4OwoKICAgICAgICAgICAgbGV0IHRvdGFsQW1vdW50ID0gKHRoaXMuc3ViVG90YWwgLSBkaXNjb3VudCkgKyB3aGRUYXggKyBwdXJjaGFzZVRheDsKICAgICAgICAgICAgdGhpcy50b3RhbEFtb3VudCA9IHRvdGFsQW1vdW50OwoKICAgICAgICAgICAgbGV0IGFtb3VudER1ZSA9IHRoaXMudG90YWxBbW91bnQgLSB3aGRUYXg7CiAgICAgICAgICAgIHRoaXMuYW1vdW50RHVlID0gYW1vdW50RHVlOwogICAgICAgIH0sCiAgICAgICAgLy8gUm93IE51bWJlciBUZW1wbGF0ZQogICAgICAgIHJvd051bWJlclRtcGwoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5leHBlbnNlQWNjb3VudERTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICBpbmRleCA9IGRzLmluZGV4T2YoZGF0YUl0ZW0pOwoKICAgICAgICAgICAgcmV0dXJuIGluZGV4ICsgMTsKICAgICAgICB9LAogICAgICAgIC8vIE9uIEV4cGVuc2UgR3JpZCBDaGFuZ2VzCiAgICAgICAgb25FeHBlbnNlR3JpZENoYW5nZXMoKSB7CiAgICAgICAgICAgIGxldCBncmlkID0gdGhpcy4kcmVmcy5leHBlbnNlU3VtbWFyeUdyaWQua2VuZG9XaWRnZXQoKTsKCiAgICAgICAgICAgIC8vIGxldCBpZHMgPSBbXQogICAgICAgICAgICAvLyBmb3IgKGxldCBpZCBpbiBncmlkLl9zZWxlY3RlZElkcykKICAgICAgICAgICAgLy8gaWRzLnB1c2goaWQpCgogICAgICAgICAgICB0aGlzLnNlbGVjdGVkRXhwZW5zZUlkcyA9IGdyaWQuc2VsZWN0ZWRLZXlOYW1lcygpOwogICAgICAgICAgICB0aGlzLmF1dG9DYWxjdWxhdGUoKTsKICAgICAgICB9LAogICAgICAgIC8vIFNocmluayBEYXRhCiAgICAgICAgc2hyaW5rRGF0YSgpIHsKICAgICAgICAgICAgbGV0IGV4cGVuc2VMaXN0ID0gW10sCiAgICAgICAgICAgICAgICBleHBEUyA9IHRoaXMuJHJlZnMuZXhwZW5zZUFjY291bnREUy5rZW5kb1dpZGdldCgpLAogICAgICAgICAgICAgICAgbGFzdE51bWJlciA9IHRoaXMubnVtYmVycy5sYXN0X251bWJlciwKICAgICAgICAgICAgICAgIGNvdW50ZXIgPSAxOwoKICAgICAgICAgICAgLyogVXBkYXRlIEV4cGVuc2UgU3VtbWFyeSBTdGF0dXMgKi8KICAgICAgICAgICAgdGhpcy5leHBlbnNlU3VtbWFyeS5pc19jbGVhcmVkID0gMTsKCiAgICAgICAgICAgIC8vIEV4cGVuc2UgRW50cmllcyBvbiBEcgogICAgICAgICAgICBleHBEUy5kYXRhKCkuZm9yRWFjaCgodmFsdWUpID0+IHsKICAgICAgICAgICAgICAgIC8vIEZpbHRlciBzZWxlY3RlZCBleHBlbnNlcwogICAgICAgICAgICAgICAgaWYgKH50aGlzLnNlbGVjdGVkRXhwZW5zZUlkcy5pbmRleE9mKHZhbHVlLnV1aWQpKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGVudHJpZXMgPSBbXTsKCiAgICAgICAgICAgICAgICAgICAgLyogVXBkYXRlIEV4cGVuc2UgU3VtbWFyeSBEZXRhaWwgU3RhdHVzIEFwcHJvdmVkICovCiAgICAgICAgICAgICAgICAgICAgdmFsdWUuc2V0KCJzdGF0dXMiLCAxKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvKiBTdGF0dXMgKi8KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5leHBlbnNlU3VtbWFyeS51c2VfZm9yX29wdGlvbiA9PT0gMykgey8qIENhc2ggKi8KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUuc2V0KCJpc19jbGVhcmVkIiwgMSk7IC8qIFBhaWQgKi8KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8qIEVYUEVOU0UgKi8KICAgICAgICAgICAgICAgICAgICBsZXQgZXhwZW5zZSA9IG5ldyBFeHBlbnNlTW9kZWwodmFsdWUpOwoKICAgICAgICAgICAgICAgICAgICAvKiB1dWlkICovCiAgICAgICAgICAgICAgICAgICAgZXhwZW5zZS51dWlkID0gIiI7IC8vIE5ldwoKICAgICAgICAgICAgICAgICAgICAvKiBOdW1iZXIgKi8KICAgICAgICAgICAgICAgICAgICBpZiAoY291bnRlciA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICBleHBlbnNlLm51bWJlciA9IHRoaXMubnVtYmVycy5udW1iZXI7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXhwZW5zZS5udW1iZXIgPSB0aGlzLmFwcGx5UHJlZml4TnVtYmVyKGxhc3ROdW1iZXIpOwogICAgICAgICAgICAgICAgICAgICAgICBsYXN0TnVtYmVyKys7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNvdW50ZXIrKzsKICAgICAgICAgICAgICAgICAgICBleHBlbnNlLnByZWZpeF9mb3JtYXQgPSB0aGlzLm51bWJlcnMucHJlZml4X2Zvcm1hdDsKCiAgICAgICAgICAgICAgICAgICAgLy8gRGF0ZQogICAgICAgICAgICAgICAgICAgIGV4cGVuc2UuZXhwZW5zZV9kYXRlID0gSGVscGVyLnRvSVNPRGF0ZSh0aGlzLmV4cGVuc2VTdW1tYXJ5LmRhdGUpOwogICAgICAgICAgICAgICAgICAgIGV4cGVuc2UuYmlsbF9kYXRlID0gSGVscGVyLnRvSVNPRGF0ZSh2YWx1ZS5iaWxsX2RhdGUpOwoKICAgICAgICAgICAgICAgICAgICAvLyBTdXBwbGllcgogICAgICAgICAgICAgICAgICAgIGV4cGVuc2Uuc3VwcGxpZXIgPSBuZXcgQ29udGFjdE1vZGVsKHZhbHVlLnN1cHBsaWVyKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gRW1wbG95ZWUKICAgICAgICAgICAgICAgICAgICBleHBlbnNlLmVtcGxveWVlID0gbmV3IENvbnRhY3RNb2RlbCh0aGlzLmVtcGxveWVlKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gU2lkZWJhcgogICAgICAgICAgICAgICAgICAgIGV4cGVuc2UubG9jYXRpb25fdXVpZCA9IHRoaXMubG9jYXRpb24uaWQ7CiAgICAgICAgICAgICAgICAgICAgZXhwZW5zZS5zZWdtZW50X3V1aWQgPSB0aGlzLnNlZ21lbnQuaWQ7CiAgICAgICAgICAgICAgICAgICAgZXhwZW5zZS5wcm9qZWN0X3V1aWQgPSB0aGlzLnByb2plY3QuaWQ7CgogICAgICAgICAgICAgICAgICAgIC8vIFVzZXIKICAgICAgICAgICAgICAgICAgICBleHBlbnNlLmNyZWF0ZWRfYnkgPSB0aGlzLnVzZXI7CgogICAgICAgICAgICAgICAgICAgIC8qIEVOVFJJRVMgKi8KICAgICAgICAgICAgICAgICAgICBsZXQgZW50cnkgPSBuZXcgRXhwZW5zZUVudHJ5TW9kZWwodmFsdWUpOwoKICAgICAgICAgICAgICAgICAgICAvLyBBY2NvdW50CiAgICAgICAgICAgICAgICAgICAgZW50cnkuYWNjb3VudCA9IG5ldyBBY2NvdW50TW9kZWwodmFsdWUuYWNjb3VudCk7CiAgICAgICAgICAgICAgICAgICAgZW50cnkuYWNjb3VudF91dWlkID0gdmFsdWUuYWNjb3VudC51dWlkOwoKICAgICAgICAgICAgICAgICAgICAvLyBDb250YWN0CiAgICAgICAgICAgICAgICAgICAgZW50cnkucHJpbWFyeV9jb250YWN0ID0gbmV3IENvbnRhY3RNb2RlbCh2YWx1ZS5zdXBwbGllcik7CiAgICAgICAgICAgICAgICAgICAgZW50cnkuc2Vjb25kYXJ5X2NvbnRhY3RzID0gW25ldyBDb250YWN0TW9kZWwodGhpcy5lbXBsb3llZSldOwoKICAgICAgICAgICAgICAgICAgICAvLyBDdXJyZW5jeQogICAgICAgICAgICAgICAgICAgIGVudHJ5LmN1cnJlbmN5ID0gbmV3IEN1cnJlbmN5TW9kZWwodmFsdWUuYmlsbF9jdXJyZW5jeSk7CiAgICAgICAgICAgICAgICAgICAgZW50cnkuZXhjaGFuZ2VfcmF0ZV91dWlkID0gdmFsdWUuZXhjaGFuZ2VfcmF0ZV91dWlkOwogICAgICAgICAgICAgICAgICAgIGVudHJ5LmV4Y2hhbmdlX3JhdGUgPSB2YWx1ZS5leGNoYW5nZV9yYXRlOwogICAgICAgICAgICAgICAgICAgIGVudHJ5LmV4Y2hhbmdlZF9hbW91bnQgPSB2YWx1ZS5leGNoYW5nZWRfYW1vdW50OwoKICAgICAgICAgICAgICAgICAgICAvLyBEaXNjb3VudAogICAgICAgICAgICAgICAgICAgIGVudHJ5LmRpc2NvdW50ID0gbmV3IERpc2NvdW50SXRlbU1vZGVsKHZhbHVlLmRpc2NvdW50KTsKCiAgICAgICAgICAgICAgICAgICAgLy8gVGF4CiAgICAgICAgICAgICAgICAgICAgZW50cnkudGF4X2l0ZW0gPSBuZXcgVGF4TW9kZWwodmFsdWUudGF4X2l0ZW0pOwoKICAgICAgICAgICAgICAgICAgICAvKiBFeHBlbnNlIEFjY291bnQgb24gRHIgKi8KICAgICAgICAgICAgICAgICAgICBlbnRyaWVzLnB1c2gobmV3IEV4cGVuc2VFbnRyeU1vZGVsKGVudHJ5KSk7CgogICAgICAgICAgICAgICAgICAgIC8vIERpc2NvdW50IG9uIENyCiAgICAgICAgICAgICAgICAgICAgbGV0IGRpc2NvdW50QW1vdW50ID0gMDsKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuaGFzT3duUHJvcGVydHkoJ2Rpc2NvdW50JykpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5kaXNjb3VudC5oYXNPd25Qcm9wZXJ0eSgnaWQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5kaXNjb3VudC5pZCAhPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgc3ViVG8gPSBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnByaWNlKSAqIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucXVhbnRpdHkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50QW1vdW50ID0gdGhpcy5jYWxjdWxhdGVEaXNjb3VudCh2YWx1ZS5kaXNjb3VudCwgc3ViVG8pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIERpc2NvdW50IEVudHJ5ICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRpc2NvdW50RW50cnkgPSBuZXcgRXhwZW5zZUVudHJ5TW9kZWwoZW50cnkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50RW50cnkuYWNjb3VudCA9IG5ldyBBY2NvdW50TW9kZWwodmFsdWUuZGlzY291bnQuYWNjb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzY291bnRFbnRyeS5hY2NvdW50X3V1aWQgPSB2YWx1ZS5kaXNjb3VudC5hY2NvdW50LnV1aWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzY291bnRFbnRyeS5hbW91bnQgPSBkaXNjb3VudEFtb3VudCAqIC0xOyAvLyBDciBzaWRlIGlzIG5lZ2F0aXZlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzY291bnRFbnRyeS5leGNoYW5nZWRfYW1vdW50ID0gZGlzY291bnRBbW91bnQgKiB2YWx1ZS5leGNoYW5nZV9yYXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50RW50cnkudGF4X2Ftb3VudCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzY291bnRFbnRyeS5leGNoYW5nZWRfdGF4X2Ftb3VudCA9IDA7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIFB1c2ggRGlzY291bnQgRW50cnkgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRyaWVzLnB1c2goZGlzY291bnRFbnRyeSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIFRheGVzIG9uIERyCiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmhhc093blByb3BlcnR5KCd0YXhfaXRlbScpKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUudGF4X2l0ZW0uaGFzT3duUHJvcGVydHkoJ2lkJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUudGF4X2l0ZW0uaWQgIT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGFtdEFmdGVyRGlzY291bnQgPSBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmFtb3VudCkgLSBkaXNjb3VudEFtb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdGF4QW1vdW50ID0gdGhpcy5hdXRvQ2FsY3VsYXRlVGF4KHZhbHVlLnRheF9pdGVtLCBhbXRBZnRlckRpc2NvdW50KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnRheF9pdGVtLmhhc093blByb3BlcnR5KCd0YXhUeXBlJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS50YXhfaXRlbS50YXhUeXBlLmhhc093blByb3BlcnR5KCd0eXBlSWQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS50YXhfaXRlbS50YXhUeXBlLnR5cGVJZCA9PT0gMikgey8qIFdIRCBUYXggb24gQ3Igc2lkZSAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS50YXhfaXRlbS5iYXNlQW1vdW50LnRvTG93ZXJDYXNlKCkgPT09ICJuZXQiKSB7LyogV0hEIFRheCBOZXQgb24gRHIgc2lkZSAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGQgQW5vdGhlciBUYXggUmVsYXRlZCBFeHBlbnNlIEFjY291bnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHRheFJlbGF0ZWRFeHBlbnNlQWNjb3VudCA9IG5ldyBBY2NvdW50TW9kZWwodGhpcy5hY2NvdW50cy5maW5kKGkgPT4gaS5iYW5oamlBY2NDb2RlID09PSBBY2NvdW50VHlwZUNvZGUuVEFYX1JFTEFURURfRVhQRU5TRV9DT0RFKSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBUYXggUmVsYXRlZCBFeHBlbnNlIEVudHJ5IG9uIERyICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0YXhSZWxhdGVkRXhwZW5zZUVudHJ5ID0gbmV3IEV4cGVuc2VFbnRyeU1vZGVsKGVudHJ5KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGF4UmVsYXRlZEV4cGVuc2VFbnRyeS5hY2NvdW50ID0gdGF4UmVsYXRlZEV4cGVuc2VBY2NvdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXhSZWxhdGVkRXhwZW5zZUVudHJ5LmFjY291bnRfdXVpZCA9IHRheFJlbGF0ZWRFeHBlbnNlQWNjb3VudC51dWlkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXhSZWxhdGVkRXhwZW5zZUVudHJ5LmRlc2NyaXB0aW9uID0gaTE4bi50KCJ3aXRob2xkaW5nX3RheF9leHBlbnNlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRheFJlbGF0ZWRFeHBlbnNlRW50cnkuYW1vdW50ID0gdGF4QW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXhSZWxhdGVkRXhwZW5zZUVudHJ5LmV4Y2hhbmdlZF9hbW91bnQgPSB0YXhBbW91bnQgKiB2YWx1ZS5leGNoYW5nZV9yYXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXhSZWxhdGVkRXhwZW5zZUVudHJ5LnRheF9hbW91bnQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXhSZWxhdGVkRXhwZW5zZUVudHJ5LmV4Y2hhbmdlZF90YXhfYW1vdW50ID0gMDsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIFB1c2ggVGF4IFJlbGF0ZWQgRXhwZW5zZSBFbnRyeSAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRyaWVzLnB1c2godGF4UmVsYXRlZEV4cGVuc2VFbnRyeSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXSEQgVGF4CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGF4QW1vdW50ICo9IC0xOyAvLyBDciBzaWRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIFRheCBFbnRyeSAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0YXhFbnRyeSA9IG5ldyBFeHBlbnNlRW50cnlNb2RlbChlbnRyeSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGF4RW50cnkuYWNjb3VudCA9IG5ldyBBY2NvdW50TW9kZWwodmFsdWUudGF4X2l0ZW0uYWNjb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGF4RW50cnkuYWNjb3VudF91dWlkID0gdmFsdWUudGF4X2l0ZW0uYWNjb3VudC51dWlkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRheEVudHJ5LmFtb3VudCA9IHRheEFtb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXhFbnRyeS5leGNoYW5nZWRfYW1vdW50ID0gdGF4QW1vdW50ICogdmFsdWUuZXhjaGFuZ2VfcmF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXhFbnRyeS50YXhfYW1vdW50ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXhFbnRyeS5leGNoYW5nZWRfdGF4X2Ftb3VudCA9IDA7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIFB1c2ggVGF4IEVudHJ5ICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW50cmllcy5wdXNoKHRheEVudHJ5KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gVHJhbnNhY3Rpb24gRW50cmllcyBvbiBDcgogICAgICAgICAgICAgICAgICAgIGVudHJpZXMucHVzaCgKICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEV4cGVuc2VFbnRyeU1vZGVsKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IG5ldyBBY2NvdW50TW9kZWwodGhpcy50cmFuc2FjdGlvbkFjY291bnQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudF91dWlkOiB0aGlzLnRyYW5zYWN0aW9uQWNjb3VudC51dWlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbWFyeV9jb250YWN0OiBuZXcgQ29udGFjdE1vZGVsKHZhbHVlLnN1cHBsaWVyKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZGFyeV9jb250YWN0czogW25ldyBDb250YWN0TW9kZWwodGhpcy5lbXBsb3llZSldLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuZXhwZW5zZVN1bW1hcnkuZGVzY3JpcHRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogdmFsdWUuYmlsbF9jdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogdmFsdWUuYW1vdW50ICogLTEsIC8vIENyIHNpZGUgaXMgbmVnYXRpdmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlX3JhdGVfdXVpZDogdmFsdWUuZXhjaGFuZ2VfcmF0ZV91dWlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VfcmF0ZTogdmFsdWUuZXhjaGFuZ2VfcmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlZF9hbW91bnQ6IHZhbHVlLmFtb3VudCAqIC0xICogdmFsdWUuZXhjaGFuZ2VfcmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICAvKiBBZGQgRW50cmllcyAqLwogICAgICAgICAgICAgICAgICAgIGV4cGVuc2UuZXhwZW5zZV9lbnRyaWVzID0gZW50cmllczsKICAgICAgICAgICAgICAgICAgICAvLyBtYXBwaW5nIHRvIER5bmFtb2RiICggZXhwZW5zZSByZWNvcmQgKQogICAgICAgICAgICAgICAgICAgIHRoaXMubWFwcGluZ0V4cGVuc2UoZXhwZW5zZSwgZW50cnkpOwoKICAgICAgICAgICAgICAgICAgICAvKiBKT1VSTkFMICovCiAgICAgICAgICAgICAgICAgICAgbGV0IGpvdXJuYWwgPSBuZXcgSm91cm5hbE1vZGVsKCk7CiAgICAgICAgICAgICAgICAgICAgam91cm5hbC5udW1iZXIgPSBleHBlbnNlLm51bWJlcjsKICAgICAgICAgICAgICAgICAgICBqb3VybmFsLmRlc2NyaXB0aW9uID0gZXhwZW5zZS5qb3VybmFsX25vdGU7CiAgICAgICAgICAgICAgICAgICAgam91cm5hbC5qb3VybmFsX2RhdGUgPSBIZWxwZXIudG9JU09EYXRlKHRoaXMuZXhwZW5zZVN1bW1hcnkuZGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgam91cm5hbC5qb3VybmFsX3R5cGUgPSBFbnRpdHlUeXBlLkFVVE9fSk9VUk5BTDsKICAgICAgICAgICAgICAgICAgICBqb3VybmFsLnRyYW5zYWN0aW9uX3R5cGUgPSBFbnRpdHlUeXBlLkVYUEVOU0VTOwogICAgICAgICAgICAgICAgICAgIGpvdXJuYWwucmVsYXRlZF90cmFuc2FjdGlvbl91dWlkID0gdGhpcy5leHBlbnNlU3VtbWFyeS51c2VfZm9yX3RyYW5zYWN0aW9uX3V1aWQ7CiAgICAgICAgICAgICAgICAgICAgam91cm5hbC5tb250aF9vZiA9IHRoaXMuZXhwZW5zZVN1bW1hcnkubW9udGhfb2Y7CiAgICAgICAgICAgICAgICAgICAgam91cm5hbC5sb2NhdGlvbl91dWlkID0gZXhwZW5zZS5sb2NhdGlvbl91dWlkOwogICAgICAgICAgICAgICAgICAgIGpvdXJuYWwucHJvamVjdF91dWlkID0gZXhwZW5zZS5wcm9qZWN0X3V1aWQ7CiAgICAgICAgICAgICAgICAgICAgam91cm5hbC5zZWdtZW50X3V1aWQgPSBleHBlbnNlLnNlZ21lbnRfdXVpZDsKICAgICAgICAgICAgICAgICAgICBqb3VybmFsLnByZWZpeF9mb3JtYXQgPSB0aGlzLm51bWJlcnMucHJlZml4X2Zvcm1hdDsKICAgICAgICAgICAgICAgICAgICBqb3VybmFsLmlzX2RyYWZ0ID0gZXhwZW5zZS5pc19kcmFmdDsKICAgICAgICAgICAgICAgICAgICBqb3VybmFsLmNyZWF0ZWRfZGF0ZSA9IGV4cGVuc2UuY3JlYXRlZF9kYXRlOwogICAgICAgICAgICAgICAgICAgIGpvdXJuYWwuY3JlYXRlZF9ieSA9IGV4cGVuc2UuY3JlYXRlZF9ieTsKICAgICAgICAgICAgICAgICAgICBqb3VybmFsLm1vZGlmaWVkX2J5ID0gZXhwZW5zZS5tb2RpZmllZF9ieTsKCiAgICAgICAgICAgICAgICAgICAgbGV0IGpvdXJuYWxFbnRyaWVzID0gW107CiAgICAgICAgICAgICAgICAgICAgZW50cmllcy5mb3JFYWNoKCh2YWx1ZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgZW50cnkgPSBuZXcgSm91cm5hbEVudHJ5TW9kZWwodmFsdWUpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLyogQXBwbHkgSW5jbHVzaXZlIFRheCB0byBhbW91bnQgKi8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnRheF9hbW91bnQgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS50YXhfaXRlbS5oYXNPd25Qcm9wZXJ0eSgidGF4VHlwZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnRheF9pdGVtLnRheFR5cGUuaGFzT3duUHJvcGVydHkoInR5cGVJZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS50YXhfaXRlbS50YXhUeXBlLnR5cGVJZCA9PT0gMSAmJiB2YWx1ZS50YXhfaXRlbS5iYXNlQW1vdW50LnRvTG93ZXJDYXNlKCkgPT09IFRheFR5cGUuSU5DTFVTSVZFKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRyeS5hbW91bnQgPSB2YWx1ZS5hbW91bnQgKyB2YWx1ZS50YXhfYW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5LmV4Y2hhbmdlZF9hbW91bnQgPSBlbnRyeS5hbW91bnQgKiB2YWx1ZS5leGNoYW5nZV9yYXRlOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIEVudHJ5CiAgICAgICAgICAgICAgICAgICAgICAgIGpvdXJuYWxFbnRyaWVzLnB1c2goZW50cnkpOwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAvLyBBZGQgRW50cnkKICAgICAgICAgICAgICAgICAgICBleHBlbnNlTGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgZXhwZW5zZTogZXhwZW5zZSwKICAgICAgICAgICAgICAgICAgICAgICAgam91cm5hbDogam91cm5hbCwKICAgICAgICAgICAgICAgICAgICAgICAgam91cm5hbF9lbnRyaWVzOiBqb3VybmFsRW50cmllcywKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLyogVXBkYXRlIEV4cGVuc2UgU3VtbWFyeSBEZXRhaWwgU3RhdHVzIFJlamVjdCAqLwogICAgICAgICAgICAgICAgICAgIHZhbHVlLnNldCgic3RhdHVzIiwgMik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLyogQWRkIFZlcmlmaWVkICovCiAgICAgICAgICAgIHRoaXMudmVyaWZpZWRFeHBlbnNlcyA9IGV4cGVuc2VMaXN0OwogICAgICAgIH0sCiAgICAgICAgLy8gVmFsaWRhdGluZwogICAgICAgIHZhbGlkYXRlRm9ybSgpIHsKICAgICAgICAgICAgbGV0IHJlc3VsdCA9IHRydWUsCiAgICAgICAgICAgICAgICBleHBEUyA9IHRoaXMuJHJlZnMuZXhwZW5zZUFjY291bnREUy5rZW5kb1dpZGdldCgpLAogICAgICAgICAgICAgICAgbXNnID0gIiI7CgogICAgICAgICAgICAvLyBFeHBlbnNlCiAgICAgICAgICAgIGV4cERTLmRhdGEoKS5mb3JFYWNoKCh2YWx1ZSwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICAgIGlmICh+dGhpcy5zZWxlY3RlZEV4cGVuc2VJZHMuaW5kZXhPZih2YWx1ZS51dWlkKSkgewogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5zdXBwbGllci5uYW1lICE9PSAiIiAmJiB2YWx1ZS5hbW91bnQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vIGRhdGUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmJpbGxfZGF0ZSA9PT0gIiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNnICs9IGA8cD4ke2kxOG4udCgicGxlYXNlX3NlbGVjdF9kYXRlX2F0X3Jvd19udW1iZXIiKX0gJHtpbmRleCArIDF9PC9wPmA7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vIG51bWJlcgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuYmlsbF9udW1iZXIgPT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1zZyArPSBgPHA+JHtpMThuLnQoInBsZWFzZV9pbnB1dF9iaWxsX251bWJlcl9hdF9yb3dfbnVtYmVyIil9ICR7aW5kZXggKyAxfTwvcD5gOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBObyBzdXBwbGllcgogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5zdXBwbGllci5uYW1lID09PSAiIiAmJiB2YWx1ZS5hbW91bnQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBtc2cgKz0gYDxwPiR7aTE4bi50KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInBsZWFzZV9zZWxlY3Rfc3VwcGxpZXJfYXRfcm93X251bWJlciIKICAgICAgICAgICAgICAgICAgICAgICAgKX0gJHtpbmRleCArIDF9PC9wPmA7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBObyBhbW91bnQKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuc3VwcGxpZXIubmFtZSAhPT0gIiIgJiYgdmFsdWUuYW1vdW50ID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBtc2cgKz0gYDxwPiR7dmFsdWUuc3VwcGxpZXIubmFtZX0gJHtpMThuLnQoImhhc19ub19hbW91bnQiKX08L3A+YDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gTm9uIHNlbGVjdGVkIGV4cGVuc2UKICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRFeHBlbnNlSWRzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgbXNnICs9IGA8cD4ke2kxOG4udCgicGxlYXNlX3NlbGVjdF9hdF9sZWFzdF9vbmVfcm93Iil9PC9wPmA7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVXNlIGZvciBDYXNoIEFkdmFuY2UKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgdGhpcy5leHBlbnNlU3VtbWFyeS51c2VfZm9yX29wdGlvbiA9PT0gMiAmJgogICAgICAgICAgICAgICAgdGhpcy5leHBlbnNlU3VtbWFyeS51c2VfZm9yX3RyYW5zYWN0aW9uX3V1aWQgPT09ICIiCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgbXNnICs9IGA8cD4ke2kxOG4udCgicGxlYXNlX3NlbGVjdF9yZWxhdGVkX2Nhc2hfYWR2YW5jZSIpfTwvcD5gOwogICAgICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8qIFRyYW5zYWNpdG9uIEFjY291bnQgKi8KICAgICAgICAgICAgaWYgKHRoaXMudHJhbnNhY3Rpb25BY2NvdW50LnV1aWQgPT09ICIiKSB7CiAgICAgICAgICAgICAgICBtc2cgKz0gYDxwPiR7aTE4bi50KCJ0cmFuc2FjdGlvbl9hY2NvdW50X2lzX3JlcXVpcmVkIil9PC9wPmA7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLyogTG9jYXRpb24gKi8KICAgICAgICAgICAgaWYgKHRoaXMubG9jYXRpb24uaWQgPT09ICIiKSB7CiAgICAgICAgICAgICAgICBtc2cgKz0gYDxwPiR7aTE4bi50KCJsb2NhdGlvbl9pc19yZXF1aXJlZCIpfTwvcD5gOwogICAgICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8qIFNlZ21lbnQgKi8KICAgICAgICAgICAgaWYgKHRoaXMuc2VnbWVudC5pZCA9PT0gIiIpIHsKICAgICAgICAgICAgICAgIG1zZyArPSBgPHA+JHtpMThuLnQoInNlZ21lbnRfaXNfcmVxdWlyZWQiKX08L3A+YDsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBTaG93IEFsZXJ0CiAgICAgICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gbXNnOwoKICAgICAgICAgICAgdGhpcy5hbGVydCA9IHJlc3VsdCA9PT0gZmFsc2U7CgogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0sCiAgICAgICAgLy8gQWxsIFNhdmVzCiAgICAgICAgYXN5bmMgb25TYXZlT3B0aW9uQ2xpY2sobW9kZSkgewogICAgICAgICAgICBpZiAodGhpcy4kcmVmcy5mb3JtLnZhbGlkYXRlKCkgJiYgdGhpcy52YWxpZGF0ZUZvcm0oKSkgewogICAgICAgICAgICAgICAgbGV0IGlzVmFsaWRDbG9zaW5nRGF0ZSA9IGF3YWl0IEhlbHBlci52YWxpZGF0ZUNsb3NpbmdEYXRlKAogICAgICAgICAgICAgICAgICAgIHRoaXMuZXhwZW5zZVN1bW1hcnkuZGF0ZQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGlmIChpc1ZhbGlkQ2xvc2luZ0RhdGUpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmVNb2RlID0gbW9kZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgY2FuY2VsKCkgewogICAgICAgICAgICB0aGlzLiRzd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiBpMThuLnQoIm1zZ190aXRsZV93YXJuaW5nIiksCiAgICAgICAgICAgICAgICB0ZXh0OiBpMThuLnQoIm1zZ19kaXNjYXJkIiksCiAgICAgICAgICAgICAgICBpY29uOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogaTE4bi50KCJjYW5jZWwiKSwKICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiM0ZDQ4NDgiLAogICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjRUQxQTNBIiwKICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBpMThuLnQoImRpc2NhcmQiKSwKICAgICAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhcigpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RGVmYXVsdERhdGEoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIuZ28oLTEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGNsZWFyKCkgewogICAgICAgICAgICAvLyBSZXNldCBGb3JtCiAgICAgICAgICAgIHRoaXMuaXNFZGl0ID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuc2F2ZU1vZGUgPSAiIjsKCiAgICAgICAgICAgIHRoaXMuc3ViVG90YWwgPSAwOwogICAgICAgICAgICB0aGlzLmRpc2NvdW50QW1vdW50ID0gMDsKICAgICAgICAgICAgdGhpcy5wdXJjaGFzZVRheCA9IDA7CiAgICAgICAgICAgIHRoaXMud2hkVGF4ID0gMDsKICAgICAgICAgICAgdGhpcy50b3RhbEFtb3VudCA9IDA7CiAgICAgICAgICAgIHRoaXMuYW1vdW50RHVlID0gMDsKICAgICAgICAgICAgdGhpcy5kaXNhYmxlUHJvamVjdCA9IGZhbHNlOwoKICAgICAgICAgICAgdGhpcy5udW1iZXJzID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEV4cGVuc2VJZHMgPSBbXTsKICAgICAgICAgICAgdGhpcy52ZXJpZmllZEV4cGVuc2VzID0gW107CiAgICAgICAgICAgIHRoaXMuZXhwZW5zZVN1bW1hcnkgPSBuZXcgRXhwZW5zZVN1bW1hcnlNb2RlbCgpOwogICAgICAgICAgICB0aGlzLmV4cGVuc2VFbnRyaWVzID0gW107CiAgICAgICAgICAgIHRoaXMuZW1wbG95ZWUgPSBuZXcgRW1wbG95ZWVNb2RlbCgpOwogICAgICAgICAgICB0aGlzLmxvY2F0aW9uID0gbmV3IExvY2F0aW9uTW9kZWwoKTsKICAgICAgICAgICAgdGhpcy5zZWdtZW50ID0gbmV3IFNlZ21lbnRNb2RlbCgpOwogICAgICAgICAgICB0aGlzLnByb2plY3QgPSBuZXcgUHJvamVjdE1vZGVsKCk7CgogICAgICAgICAgICBsZXQgZXhwRFMgPSB0aGlzLiRyZWZzLmV4cGVuc2VBY2NvdW50RFMua2VuZG9XaWRnZXQoKTsKICAgICAgICAgICAgZXhwRFMuZGF0YShbXSk7CiAgICAgICAgfSwKICAgICAgICBzYXZlKCkgewogICAgICAgICAgICBsZXQgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICAvLyBTaHJpbmsgRGF0YQogICAgICAgICAgICB0aGlzLnNocmlua0RhdGEoKTsKCiAgICAgICAgICAgIC8vIFN5bmMgRGF0YQogICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgZXhwZW5zZUhhbmRsZXIKICAgICAgICAgICAgICAgIC5zYXZlQmF0Y2godGhpcy52ZXJpZmllZEV4cGVuc2VzKQogICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYocmVzcG9uc2UpewogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnVwZGF0ZUV4cGVuc2VTdW1tYXJ5KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IHJlc3BvbnNlLmRhdGEgfHwgW10KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYXZlVHhuRXhwZW5zZShyZXMpOwogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnJlc3BvbnNlU3RhdHVzKHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgSGVscGVyLmFsZXJ0RXJyb3JNc2coaTE4bi50KCJlcnJvcl9zb21ldGhpbmdfd3JvbmciKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgSGVscGVyLmFsZXJ0RXJyb3JNc2coZXJyb3IpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5maW5hbGx5KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIC8qIFVwZGF0ZSBFeHBlbnNlIFN1bW1hcnkgKi8KICAgICAgICB1cGRhdGVFeHBlbnNlU3VtbWFyeSgpIHsKICAgICAgICAgICAgLy8gbGV0IGV4cCA9IHRoaXMuZ2V0RXhwKCk7CiAgICAgICAgICAgIC8vIGxldCBleHBTdW0gPSB7CiAgICAgICAgICAgIC8vIAl1dWlkICAgICAgICAgICAgICAgICAgICAgICA6IGV4cC51dWlkLAogICAgICAgICAgICAvLyAJbnVtYmVyICAgICAgICAgICAgICAgICAgICAgOiBleHAubnVtYmVyLAogICAgICAgICAgICAvLyAJZGF0ZSAgICAgICAgICAgICAgICAgICAgICAgOiBleHAuZGF0ZSwKICAgICAgICAgICAgLy8gCWVtcGxveWVlICAgICAgICAgICAgICAgICAgIDogZXhwLmVtcGxveWVlLAogICAgICAgICAgICAvLyAJc2VnbWVudF91dWlkICAgICAgICAgICAgICAgOiBleHAuc2VnbWVudF91dWlkLAogICAgICAgICAgICAvLyAJbG9jYXRpb25fdXVpZCAgICAgICAgICAgICAgOiBleHAubG9jYXRpb25fdXVpZCwKICAgICAgICAgICAgLy8gCXByb2plY3RfdXVpZCAgICAgICAgICAgICAgIDogZXhwLnByb2plY3RfdXVpZCwKICAgICAgICAgICAgLy8gCW1vbnRoX29mICAgICAgICAgICAgICAgICAgIDogZXhwLm1vbnRoX29mLAogICAgICAgICAgICAvLyAJdXNlX2Zvcl9vcHRpb24gICAgICAgICAgICAgOiBleHAudXNlX2Zvcl9vcHRpb24sCiAgICAgICAgICAgIC8vIAl1c2VfZm9yX3RyYW5zYWN0aW9uX3V1aWQgICA6IGV4cC51c2VfZm9yX3RyYW5zYWN0aW9uX3V1aWQsCiAgICAgICAgICAgIC8vIAlkZXNjcmlwdGlvbiAgICAgICAgICAgICAgICA6IGV4cC5kZXNjcmlwdGlvbiwKICAgICAgICAgICAgLy8gCXN1bW1hcnlfZGV0YWlscyAgICAgICAgICAgIDogZXhwLnN1bW1hcnlfZGV0YWlscywKICAgICAgICAgICAgLy8gCWlzX2RyYWZ0ICAgICAgICAgICAgICAgICAgIDogZXhwLmlzX2RyYWZ0LAogICAgICAgICAgICAvLyAJaXNfY2xlYXJlZCAgICAgICAgICAgICAgICAgOiBleHAuaXNfY2xlYXJlZCwKCiAgICAgICAgICAgIC8vIAljcmVhdGVkX2J5ICAgICAgICAgICAgICAgICA6IGV4cC5jcmVhdGVkX2J5LAogICAgICAgICAgICAvLyAJbW9kaWZpZWRfYnkgICAgICAgICAgICAgICAgOiBleHAubW9kaWZpZWRfYnksCiAgICAgICAgICAgIC8vIAljcmVhdGVkX2RhdGUgICAgICAgICAgICAgICA6IGV4cC5jcmVhdGVkX2RhdGUsCiAgICAgICAgICAgIC8vIAltb2RpZmllZF9kYXRlICAgICAgICAgICAgICA6IGV4cC5tb2RpZmllZF9kYXRlLAogICAgICAgICAgICAvLyB9OwogICAgICAgICAgICBleHBlbnNlU3VtbWFyeUhhbmRsZXIuc2F2ZSh0aGlzLmV4cGVuc2VTdW1tYXJ5KTsKICAgICAgICB9LAogICAgICAgIC8vIFJlc3BvbnNlIFN0YXR1cwogICAgICAgIHJlc3BvbnNlU3RhdHVzKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuc2F2ZU1vZGUgPT09IFNhdmVPcHRpb24uU0FWRUNMT1NFIHx8IHRoaXMuc2F2ZU1vZGUgPT09IFNhdmVPcHRpb24uREVMRVRFKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhcigpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RGVmYXVsdERhdGEoKTsKCiAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLmdvKC0xKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLyogU2F2ZSBOZXcgKi8KICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXREZWZhdWx0RGF0YSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8qIEFsZXJ0IFN1Y2Nlc3MgKi8KICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuc3VjY2VzcyhpMThuLnQoInN1Y2Nlc3NmdWwiKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvKiBBbGVydCBFcnJvciAqLwogICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcihpMThuLnQoImVycm9yX3NvbWV0aGluZ193cm9uZyIpKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgSGlkZVNtYWxsU2lkZUJhcigpIHsKICAgICAgICAgICAgdGhpcy5pc0hpZGVCYXIgPSAhdGhpcy5pc0hpZGVCYXI7CiAgICAgICAgfSwKICAgICAgICBtYXBwaW5nRXhwZW5zZShleHBlbnNlLCBlbnRyeSkgewogICAgICAgICAgICBpZiAodGhpcy5leHBlbnNlU3VtbWFyeS51c2VfZm9yX29wdGlvbiA9PT0gMCkgewogICAgICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlID0gbmV3IEV4cGVuc2VzKCkKICAgICAgICAgICAgICAgIGVudHJ5WydpZCddID0gJ2xpbi0nICsgdXVpZC52MSgpOwogICAgICAgICAgICAgICAgY29uc3Qgc3ViVG90YWwgPSBlbnRyeS5hbW91bnQgfHwgMAogICAgICAgICAgICAgICAgY29uc3QgZGlzY291bnQgPSB0aGlzLmNhbGN1bGF0ZURpc2NvdW50KGVudHJ5LmRpc2NvdW50LCBzdWJUb3RhbCkKICAgICAgICAgICAgICAgIGNvbnN0IGFtb3VudCA9IGVudHJ5LmFtb3VudCB8fCAwCiAgICAgICAgICAgICAgICBjb25zdCBhbW91bnRBZnRlckRpc2NvdW50ID0gYW1vdW50IC0gKGRpc2NvdW50IHx8IDApCiAgICAgICAgICAgICAgICBjb25zdCB0YXhJdGVtID0gZW50cnkudGF4X2l0ZW0gfHwge30KICAgICAgICAgICAgICAgIGNvbnN0IHRheEFjY291bnQgPSB0YXhJdGVtLmFjY291bnQgfHwge30KICAgICAgICAgICAgICAgIGNvbnN0IHRheEFjY291bnRUeXBlID0gdGF4QWNjb3VudC5hY2NvdW50X3R5cGUgfHwge30KICAgICAgICAgICAgICAgIGNvbnN0IHRheEFtb3VudCA9IHRoaXMuYXV0b0NhbGN1bGF0ZVRheChlbnRyeS50YXhfaXRlbSwgYW1vdW50QWZ0ZXJEaXNjb3VudCkKICAgICAgICAgICAgICAgIGxldCBwdXJjaGFzZVRheEFtb3VudCA9IDAKICAgICAgICAgICAgICAgIGxldCB3aGRUYXhBbW91bnQgPSAwCiAgICAgICAgICAgICAgICAvLyBQdXJjaGFzZSBUYXgKICAgICAgICAgICAgICAgIGlmICh0YXhBY2NvdW50VHlwZS5udW1iZXIgPT09IEFjY291bnRUeXBlQ29kZS5QVVJDSEFTRV9UQVgpIHsKICAgICAgICAgICAgICAgICAgICBwdXJjaGFzZVRheEFtb3VudCA9IHRheEFtb3VudCB8fCAwCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRheEFjY291bnRUeXBlLm51bWJlciA9PT0gQWNjb3VudFR5cGVDb2RlLldIRF9UQVgpIHsKICAgICAgICAgICAgICAgICAgICB3aGRUYXhBbW91bnQgPSB0YXhBbW91bnQgfHwgMAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgdG90YWwgPSBzdWJUb3RhbCAtIChkaXNjb3VudCB8fCAwKSArIHB1cmNoYXNlVGF4QW1vdW50IC0gd2hkVGF4QW1vdW50OwogICAgICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLmlkID0gJyc7CiAgICAgICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2Uuam91cm5hbF91dWlkID0gJyc7CiAgICAgICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UudHlwZSA9ICJFeHBlbnNlIjsKICAgICAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS5hYmJyID0gJyc7CiAgICAgICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UudHJhbnNhY3Rpb25UeXBlID0ge307CiAgICAgICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UucmVmZXJlbmNlTm8gPSBleHBlbnNlLm51bWJlcgogICAgICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLnRyYW5zYWN0aW9uRGF0ZSA9IGV4cGVuc2UuZXhwZW5zZV9kYXRlOwogICAgICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLmR1ZURhdGUgPSBleHBlbnNlLmV4cGVuc2VfZGF0ZTsKICAgICAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS5iaWxsRGF0ZSA9IGV4cGVuc2UuYmlsbF9kYXRlOwogICAgICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLmJpbGxOdW1iZXIgPSBleHBlbnNlLmJpbGxfbnVtYmVyOwogICAgICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLmN1cnJlbmN5ID0gdGhpcy5yZW1vdmVFbXB0eVZhbHVlcyhlbnRyeS5jdXJyZW5jeSk7CiAgICAgICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2Uuc3VwcGxpZXIgPSB0aGlzLnN1cHBsaWVyTWFwKGV4cGVuc2Uuc3VwcGxpZXIpOwogICAgICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLmVtcGxveWVlID0gdGhpcy5yZW1vdmVFbXB0eVZhbHVlcyhleHBlbnNlLmVtcGxveWVlKTsKICAgICAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS5wYXltZW50VGVybSA9IHRoaXMucGF5bWVudFRlcm07CiAgICAgICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2Uuc2VnbWVudCA9IHRoaXMucmVtb3ZlRW1wdHlWYWx1ZXModGhpcy5zZWdtZW50KTsKICAgICAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS5sb2NhdGlvbiA9IHRoaXMucmVtb3ZlRW1wdHlWYWx1ZXModGhpcy5sb2NhdGlvbik7CiAgICAgICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UucHJvamVjdCA9IHRoaXMucmVtb3ZlRW1wdHlWYWx1ZXModGhpcy5wcm9qZWN0KTsKICAgICAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS5tb250aE9mID0gdGhpcy5leHBlbnNlU3VtbWFyeS5tb250aF9vZjsKCiAgICAgICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UuYWRkaXRpb25hbENvc3RTdXBwbGllciA9IHRoaXMucmVtb3ZlRW1wdHlWYWx1ZXMoZXhwZW5zZS5hZGRpdGlvbmFsX2Nvc3Rfc3VwcGxpZXIpOwogICAgICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLnVzZV9mb3JfdHJhbnNhY3Rpb25fdXVpZCA9IHRoaXMuZXhwZW5zZVN1bW1hcnkudXNlX2Zvcl90cmFuc2FjdGlvbl91dWlkOwogICAgICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLnVzZUZvck9wdGlvbiA9IHRoaXMuZXhwZW5zZVN1bW1hcnkudXNlX2Zvcl9vcHRpb247CiAgICAgICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UudHJhbnNhY3Rpb25Ob3RlID0gZW50cnkuZGVzY3JpcHRpb24gfHwgJyc7CiAgICAgICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2Uuam91cm5hbE5vdGUgPSB0aGlzLmV4cGVuc2VTdW1tYXJ5LmRlc2NyaXB0aW9uIHx8ICcnCiAgICAgICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UuaXRlbUxpbmVzID0gW2VudHJ5XTsKICAgICAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS5hY2NvdW50ID0gbmV3IEFjY291bnRNYXBwaW5nTW9kZWwodGhpcy50cmFuc2FjdGlvbkFjY291bnQpOwogICAgICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLnNhdmVPcHRpb24gPSBleHBlbnNlLmlzX2RyYWZ0OwogICAgICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLnN0YXR1cyA9IDE7CiAgICAgICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UuY3JlYXRlZEF0ID0gZXhwZW5zZS5jcmVhdGVkX2RhdGU7CgogICAgICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLnRvdGFsID0gcGFyc2VGbG9hdCh0b3RhbCk7CiAgICAgICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UuZXhjaGFuZ2VUb3RhbCA9IHBhcnNlRmxvYXQodG90YWwpICogKGVudHJ5LmV4Y2hhbmdlX3JhdGUgfHwgMSk7CiAgICAgICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UuYW1vdW50RHVlID0gdG90YWwKICAgICAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS5yZW1haW5pbmdBbW91bnQgPSB0b3RhbAogICAgICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLnN1YlRvdGFsID0gc3ViVG90YWwKICAgICAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS5wdXJjaGFzZVRheCA9IHB1cmNoYXNlVGF4QW1vdW50OwogICAgICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLndoZFRheCA9IHdoZFRheEFtb3VudDsKICAgICAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS5zdXBwbGllckRpc2NvdW50SXRlbSA9IHRoaXMucmVtb3ZlRHVwbGljYXRlKFtlbnRyeS5kaXNjb3VudF0gfHwgW10pOwogICAgICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLmxvZ2dlZFVzZXIgPSB0aGlzLmxvZ2dlZFVzZXIoZXhwZW5zZS5jcmVhdGVkX2J5KTsKCiAgICAgICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UudHhuUmF0ZSA9IGVudHJ5LmV4Y2hhbmdlX3JhdGU7CiAgICAgICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UuZGlzY291bnRUb3RhbCA9IHBhcnNlRmxvYXQoKGRpc2NvdW50IHx8IDApKTsKICAgICAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS5kZXBvc2l0QW1vdW50ID0gMAogICAgICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLmRlcG9zaXREZWR1Y3Rpb24gPSAwCiAgICAgICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UuZXhjaGFuZ2VEZXBvc2l0RGVkdWN0aW9uID0gMAogICAgICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLmV4Y2hhbmdlQW1vdW50ID0gdG90YWwgKiAoZW50cnkuZXhjaGFuZ2VfcmF0ZSB8fCAxKTsKICAgICAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZUxpc3QucHVzaCh0aGlzLnR4bkV4cGVuc2UpCiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coIkV4cGVuc2UiLCB0aGlzLnR4bkV4cGVuc2VMaXN0KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbG9nZ2VkVXNlcih1c2VyKSB7CiAgICAgICAgICAgIGlmICh1c2VyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIGlkOiB1c2VyLmlkLAogICAgICAgICAgICAgICAgICAgIG5hbWU6IHVzZXIudXNlcl9uYW1lLAogICAgICAgICAgICAgICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4ge307CiAgICAgICAgfSwKICAgICAgICBzdXBwbGllck1hcChzdXBwbGllcikgewogICAgICAgICAgICBpZiAoc3VwcGxpZXIpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgaWQ6IHN1cHBsaWVyLnV1aWQsCiAgICAgICAgICAgICAgICAgICAgbmFtZTogc3VwcGxpZXIubmFtZSwKICAgICAgICAgICAgICAgICAgICBlbWFpbDogc3VwcGxpZXIuZW1haWwsCiAgICAgICAgICAgICAgICAgICAgcGhvbmU6IHN1cHBsaWVyLnBob25lLAogICAgICAgICAgICAgICAgICAgIGFkZHJlc3M6IHN1cHBsaWVyLmFkZHJlc3MsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB7fTsKICAgICAgICB9LAogICAgICAgIHJlbW92ZUVtcHR5VmFsdWVzKG9iaikgewogICAgICAgICAgICBmb3IgKGxldCBwcm9wTmFtZSBpbiBvYmopIHsKICAgICAgICAgICAgICAgIGlmICghb2JqW3Byb3BOYW1lXSB8fCBvYmpbcHJvcE5hbWVdLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBvYmpbcHJvcE5hbWVdOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygb2JqW3Byb3BOYW1lXSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUVtcHR5VmFsdWVzKG9ialtwcm9wTmFtZV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBvYmo7CiAgICAgICAgfSwKICAgICAgICByZW1vdmVEdXBsaWNhdGUoYXJyYXkpIHsKICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gW107CiAgICAgICAgICAgIGNvbnN0IG1hcCA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGFycmF5KSB7CiAgICAgICAgICAgICAgICBpZiAoIW1hcC5oYXMoaXRlbS5pZCkpIHsKICAgICAgICAgICAgICAgICAgICBtYXAuc2V0KGl0ZW0uaWQsIHRydWUpOyAvLyBzZXQgYW55IHZhbHVlIHRvIE1hcAogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfSwKICAgICAgICBzYXZlVHhuRXhwZW5zZShyZXNwb25zZSkgewogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2VMaXN0LmZvckVhY2gobSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBmb3VuZCA9IHJlc3BvbnNlLmZpbHRlcihuID0+IG4ubnVtYmVyID09PSBtLnJlZmVyZW5jZU5vKQogICAgICAgICAgICAgICAgaWYgKGZvdW5kLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gZm91bmRbMF0gfHwge30KICAgICAgICAgICAgICAgICAgICBtWyd1dWlkJ10gPSBkYXRhLnV1aWQgfHwgJycKICAgICAgICAgICAgICAgICAgICBtWydpZCddID0gJycKICAgICAgICAgICAgICAgICAgICBtWydqb3VybmFsX3V1aWQnXSA9IGRhdGEuam91cm5hbF91dWlkIHx8ICcnCiAgICAgICAgICAgICAgICAgICAgbVsnYWN0aW9uVHlwZSddID0gJ25ldycKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgbGV0IGRhdGEgPSB0aGlzLnR4bkV4cGVuc2VMaXN0OwogICAgICAgICAgICBiaWxsaW5nSGFuZGxlcgogICAgICAgICAgICAgICAgLmNyZWF0ZUV4cGVuc2VCYXRjaChkYXRhKQogICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuc3VjY2VzcygiU3VjY2Vzc2Z1bGx5Iik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoIlNvbWV0aGluZyB3ZW50IHdyb25nIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvcnMucHVzaChlKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICB9LAogICAgd2F0Y2g6IHsKICAgICAgICBpbml0RXhwZW5zZVN1bW1hcnkoKSB7CiAgICAgICAgICAgIHRoaXMuaW5pdGlhbERhdGEoKTsKICAgICAgICB9LAogICAgfSwKICAgIGNyZWF0ZWQoKSB7CiAgICAgICAgdGhpcy5sb2FkRGF0YSgpOwogICAgfSwKICAgIG1vdW50ZWQoKSB7CiAgICAgICAgLy8gSW5pdGlhbCBEYXRhCiAgICAgICAgdGhpcy5pbml0aWFsRGF0YSgpOwogICAgfSwKfTsK"},{"version":3,"sources":["ExpenseVerify.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmkBA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ExpenseVerify.vue","sourceRoot":"src/views/suppliers","sourcesContent":["<template>\n    <v-app>\n        <v-container>\n            <v-row>\n                <v-col sm=\"12\" cols=\"12\">\n                    <v-card\n                        outlined\n                        dense\n                        class=\"pa-4 no_border rounded-sm\"\n                        color=\"white\"\n                    >\n                        <v-row>\n                            <v-col\n                                class=\"bigSide py-0\"\n                                sm=\"8\"\n                                cols=\"12\"\n                                style=\"transition: 0.3s ease-in\"\n                                :class=\"{ hide_big_bar_class: isHideBar }\"\n                            >\n                                <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                                    <v-card outlined dense class=\"no_border\">\n                                        <h2 class=\"mb-0\">\n                                            {{ $t(\"expense_summary_verify\") }}\n                                        </h2>\n\n                                        <v-icon\n                                            v-if=\"isHideBar\"\n                                            @click=\"cancel()\"\n                                            style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                                            class=\"float-right\"\n                                        >close\n                                        </v-icon>\n                                        <span\n                                            style=\"transition: 0.3s ease-in; z-index: 10;\"\n                                            :class=\"{\n\t\t\t\t\t\t\t\t\t\t\t\ticonArrow: !isHideBar,\n\t\t\t\t\t\t\t\t\t\t\t\ticonArrowHide: isHideBar,\n\t\t\t\t\t\t\t\t\t\t\t}\"\n                                        >\n\t\t\t\t\t\t\t\t\t\t\t<v-icon\n                                                size=\"22\"\n                                                class=\"arr_icon\"\n                                                @click=\"HideSmallSideBar\"\n                                                v-if=\"isHideBar\"\n                                            >mdi-chevron-left-circle\n\t\t\t\t\t\t\t\t\t\t\t</v-icon>\n\t\t\t\t\t\t\t\t\t\t\t<v-icon\n                                                size=\"22\"\n                                                class=\"arr_icon\"\n                                                @click=\"HideSmallSideBar\"\n                                                v-if=\"!isHideBar\"\n                                            >mdi-chevron-right-circle\n\t\t\t\t\t\t\t\t\t\t\t</v-icon>\n\t\t\t\t\t\t\t\t\t\t</span>\n                                    </v-card>\n                                    <v-card outlined dense class=\"px-3 no_border\" color=\"grayBg\">\n                                        <v-row>\n                                            <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                                                <label class=\"label\">{{ $t(\"employee\") }}</label>\n                                                {{ expenseSummary.employee.name }}\n                                                <br>\n                                                <label class=\"label\">{{ $t(\"number\") }}</label>\n                                                {{ expenseSummary.number }}\n                                            </v-col>\n\n                                            <v-col sm=\"4\" cols=\"12\">\n                                                <label class=\"label\" style=\"\">{{ $t(\"date\") }}</label>\n                                                <app-datepicker\n                                                    :initialDate=\"expenseSummary.date\"\n                                                    @emitDate=\"expenseSummary.date = $event\"\n                                                    @onChanged=\"onDateChanges\"\n                                                />\n\n                                                <label class=\"label\" style=\"\">{{ $t(\"transaction_account\") }}</label>\n                                                <v-select\n                                                    class=\"mt-1\"\n                                                    :items=\"transactionAccounts\"\n                                                    item-value=\"uuid\"\n                                                    :item-text=\"(item) => `${item.number} - ${item.name}`\"\n                                                    v-model=\"transactionAccount\"\n                                                    no-data-text=\"No data found.\"\n                                                    :rules=\"[(v) => !!v || 'Transaction Account is required']\"\n                                                    placeholder=\"Transaction Account\"\n                                                    return-object\n                                                    outlined\n                                                ></v-select>\n                                            </v-col>\n\n                                            <v-col sm=\"4\" cols=\"12\">\n                                                <label class=\"label\" style=\"\">{{\n                                                        $t(\"description\")\n                                                    }}</label>\n                                                <v-textarea\n                                                    class=\"mt-1\"\n                                                    v-model=\"expenseSummary.description\"\n                                                    no-resize\n                                                    height=\"126\"\n                                                    outlined\n                                                    rows=\"5\"\n                                                >\n                                                </v-textarea>\n                                            </v-col>\n                                        </v-row>\n                                    </v-card>\n\n                                    <v-row style=\"background-color: #fff\">\n                                        <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                            <kendo-datasource\n                                                ref=\"expenseAccountDS\"\n                                                :data=\"expenseEntries\"\n                                                :change=\"onExpenseAccountDSChanges\"\n                                                :schema=\"schemaDefinition\"\n                                            />\n\n                                            <kendo-grid\n                                                id=\"expenseSummaryGrid\"\n                                                ref=\"expenseSummaryGrid\"\n                                                class=\"grid-function\"\n                                                :data-source-ref=\"'expenseAccountDS'\"\n                                                :persistSelection=\"true\"\n                                                :column-menu=\"true\"\n                                                :editable=\"true\"\n                                                :scrollable-virtual=\"true\"\n                                                :change=\"onExpenseGridChanges\"\n                                            >\n                                                <kendo-grid-column :selectable=\"true\" :width=\"40\"/>\n                                                <kendo-grid-column\n                                                    :title=\"$t('no.')\"\n                                                    :template=\"rowNumberTmpl\"\n                                                    :width=\"55\"\n                                                    :column-menu=\"false\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'background-color: #EDF1F5;',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass: 'text-center',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                    :attributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'text-align: center',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'bill_date'\"\n                                                    :title=\"$t('bill_date')\"\n                                                    :format=\"'{0:dd-MM-yyyy}'\"\n                                                    :editable=\"()=>{return false}\"\n                                                    :width=\"200\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'bill_number'\"\n                                                    :title=\"$t('bill_number')\"\n                                                    :width=\"200\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'supplier'\"\n                                                    :title=\"$t('vendor')\"\n                                                    :template=\"'<span>#=supplier.name||``#</span>'\"\n                                                    :editor=\"SupplierEditor\"\n                                                    :width=\"200\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'account'\"\n                                                    :title=\"$t('account')\"\n                                                    :width=\"200\"\n                                                    :template=\"'<span>#=account.name||``#</span>'\"\n                                                    :editor=\"AccountEditor\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'description'\"\n                                                    :title=\"$t('description')\"\n                                                    :width=\"200\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle:'text-align: right; background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                    :attributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'text-align: right;',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'quantity'\"\n                                                    :title=\"$t('qty')\"\n                                                    :width=\"150\"\n                                                    :editor=\"NumberEditor\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle:'text-align: right; background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                    :attributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'text-align: right',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'uom'\"\n                                                    :title=\"$t('uom')\"\n                                                    :editor=\"UomEditor\"\n                                                    :template=\"'<span>#=uom.name||``#</span>'\"\n                                                    :width=\"150\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'text-align: right; background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                    :attributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'text-align: right;',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'price'\"\n                                                    :title=\"$t('price')\"\n                                                    :format=\"'{0:n}'\"\n                                                    :editor=\"NumberEditor\"\n                                                    :width=\"150\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle:'text-align: right; background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                    :attributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'text-align: right',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'amount'\"\n                                                    :title=\"$t('amount')\"\n                                                    :format=\"'{0:n}'\"\n                                                    :width=\"150\"\n                                                    :editable=\"() => {return false;}\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle:'text-align: right; background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                    :attributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'text-align: right',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'bill_currency'\"\n                                                    :title=\"$t('currency')\"\n                                                    :template=\"'<span>#=bill_currency.code||``#</span>'\"\n                                                    :editable=\"()=>{return false}\"\n                                                    :width=\"150\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'text-align: right; background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                    :attributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'text-align: right',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'discount'\"\n                                                    :title=\"$t('discount')\"\n                                                    :template=\"'<span>#=discount.name||``#</span>'\"\n                                                    :editor=\"PurchaseDiscountItemEditor\"\n                                                    :width=\"150\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'text-align: right; background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                    :attributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'text-align: right',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'tax_item'\"\n                                                    :title=\"$t('tax')\"\n                                                    :template=\"'<span>#=tax_item.defaultTax||``#</span>'\"\n                                                    :editor=\"PurchaseTaxEditor\"\n                                                    :width=\"150\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'text-align: right; background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                    :attributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'text-align: right',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'class1'\"\n                                                    :title=\"$t('class_1')\"\n                                                    :template=\"'<span>#=class1.name||``#</span>'\"\n                                                    :width=\"200\"\n                                                    :editor=\"ClassEditor.class1\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'class2'\"\n                                                    :title=\"$t('class_2')\"\n                                                    :template=\"'<span>#=class2.name||``#</span>'\"\n                                                    :width=\"200\"\n                                                    :editor=\"ClassEditor.class2\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'class3'\"\n                                                    :title=\"$t('class_3')\"\n                                                    :template=\"'<span>#=class3.name||``#</span>'\"\n                                                    :width=\"200\"\n                                                    :editor=\"ClassEditor.class3\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'class4'\"\n                                                    :title=\"$t('class_4')\"\n                                                    :template=\"'<span>#=class4.name||``#</span>'\"\n                                                    :width=\"200\"\n                                                    :editor=\"ClassEditor.class4\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'class5'\"\n                                                    :title=\"$t('class_5')\"\n                                                    :template=\"'<span>#=class5.name||``#</span>'\"\n                                                    :width=\"200\"\n                                                    :editor=\"ClassEditor.class5\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                            </kendo-grid>\n                                        </v-col>\n\n                                        <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                            <v-row>\n                                                <v-col sm=\"5\" cols=\"12\" class=\"\">\n\n                                                </v-col>\n                                                <v-col sm=\"7\" cols=\"6\">\n                                                    <v-simple-table>\n                                                        <template v-slot:default>\n                                                            <tbody>\n                                                            <tr>\n                                                                <td class=\"text-left\">\n                                                                    {{ $t(\"subtotal\") }}\n                                                                </td>\n                                                                <td class=\"text-center\">\n                                                                    :\n                                                                </td>\n                                                                <td class=\"text-right\">\n                                                                    {{ subTotal }}\n                                                                </td>\n                                                            </tr>\n                                                            <tr>\n                                                                <td class=\"text-left\">\n                                                                    {{ $t(\"discount\") }}\n                                                                </td>\n                                                                <td class=\"text-center\">\n                                                                    :\n                                                                </td>\n                                                                <td class=\"text-right\">\n                                                                    ({{ Number(discountAmount).toLocaleString() }})\n                                                                </td>\n                                                            </tr>\n                                                            <tr>\n                                                                <td class=\"text-left\">\n                                                                    {{ $t(\"purchase_tax\") }}\n                                                                </td>\n                                                                <td class=\"text-center\">\n                                                                    :\n                                                                </td>\n                                                                <td class=\"text-right\">\n                                                                    {{ Number(purchaseTax).toLocaleString() }}\n                                                                </td>\n                                                            </tr>\n                                                            <tr>\n                                                                <td class=\"text-left\">\n                                                                    {{ $t(\"withholding_tax\") }}\n                                                                </td>\n                                                                <td class=\"text-center\">\n                                                                    :\n                                                                </td>\n                                                                <td class=\"text-right\">\n                                                                    {{ Number(whdTax).toLocaleString() }}\n                                                                </td>\n                                                            </tr>\n                                                            <tr>\n                                                                <td class=\"text-left text-uppercase\">\n                                                                    {{ $t(\"total\") }}\n                                                                </td>\n                                                                <td class=\"text-center\">\n                                                                    :\n                                                                </td>\n                                                                <td\n                                                                    class=\"text-right primary--text text-bold\"\n                                                                >\n                                                                    {{ totalAmount }}\n                                                                </td>\n                                                            </tr>\n                                                            </tbody>\n                                                        </template>\n                                                    </v-simple-table>\n                                                </v-col>\n                                            </v-row>\n                                        </v-col>\n                                    </v-row>\n\n                                    <v-divider/>\n\n                                    <v-card outlined dense class=\"no_border function_footer\">\n                                        <!-- Warning Message -->\n                                        <v-alert type=\"warning\" v-model=\"alert\" dismissible>\n                                            <span v-html=\"errorMessage\"/>\n                                        </v-alert>\n\n                                        <v-menu>\n                                            <template v-slot:activator=\"{ on }\">\n                                                <v-btn\n                                                    color=\"black\"\n                                                    outlined\n                                                    class=\"mr-2 text-capitalize  black--text float-left\"\n                                                    v-on=\"on\"\n                                                >\n                                                    {{ $t(\"select_template\") }}\n                                                    <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>\n                                                </v-btn>\n                                            </template>\n                                            <v-list>\n                                                <v-list-item\n                                                    v-for=\"(item, index) in templates\"\n                                                    :key=\"index\"\n                                                >\n                                                    <v-list-item-title>\n                                                        {{ item.title }}\n                                                    </v-list-item-title>\n                                                </v-list-item>\n                                            </v-list>\n                                        </v-menu>\n                                        <v-btn\n                                            color=\"black\"\n                                            class=\"text-capitalize  white--text float-left\"\n                                            @click=\"cancel\"\n                                        >{{ $t(\"cancel\") }}\n                                        </v-btn>\n                                        <v-btn\n                                            color=\"primary\"\n                                            class=\"float-right white--text text-capitalize \"\n                                            @click=\"onSaveOptionClick(SaveOption.SAVECLOSE)\"\n                                        >\n                                            {{ $t(\"save_close\") }}\n                                        </v-btn>\n                                    </v-card>\n                                </v-form>\n                            </v-col>\n                            <v-col\n                                class=\"smallSide\"\n                                sm=\"4\"\n                                style=\"transition: 0.3s ease-in\"\n                                :class=\"{ hide_small_bar_class: isHideBar }\"\n                            >\n                                <h3\n                                    style=\"color: #b3b5bc; font-size: 20px\"\n                                    v-if=\"!isHideBar\"\n                                    class=\"text-uppercase float-right mt-n3\"\n                                >\n\t\t\t\t\t\t\t\t\t<span class=\"pointer\" @click=\"Help('expenses')\">\n\t\t\t\t\t\t\t\t\t\t{{ $t(\"help\") }}\n\t\t\t\t\t\t\t\t\t</span>\n                                    <v-icon\n                                        @click=\"cancel()\"\n                                        style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                                        class=\"float-right mt-n1\"\n                                    >close\n                                    </v-icon>\n                                </h3>\n\n                                <div v-if=\"!isHideBar\" class=\"small_sidebar mt-8 px-4 grayBg\">\n                                    <v-card\n                                        class=\"pa-3 no-boxshadow d-flex flex-column\"\n                                        color=\"primary\"\n                                        style=\"min-height: 70px;\"\n                                    >\n                                        <h3\n                                            style=\"font-size: 18px\"\n                                            class=\"text-white text-uppercase mb-2 justify-start\"\n                                        >\n                                            {{ $t(\"amount\") }}\n                                        </h3>\n                                        <h3\n                                            class=\"text-bold text-white justify-end\"\n                                            style=\"font-size: 22px\"\n                                        >\n                                            {{ Number(amountDue).toLocaleString() }}\n                                        </h3>\n                                    </v-card>\n                                    <v-row>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"pb-0 pt-4\">\n                                            <label class=\"label\">{{ $t(\"segment\") }}</label>\n                                            <app-segment-dropdownlist\n                                                :initSegment=\"segment\"\n                                                @emitSegment=\"segment = $event\"\n                                                @onChanged=\"loadCashAdvance\"\n                                            />\n\n                                            <label class=\"label\">{{ $t(\"location\") }}</label>\n                                            <app-location-dropdownlist\n                                                :initLocation=\"location\"\n                                                @emitLocation=\"location = $event\"\n                                            />\n\n                                            <label class=\"label\">{{ $t(\"project\") }}</label>\n                                            <app-project-dropdownlist\n                                                :initProject=\"project\"\n                                                @emitProject=\"project = $event\"\n                                                :initDisabled=\"disableProject\"\n                                            />\n\n                                            <label class=\"label\">{{ $t(\"for_the_month_of\") }}</label>\n                                            <app-monthof-picker\n                                                :initMonthOf=\"expenseSummary.month_of\"\n                                                @emitMonthOf=\"expenseSummary.month_of = $event\"\n                                            />\n                                        </v-col>\n                                    </v-row>\n\n                                    <v-row>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                            <v-radio-group\n                                                class=\"mt-0 custom-radio\"\n                                                @change=\"onUseForOptionChanges\"\n                                                v-model=\"expenseSummary.use_for_option\"\n                                                column\n                                            >\n                                                <v-radio :label=\"$t('credit')\" :value=\"0\"/>\n                                                <v-radio :label=\"$t('cash')\" :value=\"3\"/>\n                                                <v-radio\n                                                    :disabled=\"employee.id === ''\"\n                                                    :label=\"$t('for_reimbursement')\"\n                                                    :value=\"1\"\n                                                />\n                                                <v-radio\n                                                    :disabled=\"employee.id === ''\"\n                                                    :label=\"$t('related_to_cash_advance')\"\n                                                    :value=\"2\"\n                                                />\n                                            </v-radio-group>\n                                        </v-col>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                            <v-select\n                                                @change=\"onCashAdvanceChanges\"\n                                                :loading=\"showCashAdvanceLoading\"\n                                                :disabled=\"expenseSummary.use_for_option !== 2\"\n                                                v-model=\"expenseSummary.use_for_transaction_uuid\"\n                                                :items=\"cashAdvances\"\n                                                item-value=\"uuid\"\n                                                item-text=\"number\"\n                                                outlined\n                                            />\n                                        </v-col>\n                                    </v-row>\n                                </div>\n                            </v-col>\n                        </v-row>\n                    </v-card>\n                </v-col>\n            </v-row>\n            <LoadingMe\n                type=\"loading\"\n                :isLoading=\"showLoading\"\n                :fullPage=\"true\"\n                :myLoading=\"true\"\n            />\n        </v-container>\n    </v-app>\n</template>\n\n<script>\nimport {i18n} from \"@/i18n\";\nimport kendo from \"@progress/kendo-ui\";\nimport Helper from \"@/helper.js\";\n\nimport {\n    ExpenseModel,\n    ExpenseEntryModel,\n    AccountModel,\n    CurrencyModel,\n    EmployeeModel,\n    ContactModel,\n    JournalModel,\n    JournalEntryModel,\n    ClassModel,\n    UomModel,\n    LocationModel,\n    SegmentModel,\n    ProjectModel,\n    DiscountItemModel,\n    TaxModel, Expenses, PaymentTermModel,\n} from \"@/scripts/model/AppModels\";\nimport ExpenseSummaryModel from \"@/scripts/model/ExpenseSummary\";\n// import ExpenseSummaryDetailModel from \"@/scripts/model/ExpenseSummaryDetail\";\nimport ExpenseSummaryDetailExtendedModel from \"@/scripts/model/ExpenseSummaryDetailExtended\";\nimport {ShowResource} from \"@/observable/store\";\n\n/* Editors */\nimport AccountEditor from \"@/scripts/kendo_editor/Account\";\nimport ClassEditor from \"@/scripts/kendo_editor/Clazz\";\nimport UomEditor from \"@/scripts/kendo_editor/Uom\";\nimport PurchaseDiscountItemEditor from \"@/scripts/kendo_editor/PurchaseDiscountItem\";\nimport PurchaseTaxEditor from \"@/scripts/kendo_editor/PurchaseTax\";\nimport NumberEditor from \"@/scripts/kendo_editor/NumberInputBox\";\nimport SupplierEditor from \"@/scripts/kendo_editor/Supplier\";\nimport AccountMappingModel from \"@/scripts/account-map/Account\";\nimport billingHandler from \"@/scripts/invoice/handler/billingHandler\";\nimport {uuid} from \"vue-uuid\";\n\n/* Store */\n// import store from \"@/store\";\n// const institute = store.state.institute.institute;\n\n/* Handlers */\nconst {\n    cashAdvanceHandler,\n} = require(\"@/scripts/AppHandlers\");\n\nconst expenseHandler = require(\"@/scripts/expenseHandler\");\nconst expenseSummaryHandler = require(\"@/scripts/expenseSummaryHandler\");\n\nconst {\n    EntityType,\n    SaveOption,\n    AccountTypeCode,\n    TaxType,\n    Setting,\n} = require(\"@/scripts/default_setup/Collections\");\n\nexport default {\n    name: \"ExpenseSummaryVerify\",\n    components: {\n        LoadingMe: () => import(\"@/components/Loading\"),\n        \"app-datepicker\": () => import(\"@/components/custom_templates/DatePickerComponent\"),\n        \"app-monthof-picker\": () =>\n            import(\"@/components/kendo_templates/MonthOfPicker\"),\n        \"app-location-dropdownlist\": () =>\n            import(\"@/components/dropdownlist/Location\"),\n        \"app-project-dropdownlist\": () =>\n            import(\"@/components/dropdownlist/Project\"),\n        \"app-segment-dropdownlist\": () =>\n            import(\"@/components/dropdownlist/Segment\"),\n    },\n    props: {\n        initExpenseSummary: {\n            type: ExpenseSummaryModel,\n        },\n    },\n    data: () => ({\n        // Obj\n        numbers: null,\n        verifiedExpenses: [],\n        expenseSummary: new ExpenseSummaryModel(),\n        employee: new EmployeeModel(),\n        transactionAccount: new AccountModel(),\n        advanceSettlementClearingAccount: new AccountModel(),\n        location: new LocationModel(),\n        segment: new SegmentModel(),\n        project: new ProjectModel(),\n        // List\n        selectedExpenseIds: [],\n        cashAdvances: [],\n        accounts: [],\n        transactionAccounts: [],\n        expenseEntries: [],\n        // Other\n        subTotal: 0,\n        discountAmount: 0,\n        purchaseTax: 0,\n        whdTax: 0,\n        totalAmount: 0,\n        amountDue: 0,\n        files: [],\n        user: Helper.getUser(),\n        templates: [],\n        maxDecimal: Setting.MAX_DICEMAL,\n        disableProject: false,\n        // Form validation\n        valid: true,\n        isEdit: false,\n        alert: false,\n        errorMessage: \"\",\n        saveMode: \"\",\n        SaveOption: SaveOption,\n        // Editors\n        AccountEditor: AccountEditor,\n        NumberEditor: NumberEditor,\n        ClassEditor: ClassEditor,\n        UomEditor: UomEditor,\n        PurchaseDiscountItemEditor: PurchaseDiscountItemEditor,\n        PurchaseTaxEditor: PurchaseTaxEditor,\n        SupplierEditor: SupplierEditor,\n        // Sidebar\n        isHideBar: false,\n        // LoadingMe\n        showLoading: false,\n        showCashAdvanceLoading: false,\n        // Kendo dataSource\n        schemaDefinition: {\n            model: {id: \"uuid\"},\n        },\n        txnExpense: new Expenses(),\n        txnExpenseList: [],\n        paymentTerm: new PaymentTermModel(),\n    }),\n    methods: {\n        Help(key_search) {\n            ShowResource(key_search);\n        },\n        // Initial Data\n        initialData() {\n            if (this.initExpenseSummary) {\n                this.expenseSummary = this.initExpenseSummary;\n                this.bindData();\n            }\n        },\n        // Set default data\n        async setDefaultData() {\n            this.expenseSummary = new ExpenseSummaryModel();\n            this.generateNumber();\n        },\n        /* Load Data */\n        async loadData() {\n            // Call Account List\n            this.accounts = await this.$store.dispatch(\"accounting/getAccounts\");\n\n            // Advance Settlement Clearing Account by banhji_account_number\n            let advSetClrAcc = this.accounts.find((value) => value.number === AccountTypeCode.ADVANCE_SETTLEMENT_CLEARING_CODE); // Will change later\n            this.advanceSettlementClearingAccount = new AccountModel(advSetClrAcc);\n\n            // Filter Transaction Accounts\n            this.filterTransactionAccount();\n        },\n        // Bind data from prop for edit mode\n        async bindData() {\n            this.showLoading = true;\n\n            this.generateNumber();\n\n            /* Date */\n            this.expenseSummary.date = new Date().toISOString().substr(0, 10);\n\n            // Contacts\n            this.employee = new EmployeeModel(this.expenseSummary.employee);\n\n            // Sidebar\n            let locations = await this.$store.dispatch(\"locations/getList\");\n            this.location = new LocationModel(\n                locations.find((i) => i.id === this.expenseSummary.location_uuid)\n            );\n\n            let segments = await this.$store.dispatch(\"segments/getList\");\n            this.segment = new SegmentModel(\n                segments.find((i) => i.id === this.expenseSummary.segment_uuid)\n            );\n\n            let projects = await this.$store.dispatch(\"projects/getList\");\n            this.project = new ProjectModel(\n                projects.find((i) => i.id === this.expenseSummary.project_uuid)\n            );\n\n            // Cash Advance\n            if (\n                this.employee.id !== \"\" &&\n                this.segment.id !== \"\" &&\n                this.expenseSummary.use_for_option === 2\n            ) {\n                let cashAdvances = await cashAdvanceHandler.getByEmployeeId(\n                    this.employee.id\n                );\n                this.cashAdvances = cashAdvances.data.filter(\n                    (i) => i.segment_uuid === this.segment.id\n                );\n            }\n\n            // Entries\n            let entries = [],\n\t\t\t\tsubTotal = 0,\n\t\t\t\tdiscountAmount = 0,\n\t\t\t\tpurchaseTaxAmount = 0,\n\t\t\t\twhdTaxAmount = 0,\n\t\t\t\tdiscountItems = await this.$store.dispatch(\"discountItems/getList\"),\n\t\t\t\ttaxItems = await this.$store.dispatch(\"taxes/getList\"),\n\t\t\t\tuoms = await this.$store.dispatch(\"unitOfMeasurements/getList\"),\n\t\t\t\tclazz = await this.$store.dispatch(\"classes/getList\");\n\n            this.expenseSummary.summary_details.forEach((value) => {\n                // Purchase Tax\n                if (value.account.account_type.number === AccountTypeCode.PURCHASE_TAX) {\n                    purchaseTaxAmount += value.amount;\n                } else {\n                    if (value.amount > 0 && value.account.number !== AccountTypeCode.TAX_RELATED_EXPENSE_CODE) {\n                        let entry = new ExpenseSummaryDetailExtendedModel(value);\n\n\t\t\t\t\t\t// Date\n\t\t\t\t\t\tentry.bill_date = new Date(value.bill_date);\n\n                        // Subtotal\n                        subTotal += value.amount;\n\n                        // UOM\n                        entry.uom = new UomModel(\n                            uoms.find((item) => item.id === value.uom_uuid)\n                        );\n\n                        // Discount\n                        if (value.hasOwnProperty('discount'))\n                            if (value.discount.hasOwnProperty('uuid'))\n                                entry.discount = new DiscountItemModel(discountItems.find((i) => i.id === value.discount.uuid));\n\n                        // Tax\n                        if (value.hasOwnProperty('tax_item'))\n                            if (value.tax_item.hasOwnProperty('uuid')) {\n                                entry.tax_item = taxItems.find((i) => i.id === value.tax_item.uuid);\n\n                                /* Apply Inclusive Tax to amount */\n                                if (entry.tax_item.hasOwnProperty('taxType'))\n                                    if (entry.tax_item.taxType.hasOwnProperty('typeId'))\n                                        if (entry.tax_item.taxType.typeId === 1 && entry.tax_item.baseAmount.toLowerCase() === TaxType.INCLUSIVE)\n                                            subTotal += entry.tax_amount;\n                            }\n\n                        // Classes\n                        entry.class1 = new ClassModel(\n                            clazz.find((item) => item.id === value.class_1_uuid)\n                        );\n                        entry.class2 = new ClassModel(\n                            clazz.find((item) => item.id === value.class_2_uuid)\n                        );\n                        entry.class3 = new ClassModel(\n                            clazz.find((item) => item.id === value.class_3_uuid)\n                        );\n                        entry.class4 = new ClassModel(\n                            clazz.find((item) => item.id === value.class_4_uuid)\n                        );\n                        entry.class5 = new ClassModel(\n                            clazz.find((item) => item.id === value.class_5_uuid)\n                        );\n\t\t\t\t\t\t\n                        entries.push(entry);\n                    } else {\n                        // Discount\n                        if (value.account.account_type.number === AccountTypeCode.DISCOUNT) {\n                            discountAmount += value.amount * -1;\n                        }\n\n                        // WHD Tax\n                        if (value.account.account_type.number === AccountTypeCode.WHD_TAX) {\n                            whdTaxAmount += value.amount * -1;\n                        }\n\n                        // Transaction Account (Payable Account / Clearing Account)\n                        if (value.account.uuid === this.expense.transaction_account.uuid) {\n                            this.amountDue = value.amount * -1;\n                        }\n                    }\n                }\n            });\n\n            // Bind Expense Entries\n            this.expenseEntries = entries;\n\n            // Calculation\n            this.subTotal = subTotal;\n            this.discountAmount = discountAmount;\n            this.purchaseTax = purchaseTaxAmount;\n            this.whdTax = whdTaxAmount;\n            this.totalAmount = subTotal - this.discountAmount;\n\n            this.showLoading = false;\n        },\n        // Number\n        async generateNumber() {\n            this.numbers = await Helper.generateAccountingNumber(\n                EntityType.EXPENSES,\n                this.expenseSummary.date\n            );\n        },\n        applyPrefixNumber(lastNumber) {\n            /* Prefix */\n            let pf = this.numbers.prefix;\n\n            // Structure\n            let structure = '', txnDate = new Date(this.expenseSummary.date);\n            switch (pf.structure.toLowerCase()) {\n                case 'yyyy':\n                    structure = txnDate.getFullYear().toString();\n                    break;\n                case 'yy':\n                    structure = txnDate.getFullYear().toString().substr(2);\n                    break;\n                case 'yyyymm':\n                    structure = txnDate.getFullYear().toString() + (txnDate.getMonth() + 1).toString().padStart(2, '0');\n                    break;\n                case 'yymm':\n                    structure = txnDate.getFullYear().toString().substr(2) + (txnDate.getMonth() + 1).toString().padStart(2, '0');\n                    break;\n\n                default:// None structure\n                    break;\n            }\n\n            // Starting Number\n            if (lastNumber === 0) {\n                lastNumber = pf.number;\n            } else {\n                // Sequencing Number (Reset Number)\n                pf.sequcencing = 'prefix';// will change later\n                switch (pf.sequcencing.toLowerCase()) {\n                    case 'month':// Month\n                        lastNumber = 1;\n                        break;\n                    case 'year':// Year\n                        lastNumber = 1;\n                        break;\n                    default:// Prefix\n                        lastNumber++;\n                        break;\n                }\n            }\n\n            let number = pf.abbr + pf.prefixSeparator + structure + pf.numberSeparator + lastNumber.toString().padStart(pf.format, '0');\n\n            return number;\n        },\n        // Load Cash Advance\n        loadCashAdvance() {\n            /* Clear */\n            this.cashAdvances = [];\n            this.expenseSummary.use_for_transaction_uuid = \"\";\n\n            if (\n                this.employee.id !== \"\" &&\n                this.segment.id !== \"\" &&\n                this.expenseSummary.use_for_option === 2\n            ) {\n                this.showCashAdvanceLoading = true;\n\n                cashAdvanceHandler\n                    .getByEmployeeId(this.employee.id)\n                    .then((res) => {\n                        if (res.data) {\n                            /* Filter by segment */\n                            this.cashAdvances = res.data.filter(\n                                (item) => item.segment_uuid === this.segment.id\n                            );\n                        }\n                    })\n                    .finally(() => {\n                        this.showCashAdvanceLoading = false;\n                    });\n            }\n        },\n        /* On Cash Advance Changes */\n        onCashAdvanceChanges() {\n            this.setCashAdvanceProject();\n            this.disableProject = false;\n        },\n        /* On Date Chanes */\n\t\tonDateChanges () {\n\t\t\tthis.expenseSummary.month_of = new Date(this.expenseSummary.date).toISOString().substr(0, 7);\n\t\t\tthis.generateNumber();\n\t\t},\n        /* Bind project from cash advance */\n        async setCashAdvanceProject() {\n            if (this.expenseSummary.use_for_transaction_uuid !== \"\") {\n                let cashAdvance = this.cashAdvances.find(\n                    (i) => i.uuid === this.expenseSummary.use_for_transaction_uuid\n                );\n\n                if (cashAdvance.project_uuid !== \"\") {\n                    let projects = await this.$store.dispatch(\"projects/getList\");\n                    this.project = projects.find(\n                        (i) => i.id === cashAdvance.project_uuid\n                    );\n\n                    this.disableProject = true;\n                } else {\n                    this.disableProject = false;\n                }\n            }\n        },\n        // On Employee Radio Changes\n        onUseForOptionChanges() {\n            // Clear Selected Cash Advance\n            this.expenseSummary.use_for_transaction_uuid = \"\";\n            this.transactionAccount = new AccountModel();\n\n            /* Load Cash Advance */\n            if (this.expenseSummary.use_for_option === 2) {\n                this.loadCashAdvance();\n            }\n\n            this.filterTransactionAccount();\n        },\n        // Filter Transation Account\n        filterTransactionAccount() {\n            if (this.expenseSummary.use_for_option === 0) {\n                // Credit (Payable Account)\n                this.transactionAccounts = this.accounts.filter((i) => ~AccountTypeCode.PAYABLE_ACCOUNTS.indexOf(i.account_type.number));\n            } else if (this.expense.use_for_option === 3) {\n                // Cash Account\n                this.transactionAccounts = this.accounts.filter((i) => ~AccountTypeCode.CASH_ACCOUNTS.indexOf(i.account_type.number));\n            } else {\n                // Reimbursement / Cash Advance\n                this.transactionAccount = this.advanceSettlementClearingAccount;\n                this.transactionAccounts = [this.advanceSettlementClearingAccount];\n            }\n        },\n        /* Kendo */\n        // DataSource Changes\n        async onExpenseAccountDSChanges(e) {\n            if (e.field) {\n                let dataRow = e.items[0];\n\n                if (e.field === \"supplier\") {\n\t\t\t\t\tdataRow.set(\"account\", new AccountModel(dataRow.supplier.accountTax.expenseAcc));\n\t\t\t\t} else if (e.field === \"account\") {\n                    this.addExtraRow(dataRow.uid);\n                } else if (e.field === \"bill_date\" || e.field === \"bill_currency\") {\n\t\t\t\t\tlet xrate = await this.getExchangeRate(dataRow.bill_date, dataRow.bill_currency.code);\n\n\t\t\t\t\tdataRow.set(\"exchange_rate_uuid\", xrate.id);\n\t\t\t\t\tdataRow.set(\"exchange_rate\", xrate.rate);\n                } else if (e.field === \"quantity\" || e.field === \"price\") {\n                    let amt =\n                        kendo.parseFloat(dataRow.quantity) *\n                        kendo.parseFloat(dataRow.price);\n                    dataRow.set(\"amount\", amt);\n                } else if (e.field === \"uom\") {\n                    if (dataRow.uom) {\n                        dataRow.set(\"uom_uuid\", dataRow.uom.id);\n                    }\n                } else if (e.field === \"class1\") {\n                    if (dataRow.class1 !== null) {\n                        dataRow.set(\"class_1_uuid\", dataRow.class1.id);\n                    } else {\n                        // Set default when deselect\n                        dataRow.set(\"class_1_uuid\", \"\");\n                        dataRow.set(\"class1\", new ClassModel());\n                    }\n                } else if (e.field === \"class2\") {\n                    if (dataRow.class2 !== null) {\n                        dataRow.set(\"class_2_uuid\", dataRow.class2.id);\n                    } else {\n                        // Set default when deselect\n                        dataRow.set(\"class_2_uuid\", \"\");\n                        dataRow.set(\"class2\", new ClassModel());\n                    }\n                } else if (e.field === \"class3\") {\n                    if (dataRow.class3 !== null) {\n                        dataRow.set(\"class_3_uuid\", dataRow.class3.id);\n                    } else {\n                        // Set default when deselect\n                        dataRow.set(\"class_3_uuid\", \"\");\n                        dataRow.set(\"class3\", new ClassModel());\n                    }\n                } else if (e.field === \"class4\") {\n                    if (dataRow.class4 !== null) {\n                        dataRow.set(\"class_4_uuid\", dataRow.class4.id);\n                    } else {\n                        // Set default when deselect\n                        dataRow.set(\"class_4_uuid\", \"\");\n                        dataRow.set(\"class4\", new ClassModel());\n                    }\n                } else if (e.field === \"class5\") {\n                    if (dataRow.class5 !== null) {\n                        dataRow.set(\"class_5_uuid\", dataRow.class5.id);\n                    } else {\n                        // Set default when deselect\n                        dataRow.set(\"class_5_uuid\", \"\");\n                        dataRow.set(\"class5\", new ClassModel());\n                    }\n                }\n\n                this.autoCalculate();\n            }\n        },\n        calculateDiscount(discountItem, subTotal) {\n            if (discountItem) {\n                const nature = discountItem.nature;\n                const amount = discountItem.amount;\n                if (nature === \"Amount\") {\n                    return kendo.parseFloat(amount);\n                } else if (nature === \"Percentage\") {\n                    return subTotal * (kendo.parseFloat(amount) / 100);\n                }\n            }\n        },\n        autoCalculateTax(tax, amount) {\n            if (tax) {\n                var formula = tax.formula;\n                var inAmt = kendo.parseFloat(amount);\n                var nAmt = kendo.parseFloat(amount);\n                var taxBase = kendo.parseFloat(tax.taxBase) / 100;\n                var rate = kendo.parseFloat(tax.rate) / 100;\n                var total = eval(formula);\n                window.console.log(inAmt, nAmt, taxBase, rate, formula, total);\n                return total;\n            }\n            // return 0\n        },\n        // Auto Calculate In DataSource\n        autoCalculate() {\n            let expDS = this.$refs.expenseAccountDS.kendoWidget(),\n                subTotal = 0,\n                discount = 0,\n                purchaseTax = 0,\n                whdTax = 0,\n                inclusiveTax = 0,\n                discountItem = [];\n\n            // Expense\n            expDS.data().forEach((value) => {\n                if (~this.selectedExpenseIds.indexOf(value.uuid)) {\n                    let amt = kendo.parseFloat(value.price) * kendo.parseFloat(value.quantity);\n\n                    /* Exchanged Amount */\n                    value.exchanged_amount = amt * value.exchange_rate;\n                    \n                    /* Subtotal */\n                    subTotal += amt;\n\n                    // Discount\n                    let discountAmount = 0;\n                    if (value.hasOwnProperty('discount'))\n                        if (value.discount.hasOwnProperty('id'))\n                            if (value.discount.id !== \"\") {\n                                discountAmount = this.calculateDiscount(value.discount, amt);\n                                discount += discountAmount;\n                                discountItem.push(value.discount);\n                            }\n\n                    // Tax\n                    if (value.hasOwnProperty('tax_item'))\n                        if (value.tax_item.hasOwnProperty('id'))\n                            if (value.tax_item.id !== \"\") {\n                                let amtAfterDiscount = amt - discountAmount;\n                                const taxAmount = this.autoCalculateTax(value.tax_item, amtAfterDiscount);\n                                if (value.tax_item.baseAmount.toLowerCase() === TaxType.INCLUSIVE) {\n                                    inclusiveTax += taxAmount;\n                                }\n\n                                if (value.tax_item.hasOwnProperty('taxType'))\n                                    if (value.tax_item.taxType.hasOwnProperty('typeId'))\n                                        if (value.tax_item.taxType.typeId === 2) {/* WHD Tax */\n                                            whdTax += taxAmount;\n                                        } else {/* Purchase Tax */\n                                            purchaseTax += taxAmount;\n                                        }\n\n                                /* Set Tax Amount */\n                                if (value.tax_item.taxType.typeId === 1 && value.tax_item.baseAmount.toLowerCase() === TaxType.INCLUSIVE) {/* Inclusive Tax */\n                                    value.set(\"tax_amount\", taxAmount * -1);\n                                } else {\n                                    value.set(\"tax_amount\", taxAmount);\n                                }\n                            }\n                }\n            });\n\n            /* Apply Inclusive Tax */\n            subTotal -= inclusiveTax;\n\n\t\t\tthis.subTotal = subTotal;\n            this.discountAmount = discount;\n            this.purchaseTax = purchaseTax;\n            this.whdTax = whdTax;\n\n            let totalAmount = (this.subTotal - discount) + whdTax + purchaseTax;\n            this.totalAmount = totalAmount;\n\n            let amountDue = this.totalAmount - whdTax;\n            this.amountDue = amountDue;\n        },\n        // Row Number Template\n        rowNumberTmpl(dataItem) {\n            let ds = this.$refs.expenseAccountDS.kendoWidget(),\n                index = ds.indexOf(dataItem);\n\n            return index + 1;\n        },\n        // On Expense Grid Changes\n        onExpenseGridChanges() {\n            let grid = this.$refs.expenseSummaryGrid.kendoWidget();\n\n            // let ids = []\n            // for (let id in grid._selectedIds)\n            // ids.push(id)\n\n            this.selectedExpenseIds = grid.selectedKeyNames();\n            this.autoCalculate();\n        },\n        // Shrink Data\n        shrinkData() {\n            let expenseList = [],\n                expDS = this.$refs.expenseAccountDS.kendoWidget(),\n                lastNumber = this.numbers.last_number,\n                counter = 1;\n\n            /* Update Expense Summary Status */\n            this.expenseSummary.is_cleared = 1;\n\n            // Expense Entries on Dr\n            expDS.data().forEach((value) => {\n                // Filter selected expenses\n                if (~this.selectedExpenseIds.indexOf(value.uuid)) {\n                    let entries = [];\n\n                    /* Update Expense Summary Detail Status Approved */\n                    value.set(\"status\", 1);\n                    \n                    /* Status */\n                    if (this.expenseSummary.use_for_option === 3) {/* Cash */\n                        value.set(\"is_cleared\", 1); /* Paid */\n                    }\n\n                    /* EXPENSE */\n                    let expense = new ExpenseModel(value);\n\n                    /* uuid */\n                    expense.uuid = \"\"; // New\n\n                    /* Number */\n                    if (counter === 1) {\n                        expense.number = this.numbers.number;\n                    } else {\n                        expense.number = this.applyPrefixNumber(lastNumber);\n                        lastNumber++;\n                    }\n                    counter++;\n                    expense.prefix_format = this.numbers.prefix_format;\n\n                    // Date\n                    expense.expense_date = Helper.toISODate(this.expenseSummary.date);\n                    expense.bill_date = Helper.toISODate(value.bill_date);\n\n                    // Supplier\n                    expense.supplier = new ContactModel(value.supplier);\n\n                    // Employee\n                    expense.employee = new ContactModel(this.employee);\n\n                    // Sidebar\n                    expense.location_uuid = this.location.id;\n                    expense.segment_uuid = this.segment.id;\n                    expense.project_uuid = this.project.id;\n\n                    // User\n                    expense.created_by = this.user;\n\n                    /* ENTRIES */\n                    let entry = new ExpenseEntryModel(value);\n\n                    // Account\n                    entry.account = new AccountModel(value.account);\n                    entry.account_uuid = value.account.uuid;\n\n                    // Contact\n                    entry.primary_contact = new ContactModel(value.supplier);\n                    entry.secondary_contacts = [new ContactModel(this.employee)];\n\n                    // Currency\n                    entry.currency = new CurrencyModel(value.bill_currency);\n                    entry.exchange_rate_uuid = value.exchange_rate_uuid;\n                    entry.exchange_rate = value.exchange_rate;\n                    entry.exchanged_amount = value.exchanged_amount;\n\n                    // Discount\n                    entry.discount = new DiscountItemModel(value.discount);\n\n                    // Tax\n                    entry.tax_item = new TaxModel(value.tax_item);\n\n                    /* Expense Account on Dr */\n                    entries.push(new ExpenseEntryModel(entry));\n\n                    // Discount on Cr\n                    let discountAmount = 0;\n                    if (value.hasOwnProperty('discount'))\n                        if (value.discount.hasOwnProperty('id'))\n                            if (value.discount.id !== \"\") {\n                                let subTo = kendo.parseFloat(value.price) * kendo.parseFloat(value.quantity);\n                                discountAmount = this.calculateDiscount(value.discount, subTo);\n                                \n                                /* Discount Entry */\n                                let discountEntry = new ExpenseEntryModel(entry);\n                                discountEntry.account = new AccountModel(value.discount.account);\n                                discountEntry.account_uuid = value.discount.account.uuid;\n                                discountEntry.amount = discountAmount * -1; // Cr side is negative\n                                discountEntry.exchanged_amount = discountAmount * value.exchange_rate;\n                                discountEntry.tax_amount = 0;\n                                discountEntry.exchanged_tax_amount = 0;\n\n                                /* Push Discount Entry */\n                                entries.push(discountEntry);\n                            }\n\n                    // Taxes on Dr\n                    if (value.hasOwnProperty('tax_item'))\n                        if (value.tax_item.hasOwnProperty('id'))\n                            if (value.tax_item.id !== \"\") {\n                                let amtAfterDiscount = kendo.parseFloat(value.amount) - discountAmount;\n                                let taxAmount = this.autoCalculateTax(value.tax_item, amtAfterDiscount);\n\n                                if (value.tax_item.hasOwnProperty('taxType'))\n                                    if (value.tax_item.taxType.hasOwnProperty('typeId'))\n                                        if (value.tax_item.taxType.typeId === 2) {/* WHD Tax on Cr side */\n                                            if (value.tax_item.baseAmount.toLowerCase() === \"net\") {/* WHD Tax Net on Dr side */\n                                                // Add Another Tax Related Expense Account\n                                                let taxRelatedExpenseAccount = new AccountModel(this.accounts.find(i => i.banhjiAccCode === AccountTypeCode.TAX_RELATED_EXPENSE_CODE));\n\n                                                /* Tax Related Expense Entry on Dr */\n                                                let taxRelatedExpenseEntry = new ExpenseEntryModel(entry);\n                                                taxRelatedExpenseEntry.account = taxRelatedExpenseAccount;\n                                                taxRelatedExpenseEntry.account_uuid = taxRelatedExpenseAccount.uuid;\n                                                taxRelatedExpenseEntry.description = i18n.t(\"witholding_tax_expense\");\n                                                taxRelatedExpenseEntry.amount = taxAmount;\n                                                taxRelatedExpenseEntry.exchanged_amount = taxAmount * value.exchange_rate;\n                                                taxRelatedExpenseEntry.tax_amount = 0;\n                                                taxRelatedExpenseEntry.exchanged_tax_amount = 0;\n\n                                                /* Push Tax Related Expense Entry */\n                                                entries.push(taxRelatedExpenseEntry);\n                                            }\n\n                                            // WHD Tax\n                                            taxAmount *= -1; // Cr side\n                                        }\n\n                                /* Tax Entry */\n                                let taxEntry = new ExpenseEntryModel(entry);\n                                taxEntry.account = new AccountModel(value.tax_item.account);\n                                taxEntry.account_uuid = value.tax_item.account.uuid;\n                                taxEntry.amount = taxAmount;\n                                taxEntry.exchanged_amount = taxAmount * value.exchange_rate;\n                                taxEntry.tax_amount = 0;\n                                taxEntry.exchanged_tax_amount = 0;\n\n                                /* Push Tax Entry */\n                                entries.push(taxEntry);\n                            }\n\n                    // Transaction Entries on Cr\n                    entries.push(\n                        new ExpenseEntryModel({\n                            account: new AccountModel(this.transactionAccount),\n                            account_uuid: this.transactionAccount.uuid,\n                            primary_contact: new ContactModel(value.supplier),\n                            secondary_contacts: [new ContactModel(this.employee)],\n                            description: this.expenseSummary.description,\n                            currency: value.bill_currency,\n                            amount: value.amount * -1, // Cr side is negative\n                            exchange_rate_uuid: value.exchange_rate_uuid,\n                            exchange_rate: value.exchange_rate,\n                            exchanged_amount: value.amount * -1 * value.exchange_rate,\n                        })\n                    );\n\n                    /* Add Entries */\n                    expense.expense_entries = entries;\n                    // mapping to Dynamodb ( expense record )\n                    this.mappingExpense(expense, entry);\n\n                    /* JOURNAL */\n                    let journal = new JournalModel();\n                    journal.number = expense.number;\n                    journal.description = expense.journal_note;\n                    journal.journal_date = Helper.toISODate(this.expenseSummary.date);\n                    journal.journal_type = EntityType.AUTO_JOURNAL;\n                    journal.transaction_type = EntityType.EXPENSES;\n                    journal.related_transaction_uuid = this.expenseSummary.use_for_transaction_uuid;\n                    journal.month_of = this.expenseSummary.month_of;\n                    journal.location_uuid = expense.location_uuid;\n                    journal.project_uuid = expense.project_uuid;\n                    journal.segment_uuid = expense.segment_uuid;\n                    journal.prefix_format = this.numbers.prefix_format;\n                    journal.is_draft = expense.is_draft;\n                    journal.created_date = expense.created_date;\n                    journal.created_by = expense.created_by;\n                    journal.modified_by = expense.modified_by;\n\n                    let journalEntries = [];\n                    entries.forEach((value) => {\n                        let entry = new JournalEntryModel(value);\n\n                        /* Apply Inclusive Tax to amount */\n                        if (value.tax_amount !== 0) {\n                            if (value.tax_item.hasOwnProperty(\"taxType\")) {\n                                if (value.tax_item.taxType.hasOwnProperty(\"typeId\")) {\n                                    if (value.tax_item.taxType.typeId === 1 && value.tax_item.baseAmount.toLowerCase() === TaxType.INCLUSIVE) {\n                                        entry.amount = value.amount + value.tax_amount;\n                                    }\n                                }\n                            }\n                        }\n                        entry.exchanged_amount = entry.amount * value.exchange_rate;\n\n                        // Add Entry\n                        journalEntries.push(entry);\n                    });\n\n                    // Add Entry\n                    expenseList.push({\n                        expense: expense,\n                        journal: journal,\n                        journal_entries: journalEntries,\n                    });\n                } else {\n                    /* Update Expense Summary Detail Status Reject */\n                    value.set(\"status\", 2);\n                }\n            });\n\n            /* Add Verified */\n            this.verifiedExpenses = expenseList;\n        },\n        // Validating\n        validateForm() {\n            let result = true,\n                expDS = this.$refs.expenseAccountDS.kendoWidget(),\n                msg = \"\";\n\n            // Expense\n            expDS.data().forEach((value, index) => {\n                if (~this.selectedExpenseIds.indexOf(value.uuid)) {\n                    if (value.supplier.name !== \"\" && value.amount > 0) {\n                        // No date\n                        if (value.bill_date === \"\") {\n                            result = false;\n                            msg += `<p>${i18n.t(\"please_select_date_at_row_number\")} ${index + 1}</p>`;\n                        }\n\n                        // No number\n                        if (value.bill_number === \"\") {\n                            result = false;\n                            msg += `<p>${i18n.t(\"please_input_bill_number_at_row_number\")} ${index + 1}</p>`;\n                        }\n                    }\n\n                    // No supplier\n                    if (value.supplier.name === \"\" && value.amount > 0) {\n                        result = false;\n                        msg += `<p>${i18n.t(\n                            \"please_select_supplier_at_row_number\"\n                        )} ${index + 1}</p>`;\n                    }\n\n                    // No amount\n                    if (value.supplier.name !== \"\" && value.amount === 0) {\n                        result = false;\n                        msg += `<p>${value.supplier.name} ${i18n.t(\"has_no_amount\")}</p>`;\n                    }\n                }\n            });\n\n            // Non selected expense\n            if (this.selectedExpenseIds.length === 0) {\n                msg += `<p>${i18n.t(\"please_select_at_least_one_row\")}</p>`;\n                result = false;\n            }\n\n            // Use for Cash Advance\n            if (\n                this.expenseSummary.use_for_option === 2 &&\n                this.expenseSummary.use_for_transaction_uuid === \"\"\n            ) {\n                msg += `<p>${i18n.t(\"please_select_related_cash_advance\")}</p>`;\n                result = false;\n            }\n\n            /* Transaciton Account */\n            if (this.transactionAccount.uuid === \"\") {\n                msg += `<p>${i18n.t(\"transaction_account_is_required\")}</p>`;\n                result = false;\n            }\n\n            /* Location */\n            if (this.location.id === \"\") {\n                msg += `<p>${i18n.t(\"location_is_required\")}</p>`;\n                result = false;\n            }\n\n            /* Segment */\n            if (this.segment.id === \"\") {\n                msg += `<p>${i18n.t(\"segment_is_required\")}</p>`;\n                result = false;\n            }\n\n            // Show Alert\n            this.errorMessage = msg;\n\n            this.alert = result === false;\n\n            return result;\n        },\n        // All Saves\n        async onSaveOptionClick(mode) {\n            if (this.$refs.form.validate() && this.validateForm()) {\n                let isValidClosingDate = await Helper.validateClosingDate(\n                    this.expenseSummary.date\n                );\n                if (isValidClosingDate) {\n                    this.saveMode = mode;\n                    this.save();\n                }\n            }\n        },\n        cancel() {\n            this.$swal({\n                title: i18n.t(\"msg_title_warning\"),\n                text: i18n.t(\"msg_discard\"),\n                icon: \"warning\",\n                showCancelButton: true,\n                cancelButtonText: i18n.t(\"cancel\"),\n                confirmButtonColor: \"#4d4848\",\n                cancelButtonColor: \"#ED1A3A\",\n                confirmButtonText: i18n.t(\"discard\"),\n            }).then((result) => {\n                if (result.value) {\n                    this.clear();\n                    this.setDefaultData();\n                    this.$router.go(-1);\n                }\n            });\n        },\n        clear() {\n            // Reset Form\n            this.isEdit = false;\n            this.saveMode = \"\";\n\n            this.subTotal = 0;\n            this.discountAmount = 0;\n            this.purchaseTax = 0;\n            this.whdTax = 0;\n            this.totalAmount = 0;\n            this.amountDue = 0;\n            this.disableProject = false;\n\n            this.numbers = null;\n            this.selectedExpenseIds = [];\n            this.verifiedExpenses = [];\n            this.expenseSummary = new ExpenseSummaryModel();\n            this.expenseEntries = [];\n            this.employee = new EmployeeModel();\n            this.location = new LocationModel();\n            this.segment = new SegmentModel();\n            this.project = new ProjectModel();\n\n            let expDS = this.$refs.expenseAccountDS.kendoWidget();\n            expDS.data([]);\n        },\n        save() {\n            let self = this;\n\n            // Shrink Data\n            this.shrinkData();\n\n            // Sync Data\n            this.showLoading = true;\n            expenseHandler\n                .saveBatch(this.verifiedExpenses)\n                .then((response) => {\n                    if(response){\n                        self.updateExpenseSummary();\n                        const res = response.data || []\n                        self.saveTxnExpense(res);\n                        self.responseStatus(response);\n                    }else{\n                        Helper.alertErrorMsg(i18n.t(\"error_something_wrong\"));\n                    }\n                })\n                .catch((error) => {\n                    self.showLoading = false;\n                    Helper.alertErrorMsg(error);\n                })\n                .finally(() => {\n                    self.showLoading = false;\n                });\n        },\n        /* Update Expense Summary */\n        updateExpenseSummary() {\n            // let exp = this.getExp();\n            // let expSum = {\n            // \tuuid                       : exp.uuid,\n            // \tnumber                     : exp.number,\n            // \tdate                       : exp.date,\n            // \temployee                   : exp.employee,\n            // \tsegment_uuid               : exp.segment_uuid,\n            // \tlocation_uuid              : exp.location_uuid,\n            // \tproject_uuid               : exp.project_uuid,\n            // \tmonth_of                   : exp.month_of,\n            // \tuse_for_option             : exp.use_for_option,\n            // \tuse_for_transaction_uuid   : exp.use_for_transaction_uuid,\n            // \tdescription                : exp.description,\n            // \tsummary_details            : exp.summary_details,\n            // \tis_draft                   : exp.is_draft,\n            // \tis_cleared                 : exp.is_cleared,\n\n            // \tcreated_by                 : exp.created_by,\n            // \tmodified_by                : exp.modified_by,\n            // \tcreated_date               : exp.created_date,\n            // \tmodified_date              : exp.modified_date,\n            // };\n            expenseSummaryHandler.save(this.expenseSummary);\n        },\n        // Response Status\n        responseStatus(response) {\n            if (response.status === 200) {\n                if (this.saveMode === SaveOption.SAVECLOSE || this.saveMode === SaveOption.DELETE) {\n                    this.clear();\n                    this.setDefaultData();\n\n                    this.$router.go(-1);\n                } else {\n                    /* Save New */\n                    this.clear();\n                    this.setDefaultData();\n                }\n\n                /* Alert Success */\n                this.$snotify.success(i18n.t(\"successful\"));\n            } else {\n                /* Alert Error */\n                this.$snotify.error(i18n.t(\"error_something_wrong\"));\n            }\n        },\n        HideSmallSideBar() {\n            this.isHideBar = !this.isHideBar;\n        },\n        mappingExpense(expense, entry) {\n            if (this.expenseSummary.use_for_option === 0) {\n                this.txnExpense = new Expenses()\n                entry['id'] = 'lin-' + uuid.v1();\n                const subTotal = entry.amount || 0\n                const discount = this.calculateDiscount(entry.discount, subTotal)\n                const amount = entry.amount || 0\n                const amountAfterDiscount = amount - (discount || 0)\n                const taxItem = entry.tax_item || {}\n                const taxAccount = taxItem.account || {}\n                const taxAccountType = taxAccount.account_type || {}\n                const taxAmount = this.autoCalculateTax(entry.tax_item, amountAfterDiscount)\n                let purchaseTaxAmount = 0\n                let whdTaxAmount = 0\n                // Purchase Tax\n                if (taxAccountType.number === AccountTypeCode.PURCHASE_TAX) {\n                    purchaseTaxAmount = taxAmount || 0\n                } else if (taxAccountType.number === AccountTypeCode.WHD_TAX) {\n                    whdTaxAmount = taxAmount || 0\n                }\n                const total = subTotal - (discount || 0) + purchaseTaxAmount - whdTaxAmount;\n                this.txnExpense.id = '';\n                this.txnExpense.journal_uuid = '';\n                this.txnExpense.type = \"Expense\";\n                this.txnExpense.abbr = '';\n                this.txnExpense.transactionType = {};\n                this.txnExpense.referenceNo = expense.number\n                this.txnExpense.transactionDate = expense.expense_date;\n                this.txnExpense.dueDate = expense.expense_date;\n                this.txnExpense.billDate = expense.bill_date;\n                this.txnExpense.billNumber = expense.bill_number;\n                this.txnExpense.currency = this.removeEmptyValues(entry.currency);\n                this.txnExpense.supplier = this.supplierMap(expense.supplier);\n                this.txnExpense.employee = this.removeEmptyValues(expense.employee);\n                this.txnExpense.paymentTerm = this.paymentTerm;\n                this.txnExpense.segment = this.removeEmptyValues(this.segment);\n                this.txnExpense.location = this.removeEmptyValues(this.location);\n                this.txnExpense.project = this.removeEmptyValues(this.project);\n                this.txnExpense.monthOf = this.expenseSummary.month_of;\n\n                this.txnExpense.additionalCostSupplier = this.removeEmptyValues(expense.additional_cost_supplier);\n                this.txnExpense.use_for_transaction_uuid = this.expenseSummary.use_for_transaction_uuid;\n                this.txnExpense.useForOption = this.expenseSummary.use_for_option;\n                this.txnExpense.transactionNote = entry.description || '';\n                this.txnExpense.journalNote = this.expenseSummary.description || ''\n                this.txnExpense.itemLines = [entry];\n                this.txnExpense.account = new AccountMappingModel(this.transactionAccount);\n                this.txnExpense.saveOption = expense.is_draft;\n                this.txnExpense.status = 1;\n                this.txnExpense.createdAt = expense.created_date;\n\n                this.txnExpense.total = parseFloat(total);\n                this.txnExpense.exchangeTotal = parseFloat(total) * (entry.exchange_rate || 1);\n                this.txnExpense.amountDue = total\n                this.txnExpense.remainingAmount = total\n                this.txnExpense.subTotal = subTotal\n                this.txnExpense.purchaseTax = purchaseTaxAmount;\n                this.txnExpense.whdTax = whdTaxAmount;\n                this.txnExpense.supplierDiscountItem = this.removeDuplicate([entry.discount] || []);\n                this.txnExpense.loggedUser = this.loggedUser(expense.created_by);\n\n                this.txnExpense.txnRate = entry.exchange_rate;\n                this.txnExpense.discountTotal = parseFloat((discount || 0));\n                this.txnExpense.depositAmount = 0\n                this.txnExpense.depositDeduction = 0\n                this.txnExpense.exchangeDepositDeduction = 0\n                this.txnExpense.exchangeAmount = total * (entry.exchange_rate || 1);\n                this.txnExpenseList.push(this.txnExpense)\n                window.console.log(\"Expense\", this.txnExpenseList);\n            }\n        },\n        loggedUser(user) {\n            if (user) {\n                return {\n                    id: user.id,\n                    name: user.user_name,\n                    email: user.email,\n                };\n            }\n            return {};\n        },\n        supplierMap(supplier) {\n            if (supplier) {\n                return {\n                    id: supplier.uuid,\n                    name: supplier.name,\n                    email: supplier.email,\n                    phone: supplier.phone,\n                    address: supplier.address,\n                };\n            }\n            return {};\n        },\n        removeEmptyValues(obj) {\n            for (let propName in obj) {\n                if (!obj[propName] || obj[propName].length === 0) {\n                    delete obj[propName];\n                } else if (typeof obj[propName] === \"object\") {\n                    this.removeEmptyValues(obj[propName]);\n                }\n            }\n            return obj;\n        },\n        removeDuplicate(array) {\n            const result = [];\n            const map = new Map();\n            for (const item of array) {\n                if (!map.has(item.id)) {\n                    map.set(item.id, true); // set any value to Map\n                    result.push(item);\n                }\n            }\n            return result;\n        },\n        saveTxnExpense(response) {\n            this.txnExpenseList.forEach(m => {\n                const found = response.filter(n => n.number === m.referenceNo)\n                if (found.length > 0) {\n                    const data = found[0] || {}\n                    m['uuid'] = data.uuid || ''\n                    m['id'] = ''\n                    m['journal_uuid'] = data.journal_uuid || ''\n                    m['actionType'] = 'new'\n                }\n            })\n            let data = this.txnExpenseList;\n            billingHandler\n                .createExpenseBatch(data)\n                .then((response) => {\n                    if (response.data.statusCode === 201) {\n                        this.$snotify.success(\"Successfully\");\n                    }\n                })\n                .catch((e) => {\n                    this.$snotify.error(\"Something went wrong\");\n                    this.errors.push(e);\n                });\n        },\n    },\n    watch: {\n        initExpenseSummary() {\n            this.initialData();\n        },\n    },\n    created() {\n        this.loadData();\n    },\n    mounted() {\n        // Initial Data\n        this.initialData();\n    },\n};\n</script>\n\n<style scoped>\n.v-input.custom-radio\n.v-input--selection-controls__input\n.v-input--selection-controls__ripple {\n    display: none !important;\n}\n\n.function_wrapper {\n    box-shadow: none !important;\n}\n\n.v-application--is-ltr .v-text-field .v-input__append-inner {\n    margin-top: 0 !important;\n}\n\n.v-input__slot {\n    background-color: #fff !important;\n}\n\n.function_content .label {\n    margin-bottom: 10px;\n    display: inline-block;\n}\n\n.border_radius10 {\n    border-radius: 10px !important;\n    background-color: #f2f2f2;\n}\n\n.pa-3.v-card h4 {\n    font-size: 18px;\n    color: #333;\n}\n\n.pa-3.v-card p {\n    font-size: 12px;\n    color: #b5b5b5;\n}\n\n.attachment_file {\n    background-color: #efeded;\n    border-radius: 0 !important;\n}\n\n.attachment_table.v-data-table table {\n    border: thin solid rgba(0, 0, 0, 0.12);\n}\n\n.attachment_table table tr th {\n    border-left: thin solid rgba(0, 0, 0, 0.12);\n    height: 35px;\n    border-right: thin solid rgba(0, 0, 0, 0.12);\n}\n\n.block_debit,\n.block_credit {\n    border-bottom: 1px solid #fff;\n}\n\n.block_debit p.number,\n.block_credit p.number {\n    font-size: 25px;\n    color: #7f7f7f;\n}\n\n.block_debit h5,\n.block_credit h5,\n.block_difference h5 {\n    text-transform: uppercase;\n    color: #7f7f7f;\n    font-size: 15px;\n    font-weight: normal;\n}\n\n.block_difference h5 {\n    font-size: 18px;\n}\n\n.block_difference h5 span {\n    font-size: 15px;\n}\n\n.custom_grid table th:last-child {\n    text-align: right !important;\n}\n\n@media (min-width: 1264px) {\n    .container {\n        max-width: 1250px;\n    }\n}\n\n@media (max-width: 576px) {\n    .pt-6.col-sm-5.col-12 {\n        padding-top: 0 !important;\n    }\n\n    .code_text {\n        width: 100%;\n    }\n\n    .phone_no_pt {\n        padding-top: 0 !important;\n    }\n\n    .select_template,\n    .save_option {\n        margin-bottom: 10px;\n    }\n}\n\n.hide_small_bar_class {\n    max-width: 0;\n    transition: 0.5s ease-in;\n    flex: 0 0 0;\n    padding: 0;\n}\n\n.hide_big_bar_class {\n    max-width: 100%;\n    transition: 0.5s ease-in;\n    flex: 0 0 100%;\n}\n\n.info_add {\n    background-color: #ffffff;\n}\n\n.small_sidebar {\n    height: 98%;\n    position: relative;\n    padding: 12px;\n    background-color: #edf1f5;\n}\n\n.iconArrow {\n    right: -35px;\n    position: absolute;\n    bottom: -10px;\n}\n\n.iconArrowHide {\n    position: absolute;\n    right: -7px;\n    bottom: -10px;\n}\n\n.color_grey {\n    color: #808080;\n}\n\n.card_green {\n    min-height: 70px;\n    background-color: #00b050 !important;\n    color: #ffffff;\n}\n\n.lb_bold {\n    font-size: 12px;\n}\n\n.detial_smallside_p {\n    position: absolute;\n    bottom: 10px;\n}\n\n.card_background {\n    background-color: #edf1f5;\n    min-height: 120px;\n}\n\n.deposite_input {\n    width: 100px;\n}\n\n.btn_save_draft {\n    color: #ffffff;\n    background-color: #00b0f0 !important;\n    text-transform: capitalize;\n}\n\n.save_option {\n    background-color: #203864 !important;\n}\n\n.btn_add_small {\n    height: 27px !important;\n    min-width: 25px !important;\n    font-size: 10px;\n    padding: 0 22px !important;\n    background-color: #00b050 !important;\n    color: #ffffff;\n    border-radius: 0 !important;\n}\n\n.list_site_inv {\n    background-color: #92d050;\n    color: #ffffff;\n    font-size: 12px;\n}\n\n.list_site_exp {\n    background-color: #c5e0b4;\n    color: #000000;\n    font-size: 12px;\n    line-height: 16px;\n    min-height: 40px;\n}\n\n.checkbox_inv {\n    padding: 2px;\n    margin-top: 3px;\n    margin-right: 2px;\n}\n\n.exp_select {\n    font-size: 12px !important;\n}\n\n.theme--light.v-data-table\n> .v-data-table__wrapper\n> table\n> tbody\n> tr:hover:not(.v-data-table__expanded__content):not(.v-data-table__empty-wrapper) {\n    background-color: transparent !important;\n}\n</style>\n"]}]}