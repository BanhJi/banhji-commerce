{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/services_projects/projects/Project.vue?vue&type=style&index=0&id=7a6e7e52&scoped=true&lang=css&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/services_projects/projects/Project.vue","mtime":1638499443305},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgpAbWVkaWEgKG1pbi13aWR0aDogMTI2NHB4KSB7CiAgLmNvbnRhaW5lciB7CiAgICBtYXgtd2lkdGg6IDEwODBweCAhaW1wb3J0YW50OwogIH0KfQoKLmstZHJvcGRvd24gewogIHdpZHRoOiAxMDAlOwogIG1hcmdpbi10b3A6IDNweDsKfQoKLmJrZ3JleSB7CiAgYmFja2dyb3VuZDogI0Y4RjhGOTsKfQo="},{"version":3,"sources":["Project.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4dA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"Project.vue","sourceRoot":"src/views/services_projects/projects","sourcesContent":["<template>\n  <v-app>\n    <v-container>\n      <v-row>\n        <v-col cols=\"12\" sm=\"12\">\n          <v-card outlined dense class=\"pa-4 no_border rounded-sm\" color=\"white\">\n            <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n              <v-card outlined dense class=\"no_border\">\n                <h2 class=\"mb-0\">{{ $t('project') }}</h2>\n                <v-icon\n                    @click=\"cancel()\"\n                    style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                    class=\"float-right\"\n                >close\n                </v-icon>\n              </v-card>\n              <v-card outlined dense class=\"px-3 no_border mb-3\" color=\"white\">\n                <v-row class=\"bkgrey\">\n                  <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                    <label class=\"label\">{{ $t(\"project_code\") }}*</label>\n                    <v-text-field\n                      class=\"mt-1\" \n                      v-model=\"project.code\"\n                      :rules=\"[v => !!v || $t('is_required')]\"\n                      outlined/>\n                    <label class=\"label\">{{ $t(\"project_name\") }}*</label>\n                    <v-text-field \n                      v-model=\"project.name\" \n                      class=\"mt-1\" outlined\n                      :rules=\"[v => !!v || $t('is_required')]\"/>\n                  </v-col>\n                  <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                    <label class=\"label\">{{ $t(\"starting_date\") }}*</label>\n                    <app-datepicker :initialDate=\"project.startDate\"\n                      @emitDate=\"project.startDate = $event\"/>\n                    <label class=\"label\">{{ $t(\"ending_date\") }}*</label>\n                    <app-datepicker :initialDate=\"project.endDate\"\n                      @emitDate=\"project.endDate = $event\"/>\n                  </v-col>\n                  <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                    <label class=\"label\">{{ $t(\"description\") }}</label>\n                    <v-textarea v-model=\"project.description\" class=\"mt-1\" no-resize height=\"120px\"\n                      outlined\n                      rows=\"5\"/>\n                  </v-col>\n                </v-row>\n                <v-row>\n                  <v-col sm=\"12\" cols=\"12\" class=\"py-2\">\n                    <p class=\"mb-0\" v-if=\"appType != 'npo'\">\n                      {{ $t('this_project_customer') }}\n                    </p>\n                    <p v-else class=\"mb-0\">\n                      {{ $t('this_project_donor') }}\n                    </p>\n                  </v-col>\n                  <v-col sm=\"12\" cols=\"12\">\n                    <kendo-datasource ref=\"customersDS\"\n                      :change=\"dataSourceChanged\"\n                      :data=\"customerList\"/>\n                    <kendo-grid id=\"gridCustomers\" class=\"grid-function\"\n                      :data-source-ref=\"'customersDS'\"\n                      :editable=\"true\"\n                      :scrollable-virtual=\"true\">\n                      <kendo-grid-column\n                        :field=\"'no'\"\n                        :title=\"$t('no')\"\n                        :template=\"rowNumber\"\n                        :width=\"45\"\n                        :column-menu=\"false\"\n                        :headerAttributes=\"{ style: 'background-color: #EDF1F5;', class: 'text-center'\t}\"\n                        :attributes=\"{style: 'text-align: center'}\"/>\n                      <kendo-grid-column\n                        :field=\"'customer'\"\n                        :title=\" appType != 'npo' ? $t('customer'): $t('donor') \"\n                        :width=\"150\"\n                        :template=\"'<span>#=customer.number# - #=customer.name#</span>'\"\n                        :editor=\"customerDropDownEditor\"\n                        :headerAttributes=\"{ style: 'background-color: #EDF1F5' }\"/>\n                      <kendo-grid-column\n                        :field=\"'saleOrder'\"\n                        :title=\" appType != 'npo' ? $t('sale_order') : $t('contract') \"\n                        :width=\"150\"\n                        :template=\"'<span>#=saleOrder.referenceNo || ``#</span>'\"\n                        :editor=\"SaleOrderDropDownEditor\"\n                        :headerAttributes=\"{ style: 'background-color: #EDF1F5' }\"/>\n                      <kendo-grid-column\n                        :field=\"'amount'\"\n                        :title=\"$t('amount')\"\n                        :width=\"150\"\n                        :editable=\"()=>{ return false}\"\n                        :template=\"amountFormat\"\n                        :attributes=\"{style: 'text-align: right'}\"\n                        :headerAttributes=\"{ style: 'background-color: #EDF1F5' }\"/>\n                      <kendo-grid-column\n                        :field=\"''\"\n                        :title=\"$t('action')\"\n                        :width=\"70\"\n                        :command=\"[{ iconClass: 'k-icon k-i-trash', text: 'Delete', click: removeRow }]\"\n                        :headerAttributes=\"{style: 'text-align: right; background-color: #EDF1F5'}\"/>\n                    </kendo-grid>\n                  </v-col>\n                  <v-col sm=\"5\" cols=\"12\" class=\"pt-0 px-4\">\n                    <v-btn color=\"primary\" class=\"float-left btn_plus rounded-0 mr-2\" @click=\"addRow\">\n                      <v-icon size=\"\" class=\"ma-1\">mdi-plus</v-icon>\n                    </v-btn>\n                  </v-col>\n                </v-row>\n              </v-card>\n              <v-divider class=\"mt-4\"/>\n              <v-card outlined dense class=\"no_border function_footer\">\n                <v-btn color=\"black\" class=\"text-capitalize  white--text float-left\"\n                  @click=\"cancel\">{{ $t('cancel') }}\n                </v-btn>\n                <v-btn @click=\"onSaveClose('close')\" color=\"primary\"\n                  class=\" float-right text-capitalize  white--text\">\n                  {{ $t('save_close') }}\n                </v-btn>\n                <v-btn color=\"secondary\"\n                    style=\"margin-right: 10px !important\"\n                    class=\"white--text float-right text-capitalize\"\n                    @click=\"onSaveClose('new')\" :hidden=\"hiddenButton\">{{ $t(\"save_new\") }}\n                </v-btn>\n              </v-card>\n            </v-form>\n          </v-card>\n        </v-col>\n      </v-row>\n      <LoadingMe\n          :isLoading=\"showLoading\"\n          :fullPage=\"false\"\n          :myLoading=\"true\"/>\n    </v-container>\n  </v-app>\n</template>\n\n<script>\nimport {i18n} from '@/i18n';\nimport DatePickerComponent from '@/components/custom_templates/DatePickerComponent'\nimport ServiceProject from \"@/scripts/service/model/project\";\nimport kendo from \"@progress/kendo-ui\";\nimport {dataStore} from \"@/observable/store\";\n\nconst $ = require(\"jquery\")\nconst customerHandler = require(\"@/scripts/customerHandler\")\nconst saleOrderHandler = require(\"@/scripts/transactionHandler\")\nconst projectHandler = require(\"@/scripts/projectHandler\")\nconst saleFormContentHandler = require(\"@/scripts/saleFormContentHandler\")\n\nexport default {\n  name: \"Project\",\n  props: [\"id\"],\n  components: {\n    LoadingMe: () => import(`@/components/Loading`),\n    'app-datepicker': DatePickerComponent,\n  },\n  data: () => ({\n    template: [],\n    startingDate: '',\n    endingDate: '',\n    valid: true,\n    showLoading: false,\n    customerList: [],\n    customers: [],\n    customer: {},\n    filter: '',\n    saleOrders: [],\n    saleFormContent: {},\n    project: new ServiceProject({})\n\n  }),\n  methods: {\n    amountFormat(value) {\n      return kendo.toString(parseFloat(value.amount), `n${this.saleFormContent.decimal}`)\n    },\n    async loadSaleFormContent() {\n      new Promise(resolve => {\n        setTimeout(() => {\n          resolve('resolved');\n          saleFormContentHandler.list().then(res => {\n            if (res.data.statusCode === 200) {\n              const data = res.data.data\n              if (data.length > 0) {\n                this.saleFormContent = data[0]\n              }\n            }\n          })\n        }, 10)\n      })\n    },\n    removeRow(e) {\n      e.preventDefault();\n      const grid = kendo.jQuery(\"#gridCustomers\").data(\"kendoGrid\"),\n        dataSource = grid.dataSource,\n        dataItem = grid.dataItem($(e.currentTarget).closest(\"tr\"));\n      if (dataSource.total() > 1) {\n        dataSource.remove(dataItem);\n      }\n    },\n    async initData() {\n      if (this.$route.params.id !== undefined) {\n        await this.loadSingleProject()\n      } else {\n        await this.clear()\n      }\n    },\n    onUpdate() {\n      this.$emit(\"onUpdate\", this.project);\n    },\n    dataSourceChanged(e) {\n      if (e.field) {\n        let dataRow = e.items[0]\n        // window.console.log(e.field)\n        switch (e.field) {\n          case \"customer\":\n            // this.onloadSaleOrder(dataRow.customer)\n            window.console.log(dataRow)\n            break\n          case \"saleOrder\":\n            dataRow.set('amount', dataRow.saleOrder.exchangeAmount)\n            dataRow.set('decimalFormat', dataRow.saleOrder.decimalFormat)\n            break\n          default:\n            break\n        }\n      }\n    },\n    async onloadSaleOrder(value) {\n      let data = {\n        \"method\": \"by_customer\",\n        \"customer\": value.id,\n        \"type\": 'Sale Order',\n      }\n      await saleOrderHandler.search(data).then(res => {\n        this.saleOrders = res.data.data\n      })\n    },\n    rowNumber(dataItem) {\n      let ds = this.$refs.customersDS.kendoWidget(),\n          index = ds.indexOf(dataItem);\n      return index + 1;\n    },\n    async addRow() {\n      let ds = this.$refs.customersDS.kendoWidget(),\n          total = ds.total();\n      // if (total < 1) {\n      await ds.insert(total, {\n        customer: {\n          name: '',\n          number: '',\n        },\n        saleOrder: {\n          number: ''\n        },\n        amount: 0,\n        decimalFormat: 'n' + this.saleFormContent.decimal\n      })\n      // }\n    },\n    SaleOrderDropDownEditor(container, options) {\n      kendo.jQuery('<input name=\"' + options.field + '\"/>')\n          .appendTo(container)\n          .kendoDropDownList({\n            autoBind: true,\n            autoWidth: true,\n            height: 400,\n            filter: \"startswith\",\n            dataTextField: \"referenceNo\",\n            dataValueField: \"id\",\n            cascadeFrom: \"item\",\n            template: \"<span>#=referenceNo#</span>\",\n            optionLabel: \"--- Select ---\",\n            dataSource: new kendo.data.DataSource({\n              serverFiltering: true,\n              transport: {\n                read: {\n                  url: saleOrderHandler.searchURL('?id=' + options.model.customer.id + '&type=Sale Order'),\n                },\n                dataType: \"json\",\n              },\n              schema: {\n                model: {\n                  id: \"id\",\n                  fields: {\n                    id: {type: \"string\"},\n                    exchangeAmount: {type: \"string\"},\n                    referenceNo: {type: \"string\"},\n                    amount: {type: \"string\"},\n                  }\n                },\n                data: function (response) {\n                  return response.data;\n                },\n                total: function (response) {\n                  return response.data.count;\n                }\n              },\n            })\n          })\n    },\n    customerDropDownEditor(container, options) {\n      kendo.jQuery('<input required name=\"' + options.field + '\"/>')\n      .appendTo(container)\n      .kendoDropDownList({\n        autoBind: true,\n        autoWidth: true,\n        height: 400,\n        filter: \"contains\",\n        dataTextField: \"name\",\n        dataValueField: \"id\",\n        headerTemplate: '<div class=\"dropdown-header k-widget k-header\">' +\n            '<span>Customers </span>' +\n            '<span> </span>' +\n            '</div>',\n        template: \"<span>#=number# - #=name#</span>\",\n        optionLabel: \"--- Select ---\",\n        dataSource: new kendo.data.DataSource({\n          serverFiltering: true,\n          transport: {\n            read: {\n              url: customerHandler.search(),\n            },\n            dataType: \"json\",\n          },\n          schema: {\n            model: {\n              id: \"id\",\n              fields: {\n                id: {type: \"string\"},\n                type: {type: \"string\"},\n                number: {type: \"string\"},\n                billingType: {type: \"string\"},\n                consumerId: {type: \"string\"},\n                taxId: {type: \"string\"},\n              }\n            },\n            data: function (response) {\n              return response.data;\n            },\n            total: function (response) {\n              return response.data.count;\n            }\n          },\n            // data: this.variants\n        }),\n      })\n    },\n    cancel() {\n      this.$swal({\n          title: i18n.t('msg_title_warning'),\n          text: i18n.t('msg_discard'),\n          icon: \"warning\",\n          showCancelButton: true,\n          cancelButtonText: i18n.t('cancel'),\n          confirmButtonColor: \"#4d4848\",\n          cancelButtonColor: \"#ED1A3A\",\n          confirmButtonText: i18n.t('discard'),\n      }).then((resultCen) => {\n          if (resultCen.value) {\n            this.clear()\n            this.$router.go(-1);\n            return false\n          }\n      });\n    },\n    async clear() {\n      this.project = new ServiceProject({})\n      this.customers = []\n      let ds = this.$refs.customersDS.kendoWidget();\n      this.customerList = ds.data([]);\n      this.addRow()\n\n    },\n    async onSaveClose(isSave) {\n      window.console.log(1)\n      if (!this.$refs.form.validate()) {\n        this.$refs.form.validate();\n        return;\n      }\n      let ds = this.$refs.customersDS.kendoWidget();\n      let d1 = ds.data()\n      let dataValidate = 0\n      d1.forEach((value, index) => {\n        if(value.customer == undefined || value.customer.id == undefined || value.customer.id  == '' || value.customer.id == null || value.saleOrder == undefined || value.saleOrder.id == undefined || value.saleOrder.id  == '' || value.saleOrder.id == null){\n          this.$snotify.error('Please check ustomer or Sale Order  on row ' + (index + 1))\n        }else{\n          dataValidate  += 1\n        }\n      });\n      if(d1.length  == dataValidate){\n        new Promise((resolve) => {\n          setTimeout(() => {\n            resolve(\"resolved\");\n            let customerDS = this.$refs.customersDS.kendoWidget()\n            let data = {\n              id: this.$route.params.id,\n              name: this.project.name,\n              code: this.project.code,\n              startDate: this.project.startDate,\n              endDate: this.project.endDate,\n              status: 1,\n              description: this.project.description,\n              customers: customerDS.data(),\n              type: this.$route.params.id ? this.$route.query.type : 'new'\n            }\n            projectHandler.create(data).then(res => {\n              window.console.log(res)\n              if(isSave == 'new'){\n                this.clear()\n              }else if(isSave == 'close'){\n                this.clear()\n                this.$router.go(-1);\n              }\n            }).catch(e => {\n              this.$snotify.error('Something went wrong')\n              this.errors.push(e)\n            })\n          })\n        })\n      }\n    },\n    async loadSingleProject() {\n      this.showLoading = true\n      new Promise(resolve => {\n        setTimeout(() => {\n          resolve('resolved')\n          projectHandler.get(this.$route.params.id).then(response => {\n            if (response.data.statusCode === 200) {\n              this.project = response.data.data[0]\n              if (this.project.hasOwnProperty('customers')) {\n                this.customerList = this.project.customers\n              }\n              this.showLoading = false\n            }\n          }).catch(e => {\n            this.$snotify.error('Something went wrong')\n            this.errors.push(e)\n          })\n        })\n      })\n    },\n  },\n  created() {\n    this.loadSaleFormContent()\n  },\n  async mounted() {\n    await this.initData()\n\n    // this.requestData(0, '', customerHandler.search())\n  },\n  watch: {\n    async id() {\n      // this.product = this.selectedProduct\n      // window.console.log(this.id, 'watch')\n      if (this.id !== undefined) {\n        await this.loadSingleProject()\n      }else{\n        this.clear()\n      }\n    }\n  },\n  computed: {\n    appType() {\n        return dataStore.productType;\n    },\n    hiddenButton(){\n      if(this.$route.query.type ==\"edit\"){\n        return true\n      }else{\n        return false\n      }\n    }\n  },\n};\n</script>\n\n<style scoped>\n@media (min-width: 1264px) {\n  .container {\n    max-width: 1080px !important;\n  }\n}\n\n.k-dropdown {\n  width: 100%;\n  margin-top: 3px;\n}\n\n.bkgrey {\n  background: #F8F8F9;\n}\n</style>\n"]}]}