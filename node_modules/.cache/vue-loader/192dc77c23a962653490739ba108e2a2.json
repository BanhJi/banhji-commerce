{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/suppliers/RequestPayment.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/suppliers/RequestPayment.vue","mtime":1642155812741},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7aTE4bn0gZnJvbSAiQC9pMThuIjsKaW1wb3J0IERhdGVQaWNrZXJDb21wb25lbnQgZnJvbSAiQC9jb21wb25lbnRzL2N1c3RvbV90ZW1wbGF0ZXMvRGF0ZVBpY2tlckNvbXBvbmVudCI7CmltcG9ydCBzdXBwbGllckhhbmRsZXIgZnJvbSAiQC9zY3JpcHRzL3N1cHBsaWVySGFuZGxlciI7CmltcG9ydCBqb3VybmFsSGFuZGxlciBmcm9tICJAL3NjcmlwdHMvam91cm5hbEhhbmRsZXIiOwppbXBvcnQgUmVxdWVzdFBheW1lbnRNb2RlbCBmcm9tICJAL3NjcmlwdHMvcmVxdWVzdC1wYXltZW50L21vZGVsL1JlcXVlc3RQYXltZW50IjsKaW1wb3J0IEl0ZW1MaW5lTW9kZWwgZnJvbSAiQC9zY3JpcHRzL3JlcXVlc3QtcGF5bWVudC9tb2RlbC9JdGVtTGluZSI7CmltcG9ydCBrZW5kbyBmcm9tICJAcHJvZ3Jlc3Mva2VuZG8tdWkiOwppbXBvcnQgYmlsbGluZ0hhbmRsZXIgZnJvbSAiQC9zY3JpcHRzL2ludm9pY2UvaGFuZGxlci9iaWxsaW5nSGFuZGxlciI7CmltcG9ydCBwcmVmaXhIYW5kbGVyIGZyb20gIkAvc2NyaXB0cy9wcmVmaXhIYW5kbGVyIjsKaW1wb3J0IHB1cmNoYXNlRm9ybUNvbnRlbnRIYW5kbGVyIGZyb20gIkAvc2NyaXB0cy9wdXJjaGFzZUZvcm1Db250ZW50SGFuZGxlciI7CmltcG9ydCBzZXR0aW5nSGFuZGxlciBmcm9tICJAL3NjcmlwdHMvc2V0dGluZ3NIYW5kbGVyIjsKaW1wb3J0IHtDdXJyZW5jeU1vZGVsLCBQYXltZW50VGVybU1vZGVsfSBmcm9tICJAL3NjcmlwdHMvbW9kZWwvQXBwTW9kZWxzIjsKaW1wb3J0IFBheW1lbnRPcHRpb25Nb2RlbCBmcm9tICJAL3NjcmlwdHMvbW9kZWwvUGF5bWVudE9wdGlvbiI7CmltcG9ydCBBY2NvdW50TWFwcGluZ01vZGVsIGZyb20gIkAvc2NyaXB0cy9hY2NvdW50LW1hcC9BY2NvdW50IjsKaW1wb3J0IFN1cHBsaWVyTW9kZWwgZnJvbSAiQC9zY3JpcHRzL21vZGVsL1N1cHBsaWVyIjsKaW1wb3J0IEhlbHBlciBmcm9tICJAL2hlbHBlciI7Cgpjb25zdCBjb29raWVKUyA9IHJlcXVpcmUoIkAvY29va2llLmpzIik7CmNvbnN0IGNvb2tpZSA9IGNvb2tpZUpTLmdldENvb2tpZSgpOwpjb25zdCByZXF1ZXN0UGF5bWVudE1vZGVsID0gbmV3IFJlcXVlc3RQYXltZW50TW9kZWwoe30pOwpjb25zdCBpdGVtTGluZU1vZGVsID0gbmV3IEl0ZW1MaW5lTW9kZWwoe30pOwoKY29uc3QgT1BUSU9OX1RZUEUgPSAiU3VwcGxpZXIiOwpjb25zdCBUUkFOU0FDVElPTl9UWVBFID0gIlJlcXVlc3QgUGF5bWVudCI7CmNvbnN0IFRYTl9UWVBFID0gInJlcXVlc3QgcGF5bWVudCI7CgpleHBvcnQgZGVmYXVsdCB7CiAgICBuYW1lOiAiUmVxdWVzdFBheW1lbnQiLAogICAgY29tcG9uZW50czogewogICAgICAgIExvYWRpbmdNZTogKCkgPT4gaW1wb3J0KGBAL2NvbXBvbmVudHMvTG9hZGluZ2ApLAogICAgICAgICJhcHAtZGF0ZXBpY2tlciI6IERhdGVQaWNrZXJDb21wb25lbnQsCiAgICAgICAgInZlbmRvci1kcm9wZG93bmxpc3QiOiAoKSA9PgogICAgICAgICAgICBpbXBvcnQoIkAvY29tcG9uZW50cy9kcm9wZG93bmxpc3QvVmVuZG9yRHJvcGRvd24iKSwKICAgICAgICAicGF5bWVudG9wdGlvbi1kcm9wZG93bmxpc3QiOiAoKSA9PgogICAgICAgICAgICBpbXBvcnQoIkAvY29tcG9uZW50cy9kcm9wZG93bmxpc3QvUGF5bWVudE9wdGlvbkRyb3BEb3duTGlzdCIpLAogICAgfSwKICAgIGRhdGE6ICgpID0+ICh7CiAgICAgICAgc2hvd0xvYWRpbmc6IGZhbHNlLAogICAgICAgIGN1c3RvbWVyTGlzdDogW10sCiAgICAgICAgZ3JvdXA6IFtdLAogICAgICAgIHN1cHBsaWVyczogW10sCiAgICAgICAgY3VzdG9tZXI6IHt9LAogICAgICAgIG92ZXJEdWVBbW91bnQ6IDAsCiAgICAgICAgcmVjZWl2YWJsZUJhbGFuY2U6IDAsCiAgICAgICAgdG9iZUNvbGxlY3RlZDogMCwKICAgICAgICB2YWxpZDogdHJ1ZSwKICAgICAgICB0ZW1wbGF0ZTogW10sCiAgICAgICAgdGVtcGxhdGVzOiBbXSwKICAgICAgICBpdGVtTGluZXM6IFtdLAogICAgICAgIHRyYW5zYWN0aW9uVHlwZXM6IFtdLAogICAgICAgIHJlY2VpdmFibGVMaXN0OiBbXSwKICAgICAgICByZXF1ZXN0UGF5bWVudDogcmVxdWVzdFBheW1lbnRNb2RlbCwKICAgICAgICBpdGVtTGluZTogaXRlbUxpbmVNb2RlbCwKICAgICAgICBzdXBCYXNlVXJsOiBzdXBwbGllckhhbmRsZXIuc2VhcmNoKCksCiAgICAgICAgc2VsZWN0ZWRFeHBlbnNlSWRzOiBbXSwKICAgICAgICBwdXJjaGFzZUZvcm1Db250ZW50OiB7fSwKICAgICAgICBiYWxhbmNlOiAwLAogICAgICAgIGpSYXc6IFtdLAogICAgICAgIHR4bkxpc3Q6IFtdLAogICAgICAgIGdhaW5Mb3NzQWNjOiB7fSwKICAgICAgICBvdGhlclJldmVudWVBY2M6IHt9LAogICAgICAgIGdhaW5Pckxvc3NEZXNjcmlwdGlvbjogImdhaW4vbG9zcyBvbiBleGNoYW5nZSByYXRlIiwKICAgICAgICBwZW5hbHR5RGVzY3JpcHRpb246ICJwZW5hbHR5IiwKICAgICAgICBiYXNlQ3VycmVuY3lDb2RlOiAiIiwKICAgICAgICBsb2dnZWRVc2VyOiB7CiAgICAgICAgICAgIGlkOiBjb29raWUuY3JlYXRvciwKICAgICAgICAgICAgbmFtZTogY29va2llLmVtYWlsLAogICAgICAgIH0sCiAgICAgICAgY3I6IDAsCiAgICAgICAgZHI6IDAsCiAgICAgICAgZnVuZEJhbGFuY2U6IDAsCiAgICAgICAgdmVuZG9yUmVtYWluaW5nQmFsYW5jZTogMCwKICAgICAgICBmdW5kUmVtYWluQmFsYW5jZTogMCwKICAgICAgICBzY2hlbWFEZWZpbml0aW9uOiB7CiAgICAgICAgICAgIG1vZGVsOiB7aWQ6ICJsaW5lSWQifSwKICAgICAgICB9LAogICAgICAgIGlzQ2hlY2tDaGFuZ2VkOiBmYWxzZSwKICAgIH0pLAogICAgbWV0aG9kczogewogICAgICAgIG9uVmVuZG9yQ2hhbmdlZCh2YWx1ZSkgewogICAgICAgICAgICB0aGlzLnJlcXVlc3RQYXltZW50LnN1cHBsaWVyID0gdmFsdWU7CiAgICAgICAgICAgIGNvbnN0IHN1cHBsaWVyID0gdGhpcy5yZXF1ZXN0UGF5bWVudC5zdXBwbGllciB8fCB7fTsKICAgICAgICAgICAgY29uc3Qgc3VwcGxpZXJJZCA9IHN1cHBsaWVyLmlkIHx8ICIiOwogICAgICAgICAgICBpZiAoc3VwcGxpZXJJZCkgewogICAgICAgICAgICAgICAgdGhpcy5sb2FkVmVuZG9yQmFsYW5jZShzdXBwbGllcklkKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgY2FuY2VsKCkgewogICAgICAgICAgICB0aGlzLiRzd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiBpMThuLnQoIm1zZ190aXRsZV93YXJuaW5nIiksCiAgICAgICAgICAgICAgICB0ZXh0OiBpMThuLnQoIm1zZ19kaXNjYXJkIiksCiAgICAgICAgICAgICAgICBpY29uOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogaTE4bi50KCJjYW5jZWwiKSwKICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiM0ZDQ4NDgiLAogICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjRUQxQTNBIiwKICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBpMThuLnQoImRpc2NhcmQiKSwKICAgICAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLmdvKC0xKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBjdXJyZW5jeShkYXRhSXRlbSkgewogICAgICAgICAgICBpZiAoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgICAgIGlmIChkYXRhSXRlbS5oYXNPd25Qcm9wZXJ0eSgiY3VycmVuY3lDb2RlIikpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YUl0ZW0uY3VycmVuY3lDb2RlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICB9LAogICAgICAgIHJlZmVyZW5jZU5vVG1wKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGlmIChkYXRhSXRlbSkgewogICAgICAgICAgICAgICAgaWYgKGRhdGFJdGVtLmhhc093blByb3BlcnR5KCJyZWZlcmVuY2VObyIpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFJdGVtLnJlZmVyZW5jZU5vOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICB9LAogICAgICAgIGJpbGxOdW1iZXJUbXAoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgaWYgKGRhdGFJdGVtKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaGFzT3duUHJvcGVydHkoImJpbGxOdW1iZXIiKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhSXRlbS5iaWxsTnVtYmVyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICB9LAogICAgICAgIHBhaWRBbW91bnRUbXAoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgaWYgKGRhdGFJdGVtKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaGFzT3duUHJvcGVydHkoInBhaWRBbW91bnQiKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyhkYXRhSXRlbS5wYWlkQW1vdW50LCBkYXRhSXRlbS5kZWNpbWFsRm9ybWF0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgfSwKICAgICAgICBhbW91bnRUb2JlUGFpZChkYXRhSXRlbSkgewogICAgICAgICAgICBpZiAoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgICAgIGlmIChkYXRhSXRlbS5oYXNPd25Qcm9wZXJ0eSgiYW1vdW50VG9iZVBhaWQiKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBrZW5kby50b1N0cmluZygKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YUl0ZW0uYW1vdW50VG9iZVBhaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFJdGVtLmRlY2ltYWxGb3JtYXQKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICB9LAogICAgICAgIGRpc2NvdW50KGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGlmIChkYXRhSXRlbSkgewogICAgICAgICAgICAgICAgaWYgKGRhdGFJdGVtLmhhc093blByb3BlcnR5KCJkaXNjb3VudCIpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzY291bnQgPSBkYXRhSXRlbS5kaXNjb3VudCB8fCAwOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyhkaXNjb3VudCwgZGF0YUl0ZW0uZGVjaW1hbEZvcm1hdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfSwKICAgICAgICBhbW91bnQoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgaWYgKGRhdGFJdGVtKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaGFzT3duUHJvcGVydHkoImFtb3VudCIpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYW1vdW50ID0gZGF0YUl0ZW0uYW1vdW50IHx8IDA7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGtlbmRvLnRvU3RyaW5nKGFtb3VudCwgZGF0YUl0ZW0uZGVjaW1hbEZvcm1hdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfSwKICAgICAgICBiYW5rUmVmZXJlbmNlTm8oZGF0YUl0ZW0pIHsKICAgICAgICAgICAgaWYgKGRhdGFJdGVtKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaGFzT3duUHJvcGVydHkoIm92ZXJEdWUiKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhSXRlbS5iYW5rUmVmZXJlbmNlTm87CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIH0sCiAgICAgICAgb3ZlckR1ZShkYXRhSXRlbSkgewogICAgICAgICAgICBpZiAoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgICAgIGlmIChkYXRhSXRlbS5oYXNPd25Qcm9wZXJ0eSgib3ZlckR1ZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFJdGVtLm92ZXJEdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfSwKICAgICAgICBwYWlkQW1vdW50RWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IGRhdGEtYmluZD0idmFsdWU6JyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgICAgICAua2VuZG9OdW1lcmljVGV4dEJveCh7CiAgICAgICAgICAgICAgICAgICAgZGVjaW1hbHM6IDUsCiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBgbiR7dGhpcy5wdXJjaGFzZUZvcm1Db250ZW50LmRlY2ltYWx9YCwKICAgICAgICAgICAgICAgICAgICBtaW46IDAsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGRpc2NvdW50RWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IGRhdGEtYmluZD0idmFsdWU6JyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgICAgICAua2VuZG9OdW1lcmljVGV4dEJveCh7CiAgICAgICAgICAgICAgICAgICAgZGVjaW1hbHM6IDMwLAogICAgICAgICAgICAgICAgICAgIGZvcm1hdDogYG4ke3RoaXMucHVyY2hhc2VGb3JtQ29udGVudC5kZWNpbWFsfWAsCiAgICAgICAgICAgICAgICAgICAgbWluOiAwLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBvblRyYW5zYWN0aW9uRGF0ZUNoYW5nZWQoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnJlcXVlc3RQYXltZW50LnN1cHBsaWVyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzdXBwbGllciA9IHRoaXMucmVxdWVzdFBheW1lbnQuc3VwcGxpZXIgfHwge307CiAgICAgICAgICAgICAgICBjb25zdCBzdXBJZCA9IHN1cHBsaWVyLmlkIHx8ICIiOwogICAgICAgICAgICAgICAgaWYgKHN1cElkKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZU51bWJlcigpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoUHVyY2hhc2VPcmRlckV4cGVuc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZ2VuZXJhdGVOdW1iZXIoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlID0gbmV3IERhdGUodGhpcy5yZXF1ZXN0UGF5bWVudC50cmFuc2FjdGlvbkRhdGUpOwogICAgICAgICAgICAgICAgY29uc3QgdHJhbkRhdGVSZWNlaXB0ID0gbmV3IERhdGUodGhpcy5yZXF1ZXN0UGF5bWVudC50cmFuc2FjdGlvbkRhdGUpOwogICAgICAgICAgICAgICAgY29uc3QgdHJhbkRhdGVNID0gdHJhbkRhdGUuZ2V0RnVsbFllYXIoKSArIHRyYW5EYXRlLmdldE1vbnRoKCk7CiAgICAgICAgICAgICAgICBjb25zdCB0cmFuRGF0ZVJlY2VpcHRNID0KICAgICAgICAgICAgICAgICAgICB0cmFuRGF0ZVJlY2VpcHQuZ2V0RnVsbFllYXIoKSArIHRyYW5EYXRlUmVjZWlwdC5nZXRNb250aCgpOwogICAgICAgICAgICAgICAgaWYgKHRyYW5EYXRlTSA9PT0gdHJhbkRhdGVSZWNlaXB0TSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdFBheW1lbnQucmVmZXJlbmNlTm8gPSB0aGlzLnJlZmVyZW5jZU5vOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coImFiYnIiLCB0aGlzLnJlcXVlc3RQYXltZW50LnRyYW5zYWN0aW9uVHlwZSk7CiAgICAgICAgICAgIGlmICh0aGlzLnJlcXVlc3RQYXltZW50LnRyYW5zYWN0aW9uRGF0ZSAhPT0gIiIpIHsKICAgICAgICAgICAgICAgIGxldCBkYXRhID0gewogICAgICAgICAgICAgICAgICAgIGFiYnI6IHRoaXMucmVxdWVzdFBheW1lbnQudHJhbnNhY3Rpb25UeXBlLmFiYnIsCiAgICAgICAgICAgICAgICAgICAgc3RydWN0dXJlOiB0aGlzLnJlcXVlc3RQYXltZW50LnRyYW5zYWN0aW9uVHlwZS5zdHJ1Y3R1cmUsCiAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25EYXRlOiBuZXcgRGF0ZSh0aGlzLnJlcXVlc3RQYXltZW50LnRyYW5zYWN0aW9uRGF0ZSkKICAgICAgICAgICAgICAgICAgICAgICAgLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICAgICAgLnN1YnN0cigwLCAxMCksCiAgICAgICAgICAgICAgICAgICAgcHJlZml4U2VwYXJhdG9yOiB0aGlzLnJlcXVlc3RQYXltZW50LnRyYW5zYWN0aW9uVHlwZS5wcmVmaXhTZXBhcmF0b3IgfHwgJycsCiAgICAgICAgICAgICAgICAgICAgbnVtYmVyU2VwYXJhdG9yOiB0aGlzLnJlcXVlc3RQYXltZW50LnRyYW5zYWN0aW9uVHlwZS5udW1iZXJTZXBhcmF0b3IgfHwgJycsCiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiB0aGlzLnJlcXVlc3RQYXltZW50LnRyYW5zYWN0aW9uVHlwZS5mb3JtYXQgfHwgNSwKICAgICAgICAgICAgICAgICAgICBzZXF1Y2VuY2luZzogdGhpcy5yZXF1ZXN0UGF5bWVudC50cmFuc2FjdGlvblR5cGUuc2VxdWNlbmNpbmcsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogVFJBTlNBQ1RJT05fVFlQRSwKICAgICAgICAgICAgICAgICAgICBlbnRpdHk6IDEsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgYmlsbGluZ0hhbmRsZXIKICAgICAgICAgICAgICAgICAgICAubGFzdE51bWJlcihkYXRhKQogICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhc3ROdW1iZXIgPSB0aGlzLnplcm9QYWQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VJbnQocmVzLmxhc3ROdW1iZXIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdFBheW1lbnQudHJhbnNhY3Rpb25UeXBlLmZvcm1hdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG51bWJlciA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnN1ZmZpeCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0UGF5bWVudC50cmFuc2FjdGlvblR5cGUubnVtYmVyU2VwYXJhdG9yICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0TnVtYmVyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0UGF5bWVudC5udW1iZXIgPSBudW1iZXI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0UGF5bWVudC50cmFuc2FjdGlvblR5cGUuaGFzT3duUHJvcGVydHkoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwcmVmaXhTZXBhcmF0b3IiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJlZml4U2VwID0gdGhpcy5yZXF1ZXN0UGF5bWVudC50cmFuc2FjdGlvblR5cGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnByZWZpeFNlcGFyYXRvcjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3RQYXltZW50LnJlZmVyZW5jZU5vID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0UGF5bWVudC50cmFuc2FjdGlvblR5cGUuYWJiciArIHByZWZpeFNlcCArIG51bWJlcjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JzLnB1c2goZSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHplcm9QYWQobnVtLCBwbGFjZXMpIHsKICAgICAgICAgICAgcmV0dXJuIFN0cmluZyhudW0pLnBhZFN0YXJ0KHBsYWNlcywgIjAiKTsKICAgICAgICB9LAogICAgICAgIHJlbW92ZUR1cGxpY2F0ZShhcnJheSkgewogICAgICAgICAgICBjb25zdCByZXN1bHQgPSBbXTsKICAgICAgICAgICAgY29uc3QgbWFwID0gbmV3IE1hcCgpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgYXJyYXkpIHsKICAgICAgICAgICAgICAgIGlmICghbWFwLmhhcyhpdGVtLmlkKSkgewogICAgICAgICAgICAgICAgICAgIG1hcC5zZXQoaXRlbS5pZCwgdHJ1ZSk7IC8vIHNldCBhbnkgdmFsdWUgdG8gTWFwCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goaXRlbSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9LAogICAgICAgIGZvcm1hdERhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgaWYgKGRhdGFJdGVtLmhhc093blByb3BlcnR5KCJkdWVEYXRlIikpIHsKICAgICAgICAgICAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyhuZXcgRGF0ZShkYXRhSXRlbS5kdWVEYXRlKSwgZGF0YUl0ZW0uZGF0ZUZvcm1hdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIH0sCiAgICAgICAgc2V0dGxlbWVudERpc2NvdW50KGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGlmIChkYXRhSXRlbS5oYXNPd25Qcm9wZXJ0eSgicGF5bWVudFRlcm0iKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFJdGVtLnBheW1lbnRUZXJtLm5hbWUgfHwgIiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIH0sCiAgICAgICAgc3RhdHVzKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGlmIChkYXRhSXRlbSkgewogICAgICAgICAgICAgICAgaWYgKGRhdGFJdGVtLmhhc093blByb3BlcnR5KCJzdGF0dXMiKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXR1cyA9IGRhdGFJdGVtLnN0YXR1czsKICAgICAgICAgICAgICAgICAgICBsZXQgc3RhdHVzVGV4dCA9ICIiOwogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoc3RhdHVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c1RleHQgPSAiT1BFTiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dCA9ICJQYXJ0aWFsbHkgUGFpZCI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dCA9ICJWT0lEIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0ID0gIlBBSUQiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdGF0dXNUZXh0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICB9LAogICAgICAgIG9uUGF5bWVudE9wdGlvbkNoYW5nZWQodmFsdWUpIHsKICAgICAgICAgICAgdGhpcy5yZXF1ZXN0UGF5bWVudC5wYXltZW50T3B0aW9uID0gdmFsdWU7CiAgICAgICAgICAgIGNvbnN0IGFjY291bnQgPSB2YWx1ZS5hY2NvdW50IHx8IHt9OwogICAgICAgICAgICBjb25zdCBhY2NvdW50SWQgPSBhY2NvdW50LnV1aWQgfHwgIiI7CiAgICAgICAgICAgIGlmIChhY2NvdW50SWQpIHsKICAgICAgICAgICAgICAgIGxldCBjdXJyZW50RmlzY2FsRGF0ZSA9IEhlbHBlci5nZXRGaXNjYWxEYXRlQnlEYXRlKG5ldyBEYXRlKCkpOwogICAgICAgICAgICAgICAgbGV0IHN0YXJ0RGF0ZSA9IGN1cnJlbnRGaXNjYWxEYXRlLnN0YXJ0X2RhdGU7CiAgICAgICAgICAgICAgICBjb25zdCBzdHJQYXJhbSA9IHsKICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRfZGF0ZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnRvU3RyaW5nKG5ldyBEYXRlKHN0YXJ0RGF0ZSksICJ5eXl5LU1NLWRkIikgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlQwMDowMDowMC4wMDBaIiwKICAgICAgICAgICAgICAgICAgICAgICAgZW5kX2RhdGU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZW5kby50b1N0cmluZygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgRGF0ZSh0aGlzLnJlcXVlc3RQYXltZW50LnRyYW5zYWN0aW9uRGF0ZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInl5eXktTU0tZGQiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApICsgIlQyMzo1OTo1OS45OTlaIiwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHRoaXMubG9hZEVudHJ5RGV0YWlsQnlBY2NvdW50KGFjY291bnRJZCwgc3RyUGFyYW0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyh2YWx1ZSwgInBheW1lbnRPcHRpb24iKTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRQcmVmaXgoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIHByZWZpeEhhbmRsZXIuZ2V0KFRYTl9UWVBFKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvblR5cGVzID0gcmVzcG9uc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdFBheW1lbnQudHJhbnNhY3Rpb25UeXBlID0gcmVzcG9uc2VbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLiRyb3V0ZS5wYXJhbXMuaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZU51bWJlcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIHNlYXJjaFB1cmNoYXNlT3JkZXJFeHBlbnNlKCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IHt9OwogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN1cHBsaWVyID0gdGhpcy5yZXF1ZXN0UGF5bWVudC5zdXBwbGllciB8fCB7fTsKICAgICAgICAgICAgICAgICAgICBkYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2g6IHN1cHBsaWVyLmlkIHx8ICIiLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiVmVuZG9yIiwKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25EYXRlOiBuZXcgRGF0ZSh0aGlzLnJlcXVlc3RQYXltZW50LnRyYW5zYWN0aW9uRGF0ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50b0lTT1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3Vic3RyKDAsIDEwKSwKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbUxpbmVzID0gW107CiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc2VhcmNoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnNlYXJjaC5sZW5ndGggPiA0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmlsbGluZ0hhbmRsZXIuc2VhcmNoQ2FzaFBheW1lbnQoZGF0YSkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gcmVzLmRhdGEucmVzdWx0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1MaW5lcyA9IHJlc3BvbnNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iaiA9IHJlc3BvbnNlWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoInN1cHBsaWVyIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0UGF5bWVudC5zdXBwbGllciA9IG9iai5zdXBwbGllcjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5zdXBwbGllci5oYXNPd25Qcm9wZXJ0eSgibmFtZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5hbWUgPSBvYmouc3VwcGxpZXIubmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhc2VDdXJyZW5jeSA9IHJlc3VsdDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYmFzZUN1cnJlbmN5ID0gYmFzZUN1cnJlbmN5OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0UGF5bWVudC5jdXJyZW5jeSA9IG5ldyBDdXJyZW5jeU1vZGVsKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhc2VDdXJyZW5jeQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiYXNlQ3VycmVuY3kpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmFzZUN1cnJlbmN5Lmhhc093blByb3BlcnR5KCJjb2RlIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5iYXNlQ3VycmVuY3lDb2RlID0gYmFzZUN1cnJlbmN5LmNvZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIChjb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICB0aGlzLmxvYWRUcmFuc2FjdGlvblJhdGUoYmFzZUN1cnJlbmN5LmNvZGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIG9uR3JpZFJlcXVlc3RDaGFuZ2UoKSB7CiAgICAgICAgICAgIGNvbnN0IGdyaWQgPSB0aGlzLiRyZWZzLmdyaWRSZXF1ZXN0UGF5bWVudC5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICB0aGlzLnNlbGVjdGVkRXhwZW5zZUlkcyA9IGdyaWQuc2VsZWN0ZWRLZXlOYW1lcygpOwogICAgICAgICAgICAvLyBsZXQgZHMgPSB0aGlzLiRyZWZzLml0ZW1MaW5lRFMua2VuZG9XaWRnZXQoKQogICAgICAgICAgICAvLyB0aGlzLmlzQ2hlY2tDaGFuZ2VkID0gdHJ1ZQogICAgICAgICAgICAvLyBjb25zdCByb3dzID0gZHMuZGF0YSgpOwogICAgICAgICAgICAvLyByb3dzLmZvckVhY2goKHZhbHVlKSA9PiB7CiAgICAgICAgICAgIC8vICAgICBpZiAofnRoaXMuc2VsZWN0ZWRFeHBlbnNlSWRzLmluZGV4T2YodmFsdWUubGluZUlkKSkgewogICAgICAgICAgICAvLyAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyh2YWx1ZSwgJ3ZhbHVlJykKICAgICAgICAgICAgLy8gICAgICAgICBpZiAodmFsdWUucGFpZEFtb3VudCA9PT0gMCkgewogICAgICAgICAgICAvLyAgICAgICAgICAgICBjb25zdCB0b2JlUGFpZCA9IHZhbHVlLmFtb3VudFRvYmVQYWlkIHx8IDAKICAgICAgICAgICAgLy8gICAgICAgICAgICAgdmFsdWUuc2V0KCdwYWlkQW1vdW50JywgdG9iZVBhaWQpCiAgICAgICAgICAgIC8vICAgICAgICAgfQogICAgICAgICAgICAvLyAgICAgfQogICAgICAgICAgICAvLyB9KQogICAgICAgICAgICAvLyB0aGlzLiRyZWZzLmdyaWRSZXF1ZXN0UGF5bWVudC5rZW5kb1dpZGdldCgpLnJlYWQoKQogICAgICAgICAgICAvLyB0aGlzLmlzQ2hlY2tDaGFuZ2VkID0gZmFsc2UKICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlKCk7CiAgICAgICAgfSwKICAgICAgICBvbkRhdGFTb3VyY2VDaGFuZ2UoZSkgewogICAgICAgICAgICBsZXQgYW10VG9iZVBhaWQgPSAwLAogICAgICAgICAgICAgICAgYW1vdW50ID0gMCwKICAgICAgICAgICAgICAgIGRpc2NvdW50ID0gMCwKICAgICAgICAgICAgICAgIHBhaWRBbW91bnQgPSAwOwogICAgICAgICAgICBsZXQgZGF0YVJvdyA9IGUuaXRlbXNbMF0gfHwge307CiAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhkYXRhUm93KS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgib3B0aW9uVHlwZSIsIE9QVElPTl9UWVBFKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgbGV0IGRhdGFSb3cgPSBlLml0ZW1zWzBdOwogICAgICAgICAgICAgICAgc3dpdGNoIChlLmZpZWxkKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZGlzY291bnQiOgogICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQgPSBkYXRhUm93LmFtb3VudCB8fCAwOwogICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudCA9IGRhdGFSb3cuZGlzY291bnQgfHwgMDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpc2NvdW50ID4gYW1vdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiZGlzY291bnQiLCBhbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImFtb3VudFRvYmVQYWlkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQoZGF0YVJvdy5hbW91bnQpIC0gcGFyc2VGbG9hdChkYXRhUm93LmRpc2NvdW50IHx8IDApCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImV4Y2hhbmdlRGlzY291bnQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VGbG9hdChkYXRhUm93LmRpc2NvdW50KSAqIHBhcnNlRmxvYXQoZGF0YVJvdy5yYXRlVG9iYXNlIHx8IDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImV4Y2hhbmdlRGlzY291bnRUeG4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VGbG9hdChkYXRhUm93LmRpc2NvdW50KSAqIHBhcnNlRmxvYXQoZGF0YVJvdy50eG5SYXRlIHx8IDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFtdFRvYmVQYWlkID0gcGFyc2VGbG9hdChkYXRhUm93LmFtb3VudFRvYmVQYWlkIHx8IDApOwogICAgICAgICAgICAgICAgICAgICAgICBwYWlkQW1vdW50ID0gcGFyc2VGbG9hdChkYXRhUm93LnBhaWRBbW91bnQgfHwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYWlkQW1vdW50ID4gYW10VG9iZVBhaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhaWRBbW91bnQgPSBhbXRUb2JlUGFpZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJwYWlkQW1vdW50IiwgcGFyc2VGbG9hdChwYWlkQW1vdW50KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGFpZEFtb3VudFRvYmFzZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VGbG9hdChwYWlkQW1vdW50KSAqIHBhcnNlRmxvYXQoZGF0YVJvdy5yYXRlVG9iYXNlIHx8IDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInBhaWRBbW91bnRUeG4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhaWRBbW91bnQgKiBwYXJzZUZsb2F0KGRhdGFSb3cudHhuUmF0ZSB8fCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJwYWlkQW1vdW50IjoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgKHRoaXMuaXNDaGVja0NoYW5nZWQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFtdFRvYmVQYWlkID0gcGFyc2VGbG9hdChkYXRhUm93LmFtb3VudFRvYmVQYWlkIHx8IDApOwogICAgICAgICAgICAgICAgICAgICAgICBwYWlkQW1vdW50ID0gcGFyc2VGbG9hdChkYXRhUm93LnBhaWRBbW91bnQgfHwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYWlkQW1vdW50ID4gYW10VG9iZVBhaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhaWRBbW91bnQgPSBhbXRUb2JlUGFpZDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgicGFpZEFtb3VudCIsIHBhcnNlRmxvYXQocGFpZEFtb3VudCkpOwogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwYWlkQW1vdW50VG9iYXNlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQocGFpZEFtb3VudCkgKiBwYXJzZUZsb2F0KGRhdGFSb3cucmF0ZVRvYmFzZSB8fCAxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwYWlkQW1vdW50VHhuIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhaWRBbW91bnQgKiBwYXJzZUZsb2F0KGRhdGFSb3cudHhuUmF0ZSB8fCAxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2VUeG4oKTsKICAgICAgICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkU2FsZUZvcm1Db250ZW50KCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBwdXJjaGFzZUZvcm1Db250ZW50SGFuZGxlci5saXN0KCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2VGb3JtQ29udGVudCA9IGRhdGFbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkVmVuZG9yQmFsYW5jZShpZCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJGaWx0ZXIgPSBpZCArICI/dHlwZT1iYWwiOwogICAgICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdFBheW1lbnQudmVuZG9yQmFsYW5jZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgYmlsbGluZ0hhbmRsZXIuYmFsYW5jZShzdHJGaWx0ZXIpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3RQYXltZW50LnZlbmRvckJhbGFuY2UgPSBkYXRhWzBdLmJhbGFuY2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5iYWxhbmNlID0gdGhpcy5udW1iZXJGb3JtYXQoZGF0YVswXS5iYWxhbmNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIG51bWJlckZvcm1hdCh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcodmFsdWUsIGBuJHt0aGlzLnB1cmNoYXNlRm9ybUNvbnRlbnQuZGVjaW1hbH1gKTsKICAgICAgICB9LAogICAgICAgIGF1dG9DYWxjdWxhdGUoKSB7CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuaXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpLAogICAgICAgICAgICAgICAgcmVjZWlwdEFtb3VudCA9IDAsCiAgICAgICAgICAgICAgICBkaXNjb3VudCA9IDAsCiAgICAgICAgICAgICAgICBjb252ZXJ0ZWRBbW91bnQgPSAwLAogICAgICAgICAgICAgICAgZXhjaGFuZ2VEaXNjb3VudCA9IDAsCiAgICAgICAgICAgICAgICBleGNoYW5nZURpc2NvdW50VHhuID0gMCwKICAgICAgICAgICAgICAgIHBhaWRBbW91bnRUeG4gPSAwOwogICAgICAgICAgICB0aGlzLmpSYXcgPSBbXTsKICAgICAgICAgICAgY29uc3Qgcm93cyA9IGRzLmRhdGEoKS5maWx0ZXIoKG4pID0+IG4ucGFpZEFtb3VudCA+IDAgfHwgbi5kaXNjb3VudCA+IDApOwogICAgICAgICAgICByb3dzLmZvckVhY2goKHZhbHVlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAofnRoaXMuc2VsZWN0ZWRFeHBlbnNlSWRzLmluZGV4T2YodmFsdWUubGluZUlkKSkgewogICAgICAgICAgICAgICAgICAgIGxldCBuYXR1cmUgPSAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgcHVyY2hhc2VSYXRlID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudFJhdGUgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICByYXdQYWlkQW1vdW50ID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgcmF3RGlzY291bnRBbW91bnQgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUNvZGUgPSAiIjsKICAgICAgICAgICAgICAgICAgICBsZXQgZGlzY291bnRBbW91bnQgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBhcEFtb3VudCA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZk5vID0gIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHBheU9wdGlvbiA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeSA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBnYWluTG9zcyA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RYUmF0ZSA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbiA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50ID0ge30sCiAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3QgPSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25JZCA9ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50SWQgPSAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdElkID0gIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHR4bklkID0gIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGludlJhdGUgPSAxOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5yZWZlcmVuY2VObykgewogICAgICAgICAgICAgICAgICAgICAgICByZWZObyA9IHZhbHVlLnJlZmVyZW5jZU5vOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHhuSWQgPSB2YWx1ZS5pZCB8fCAiIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnR4blJhdGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHVyY2hhc2VSYXRlID0gcGFyc2VGbG9hdCh2YWx1ZS50eG5SYXRlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmN1cnJlbmN5Q29kZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUNvZGUgPSB2YWx1ZS5jdXJyZW5jeUNvZGUgfHwgIiI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5jdXJyZW5jeSkgewogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeSA9IHZhbHVlLmN1cnJlbmN5IHx8IHt9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUubG9jYXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24gPSB2YWx1ZS5sb2NhdGlvbiB8fCB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvY2F0aW9uLmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbklkID0gbG9jYXRpb24uaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnNlZ21lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudCA9IHZhbHVlLnNlZ21lbnQgfHwge307CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWdtZW50Lmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50SWQgPSBzZWdtZW50LmlkOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5wcm9qZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3QgPSB2YWx1ZS5wcm9qZWN0IHx8IHt9OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvamVjdC5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdElkID0gcHJvamVjdC5pZDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuZXhjaGFuZ2VSYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RYUmF0ZSA9IHZhbHVlLmV4Y2hhbmdlUmF0ZSB8fCB7fTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnR4blJhdGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaW52UmF0ZSA9IHBhcnNlRmxvYXQodmFsdWUudHhuUmF0ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5yYXRlVG9iYXNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBheW1lbnRSYXRlID0gcGFyc2VGbG9hdCh2YWx1ZS5yYXRlVG9iYXNlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnBhaWRBbW91bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWlwdEFtb3VudCArPSBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnBhaWRBbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJ0ZWRBbW91bnQgKz0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucGFpZEFtb3VudCkgKiB2YWx1ZS5yYXRlVG9iYXNlOwogICAgICAgICAgICAgICAgICAgICAgICBwYWlkQW1vdW50VHhuICs9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucGFpZEFtb3VudCkgKiBpbnZSYXRlOwogICAgICAgICAgICAgICAgICAgICAgICAvLyBwYWlkQW10ID0ga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5wYWlkQW1vdW50KSAqIHB1cmNoYXNlUmF0ZQogICAgICAgICAgICAgICAgICAgICAgICByYXdQYWlkQW1vdW50ID0ga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5wYWlkQW1vdW50KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmRpc2NvdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRpc2NvdW50ICs9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuZGlzY291bnQpCiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50ICs9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuZGlzY291bnQpICogdmFsdWUucmF0ZVRvYmFzZTsKICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VEaXNjb3VudCArPQogICAgICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5leGNoYW5nZURpc2NvdW50KSAqIHZhbHVlLnJhdGVUb2Jhc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlRGlzY291bnRUeG4gKz0ga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5kaXNjb3VudCkgKiBpbnZSYXRlOwogICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudEFtb3VudCA9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuZGlzY291bnQpICogcGF5bWVudFJhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgIHJhd0Rpc2NvdW50QW1vdW50ID0ga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5kaXNjb3VudCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIHRvZG86IGdhaW4gb3IgbG9zcyBleGNoYW5nZSByYXRlCiAgICAgICAgICAgICAgICAgICAgZ2Fpbkxvc3MgPQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUZsb2F0KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKHB1cmNoYXNlUmF0ZSAtIHBheW1lbnRSYXRlKSAqIChyYXdQYWlkQW1vdW50ICsgcmF3RGlzY291bnRBbW91bnQpCiAgICAgICAgICAgICAgICAgICAgICAgICkgKiAtMTsKICAgICAgICAgICAgICAgICAgICBpZiAoZ2Fpbkxvc3MgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdhaW5Mb3NzID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF0dXJlID0gImRyIjsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdHVyZSA9ICJjciI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCJnYWluTG9zcyIsIGdhaW5Mb3NzKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdhaW5Mb3NzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5nYWluTG9zc0FjYy5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMualJhdy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdhaW5Mb3NzQWNjLmlkICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5Q29kZSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVyY2hhc2VSYXRlICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbklkICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0SWQgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnRJZCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHhuSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4bklkOiB0eG5JZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdDogcHJvamVjdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IGxvY2F0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50OiBzZWdtZW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0SWQ6IHByb2plY3RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25JZDogbG9jYXRpb25JZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudElkOiBzZWdtZW50SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5Q29kZTogY3VycmVuY3lDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RYUmF0ZTogbGFzdFhSYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBuZXcgSXRlbUxpbmVNb2RlbCh2YWx1ZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpcHRSYXRlOiBnYWluTG9zcyA+IDAgPyBwYXltZW50UmF0ZSA6IHB1cmNoYXNlUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuZ2Fpbk9yTG9zc0Rlc2NyaXB0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiB0aGlzLmdhaW5Mb3NzQWNjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IHRoaXMuZ2Fpbkxvc3NBY2MuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQ6IGdhaW5Mb3NzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVBczogIkdhaW5Pckxvc3MiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vVG9kbzogQVAgIERyCiAgICAgICAgICAgICAgICAgICAgYXBBbW91bnQgPSByYXdQYWlkQW1vdW50ICsgcmF3RGlzY291bnRBbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFwQW1vdW50ID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAiZHIiOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hdHVyZSA9ICJjciI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5oYXNPd25Qcm9wZXJ0eSgiYXBBY2MiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhcEFjYyA9IHZhbHVlLmFwQWNjOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXBBY2MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcEFjYy5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMualJhdy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcEFjYy5pZCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF0dXJlICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUNvZGUgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1cmNoYXNlUmF0ZSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25JZCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdElkICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50SWQgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4bklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eG5JZDogdHhuSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3Q6IHByb2plY3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBsb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudDogc2VnbWVudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdElkOiBwcm9qZWN0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uSWQ6IGxvY2F0aW9uSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnRJZDogc2VnbWVudElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUNvZGU6IGN1cnJlbmN5Q29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k6IGN1cnJlbmN5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0WFJhdGU6IGxhc3RYUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogbmV3IEl0ZW1MaW5lTW9kZWwodmFsdWUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNlaXB0UmF0ZTogcHVyY2hhc2VSYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogcmVmTm8sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IGFwQWNjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IGFwQWNjLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IGFwQW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogYXBBbW91bnQgKiBwdXJjaGFzZVJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZUFzOiAiQVAiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vVG9kbzogQ2FzaCBBY2NvdW50ICBDUgogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlcXVlc3RQYXltZW50LnBheW1lbnRPcHRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGF5T3B0aW9uID0gdGhpcy5yZXF1ZXN0UGF5bWVudC5wYXltZW50T3B0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjYXNoQW1vdW50ID0gcmF3UGFpZEFtb3VudCAqIC0xOyAvLysgKChwdXJjaGFzZVJhdGUgLSBwYXltZW50UmF0ZSkgKiAocmF3UGFpZEFtb3VudCArIHJhd0Rpc2NvdW50QW1vdW50KSkKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc3QgY2FzaEFtb3VudCA9IHJhd1BhaWRBbW91bnQgKyAoZ2Fpbkxvc3MgKSArIHJhd1BhaWRBbW91bnQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhc2hBbW91bnQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXR1cmUgPSAiZHIiOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF0dXJlID0gImNyIjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGF5T3B0aW9uLmhhc093blByb3BlcnR5KCJhY2NvdW50IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBheU9wdGlvbkFjYyA9IHBheU9wdGlvbi5hY2NvdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBheU9wdGlvbkFjYy5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMualJhdy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXlPcHRpb25BY2MuaWQgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdHVyZSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXJjaGFzZVJhdGUgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uSWQgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3RJZCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudElkICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eG5JZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHhuSWQ6IHR4bklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0OiBwcm9qZWN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogbG9jYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnQ6IHNlZ21lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3RJZDogcHJvamVjdElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbklkOiBsb2NhdGlvbklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50SWQ6IHNlZ21lbnRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlOiBjdXJyZW5jeUNvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiBjdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFhSYXRlOiBsYXN0WFJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IG5ldyBJdGVtTGluZU1vZGVsKHZhbHVlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWlwdFJhdGU6IHB1cmNoYXNlUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHJlZk5vLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiBwYXlPcHRpb25BY2MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRJZDogcGF5T3B0aW9uQWNjLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IGNhc2hBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OiBjYXNoQW1vdW50ICogcGF5bWVudFJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZUFzOiAiQ2FzaEFjY291bnQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vVG9kbzogU2V0dGxlbWVudCBEaXNjb3VudCAgQ3IKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUucGF5bWVudFRlcm0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2V0dGxlbWVudERpc2MgPSB2YWx1ZS5wYXltZW50VGVybTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpc2NvdW50QW1vdW50ID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpc2NvdW50QW1vdW50ICogLTEgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF0dXJlID0gImRyIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF0dXJlID0gImNyIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyhzZXR0bGVtZW50RGlzYywgInNldHRsZW1lbnREaXNjIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2V0dGxlbWVudERpc2MuaGFzT3duUHJvcGVydHkoImFjY291bnQiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNldHRsZW1lbnREaXNjQWNjID0gc2V0dGxlbWVudERpc2MuYWNjb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2V0dGxlbWVudERpc2NBY2MuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5qUmF3LnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGxlbWVudERpc2NBY2MuaWQgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF0dXJlICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5Q29kZSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXJjaGFzZVJhdGUgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25JZCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0SWQgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudElkICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4bklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHhuSWQ6IHR4bklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdDogcHJvamVjdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBsb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnQ6IHNlZ21lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0SWQ6IHByb2plY3RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uSWQ6IGxvY2F0aW9uSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50SWQ6IHNlZ21lbnRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5Q29kZTogY3VycmVuY3lDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k6IGN1cnJlbmN5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFhSYXRlOiBsYXN0WFJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBuZXcgSXRlbUxpbmVNb2RlbCh2YWx1ZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNlaXB0UmF0ZTogcGF5bWVudFJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogIlB1cmNoYXNlIFBheW1lbnQgRGlzY291bnQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogc2V0dGxlbWVudERpc2NBY2MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IHNldHRsZW1lbnREaXNjQWNjLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiByYXdEaXNjb3VudEFtb3VudCAqIC0xLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQ6IGRpc2NvdW50QW1vdW50ICogLTEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlQXM6ICJTZXR0bGVtZW50IERpc2NvdW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgLy8gdGhpcy5pbnZvaWNlVHhuKHR4bklkcykKCiAgICAgICAgICAgIHRoaXMucmVxdWVzdFBheW1lbnQudG90YWwgPSByZWNlaXB0QW1vdW50OwogICAgICAgICAgICB0aGlzLnJlcXVlc3RQYXltZW50LmV4Y2hhbmdlQW1vdW50ID0gY29udmVydGVkQW1vdW50OwogICAgICAgICAgICB0aGlzLnJlcXVlc3RQYXltZW50LmRpc2NvdW50ID0gZGlzY291bnQ7CiAgICAgICAgICAgIHRoaXMucmVxdWVzdFBheW1lbnQuZXhjaGFuZ2VEaXNjb3VudCA9IGV4Y2hhbmdlRGlzY291bnQ7CiAgICAgICAgICAgIHRoaXMucmVxdWVzdFBheW1lbnQucGFpZEFtb3VudFR4biA9IHBhaWRBbW91bnRUeG47CiAgICAgICAgICAgIHRoaXMucmVxdWVzdFBheW1lbnQuZXhjaGFuZ2VEaXNjb3VudFR4biA9IGV4Y2hhbmdlRGlzY291bnRUeG47CiAgICAgICAgICAgIHRoaXMucmVxdWVzdFBheW1lbnQuZnVuZFJlbWFpbkJhbGFuY2UgPQogICAgICAgICAgICAgICAgcGFyc2VGbG9hdCh0aGlzLnJlcXVlc3RQYXltZW50LmZ1bmRCYWxhbmNlIHx8IDApIC0KICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQoY29udmVydGVkQW1vdW50KTsKICAgICAgICAgICAgdGhpcy5yZXF1ZXN0UGF5bWVudC52ZW5kb3JSZW1haW5pbmdCYWxhbmNlID0KICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQodGhpcy5yZXF1ZXN0UGF5bWVudC52ZW5kb3JCYWxhbmNlIHx8IDApIC0KICAgICAgICAgICAgICAgIChwYXJzZUZsb2F0KGNvbnZlcnRlZEFtb3VudCkgKyBkaXNjb3VudCk7CgogICAgICAgICAgICB0aGlzLnZlbmRvclJlbWFpbmluZ0JhbGFuY2UgPSB0aGlzLm51bWJlckZvcm1hdCgKICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQodGhpcy5yZXF1ZXN0UGF5bWVudC52ZW5kb3JCYWxhbmNlIHx8IDApIC0KICAgICAgICAgICAgICAgIChwYXJzZUZsb2F0KGNvbnZlcnRlZEFtb3VudCkgKyBkaXNjb3VudCkKICAgICAgICAgICAgKTsKICAgICAgICAgICAgdGhpcy5mdW5kUmVtYWluQmFsYW5jZSA9IHRoaXMubnVtYmVyRm9ybWF0KAogICAgICAgICAgICAgICAgcGFyc2VGbG9hdCh0aGlzLnJlcXVlc3RQYXltZW50LmZ1bmRCYWxhbmNlIHx8IDApIC0KICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQoY29udmVydGVkQW1vdW50KQogICAgICAgICAgICApOwogICAgICAgICAgICB0aGlzLnNocmlua0RhdGEodGhpcy5qUmF3KTsKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCJhYSIsIHJvd3MpOwogICAgICAgIH0sCiAgICAgICAgc2hyaW5rRGF0YShvYmopIHsKICAgICAgICAgICAgY29uc3QgdW5pcXVlcyA9IHRoaXMucmVtb3ZlRHVwbGljYXRlKG9iaik7CiAgICAgICAgICAgIHVuaXF1ZXMuZm9yRWFjaCgobikgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZm91bmQgPSBvYmouZmlsdGVyKChtKSA9PiBtLmlkID09PSBuLmlkKTsKICAgICAgICAgICAgICAgIGxldCBhbW91bnQgPSAwLAogICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50ID0gMDsKICAgICAgICAgICAgICAgIGZvdW5kLmZvckVhY2goKHopID0+IHsKICAgICAgICAgICAgICAgICAgICBhbW91bnQgKz0gcGFyc2VGbG9hdCh6LmFtb3VudCB8fCAwKTsKICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudCArPSBwYXJzZUZsb2F0KHouZXhjaGFuZ2VBbW91bnQgfHwgMCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIG4uZXhjaGFuZ2VBbW91bnQgPSBwYXJzZUZsb2F0KGV4Y2hhbmdlQW1vdW50KTsgLy90aGlzLm51bWJlckZvcm1hdChhbW91bnQpCiAgICAgICAgICAgICAgICBuLmFtb3VudCA9IHBhcnNlRmxvYXQoYW1vdW50KTsgLy9wYXJzZUZsb2F0KHBhcnNlRmxvYXQoYW1vdW50IC8gcGFyc2VGbG9hdChuLnJlY2VpcHRSYXRlKSkpIC8vdGhpcy5udW1iZXJGb3JtYXQoYW1vdW50ICogcGFyc2VGbG9hdCh0aGlzLmludm9pY2UudHhuUmF0ZSkpIC8vLnRvRml4ZWQodGhpcy5zYWxlRm9ybUNvbnRlbnQuZGVjaW1hbCkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMualJhdyA9IHVuaXF1ZXM7CiAgICAgICAgICAgIGxldCBkciA9IDAsCiAgICAgICAgICAgICAgICBjciA9IDA7CiAgICAgICAgICAgIHRoaXMualJhdy5mb3JFYWNoKChqKSA9PiB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKGoudHlwZSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgImNyIjoKICAgICAgICAgICAgICAgICAgICAgICAgY3IgKz0gcGFyc2VGbG9hdChqLmV4Y2hhbmdlQW1vdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZHIiOgogICAgICAgICAgICAgICAgICAgICAgICBkciArPSBwYXJzZUZsb2F0KGouZXhjaGFuZ2VBbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeSh0aGlzLmpSYXcpLCAndW5pcXVlcycpCiAgICAgICAgICAgIGNvbnN0IHR4bklkID0gdGhpcy5qUmF3Lm1hcCgobykgPT4gby50eG5JZCk7CiAgICAgICAgICAgIGNvbnN0IHVTZXQgPSBuZXcgU2V0KHR4bklkKTsKICAgICAgICAgICAgY29uc3QgdW5pcXVlU2V0ID0gWy4uLnVTZXRdOwogICAgICAgICAgICBsZXQgalJhd3MgPSBbXTsKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHVuaXF1ZVNldCksICd1bmlxdWVzJykKICAgICAgICAgICAgdW5pcXVlU2V0LmZvckVhY2goKG4pID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGZvdW5kID0gdGhpcy5qUmF3LmZpbHRlcigobSkgPT4gbS50eG5JZCA9PT0gbik7CiAgICAgICAgICAgICAgICBjb25zdCBsaW5lID0gZm91bmRbMF0ubGluZTsKICAgICAgICAgICAgICAgIGNvbnN0IHJlZk5vID0gbGluZS5yZWZlcmVuY2VObzsKICAgICAgICAgICAgICAgIGpSYXdzLnB1c2goewogICAgICAgICAgICAgICAgICAgIGlkOiBuLAogICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5Q29kZTogZm91bmRbMF0uY3VycmVuY3lDb2RlLAogICAgICAgICAgICAgICAgICAgIHByb2plY3RJZDogZm91bmRbMF0ucHJvamVjdElkLAogICAgICAgICAgICAgICAgICAgIHNlZ21lbnRJZDogZm91bmRbMF0uc2VnbWVudElkLAogICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uSWQ6IGZvdW5kWzBdLmxvY2F0aW9uSWQsCiAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlTm86IHJlZk5vIHx8ICIiLAogICAgICAgICAgICAgICAgICAgIGVudHJpZXM6IGZvdW5kLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmpSYXcgPSBqUmF3czsKICAgICAgICAgICAgdGhpcy5kciA9IGRyOwogICAgICAgICAgICB0aGlzLmNyID0gY3I7CiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygiZHI9IiwgZHIsICJjcj0iLCBjciwgImRyK2NyID0gIiwgZHIgKyBjcik7CiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhqUmF3cywgInVuaXF1ZXMiKTsKICAgICAgICB9LAogICAgICAgIHB1cmNoYXNlVHhuKCkgewogICAgICAgICAgICBsZXQgdHhuSWRzID0gW10sCiAgICAgICAgICAgICAgICBpZHMgPSBbXTsKICAgICAgICAgICAgdGhpcy5pdGVtTGluZXMuZm9yRWFjaCgodmFsdWUpID0+IHsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5pZCkgewogICAgICAgICAgICAgICAgICAgIHR4bklkcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHZhbHVlLmlkLAogICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IDEsCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZHMgPSBPYmplY3QudmFsdWVzKHR4bklkcy5yZWR1Y2UoKHIsIG8pID0+ICgocltvLmlkXSA9IG8pLCByKSwge30pKTsKICAgICAgICAgICAgaWRzLmZvckVhY2goKG0pID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGxpbmVzID0gdGhpcy5pdGVtTGluZXMuZmlsdGVyKChuKSA9PiBuLmlkID09PSBtLmlkKTsKICAgICAgICAgICAgICAgIGxldCBwYWlkQW10ID0gMDsKICAgICAgICAgICAgICAgIGxldCBhbW91bnRUb2JlUGFpZCA9IDA7CiAgICAgICAgICAgICAgICBsaW5lcy5mb3JFYWNoKCh4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHgucGFpZEFtb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICBwYWlkQW10ICs9IHgucGFpZEFtb3VudDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHguYW1vdW50VG9iZVBhaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50VG9iZVBhaWQgKz0geC5hbW91bnRUb2JlUGFpZDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGNvbnN0IHBBbXQgPSB0aGlzLm51bWJlckZvcm1hdChwYWlkQW10KTsKICAgICAgICAgICAgICAgIGNvbnN0IGFtdFRvYmVQYWlkID0gdGhpcy5udW1iZXJGb3JtYXQoYW1vdW50VG9iZVBhaWQpOwogICAgICAgICAgICAgICAgaWYgKHBBbXQgPT09IGFtdFRvYmVQYWlkKSB7CiAgICAgICAgICAgICAgICAgICAgbVsic3RhdHVzIl0gPSAzOyAvL1BhaWQKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbVsic3RhdHVzIl0gPSAyOyAvLyBQYXJ0aWFsbHkgUGFpZAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy50eG5MaXN0ID0gaWRzOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZE90aGVyQWNjb3VudCgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ0hhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgLmdldE90aGVyQWNjb3VudCgpCiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSByZXNwb25zZS5maWx0ZXIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChvKSA9PiBvLmJhbmhqaUFjY0NvZGUgPT09ICI3NDAwMTAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2Fpbkxvc3NBY2MgPSBkYXRhWzBdLmFjY291bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFfID0gcmVzcG9uc2UuZmlsdGVyKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobykgPT4gby5iYW5oamlBY2NDb2RlID09PSAiNzQwMDQwIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFfLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vdGhlclJldmVudWVBY2MgPSBkYXRhX1swXS5hY2NvdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKCk7CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIG9uU2F2ZUNsb3NlKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuJHJlZnMuZm9ybS52YWxpZGF0ZSgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRyZWZzLmZvcm0udmFsaWRhdGUoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBsZXQgaXRlbUxpbmVEUyA9IHRoaXMuJHJlZnMuaXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICAgICAgICAgIGxldCBpdGVtTGluZXMgPSBbXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdXBwbGllciA9IHRoaXMucmVxdWVzdFBheW1lbnQuc3VwcGxpZXIgfHwge307CiAgICAgICAgICAgICAgICAgICAgaXRlbUxpbmVEUwogICAgICAgICAgICAgICAgICAgICAgICAuZGF0YSgpCiAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoKG4pID0+IG4ucGFpZEFtb3VudCA+IDAgfHwgbi5kaXNjb3VudCA+IDApCiAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKG4pID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh+dGhpcy5zZWxlY3RlZEV4cGVuc2VJZHMuaW5kZXhPZihuLmxpbmVJZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW5jeSA9IG4uY3VycmVuY3kgfHwge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgblsicGF5bWVudE9wdGlvbiJdID0gbmV3IFBheW1lbnRPcHRpb25Nb2RlbCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbi5wYXltZW50T3B0aW9uIHx8IHt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuWyJwYXltZW50VGVybSJdID0gbmV3IFBheW1lbnRUZXJtTW9kZWwobi5wYXltZW50VGVybSB8fCB7fSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgblsiY3VycmVuY3kiXSA9IG5ldyBDdXJyZW5jeU1vZGVsKG4uY3VycmVuY3kgfHwge30pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5bImN1cnJlbmN5Q29kZSJdID0gY3VycmVuY3kuY29kZSB8fCAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuWyJhcEFjYyJdID0gbmV3IEFjY291bnRNYXBwaW5nTW9kZWwobi5hcEFjYyB8fCB7fSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgblsic3VwcGxpZXIiXSA9IG5ldyBTdXBwbGllck1vZGVsKHN1cHBsaWVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuWyJpZCJdID0gblsidHhuSWQiXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtTGluZXMucHVzaChuZXcgSXRlbUxpbmVNb2RlbChuKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGlmIChpdGVtTGluZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgaXNBdXRvR2VuZXJhdGUgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAvL3RvZG86IG1hdGNoIFJlcXVlc3QgUGF5bWVudCBtb2RlbAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3RQYXltZW50WyJpdGVtTGluZXMiXSA9IGl0ZW1MaW5lczsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0UGF5bWVudFsidHlwZSJdID0gVFJBTlNBQ1RJT05fVFlQRTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0UGF5bWVudFsiaXNBdXRvR2VuZXJhdGUiXSA9IGlzQXV0b0dlbmVyYXRlOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3RQYXltZW50WyJhY3Rpb25UeXBlIl0gPSB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gdGhpcy4kcm91dGUucXVlcnkudHlwZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAibmV3IjsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0UGF5bWVudFsibG9nZ2VkVXNlciJdID0gdGhpcy5sb2dnZWRVc2VyOwoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZygndGhpcy5pdGVtTGluZXMnLCBpdGVtTGluZXMpCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZygndGhpcy5pdGVtTGluZXMnLCBKU09OLnN0cmluZ2lmeShpdGVtTGluZXMpKQogICAgICAgICAgICAgICAgICAgICAgICBiaWxsaW5nSGFuZGxlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNyZWF0ZVJlcXVlc3RQYXltZW50KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBSZXF1ZXN0UGF5bWVudE1vZGVsKHRoaXMucmVxdWVzdFBheW1lbnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXNDb2RlID09PSAyMDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5jbG9zZShyZXNwb25zZS5kYXRhLmRhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5zdWNjZXNzKCJTdWNjZXNzZnVsbHkiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5nbygtMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LmVycm9yKCJTb21ldGhpbmcgd2VudCB3cm9uZyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JzLnB1c2goZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAyMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgY2xlYXIoKSB7CiAgICAgICAgICAgIHRoaXMuaWQgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIHRoaXMucmVxdWVzdFBheW1lbnQgPSBuZXcgUmVxdWVzdFBheW1lbnRNb2RlbCh7fSk7CiAgICAgICAgICAgIHRoaXMuaXRlbUxpbmVzID0gW107CiAgICAgICAgICAgIHRoaXMucmVxdWVzdFBheW1lbnQudHJhbnNhY3Rpb25UeXBlID0gdGhpcy50cmFuc2FjdGlvblR5cGVzWzBdOwogICAgICAgICAgICB0aGlzLmdlbmVyYXRlTnVtYmVyKCk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkRW50cnlEZXRhaWxCeUFjY291bnQoaWQsIHBhcmFtcykgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBqb3VybmFsSGFuZGxlci5nZXRFbnRyeURldGFpbEJ5QWNjb3VudChpZCwgcGFyYW1zKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdFBheW1lbnQuZnVuZEJhbGFuY2UgPSByZXMuZW5kaW5nX2JhbGFuY2UgfHwgMDsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mdW5kQmFsYW5jZSA9IHRoaXMubnVtYmVyRm9ybWF0KHJlcy5lbmRpbmdfYmFsYW5jZSB8fCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mdW5kUmVtYWluQmFsYW5jZSA9IHRoaXMubnVtYmVyRm9ybWF0KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VGbG9hdChyZXMuZW5kaW5nX2JhbGFuY2UgfHwgMCkgLQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VGbG9hdCh0aGlzLnJlcXVlc3RQYXltZW50LmV4Y2hhbmdlQW1vdW50KQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3RQYXltZW50LmZ1bmRSZW1haW5CYWxhbmNlID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQocmVzLmVuZGluZ19iYWxhbmNlIHx8IDApIC0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQodGhpcy5yZXF1ZXN0UGF5bWVudC5mdW5kQmFsYW5jZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgfSwKICAgIG1vdW50ZWQ6IGFzeW5jIGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyB0aGlzLmxvYWRTdXBwbGllcnMoKQogICAgICAgIC8vIHRoaXMubG9hZFZlbmRvcnMoJycsIHRoaXMuc3VwQmFzZVVybCkKICAgICAgICBhd2FpdCB0aGlzLmxvYWRQcmVmaXgoKTsKICAgICAgICBhd2FpdCB0aGlzLmxvYWRTYWxlRm9ybUNvbnRlbnQoKTsKICAgICAgICBhd2FpdCB0aGlzLmxvYWRPdGhlckFjY291bnQoKTsKICAgIH0sCiAgICBjb21wdXRlZDoge30sCn07Cg=="},{"version":3,"sources":["RequestPayment.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0dA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"RequestPayment.vue","sourceRoot":"src/views/suppliers","sourcesContent":["<template>\n    <v-app>\n        <v-container>\n            <v-row>\n                <v-col cols=\"12\" sm=\"12\">\n                    <v-card\n                        outlined\n                        dense\n                        class=\"pa-4 no_border rounded-sm\"\n                        color=\"white\"\n                    >\n                        <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                            <v-card outlined dense class=\"no_border mb-1\">\n                                <h2 class=\"mb-0 \">{{ $t(\"payment_request\") }}</h2>\n                                <v-icon\n                                    @click=\"cancel()\"\n                                    style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                                    class=\"float-right\"\n                                >close\n                                </v-icon>\n                            </v-card>\n\n                            <v-card outlined dense class=\"px-3 no_border mb-3\" color=\"white\">\n                                <v-row style=\"background: #F8F8F9;\">\n                                    <v-col\n                                        sm=\"3\"\n                                        cols=\"12\"\n                                        class=\"kendo_dropdown_custom pt-3 pb-0\"\n                                    >\n                                        <label>{{ $t(\"vendor_name\") }}</label>\n                                        <vendor-dropdownlist\n                                            :initVendor=\"requestPayment.supplier\"\n                                            @emitVendor=\"requestPayment.supplier = $event\"\n                                            @onChange=\"onVendorChanged\"\n                                        />\n                                    </v-col>\n                                    <v-col\n                                        sm=\"3\"\n                                        cols=\"12\"\n                                        class=\"kendo_dropdown_custom pt-3 pb-0\"\n                                    >\n                                        <label>{{ $t(\"request_date\") }}</label>\n                                        <app-datepicker\n                                            :initialDate=\"requestPayment.transactionDate\"\n                                            @emitDate=\"requestPayment.transactionDate = $event\"\n                                        />\n                                    </v-col>\n                                    <v-col sm=\"4\">\n                                        <label>{{ $t(\"number\") }}</label>\n                                        <div class=\"d-flex mt-1\">\n                                            <div class=\"code_text flex-1 text-bold\">\n                                                {{ requestPayment.transactionType.abbr }}\n                                            </div>\n\n                                            <v-text-field\n                                                class=\" custom-border flex-2\"\n                                                v-model=\"requestPayment.number\"\n                                                outlined\n                                                disabled\n                                                :rules=\"[(v) => !!v || 'Number is required']\"\n                                                required\n                                            />\n                                            <v-icon\n                                                color=\"black\"\n                                                size=\"30\"\n                                                style=\" height: 40px;\"\n                                                class=\"border_qrcode ml-2\"\n                                                @click=\"generateNumber\"\n                                            >mdi-qrcode\n                                            </v-icon>\n                                        </div>\n                                    </v-col>\n                                    <v-col sm=\"1\" cols=\"1\" class=\"pb-0\">\n                                        <v-btn\n                                            color=\"primary mt-6 white--text\"\n                                            @click=\"searchPurchaseOrderExpense\"\n                                        >\n                                            <i\n                                                class=\"b-search\"\n                                                style=\"font-size: 15px; color:#fff !important;\"\n                                            />\n                                        </v-btn>\n                                    </v-col>\n                                </v-row>\n                                <v-row style=\"background: #F8F8F9;\"></v-row>\n                                <v-row>\n                                    <v-col cols=\"12\" class=\"pt-0\">\n                                        <template>\n                                            <LoadingMe\n                                                :isLoading=\"showLoading\"\n                                                :fullPage=\"false\"\n                                                :myLoading=\"true\"\n                                            />\n                                            <kendo-datasource\n                                                ref=\"itemLineDS\"\n                                                :change=\"onDataSourceChange\"\n                                                :schema=\"schemaDefinition\"\n                                                :data=\"itemLines\"\n                                            />\n                                            <kendo-grid\n                                                id=\"gridRequestPayment_\"\n                                                class=\"grid-function\"\n                                                :data-source-ref=\"'itemLineDS'\"\n                                                ref=\"gridRequestPayment\"\n                                                :sortable=\"false\"\n                                                :filterable=\"false\"\n                                                :column-menu=\"true\"\n                                                :editable=\"true\"\n                                                :change=\"onGridRequestChange\"\n                                                :noRecords=\"true\"\n                                            >\n                                                <kendo-grid-column\n                                                    :locked=\"true\"\n                                                    :selectable=\"true\"\n                                                    :width=\"40\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'billNumber'\"\n                                                    :title=\"$t('bill_number')\"\n                                                    :width=\"180\"\n                                                    :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                                                    :template=\"billNumberTmp\"\n                                                    :locked=\"true\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'referenceNo'\"\n                                                    :title=\"$t('transaction_num')\"\n                                                    :width=\"210\"\n                                                    :hidden=\"false\"\n                                                    :locked=\"true\"\n                                                    :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                                                    :template=\"referenceNoTmp\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'dueDate'\"\n                                                    :title=\"$t('due_date')\"\n                                                    :width=\"150\"\n                                                    :lockable=\"false\"\n                                                    :template=\"formatDate\"\n                                                    :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'txnNote'\"\n                                                    :title=\"$t('note')\"\n                                                    :width=\"200\"\n                                                    :hidden=\"false\"\n                                                    :lockable=\"false\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: left; ' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'currencyCode'\"\n                                                    :title=\"$t('currency')\"\n                                                    :width=\"150\"\n                                                    :lockable=\"false\"\n                                                    :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                                                    :template=\"currency\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'amount'\"\n                                                    :title=\"$t('amount')\"\n                                                    :width=\"150\"\n                                                    :lockable=\"false\"\n                                                    :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                                                    :template=\"amount\"\n                                                    :attributes=\"{ style: 'text-align: right' }\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'discount'\"\n                                                    :title=\"$t('discount')\"\n                                                    :editor=\"discountEditor\"\n                                                    :template=\"discount\"\n                                                    :width=\"150\"\n                                                    :lockable=\"false\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: right; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: right' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'amountTobePaid'\"\n                                                    :title=\"$t('amount_to_be_paid')\"\n                                                    :width=\"210\"\n                                                    :lockable=\"false\"\n                                                    :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                                                    :template=\"amountTobePaid\"\n                                                    :attributes=\"{ style: 'text-align: right; ' }\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'paidAmount'\"\n                                                    :title=\"$t('paid_amount')\"\n                                                    :width=\"200\"\n                                                    :lockable=\"false\"\n                                                    :editor=\"paidAmountEditor\"\n                                                    :template=\"paidAmountTmp\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: right; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: right; ' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'overDue'\"\n                                                    :title=\"$t('over_due')\"\n                                                    :width=\"130\"\n                                                    :lockable=\"false\"\n                                                    :hidden=\"true\"\n                                                    :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                                                    :template=\"overDue\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'paymentTerm'\"\n                                                    :title=\"$t('payment_term')\"\n                                                    :width=\"200\"\n                                                    :lockable=\"false\"\n                                                    :hidden=\"true\"\n                                                    :template=\"settlementDiscount\"\n                                                    :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: right; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: right; ' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'bankReferenceNo'\"\n                                                    :title=\"$t('bank_reference_no')\"\n                                                    :width=\"180\"\n                                                    :lockable=\"false\"\n                                                    :hidden=\"true\"\n                                                    :template=\"bankReferenceNo\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: right; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: right; ' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'status'\"\n                                                    :title=\"$t('status')\"\n                                                    :width=\"150\"\n                                                    :lockable=\"false\"\n                                                    :template=\"status\"\n                                                    :hidden=\"true\"\n                                                    :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: right; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: right; ' }\"\n                                                />\n                                            </kendo-grid>\n                                        </template>\n                                    </v-col>\n                                    <v-col sm=\"12\" cols=\"12\" class=\"pb-0\">\n                                        <v-row>\n                                            <v-col sm=\"6\" cols=\"12\" class=\"\"></v-col>\n                                            <v-col sm=\"6\" cols=\"12\">\n                                                <v-simple-table>\n                                                    <template v-slot:default>\n                                                        <tbody>\n                                                        <tr>\n                                                            <td class=\"text-left text-uppercase\">\n                                                                {{ $t(\"discount\") }}\n                                                            </td>\n                                                            <td class=\"text-center\">:</td>\n                                                            <td class=\"text-left primary--text text-bold\">\n                                                                {{ numberFormat(requestPayment.discount) }}\n                                                            </td>\n                                                        </tr>\n                                                        <tr>\n                                                            <td class=\"text-left text-uppercase\">\n                                                                {{ $t(\"exchange_amount\") }} -\n                                                                {{ baseCurrencyCode }}\n                                                            </td>\n                                                            <td class=\"text-center\">:</td>\n                                                            <td class=\"text-left primary--text text-bold\">\n                                                                {{\n                                                                    numberFormat(requestPayment.exchangeAmount)\n                                                                }}\n                                                            </td>\n                                                        </tr>\n                                                        <tr hidden>\n                                                            <td class=\"text-left text-uppercase\">\n                                                                {{ $t(\"dr\") }}\n                                                            </td>\n                                                            <td class=\"text-center\">:</td>\n                                                            <td class=\"text-left primary--text text-bold\">\n                                                                {{ numberFormat(dr) }}\n                                                            </td>\n                                                        </tr>\n                                                        <tr hidden>\n                                                            <td class=\"text-left text-uppercase\">\n                                                                {{ $t(\"cr\") }}\n                                                            </td>\n                                                            <td class=\"text-center\">:</td>\n                                                            <td class=\"text-left primary--text text-bold\">\n                                                                {{ numberFormat(cr) }}\n                                                            </td>\n                                                        </tr>\n                                                        </tbody>\n                                                    </template>\n                                                </v-simple-table>\n                                            </v-col>\n                                        </v-row>\n                                    </v-col>\n                                </v-row>\n                                <!-- Payment Options & Position Analysis -->\n                                <v-row>\n                                    <v-col sm=\"4\" cols=\"4\" class=\"kendo_dropdown_custom\">\n                                        <v-card outlined dense class=\"no_border pa-4\" color=\"grayBg\">\n                                            <h3 class=\"mb-1\">{{ $t(\"payment_option_position\") }}</h3>\n                                            <label>{{ $t(\"payment_option\") }}</label>\n                                            <div class=\"mb-3\">\n                                                <paymentoption-dropdownlist\n                                                    :initPaymentOption=\"requestPayment.paymentOption\"\n                                                    :initType=\"'Supplier'\"\n                                                    @onChange=\"onPaymentOptionChanged\"\n                                                />\n                                            </div>\n\n                                            <label>{{ $t(\"expected_payment_date\") }}</label>\n                                            <app-datepicker\n                                                :initialDate=\"requestPayment.expectedPaymentDate\"\n                                                @emitDate=\"requestPayment.expectedPaymentDate = $event\"\n                                            />\n                                        </v-card>\n                                    </v-col>\n                                    <v-col sm=\"4\" cols=\"4\" class=\"kendo_dropdown_custom\">\n                                        <!-- Fund Position  -->\n                                        <v-card outlined dense class=\"no_border pa-4\" color=\"grayBg\" mind>\n                                            <h3 class=\"mb-1\">{{ $t(\"fund_position\") }}</h3>\n                                            <label>{{ $t(\"current_balance\") }}</label>\n                                            <h1 class=\"font_16 primary--text my-3 text-right\">{{ fundBalance }}</h1>\n\n                                            <label>{{ $t(\"remaining_balance\") }}</label>\n                                            <h1 class=\"font_16 primary--text my-3 text-right\">\n                                                {{ fundRemainBalance }}</h1>\n                                        </v-card>\n                                    </v-col>\n                                    <v-col sm=\"4\" cols=\"4\">\n                                        <!-- \tPayable Position  -->\n                                        <v-card outlined dense class=\"no_border pa-4\" color=\"grayBg\">\n                                            <h3 class=\"mb-1\">{{ $t(\"payable_position\") }}</h3>\n                                            <label>{{ $t(\"current_balance\") }}</label>\n                                            <v-text-field\n                                                outlined\n                                                :disabled=\"true\"\n                                                v-model=\"balance\"\n                                                class=\"mt-1\"\n                                            />\n                                            <label>{{ $t(\"remaining_balance\") }}</label>\n                                            <v-text-field\n                                                outlined\n                                                :disabled=\"true\"\n                                                v-model=\"vendorRemainingBalance\"\n                                                class=\"mt-1\"\n                                            />\n                                        </v-card>\n                                    </v-col>\n                                </v-row>\n                            </v-card>\n                            <v-divider class=\"mt-4\"/>\n                            <v-card outlined dense class=\"no_border function_footer\">\n                                <!--                                <v-menu>-->\n                                <!--                                    <template v-slot:activator=\"{ on }\">-->\n                                <!--                                        <v-btn-->\n                                <!--                                            color=\"black\"-->\n                                <!--                                            outlined-->\n                                <!--                                            class=\"mr-2 text-capitalize  black&#45;&#45;text float-left\"-->\n                                <!--                                            v-on=\"on\"-->\n                                <!--                                        >-->\n                                <!--                                            {{ $t(\"select_template\") }}-->\n                                <!--                                            <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>-->\n                                <!--                                        </v-btn>-->\n                                <!--                                    </template>-->\n                                <!--                                    <v-list>-->\n                                <!--                                        <v-list-item-->\n                                <!--                                            v-for=\"(item, index) in templates\"-->\n                                <!--                                            :key=\"index\"-->\n                                <!--                                        >-->\n                                <!--                                            <v-list-item-title>{{ item.title }}</v-list-item-title>-->\n                                <!--                                        </v-list-item>-->\n                                <!--                                    </v-list>-->\n                                <!--                                </v-menu>-->\n                                <v-btn\n                                    color=\"black\"\n                                    class=\"text-capitalize  white--text float-left\"\n                                    @click=\"cancel()\"\n                                >{{ $t(\"cancel\") }}\n                                </v-btn>\n                                <!--                                <v-btn-->\n                                <!--                                    color=\"third\"-->\n                                <!--                                    class=\"ml-3 float-right text-capitalize  white&#45;&#45;text\">-->\n                                <!--                                    {{ $t(\"save_new\") }}-->\n                                <!--                                </v-btn>-->\n                                <v-btn\n                                    @click=\"onSaveClose\"\n                                    color=\"primary\"\n                                    class=\" float-right text-capitalize  white--text\"\n                                >\n                                    {{ $t(\"save_close\") }}\n                                </v-btn>\n                            </v-card>\n                        </v-form>\n                    </v-card>\n                </v-col>\n            </v-row>\n        </v-container>\n    </v-app>\n</template>\n\n<script>\nimport {i18n} from \"@/i18n\";\nimport DatePickerComponent from \"@/components/custom_templates/DatePickerComponent\";\nimport supplierHandler from \"@/scripts/supplierHandler\";\nimport journalHandler from \"@/scripts/journalHandler\";\nimport RequestPaymentModel from \"@/scripts/request-payment/model/RequestPayment\";\nimport ItemLineModel from \"@/scripts/request-payment/model/ItemLine\";\nimport kendo from \"@progress/kendo-ui\";\nimport billingHandler from \"@/scripts/invoice/handler/billingHandler\";\nimport prefixHandler from \"@/scripts/prefixHandler\";\nimport purchaseFormContentHandler from \"@/scripts/purchaseFormContentHandler\";\nimport settingHandler from \"@/scripts/settingsHandler\";\nimport {CurrencyModel, PaymentTermModel} from \"@/scripts/model/AppModels\";\nimport PaymentOptionModel from \"@/scripts/model/PaymentOption\";\nimport AccountMappingModel from \"@/scripts/account-map/Account\";\nimport SupplierModel from \"@/scripts/model/Supplier\";\nimport Helper from \"@/helper\";\n\nconst cookieJS = require(\"@/cookie.js\");\nconst cookie = cookieJS.getCookie();\nconst requestPaymentModel = new RequestPaymentModel({});\nconst itemLineModel = new ItemLineModel({});\n\nconst OPTION_TYPE = \"Supplier\";\nconst TRANSACTION_TYPE = \"Request Payment\";\nconst TXN_TYPE = \"request payment\";\n\nexport default {\n    name: \"RequestPayment\",\n    components: {\n        LoadingMe: () => import(`@/components/Loading`),\n        \"app-datepicker\": DatePickerComponent,\n        \"vendor-dropdownlist\": () =>\n            import(\"@/components/dropdownlist/VendorDropdown\"),\n        \"paymentoption-dropdownlist\": () =>\n            import(\"@/components/dropdownlist/PaymentOptionDropDownList\"),\n    },\n    data: () => ({\n        showLoading: false,\n        customerList: [],\n        group: [],\n        suppliers: [],\n        customer: {},\n        overDueAmount: 0,\n        receivableBalance: 0,\n        tobeCollected: 0,\n        valid: true,\n        template: [],\n        templates: [],\n        itemLines: [],\n        transactionTypes: [],\n        receivableList: [],\n        requestPayment: requestPaymentModel,\n        itemLine: itemLineModel,\n        supBaseUrl: supplierHandler.search(),\n        selectedExpenseIds: [],\n        purchaseFormContent: {},\n        balance: 0,\n        jRaw: [],\n        txnList: [],\n        gainLossAcc: {},\n        otherRevenueAcc: {},\n        gainOrLossDescription: \"gain/loss on exchange rate\",\n        penaltyDescription: \"penalty\",\n        baseCurrencyCode: \"\",\n        loggedUser: {\n            id: cookie.creator,\n            name: cookie.email,\n        },\n        cr: 0,\n        dr: 0,\n        fundBalance: 0,\n        vendorRemainingBalance: 0,\n        fundRemainBalance: 0,\n        schemaDefinition: {\n            model: {id: \"lineId\"},\n        },\n        isCheckChanged: false,\n    }),\n    methods: {\n        onVendorChanged(value) {\n            this.requestPayment.supplier = value;\n            const supplier = this.requestPayment.supplier || {};\n            const supplierId = supplier.id || \"\";\n            if (supplierId) {\n                this.loadVendorBalance(supplierId);\n            }\n        },\n        cancel() {\n            this.$swal({\n                title: i18n.t(\"msg_title_warning\"),\n                text: i18n.t(\"msg_discard\"),\n                icon: \"warning\",\n                showCancelButton: true,\n                cancelButtonText: i18n.t(\"cancel\"),\n                confirmButtonColor: \"#4d4848\",\n                cancelButtonColor: \"#ED1A3A\",\n                confirmButtonText: i18n.t(\"discard\"),\n            }).then((result) => {\n                if (result.value) {\n                    this.$router.go(-1);\n                }\n            });\n        },\n        currency(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty(\"currencyCode\")) {\n                    return dataItem.currencyCode;\n                }\n            }\n            return \"\";\n        },\n        referenceNoTmp(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty(\"referenceNo\")) {\n                    return dataItem.referenceNo;\n                }\n            }\n            return \"\";\n        },\n        billNumberTmp(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty(\"billNumber\")) {\n                    return dataItem.billNumber;\n                }\n            }\n            return \"\";\n        },\n        paidAmountTmp(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty(\"paidAmount\")) {\n                    return kendo.toString(dataItem.paidAmount, dataItem.decimalFormat);\n                }\n            }\n            return \"\";\n        },\n        amountTobePaid(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty(\"amountTobePaid\")) {\n                    return kendo.toString(\n                        dataItem.amountTobePaid,\n                        dataItem.decimalFormat\n                    );\n                }\n            }\n            return \"\";\n        },\n        discount(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty(\"discount\")) {\n                    const discount = dataItem.discount || 0;\n                    return kendo.toString(discount, dataItem.decimalFormat);\n                }\n            }\n            return 0;\n        },\n        amount(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty(\"amount\")) {\n                    const amount = dataItem.amount || 0;\n                    return kendo.toString(amount, dataItem.decimalFormat);\n                }\n            }\n            return 0;\n        },\n        bankReferenceNo(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty(\"overDue\")) {\n                    return dataItem.bankReferenceNo;\n                }\n            }\n            return \"\";\n        },\n        overDue(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty(\"overDue\")) {\n                    return dataItem.overDue;\n                }\n            }\n            return 0;\n        },\n        paidAmountEditor(container, options) {\n            kendo\n                .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoNumericTextBox({\n                    decimals: 5,\n                    format: `n${this.purchaseFormContent.decimal}`,\n                    min: 0,\n                });\n        },\n        discountEditor(container, options) {\n            kendo\n                .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoNumericTextBox({\n                    decimals: 30,\n                    format: `n${this.purchaseFormContent.decimal}`,\n                    min: 0,\n                });\n        },\n        onTransactionDateChanged() {\n            if (this.requestPayment.supplier) {\n                const supplier = this.requestPayment.supplier || {};\n                const supId = supplier.id || \"\";\n                if (supId) {\n                    this.generateNumber();\n                    this.searchPurchaseOrderExpense();\n                }\n            }\n        },\n        generateNumber() {\n            if (this.$route.params.id) {\n                const tranDate = new Date(this.requestPayment.transactionDate);\n                const tranDateReceipt = new Date(this.requestPayment.transactionDate);\n                const tranDateM = tranDate.getFullYear() + tranDate.getMonth();\n                const tranDateReceiptM =\n                    tranDateReceipt.getFullYear() + tranDateReceipt.getMonth();\n                if (tranDateM === tranDateReceiptM) {\n                    this.requestPayment.referenceNo = this.referenceNo;\n                    return;\n                }\n            }\n            // window.console.log(\"abbr\", this.requestPayment.transactionType);\n            if (this.requestPayment.transactionDate !== \"\") {\n                let data = {\n                    abbr: this.requestPayment.transactionType.abbr,\n                    structure: this.requestPayment.transactionType.structure,\n                    transactionDate: new Date(this.requestPayment.transactionDate)\n                        .toISOString()\n                        .substr(0, 10),\n                    prefixSeparator: this.requestPayment.transactionType.prefixSeparator || '',\n                    numberSeparator: this.requestPayment.transactionType.numberSeparator || '',\n                    format: this.requestPayment.transactionType.format || 5,\n                    sequcencing: this.requestPayment.transactionType.sequcencing,\n                    type: TRANSACTION_TYPE,\n                    entity: 1,\n                };\n                billingHandler\n                    .lastNumber(data)\n                    .then((response) => {\n                        if (response.data.statusCode === 200) {\n                            const res = response.data.data;\n                            const lastNumber = this.zeroPad(\n                                parseInt(res.lastNumber),\n                                this.requestPayment.transactionType.format\n                            );\n                            const number =\n                                res.suffix +\n                                this.requestPayment.transactionType.numberSeparator +\n                                lastNumber;\n                            this.requestPayment.number = number;\n                            if (\n                                this.requestPayment.transactionType.hasOwnProperty(\n                                    \"prefixSeparator\"\n                                )\n                            ) {\n                                const prefixSep = this.requestPayment.transactionType\n                                    .prefixSeparator;\n                                this.requestPayment.referenceNo =\n                                    this.requestPayment.transactionType.abbr + prefixSep + number;\n                            }\n                        }\n                    })\n                    .catch((e) => {\n                        this.errors.push(e);\n                    });\n            }\n        },\n        zeroPad(num, places) {\n            return String(num).padStart(places, \"0\");\n        },\n        removeDuplicate(array) {\n            const result = [];\n            const map = new Map();\n            for (const item of array) {\n                if (!map.has(item.id)) {\n                    map.set(item.id, true); // set any value to Map\n                    result.push(item);\n                }\n            }\n            return result;\n        },\n        formatDate(dataItem) {\n            if (dataItem.hasOwnProperty(\"dueDate\")) {\n                return kendo.toString(new Date(dataItem.dueDate), dataItem.dateFormat);\n            }\n            return \"\";\n        },\n        settlementDiscount(dataItem) {\n            if (dataItem.hasOwnProperty(\"paymentTerm\")) {\n                return dataItem.paymentTerm.name || \"\";\n            }\n            return \"\";\n        },\n        status(dataItem) {\n            if (dataItem) {\n                if (dataItem.hasOwnProperty(\"status\")) {\n                    const status = dataItem.status;\n                    let statusText = \"\";\n                    switch (status) {\n                        case 1:\n                            statusText = \"OPEN\";\n                            break;\n                        case 2:\n                            statusText = \"Partially Paid\";\n                            break;\n                        case 4:\n                            statusText = \"VOID\";\n                            break;\n                        case 3:\n                            statusText = \"PAID\";\n                            break;\n                    }\n                    return statusText;\n                }\n            }\n            return \"\";\n        },\n        onPaymentOptionChanged(value) {\n            this.requestPayment.paymentOption = value;\n            const account = value.account || {};\n            const accountId = account.uuid || \"\";\n            if (accountId) {\n                let currentFiscalDate = Helper.getFiscalDateByDate(new Date());\n                let startDate = currentFiscalDate.start_date;\n                const strParam = {\n                    params: {\n                        start_date:\n                            kendo.toString(new Date(startDate), \"yyyy-MM-dd\") +\n                            \"T00:00:00.000Z\",\n                        end_date:\n                            kendo.toString(\n                                new Date(this.requestPayment.transactionDate),\n                                \"yyyy-MM-dd\"\n                            ) + \"T23:59:59.999Z\",\n                    },\n                };\n                this.loadEntryDetailByAccount(accountId, strParam);\n            }\n            // window.console.log(value, \"paymentOption\");\n        },\n        async loadPrefix() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    prefixHandler.get(TXN_TYPE).then((res) => {\n                        if (res.data.statusCode === 200) {\n                            const response = res.data.data;\n                            this.transactionTypes = response;\n                            if (response.length > 0) {\n                                this.requestPayment.transactionType = response[0];\n                                if (!this.$route.params.id) {\n                                    this.generateNumber();\n                                }\n                            }\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async searchPurchaseOrderExpense() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    let data = {};\n                    this.showLoading = true;\n                    const supplier = this.requestPayment.supplier || {};\n                    data = {\n                        search: supplier.id || \"\",\n                        type: \"Vendor\",\n                        transactionDate: new Date(this.requestPayment.transactionDate)\n                            .toISOString()\n                            .substr(0, 10),\n                    };\n                    this.itemLines = [];\n                    if (data.search) {\n                        if (data.search.length > 4) {\n                            this.showLoading = true;\n                            try {\n                                billingHandler.searchCashPayment(data).then((res) => {\n                                    this.showLoading = false;\n                                    if (res.data.statusCode === 200) {\n                                        const response = res.data.data;\n                                        const result = res.data.result;\n                                        this.showLoading = false;\n                                        if (response.length > 0) {\n                                            this.itemLines = response;\n                                            const obj = response[0];\n                                            if (obj.hasOwnProperty(\"supplier\")) {\n                                                this.requestPayment.supplier = obj.supplier;\n                                                if (obj.supplier.hasOwnProperty(\"name\")) {\n                                                    this.name = obj.supplier.name;\n                                                }\n                                            }\n                                        }\n                                        const baseCurrency = result;\n                                        this.baseCurrency = baseCurrency;\n                                        this.requestPayment.currency = new CurrencyModel(\n                                            baseCurrency\n                                        );\n                                        if (baseCurrency) {\n                                            if (baseCurrency.hasOwnProperty(\"code\")) {\n                                                this.baseCurrencyCode = baseCurrency.code;\n                                                // if (code) {\n                                                //     this.loadTransactionRate(baseCurrency.code)\n                                                // }\n                                            }\n                                        }\n                                    }\n                                });\n                            } catch (e) {\n                                this.showLoading = false;\n                            }\n                        } else {\n                            this.showLoading = false;\n                        }\n                    } else {\n                        this.showLoading = false;\n                    }\n                }, 10);\n            });\n        },\n        onGridRequestChange() {\n            const grid = this.$refs.gridRequestPayment.kendoWidget();\n            this.selectedExpenseIds = grid.selectedKeyNames();\n            // let ds = this.$refs.itemLineDS.kendoWidget()\n            // this.isCheckChanged = true\n            // const rows = ds.data();\n            // rows.forEach((value) => {\n            //     if (~this.selectedExpenseIds.indexOf(value.lineId)) {\n            //         // window.console.log(value, 'value')\n            //         if (value.paidAmount === 0) {\n            //             const tobePaid = value.amountTobePaid || 0\n            //             value.set('paidAmount', tobePaid)\n            //         }\n            //     }\n            // })\n            // this.$refs.gridRequestPayment.kendoWidget().read()\n            // this.isCheckChanged = false\n            this.autoCalculate();\n        },\n        onDataSourceChange(e) {\n            let amtTobePaid = 0,\n                amount = 0,\n                discount = 0,\n                paidAmount = 0;\n            let dataRow = e.items[0] || {};\n            if (Object.keys(dataRow).length > 0) {\n                dataRow.set(\"optionType\", OPTION_TYPE);\n            }\n            if (e.field) {\n                let dataRow = e.items[0];\n                switch (e.field) {\n                    case \"discount\":\n                        amount = dataRow.amount || 0;\n                        discount = dataRow.discount || 0;\n                        if (discount > amount) {\n                            dataRow.set(\"discount\", amount);\n                        }\n                        dataRow.set(\n                            \"amountTobePaid\",\n                            parseFloat(dataRow.amount) - parseFloat(dataRow.discount || 0)\n                        );\n                        dataRow.set(\n                            \"exchangeDiscount\",\n                            parseFloat(dataRow.discount) * parseFloat(dataRow.rateTobase || 1)\n                        );\n                        dataRow.set(\n                            \"exchangeDiscountTxn\",\n                            parseFloat(dataRow.discount) * parseFloat(dataRow.txnRate || 1)\n                        );\n                        amtTobePaid = parseFloat(dataRow.amountTobePaid || 0);\n                        paidAmount = parseFloat(dataRow.paidAmount || 0);\n                        if (paidAmount > amtTobePaid) {\n                            paidAmount = amtTobePaid;\n                            dataRow.set(\"paidAmount\", parseFloat(paidAmount));\n                            dataRow.set(\n                                \"paidAmountTobase\",\n                                parseFloat(paidAmount) * parseFloat(dataRow.rateTobase || 1)\n                            );\n                            dataRow.set(\n                                \"paidAmountTxn\",\n                                paidAmount * parseFloat(dataRow.txnRate || 1)\n                            );\n                        }\n                        break;\n                    case \"paidAmount\":\n                        // if (this.isCheckChanged === false) {\n                        amtTobePaid = parseFloat(dataRow.amountTobePaid || 0);\n                        paidAmount = parseFloat(dataRow.paidAmount || 0);\n                        if (paidAmount > amtTobePaid) {\n                            paidAmount = amtTobePaid;\n                        }\n                        dataRow.set(\"paidAmount\", parseFloat(paidAmount));\n                        dataRow.set(\n                            \"paidAmountTobase\",\n                            parseFloat(paidAmount) * parseFloat(dataRow.rateTobase || 1)\n                        );\n                        dataRow.set(\n                            \"paidAmountTxn\",\n                            paidAmount * parseFloat(dataRow.txnRate || 1)\n                        );\n                        // }\n                        break;\n                    default:\n                        break;\n                }\n\n                this.purchaseTxn();\n                this.autoCalculate();\n            }\n        },\n        async loadSaleFormContent() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    purchaseFormContentHandler.list().then((res) => {\n                        if (res.data.statusCode === 200) {\n                            const data = res.data.data;\n                            if (data.length > 0) {\n                                this.purchaseFormContent = data[0];\n                            }\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async loadVendorBalance(id) {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const strFilter = id + \"?type=bal\";\n                    this.requestPayment.vendorBalance = 0;\n                    billingHandler.balance(strFilter).then((res) => {\n                        if (res.data.statusCode === 200) {\n                            const data = res.data.data;\n                            if (data.length > 0) {\n                                this.requestPayment.vendorBalance = data[0].balance;\n                                this.balance = this.numberFormat(data[0].balance);\n                            }\n                        }\n                    });\n                }, 10);\n            });\n        },\n        numberFormat(value) {\n            return kendo.toString(value, `n${this.purchaseFormContent.decimal}`);\n        },\n        autoCalculate() {\n            let ds = this.$refs.itemLineDS.kendoWidget(),\n                receiptAmount = 0,\n                discount = 0,\n                convertedAmount = 0,\n                exchangeDiscount = 0,\n                exchangeDiscountTxn = 0,\n                paidAmountTxn = 0;\n            this.jRaw = [];\n            const rows = ds.data().filter((n) => n.paidAmount > 0 || n.discount > 0);\n            rows.forEach((value) => {\n                if (~this.selectedExpenseIds.indexOf(value.lineId)) {\n                    let nature = \"\",\n                        purchaseRate = 0,\n                        paymentRate = 0,\n                        rawPaidAmount = 0,\n                        rawDiscountAmount = 0,\n                        currencyCode = \"\";\n                    let discountAmount = 0,\n                        apAmount = 0,\n                        refNo = \"\",\n                        payOption = {},\n                        currency = {},\n                        gainLoss = 0,\n                        lastXRate = {},\n                        location = {},\n                        segment = {},\n                        project = {},\n                        locationId = \"\",\n                        segmentId = \"\",\n                        projectId = \"\",\n                        txnId = \"\",\n                        invRate = 1;\n                    if (value.referenceNo) {\n                        refNo = value.referenceNo;\n                    }\n                    if (value.id) {\n                        txnId = value.id || \"\";\n                    }\n                    if (value.txnRate) {\n                        purchaseRate = parseFloat(value.txnRate);\n                    }\n                    if (value.currencyCode) {\n                        currencyCode = value.currencyCode || \"\";\n                    }\n                    if (value.currency) {\n                        currency = value.currency || {};\n                    }\n                    if (value.location) {\n                        location = value.location || {};\n                        if (location.hasOwnProperty(\"id\")) {\n                            locationId = location.id;\n                        }\n                    }\n                    if (value.segment) {\n                        segment = value.segment || {};\n                        if (segment.hasOwnProperty(\"id\")) {\n                            segmentId = segment.id;\n                        }\n                    }\n                    if (value.project) {\n                        project = value.project || {};\n                        if (project.hasOwnProperty(\"id\")) {\n                            projectId = project.id;\n                        }\n                    }\n                    if (value.exchangeRate) {\n                        lastXRate = value.exchangeRate || {};\n                    }\n                    if (value.txnRate) {\n                        invRate = parseFloat(value.txnRate);\n                    }\n                    if (value.rateTobase) {\n                        paymentRate = parseFloat(value.rateTobase);\n                    }\n                    if (value.paidAmount) {\n                        receiptAmount += kendo.parseFloat(value.paidAmount);\n                        convertedAmount +=\n                            kendo.parseFloat(value.paidAmount) * value.rateTobase;\n                        paidAmountTxn += kendo.parseFloat(value.paidAmount) * invRate;\n                        // paidAmt = kendo.parseFloat(value.paidAmount) * purchaseRate\n                        rawPaidAmount = kendo.parseFloat(value.paidAmount);\n                    }\n                    if (value.discount) {\n                        // discount += kendo.parseFloat(value.discount)\n                        discount += kendo.parseFloat(value.discount) * value.rateTobase;\n                        exchangeDiscount +=\n                            kendo.parseFloat(value.exchangeDiscount) * value.rateTobase;\n                        exchangeDiscountTxn += kendo.parseFloat(value.discount) * invRate;\n                        discountAmount = kendo.parseFloat(value.discount) * paymentRate;\n                        rawDiscountAmount = kendo.parseFloat(value.discount);\n                    }\n                    // todo: gain or loss exchange rate\n                    gainLoss =\n                        parseFloat(\n                            (purchaseRate - paymentRate) * (rawPaidAmount + rawDiscountAmount)\n                        ) * -1;\n                    if (gainLoss !== 0) {\n                        if (gainLoss > 0) {\n                            nature = \"dr\";\n                        } else {\n                            nature = \"cr\";\n                        }\n                        window.console.log(\"gainLoss\", gainLoss);\n                        if (gainLoss) {\n                            if (this.gainLossAcc.hasOwnProperty(\"id\")) {\n                                this.jRaw.push({\n                                    id:\n                                        this.gainLossAcc.id +\n                                        \"-\" +\n                                        nature +\n                                        \"-\" +\n                                        currencyCode +\n                                        \"-\" +\n                                        purchaseRate +\n                                        \"-\" +\n                                        locationId +\n                                        \"-\" +\n                                        projectId +\n                                        \"-\" +\n                                        segmentId +\n                                        \"-\" +\n                                        txnId,\n                                    txnId: txnId,\n                                    project: project,\n                                    location: location,\n                                    segment: segment,\n                                    projectId: projectId,\n                                    locationId: locationId,\n                                    segmentId: segmentId,\n                                    currencyCode: currencyCode,\n                                    currency: currency,\n                                    lastXRate: lastXRate,\n                                    line: new ItemLineModel(value),\n                                    receiptRate: gainLoss > 0 ? paymentRate : purchaseRate,\n                                    description: this.gainOrLossDescription,\n                                    account: this.gainLossAcc,\n                                    accountId: this.gainLossAcc.id,\n                                    amount: 0,\n                                    exchangeAmount: gainLoss,\n                                    type: nature,\n                                    typeAs: \"GainOrLoss\",\n                                });\n                            }\n                        }\n                    }\n                    //Todo: AP  Dr\n                    apAmount = rawPaidAmount + rawDiscountAmount;\n                    if (apAmount > 0) {\n                        nature = \"dr\";\n                    } else {\n                        nature = \"cr\";\n                    }\n                    if (value.hasOwnProperty(\"apAcc\")) {\n                        const apAcc = value.apAcc;\n                        if (apAcc) {\n                            if (apAcc.hasOwnProperty(\"id\")) {\n                                this.jRaw.push({\n                                    id:\n                                        apAcc.id +\n                                        \"-\" +\n                                        nature +\n                                        \"-\" +\n                                        currencyCode +\n                                        \"-\" +\n                                        purchaseRate +\n                                        \"-\" +\n                                        locationId +\n                                        \"-\" +\n                                        projectId +\n                                        \"-\" +\n                                        segmentId +\n                                        \"-\" +\n                                        txnId,\n                                    txnId: txnId,\n                                    project: project,\n                                    location: location,\n                                    segment: segment,\n                                    projectId: projectId,\n                                    locationId: locationId,\n                                    segmentId: segmentId,\n                                    currencyCode: currencyCode,\n                                    currency: currency,\n                                    lastXRate: lastXRate,\n                                    line: new ItemLineModel(value),\n                                    receiptRate: purchaseRate,\n                                    description: refNo,\n                                    account: apAcc,\n                                    accountId: apAcc.id,\n                                    amount: apAmount,\n                                    exchangeAmount: apAmount * purchaseRate,\n                                    type: nature,\n                                    typeAs: \"AP\",\n                                });\n                            }\n                        }\n                    }\n                    //Todo: Cash Account  CR\n                    if (this.requestPayment.paymentOption) {\n                        payOption = this.requestPayment.paymentOption;\n                        const cashAmount = rawPaidAmount * -1; //+ ((purchaseRate - paymentRate) * (rawPaidAmount + rawDiscountAmount))\n                        // const cashAmount = rawPaidAmount + (gainLoss ) + rawPaidAmount\n                        if (cashAmount > 0) {\n                            nature = \"dr\";\n                        } else {\n                            nature = \"cr\";\n                        }\n                        if (payOption.hasOwnProperty(\"account\")) {\n                            const payOptionAcc = payOption.account;\n                            if (payOptionAcc.hasOwnProperty(\"id\")) {\n                                this.jRaw.push({\n                                    id:\n                                        payOptionAcc.id +\n                                        \"-\" +\n                                        nature +\n                                        \"-\" +\n                                        currencyCode +\n                                        \"-\" +\n                                        purchaseRate +\n                                        \"-\" +\n                                        locationId +\n                                        \"-\" +\n                                        projectId +\n                                        \"-\" +\n                                        segmentId +\n                                        \"-\" +\n                                        txnId,\n                                    txnId: txnId,\n                                    project: project,\n                                    location: location,\n                                    segment: segment,\n                                    projectId: projectId,\n                                    locationId: locationId,\n                                    segmentId: segmentId,\n                                    currencyCode: currencyCode,\n                                    currency: currency,\n                                    lastXRate: lastXRate,\n                                    line: new ItemLineModel(value),\n                                    receiptRate: purchaseRate,\n                                    description: refNo,\n                                    account: payOptionAcc,\n                                    accountId: payOptionAcc.id,\n                                    amount: cashAmount,\n                                    exchangeAmount: cashAmount * paymentRate,\n                                    type: nature,\n                                    typeAs: \"CashAccount\",\n                                });\n                            }\n                        }\n                    }\n                    //Todo: Settlement Discount  Cr\n                    if (value.paymentTerm) {\n                        const settlementDisc = value.paymentTerm;\n                        if (discountAmount > 0) {\n                            if (discountAmount * -1 > 0) {\n                                nature = \"dr\";\n                            } else {\n                                nature = \"cr\";\n                            }\n                            // window.console.log(settlementDisc, \"settlementDisc\");\n                            if (settlementDisc.hasOwnProperty(\"account\")) {\n                                const settlementDiscAcc = settlementDisc.account;\n                                if (settlementDiscAcc.hasOwnProperty(\"id\")) {\n                                    this.jRaw.push({\n                                        id:\n                                            settlementDiscAcc.id +\n                                            \"-\" +\n                                            nature +\n                                            \"-\" +\n                                            currencyCode +\n                                            \"-\" +\n                                            purchaseRate +\n                                            \"-\" +\n                                            locationId +\n                                            \"-\" +\n                                            projectId +\n                                            \"-\" +\n                                            segmentId +\n                                            \"-\" +\n                                            txnId,\n                                        txnId: txnId,\n                                        project: project,\n                                        location: location,\n                                        segment: segment,\n                                        projectId: projectId,\n                                        locationId: locationId,\n                                        segmentId: segmentId,\n                                        currencyCode: currencyCode,\n                                        currency: currency,\n                                        lastXRate: lastXRate,\n                                        line: new ItemLineModel(value),\n                                        receiptRate: paymentRate,\n                                        description: \"Purchase Payment Discount\",\n                                        account: settlementDiscAcc,\n                                        accountId: settlementDiscAcc.id,\n                                        amount: rawDiscountAmount * -1,\n                                        exchangeAmount: discountAmount * -1,\n                                        type: nature,\n                                        typeAs: \"Settlement Discount\",\n                                    });\n                                }\n                            }\n                        }\n                    }\n                }\n            });\n            // this.invoiceTxn(txnIds)\n\n            this.requestPayment.total = receiptAmount;\n            this.requestPayment.exchangeAmount = convertedAmount;\n            this.requestPayment.discount = discount;\n            this.requestPayment.exchangeDiscount = exchangeDiscount;\n            this.requestPayment.paidAmountTxn = paidAmountTxn;\n            this.requestPayment.exchangeDiscountTxn = exchangeDiscountTxn;\n            this.requestPayment.fundRemainBalance =\n                parseFloat(this.requestPayment.fundBalance || 0) -\n                parseFloat(convertedAmount);\n            this.requestPayment.vendorRemainingBalance =\n                parseFloat(this.requestPayment.vendorBalance || 0) -\n                (parseFloat(convertedAmount) + discount);\n\n            this.vendorRemainingBalance = this.numberFormat(\n                parseFloat(this.requestPayment.vendorBalance || 0) -\n                (parseFloat(convertedAmount) + discount)\n            );\n            this.fundRemainBalance = this.numberFormat(\n                parseFloat(this.requestPayment.fundBalance || 0) -\n                parseFloat(convertedAmount)\n            );\n            this.shrinkData(this.jRaw);\n            window.console.log(\"aa\", rows);\n        },\n        shrinkData(obj) {\n            const uniques = this.removeDuplicate(obj);\n            uniques.forEach((n) => {\n                const found = obj.filter((m) => m.id === n.id);\n                let amount = 0,\n                    exchangeAmount = 0;\n                found.forEach((z) => {\n                    amount += parseFloat(z.amount || 0);\n                    exchangeAmount += parseFloat(z.exchangeAmount || 0);\n                });\n                n.exchangeAmount = parseFloat(exchangeAmount); //this.numberFormat(amount)\n                n.amount = parseFloat(amount); //parseFloat(parseFloat(amount / parseFloat(n.receiptRate))) //this.numberFormat(amount * parseFloat(this.invoice.txnRate)) //.toFixed(this.saleFormContent.decimal)\n            });\n            this.jRaw = uniques;\n            let dr = 0,\n                cr = 0;\n            this.jRaw.forEach((j) => {\n                switch (j.type) {\n                    case \"cr\":\n                        cr += parseFloat(j.exchangeAmount);\n                        break;\n                    case \"dr\":\n                        dr += parseFloat(j.exchangeAmount);\n                        break;\n                    default:\n                        break;\n                }\n            });\n            // window.console.log(JSON.stringify(this.jRaw), 'uniques')\n            const txnId = this.jRaw.map((o) => o.txnId);\n            const uSet = new Set(txnId);\n            const uniqueSet = [...uSet];\n            let jRaws = [];\n            // window.console.log(JSON.stringify(uniqueSet), 'uniques')\n            uniqueSet.forEach((n) => {\n                const found = this.jRaw.filter((m) => m.txnId === n);\n                const line = found[0].line;\n                const refNo = line.referenceNo;\n                jRaws.push({\n                    id: n,\n                    currencyCode: found[0].currencyCode,\n                    projectId: found[0].projectId,\n                    segmentId: found[0].segmentId,\n                    locationId: found[0].locationId,\n                    referenceNo: refNo || \"\",\n                    entries: found,\n                });\n            });\n            this.jRaw = jRaws;\n            this.dr = dr;\n            this.cr = cr;\n            window.console.log(\"dr=\", dr, \"cr=\", cr, \"dr+cr = \", dr + cr);\n            window.console.log(jRaws, \"uniques\");\n        },\n        purchaseTxn() {\n            let txnIds = [],\n                ids = [];\n            this.itemLines.forEach((value) => {\n                if (value.id) {\n                    txnIds.push({\n                        id: value.id,\n                        status: 1,\n                    });\n                }\n            });\n            ids = Object.values(txnIds.reduce((r, o) => ((r[o.id] = o), r), {}));\n            ids.forEach((m) => {\n                const lines = this.itemLines.filter((n) => n.id === m.id);\n                let paidAmt = 0;\n                let amountTobePaid = 0;\n                lines.forEach((x) => {\n                    if (x.paidAmount) {\n                        paidAmt += x.paidAmount;\n                    }\n                    if (x.amountTobePaid) {\n                        amountTobePaid += x.amountTobePaid;\n                    }\n                });\n                const pAmt = this.numberFormat(paidAmt);\n                const amtTobePaid = this.numberFormat(amountTobePaid);\n                if (pAmt === amtTobePaid) {\n                    m[\"status\"] = 3; //Paid\n                } else {\n                    m[\"status\"] = 2; // Partially Paid\n                }\n            });\n            this.txnList = ids;\n        },\n        async loadOtherAccount() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    settingHandler\n                        .getOtherAccount()\n                        .then((res) => {\n                            if (res.data.statusCode === 200) {\n                                this.showLoading = false;\n                                const response = res.data.data;\n                                const data = response.filter(\n                                    (o) => o.banhjiAccCode === \"740010\"\n                                );\n                                if (data.length > 0) {\n                                    this.gainLossAcc = data[0].account;\n                                }\n                                const data_ = response.filter(\n                                    (o) => o.banhjiAccCode === \"740040\"\n                                );\n                                if (data_.length > 0) {\n                                    this.otherRevenueAcc = data_[0].account;\n                                }\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 10);\n            });\n        },\n        async onSaveClose() {\n            if (!this.$refs.form.validate()) {\n                this.$refs.form.validate();\n                return;\n            }\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    let itemLineDS = this.$refs.itemLineDS.kendoWidget();\n                    let itemLines = [];\n                    const supplier = this.requestPayment.supplier || {};\n                    itemLineDS\n                        .data()\n                        .filter((n) => n.paidAmount > 0 || n.discount > 0)\n                        .map((n) => {\n                            if (~this.selectedExpenseIds.indexOf(n.lineId)) {\n                                const currency = n.currency || {};\n                                n[\"paymentOption\"] = new PaymentOptionModel(\n                                    n.paymentOption || {}\n                                );\n                                n[\"paymentTerm\"] = new PaymentTermModel(n.paymentTerm || {});\n                                n[\"currency\"] = new CurrencyModel(n.currency || {});\n                                n[\"currencyCode\"] = currency.code || \"\";\n                                n[\"apAcc\"] = new AccountMappingModel(n.apAcc || {});\n                                n[\"supplier\"] = new SupplierModel(supplier);\n                                n[\"id\"] = n[\"txnId\"];\n                                itemLines.push(new ItemLineModel(n));\n                            }\n                        });\n                    if (itemLines.length > 0) {\n                        let isAutoGenerate = 1;\n                        //todo: match Request Payment model\n                        this.requestPayment[\"itemLines\"] = itemLines;\n                        this.requestPayment[\"type\"] = TRANSACTION_TYPE;\n                        this.requestPayment[\"isAutoGenerate\"] = isAutoGenerate;\n                        this.requestPayment[\"actionType\"] = this.$route.params.id\n                            ? this.$route.query.type\n                            : \"new\";\n                        this.requestPayment[\"loggedUser\"] = this.loggedUser;\n\n                        this.showLoading = true;\n                        // window.console.log('this.itemLines', itemLines)\n                        // window.console.log('this.itemLines', JSON.stringify(itemLines))\n                        billingHandler\n                            .createRequestPayment(\n                                new RequestPaymentModel(this.requestPayment)\n                            )\n                            .then((response) => {\n                                if (response.data.statusCode === 201) {\n                                    // this.close(response.data.data)\n                                    this.showLoading = false;\n                                    this.$snotify.success(\"Successfully\");\n                                    this.clear();\n                                    window.history.go(-1);\n                                }\n                            })\n                            .catch((e) => {\n                                this.showLoading = false;\n                                this.$snotify.error(\"Something went wrong\");\n                                this.errors.push(e);\n                            });\n                    }\n                }, 20);\n            });\n        },\n        clear() {\n            this.id = undefined;\n            this.requestPayment = new RequestPaymentModel({});\n            this.itemLines = [];\n            this.requestPayment.transactionType = this.transactionTypes[0];\n            this.generateNumber();\n        },\n        async loadEntryDetailByAccount(id, params) {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    this.showLoading = true;\n                    journalHandler.getEntryDetailByAccount(id, params).then((res) => {\n                        // if (res.data.statusCode === 200) {\n                        this.showLoading = false;\n                        this.requestPayment.fundBalance = res.ending_balance || 0;\n                        this.fundBalance = this.numberFormat(res.ending_balance || 0);\n                        this.fundRemainBalance = this.numberFormat(\n                            parseFloat(res.ending_balance || 0) -\n                            parseFloat(this.requestPayment.exchangeAmount)\n                        );\n                        this.requestPayment.fundRemainBalance =\n                            parseFloat(res.ending_balance || 0) -\n                            parseFloat(this.requestPayment.fundBalance);\n                        // } else {\n                        //     this.showLoading = true;\n                        // }\n                    });\n                }, 10);\n            });\n        },\n    },\n    mounted: async function () {\n        // this.loadSuppliers()\n        // this.loadVendors('', this.supBaseUrl)\n        await this.loadPrefix();\n        await this.loadSaleFormContent();\n        await this.loadOtherAccount();\n    },\n    computed: {},\n};\n</script>\n\n<style scoped>\n.theme--light.v-data-table\n> .v-data-table__wrapper\n> table\n> tbody\n> tr:not(:last-child)\n> td:not(.v-data-table__mobile-row),\n.theme--light.v-data-table\n> .v-data-table__wrapper\n> table\n> tbody\n> tr:not(:last-child)\n> th:not(.v-data-table__mobile-row) {\n    border-bottom: thin solid #dfdfdf;\n}\n\n.theme--light.v-data-table\n> .v-data-table__wrapper\n> table\n> tbody\n> tr:last-child\ntd {\n    border-bottom: thin solid #dfdfdf;\n}\n\n.theme--light.v-data-table\n> .v-data-table__wrapper\n> table\n> tbody\n> tr:first-child\ntd {\n    border-top: thin solid #dfdfdf;\n}\n\n.v-data-table > .v-data-table__wrapper > table > tbody > tr > td {\n    height: 32px !important;\n}\n\n@media (min-width: 1264px) {\n    .container {\n        max-width: 1280px !important;\n    }\n}\n</style>\n"]}]}