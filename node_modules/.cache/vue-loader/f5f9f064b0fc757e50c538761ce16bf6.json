{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/customers/SaleQuote.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/customers/SaleQuote.vue","mtime":1642155812659},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8vIGltcG9ydCBMb2FkaW5nTWUgZnJvbSAnQC9jb21wb25lbnRzL0xvYWRpbmcnCmltcG9ydCB7aTE4bn0gZnJvbSAiQC9pMThuIjsKaW1wb3J0IERhdGVQaWNrZXJDb21wb25lbnQgZnJvbSAiQC9jb21wb25lbnRzL2N1c3RvbV90ZW1wbGF0ZXMvRGF0ZVBpY2tlckNvbXBvbmVudCI7CmltcG9ydCBrZW5kbyBmcm9tICJAcHJvZ3Jlc3Mva2VuZG8tdWkiOwppbXBvcnQge0Ryb3BEb3duTGlzdH0gZnJvbSAiQHByb2dyZXNzL2tlbmRvLXZ1ZS1kcm9wZG93bnMiOwppbXBvcnQgU2FsZUZvcm1Db250ZW50TW9kZWwgZnJvbSAiQC9zY3JpcHRzL21vZGVsL1NhbGVGb3JtQ29udGVudCI7CmltcG9ydCBJdGVtTGluZU1vZGVsIGZyb20gIkAvc2NyaXB0cy9pbnZvaWNlL21vZGVsL0l0ZW1MaW5lIjsKaW1wb3J0IHt1dWlkfSBmcm9tICJ2dWUtdXVpZCI7CmltcG9ydCBUcmFuc2FjdGlvbk1vZGVsIGZyb20gIkAvc2NyaXB0cy9tb2RlbC9UcmFuc2FjdGlvbiI7CgovKiBTdG9yZSAqLwppbXBvcnQgc3RvcmUgZnJvbSAiQC9zdG9yZSIKCmNvbnN0IGluc3RpdHV0ZSA9IHN0b3JlLnN0YXRlLmluc3RpdHV0ZS5pbnN0aXR1dGUKCmltcG9ydCB7U2hvd1Jlc291cmNlfSBmcm9tICJAL29ic2VydmFibGUvc3RvcmUiOwppbXBvcnQgcGF5bWVudFRlcm1IYW5kbGVyXyBmcm9tICJAL3NjcmlwdHMvcGF5bWVudHRlcm0vaGFuZGxlci9wYXltZW50VGVybUhhbmRsZXIiOwppbXBvcnQgY3JlZGl0TGltaXRIYW5kbGVyIGZyb20gIkAvc2NyaXB0cy9jcmVkaXRMaW1pdC9oYW5kbGVyL2NyZWRpdExpbWl0SGFuZGxlciI7Ci8vLy9oYW5kbGVyCmNvbnN0IHRyYW5zYWN0aW9uSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy90cmFuc2FjdGlvbkhhbmRsZXIiKTsKY29uc3QgYmlsbGluZ0hhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvaW52b2ljZS9oYW5kbGVyL2JpbGxpbmdIYW5kbGVyIik7CmNvbnN0IGN1c3RvbWVySGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9jdXN0b21lckhhbmRsZXIiKTsKY29uc3QgcHJvamVjdEhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvcHJvamVjdEhhbmRsZXIiKTsKY29uc3QgcHJlZml4SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wcmVmaXhIYW5kbGVyIik7CmNvbnN0IHBheW1lbnRUZXJtSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wYXltZW50VGVybUhhbmRsZXIiKTsKY29uc3QgcHJpY2VMZXZlbEhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvcHJpY2VMZXZlbEhhbmRsZXIiKTsKY29uc3Qgc2FsZUZvcm1Db250ZW50SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9zYWxlRm9ybUNvbnRlbnRIYW5kbGVyIik7CmNvbnN0IGVtcGxveWVlSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9lbXBsb3llZUhhbmRsZXIiKTsKY29uc3QgaXRlbU1vZGlmaWVySGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9pdGVtTW9kaWZpZXJIYW5kbGVyIik7CmNvbnN0IGRpc2NvdW50SXRlbUhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvZGlzY291bnRJdGVtSGFuZGxlciIpOwpjb25zdCB1b21QcmljZUhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvdW9tUHJpY2VIYW5kbGVyIik7CmNvbnN0IHByb2R1Y3RWYXJpYW50SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wcm9kdWN0VmFyaWFudEhhbmRsZXIiKTsKY29uc3Qgb3RoZXJDaGFyZ2VIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL290aGVyQ2hhcmdlSGFuZGxlciIpOwpjb25zdCBsb2NhdGlvbkhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvbG9jYXRpb25IYW5kbGVyIik7CmNvbnN0IHNldHRpbmdzSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9zZXR0aW5nc0hhbmRsZXIiKTsKY29uc3Qgc2FsZUNoYW5uZWxIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3NhbGVDaGFubmVsSGFuZGxlciIpOwpjb25zdCBzYWxlVW5pdEl0ZW1IYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3NhbGVVbml0SXRlbUhhbmRsZXIiKTsKY29uc3Qgc2V0dGluZ0hhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvc2V0dGluZ0hhbmRsZXIiKTsKY29uc3QgY2F0YWxvZ0hhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvY2F0YWxvZ0hhbmRsZXIiKTsKY29uc3QgcHJvZHVjdEhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvcHJvZHVjdEhhbmRsZXIiKTsKY29uc3QgY3VycmVuY3lIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2N1cnJlbmN5L2hhbmRsZXIvY3VycmVuY3lIYW5kbGVyIik7Cgpjb25zdCBzYWxlRm9ybUNvbnRlbnRNb2RlbCA9IG5ldyBTYWxlRm9ybUNvbnRlbnRNb2RlbCh7fSk7CmNvbnN0IGl0ZW1MaW5lTW9kZWwgPSBuZXcgSXRlbUxpbmVNb2RlbCh7fSk7Ci8vb3RoZXIKY29uc3QgJCA9IGtlbmRvLmpRdWVyeQpjb25zdCB0ZXh0RmllbGQgPSAibnVtYmVyTmFtZSI7CmNvbnN0IGtleUZpZWxkID0gImlkIjsKY29uc3QgZGVmYXVsdEl0ZW0gPSB7W3RleHRGaWVsZF06ICJTZWxlY3QgY3VzdG9tZXIuLi4iLCBba2V5RmllbGRdOiBudWxsfTsKY29uc3QgZW1wdHlJdGVtID0ge1t0ZXh0RmllbGRdOiAibG9hZGluZyAuLi4ifTsKY29uc3QgaW52b2ljZVByZWZpeCA9ICJsaW4tIjsKY29uc3QgRElTQ09VTlRfVFlQRSA9ICI/dHlwZT1TYWxlIjsKY29uc3QgY29va2llSlMgPSByZXF1aXJlKCJAL2Nvb2tpZS5qcyIpOwpjb25zdCBjb29raWUgPSBjb29raWVKUy5nZXRDb29raWUoKTsKY29uc3Qge2RhdGFTdG9yZX0gPSByZXF1aXJlKCJAL29ic2VydmFibGUvc3RvcmUiKTsKCmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWU6ICJTYWxlUXVvdGUiLAogICAgcHJvcHM6IHsKICAgICAgICBpZDogewogICAgICAgICAgICB0eXBlOiBTdHJpbmcsCiAgICAgICAgfSwKICAgICAgICBpbml0U2FsZVF1b3RlOiB7CiAgICAgICAgICAgIHR5cGU6IFRyYW5zYWN0aW9uTW9kZWwsCiAgICAgICAgfSwKICAgIH0sCiAgICBjb21wb25lbnRzOiB7CiAgICAgICAgTG9hZGluZ01lOiAoKSA9PiBpbXBvcnQoYEAvY29tcG9uZW50cy9Mb2FkaW5nYCksCiAgICAgICAgImFwcC1kYXRlcGlja2VyIjogRGF0ZVBpY2tlckNvbXBvbmVudCwKICAgICAgICBkcm9wZG93bmxpc3Q6IERyb3BEb3duTGlzdCwKICAgICAgICAiYXBwLW1vbnRob2YtcGlja2VyIjogKCkgPT4KICAgICAgICAgICAgaW1wb3J0KCJAL2NvbXBvbmVudHMva2VuZG9fdGVtcGxhdGVzL01vbnRoT2ZQaWNrZXIiKSwKICAgIH0sCiAgICBkYXRhOiAoKSA9PiAoewogICAgICAgIHRyYW5zYWN0aW9uOiBuZXcgVHJhbnNhY3Rpb25Nb2RlbCgpLAogICAgICAgIGlzRWRpdDogZmFsc2UsCiAgICAgICAgbnVtU2VsZWN0OiBbMV0sCiAgICAgICAgZGlhbG9nVGF4OiBmYWxzZSwKICAgICAgICAvL0NhdGFsb2cKICAgICAgICBkaWFsb2dDYXRhbG9nOiBmYWxzZSwKICAgICAgICBncmlkU2NoZW1hOiB7CiAgICAgICAgICAgIG1vZGVsOiB7CiAgICAgICAgICAgICAgICBpZDogImlkIiwKICAgICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIGNhdGFsb2dzOiBbXSwKICAgICAgICBpbWdVUkw6ICJodHRwczovL3MzLWFwLXNvdXRoZWFzdC0xLmFtYXpvbmF3cy5jb20vaW1hZ2VzLmJhbmhqaS8iLAogICAgICAgIC8vIExvYWRpbmdNZQogICAgICAgIHNob3dMb2FkaW5nOiBmYWxzZSwKICAgICAgICBsb2FkaW5nQWxlcnQ6IGZhbHNlLAogICAgICAgIGxvYWRpbmdDb2xvckFsZXJ0OiAiIiwKICAgICAgICBsb2FkaW5nVGV4dEFsZXJ0OiAiIiwKICAgICAgICBiaWxsX2RhdGU6ICIiLAogICAgICAgIGFsZXJ0OiBmYWxzZSwKICAgICAgICBmaWxlczogW10sCiAgICAgICAgZXJyb3JzOiBbXSwKICAgICAgICAvLyBGb3JtIHZhbGlkYXRpb24KICAgICAgICB2YWxpZDogdHJ1ZSwKICAgICAgICB0ZW1wbGF0ZXM6IFsKICAgICAgICAgICAge3RpdGxlOiAiRHJhZnQifSwKICAgICAgICAgICAge3RpdGxlOiAiT3BlbiJ9LAogICAgICAgICAgICB7dGl0bGU6ICJQYXJ0aWFsbHkgQ2xvc2VkIn0sCiAgICAgICAgICAgIHt0aXRsZTogIkNsb3NlZCJ9LAogICAgICAgIF0sCiAgICAgICAgY29sX2V4cGFuZDogOSwKICAgICAgICBjb2xfaGlkZTogMywKICAgICAgICBpc0hpZGVCYXI6IGZhbHNlLAogICAgICAgIGZpbHRlcjogIiIsCiAgICAgICAgdGV4dEZpZWxkOiAibnVtYmVyTmFtZSIsCiAgICAgICAgZGF0YUl0ZW1LZXk6ICJpZCIsCiAgICAgICAgZGVmYXVsdEl0ZW06IGRlZmF1bHRJdGVtLAogICAgICAgIG1PdGhlckNoYXJnZTogW10sCiAgICAgICAgLy9pdGVtCiAgICAgICAgaXRlbUxpbmVzOiBbXSwKICAgICAgICBpdGVtTGluZTogaXRlbUxpbmVNb2RlbCwKICAgICAgICBkYXRlRm9ybWF0OiBpdGVtTGluZU1vZGVsLmRhdGVGb3JtYXQsCiAgICAgICAgLy9jdXN0b21lcgogICAgICAgIGN1c0Jhc2VVcmw6IGN1c3RvbWVySGFuZGxlci5zZWFyY2h2MSgpLAogICAgICAgIGVtcEJhc2VVcmw6IGVtcGxveWVlSGFuZGxlci5zZWFyY2goKSwKICAgICAgICBjdXN0b21lcjoge30sCiAgICAgICAgY3VzdG9tZXJMaXN0OiBbXSwKICAgICAgICBiaWxsaW5nQWRkcmVzczogW10sCiAgICAgICAgZGVsaXZlcnlBZGRyZXNzOiBbXSwKICAgICAgICBwcmljZUxldmVsOiBbXSwKICAgICAgICAvL2RhdGUKICAgICAgICBwYXltZW50VGVybXM6IFtdLAogICAgICAgIHRyYW5zYWN0aW9uczogW10sCiAgICAgICAgZW1wbG95ZWVzOiBbXSwKICAgICAgICBtRW1wbG95ZWU6IHt9LAogICAgICAgIHNhbGVDaGFubmVsTGlzdDogW10sCiAgICAgICAgbG9jYXRpb25zOiBbXSwKICAgICAgICBjdXN0b21lclByb2plY3RzOiBbXSwKICAgICAgICBzZWdtZW50czogW10sCiAgICAgICAgdHJhbnNhY3Rpb25UeXBlOiB7fSwKICAgICAgICB0YXhMaXN0VG90YWw6IHt9LAogICAgICAgIGN1c3RvbWVyRGlzY291bnRJdGVtOiBbXSwKICAgICAgICBjdXN0b21lclNhbGVVbml0OiBbXSwKICAgICAgICBzYWxlRm9ybUNvbnRlbnQ6IHNhbGVGb3JtQ29udGVudE1vZGVsLAogICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnN1YnN0cigwLCAxMCksCiAgICAgICAgZGVsaXZlcnlEYXRlVGltZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnN1YnN0cigwLCAxMCksCiAgICAgICAgdmFsaWRpdHlEYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3Vic3RyKDAsIDEwKSwKICAgICAgICBzcGVjaWZpY0Rpc2NvdW50SXRlbTogW10sCiAgICAgICAgb3RoZXJDaGFyZ2VMaXN0OiBbXSwKICAgICAgICBzYWxlVW5pdEl0ZW1MaXN0OiBbXSwKICAgICAgICBvdGhlclRheDogW10sCiAgICAgICAgc3BlY2lmaWNUYXg6IFtdLAogICAgICAgIHB1YmxpY0xpZ2h0aW5nVGF4OiBbXSwKICAgICAgICB2YXRUYXg6IFtdLAogICAgICAgIHRheDogW10sCiAgICAgICAgbG9nZ2VkVXNlcjogewogICAgICAgICAgICBpZDogY29va2llLmNyZWF0b3IsCiAgICAgICAgICAgIG5hbWU6IGNvb2tpZS5lbWFpbAogICAgICAgIH0sCiAgICAgICAgbGVhZHM6IFtdLAogICAgICAgIG1vbnRoT2Y6ICcnLAogICAgICAgIGlzU2F2ZU5ldzogZmFsc2UsCiAgICAgICAgaXNTYXZlQ2xvc2U6IGZhbHNlLAogICAgICAgIGlzU2F2ZVByaW50OiBmYWxzZSwKICAgICAgICBpc1NhdmVEcmFmdDogZmFsc2UsCiAgICAgICAgZXhjaGFuZ2VSYXRlOiB7fSwKICAgICAgICBiYXNlQ3VycmVuY3lDb2RlOiAiIiwKICAgICAgICBjdXJyZW5jeUNvZGU6ICIiLAogICAgICAgIHRyYW5zYWN0aW9uUmF0ZTogMSwKICAgICAgICBzYXZlT3B0aW9uOiAiIiwKICAgICAgICBzY2hlbWFNb2RlbEZpZWxkczogewogICAgICAgICAgICB1b206IHt2YWxpZGF0aW9uOiB7cmVxdWlyZWQ6IHRydWV9fSwKICAgICAgICAgICAgcHJpY2U6IHt2YWxpZGF0aW9uOiB7cmVxdWlyZWQ6IHRydWV9fSwKICAgICAgICB9LAogICAgICAgIGlzUHJpY2VMZXZlbENoYW5nZWQ6IGZhbHNlLAogICAgICAgIHRlbXBsYXRlc0Zvcm06IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWQ6IDEsCiAgICAgICAgICAgICAgICB0eXBlOiAiU2FsZSBRdW90ZSIsCiAgICAgICAgICAgICAgICBuYW1lOiAiU2FsZSBRdW90ZSIsCiAgICAgICAgICAgIH0KICAgICAgICBdLAogICAgICAgIHRlbXBsYXRlOiAwLAogICAgICAgIGJ0bkRpc2FibGVkOiBmYWxzZQogICAgfSksCiAgICBtZXRob2RzOiB7CiAgICAgICAgQ2hvc2VUZW1wbGF0ZShpKSB7CiAgICAgICAgICAgIHRoaXMudGVtcGxhdGUgPSBpOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZEVtcGxveWVlQ2VudGVyKCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVtcGxveWVlcyA9IFtdOwogICAgICAgICAgICAgICAgICAgIGVtcGxveWVlSGFuZGxlcgogICAgICAgICAgICAgICAgICAgICAgICAuY2VudGVyKHVuZGVmaW5lZCkKICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLmVtcGxveWVlID0ge30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW1wbG95ZWVzID0gW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbXBsb3llZXMgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmICh0aGlzLmVtcGxveWVlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIHRoaXMudHJhbnNhY3Rpb24uZW1wbG95ZWUgPSB0aGlzLmVtcGxveWVlc1swXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKCk7CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIG51bWJlckVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBkYXRhLWJpbmQ9InZhbHVlOicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvTnVtZXJpY1RleHRCb3goewogICAgICAgICAgICAgICAgICAgIGRlY2ltYWxzOiAzMCwKICAgICAgICAgICAgICAgICAgICBtaW46IDAuMDAwMSwKICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IGAke3RoaXMuc2FsZUZvcm1Db250ZW50LmRlY2ltYWx9YCwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYW1vdW50Rm9ybWF0KHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyh2YWx1ZS5hbW91bnQsIGBuJHt0aGlzLnNhbGVGb3JtQ29udGVudC5kZWNpbWFsfWApOwogICAgICAgIH0sCiAgICAgICAgcHJpY2VGb3JtYXQodmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIGtlbmRvLnRvU3RyaW5nKHZhbHVlLnByaWNlLCBgbiR7dGhpcy5zYWxlRm9ybUNvbnRlbnQuZGVjaW1hbH1gKTsKICAgICAgICB9LAogICAgICAgIEhlbHAoa2V5X3NlYXJjaCkgewogICAgICAgICAgICBTaG93UmVzb3VyY2Uoa2V5X3NlYXJjaCk7CiAgICAgICAgfSwKICAgICAgICBpbml0aWFsRGF0YSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuaW5pdFNhbGVRdW90ZSkgewogICAgICAgICAgICAgICAgLy8gRWRpdCBNb2RlCiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uID0gdGhpcy5pbml0U2FsZVF1b3RlOwogICAgICAgICAgICAgICAgdGhpcy5iaW5kRGF0YSgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gQnJhbmQgTmV3IE1vZGUKICAgICAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RGVmYXVsdERhdGEoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkVmlld1NhbGVRdW90ZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzZXREZWZhdWx0RGF0YSgpIHsKICAgICAgICAgICAgLy8gQnJhbmQgTmV3IE1vZGUKICAgICAgICAgICAgdGhpcy5pc0VkaXQgPSBmYWxzZTsKICAgICAgICAgICAgLy9zZXQgZGVmYXVsdCBzZWdtZW50CiAgICAgICAgICAgIC8vIGxldCBzID0ge307CiAgICAgICAgICAgIC8vIGlmICh0aGlzLnNlZ21lbnRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgLy8gICAgIHMgPSB0aGlzLnNlZ21lbnRzWzBdOwogICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIC8vIC8vc2V0IGRlZmF1bHQgbG9jYXRpb24KICAgICAgICAgICAgLy8gbGV0IGwgPSB7fTsKICAgICAgICAgICAgLy8gaWYgKHRoaXMubG9jYXRpb25zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgLy8gICAgIGwgPSB0aGlzLmxvY2F0aW9uc1swXTsKICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAvLyAvL3NldCBkZWZhdWx0IGVtcGxveWVlCiAgICAgICAgICAgIC8vIGxldCBlID0ge307CiAgICAgICAgICAgIC8vIGlmICh0aGlzLmVtcGxveWVlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIC8vICAgICBlID0gdGhpcy5lbXBsb3llZXNbMF07CiAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgLy8gLy90cmFuc2FjdGlvbiB0eXBlCiAgICAgICAgICAgIC8vIGxldCB0dCA9IHt9OwogICAgICAgICAgICAvLyBpZiAodGhpcy50cmFuc2FjdGlvblR5cGUubGVuZ3RoID4gMCkgewogICAgICAgICAgICAvLyAgICAgdHQgPSB0aGlzLnRyYW5zYWN0aW9uVHlwZVswXTsKICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAvLyAvL3BheW1lbnQgdGVybQogICAgICAgICAgICAvLyBsZXQgcCA9IHt9OwogICAgICAgICAgICAvLyBpZiAodGhpcy5wYXltZW50VGVybXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAvLyAgICAgcCA9IHRoaXMucGF5bWVudFRlcm1zWzBdOwogICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIC8vIC8vcHJpY2UgbGV2ZWwKICAgICAgICAgICAgLy8gbGV0IHBsID0ge307CiAgICAgICAgICAgIC8vIGlmICh0aGlzLnByaWNlTGV2ZWwubGVuZ3RoID4gMCkgewogICAgICAgICAgICAvLyAgICAgcGwgPSB0aGlzLnByaWNlTGV2ZWxbMF07CiAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgLy8gLy9zYWxlIGNoYW5lbAogICAgICAgICAgICAvLyBsZXQgc2MgPSB7fTsKICAgICAgICAgICAgLy8gaWYgKHRoaXMuc2FsZUNoYW5uZWxMaXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgLy8gICAgIHNjID0gdGhpcy5zYWxlQ2hhbm5lbExpc3RbMF07CiAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbk1vZGVsKCk7CiAgICAgICAgICAgIC8vIEdlbmVyYXRlIE51bWJlcgogICAgICAgICAgICB0aGlzLml0ZW1MaW5lcyA9IFtdCiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuc2FsZVF1b3RlSXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICBkcy5kYXRhKFtdKTsKICAgICAgICAgICAgLy8gQWRkIDIgZGVmYXVsdCBsaW5lcwogICAgICAgICAgICAvLyB0aGlzLnJlbW92ZUVtcHR5TGluZSgpCiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgLy8gdGhpcy5hZGRSb3coKQogICAgICAgICAgICAgICAgdGhpcy5hZGRSb3coKQogICAgICAgICAgICB9LCA1MDApCiAgICAgICAgICAgIC8vIHRoaXMubG9hZExlYWQoKTsKICAgICAgICAgICAgLy8gdGhpcy5sb2FkU2FsZUNoYW5uZWwoKTsKICAgICAgICAgICAgLy8gdGhpcy5sb2FkRW1wbG95ZWVDZW50ZXIoKQogICAgICAgICAgICB0aGlzLm90aGVyQ2hhcmdlTGlzdCA9IFtdCiAgICAgICAgICAgIHRoaXMubU90aGVyQ2hhcmdlID0gW10KICAgICAgICAgICAgdGhpcy50YXhMaXN0VG90YWwgPSB7fQogICAgICAgICAgICB0aGlzLm1FbXBsb3llZSA9IHt9CiAgICAgICAgICAgIC8vIHRoaXMubG9hZExlYWQoKQogICAgICAgICAgICB0aGlzLmxlYWRzID0gW10KICAgICAgICB9LAogICAgICAgIGJpbmREYXRhKCkgewogICAgICAgICAgICAvLyBFZGl0IE1vZGUKICAgICAgICAgICAgdGhpcy5pc0VkaXQgPSB0cnVlOwogICAgICAgICAgICB0aGlzLmN1c3RvbWVyID0gdGhpcy50cmFuc2FjdGlvbi5jdXN0b21lcjsKICAgICAgICAgICAgLy8gdGhpcy5vbkNoYW5nZShlKQogICAgICAgICAgICB0aGlzLmJpbGxpbmdBZGRyZXNzID0gdGhpcy50cmFuc2FjdGlvbi5jdXN0b21lci5iaWxsaW5nQWRkcmVzczsKICAgICAgICAgICAgdGhpcy5kZWxpdmVyeUFkZHJlc3MgPSB0aGlzLnRyYW5zYWN0aW9uLmN1c3RvbWVyLmRlbGl2ZXJ5QWRkcmVzczsKICAgICAgICAgICAgdGhpcy50YXhMaXN0VG90YWwgPSB0aGlzLnRyYW5zYWN0aW9uLnRheExpc3RUb3RhbDsKICAgICAgICAgICAgdGhpcy5pdGVtTGluZXMgPSB0aGlzLnRyYW5zYWN0aW9uLml0ZW1MaW5lczsKICAgICAgICAgICAgdGhpcy5tT3RoZXJDaGFyZ2UgPSB0aGlzLnRyYW5zYWN0aW9uLm90aGVyQ2hhcmdlOwogICAgICAgICAgICB0aGlzLmxvYWRQcm9qZWN0QnlDdXN0b21lcigpOwogICAgICAgICAgICBpZiAodGhpcy5jdXN0b21lci5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgdGhpcy5sb2FkQ3VzdG9tZXJCYWxhbmNlKHRoaXMuY3VzdG9tZXIuaWQpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhZGRTZWxlY3QoKSB7CiAgICAgICAgICAgIGxldCBhbW91bnRfbnVtID0gdGhpcy5udW1TZWxlY3QubGVuZ3RoOwogICAgICAgICAgICBsZXQgbnVtID0gdGhpcy5udW1TZWxlY3RbYW1vdW50X251bSAtIDFdOwogICAgICAgICAgICBsZXQgbmV3X251bSA9IG51bSArIDE7CiAgICAgICAgICAgIGxldCBsZW5naHRJdGVtID0gdGhpcy5zcGVjaWZpY0Rpc2NvdW50SXRlbS5sZW5ndGg7CiAgICAgICAgICAgIGlmIChuZXdfbnVtIDw9IGxlbmdodEl0ZW0pIHsKICAgICAgICAgICAgICAgIHRoaXMubnVtU2VsZWN0LnB1c2gobmV3X251bSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHJlbW92ZVNlbGVjdChpbmRleCkgewogICAgICAgICAgICB0aGlzLm51bVNlbGVjdC5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coaW5kZXgsIHRoaXMubnVtU2VsZWN0KQogICAgICAgICAgICAvLyB0aGlzLnNlbGVjdERpc2NvdW50LnNwbGljZShpbmRleCwxKQogICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coInJlbW92ZSIsdGhpcy5zZWxlY3REaXNjb3VudCkKICAgICAgICAgICAgLy8gdGhpcy5zZWxlY3REaXNjb3VudCA9IHRoaXMuc2VsZWN0RGlzY291bnQuZmlsdGVyKGl0ZW0gPT4gIGl0ZW0uaWQgIT0gdmFsLmlkKTsKICAgICAgICB9LAogICAgICAgIGVycm9yTWVzc2FnZSgpIHsKICAgICAgICB9LAogICAgICAgIGFjY291bnREcm9wRG93bkVkaXRvcigpIHsKICAgICAgICB9LAogICAgICAgIGNhbmNlbCgpIHsKICAgICAgICAgICAgdGhpcy4kc3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogaTE4bi50KCJtc2dfdGl0bGVfd2FybmluZyIpLAogICAgICAgICAgICAgICAgdGV4dDogaTE4bi50KCJtc2dfZGlzY2FyZCIpLAogICAgICAgICAgICAgICAgaWNvbjogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IGkxOG4udCgiY2FuY2VsIiksCiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjNGQ0ODQ4IiwKICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI0VEMUEzQSIsCiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogaTE4bi50KCJkaXNjYXJkIiksCiAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIuZ28oLTEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGhpZGVfc21hbGxzaXRlYmFyKCkgewogICAgICAgICAgICB0aGlzLmlzSGlkZUJhciA9ICF0aGlzLmlzSGlkZUJhcjsKICAgICAgICB9LAogICAgICAgIC8vbnVtYmVyCiAgICAgICAgZ2VuZXJhdGVOdW1iZXIoKSB7CiAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZygnZ2VuZXJhdGVOdW1iZXInKQogICAgICAgICAgICBsZXQgZCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zdWJzdHIoMCwgMTApOwogICAgICAgICAgICBpZiAodGhpcy50cmFuc2FjdGlvbi50cmFuc2FjdGlvbkRhdGUpIHsKICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLnRyYW5zYWN0aW9uRGF0ZSkKICAgICAgICAgICAgICAgIGQgPSB0aGlzLnRyYW5zYWN0aW9uLnRyYW5zYWN0aW9uRGF0ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgZGF0YSA9IHsKICAgICAgICAgICAgICAgIGFiYnI6IHRoaXMudHJhbnNhY3Rpb24udHJhbnNhY3Rpb25UeXBlLmFiYnIsCiAgICAgICAgICAgICAgICBzdHJ1Y3R1cmU6IHRoaXMudHJhbnNhY3Rpb24udHJhbnNhY3Rpb25UeXBlLnN0cnVjdHVyZSwKICAgICAgICAgICAgICAgIHByZWZpeFNlcGFyYXRvcjogdGhpcy50cmFuc2FjdGlvbi50cmFuc2FjdGlvblR5cGUucHJlZml4U2VwYXJhdG9yIHx8ICcnLAogICAgICAgICAgICAgICAgbnVtYmVyU2VwYXJhdG9yOiB0aGlzLnRyYW5zYWN0aW9uLnRyYW5zYWN0aW9uVHlwZS5udW1iZXJTZXBhcmF0b3IgfHwgJycsCiAgICAgICAgICAgICAgICBmb3JtYXQ6IHRoaXMudHJhbnNhY3Rpb24udHJhbnNhY3Rpb25UeXBlLmZvcm1hdCB8fCA1LAogICAgICAgICAgICAgICAgc2VxdWNlbmNpbmc6IHRoaXMudHJhbnNhY3Rpb24udHJhbnNhY3Rpb25UeXBlLnNlcXVjZW5jaW5nLAogICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25EYXRlOiBkLAogICAgICAgICAgICAgICAgdHlwZTogIlNhbGUgUXVvdGUiLAogICAgICAgICAgICB9OwogICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIGJpbGxpbmdIYW5kbGVyCiAgICAgICAgICAgICAgICAubGFzdE51bWJlcihkYXRhKQogICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGFzdE51bWJlciA9IHRoaXMuemVyb1BhZCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlSW50KHJlcy5sYXN0TnVtYmVyKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24udHJhbnNhY3Rpb25UeXBlLmZvcm1hdAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBudW1iZXIgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnN1ZmZpeCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLnRyYW5zYWN0aW9uVHlwZS5udW1iZXJTZXBhcmF0b3IgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdE51bWJlcjsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5udW1iZXIgPSBudW1iZXI7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JzLnB1c2goZSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIHplcm9QYWQobnVtLCBwbGFjZXMpIHsKICAgICAgICAgICAgcmV0dXJuIFN0cmluZyhudW0pLnBhZFN0YXJ0KHBsYWNlcywgIjAiKTsKICAgICAgICB9LAogICAgICAgIC8vY3VzdG9tZXIKICAgICAgICBvbkNoYW5nZShldmVudCkgewogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coZXZlbnQsICdjdXN0b21lcicpOwogICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGV2ZW50LnZhbHVlOwogICAgICAgICAgICBpZiAodmFsdWUgJiYgdmFsdWVbdGV4dEZpZWxkXSA9PT0gZW1wdHlJdGVtW3RleHRGaWVsZF0pIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmN1c3RvbWVyID0gdmFsdWU7CiAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24uY3VzdG9tZXIgPSB2YWx1ZTsKICAgICAgICAgICAgLy8gdGhpcy5pbnZvaWNlID0gdmFsdWUKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHZhbHVlLCAnY3VzdG9tZXInKQogICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLnByaWNlTGV2ZWwgPSB2YWx1ZS5wcmljZUxldmVsID8gdmFsdWUucHJpY2VMZXZlbCA6IHt9CiAgICAgICAgICAgIHRoaXMuYmlsbGluZ0FkZHJlc3MgPSB2YWx1ZS5oYXNPd25Qcm9wZXJ0eSgiYmlsbGluZ0FkZHJlc3MiKQogICAgICAgICAgICAgICAgPyB2YWx1ZS5iaWxsaW5nQWRkcmVzcwogICAgICAgICAgICAgICAgOiBbXTsKICAgICAgICAgICAgdGhpcy5kZWxpdmVyeUFkZHJlc3MgPSB2YWx1ZS5oYXNPd25Qcm9wZXJ0eSgiZGVsaXZlcnlBZGRyZXNzIikKICAgICAgICAgICAgICAgID8gdmFsdWUuZGVsaXZlcnlBZGRyZXNzCiAgICAgICAgICAgICAgICA6IFtdOwogICAgICAgICAgICBpZiAodGhpcy5iaWxsaW5nQWRkcmVzcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLmJpbGxpbmdBZGRyZXNzID0gdGhpcy5iaWxsaW5nQWRkcmVzc1swXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5kZWxpdmVyeUFkZHJlc3MubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5kZWxpdmVyeUFkZHJlc3MgPSB0aGlzLmRlbGl2ZXJ5QWRkcmVzc1swXTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLm9uUXVvdGVEYXRlQ2hhbmdlZCgpOwogICAgICAgICAgICB0aGlzLmxvYWRQcm9qZWN0QnlDdXN0b21lcigpOwogICAgICAgICAgICBjb25zdCBwcmljZUxldmVsID0gdmFsdWUuaGFzT3duUHJvcGVydHkoInByaWNlTGV2ZWwiKQogICAgICAgICAgICAgICAgPyB2YWx1ZS5wcmljZUxldmVsCiAgICAgICAgICAgICAgICA6IHt9OwogICAgICAgICAgICBjb25zdCBiYXNlQ3VycmVuY3kgPSB2YWx1ZS5oYXNPd25Qcm9wZXJ0eSgiYmFzZUN1cnJlbmN5IikKICAgICAgICAgICAgICAgID8gdmFsdWUuYmFzZUN1cnJlbmN5CiAgICAgICAgICAgICAgICA6IHt9OwogICAgICAgICAgICBpZiAoYmFzZUN1cnJlbmN5Lmhhc093blByb3BlcnR5KCJjb2RlIikpIHsKICAgICAgICAgICAgICAgIHRoaXMuYmFzZUN1cnJlbmN5Q29kZSA9IGJhc2VDdXJyZW5jeS5jb2RlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChwcmljZUxldmVsLmhhc093blByb3BlcnR5KCJjdXJyZW5jeSIpKSB7CiAgICAgICAgICAgICAgICBpZiAocHJpY2VMZXZlbC5jdXJyZW5jeS5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZFRyYW5zYWN0aW9uUmF0ZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGNvbnN0IGNyZWRpdExpbWl0ID0gdmFsdWUuaGFzT3duUHJvcGVydHkoImNyZWRpdExpbWl0IikKICAgICAgICAgICAgLy8gICAgID8gdmFsdWUuY3JlZGl0TGltaXQKICAgICAgICAgICAgLy8gICAgIDogMDsKICAgICAgICAgICAgLy8gdGhpcy50cmFuc2FjdGlvbi5jcmVkaXRMaW1pdCA9IGtlbmRvLnBhcnNlRmxvYXQoY3JlZGl0TGltaXQpOwogICAgICAgICAgICAvLyB0aGlzLmxvYWRDdXN0b21lckJhbGFuY2UodGhpcy5jdXN0b21lci5pZCk7CiAgICAgICAgICAgIC8vIHRoaXMubG9hZFBheW1lbnRUZXJtTGlzdCgpOwogICAgICAgICAgICAvLyB0aGlzLmxvYWRDcmVkaXRMaW1pdCgpOwogICAgICAgIH0sCiAgICAgICAgb25GaWx0ZXJDaGFuZ2UoZXZlbnQpIHsKICAgICAgICAgICAgY29uc3QgZmlsdGVyID0gZXZlbnQuZmlsdGVyLnZhbHVlOwogICAgICAgICAgICB0aGlzLnJlcXVlc3REYXRhKDAsIGZpbHRlciwgdGhpcy5jdXNCYXNlVXJsKTsKICAgICAgICAgICAgdGhpcy5maWx0ZXIgPSBmaWx0ZXI7CiAgICAgICAgfSwKICAgICAgICByZXF1ZXN0RGF0YShza2lwLCBmaWx0ZXIsIGJhc2VVcmwpIHsKICAgICAgICAgICAgY29uc3QgdXJsID0gYmFzZVVybCArIGA/ZmlsdGVyPSR7ZmlsdGVyfWA7CiAgICAgICAgICAgIHRoaXMucmVxdWVzdFN0YXJ0ZWQgPSB0cnVlOwogICAgICAgICAgICBmZXRjaCh1cmwpCiAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC50aGVuKHRoaXMuYWZ0ZXJGZXRjaCk7CiAgICAgICAgfSwKICAgICAgICByZXF1ZXN0RGF0YV8oc2tpcCwgZmlsdGVyLCBiYXNlVXJsKSB7CiAgICAgICAgICAgIGNvbnN0IHVybCA9IGJhc2VVcmwgKyBgLyR7ZmlsdGVyfWA7CiAgICAgICAgICAgIHRoaXMucmVxdWVzdFN0YXJ0ZWQgPSB0cnVlOwogICAgICAgICAgICBmZXRjaCh1cmwpCiAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC50aGVuKHRoaXMuYWZ0ZXJGZXRjaF8pOwogICAgICAgIH0sCiAgICAgICAgYWZ0ZXJGZXRjaF8oanNvbikgewogICAgICAgICAgICB0aGlzLmVtcGxveWVlcyA9IGpzb24uZGF0YTsKICAgICAgICB9LAogICAgICAgIGFmdGVyRmV0Y2goanNvbikgewogICAgICAgICAgICB0aGlzLmN1c3RvbWVyTGlzdCA9IGpzb24uZGF0YTsKICAgICAgICB9LAogICAgICAgIHJlbW92ZVJvdyhlKSB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgY29uc3QgZ3JpZCA9IGtlbmRvLmpRdWVyeSgiI2dyaWRJdGVtTGluZVNhbGVRdW90ZSIpLmRhdGEoImtlbmRvR3JpZCIpLAogICAgICAgICAgICAgICAgZGF0YVNvdXJjZSA9IGdyaWQuZGF0YVNvdXJjZSwKICAgICAgICAgICAgICAgIGRhdGFJdGVtID0gZ3JpZC5kYXRhSXRlbSgkKGUuY3VycmVudFRhcmdldCkuY2xvc2VzdCgidHIiKSk7CgogICAgICAgICAgICBpZiAoZGF0YVNvdXJjZS50b3RhbCgpID4gMSkgewogICAgICAgICAgICAgICAgZGF0YVNvdXJjZS5yZW1vdmUoZGF0YUl0ZW0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpOwogICAgICAgIH0sCiAgICAgICAgLy9kYXRlCiAgICAgICAgYXN5bmMgb25RdW90ZURhdGVDaGFuZ2VkKCkgewogICAgICAgICAgICBpZiAodGhpcy50cmFuc2FjdGlvbikgewogICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5tb250aE9mID0gbmV3IERhdGUodGhpcy50cmFuc2FjdGlvbi50cmFuc2FjdGlvbkRhdGUpLnRvSVNPU3RyaW5nKCkuc3Vic3RyKDAsIDcpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXdhaXQgdGhpcy5sb2FkUGF5bWVudFRlcm1MaXN0KCk7CiAgICAgICAgICAgIGF3YWl0IHRoaXMubG9hZENyZWRpdExpbWl0KCk7CiAgICAgICAgICAgIGF3YWl0IHRoaXMubG9hZEN1c3RvbWVyQmFsYW5jZSh0aGlzLmN1c3RvbWVyLmlkKTsKICAgICAgICAgICAgYXdhaXQgdGhpcy5vblByaWNlTGV2ZWxDaGFuZ2UoKTsKICAgICAgICAgICAgaWYgKHRoaXMuY3VzdG9tZXIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBheW1lbnRUZXJtID0gdGhpcy5jdXN0b21lci5wYXltZW50VGVybSB8fCB7fQogICAgICAgICAgICAgICAgY29uc3QgbmV0RHVlID0gcGF5bWVudFRlcm0ubmV0RHVlOwogICAgICAgICAgICAgICAgbGV0IHNvbWVEYXRlID0gbmV3IERhdGUodGhpcy50cmFuc2FjdGlvbi50cmFuc2FjdGlvbkRhdGUpOwogICAgICAgICAgICAgICAgc29tZURhdGUuc2V0RGF0ZShzb21lRGF0ZS5nZXREYXRlKCkgKyBwYXJzZUludChuZXREdWUpKTsgLy9udW1iZXIgIG9mIGRheXMgdG8gYWRkLCBlLnguIDE1IGRheXMKICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyhzb21lRGF0ZSwgJ3RoaXMudHJhbnNhY3Rpb24udmFsaWRpdHlEYXRlICcpCiAgICAgICAgICAgICAgICAvLyB0aGlzLnRyYW5zYWN0aW9uLnZhbGlkaXR5RGF0ZSA9IHNvbWVEYXRlLnRvSVNPU3RyaW5nKCkuc3Vic3RyKDAsIDEwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZygib25RdW90ZURhdGVDaGFuZ2VkIik7CiAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlTnVtYmVyKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIC8vZW1wbG95ZWUKICAgICAgICBvbkVtcGxveWVlQ2hhbmdlZChldmVudCkgewogICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGV2ZW50LnZhbHVlOwogICAgICAgICAgICBpZiAodmFsdWUgJiYgdmFsdWVbdGV4dEZpZWxkXSA9PT0gZW1wdHlJdGVtW3RleHRGaWVsZF0pIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLm1FbXBsb3llZSA9IHZhbHVlOwogICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLmVtcGxveWVlID0gdmFsdWU7CiAgICAgICAgfSwKICAgICAgICBvbkVtcGxveWVlRmlsdGVyQ2hhbmdlZChldmVudCkgewogICAgICAgICAgICBjb25zdCBmaWx0ZXIgPSBldmVudC5maWx0ZXIudmFsdWU7CiAgICAgICAgICAgIHRoaXMucmVxdWVzdERhdGFfKDAsIGZpbHRlciwgdGhpcy5lbXBCYXNlVXJsKTsKICAgICAgICAgICAgdGhpcy5maWx0ZXJfID0gZmlsdGVyOwogICAgICAgIH0sCiAgICAgICAgb25QYXltZW50VGVybUNoYW5nZWQoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmN1c3RvbWVyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwYXltZW50VGVybSA9IHRoaXMudHJhbnNhY3Rpb24ucGF5bWVudFRlcm0gfHwge30KICAgICAgICAgICAgICAgIGNvbnN0IG5ldER1ZSA9IHBheW1lbnRUZXJtLm5ldER1ZSB8fCAwOwogICAgICAgICAgICAgICAgY29uc3Qgc29tZURhdGUgPSBuZXcgRGF0ZSh0aGlzLnRyYW5zYWN0aW9uLnRyYW5zYWN0aW9uRGF0ZSk7CiAgICAgICAgICAgICAgICBzb21lRGF0ZS5zZXREYXRlKHNvbWVEYXRlLmdldERhdGUoKSArIHBhcnNlSW50KG5ldER1ZSkpOyAvL251bWJlciAgb2YgZGF5cyB0byBhZGQsIGUueC4gMTUgZGF5cwogICAgICAgICAgICAgICAgLy8gdGhpcy50cmFuc2FjdGlvbi52YWxpZGl0eURhdGUgPSBzb21lRGF0ZS50b0lTT1N0cmluZygpLnN1YnN0cigwLCAxMCkKICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZygiaW0iLCBzb21lRGF0ZSwgbmV0RHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyB0aGlzLm9uUXVvdGVEYXRlQ2hhbmdlZCgpOwogICAgICAgIH0sCiAgICAgICAgLy9udW1iZXIKICAgICAgICBudW1iZXJGb3JtYXQodmFsdWUpIHsKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKHRoaXMuc2FsZUZvcm1Db250ZW50LmRlY2ltYWwsJ25pbW9sJykKICAgICAgICAgICAgcmV0dXJuIGtlbmRvLnRvU3RyaW5nKHZhbHVlLCBgbiR7dGhpcy5zYWxlRm9ybUNvbnRlbnQuZGVjaW1hbH1gKTsKICAgICAgICAgICAgLy8gcmV0dXJuIHZhbHVlCiAgICAgICAgfSwKICAgICAgICAvLwogICAgICAgIGFzeW5jIGxvYWRMZWFkKCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJGaWx0ZXIgPSAiP3R5cGU9U2FsZSBMZWFkIjsKICAgICAgICAgICAgICAgICAgICBiaWxsaW5nSGFuZGxlci5saXN0KHN0ckZpbHRlcikudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGxlYWQgPSByZXMuZGF0YS5kYXRhLmZpbHRlcigob2JqKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqLnN0YXR1cyAhPSAwOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxlYWQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sZWFkcyA9IGxlYWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkUGF5bWVudFRlcm0oKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIHBheW1lbnRUZXJtSGFuZGxlci5nZXRBbGwoKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBheW1lbnRUZXJtcyA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBheW1lbnRUZXJtcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGUucGFyYW1zLmlkICE9PSB1bmRlZmluZWQgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgIT0gIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24ucGF5bWVudFRlcm0gPSB0aGlzLnBheW1lbnRUZXJtc1swXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIG9uUHJpY2VMZXZlbENoYW5nZSgpIHsKICAgICAgICAgICAgdGhpcy5pc1ByaWNlTGV2ZWxDaGFuZ2VkID0gdHJ1ZQogICAgICAgICAgICB0aGlzLmxvYWRUcmFuc2FjdGlvblJhdGUoKQogICAgICAgICAgICB0aGlzLmNsZWFyVU9NSXRlbSgpCiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkUHJpY2VMZXZlbCgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyRmlsdGVyID0gJz9uYXR1cmU9c2FsZScKICAgICAgICAgICAgICAgICAgICBwcmljZUxldmVsSGFuZGxlci5nZXQoc3RyRmlsdGVyKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmljZUxldmVsID0gcmVzOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmljZUxldmVsLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgIT09IHVuZGVmaW5lZCB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlLnBhcmFtcy5pZCAhPSAiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy50cmFuc2FjdGlvbi5wcmljZUxldmVsID0gdGhpcy5wcmljZUxldmVsWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZFRyYW5zYWN0aW9uUmF0ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgcmVtb3ZlRHVwbGljYXRlKGFycmF5KSB7CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IFtdOwogICAgICAgICAgICBjb25zdCBtYXAgPSBuZXcgTWFwKCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBhcnJheSkgewogICAgICAgICAgICAgICAgaWYgKCFtYXAuaGFzKGl0ZW0uaWQpKSB7CiAgICAgICAgICAgICAgICAgICAgbWFwLnNldChpdGVtLmlkLCB0cnVlKTsgLy8gc2V0IGFueSB2YWx1ZSB0byBNYXAKICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChpdGVtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0sCiAgICAgICAgYXV0b0NhbGN1bGF0ZURpc2NvdW50KGRpc2NvdW50SXRlbSwgc3ViVG90YWwpIHsKICAgICAgICAgICAgaWYgKGRpc2NvdW50SXRlbSkgewogICAgICAgICAgICAgICAgY29uc3QgbmF0dXJlID0gZGlzY291bnRJdGVtLm5hdHVyZSB8fCAnJwogICAgICAgICAgICAgICAgY29uc3QgYW1vdW50ID0gZGlzY291bnRJdGVtLmFtb3VudCB8fCAwCiAgICAgICAgICAgICAgICBpZiAobmF0dXJlID09PSAnQW1vdW50JykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KGFtb3VudCkKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobmF0dXJlID09PSAnUGVyY2VudGFnZScpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHN1YlRvdGFsICogKHBhcnNlRmxvYXQoYW1vdW50KSAvIDEwMCkpCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMAogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhdXRvQ2FsY3VsYXRlVGF4KHRheCwgYW1vdW50KSB7CiAgICAgICAgICAgIGlmICh0YXgpIHsKICAgICAgICAgICAgICAgIHZhciBmb3JtdWxhID0gdGF4LmZvcm11bGE7CiAgICAgICAgICAgICAgICB2YXIgaW5BbXQgPSBrZW5kby5wYXJzZUZsb2F0KGFtb3VudCk7CiAgICAgICAgICAgICAgICB2YXIgbkFtdCA9IGtlbmRvLnBhcnNlRmxvYXQoYW1vdW50KTsKICAgICAgICAgICAgICAgIHZhciB0YXhCYXNlID0ga2VuZG8ucGFyc2VGbG9hdCh0YXgudGF4QmFzZSkgLyAxMDA7CiAgICAgICAgICAgICAgICB2YXIgcmF0ZSA9IGtlbmRvLnBhcnNlRmxvYXQodGF4LnJhdGUpIC8gMTAwOwogICAgICAgICAgICAgICAgdmFyIHRvdGFsID0gZXZhbChmb3JtdWxhKTsKICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhpbkFtdCwgbkFtdCwgdGF4QmFzZSwgcmF0ZSwgZm9ybXVsYSwgdG90YWwpOwogICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKGFtb3VudCkKICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbDsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyByZXR1cm4gMAogICAgICAgIH0sCiAgICAgICAgYXV0b0NhbGN1bGF0ZVRheEJ5VHlwZSh0YXgpIHsKICAgICAgICAgICAgLy8gcmV0dXJuIGJ5IGEga2V5CiAgICAgICAgICAgIGNvbnN0IGdyb3VwQWxsID0gKGxpc3QpID0+CiAgICAgICAgICAgICAgICBsaXN0LnJlZHVjZSgodGF4LCBpdGVtKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGF4QW1vdW50ID0gdGF4W2l0ZW0ubmFtZV0gfHwgMDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgdGF4LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFtpdGVtLm5hbWVdOiB0YXhBbW91bnQgKyBwYXJzZUZsb2F0KGl0ZW0uYW1vdW50KSwKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sIHt9KTsKICAgICAgICAgICAgdGhpcy50YXhMaXN0VG90YWwgPSBncm91cEFsbCh0YXgpOwogICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coJ25pbW9sJywgZ3JvdXBBbGwodGF4KSkKICAgICAgICAgICAgLy8gdGhpcy4KICAgICAgICB9LAogICAgICAgIHRheE1hcHBpbmcob2JqVGF4LCB0YXgpIHsKICAgICAgICAgICAgY29uc3QgdGF4SWQgPSB0YXguaWQgfHwgJycKICAgICAgICAgICAgY29uc3QgdGF4XyA9IG9ialRheC5maWx0ZXIodCA9PiB0LmlkID09PSB0YXhJZClbMF0KICAgICAgICAgICAgcmV0dXJuIHRheF8gfHwgewogICAgICAgICAgICAgICAgaWQ6ICcnLAogICAgICAgICAgICAgICAgZGVmYXVsdFRheDogJycKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZGF0YVNvdXJjZUNoYW5nZWQoZSkgewogICAgICAgICAgICBpZiAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgbGV0IGRhdGFSb3cgPSBlLml0ZW1zWzBdLCB2VGF4ID0ge30sIHNwVGF4ID0ge30sIG90VGF4ID0ge30sIHBsVGF4ID0ge30sCiAgICAgICAgICAgICAgICAgICAgYnVvbSA9IHt9LAogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNpb25SYXRlID0gMSwKICAgICAgICAgICAgICAgICAgICB3YWMgPSAwLAogICAgICAgICAgICAgICAgICAgIHFvaCA9IDAsCiAgICAgICAgICAgICAgICAgICAgYW1vdW50ID0gMCwKICAgICAgICAgICAgICAgICAgICB4QW1vdW50ID0gMDsKICAgICAgICAgICAgICAgIHN3aXRjaCAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgIml0ZW0iOgogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmF0dHJpYnV0ZV8gPSB0aGlzLmF0dHJpYnV0ZXMuZmlsdGVyKG0gPT4gbS50eXBlLmlkID09PSBkYXRhUm93LnZhcmlhbnQuaWQpCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJkZXNjcmlwdGlvbiIsIGRhdGFSb3cuaXRlbS5kZXNjcmlwdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGJ1b20gPSBkYXRhUm93Lml0ZW0udW9tIHx8IHt9OwogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiYnVvbSIsIGJ1b20pOwogICAgICAgICAgICAgICAgICAgICAgICAvLyBkYXRhUm93LnNldCgndW9tJywgYnVvbSkKICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKGRhdGFSb3cuaXRlbSwncm93JykKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXdhaXQgdGhpcy5pbnZlbnRvcnlCYWxhbmNlKGRhdGFSb3csIGRhdGFSb3cuaXRlbS5pZCkKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAicHJpY2UiOgogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50ID0gcGFyc2VGbG9hdChkYXRhUm93LnByaWNlKSAqIHBhcnNlRmxvYXQoZGF0YVJvdy5xdHkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgeEFtb3VudCA9IGFtb3VudCAqIHBhcnNlRmxvYXQodGhpcy50cmFuc2FjdGlvbi50eG5SYXRlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgicHJpY2UiLCBwYXJzZUZsb2F0KGRhdGFSb3cucHJpY2UpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJhbW91bnQiLCBhbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImV4Y2hhbmdlQW1vdW50IiwgeEFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coJ3ByaWNlJyxkYXRhUm93LnByaWNlKQogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJwcmljZSIsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImFtb3VudCIsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImV4Y2hhbmdlQW1vdW50IiwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAidW9tIjoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNQcmljZUxldmVsQ2hhbmdlZCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVvbSA9IGRhdGFSb3cudW9tLmJ1b20gfHwge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcW9oID0gZGF0YVJvdy51b20ucW9oIHx8IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2lvblJhdGUgPSBkYXRhUm93LnVvbS5jb252ZXJzaW9uUmF0ZSB8fCAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhYyA9IGRhdGFSb3cudW9tLndhYyB8fCAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJidW9tIiwgYnVvbSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoIndhYyIsIHdhYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoInFvaCIsIHFvaCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNvbnZlcnNpb25SYXRlIiwgcGFyc2VGbG9hdChjb252ZXJzaW9uUmF0ZSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIHRvZG86IG1hcHBpbmcgdGF4IG9iamVjdCAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZUYXggPSB0aGlzLnRheE1hcHBpbmcodGhpcy52YXRUYXgsIGRhdGFSb3cudW9tLnZhdFRheCB8fCB7fSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdFRheCA9IHRoaXMudGF4TWFwcGluZyh0aGlzLm90aGVyVGF4LCBkYXRhUm93LnVvbS5vdGhlclRheCB8fCB7fSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcFRheCA9IHRoaXMudGF4TWFwcGluZyh0aGlzLnNwZWNpZmljVGF4LCBkYXRhUm93LnVvbS5zcGVjaWZpY1RheCB8fCB7fSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbFRheCA9IHRoaXMudGF4TWFwcGluZyh0aGlzLnB1YmxpY0xpZ2h0aW5nVGF4LCBkYXRhUm93LnVvbS5wdWJsaWNMaWdodGluZ1RheCB8fCB7fSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoInZhdFRheCIsIHZUYXgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJzcGVjaWZpY1RheCIsIG90VGF4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgib3RoZXJUYXgiLCBzcFRheCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoInB1YmxpY0xpZ2h0aW5nVGF4IiwgcGxUYXgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVJvdy51b20pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50ID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQoZGF0YVJvdy51b20ucHJpY2UpICogcGFyc2VGbG9hdChkYXRhUm93LnF0eSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhBbW91bnQgPSBhbW91bnQgKiBwYXJzZUZsb2F0KHRoaXMudHJhbnNhY3Rpb24udHhuUmF0ZSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgicHJpY2UiLCBwYXJzZUZsb2F0KGRhdGFSb3cudW9tLnByaWNlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJhbW91bnQiLCBhbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiZXhjaGFuZ2VBbW91bnQiLCB4QW1vdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQgPSBwYXJzZUZsb2F0KGRhdGFSb3cucHJpY2UpICogcGFyc2VGbG9hdChkYXRhUm93LnF0eSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhBbW91bnQgPSBhbW91bnQgKiBwYXJzZUZsb2F0KHRoaXMudHJhbnNhY3Rpb24udHhuUmF0ZSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgicHJpY2UiLCBwYXJzZUZsb2F0KGRhdGFSb3cucHJpY2UpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImFtb3VudCIsIGFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJleGNoYW5nZUFtb3VudCIsIHhBbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygiZXJyb3IiLCBlcnIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJidW9tIiwge30pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjb252ZXJzaW9uUmF0ZSIsIDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJwcmljZSIsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJxb2giLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgid2FjIiwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImFtb3VudCIsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJleGNoYW5nZUFtb3VudCIsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgInF0eSI6CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQgPSBwYXJzZUZsb2F0KGRhdGFSb3cucHJpY2UpICogcGFyc2VGbG9hdChkYXRhUm93LnF0eSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4QW1vdW50ID0gYW1vdW50ICogcGFyc2VGbG9hdCh0aGlzLnRyYW5zYWN0aW9uLnR4blJhdGUpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJwcmljZSIsIHBhcnNlRmxvYXQoZGF0YVJvdy5wcmljZSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImFtb3VudCIsIGFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiZXhjaGFuZ2VBbW91bnQiLCB4QW1vdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgicHJpY2UiLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJhbW91bnQiLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJleGNoYW5nZUFtb3VudCIsIDApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgIm90aGVyVGF4IjoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKCItLSIsIGRhdGFSb3cpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGUuZmllbGQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmF1dG9DYWxjdWxhdGUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgLy8gaXRlbUNoYW5nZShkYXRhSXRlbSl7CiAgICAgICAgLy8gICAgIHdpbmRvdy5jb25zb2xlLmxvZyhkYXRhSXRlbSkKICAgICAgICAvLyAgICAgdGhpcy5sb2FkVU9NYnlJdGVtKGRhdGFJdGVtLmlkKQogICAgICAgIC8vICAgICAvLyB1b21QcmljZUhhbmRsZXIuZ2V0VVJMKG9wdGlvbnMubW9kZWwuaXRlbS5pZCwgdGhpcy5xdW90ZS5wcmljZUxldmVsLmlkKSwKICAgICAgICAvLyB9LAogICAgICAgIC8vIGxvYWRVT01ieUl0ZW0oaXRlbSkgewogICAgICAgIC8vICAgICAvLyB1b21QcmljZUhhbmRsZXIuZ2V0VVJMKGl0ZW0sIHRoaXMucXVvdGUucHJpY2VMZXZlbC5pZCkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgLy8gICAgIC8vICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAvLyAgICAgLy8gICAgICAgICBjb25zdCByZXMgPSByZXNwb25zZS5kYXRhLmRhdGEKICAgICAgICAvLyAgICAgLy8gICAgICAgICB3aW5kb3cuY29uc29sZS5sb2cocmVzKTsKICAgICAgICAvLyAgICAgLy8gICAgICAgICAvLyBjb25zdCBsYXN0TnVtYmVyID0gdGhpcy56ZXJvUGFkKHBhcnNlSW50KHJlcy5sYXN0TnVtYmVyKSwgdGhpcy5xdW90ZS5wcmVmaXguZm9ybWF0KQogICAgICAgIC8vICAgICAvLyAgICAgICAgIC8vIGNvbnN0IG51bWJlciA9IHJlcy5zdWZmaXggKyB0aGlzLnF1b3RlLnByZWZpeC5udW1iZXJTZXBhcmF0b3IgKyBsYXN0TnVtYmVyCiAgICAgICAgLy8gICAgIC8vICAgICAgICAgLy8gdGhpcy5xdW90ZS5udW1iZXIgPSBudW1iZXIKICAgICAgICAvLyAgICAgLy8gICAgIH0KICAgICAgICAvLyAgICAgLy8gfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgLy8gICAgIC8vICAgICB0aGlzLmVycm9ycy5wdXNoKGUpCiAgICAgICAgLy8gICAgIC8vIH0pCiAgICAgICAgLy8gICAgIC8vIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICAgIC8vICAgICAvLyAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgLy8gICAgIC8vICAgICAgICAgcmVzb2x2ZSgncmVzb2x2ZWQnKTsKICAgICAgICAvLyAgICAgLy8gICAgICAgICB1b21QcmljZUhhbmRsZXIuZ2V0VVJMKGl0ZW0sIHRoaXMucXVvdGUucHJpY2VMZXZlbC5pZCkudGhlbihyZXMgPT4gewogICAgICAgIC8vICAgICAvLyAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgLy8gICAgIC8vICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gcmVzLmRhdGEuZGF0YQogICAgICAgIC8vICAgICAvLyAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKGRhdGEpOwogICAgICAgIC8vICAgICAvLyAgICAgICAgICAgICB9CiAgICAgICAgLy8gICAgIC8vICAgICAgICAgfSkKICAgICAgICAvLyAgICAgLy8gICAgIH0sIDEwKQogICAgICAgIC8vICAgICAvLyB9KQogICAgICAgIC8vIH0sCiAgICAgICAgYXV0b0NhbGN1bGF0ZSgpIHsKICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5zYWxlUXVvdGVJdGVtTGluZURTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICBzdWJUb3RhbCA9IDAsCiAgICAgICAgICAgICAgICB0b3RhbFRheCA9IDAsCiAgICAgICAgICAgICAgICBkaXNjb3VudFRvdGFsID0gMCwKICAgICAgICAgICAgICAgIHNwVGF4ID0gMCwKICAgICAgICAgICAgICAgIHBsdGF4ID0gMCwKICAgICAgICAgICAgICAgIG90aGVyVGF4ID0gMCwKICAgICAgICAgICAgICAgIHZhdFRheCA9IDAsCiAgICAgICAgICAgICAgICBkaXNjb3VudEludm9pY2UgPSAwLAogICAgICAgICAgICAgICAgdGF4TGlzdCA9IFtdLAogICAgICAgICAgICAgICAgZGlzY291bnRJdGVtID0gW10sCiAgICAgICAgICAgICAgICBzYWxlVW5pdCA9IFtdLAogICAgICAgICAgICAgICAgaW5jbHVzaXZlVGF4ID0gMCwKICAgICAgICAgICAgICAgIGl0ZW1TdWJ0b3RhbCA9IDAsCiAgICAgICAgICAgICAgICB0eG5JdG1TdWJ0b3RhbCA9IDAsCiAgICAgICAgICAgICAgICBzZXJ2aWNlU3VidG90YWwgPSAwLAogICAgICAgICAgICAgICAgaXRlbURpc2NvdW50ID0gMCwKICAgICAgICAgICAgICAgIHNlcnZpY2VEaXNjb3VudCA9IDAsCiAgICAgICAgICAgICAgICB0eG5EaXNjb3VudCA9IDA7CiAgICAgICAgICAgIGNvbnN0IHJvd3MgPSBkcy5kYXRhKCkuZmlsdGVyKChtKSA9PiBwYXJzZUZsb2F0KG0uYW1vdW50KSA+IDApOwogICAgICAgICAgICByb3dzLmZvckVhY2goKHZhbHVlKSA9PiB7CiAgICAgICAgICAgICAgICBsZXQgbW9kaWZpZXJQcmljZSA9IDA7CiAgICAgICAgICAgICAgICBpZiAodmFsdWUubW9kaWZpZXIpIHsKICAgICAgICAgICAgICAgICAgICBtb2RpZmllclByaWNlID0ga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5tb2RpZmllci5wcmljZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gc3ViVG90YWwgKz0gKGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuYW1vdW50KSArIG1vZGlmaWVyUHJpY2UpCiAgICAgICAgICAgICAgICBsZXQgZGlzY291bnQgPSAwOwogICAgICAgICAgICAgICAgaWYgKHZhbHVlLmRpc2NvdW50SXRlbSkgewogICAgICAgICAgICAgICAgICAgIGxldCBzdWJUbyA9CiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucHJpY2UpICoga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5xdHkpOwogICAgICAgICAgICAgICAgICAgIGRpc2NvdW50ID0gdGhpcy5hdXRvQ2FsY3VsYXRlRGlzY291bnQodmFsdWUuZGlzY291bnRJdGVtLCBzdWJUbyk7CiAgICAgICAgICAgICAgICAgICAgZGlzY291bnQgPSB0aGlzLmF1dG9DYWxjdWxhdGVEaXNjb3VudCh2YWx1ZS5kaXNjb3VudEl0ZW0sIHN1YlRvKTsKICAgICAgICAgICAgICAgICAgICB2YWx1ZVsiZGlzY291bnRBbW91bnQiXSA9IGRpc2NvdW50OwogICAgICAgICAgICAgICAgICAgIHZhbHVlWyJkaXNjb3VudEV4Y2hhbmdlQW1vdW50Il0gPQogICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy50cmFuc2FjdGlvbi50eG5SYXRlKTsKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuZGlzY291bnRJdGVtLmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50SXRlbS5wdXNoKHZhbHVlLmRpc2NvdW50SXRlbSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRpc2NvdW50VG90YWwgKz0gZGlzY291bnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodmFsdWUuc2FsZVVuaXQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuc2FsZVVuaXQuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2FsZVVuaXQucHVzaCh2YWx1ZS5zYWxlVW5pdCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHZhbHVlLnNwZWNpZmljVGF4KSB7CiAgICAgICAgICAgICAgICAgICAgc3BUYXggPSB0aGlzLmF1dG9DYWxjdWxhdGVUYXgoCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLnNwZWNpZmljVGF4LAogICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmFtb3VudCkgLSBrZW5kby5wYXJzZUZsb2F0KGRpc2NvdW50KQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKCdzcCAnLCBkaXNjb3VudCkKICAgICAgICAgICAgICAgICAgICBzcFRheCA9IGtlbmRvLnBhcnNlRmxvYXQoc3BUYXgpID8ga2VuZG8ucGFyc2VGbG9hdChzcFRheCkgOiAwOwogICAgICAgICAgICAgICAgICAgIHZhbHVlWyJzcGVjaWZpY1RheEFtb3VudCJdID0gc3BUYXg7CiAgICAgICAgICAgICAgICAgICAgdmFsdWVbInNwZWNpZmljVGF4RXhjaGFuZ2VBbW91bnQiXSA9CiAgICAgICAgICAgICAgICAgICAgICAgIHNwVGF4ICoga2VuZG8ucGFyc2VGbG9hdCh0aGlzLnRyYW5zYWN0aW9uLnR4blJhdGUpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRheCA9IHZhbHVlLnNwZWNpZmljVGF4OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhc2VBbW91bnQgPSB0YXguYmFzZUFtb3VudDsKICAgICAgICAgICAgICAgICAgICBpZiAoYmFzZUFtb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmFzZUFtb3VudC50b0xvd2VyQ2FzZSgpID09PSAiaW5jbHVzaXZlIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5jbHVzaXZlVGF4ICs9IHNwVGF4OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5zcGVjaWZpY1RheC5oYXNPd25Qcm9wZXJ0eSgidGF4VHlwZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRheExpc3QucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB2YWx1ZS5zcGVjaWZpY1RheC50YXhUeXBlLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IHNwVGF4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHZhbHVlLnNwZWNpZmljVGF4LnRheFR5cGUuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5wdWJsaWNMaWdodGluZ1RheCkgewogICAgICAgICAgICAgICAgICAgIHBsdGF4ID0gdGhpcy5hdXRvQ2FsY3VsYXRlVGF4KAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZS5wdWJsaWNMaWdodGluZ1RheCwKICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5hbW91bnQpIC0ga2VuZG8ucGFyc2VGbG9hdChkaXNjb3VudCkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIHBsdGF4ID0ga2VuZG8ucGFyc2VGbG9hdChwbHRheCkgPyBrZW5kby5wYXJzZUZsb2F0KHBsdGF4KSA6IDA7CiAgICAgICAgICAgICAgICAgICAgdmFsdWVbInB1YmxpY0xpZ2h0aW5nVGF4QW1vdW50Il0gPSBwbHRheDsKICAgICAgICAgICAgICAgICAgICB2YWx1ZVsicHVibGljTGlnaHRpbmdUYXhFeGNoYW5nZUFtb3VudCJdID0KICAgICAgICAgICAgICAgICAgICAgICAgcGx0YXggKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMudHJhbnNhY3Rpb24udHhuUmF0ZSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGF4ID0gdmFsdWUucHVibGljTGlnaHRpbmdUYXg7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFzZUFtb3VudCA9IHRheC5iYXNlQW1vdW50OwogICAgICAgICAgICAgICAgICAgIGlmIChiYXNlQW1vdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiYXNlQW1vdW50LnRvTG93ZXJDYXNlKCkgPT09ICJpbmNsdXNpdmUiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNsdXNpdmVUYXggKz0gcGx0YXg7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnB1YmxpY0xpZ2h0aW5nVGF4Lmhhc093blByb3BlcnR5KCJ0YXhUeXBlIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGF4TGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHZhbHVlLnB1YmxpY0xpZ2h0aW5nVGF4LnRheFR5cGUubmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogcGx0YXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogdmFsdWUucHVibGljTGlnaHRpbmdUYXgudGF4VHlwZS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHZhbHVlLm90aGVyVGF4KSB7CiAgICAgICAgICAgICAgICAgICAgb3RoZXJUYXggPSB0aGlzLmF1dG9DYWxjdWxhdGVUYXgoCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLm90aGVyVGF4LAogICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmFtb3VudCkgLSBrZW5kby5wYXJzZUZsb2F0KGRpc2NvdW50KQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgb3RoZXJUYXggPSBrZW5kby5wYXJzZUZsb2F0KG90aGVyVGF4KQogICAgICAgICAgICAgICAgICAgICAgICA/IGtlbmRvLnBhcnNlRmxvYXQob3RoZXJUYXgpCiAgICAgICAgICAgICAgICAgICAgICAgIDogMDsKICAgICAgICAgICAgICAgICAgICB2YWx1ZVsib3RoZXJUYXhBbW91bnQiXSA9IG90aGVyVGF4OwogICAgICAgICAgICAgICAgICAgIHZhbHVlWyJvdGhlclRheEV4Y2hhbmdlQW1vdW50Il0gPQogICAgICAgICAgICAgICAgICAgICAgICBvdGhlclRheCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy50cmFuc2FjdGlvbi50eG5SYXRlKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXggPSB2YWx1ZS5wdWJsaWNMaWdodGluZ1RheDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiYXNlQW1vdW50ID0gdGF4LmJhc2VBbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKGJhc2VBbW91bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJhc2VBbW91bnQudG9Mb3dlckNhc2UoKSA9PT0gImluY2x1c2l2ZSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluY2x1c2l2ZVRheCArPSBvdGhlclRheDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUub3RoZXJUYXguaGFzT3duUHJvcGVydHkoInRheFR5cGUiKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0YXhMaXN0LnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdmFsdWUub3RoZXJUYXgudGF4VHlwZS5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBvdGhlclRheCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB2YWx1ZS5vdGhlclRheC50YXhUeXBlLmlkLAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHZhbHVlLnZhdFRheCkgewogICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZygnVmF0IFRheCcsIHZhbHVlLnZhdFRheCkKICAgICAgICAgICAgICAgICAgICBsZXQgYW10ID0KICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdChzcFRheCA/IHNwVGF4IDogMCkgKwogICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHBsdGF4ID8gcGx0YXggOiAwKSArCiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQob3RoZXJUYXggPyBvdGhlclRheCA6IDApICsKICAgICAgICAgICAgICAgICAgICAgICAgKGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuYW1vdW50ID8gdmFsdWUuYW1vdW50IDogMCkgLQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGRpc2NvdW50ID8gZGlzY291bnQgOiAwKSk7CiAgICAgICAgICAgICAgICAgICAgdmF0VGF4ID0gdGhpcy5hdXRvQ2FsY3VsYXRlVGF4KHZhbHVlLnZhdFRheCwgYW10KTsKICAgICAgICAgICAgICAgICAgICB2YXRUYXggPSBrZW5kby5wYXJzZUZsb2F0KHZhdFRheCkgPyBrZW5kby5wYXJzZUZsb2F0KHZhdFRheCkgOiAwOwogICAgICAgICAgICAgICAgICAgIHZhbHVlWyJ2YXRUYXhBbW91bnQiXSA9IHZhdFRheDsKICAgICAgICAgICAgICAgICAgICB2YWx1ZVsidmF0VGF4RXhjaGFuZ2VBbW91bnQiXSA9CiAgICAgICAgICAgICAgICAgICAgICAgIHZhdFRheCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy50cmFuc2FjdGlvbi50eG5SYXRlKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXggPSB2YWx1ZS52YXRUYXg7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFzZUFtb3VudCA9IHRheC5iYXNlQW1vdW50OwogICAgICAgICAgICAgICAgICAgIGlmIChiYXNlQW1vdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiYXNlQW1vdW50LnRvTG93ZXJDYXNlKCkgPT09ICJpbmNsdXNpdmUiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNsdXNpdmVUYXggKz0gdmF0VGF4OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS52YXRUYXguaGFzT3duUHJvcGVydHkoInRheFR5cGUiKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0YXhMaXN0LnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdmFsdWUudmF0VGF4LnRheFR5cGUubmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogdmF0VGF4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHZhbHVlLnZhdFRheC50YXhUeXBlLmlkLAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0b3RhbFRheCArPQogICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQoc3BUYXggPyBzcFRheCA6IDApICsKICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHBsdGF4ID8gcGx0YXggOiAwKSArCiAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdChvdGhlclRheCA/IG90aGVyVGF4IDogMCkgKwogICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodmF0VGF4ID8gdmF0VGF4IDogMCk7CiAgICAgICAgICAgICAgICBzdWJUb3RhbCArPQogICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuYW1vdW50KSArIG1vZGlmaWVyUHJpY2UgLSBpbmNsdXNpdmVUYXg7CgogICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IHZhbHVlLml0ZW07CiAgICAgICAgICAgICAgICBjb25zdCBpdG1UeXBlID0gaXRlbS50eXBlIHx8ICIiOwogICAgICAgICAgICAgICAgaWYgKGl0bVR5cGUgPT09ICJWYXJpYW50IikgewogICAgICAgICAgICAgICAgICAgIGl0ZW1TdWJ0b3RhbCArPQogICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmNvc3QpICoga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5xdHkpOwogICAgICAgICAgICAgICAgICAgIGl0ZW1EaXNjb3VudCArPSBrZW5kby5wYXJzZUZsb2F0KGRpc2NvdW50KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRtVHlwZSA9PT0gIlNlcnZpY2UiKSB7CiAgICAgICAgICAgICAgICAgICAgc2VydmljZVN1YnRvdGFsICs9CiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuY29zdCkgKiBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnF0eSk7CiAgICAgICAgICAgICAgICAgICAgaXRlbURpc2NvdW50ICs9IGtlbmRvLnBhcnNlRmxvYXQoZGlzY291bnQpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0eG5JdG1TdWJ0b3RhbCArPQogICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmNvc3QpICoga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5xdHkpOwogICAgICAgICAgICAgICAgICAgIGl0ZW1EaXNjb3VudCArPSBrZW5kby5wYXJzZUZsb2F0KGRpc2NvdW50KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vaW5jbHVkZSBUYXggQW1vdW50CiAgICAgICAgICAgICAgICBjb25zdCBhbW91bnROb2Rpc2NvdW50ID0KICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnByaWNlKSAqIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucXR5KSAtCiAgICAgICAgICAgICAgICAgICAgZGlzY291bnQ7CiAgICAgICAgICAgICAgICBjb25zdCBpbmNsdWRlVGF4QW1vdW50ID0KICAgICAgICAgICAgICAgICAgICBhbW91bnROb2Rpc2NvdW50ICsgdmF0VGF4ICsgcGx0YXggKyBzcFRheCArIG90aGVyVGF4OwogICAgICAgICAgICAgICAgdmFsdWVbImluY2x1ZGVUYXhBbW91bnQiXSA9IGluY2x1ZGVUYXhBbW91bnQ7CiAgICAgICAgICAgICAgICB2YWx1ZVsiaW5jbHVkZVRheEV4Y2hhbmdlQW1vdW50Il0gPQogICAgICAgICAgICAgICAgICAgIGluY2x1ZGVUYXhBbW91bnQgKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMudHJhbnNhY3Rpb24udHhuUmF0ZSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5pdGVtU3VidG90YWwgPSBpdGVtU3VidG90YWw7CiAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24uZXhjaGFuZ2VJdGVtU3VidG90YWwgPQogICAgICAgICAgICAgICAgaXRlbVN1YnRvdGFsICoga2VuZG8ucGFyc2VGbG9hdCh0aGlzLnRyYW5zYWN0aW9uLnR4blJhdGUpOwogICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLnNlcnZpY2VTdWJ0b3RhbCA9IHNlcnZpY2VTdWJ0b3RhbDsKICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5leGNoYW5nZVNlcnZpY2VTdWJ0b3RhbCA9CiAgICAgICAgICAgICAgICBzZXJ2aWNlU3VidG90YWwgKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMudHJhbnNhY3Rpb24udHhuUmF0ZSk7CiAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24udHhuSXRtU3VidG90YWwgPSB0eG5JdG1TdWJ0b3RhbDsKICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5leGNoYW5nZVR4bkl0bVN1YnRvdGFsID0KICAgICAgICAgICAgICAgIHR4bkl0bVN1YnRvdGFsICoga2VuZG8ucGFyc2VGbG9hdCh0aGlzLnRyYW5zYWN0aW9uLnR4blJhdGUpOwogICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLml0ZW1EaXNjb3VudCA9IGl0ZW1EaXNjb3VudDsKICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5leGNoYW5nZUl0ZW1EaXNjb3VudCA9CiAgICAgICAgICAgICAgICBpdGVtRGlzY291bnQgKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMudHJhbnNhY3Rpb24udHhuUmF0ZSk7CiAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24uc2VydmljZURpc2NvdW50ID0gc2VydmljZURpc2NvdW50OwogICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLmV4Y2hhbmdlU2VydmljZURpc2NvdW50ID0KICAgICAgICAgICAgICAgIHNlcnZpY2VEaXNjb3VudCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy50cmFuc2FjdGlvbi50eG5SYXRlKTsKICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi50eG5JdG1EaXNjb3VudCA9IHR4bkRpc2NvdW50OwogICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLmV4Y2hhbmdlVHhuSXRtRGlzY291bnQgPQogICAgICAgICAgICAgICAgdHhuRGlzY291bnQgKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMudHJhbnNhY3Rpb24udHhuUmF0ZSk7CgogICAgICAgICAgICBkaXNjb3VudFRvdGFsID0gZGlzY291bnRUb3RhbCA/IGRpc2NvdW50VG90YWwgOiAwOwoKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKHNwVGF4LCBwbHRheCwgb3RoZXJUYXgsIHZhdFRheCkKICAgICAgICAgICAgbGV0IHRvdGFsID0KICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQoc3ViVG90YWwpIC0KICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQoZGlzY291bnRUb3RhbCkgKwogICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh0b3RhbFRheCk7CiAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24uc3ViVG90YWwgPSBzdWJUb3RhbDsKICAgICAgICAgICAgJCgiI3N1YnRvdGFsIikudGV4dChrZW5kby5wYXJzZUZsb2F0KHN1YlRvdGFsKSk7CiAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24udG90YWxUYXhBbW91bnQgPSBrZW5kby5wYXJzZUZsb2F0KHRvdGFsVGF4KTsKICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5kaXNjb3VudFRvdGFsID0ga2VuZG8ucGFyc2VGbG9hdChkaXNjb3VudFRvdGFsKTsKICAgICAgICAgICAgaWYgKHRoaXMudHJhbnNhY3Rpb24uc3BlY2lmaWNEaXNjb3VudEl0ZW0pIHsKICAgICAgICAgICAgICAgIGRpc2NvdW50SW52b2ljZSA9IHRoaXMuYXV0b0NhbGN1bGF0ZURpc2NvdW50KAogICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24uc3BlY2lmaWNEaXNjb3VudEl0ZW0sCiAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdChzdWJUb3RhbCkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBkaXNjb3VudEludm9pY2UgPSBkaXNjb3VudEludm9pY2UgPyBkaXNjb3VudEludm9pY2UgOiAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIHRoaXMub25PdGhlckNoYXJnZUNoYW5nZSgpCiAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24udG90YWwgPQogICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh0b3RhbCkgLQogICAgICAgICAgICAgICAgZGlzY291bnRJbnZvaWNlICsKICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodGhpcy50cmFuc2FjdGlvbi5vdGhlckNoYXJnZUFtb3VudCk7CiAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24uZXhjaGFuZ2VBbW91bnQgPQogICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh0aGlzLnRyYW5zYWN0aW9uLnRvdGFsKSAqCiAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHRoaXMudHJhbnNhY3Rpb24udHhuUmF0ZSk7CiAgICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZVRheEJ5VHlwZSh0YXhMaXN0KTsKICAgICAgICAgICAgdGhpcy5jdXN0b21lckRpc2NvdW50SXRlbSA9IHRoaXMucmVtb3ZlRHVwbGljYXRlKGRpc2NvdW50SXRlbSk7CiAgICAgICAgICAgIHRoaXMuY3VzdG9tZXJTYWxlVW5pdCA9IHRoaXMucmVtb3ZlRHVwbGljYXRlKHNhbGVVbml0KTsKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKCdkaXNjb3VudCAnLCB0aGlzLmN1c3RvbWVyRGlzY291bnRJdGVtKQogICAgICAgIH0sCiAgICAgICAgcm93TnVtYmVyVG1wbChkYXRhSXRlbSkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLnNhbGVRdW90ZUl0ZW1MaW5lRFMua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIGluZGV4ID0gZHMuaW5kZXhPZihkYXRhSXRlbSk7CiAgICAgICAgICAgIHJldHVybiBpbmRleCArIDE7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkU2FsZUZvcm1Db250ZW50KCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBzYWxlRm9ybUNvbnRlbnRIYW5kbGVyLmxpc3QoKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYWxlRm9ybUNvbnRlbnQgPSBkYXRhWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyhkYXRhWzBdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgdmF0VGVtcGxhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3QgdmF0ID0gZGF0YUl0ZW0udmF0VGF4OwogICAgICAgICAgICBpZiAodmF0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYDxzcGFuPiR7dmF0LmRlZmF1bHRUYXggPyB2YXQuZGVmYXVsdFRheCA6IGBgfTwvc3Bhbj5gOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGBgOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpdGVtVGVtcGxhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3QgaXRlbSA9IGRhdGFJdGVtLml0ZW07CiAgICAgICAgICAgIGlmIChpdGVtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYDxzcGFuPiR7aXRlbS5uYW1lID8gaXRlbS5uYW1lIDogYGB9PC9zcGFuPmA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYGA7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIFVPTVRlbXBsYXRlKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGNvbnN0IHVvbSA9IGRhdGFJdGVtLnVvbTsKICAgICAgICAgICAgY29uc3QgY29kZSA9IHVvbS5jb2RlIHx8ICcnCiAgICAgICAgICAgIGlmICh1b20pIHsKICAgICAgICAgICAgICAgIHJldHVybiBgPHNwYW4+JHt1b20udW9tID8gY29kZSA6IGBgfTwvc3Bhbj5gOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGBgOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzYWxlVW5pdFRlbXBsYXRlKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGNvbnN0IHNhbGVVbml0ID0gZGF0YUl0ZW0uc2FsZVVuaXQ7CiAgICAgICAgICAgIGlmIChzYWxlVW5pdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGA8c3Bhbj4ke3NhbGVVbml0Lm5hbWUgPyBzYWxlVW5pdC5uYW1lIDogYGB9PC9zcGFuPmA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYGA7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGRpc2NvdW50SXRlbVRlbXBsYXRlKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGNvbnN0IGRpc2NvdW50SXRlbSA9IGRhdGFJdGVtLmRpc2NvdW50SXRlbTsKICAgICAgICAgICAgaWYgKGRpc2NvdW50SXRlbSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGA8c3Bhbj4ke2Rpc2NvdW50SXRlbS5jb2RlID8gZGlzY291bnRJdGVtLmNvZGUgOiBgYH0gLSAkewogICAgICAgICAgICAgICAgICAgIGRpc2NvdW50SXRlbS5uYW1lID8gZGlzY291bnRJdGVtLm5hbWUgOiBgYAogICAgICAgICAgICAgICAgfTwvc3Bhbj5gOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGBgOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBTZXJ2aWNlRGF0ZUVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCByZXF1aXJlZCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0RhdGVQaWNrZXIoKTsKCiAgICAgICAgICAgIC8vIGxldCBkcyA9IHRoaXMuJHJlZnMuaXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpCiAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyhkcy5kYXRhKCkpCiAgICAgICAgICAgIC8vIC8vIGNvbnN0IGRhdGVTdHJpbmcgPSBrZW5kby50b1N0cmluZygobmV3IERhdGUob3B0aW9ucy5tb2RlbC5pdGVtcy5zZXJ2aWNlRGF0ZSkpLCB0aGlzLml0ZW1MaW5lLmRhdGVGb3JtYXQpCiAgICAgICAgICAgIC8vIC8vIGNvbnN0IGRhdGVTdHJpbmcgPSBrZW5kby50b1N0cmluZyhvcHRpb25zLm1vZGVsLml0ZW1zLnNlcnZpY2VEYXRlKQogICAgICAgICAgICAvLyBjb25zdCAkaW5wdXQgPSAkKCI8aW5wdXQgdmFsdWU9IiArIG9wdGlvbnMubW9kZWwuc2VydmljZURhdGUgKyAiIC8+IikuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAvLyAkaW5wdXQua2VuZG9EYXRlUGlja2VyKCkKICAgICAgICAgICAgLy8gLy8gJGlucHV0LmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgLy8gLy8gb3B0aW9ucy5tb2RlbC5pdGVtcy5zZXJ2aWNlRGF0ZSA9IGRhdGVTdHJpbmcKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKCRpbnB1dCkKICAgICAgICB9LAogICAgICAgIFNlcnZpY2VEYXRlVG9FZGl0b3IoY29udGFpbmVyLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAualF1ZXJ5KCc8aW5wdXQgcmVxdWlyZWQgbmFtZT0iJyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgICAgICAua2VuZG9EYXRlUGlja2VyKCk7CiAgICAgICAgfSwKICAgICAgICBJdGVtRHJvcERvd25FZGl0b3IoY29udGFpbmVyLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAualF1ZXJ5KCc8aW5wdXQgbmFtZT0iJyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgICAgICAua2VuZG9Ecm9wRG93bkxpc3QoewogICAgICAgICAgICAgICAgICAgIGF1dG9CaW5kOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGF1dG9XaWR0aDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDQwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXI6ICJjb250YWlucyIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogIm5hbWUiLAogICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZUZpZWxkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgIGhlYWRlclRlbXBsYXRlOgogICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0iZHJvcGRvd24taGVhZGVyIGstd2lkZ2V0IGstaGVhZGVyIj4nICsKICAgICAgICAgICAgICAgICAgICAgICAgIjxzcGFuPkl0ZW1zIDwvc3Bhbj4iICsKICAgICAgICAgICAgICAgICAgICAgICAgIjxzcGFuPjwvc3Bhbj4iICsKICAgICAgICAgICAgICAgICAgICAgICAgIjwvZGl2PiIsCiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICI8c3Bhbj4jPW5hbWUjPC9zcGFuPiIsCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6ICItLS0gU2VsZWN0IC0tLSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZTogbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZlckZpbHRlcmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNwb3J0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBwcm9kdWN0VmFyaWFudEhhbmRsZXIuaXRlbVNlYXJjaFVSTCgnP3BsSWQ9JyArIHRoaXMudHJhbnNhY3Rpb24ucHJpY2VMZXZlbC5pZCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDoge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZToge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2t1OiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhLmNvdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGF0YTogdGhpcy52YXJpYW50cwogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBVT01Ecm9wRG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogInN0YXJ0c3dpdGgiLAogICAgICAgICAgICAgICAgICAgIGRhdGFUZXh0RmllbGQ6ICJjb2RlIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogInVvbUNvbnZlcnRJZCIsCiAgICAgICAgICAgICAgICAgICAgY2FzY2FkZUZyb206ICJpdGVtIiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9Y29kZSB8fCBgTm8gUHJpY2UgTGV2ZWxgIzwvc3Bhbj4iLAogICAgICAgICAgICAgICAgICAgIG9wdGlvbkxhYmVsOiAiLS0tIFNlbGVjdCAtLS0iLAogICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IG5ldyBrZW5kby5kYXRhLkRhdGFTb3VyY2UoewogICAgICAgICAgICAgICAgICAgICAgICBzZXJ2ZXJGaWx0ZXJpbmc6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zcG9ydDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZDoge3VybDogdW9tUHJpY2VIYW5kbGVyLnVvbVByaWNlQnlQcmljZUxldmVsVVJMKCJpZD0iICsgb3B0aW9ucy5tb2RlbC5pdGVtLmlkICsgIiZwbElkPSIgKyB0aGlzLnRyYW5zYWN0aW9uLnByaWNlTGV2ZWwuaWQgKyAiJmRhdGU9IiArIHRoaXMudHJhbnNhY3Rpb24udHJhbnNhY3Rpb25EYXRlKSx9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDoge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbmFtZToge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2t1OiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhLmNvdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGF0YTogdGhpcy52YXJpYW50cwogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBEaXNjb3VudEl0ZW1Ecm9wRG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogInN0YXJ0c3dpdGgiLAogICAgICAgICAgICAgICAgICAgIGRhdGFUZXh0RmllbGQ6ICJuYW1lIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogImlkIiwKICAgICAgICAgICAgICAgICAgICBjYXNjYWRlRnJvbTogIml0ZW0iLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAiPHNwYW4+Iz1jb2RlIyAtICM9bmFtZSM8L3NwYW4+IiwKICAgICAgICAgICAgICAgICAgICBvcHRpb25MYWJlbDogIi0tLSBTZWxlY3QgLS0tIiwKICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlOiBuZXcga2VuZG8uZGF0YS5EYXRhU291cmNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyRmlsdGVyaW5nOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc3BvcnQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGRpc2NvdW50SXRlbUhhbmRsZXIuZ2V0VVJMKERJU0NPVU5UX1RZUEUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAianNvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWw6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogImlkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHt0eXBlOiAic3RyaW5nIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5hbWU6IHt0eXBlOiAic3RyaW5nIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNrdToge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YS5jb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIFNwZWNpZmljVGF4RHJvcERvd25FZGl0b3IoY29udGFpbmVyLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAualF1ZXJ5KCc8aW5wdXQgbmFtZT0iJyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgICAgICAua2VuZG9Ecm9wRG93bkxpc3QoewogICAgICAgICAgICAgICAgICAgIGF1dG9CaW5kOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGF1dG9XaWR0aDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDQwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXI6ICJzdGFydHN3aXRoIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVGV4dEZpZWxkOiAiZGVmYXVsdFRheCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlRmllbGQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICI8c3Bhbj4jPWRlZmF1bHRUYXgjPC9zcGFuPiIsCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6ICItLS0gU2VsZWN0IC0tLSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZTogbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHRoaXMuc3BlY2lmaWNUYXguZmlsdGVyKChtKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5tb2RlbC5oYXNPd25Qcm9wZXJ0eSgidmF0VGF4IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YXQgPSBvcHRpb25zLm1vZGVsLnZhdFRheDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmF0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubW9kZWwudmF0VGF4ICE9PSBudWxsIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm1vZGVsLnZhdFRheCAhPT0gIm51bGwiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMubW9kZWwudmF0VGF4LmJhc2VBbW91bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLmJhc2VBbW91bnQudG9Mb3dlckNhc2UoKSA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5tb2RlbC52YXRUYXguYmFzZUFtb3VudC50b0xvd2VyQ2FzZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBQdWJsaWNMaWdodGluZ1RheERyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IG5hbWU9IicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgICAgICAgICAgICBhdXRvQmluZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiAic3RhcnRzd2l0aCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogImRlZmF1bHRUYXgiLAogICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZUZpZWxkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAiPHNwYW4+Iz1kZWZhdWx0VGF4Izwvc3Bhbj4iLAogICAgICAgICAgICAgICAgICAgIG9wdGlvbkxhYmVsOiAiLS0tIFNlbGVjdCAtLS0iLAogICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IG5ldyBrZW5kby5kYXRhLkRhdGFTb3VyY2UoewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLnB1YmxpY0xpZ2h0aW5nVGF4LmZpbHRlcigobSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMubW9kZWwuaGFzT3duUHJvcGVydHkoInZhdFRheCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmF0ID0gb3B0aW9ucy5tb2RlbC52YXRUYXg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm1vZGVsLnZhdFRheCAhPT0gbnVsbCAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5tb2RlbC52YXRUYXggIT09ICJudWxsIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLm1vZGVsLnZhdFRheC5iYXNlQW1vdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5iYXNlQW1vdW50LnRvTG93ZXJDYXNlKCkgPT09CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubW9kZWwudmF0VGF4LmJhc2VBbW91bnQudG9Mb3dlckNhc2UoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgT3RoZXJUYXhEcm9wRG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogInN0YXJ0c3dpdGgiLAogICAgICAgICAgICAgICAgICAgIGRhdGFUZXh0RmllbGQ6ICJkZWZhdWx0VGF4IiwKICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogImlkIiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9ZGVmYXVsdFRheCM8L3NwYW4+IiwKICAgICAgICAgICAgICAgICAgICBvcHRpb25MYWJlbDogIi0tLSBTZWxlY3QgLS0tIiwKICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlOiBuZXcga2VuZG8uZGF0YS5EYXRhU291cmNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogdGhpcy5vdGhlclRheC5maWx0ZXIoKG0pID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLm1vZGVsLmhhc093blByb3BlcnR5KCJ2YXRUYXgiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhdCA9IG9wdGlvbnMubW9kZWwudmF0VGF4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5tb2RlbC52YXRUYXggIT09IG51bGwgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubW9kZWwudmF0VGF4ICE9PSAibnVsbCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5tb2RlbC52YXRUYXguYmFzZUFtb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0uYmFzZUFtb3VudC50b0xvd2VyQ2FzZSgpID09PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm1vZGVsLnZhdFRheC5iYXNlQW1vdW50LnRvTG93ZXJDYXNlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIFZhdFRheERyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IG5hbWU9IicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgICAgICAgICAgICBhdXRvQmluZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiAic3RhcnRzd2l0aCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogImRlZmF1bHRUYXgiLAogICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZUZpZWxkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAiPHNwYW4+Iz1kZWZhdWx0VGF4Izwvc3Bhbj4iLAogICAgICAgICAgICAgICAgICAgIG9wdGlvbkxhYmVsOiAiLS1TZWxlY3QtLSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZTogbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHRoaXMudmF0VGF4LAogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBTYWxlVW5pdERyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IG5hbWU9IicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgICAgICAgICAgICBhdXRvQmluZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiAic3RhcnRzd2l0aCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogIm5hbWUiLAogICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZUZpZWxkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAiPHNwYW4+Iz1jb2RlIyAtICM9bmFtZSM8L3NwYW4+IiwKICAgICAgICAgICAgICAgICAgICBvcHRpb25MYWJlbDogIi0tLSBTZWxlY3QgLS0tIiwKICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlOiBuZXcga2VuZG8uZGF0YS5EYXRhU291cmNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogdGhpcy5zYWxlVW5pdEl0ZW1MaXN0LAogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBNb2RpZmllckRyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBjb25zdCBpdGVtID0gb3B0aW9ucy5tb2RlbC5pdGVtIHx8IHt9CiAgICAgICAgICAgIGNvbnN0IHVvbSA9IGl0ZW0udW9tIHx8IHt9CiAgICAgICAgICAgIGNvbnN0IGl0ZW1JZCA9IGl0ZW0uaWQgfHwgJycKICAgICAgICAgICAgY29uc3QgdW9tSWQgPSB1b20uaWQgfHwgJycKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogImNvbnRhaW5zIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVGV4dEZpZWxkOiAibmFtZSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlRmllbGQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgaGVhZGVyVGVtcGxhdGU6CiAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJkcm9wZG93bi1oZWFkZXIgay13aWRnZXQgay1oZWFkZXIiPicgKwogICAgICAgICAgICAgICAgICAgICAgICAiPHNwYW4+TW9kaWZpZXIgPC9zcGFuPiIgKwogICAgICAgICAgICAgICAgICAgICAgICAiPHNwYW4+PC9zcGFuPiIgKwogICAgICAgICAgICAgICAgICAgICAgICAiPC9kaXY+IiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9bmFtZSM8L3NwYW4+IiwKICAgICAgICAgICAgICAgICAgICBvcHRpb25MYWJlbDogIi0tLSBTZWxlY3QgLS0tIiwKICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlOiBuZXcga2VuZG8uZGF0YS5EYXRhU291cmNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyRmlsdGVyaW5nOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc3BvcnQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGl0ZW1Nb2RpZmllckhhbmRsZXIuc2VhcmNoVVJMKCc/cGxJZD0nICsgdGhpcy50cmFuc2FjdGlvbi5wcmljZUxldmVsLmlkICsgJyZpZD0nICsgaXRlbUlkICsgJyZ1b21JZD0nICsgdW9tSWQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAianNvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWw6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogImlkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHt0eXBlOiAic3RyaW5nIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHt0eXBlOiAic3RyaW5nIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaWNlOiB7dHlwZTogIm51bWJlciJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1b206IHt0eXBlOiAic3RyaW5nIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGEuY291bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBFbXBsb3llZURyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IGRhdGEtYmluZD0idmFsdWU6JyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgICAgICAua2VuZG9NdWx0aVNlbGVjdCh7CiAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgIHN1Z2dlc3Q6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiAiY29udGFpbnMiLAogICAgICAgICAgICAgICAgICAgIGRhdGFUZXh0RmllbGQ6ICJuYW1lIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogImlkIiwKICAgICAgICAgICAgICAgICAgICBoZWFkZXJUZW1wbGF0ZToKICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9ImRyb3Bkb3duLWhlYWRlciBrLXdpZGdldCBrLWhlYWRlciI+JyArCiAgICAgICAgICAgICAgICAgICAgICAgICI8c3Bhbj5FbXBsb3llZSA8L3NwYW4+IiArCiAgICAgICAgICAgICAgICAgICAgICAgICI8c3Bhbj48L3NwYW4+IiArCiAgICAgICAgICAgICAgICAgICAgICAgICI8L2Rpdj4iLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAiPHNwYW4+Iz1uYW1lIzwvc3Bhbj4iLAogICAgICAgICAgICAgICAgICAgIG9wdGlvbkxhYmVsOiAiLS0tIFNlbGVjdCAtLS0iLAogICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IG5ldyBrZW5kby5kYXRhLkRhdGFTb3VyY2UoewogICAgICAgICAgICAgICAgICAgICAgICBzZXJ2ZXJGaWx0ZXJpbmc6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zcG9ydDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogZW1wbG95ZWVIYW5kbGVyLnNlYXJjaFVSTCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAianNvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWw6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogImlkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHt0eXBlOiAic3RyaW5nIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHt0eXBlOiAic3RyaW5nIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0TmFtZToge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdE5hbWU6IHt0eXBlOiAic3RyaW5nIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGEuY291bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBlbXBJbXBsKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGxldCBlbXBJZHMgPSBbXTsKICAgICAgICAgICAgZGF0YUl0ZW0uZW1wbG95ZWUuZm9yRWFjaCgobSkgPT4gewogICAgICAgICAgICAgICAgZW1wSWRzLnB1c2gobS5maXJzdE5hbWUgKyAiIC0gIiArIG0ubGFzdE5hbWUpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKGVtcElkcy5qb2luKCcsICcpKQogICAgICAgICAgICByZXR1cm4gYDxzcGFuPiR7ZW1wSWRzLmpvaW4oIiwgIil9PC9zcGFuPmA7CiAgICAgICAgfSwKICAgICAgICBhZGRSb3coKSB7CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuc2FsZVF1b3RlSXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpLAogICAgICAgICAgICAgICAgdG90YWwgPSBkcy50b3RhbCgpOwogICAgICAgICAgICB0aGlzLml0ZW1MaW5lLmlkID0gaW52b2ljZVByZWZpeCArIHV1aWQudjEoKTsKICAgICAgICAgICAgZHMuaW5zZXJ0KHRvdGFsLCB0aGlzLml0ZW1MaW5lKTsKICAgICAgICB9LAogICAgICAgIG9uU3BlY2lmaWNEaXNjb3VudENoYW5nZWQoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnRyYW5zYWN0aW9uLnNwZWNpZmljRGlzY291bnRJdGVtKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkaXNjb3VudFF1b3RlID0gdGhpcy5hdXRvQ2FsY3VsYXRlRGlzY291bnQoCiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5zcGVjaWZpY0Rpc2NvdW50SXRlbSwKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLnN1YlRvdGFsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5zcGVjaWZpY0Rpc2NvdW50VG90YWwgPSBrZW5kby50b1N0cmluZygKICAgICAgICAgICAgICAgICAgICBkaXNjb3VudFF1b3RlID8gZGlzY291bnRRdW90ZSA6IDAsCiAgICAgICAgICAgICAgICAgICAgIm4iCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgbGV0IHRvdGFsID0KICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHRoaXMudHJhbnNhY3Rpb24uc3ViVG90YWwpIC0KICAgICAgICAgICAgICAgICAgICAoa2VuZG8ucGFyc2VGbG9hdCh0aGlzLnRyYW5zYWN0aW9uLmRpc2NvdW50VG90YWwpICsKICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh0aGlzLnRyYW5zYWN0aW9uLnRvdGFsVGF4QW1vdW50KSkgLQogICAgICAgICAgICAgICAgICAgIGRpc2NvdW50UXVvdGU7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLnRvdGFsID0ga2VuZG8udG9TdHJpbmcodG90YWwsICJuIik7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIG9uT3RoZXJDaGFyZ2VDaGFuZ2UoKSB7CiAgICAgICAgICAgIGxldCBvdGhlckNoYXJnZSA9IDA7CiAgICAgICAgICAgIHRoaXMubU90aGVyQ2hhcmdlLmZvckVhY2goKG0pID0+IHsKICAgICAgICAgICAgICAgIG90aGVyQ2hhcmdlICs9IHRoaXMuYXV0b0NhbGN1bGF0ZURpc2NvdW50KG0sIHRoaXMudHJhbnNhY3Rpb24uc3ViVG90YWwpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5vdGhlckNoYXJnZUFtb3VudCA9IG90aGVyQ2hhcmdlOwogICAgICAgICAgICB0aGlzLmF1dG9DYWxjdWxhdGUoKTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRPdGhlckNoYXJnZSgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgb3RoZXJDaGFyZ2VIYW5kbGVyLmxpc3QoKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vdGhlckNoYXJnZUxpc3QgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgb25PdGhlckFtb3VudCh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5hdXRvQ2FsY3VsYXRlRGlzY291bnQodmFsdWUsIHRoaXMudHJhbnNhY3Rpb24uc3ViVG90YWwpOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZERpc2NvdW50SXRlbSgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgZGlzY291bnRJdGVtSGFuZGxlci5saXN0KERJU0NPVU5UX1RZUEUpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNwZWNpZmljRGlzY291bnRJdGVtID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRTZWdtZW50KCkgewogICAgICAgICAgICBjb25zdCByb2xlVHlwZSA9IGRhdGFTdG9yZS5yb2xlVHlwZSB8fCAwCiAgICAgICAgICAgIGlmIChyb2xlVHlwZSA9PT0gMCkgewogICAgICAgICAgICAgICAgaWYgKGRhdGFTdG9yZS5yb2xlRGF0YSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvbGVEYXRhID0gZGF0YVN0b3JlLnJvbGVEYXRhIHx8IFtdCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VnbWVudCA9IHJvbGVEYXRhLmZpbHRlcihpdG0gPT4gaXRtLnR5cGUgPT09ICdzZWdtZW50JykKICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWdtZW50RGVmYXVsdCA9IHNlZ21lbnQuZmlsdGVyKG0gPT4gbS5pc0RlZmF1bHQgPT09IDEpCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWdtZW50cyA9IHNlZ21lbnQKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkID09PSB1bmRlZmluZWQgfHwgdGhpcy4kcm91dGUucGFyYW1zLmlkID09PSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VnbWVudERlZmF1bHQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5zZWdtZW50ID0gc2VnbWVudERlZmF1bHRbMF07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAocm9sZVR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VnbWVudHMgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NIYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0U2VnKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWdtZW50cyA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlZ21lbnRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24uc2VnbWVudCA9IHRoaXMuc2VnbWVudHNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkTG9jYXRpb24oKSB7CiAgICAgICAgICAgIHRoaXMubG9jYXRpb25zID0gW10KICAgICAgICAgICAgY29uc3Qgcm9sZVR5cGUgPSBkYXRhU3RvcmUucm9sZVR5cGUgfHwgMAogICAgICAgICAgICBpZiAocm9sZVR5cGUgPT09IDApIHsKICAgICAgICAgICAgICAgIGlmIChkYXRhU3RvcmUucm9sZURhdGEpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCByb2xlRGF0YSA9IGRhdGFTdG9yZS5yb2xlRGF0YSB8fCBbXQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvY2F0aW9uID0gcm9sZURhdGEuZmlsdGVyKGl0bSA9PiBpdG0udHlwZSA9PT0gJ2xvY2F0aW9uJykKICAgICAgICAgICAgICAgICAgICBjb25zdCBsb2NhdGlvbkRlZmF1bHQgPSBsb2NhdGlvbi5maWx0ZXIobSA9PiBtLmlzRGVmYXVsdCA9PT0gMSkKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvY2F0aW9ucyA9IGxvY2F0aW9uCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCA9PT0gdW5kZWZpbmVkIHx8IHRoaXMuJHJvdXRlLnBhcmFtcy5pZCA9PT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvY2F0aW9uRGVmYXVsdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLmxvY2F0aW9uID0gbG9jYXRpb25EZWZhdWx0WzBdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHJvbGVUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvY2F0aW9ucyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbkhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5saXN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2NhdGlvbnMgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHRoaXMubG9jYXRpb25zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24ubG9jYXRpb24gPSB0aGlzLmxvY2F0aW9uc1swXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKTsKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkUHJvamVjdEJ5Q3VzdG9tZXIoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIHByb2plY3RIYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRCeUN1c3RvbWVyKHRoaXMuY3VzdG9tZXIuaWQpCiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN1c3RvbWVyUHJvamVjdHMgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1c3RvbWVyUHJvamVjdHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaW5pdFNhbGVRdW90ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5wcm9qZWN0ID0gdGhpcy5jdXN0b21lclByb2plY3RzWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKTsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFNhbGVDaGFubmVsKCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBzYWxlQ2hhbm5lbEhhbmRsZXIuZ2V0KCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2FsZUNoYW5uZWxMaXN0ID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNhbGVDaGFubmVsTGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgIT09IHVuZGVmaW5lZCB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgIT0gIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5zYWxlQ2hhbm5lbCA9IHRoaXMuc2FsZUNoYW5uZWxMaXN0WzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRUYXgoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIHNldHRpbmdIYW5kbGVyLmdldCgpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRheCA9IHJlczsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vdGhlclRheCA9IHRoaXMudGF4LmZpbHRlcigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChtKSA9PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChtLnRheFR5cGUudHlwZUlkID09PSA3IHx8IG0udGF4VHlwZS50eXBlSWQgPT09IDEwKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0udHJhbnNhY3Rpb25UeXBlID09PSAiU2FsZSIKICAgICAgICAgICAgICAgICAgICAgICAgKTsgLy8gdmFsdWFibGUgdGF4CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3BlY2lmaWNUYXggPSB0aGlzLnRheC5maWx0ZXIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAobSkgPT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobS50YXhUeXBlLnR5cGVJZCA9PT0gOCB8fCBtLnRheFR5cGUudHlwZUlkID09PSAxMCkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLnRyYW5zYWN0aW9uVHlwZSA9PT0gIlNhbGUiCiAgICAgICAgICAgICAgICAgICAgICAgICk7IC8vIHZhbHVhYmxlIHRheAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnB1YmxpY0xpZ2h0aW5nVGF4ID0gdGhpcy50YXguZmlsdGVyKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKG0pID0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG0udGF4VHlwZS50eXBlSWQgPT09IDkgfHwgbS50YXhUeXBlLnR5cGVJZCA9PT0gMTApICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbS50cmFuc2FjdGlvblR5cGUgPT09ICJTYWxlIgogICAgICAgICAgICAgICAgICAgICAgICApOyAvLyB2YWx1YWJsZSB0YXgKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52YXRUYXggPSB0aGlzLnRheC5maWx0ZXIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAobSkgPT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobS50YXhUeXBlLnR5cGVJZCA9PT0gMSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLnRheFR5cGUudHlwZUlkID09PSA4IHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0udGF4VHlwZS50eXBlSWQgPT09IDEwKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0udHJhbnNhY3Rpb25UeXBlID09PSAiU2FsZSIKICAgICAgICAgICAgICAgICAgICAgICAgKTsgLy8gdmFsdWFibGUgdGF4CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFNhbGVVbml0SXRlbXMoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIHNhbGVVbml0SXRlbUhhbmRsZXIubGlzdCgpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYWxlVW5pdEl0ZW1MaXN0ID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBjbG9zZShkYXRhKSB7CiAgICAgICAgICAgIHRoaXMubG9hZEVtcGxveWVlQ2VudGVyKCkKICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5jdXN0b21lciA9IHt9OwogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLnNhbGVRdW90ZUl0ZW1MaW5lRFMua2VuZG9XaWRnZXQoKTsKICAgICAgICAgICAgZHMuZGF0YShbXSk7CiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbk1vZGVsKHt9KTsKICAgICAgICAgICAgdGhpcy5hZGRSb3coKQogICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5nbygtMSk7CiAgICAgICAgICAgIC8vIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAvLyAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgLy8gICAgIG5hbWU6ICJDdXN0b21lcnMiLAogICAgICAgICAgICAvLyAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgIC8vICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgIC8vICAgICB9CiAgICAgICAgICAgIC8vICAgfSkKICAgICAgICAgICAgLy8gfSBlbHNlIHsKICAgICAgICAgICAgLy8gICB3aW5kb3cuaGlzdG9yeS5nbygtMSkKICAgICAgICAgICAgLy8gfQogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coZGF0YSwgImNsb3NlIik7CiAgICAgICAgICAgIC8vIGxvY2FsU3RvcmFnZS5kYXRhLmlkID0gSlNPTi5zdHJpbmdpZnkoZGF0YSkKICAgICAgICB9LAogICAgICAgIC8vY2F0YWxvZwogICAgICAgIGxvYWRJbWFnZShkYXRhSXRlbSkgewogICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaGFzT3duUHJvcGVydHkoImltYWdlcyIpKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaW1hZ2VzLmhhc093blByb3BlcnR5KCJkZWZhdWx0IikpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB1cmwgPSB0aGlzLmltZ1VSTCArIGRhdGFJdGVtLmltYWdlcy5kZWZhdWx0LnRodW1iOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgICI8aW1nIHdpZHRoPSc1MCcgaGVpZ2h0PSc1MCcgc3R5bGU9ICdtYXJnaW46IGF1dG87ZGlzcGxheTogYmxvY2s7JyBzcmM9JyIgKwogICAgICAgICAgICAgICAgICAgICAgICB1cmwgKwogICAgICAgICAgICAgICAgICAgICAgICAiJyAvPiIKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkQ2F0YWxvZ3MoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGNhdGFsb2dIYW5kbGVyLmdldCgpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2F0YWxvZ3MgPSByZXM7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYWRkQ2F0YWxvZyhlKSB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgbGV0IGdyaWQgPSBrZW5kby5qUXVlcnkoIiNncmlkQ2F0YWxvZyIpLmRhdGEoImtlbmRvR3JpZCIpOwogICAgICAgICAgICBsZXQgZGF0YUl0ZW0gPSBncmlkLmRhdGFJdGVtKCQoZS5jdXJyZW50VGFyZ2V0KS5jbG9zZXN0KCJ0ciIpKTsKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKGRhdGFJdGVtKQogICAgICAgICAgICBpZiAoZGF0YUl0ZW0udmFyaWFudHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgZGF0YUl0ZW0udmFyaWFudHMuZm9yRWFjaCgobSkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChtLmhhc093blByb3BlcnR5KCJ2YXJpYW50IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG0udmFyaWFudC5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkU2luZ2xlSXRlbShtLnZhcmlhbnQuaWQsICJpIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHRoaXMuZGlhbG9nQ2F0YWxvZyA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChkYXRhSXRlbS5zZXJ2aWNlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBkYXRhSXRlbS5zZXJ2aWNlcy5mb3JFYWNoKChtKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG0uaGFzT3duUHJvcGVydHkoInNlcnZpY2UiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAobS5zZXJ2aWNlLmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRTaW5nbGVJdGVtKG0uc2VydmljZS5pZCwgInMiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy5kaWFsb2dDYXRhbG9nID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRTaW5nbGVJdGVtKGl0ZW1JZCwgdHlwZSkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHByb2R1Y3RIYW5kbGVyLmdldE9uZShpdGVtSWQpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkYXRhID0gcmVzOwogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuc2FsZVF1b3RlSXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWwgPSBkcy50b3RhbCgpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1MaW5lLmlkID0gaW52b2ljZVByZWZpeCArIHV1aWQudjEoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtTGluZS5pdGVtID0gZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT0gImkiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1MaW5lLmRlc2NyaXB0aW9uID0gZGF0YS52YXJpYW50LnNhbGVEZXNjcmlwdGlvbjsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbUxpbmUuZGVzY3JpcHRpb24gPSBkYXRhLnNhbGVEZXNjcmlwdGlvbjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBkcy5pbnNlcnQodG90YWwsIHRoaXMuaXRlbUxpbmUpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGNsZWFyKCkgewogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFByZWZpeCgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgcHJlZml4SGFuZGxlci5nZXQoInNhbGUgcXVvdGUiKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvblR5cGUgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudHJhbnNhY3Rpb25UeXBlLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLnRyYW5zYWN0aW9uVHlwZSA9IHRoaXMudHJhbnNhY3Rpb25UeXBlWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5pbml0U2FsZVF1b3RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygibG9hZCBwcmVmaXgiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZU51bWJlcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRWaWV3U2FsZVF1b3RlKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuaW5pdFNhbGVRdW90ZSkgewogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCJoZXJlIGZyb20gaWQgd2l0aCBubyBwcm9wIGRhdGEiKTsKICAgICAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbkhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC52aWV3KHRoaXMuJHJvdXRlLnBhcmFtcy5pZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbiA9IHJlcy5kYXRhLmRhdGFbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYmluZERhdGEoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICByZW1vdmVFbXB0eUxpbmUoKSB7CiAgICAgICAgICAgIGNvbnN0IGdyaWQgPSBrZW5kby5qUXVlcnkoIiNncmlkSXRlbUxpbmVTYWxlUXVvdGUiKS5kYXRhKCJrZW5kb0dyaWQiKSwKICAgICAgICAgICAgICAgIGRhdGFTb3VyY2UgPSBncmlkLmRhdGFTb3VyY2U7CiAgICAgICAgICAgIGlmIChkYXRhU291cmNlLmRhdGEoKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBkYXRhU291cmNlLmRhdGEoKS5mb3JFYWNoKChtKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXRtID0gbS5pdGVtIHx8IHt9CiAgICAgICAgICAgICAgICAgICAgaWYgKGl0bSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRtLmlkID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2UucmVtb3ZlKG0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRUcmFuc2FjdGlvblJhdGUoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSh0aGlzLnRyYW5zYWN0aW9uLnRyYW5zYWN0aW9uRGF0ZSkKICAgICAgICAgICAgICAgICAgICAgICAgLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICAgICAgLnN1YnN0cigwLCAxMCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJpY2VMZXZlbCA9IHRoaXMudHJhbnNhY3Rpb24ucHJpY2VMZXZlbDsKICAgICAgICAgICAgICAgICAgICBsZXQgY29kZSA9ICIiOwogICAgICAgICAgICAgICAgICAgIGlmIChwcmljZUxldmVsLmhhc093blByb3BlcnR5KCJjdXJyZW5jeSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcmljZUxldmVsLmN1cnJlbmN5Lmhhc093blByb3BlcnR5KCJjb2RlIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUgPSBwcmljZUxldmVsLmN1cnJlbmN5LmNvZGU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGNvZGUgIT09IHVuZGVmaW5lZCB8fCBjb2RlICE9PSAiIikgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lIYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0TGFzdEV4Y2hhbmdlUmF0ZUJ5RGF0ZShkYXRlLCBjb2RlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV4Y2hhbmdlUmF0ZSA9IHJlcy5kYXRhLmRhdGFbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVuY3lDb2RlID0gdGhpcy5leGNoYW5nZVJhdGUuY29kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvblJhdGUgPSB0aGlzLmV4Y2hhbmdlUmF0ZS5yYXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLnR4blJhdGUgPSB0aGlzLmV4Y2hhbmdlUmF0ZS5yYXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLmV4Y2hhbmdlUmF0ZSA9IHRoaXMuZXhjaGFuZ2VSYXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGNyZWRpdExpbWl0VXNhZ2UoYmFsYW5jZSwgY3JlZGl0TGltaXQpIHsKICAgICAgICAgICAgaWYgKGNyZWRpdExpbWl0ID4gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgICBrZW5kby50b1N0cmluZygKICAgICAgICAgICAgICAgICAgICAgICAgKGJhbGFuY2UgLyBjcmVkaXRMaW1pdCkgKiAxMDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGBuJHt0aGlzLnNhbGVGb3JtQ29udGVudC5kZWNpbWFsfWAKICAgICAgICAgICAgICAgICAgICApICsgIiAlIgogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBrZW5kby50b1N0cmluZygwLCBgbiR7dGhpcy5zYWxlRm9ybUNvbnRlbnQuZGVjaW1hbH1gKSArICIgJSI7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRDdXN0b21lckJhbGFuY2UoaWQpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyRmlsdGVyID0gaWQgKyAiP3R5cGU9YmFsIjsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLmN1cnJlbnRCYWxhbmNlID0gMDsKICAgICAgICAgICAgICAgICAgICBiaWxsaW5nSGFuZGxlcgogICAgICAgICAgICAgICAgICAgICAgICAuYmFsYW5jZShzdHJGaWx0ZXIpCiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24uY3VycmVudEJhbGFuY2UgPSBkYXRhWzBdLmJhbGFuY2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKTsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgaGFuZGxlU3VibWl0KGV2ZW50KSB7CiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHRoaXMuc3VjY2VzcyA9IHRydWU7CiAgICAgICAgfSwKICAgICAgICBzYXZlQ2xvc2UoKSB7CiAgICAgICAgICAgIHRoaXMuaXNTYXZlQ2xvc2UgPSB0cnVlOwogICAgICAgICAgICB0aGlzLnNhdmVPcHRpb24gPSAic2F2ZUNsb3NlIjsKCiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuc2FsZVF1b3RlSXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICBsZXQgZDEgPSBkcy5kYXRhKCkuZmlsdGVyKG4gPT4gbi5hbW91bnQgPiAwKTsKICAgICAgICAgICAgbGV0IGRhdGFWYWxpZGF0ZSA9IDA7CiAgICAgICAgICAgIGQxLmZvckVhY2goKHZhbHVlLCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCdpbmRleCcsIHZhbHVlKQogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgIHZhbHVlLml0ZW0uaWQgPT0gdW5kZWZpbmVkIHx8CiAgICAgICAgICAgICAgICAgICAgdmFsdWUudW9tLnVvbS5pZCA9PSB1bmRlZmluZWQgfHwKICAgICAgICAgICAgICAgICAgICB2YWx1ZS5pdGVtLmlkID09ICIiIHx8CiAgICAgICAgICAgICAgICAgICAgdmFsdWUudW9tLnVvbS5pZCA9PSAiIgogICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcigKICAgICAgICAgICAgICAgICAgICAgICAgIlBsZWFzZSBjaGVjayBJdGVtIG9yIFVvbSAgb24gcm93ICIgKyAoaW5kZXggKyAxKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGRhdGFWYWxpZGF0ZSArPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKGQxLmxlbmd0aCA9PSBkYXRhVmFsaWRhdGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2F2ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzYXZlUHJpbnQoKSB7CiAgICAgICAgICAgIHRoaXMuaXNTYXZlUHJpbnQgPSB0cnVlOwogICAgICAgICAgICB0aGlzLnNhdmVPcHRpb24gPSAic2F2ZVByaW50IjsKICAgICAgICAgICAgdGhpcy5zYXZlKCk7CiAgICAgICAgfSwKICAgICAgICBzYXZlTmV3KCkgewogICAgICAgICAgICB0aGlzLnNhdmVPcHRpb24gPSAic2F2ZU5ldyI7CiAgICAgICAgICAgIHRoaXMuaXNTYXZlTmV3ID0gdHJ1ZTsKICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5zYWxlUXVvdGVJdGVtTGluZURTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgIGxldCBkMSA9IGRzLmRhdGEoKS5maWx0ZXIobiA9PiBuLmFtb3VudCA+IDApOwogICAgICAgICAgICBsZXQgZGF0YVZhbGlkYXRlID0gMDsKICAgICAgICAgICAgZDEuZm9yRWFjaCgodmFsdWUsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgdmFsdWUuaXRlbS5pZCA9PSB1bmRlZmluZWQgfHwKICAgICAgICAgICAgICAgICAgICB2YWx1ZS51b20uaWQgPT0gdW5kZWZpbmVkIHx8CiAgICAgICAgICAgICAgICAgICAgdmFsdWUuaXRlbS5pZCA9PSAiIiB8fAogICAgICAgICAgICAgICAgICAgIHZhbHVlLnVvbS5pZCA9PSAiIgogICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcigKICAgICAgICAgICAgICAgICAgICAgICAgIlBsZWFzZSBjaGVjayBJdGVtIG9yIFVvbSAgb24gcm93ICIgKyAoaW5kZXggKyAxKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGRhdGFWYWxpZGF0ZSArPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKGQxLmxlbmd0aCA9PSBkYXRhVmFsaWRhdGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2F2ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzYXZlRHJhZnQoKSB7CiAgICAgICAgICAgIHRoaXMuc2F2ZU9wdGlvbiA9ICJzYXZlRHJhZnQiOwogICAgICAgICAgICB0aGlzLmlzU2F2ZURyYWZ0ID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5zYXZlKCk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBzYXZlKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuJHJlZnMuZm9ybS52YWxpZGF0ZSgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRyZWZzLmZvcm0udmFsaWRhdGUoKTsKICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoCiAgICAgICAgICAgICAgICAgICAgIkZpZWxkIGlzIHJlcXVpcmVkLCBwbGVhc2UgY2hlY2sgZmllbGQgZWFjaCBvZiB0YWJzISIKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IGlkID0gIiI7CiAgICAgICAgICAgIGlmICh0aGlzLmN1c3RvbWVyLmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICBpZCA9IHRoaXMuY3VzdG9tZXIuaWQgfHwgIiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGlkID09PSAiIikgewogICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcigiQ3VzdG9tZXIgaXMgcmVxdWlyZSIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMucmVtb3ZlRW1wdHlMaW5lKCkKICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5zYWxlUXVvdGVJdGVtTGluZURTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICB0b3RhbCA9IGRzLnRvdGFsKCkKICAgICAgICAgICAgaWYgKHRvdGFsID09IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoIkl0ZW0gaXMgcmVxdWlyZSIpOwogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgbGV0IHR4bkxpc3QgPSBbXTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50cmFuc2FjdGlvbi5sZWFkLmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR4bkxpc3QucHVzaCh0aGlzLnRyYW5zYWN0aW9uLmxlYWQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUVtcHR5TGluZSgpOwogICAgICAgICAgICAgICAgICAgIGxldCBpdGVtTGluZURTID0gdGhpcy4kcmVmcy5zYWxlUXVvdGVJdGVtTGluZURTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsID0gaXRlbUxpbmVEUy50b3RhbCgpOwogICAgICAgICAgICAgICAgICAgIGlmICh0b3RhbCA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoIkZpZWxkIFJlcXVpcmVkISIpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFSb3cgPSBpdGVtTGluZURTLmRhdGEoKS5tYXAoKG0pID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBJdGVtTGluZU1vZGVsKG0pOwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRoaXMudHJhbnNhY3Rpb24uaWQgPyB0aGlzLnRyYW5zYWN0aW9uLmlkIDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJTYWxlIFF1b3RlIiwKICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyOiB0aGlzLnRyYW5zYWN0aW9uLm51bWJlciwKICAgICAgICAgICAgICAgICAgICAgICAgYWJicjogdGhpcy50cmFuc2FjdGlvbi50cmFuc2FjdGlvblR5cGUuYWJiciwKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25EYXRlOiB0aGlzLnRyYW5zYWN0aW9uLnRyYW5zYWN0aW9uRGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRpdHlEYXRlOiB0aGlzLnRyYW5zYWN0aW9uLnZhbGlkaXR5RGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgbW9udGhPZjogdGhpcy50cmFuc2FjdGlvbi5tb250aE9mLAogICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21lcjogdGhpcy50cmFuc2FjdGlvbi5jdXN0b21lciwKICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudFRlcm06IHRoaXMudHJhbnNhY3Rpb24ucGF5bWVudFRlcm0sCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uVHlwZTogdGhpcy50cmFuc2FjdGlvbi50cmFuc2FjdGlvblR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50UHJvbW90aW9uOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgcHJpY2VMZXZlbDogdGhpcy50cmFuc2FjdGlvbi5wcmljZUxldmVsLAogICAgICAgICAgICAgICAgICAgICAgICBpdGVtTGluZXM6IGRhdGFSb3csCiAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3Q6IHRoaXMudHJhbnNhY3Rpb24ucHJvamVjdCwKICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudDogdGhpcy50cmFuc2FjdGlvbi5zZWdtZW50ID8gdGhpcy50cmFuc2FjdGlvbi5zZWdtZW50IDoge30sCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiB0aGlzLnRyYW5zYWN0aW9uLmxvY2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHRoaXMudHJhbnNhY3Rpb24ubG9jYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDoge30sCiAgICAgICAgICAgICAgICAgICAgICAgIHNhbGVDaGFubmVsOiB0aGlzLnRyYW5zYWN0aW9uLnNhbGVDaGFubmVsLAogICAgICAgICAgICAgICAgICAgICAgICBiaWxsaW5nQWRkcmVzczogdGhpcy50cmFuc2FjdGlvbi5iaWxsaW5nQWRkcmVzcywKICAgICAgICAgICAgICAgICAgICAgICAgZGVsaXZlcnlBZGRyZXNzOiB0aGlzLnRyYW5zYWN0aW9uLmRlbGl2ZXJ5QWRkcmVzcywKICAgICAgICAgICAgICAgICAgICAgICAgZGVsaXZlcnlEYXRlVGltZTogdGhpcy50cmFuc2FjdGlvbi5kZWxpdmVyeURhdGVUaW1lLAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbk5vdGU6IHRoaXMudHJhbnNhY3Rpb24udHJhbnNhY3Rpb25Ob3RlLAogICAgICAgICAgICAgICAgICAgICAgICBzdWJUb3RhbDogdGhpcy50cmFuc2FjdGlvbi5zdWJUb3RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IHRoaXMudHJhbnNhY3Rpb24udG90YWwgPyB0aGlzLnRyYW5zYWN0aW9uLnRvdGFsIDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiB0aGlzLnRyYW5zYWN0aW9uLmFtb3VudER1ZSB8fCAwLAogICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudFRvdGFsOiB0aGlzLnRyYW5zYWN0aW9uLmRpc2NvdW50VG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OiB0aGlzLnRyYW5zYWN0aW9uLmV4Y2hhbmdlQW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICBzcGVjaWZpY0Rpc2NvdW50VG90YWw6IHRoaXMudHJhbnNhY3Rpb24uc3BlY2lmaWNEaXNjb3VudFRvdGFsLAogICAgICAgICAgICAgICAgICAgICAgICBkZWxpdmVyeUZlZTogdGhpcy50cmFuc2FjdGlvbi5kZWxpdmVyeUZlZSwKICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxUYXhBbW91bnQ6IHRoaXMudHJhbnNhY3Rpb24udG90YWxUYXhBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRCYWxhbmNlOiB0aGlzLnRyYW5zYWN0aW9uLmN1cnJlbnRCYWxhbmNlLAogICAgICAgICAgICAgICAgICAgICAgICBiYWxhbmNlOiB0aGlzLnRyYW5zYWN0aW9uLmJhbGFuY2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWRpdExpbWl0OiB0aGlzLnRyYW5zYWN0aW9uLmNyZWRpdExpbWl0LAogICAgICAgICAgICAgICAgICAgICAgICBzYXZlT3B0aW9uOiB0aGlzLnNhdmVPcHRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIHR4blJhdGU6IHRoaXMudHJhbnNhY3Rpb24udHhuUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgcmF0ZTogdGhpcy50cmFuc2FjdGlvbi50eG5SYXRlLAogICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IDEsIC8vMSBvcGVuLCAwIHVzZWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGFwcHJvdmVkQnk6IHRoaXMudHJhbnNhY3Rpb24uYXBwcm92ZWRCeSwKICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0ZWRCeToge30sCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1UZW1wbGF0ZTogdGhpcy50ZW1wbGF0ZXNGb3JtW3RoaXMudGVtcGxhdGVdLAogICAgICAgICAgICAgICAgICAgICAgICBzcGVjaWZpY0Rpc2NvdW50SXRlbTogdGhpcy50cmFuc2FjdGlvbi5zcGVjaWZpY0Rpc2NvdW50SXRlbSwKICAgICAgICAgICAgICAgICAgICAgICAgb3RoZXJDaGFyZ2U6IHRoaXMubU90aGVyQ2hhcmdlLAogICAgICAgICAgICAgICAgICAgICAgICBvdGhlckNoYXJnZUFtb3VudDogdGhpcy50cmFuc2FjdGlvbi5vdGhlckNoYXJnZUFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgdGF4TGlzdFRvdGFsOiB0aGlzLnRheExpc3RUb3RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NpbmdTdGF0dXM6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21lckRpc2NvdW50SXRlbTogdGhpcy5jdXN0b21lckRpc2NvdW50SXRlbSwKICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tZXJTYWxlVW5pdDogdGhpcy5jdXN0b21lclNhbGVVbml0LAogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZWRVc2VyOiB0aGlzLmxvZ2dlZFVzZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIHR4bkxpc3Q6IHR4bkxpc3QsCiAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpY0xpbms6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICB1c2VkRGF0ZUF0OiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlZEF0OiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlZDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3Vic3RyKDAsIDEwKSwKICAgICAgICAgICAgICAgICAgICAgICAgc2FsZU9yZGVyVHlwZTogMCwKICAgICAgICAgICAgICAgICAgICAgICAgZW1wbG95ZWU6IHRoaXMubUVtcGxveWVlLAogICAgICAgICAgICAgICAgICAgICAgICBzdXBwbGllcjoge30sCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlUmF0ZTogdGhpcy50cmFuc2FjdGlvbi5leGNoYW5nZVJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm06IDEsCiAgICAgICAgICAgICAgICAgICAgICAgIGxlYWQ6IHRoaXMudHJhbnNhY3Rpb24ubGVhZCwKICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50RHVlOiB0aGlzLnRyYW5zYWN0aW9uLmFtb3VudER1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVN1YnRvdGFsOiB0aGlzLnRyYW5zYWN0aW9uLml0ZW1TdWJ0b3RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VJdGVtU3VidG90YWw6IHRoaXMudHJhbnNhY3Rpb24uZXhjaGFuZ2VJdGVtU3VidG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZpY2VTdWJ0b3RhbDogdGhpcy50cmFuc2FjdGlvbi5zZXJ2aWNlU3VidG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlU2VydmljZVN1YnRvdGFsOiB0aGlzLnRyYW5zYWN0aW9uLmV4Y2hhbmdlU2VydmljZVN1YnRvdGFsLAogICAgICAgICAgICAgICAgICAgICAgICB0eG5JdG1TdWJ0b3RhbDogdGhpcy50cmFuc2FjdGlvbi50eG5JdG1TdWJ0b3RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VUeG5JdG1TdWJ0b3RhbDogdGhpcy50cmFuc2FjdGlvbi5leGNoYW5nZVR4bkl0bVN1YnRvdGFsLAogICAgICAgICAgICAgICAgICAgICAgICBpdGVtRGlzY291bnQ6IHRoaXMudHJhbnNhY3Rpb24uaXRlbURpc2NvdW50LAogICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUl0ZW1EaXNjb3VudDogdGhpcy50cmFuc2FjdGlvbi5leGNoYW5nZUl0ZW1EaXNjb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgc2VydmljZURpc2NvdW50OiB0aGlzLnRyYW5zYWN0aW9uLnNlcnZpY2VEaXNjb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VTZXJ2aWNlRGlzY291bnQ6IHRoaXMudHJhbnNhY3Rpb24uZXhjaGFuZ2VTZXJ2aWNlRGlzY291bnQsCiAgICAgICAgICAgICAgICAgICAgICAgIHR4bkl0bURpc2NvdW50OiB0aGlzLnRyYW5zYWN0aW9uLnR4bkl0bURpc2NvdW50LAogICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZVR4bkl0bURpc2NvdW50OiB0aGlzLnRyYW5zYWN0aW9uLmV4Y2hhbmdlVHhuSXRtRGlzY291bnQsCiAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlVmlldzogInNhbGVfcXVvdGVfdmlldyIsCiAgICAgICAgICAgICAgICAgICAgICAgIGV4c3BlY3RlZERhdGU6ICIiLAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5idG5EaXNhYmxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKGRhdGEpOwogICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uSGFuZGxlcgogICAgICAgICAgICAgICAgICAgICAgICAuY3JlYXRlKGRhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5idG5EaXNhYmxlZCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXNDb2RlID09PSAyMDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLiRyZWZzLmZvcm0ucmVzZXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LnN1Y2Nlc3MoIlN1Y2Nlc3NmdWxseSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzU2F2ZU5ldyA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXREZWZhdWx0RGF0YSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZShyZXNwb25zZS5kYXRhLmRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYnRuRGlzYWJsZWQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoIlNvbWV0aGluZyB3ZW50IHdyb25nIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9ycy5wdXNoKGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKGUpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBkYXRhQm91bmQoKSB7CiAgICAgICAgICAgIHRoaXMuc2NoZW1hTW9kZWxGaWVsZHMgPSB7CiAgICAgICAgICAgICAgICB1b206IHt2YWxpZGF0aW9uOiB7cmVxdWlyZWQ6IHRydWV9fSwKICAgICAgICAgICAgICAgIHByaWNlOiB7dmFsaWRhdGlvbjoge3JlcXVpcmVkOiB0cnVlfX0sCiAgICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkUGF5bWVudFRlcm1MaXN0KCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXN0b21lcikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJGaWx0ZXIgPSAnP2lkPScgKyB0aGlzLmN1c3RvbWVyLmlkICsgJyZ0cmFuc2FjdGlvbkRhdGU9JyArIHRoaXMudHJhbnNhY3Rpb24udHJhbnNhY3Rpb25EYXRlICsgJyZ0eXBlPUN1c3RvbWVyJwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLnBheW1lbnRUZXJtID0ge30KICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudFRlcm1IYW5kbGVyXy5nZXQoc3RyRmlsdGVyKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZXJtcyA9IHJlcy5kYXRhLmRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLnBheW1lbnRUZXJtID0gdGVybXMudGVybQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZENyZWRpdExpbWl0KCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXN0b21lcikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJGaWx0ZXIgPSAnP2lkPScgKyB0aGlzLmN1c3RvbWVyLmlkICsgJyZ0cmFuc2FjdGlvbkRhdGU9JyArIHRoaXMudHJhbnNhY3Rpb24udHJhbnNhY3Rpb25EYXRlICsgJyZ0eXBlPUN1c3RvbWVyJwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLmNyZWRpdExpbWl0ID0gMAogICAgICAgICAgICAgICAgICAgICAgICBjcmVkaXRMaW1pdEhhbmRsZXIuZ2V0KHN0ckZpbHRlcikudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5jcmVkaXRMaW1pdEl0ZW0gPSByZXMuZGF0YS5kYXRhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3JlZGl0ID0gcmVzLmRhdGEuZGF0YQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24uY3JlZGl0TGltaXQgPSBrZW5kby5wYXJzZUZsb2F0KGNyZWRpdC5hbW91bnQgfHwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBjbGVhclVPTUl0ZW0oKSB7CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuc2FsZVF1b3RlSXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpCiAgICAgICAgICAgIGRzLmRhdGEoKS5tYXAobiA9PiB7CiAgICAgICAgICAgICAgICBuLnNldCgndW9tJywge30pCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHRoaXMuaXNQcmljZUxldmVsQ2hhbmdlZCA9IGZhbHNlCiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkUXVvdGUoaWQpIHsKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKGlkLCAnbG9hZCBpZCcpCiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlCiAgICAgICAgICAgIHRyYW5zYWN0aW9uSGFuZGxlci52aWV3KGlkKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgdGhpcy5pc0VkaXQgPSB0cnVlCiAgICAgICAgICAgICAgICB0aGlzLml0ZW1MaW5lcyA9IFtdCiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uID0gcmVzLmRhdGEuZGF0YVswXQogICAgICAgICAgICAgICAgdGhpcy5iaW5kRGF0YSgpOwogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFNpbmdsZURhdGEoKSB7CiAgICAgICAgICAgIHRoaXMuYnRuRGlzYWJsZWQgPSBmYWxzZQogICAgICAgICAgICBpZiAodGhpcy4kcm91dGUubmFtZSA9PT0gJ1NhbGUgUXVvdGUnKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbml0U2FsZVF1b3RlKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRWRpdCBNb2RlCiAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtTGluZXMgPSBbXQogICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24gPSB0aGlzLmluaXRTYWxlUXVvdGU7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5iaW5kRGF0YSgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBuZXcKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRRdW90ZSh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQpCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXREZWZhdWx0RGF0YSgpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcHJlZml4SGFuZGxlci5nZXQoInNhbGUgcXVvdGUiKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvblR5cGUgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50cmFuc2FjdGlvblR5cGUubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlLnBhcmFtcy5pZCAhPT0gdW5kZWZpbmVkIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGUucGFyYW1zLmlkICE9ICIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLnRyYW5zYWN0aW9uVHlwZSA9IHRoaXMudHJhbnNhY3Rpb25UeXBlWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5pbml0U2FsZVF1b3RlICYmIHRoaXMuJHJvdXRlLnBhcmFtcy5pZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVOdW1iZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMubG9hZFBheW1lbnRUZXJtKCk7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmxvYWRTYWxlRm9ybUNvbnRlbnQoKTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMubG9hZE90aGVyQ2hhcmdlKCk7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmxvYWRQcmljZUxldmVsKCk7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmxvYWREaXNjb3VudEl0ZW0oMCk7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmxvYWRTYWxlQ2hhbm5lbCgpOwogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5sb2FkQ2F0YWxvZ3MoKTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMubG9hZExlYWQoKTsKICAgICAgICAgICAgICAgIHRoaXMubG9hZFRheCgpOwogICAgICAgICAgICAgICAgdGhpcy5sb2FkU2FsZVVuaXRJdGVtcygpOwogICAgICAgICAgICAgICAgdGhpcy5sb2FkU2VnbWVudCgpOwogICAgICAgICAgICAgICAgdGhpcy5sb2FkTG9jYXRpb24oKTsKICAgICAgICAgICAgICAgIHRoaXMubG9hZEVtcGxveWVlQ2VudGVyKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgfSwKICAgIGNvbXB1dGVkOiB7CiAgICAgICAgZGF0ZUZvcm1hdHRlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIGtlbmRvLnRvU3RyaW5nKG5ldyBEYXRlKCksIGluc3RpdHV0ZS5kYXRlRm9ybWF0KTsKICAgICAgICB9LAogICAgICAgIGRhdGVUaW1lRm9ybWF0dGVkKCkgewogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coaW5zdGl0dXRlLmRhdGVGb3JtYXQgKyAiIEhIOm1tIiwgImluc3QgZGF0ZSIpOwogICAgICAgICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcobmV3IERhdGUoKSwgaW5zdGl0dXRlLmRhdGVGb3JtYXQgKyAiIEhIOm1tIik7CiAgICAgICAgfSwKICAgICAgICB2YWxpZEN1c3RvbWVyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXN0b21lci5pZCAhPT0gdW5kZWZpbmVkICYmIHRoaXMuY3VzdG9tZXIuaWQgIT09IG51bGw7CiAgICAgICAgfSwKICAgICAgICBoaWRkZW5CdXR0b24oKSB7CiAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5xdWVyeS50eXBlID09ICJlZGl0IikgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICB9CgogICAgICAgIH0KICAgIH0sCiAgICB3YXRjaDogewogICAgICAgICckcm91dGUnOiAnbG9hZFNpbmdsZURhdGEnLAogICAgICAgIC8vICckcm91dGUnOiAnbG9hZFZpZXdTYWxlUXVvdGUnLAogICAgICAgIGluaXRTYWxlUXVvdGUoKSB7CiAgICAgICAgICAgIHRoaXMuaW5pdGlhbERhdGEoKTsKICAgICAgICB9LAogICAgfSwKICAgIGNyZWF0ZWQoKSB7CiAgICB9LAogICAgbW91bnRlZDogYXN5bmMgZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMubG9hZFNpbmdsZURhdGEoKTsKICAgICAgICB0aGlzLnJlcXVlc3REYXRhKDAsIHRoaXMuZmlsdGVyLCB0aGlzLmN1c0Jhc2VVcmwpOwogICAgICAgIHRoaXMucmVxdWVzdERhdGEoMCwgdGhpcy5maWx0ZXIsIHRoaXMuY3VzQmFzZVVybCk7CiAgICB9LAp9Owo="},{"version":3,"sources":["SaleQuote.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA67BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"SaleQuote.vue","sourceRoot":"src/views/customers","sourcesContent":["<template>\n    <v-app>\n        <v-container>\n            <v-row>\n                <v-col sm=\"12\" cols=\"12\">\n                    <v-card\n                        outlined\n                        dense\n                        class=\"pa-4 no_border rounded-sm\"\n                        color=\"white\"\n                    >\n                        <v-row>\n                            <v-col\n                                class=\"bigSide pr-2 py-0\"\n                                sm=\"8\"\n                                cols=\"12\"\n                                style=\"transition: .3s ease-in;\"\n                                :class=\"{ hide_big_bar_class: isHideBar }\"\n                            >\n                                <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                                    <v-card outlined dense class=\"no_border\">\n                                        <h2 class=\"mb-0\">Sale {{ saleFormContent.saleQuote }}</h2>\n                                        <v-icon\n                                            v-if=\"isHideBar\"\n                                            @click=\"cancel()\"\n                                            style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                                            class=\"float-right\"\n                                        >close\n                                        </v-icon>\n                                        <span\n                                            style=\"transition: .3s ease-in; z-index:10;\"\n                                            :class=\"{\n                        iconArrow: !isHideBar,\n                        iconArrowHide: isHideBar,\n                      }\"\n                                        >\n                      <v-icon\n                          size=\"22\"\n                          class=\"arr_icon\"\n                          @click=\"hide_smallsitebar\"\n                          v-if=\"isHideBar\"\n                      >\n                        mdi-chevron-left-circle</v-icon\n                      >\n                      <v-icon\n                          size=\"22\"\n                          class=\"arr_icon\"\n                          @click=\"hide_smallsitebar\"\n                          v-if=\"!isHideBar\"\n                      >\n                        mdi-chevron-right-circle</v-icon\n                      ></span\n                                        >\n                                    </v-card>\n                                    <v-card\n                                        outlined\n                                        dense\n                                        class=\"px-4 rounded-4 no_border mb-3\"\n                                        color=\"grayBg\"\n                                    >\n                                        <v-row>\n                                            <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                                                <label class=\"label\">{{ $t(\"customer\") }}</label>\n                                                <v-col\n                                                    sm=\"12\"\n                                                    cols=\"12\"\n                                                    class=\"kendo_dropdown_custom pl-0 pb-4 pt-0 mt-1 pr-0\"\n                                                >\n                                                    <dropdownlist\n                                                        width=\"100%\"\n                                                        :data-items=\"customerList\"\n                                                        @change=\"onChange\"\n                                                        :value=\"transaction.customer\"\n                                                        :data-item-key=\"dataItemKey\"\n                                                        :text-field=\"textField\"\n                                                        :default-item=\"defaultItem\"\n                                                        :required=\"true\"\n                                                        :valid=\"validCustomer\"\n                                                        :filterable=\"true\"\n                                                        :disabled=\"isEdit\"\n                                                        @filterchange=\"onFilterChange\"\n                                                    >\n                                                    </dropdownlist>\n                                                </v-col>\n                                                <label class=\"label\">{{ $t(\"date\") }}</label>\n                                                <app-datepicker\n                                                    :initialDate=\"transaction.transactionDate\"\n                                                    @onChanged=\"onQuoteDateChanged\"\n                                                    @emitDate=\"transaction.transactionDate = $event\"\n                                                />\n                                                <label class=\"label\">{{ $t(\"number\") }}</label>\n                                                <v-row class=\"mt-1 mr-0\">\n                                                    <v-col sm=\"3\" cols=\"3\" class=\"pt-0 pr-0\">\n                                                        <div class=\"code_text text-bold\">\n                                                            {{ transaction.transactionType.abbr }}\n                                                        </div>\n                                                    </v-col>\n                                                    <v-col sm=\"7\" cols=\"7\" class=\"pt-0 pl-0 pr-1\">\n                                                        <v-text-field\n                                                            class=\" custom-border \"\n                                                            v-model=\"transaction.number\"\n                                                            outlined\n                                                            disabled\n                                                            :rules=\"[(v) => !!v || 'Number is required']\"\n                                                            required\n                                                        />\n                                                    </v-col>\n                                                    <v-col sm=\"2\" cols=\"2\" class=\"pt-0 px-0\">\n                                                        <v-icon\n                                                            color=\"black\"\n                                                            size=\"30\"\n                                                            class=\"border_qrcode\"\n                                                            :disabled=\"isEdit\"\n                                                            @click=\"generateNumber\">mdi-qrcode\n                                                        </v-icon>\n                                                    </v-col>\n                                                </v-row>\n                                            </v-col>\n                                            <v-col sm=\"8\" cols=\"12\" class=\"\">\n                                                <v-row>\n                                                    <v-col sm=\"6\" cols=\"12\" class=\"py-0 pt-0\">\n                                                        <!-- <p class=\"mb-1 d-block\">\n                                                            {{ $t(\"current_balance\") }}\n                                                        </p>\n                                                        <h3 class=\"color_green float-right\">\n                                                            {{ numberFormat(transaction.currentBalance) }}\n                                                        </h3> -->\n                                                        <label class=\"label mb-0\">{{ $t(\"term\") }}</label>\n                                                        <v-select\n                                                            class=\"mt-1\"\n                                                            v-model=\"transaction.paymentTerm\"\n                                                            :items=\"paymentTerms\"\n                                                            @change=\"onPaymentTermChanged\"\n                                                            placeholder=\"Term\"\n                                                            item-text=\"name\"\n                                                            item-value=\"id\"\n                                                            return-object\n                                                            outlined\n                                                        />\n                                                    </v-col>\n                                                    <v-col sm=\"6\" cols=\"12\" class=\"pl-0 pt-0\">\n                                                        <label class=\"mb-0 d-block\">\n                                                            {{ $t(\"credit_limit_allowed\") }}\n                                                        </label>\n                                                        <h3 class=\"font_19 mt-3 float-left\">\n                                                            {{\n                                                                creditLimitUsage(\n                                                                    transaction.currentBalance,\n                                                                    transaction.creditLimit\n                                                                )\n                                                            }}\n                                                        </h3>\n                                                        <h3 class=\"font_19 mt-3 float-right\">\n                                                            {{ numberFormat(transaction.creditLimit) }}\n                                                        </h3>\n                                                    </v-col>\n                                                </v-row>\n                                                <!-- <p class=\"mb-2 ml-n3 color_grey\">{{ $t('additional_information') }}</p> -->\n\n                                                <v-row class=\"mr-0 mt-0\">\n                                                    <v-col class=\"pb-0 pt-0\" sm=\"6\" cols=\"12\">\n\n                                                        <label class=\"label mb-0\">{{ $t(\"lead\") }}</label>\n                                                        <v-select\n                                                            class=\"mt-1\"\n                                                            v-model=\"transaction.lead\"\n                                                            :items=\"leads\"\n                                                            placeholder=\"Lead\"\n                                                            item-text=\"name\"\n                                                            item-value=\"id\"\n                                                            clearable\n                                                            return-object\n                                                            outlined\n                                                        />\n                                                        <label class=\"label mb-0\">{{\n                                                                $t(\"price_level\")\n                                                            }}</label>\n                                                        <v-select\n                                                            class=\"mt-1\"\n                                                            v-model=\"transaction.priceLevel\"\n                                                            :items=\"priceLevel\"\n                                                            @change=\"onPriceLevelChange\"\n                                                            item-value=\"id\"\n                                                            item-text=\"name\"\n                                                            return-object\n                                                            placeholder=\"Price Level\"\n                                                            tage=\"Default Price Level\"\n                                                            outlined\n                                                        />\n                                                    </v-col>\n                                                    <v-col class=\"py-0 pr-0\" sm=\"6\" cols=\"12\">\n                                                        <label class=\"label  mb-0\">{{\n                                                                $t(\"validity_date\")\n                                                            }}</label>\n                                                        <app-datepicker\n                                                            :initialDate=\"transaction.validityDate\"\n                                                            @emitDate=\"transaction.validityDate = $event\"\n                                                        />\n                                                        <div class=\"d-flex justify-space-between\">\n                                                            <div>\n                                                                <label class=\"label mb-0\">{{ $t(\"currency\") }}</label>\n                                                                <p class=\"label font_19 mt-3 mb-0\">{{\n                                                                        currencyCode\n                                                                    }}</p>\n                                                            </div>\n                                                            <div>\n                                                                <label class=\"label mb-0\">{{ $t(\"rate\") }}</label>\n                                                                <p class=\"label font_19 mt-3 mb-0\">{{\n                                                                        transactionRate\n                                                                    }}</p>\n                                                            </div>\n                                                        </div>\n\n                                                    </v-col>\n\n                                                </v-row>\n                                            </v-col>\n                                        </v-row>\n                                    </v-card>\n\n                                    <v-card outlined dense class=\"no_border mb-3\" color=\"white\">\n                                        <v-row>\n                                            <v-col sm=\"12\" cols=\"12\" class=\"pt-0\">\n                                                <kendo-datasource\n                                                    ref=\"saleQuoteItemLineDS\"\n                                                    :data=\"itemLines\"\n                                                    :change=\"dataSourceChanged\"/>\n                                                <kendo-grid\n                                                    id=\"gridItemLineSaleQuote\"\n                                                    class=\"grid-function\"\n                                                    :data-source-ref=\"'saleQuoteItemLineDS'\"\n                                                    :sortable=\"false\"\n                                                    :column-menu=\"true\"\n                                                    :editable=\"true\"\n                                                    :scrollable-virtual=\"true\">\n                                                    <kendo-grid-column\n                                                        :command=\"{\n                              iconClass: 'k-icon k-i-trash',\n                              text: ' ',\n                              click: removeRow,\n                              class: 'btn-plus',}\"\n                                                        :title=\"''\"\n                                                        :width=\"63\"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: left; background-color: #EDF1F5',\n                            }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :title=\"$t('no.')\"\n                                                        :width=\"53\"\n                                                        :column-menu=\"false\"\n                                                        :template=\"rowNumberTmpl\"\n                                                        :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5;',\n                              class: 'text-products',\n                            }\"\n                                                        :attributes=\"{\n                              style: 'text-align: products',\n                            }\"\n                                                    />\n\n                                                    <kendo-grid-column\n                                                        :field=\"'item'\"\n                                                        :title=\"$t('item')\"\n                                                        :template=\"itemTemplate\"\n                                                        :editor=\"ItemDropDownEditor\"\n                                                        :width=\"200\"\n                                                        :required=\"true\"\n                                                        :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'description'\"\n                                                        :title=\"$t('description')\"\n                                                        :template=\"'<span>#=description#</span>'\"\n                                                        :width=\"200\"\n                                                        :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'uom'\"\n                                                        :title=\"$t('uom')\"\n                                                        :width=\"100\"\n                                                        :template=\"UOMTemplate\"\n                                                        :editor=\"UOMDropDownEditor\"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: left; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{\n                              style: 'text-align: left',\n                            }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'qty'\"\n                                                        :title=\"$t('qty')\"\n                                                        :format=\"'{0:n}'\"\n                                                        :editor=\"numberEditor\"\n                                                        :template=\"'<span>#=qty#</span>'\"\n                                                        :width=\"100\"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: left; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{ style: 'text-align: left; ' }\"\n                                                    />\n\n                                                    <kendo-grid-column\n                                                        :field=\"'price'\"\n                                                        :title=\"$t('price')\"\n                                                        :width=\"200\"\n                                                        :template=\"priceFormat\"\n                                                        :editor=\"numberEditor\"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: left; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{\n                              style: 'text-align: left',\n                            }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'amount'\"\n                                                        :title=\"$t('amount')\"\n                                                        :editor=\"numberEditor\"\n                                                        :editable=\"\n                              () => {\n                                return false;\n                              }\n                            \"\n                                                        :width=\"200\"\n                                                        :template=\"amountFormat\"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: left; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{\n                              style: 'text-align: left',\n                            }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'vatTax'\"\n                                                        :title=\"$t('vat')\"\n                                                        :width=\"200\"\n                                                        :template=\"vatTemplate\"\n                                                        :editor=\"VatTaxDropDownEditor\"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: left; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{ style: 'text-align: left' }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'serviceDate'\"\n                                                        :title=\"$t('date_from')\"\n                                                        :width=\"160\"\n                                                        :hidden=\"!saleFormContent.serviceDate\"\n                                                        :template=\"\n                              '<span>#= kendo.toString(new Date(serviceDate), dateFormat)#</span>'\n                            \"\n                                                        :editor=\"ServiceDateEditor\"\n                                                        :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'serviceDateTo'\"\n                                                        :title=\"$t('date_to')\"\n                                                        :width=\"160\"\n                                                        :hidden=\"!saleFormContent.serviceDateTo\"\n                                                        :template=\"\n                              '<span>#= kendo.toString(new Date(serviceDateTo), dateFormat)#</span>'\n                            \"\n                                                        :editor=\"ServiceDateToEditor\"\n                                                        :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'modifier'\"\n                                                        :title=\"$t('modifier')\"\n                                                        :format=\"'{0:n}'\"\n                                                        :width=\"200\"\n                                                        :hidden=\"!saleFormContent.modifier\"\n                                                        :template=\"\n                              '<span>#=modifier.name?modifier.name:``#</span>'\n                            \"\n                                                        :editor=\"ModifierDropDownEditor\"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: left; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{ style: 'text-align: left' }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'discountItem'\"\n                                                        :title=\"$t('discount_item')\"\n                                                        :width=\"200\"\n                                                        :hidden=\"!saleFormContent.discountItem\"\n                                                        :template=\"discountItemTemplate\"\n                                                        :editor=\"DiscountItemDropDownEditor\"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: left; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{\n                              style: 'text-align: left',\n                            }\"\n                                                    />\n\n                                                    <kendo-grid-column\n                                                        :field=\"'specificTax'\"\n                                                        :title=\"$t('specificTax')\"\n                                                        :width=\"200\"\n                                                        :hidden=\"!saleFormContent.specificTax\"\n                                                        :template=\"\n                              '<span>#=specificTax.defaultTax?specificTax.defaultTax:``#</span>'\n                            \"\n                                                        :editor=\"SpecificTaxDropDownEditor\"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: left; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{ style: 'text-align: left' }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'otherTax'\"\n                                                        :title=\"$t('otherTax')\"\n                                                        :width=\"200\"\n                                                        :hidden=\"!saleFormContent.otherTax\"\n                                                        :template=\"\n                              '<span>#=otherTax.defaultTax?otherTax.defaultTax:``#</span>'\n                            \"\n                                                        :editor=\"OtherTaxDropDownEditor\"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: left; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{ style: 'text-align: left' }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'publicLightingTax'\"\n                                                        :title=\"$t('pl_tax')\"\n                                                        :width=\"200\"\n                                                        :hidden=\"!saleFormContent.publicLightingTax\"\n                                                        :template=\"\n                              '<span>#=publicLightingTax.defaultTax?publicLightingTax.defaultTax:``#</span>'\n                            \"\n                                                        :editor=\"PublicLightingTaxDropDownEditor\"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: left; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{ style: 'text-align: left' }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'saleUnit'\"\n                                                        :title=\"$t('sale_unit')\"\n                                                        :width=\"200\"\n                                                        :hidden=\"!saleFormContent.saleUnit\"\n                                                        :template=\"saleUnitTemplate\"\n                                                        :editor=\"SaleUnitDropDownEditor\"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: left; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{ style: 'text-align: left' }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'employee'\"\n                                                        :title=\"$t('employee')\"\n                                                        :width=\"200\"\n                                                        :hidden=\"!saleFormContent.employee\"\n                                                        :template=\"empImpl\"\n                                                        :editor=\"EmployeeDropDownEditor\"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: left; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{ style: 'text-align: left' }\"\n                                                    />\n                                                </kendo-grid>\n                                            </v-col>\n                                            <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                                <v-row>\n                                                    <v-col sm=\"6\" cols=\"12\" class=\"pt-0 pb-1\">\n                                                        <v-btn\n                                                            class=\"float-left btn_plus  mr-2\"\n                                                            @click=\"addRow\"\n                                                        >\n                                                            <v-icon size=\"\" class=\"ma-1\">mdi-plus</v-icon>\n                                                        </v-btn>\n                                                        <!--                            <v-btn @click=\"dialogCatalog=true\"-->\n                                                        <!--                                   color=\"secondary\"-->\n                                                        <!--                                   class=\"float-left rounded-0 mr-2 white&#45;&#45;text text-capitalize\">-->\n                                                        <!--                              {{ $t('catalog') }}-->\n                                                        <!--                            </v-btn>-->\n                                                        <!--                                                        <template>-->\n                                                        <!--                                                            <v-file-input class=\"mt-0 pt-0 \" sm=\"3\" cols=\"6\"-->\n                                                        <!--                                                                          v-model=\"files\"-->\n                                                        <!--                                                                          :placeholder=\"$t('attachment')\"-->\n                                                        <!--                                                                          multiple-->\n                                                        <!--                                                                          prepend-icon=\"mdi-paperclip\">-->\n                                                        <!--                                                                <template v-slot:selection=\"{ text }\">-->\n                                                        <!--                                                                    <v-chip-->\n                                                        <!--                                                                        small-->\n                                                        <!--                                                                        label-->\n                                                        <!--                                                                        color=\"primary\"-->\n                                                        <!--                                                                    >-->\n                                                        <!--                                                                        {{ text }}-->\n                                                        <!--                                                                    </v-chip>-->\n                                                        <!--                                                                </template>-->\n                                                        <!--                                                            </v-file-input>-->\n                                                        <!--                                                        </template>-->\n                                                    </v-col>\n                                                </v-row>\n                                            </v-col>\n                                            <v-col sm=\"12\" cols=\"12\" class=\"py-0 pt-3\">\n                                                <v-row>\n                                                    <v-col class=\"pt-0\" sm=\"5\" cols=\"6\">\n                                                        <v-card\n                                                            class=\"no-boxshadow rounded-4 pa-3 rounded-0\"\n                                                            height=\"375px\"\n                                                            color=\"grayBg\"\n                                                        >\n                                                            <v-row>\n                                                                <v-col class=\"py-0\" sm=\"12\" cols=\"12\">\n                                                                    <label class=\"label\">{{\n                                                                            $t(\"billing_address\")\n                                                                        }}</label>\n                                                                    <v-select\n                                                                        class=\"mt-1\"\n                                                                        v-model=\"transaction.billingAddress\"\n                                                                        :items=\"billingAddress\"\n                                                                        item-value=\"id\"\n                                                                        item-text=\"name\"\n                                                                        tage=\"Billing Address\"\n                                                                        placeholder=\"Address\"\n                                                                        outlined\n                                                                    />\n                                                                    <!--                                  <label class=\"label\">{{-->\n                                                                    <!--                                      $t(\"pickup_delivery_address\")-->\n                                                                    <!--                                    }}</label>-->\n                                                                    <!--                                  <v-select-->\n                                                                    <!--                                      class=\"mt-1\"-->\n                                                                    <!--                                      v-model=\"transaction.deliveryAddress\"-->\n                                                                    <!--                                      :items=\"deliveryAddress\"-->\n                                                                    <!--                                      item-value=\"id\"-->\n                                                                    <!--                                      item-text=\"name\"-->\n                                                                    <!--                                      tage=\"Pickup/ Delivery Address\"-->\n                                                                    <!--                                      placeholder=\"USA\"-->\n                                                                    <!--                                      outlined-->\n                                                                    <!--                                  />-->\n                                                                    <!--                                  <label class=\"label\">{{-->\n                                                                    <!--                                      $t(\"pickup_delivery_date_time\")-->\n                                                                    <!--                                    }}</label>-->\n                                                                    <!--                                  <v-datetime-picker-->\n                                                                    <!--                                      :date-format=\"dateFormatted\"-->\n                                                                    <!--                                      v-model=\"transaction.deliveryDateTime\"-->\n                                                                    <!--                                  >-->\n                                                                    <!--                                  </v-datetime-picker>-->\n                                                                    <label>{{\n                                                                            $t(\"message_on_sale_quote\")\n                                                                        }}</label>\n                                                                    <v-textarea\n                                                                        class=\"mt-1\"\n                                                                        v-model=\"transaction.transactionNote\"\n                                                                        outlined\n                                                                        no-resize\n                                                                        height=\"60px\"\n                                                                        tage=\"Message on Invoice\"\n                                                                        placeholder=\"This will appear on the quote\"\n                                                                    />\n                                                                </v-col>\n                                                            </v-row>\n                                                        </v-card>\n                                                    </v-col>\n                                                    <v-col class=\"pt-0\" sm=\"7\" cols=\"6\">\n                                                        <v-simple-table>\n                                                            <template v-slot:default>\n                                                                <tbody>\n                                                                <tr>\n                                                                    <td class=\"text-left pr-0\">\n                                                                        {{ $t(\"subtotal\") }}\n                                                                    </td>\n                                                                    <td class=\"text-center\">:</td>\n                                                                    <td class=\"text-right\">\n                                                                        {{ numberFormat(transaction.subTotal) }}\n                                                                    </td>\n                                                                </tr>\n                                                                <tr>\n                                                                    <td class=\"text-left pr-0\">\n                                                                        {{ $t(\"general_discount\") }}\n                                                                    </td>\n                                                                    <td class=\"text-center\">:</td>\n                                                                    <td class=\"text-right\">\n                                                                        ({{\n                                                                            numberFormat(transaction.discountTotal)\n                                                                        }})\n                                                                    </td>\n                                                                </tr>\n                                                                <tr>\n                                                                    <td class=\"text-left pr-0\">\n                                                                        {{ $t(\"total_tax\") }}\n                                                                        <v-btn\n                                                                            @click=\"dialogTax = true\"\n                                                                            outlined\n                                                                            class=\"text-white text-bold rounded-0 float-right text-uppercase\"\n                                                                            color=\"primary\"\n                                                                            style=\"height: 30px !important;\"\n                                                                        >\n                                                                            {{ $t(\"tax\") }}\n                                                                        </v-btn>\n                                                                    </td>\n                                                                    <td class=\"text-center\">:</td>\n                                                                    <td class=\"text-right\">\n                                                                        {{\n                                                                            numberFormat(transaction.totalTaxAmount)\n                                                                        }}\n                                                                    </td>\n                                                                </tr>\n                                                                <tr style=\"background:#F8F8F9;\">\n                                                                    <td class=\"text-left text-uppercase pr-0\">\n                                                                        {{ $t(\"total\") }}\n                                                                    </td>\n                                                                    <td class=\"text-center\">:</td>\n                                                                    <td\n                                                                        class=\"text-right color_green text-bold\"\n                                                                        id=\"total\"\n                                                                    >\n                                                                        {{ numberFormat(transaction.total) }}\n                                                                    </td>\n                                                                </tr>\n                                                                </tbody>\n                                                            </template>\n                                                        </v-simple-table>\n                                                    </v-col>\n                                                </v-row>\n                                            </v-col>\n                                        </v-row>\n                                    </v-card>\n                                    <v-divider/>\n                                    <v-card outlined dense class=\"no_border function_footer\">\n                                        <v-alert type=\"warning\" v-model=\"alert\" dismissible>\n                                            <span v-html=\"errorMessage\"/>\n                                        </v-alert>\n                                        <v-menu>\n                                            <template v-slot:activator=\"{ on }\">\n                                                <v-btn\n                                                    class=\"mr-2 text-capitalize  black--text float-left\"\n                                                    v-on=\"on\"\n                                                >\n                                                    {{\n                                                        template >= 0\n                                                            ? templatesForm[template].name\n                                                            : $t(\"select_template\")\n                                                    }}\n                                                    <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>\n                                                </v-btn>\n                                            </template>\n                                            <v-list>\n                                                <v-list-item\n                                                    v-for=\"(item, index) in templatesForm\"\n                                                    @click=\"ChoseTemplate(index)\"\n                                                    :key=\"index\">\n                                                    <v-list-item-title>{{ item.name }}</v-list-item-title>\n                                                </v-list-item>\n                                            </v-list>\n                                        </v-menu>\n                                        <v-btn\n                                            color=\"black\"\n                                            outlined\n                                            class=\"text-capitalize  black--text float-left\"\n                                            @click=\"cancel\"\n                                        >{{ $t(\"cancel\") }}\n                                        </v-btn>\n                                        <!--                    <v-menu>-->\n                                        <!--                      <template v-slot:activator=\"{ on }\">-->\n                                        <!--                        <v-btn color=\"primary\"-->\n                                        <!--                               class=\"ml-2 float-right text-capitalize  white&#45;&#45;text\"-->\n                                        <!--                               v-on=\"on\">-->\n                                        <!--                          {{ $t('save_option') }}-->\n                                        <!--                          <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>-->\n                                        <!--                        </v-btn>-->\n                                        <!--                      </template>-->\n                                        <!--                      <v-list rounded>-->\n                                        <!--                        <v-list-item-group>-->\n                                        <!--                          <v-list-item>-->\n                                        <!--                            <v-list-item-content>-->\n                                        <!--                              <v-list-item-title v-if=\"!isEdit\" @click=\"saveNew\">-->\n                                        <!--                                {{ $t('save_new') }}-->\n                                        <!--                              </v-list-item-title>-->\n                                        <!--                            </v-list-item-content>-->\n                                        <!--                          </v-list-item>-->\n                                        <!--                          <v-list-item>-->\n                                        <!--                            <v-list-item-content>-->\n                                        <!--                              <v-list-item-title @click=\"saveClose\">{{-->\n                                        <!--                                  $t('save_close')-->\n                                        <!--                                }}-->\n                                        <!--                              </v-list-item-title>-->\n                                        <!--                            </v-list-item-content>-->\n                                        <!--                          </v-list-item>-->\n                                        <!--                        </v-list-item-group>-->\n                                        <!--                      </v-list>-->\n                                        <!--                    </v-menu>-->\n                                        <v-btn\n                                            color=\"primary\"\n                                            :disabled=\"btnDisabled\"\n                                            class=\"float-right white--text text-capitalize \"\n                                            @click=\"saveClose\">\n                                            {{ $t(\"save_close\") }}\n                                        </v-btn>\n                                        <v-btn color=\"secondary\"\n                                               style=\"margin-right: 10px !important\"\n                                               :disabled=\"btnDisabled\"\n                                               class=\"white--text float-right text-capitalize\"\n                                               @click=\"saveNew\" :hidden=\"hiddenButton\">{{ $t(\"save_new\") }}\n                                        </v-btn>\n                                    </v-card>\n                                </v-form>\n                            </v-col>\n                            <v-col\n                                class=\"smallSide pl-2 pt-0\"\n                                sm=\"4\"\n                                style=\"transition: .3s ease-in;\"\n                                :class=\"{ hide_small_bar_class: isHideBar }\">\n                                <div class=\"d-flex justify-end\">\n                                    <h3 style=\"color: #b3b5bc; font-size:20px;\"\n                                        v-if=\"!isHideBar\"\n                                        class=\"text-uppercase\">\n                                        <span class=\"pointer\" @click=\"Help('sale quote')\">{{ $t(\"help\") }}</span>\n                                        <v-icon\n                                            @click=\"cancel()\"\n                                            style=\"cursor: pointer; color: #333333; font-size: 40px;\"\n                                            class=\"float-right mt-n1\">close\n                                        </v-icon>\n                                    </h3>\n                                </div>\n\n                                <div v-if=\"!isHideBar\" class=\"small_sidebar mt-2 px-4 rounded-4 grayBg\">\n                                    <v-card style=\"margin-bottom: 2px;\" outlined dense\n                                            class=\"pa-3 no_border my_card rounded-4 white--text\"\n                                            color=\"primary\" height=\"60px\">\n                                        <h3 class=\"text-left font_13 flex-1 text-uppercase\">{{ $t('amount_due') }}</h3>\n                                        <h3 class=\"text-right flex-1 font_20 niradei_heavy\">\n                                            {{ numberFormat(transaction.total) }} </h3>\n                                    </v-card>\n                                    <v-row>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"pt-4\">\n                                            <!-- <h4  style=\"line-height: 18px;\" class=\"mb-1 text-uppercase\">{{ $t('analysis') }}</h4> -->\n                                            <label class=\"label\">{{ $t(\"segment\") }}</label>\n                                            <v-select\n                                                class=\"mt-1\"\n                                                v-model=\"transaction.segment\"\n                                                :items=\"segments\"\n                                                item-value=\"id\"\n                                                :item-text=\"(item) => `${item.code} - ${item.name}`\"\n                                                return-object\n                                                :rules=\"[(v) => !!v || 'Segment is required']\"\n                                                tage=\"segment\"\n                                                placeholder=\"Segment\"\n                                                outlined=\"\"\n                                            />\n                                            <label class=\"label\">{{ $t(\"location\") }}</label>\n                                            <v-select\n                                                class=\"mt-1\"\n                                                v-model=\"transaction.location\"\n                                                :items=\"locations\"\n                                                item-value=\"id\"\n                                                :item-text=\"(item) => `${item.code} - ${item.name}`\"\n                                                return-object\n                                                tage=\"Location\"\n                                                placeholder=\"bu/location\"\n                                                outlined=\"\"\n                                            />\n                                            <label class=\"label font_14\">{{\n                                                    $t(\"sale_channel\")\n                                                }}</label>\n                                            <v-select\n                                                class=\" mt-1\"\n                                                v-model=\"transaction.saleChannel\"\n                                                :items=\"saleChannelList\"\n                                                item-value=\"id\"\n                                                item-text=\"name\"\n                                                return-object\n                                                tage=\"Sale Channel\"\n                                                placeholder=\"Channel\"\n                                                outlined\n                                            />\n                                            <label class=\"label font_14\">{{ $t('employee') }}</label>\n                                            <v-col sm=\"12\" cols=\"12\"\n                                                   class=\"kendo_dropdown_custom pl-0 pr-0 pb-3 pt-1\">\n                                                <dropdownlist\n                                                    :data-items=\"employees\"\n                                                    @change=\"onEmployeeChanged\"\n                                                    :value=\"mEmployee\"\n                                                    :data-item-key=\"'id'\"\n                                                    :text-field=\"'name'\"\n                                                    :default-item=\"defaultItem\"\n                                                    :filterable=\"true\"\n                                                    @filterchange=\"onEmployeeFilterChanged\">\n                                                </dropdownlist>\n                                            </v-col>\n                                            <label class=\"label\">{{ $t(\"for_month_of\") }}</label>\n                                            <app-monthof-picker\n                                                :initMonthOf=\"transaction.monthOf\"\n                                                @emitMonthOf=\"transaction.monthOf = $event\"\n                                            />\n                                        </v-col>\n                                    </v-row>\n                                </div>\n                            </v-col>\n                        </v-row>\n                    </v-card>\n                </v-col>\n            </v-row>\n            <LoadingMe\n                :isLoading=\"showLoading\"\n                :fullPage=\"false\"\n                :myLoading=\"true\"\n                :alertMessage=\"loadingAlert\"\n                :color=\"loadingColorAlert\"\n                :alertText=\"loadingTextAlert\"\n            />\n            <v-dialog v-model=\"dialogTax\" max-width=\"450px\">\n                <v-card>\n                    <div class=\"modal_header\">\n                        <v-card-title>{{ $t(\"tax_list\") }}</v-card-title>\n                        <v-icon class=\"btn_close\" @click=\"dialogTax = false\">close</v-icon>\n                    </div>\n                    <v-card-text class=\"modal_text_content\">\n                        <v-row>\n                            <v-col sm=\"12\" cols=\"12\" class=\"pb-0\">\n                                <v-simple-table>\n                                    <template v-slot:default>\n                                        <tbody>\n                                        <tr\n                                            v-for=\"(value, name) in taxListTotal\"\n                                            v-bind:key=\"name\"\n                                        >\n                                            <td class=\"text-left\" width=\"180px\">{{ name }}</td>\n                                            <td class=\"text-center\">:</td>\n                                            <td class=\"text-right\">\n                                                {{ numberFormat(value) }}\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td class=\"text-left\" width=\"180px\">\n                                                {{ $t(\"total\") }}\n                                            </td>\n                                            <td class=\"text-center\">:</td>\n                                            <td class=\"text-right\">\n                                                {{ numberFormat(transaction.totalTaxAmount) }}\n                                            </td>\n                                        </tr>\n                                        </tbody>\n                                    </template>\n                                </v-simple-table>\n                            </v-col>\n                        </v-row>\n                    </v-card-text>\n                    <v-divider/>\n                </v-card>\n            </v-dialog>\n            <v-dialog v-model=\"dialogCatalog\" max-width=\"850px\">\n                <v-card>\n                    <div class=\"modal_header\">\n                        <v-card-title>{{ $t(\"catalog\") }}</v-card-title>\n                        <v-icon @click=\"dialogCatalog = false\"\n                        >close\n                        </v-icon\n                        >\n                    </div>\n                    <v-card-text class=\"modal_text_content\">\n                        <v-row>\n                            <v-col sm=\"12\" cols=\"12\" class=\"pb-0\">\n                                <v-simple-table>\n                                    <kendo-datasource\n                                        ref=\"catalogDatasource\"\n                                        :data=\"catalogs\"\n                                        :schema=\"gridSchema\"\n                                    />\n                                    <kendo-grid\n                                        id=\"gridCatalog\"\n                                        class=\"grid-function\"\n                                        :data-source-ref=\"'catalogDatasource'\"\n                                        :style=\"{ width: '100%' }\"\n                                        :noRecords=\"true\"\n                                        :pageable-numeric=\"false\"\n                                        :pageable-previous-next=\"false\"\n                                        :pageable-messages-display=\"'Showing {2} data items'\"\n                                        :scrollable-virtual=\"true\"\n                                    >\n                                        <kendo-grid-column\n                                            :field=\"'images'\"\n                                            :title=\"$t('image')\"\n                                            :width=\"50\"\n                                            :template=\"loadImage\"\n                                            :headerAttributes=\"{ style: 'background-color: #EDF1F5' }\"\n                                        />\n                                        <kendo-grid-column\n                                            :field=\"'number'\"\n                                            :title=\"$t('number')\"\n                                            :width=\"70\"\n                                            :template=\"'<span>#=number#</span>'\"\n                                            :groupHeaderColumnTemplate=\"'#=value#'\"\n                                            :headerAttributes=\"{ style: 'background-color: #EDF1F5' }\"\n                                        />\n                                        <kendo-grid-column\n                                            :field=\"'name'\"\n                                            :title=\"$t('name')\"\n                                            :attributes=\"{ class: 'tb_name_td' }\"\n                                            :width=\"100\"\n                                            :template=\"'<span>#=name#</span>'\"\n                                            :headerAttributes=\"{ style: 'background-color: #EDF1F5' }\"\n                                        />\n                                        <kendo-grid-column\n                                            :field=\"'description'\"\n                                            :title=\"$t('description')\"\n                                            :width=\"100\"\n                                            :template=\"'<span>#=description#</span>'\"\n                                            :headerAttributes=\"{ style: 'background-color: #EDF1F5' }\"\n                                        />\n                                        <kendo-grid-column\n                                            :field=\"'noOfProduct'\"\n                                            :title=\"$t('products')\"\n                                            :template=\"'<span>#=noOfProduct#</span>'\"\n                                            :width=\"50\"\n                                            :headerAttributes=\"{\n                        style: 'text-align: left; background-color: #EDF1F5',\n                      }\"\n                                        />\n                                        <kendo-grid-column\n                                            :field=\"''\"\n                                            :title=\"$t('action')\"\n                                            :width=\"60\"\n                                            :command=\"[{ text: $t('add'), click: addCatalog }]\"\n                                            :headerAttributes=\"{\n                        style: 'text-align: left; background-color: #EDF1F5',\n                      }\"\n                                        />\n                                    </kendo-grid>\n                                </v-simple-table>\n                            </v-col>\n                        </v-row>\n                    </v-card-text>\n                    <v-divider/>\n                </v-card>\n            </v-dialog>\n        </v-container>\n    </v-app>\n</template>\n\n<script>\n// import LoadingMe from '@/components/Loading'\nimport {i18n} from \"@/i18n\";\nimport DatePickerComponent from \"@/components/custom_templates/DatePickerComponent\";\nimport kendo from \"@progress/kendo-ui\";\nimport {DropDownList} from \"@progress/kendo-vue-dropdowns\";\nimport SaleFormContentModel from \"@/scripts/model/SaleFormContent\";\nimport ItemLineModel from \"@/scripts/invoice/model/ItemLine\";\nimport {uuid} from \"vue-uuid\";\nimport TransactionModel from \"@/scripts/model/Transaction\";\n\n/* Store */\nimport store from \"@/store\"\n\nconst institute = store.state.institute.institute\n\nimport {ShowResource} from \"@/observable/store\";\nimport paymentTermHandler_ from \"@/scripts/paymentterm/handler/paymentTermHandler\";\nimport creditLimitHandler from \"@/scripts/creditLimit/handler/creditLimitHandler\";\n////handler\nconst transactionHandler = require(\"@/scripts/transactionHandler\");\nconst billingHandler = require(\"@/scripts/invoice/handler/billingHandler\");\nconst customerHandler = require(\"@/scripts/customerHandler\");\nconst projectHandler = require(\"@/scripts/projectHandler\");\nconst prefixHandler = require(\"@/scripts/prefixHandler\");\nconst paymentTermHandler = require(\"@/scripts/paymentTermHandler\");\nconst priceLevelHandler = require(\"@/scripts/priceLevelHandler\");\nconst saleFormContentHandler = require(\"@/scripts/saleFormContentHandler\");\nconst employeeHandler = require(\"@/scripts/employeeHandler\");\nconst itemModifierHandler = require(\"@/scripts/itemModifierHandler\");\nconst discountItemHandler = require(\"@/scripts/discountItemHandler\");\nconst uomPriceHandler = require(\"@/scripts/uomPriceHandler\");\nconst productVariantHandler = require(\"@/scripts/productVariantHandler\");\nconst otherChargeHandler = require(\"@/scripts/otherChargeHandler\");\nconst locationHandler = require(\"@/scripts/locationHandler\");\nconst settingsHandler = require(\"@/scripts/settingsHandler\");\nconst saleChannelHandler = require(\"@/scripts/saleChannelHandler\");\nconst saleUnitItemHandler = require(\"@/scripts/saleUnitItemHandler\");\nconst settingHandler = require(\"@/scripts/settingHandler\");\nconst catalogHandler = require(\"@/scripts/catalogHandler\");\nconst productHandler = require(\"@/scripts/productHandler\");\nconst currencyHandler = require(\"@/scripts/currency/handler/currencyHandler\");\n\nconst saleFormContentModel = new SaleFormContentModel({});\nconst itemLineModel = new ItemLineModel({});\n//other\nconst $ = kendo.jQuery\nconst textField = \"numberName\";\nconst keyField = \"id\";\nconst defaultItem = {[textField]: \"Select customer...\", [keyField]: null};\nconst emptyItem = {[textField]: \"loading ...\"};\nconst invoicePrefix = \"lin-\";\nconst DISCOUNT_TYPE = \"?type=Sale\";\nconst cookieJS = require(\"@/cookie.js\");\nconst cookie = cookieJS.getCookie();\nconst {dataStore} = require(\"@/observable/store\");\n\nexport default {\n    name: \"SaleQuote\",\n    props: {\n        id: {\n            type: String,\n        },\n        initSaleQuote: {\n            type: TransactionModel,\n        },\n    },\n    components: {\n        LoadingMe: () => import(`@/components/Loading`),\n        \"app-datepicker\": DatePickerComponent,\n        dropdownlist: DropDownList,\n        \"app-monthof-picker\": () =>\n            import(\"@/components/kendo_templates/MonthOfPicker\"),\n    },\n    data: () => ({\n        transaction: new TransactionModel(),\n        isEdit: false,\n        numSelect: [1],\n        dialogTax: false,\n        //Catalog\n        dialogCatalog: false,\n        gridSchema: {\n            model: {\n                id: \"id\",\n            },\n        },\n        catalogs: [],\n        imgURL: \"https://s3-ap-southeast-1.amazonaws.com/images.banhji/\",\n        // LoadingMe\n        showLoading: false,\n        loadingAlert: false,\n        loadingColorAlert: \"\",\n        loadingTextAlert: \"\",\n        bill_date: \"\",\n        alert: false,\n        files: [],\n        errors: [],\n        // Form validation\n        valid: true,\n        templates: [\n            {title: \"Draft\"},\n            {title: \"Open\"},\n            {title: \"Partially Closed\"},\n            {title: \"Closed\"},\n        ],\n        col_expand: 9,\n        col_hide: 3,\n        isHideBar: false,\n        filter: \"\",\n        textField: \"numberName\",\n        dataItemKey: \"id\",\n        defaultItem: defaultItem,\n        mOtherCharge: [],\n        //item\n        itemLines: [],\n        itemLine: itemLineModel,\n        dateFormat: itemLineModel.dateFormat,\n        //customer\n        cusBaseUrl: customerHandler.searchv1(),\n        empBaseUrl: employeeHandler.search(),\n        customer: {},\n        customerList: [],\n        billingAddress: [],\n        deliveryAddress: [],\n        priceLevel: [],\n        //date\n        paymentTerms: [],\n        transactions: [],\n        employees: [],\n        mEmployee: {},\n        saleChannelList: [],\n        locations: [],\n        customerProjects: [],\n        segments: [],\n        transactionType: {},\n        taxListTotal: {},\n        customerDiscountItem: [],\n        customerSaleUnit: [],\n        saleFormContent: saleFormContentModel,\n        transactionDate: new Date().toISOString().substr(0, 10),\n        deliveryDateTime: new Date().toISOString().substr(0, 10),\n        validityDate: new Date().toISOString().substr(0, 10),\n        specificDiscountItem: [],\n        otherChargeList: [],\n        saleUnitItemList: [],\n        otherTax: [],\n        specificTax: [],\n        publicLightingTax: [],\n        vatTax: [],\n        tax: [],\n        loggedUser: {\n            id: cookie.creator,\n            name: cookie.email\n        },\n        leads: [],\n        monthOf: '',\n        isSaveNew: false,\n        isSaveClose: false,\n        isSavePrint: false,\n        isSaveDraft: false,\n        exchangeRate: {},\n        baseCurrencyCode: \"\",\n        currencyCode: \"\",\n        transactionRate: 1,\n        saveOption: \"\",\n        schemaModelFields: {\n            uom: {validation: {required: true}},\n            price: {validation: {required: true}},\n        },\n        isPriceLevelChanged: false,\n        templatesForm: [\n            {\n                id: 1,\n                type: \"Sale Quote\",\n                name: \"Sale Quote\",\n            }\n        ],\n        template: 0,\n        btnDisabled: false\n    }),\n    methods: {\n        ChoseTemplate(i) {\n            this.template = i;\n        },\n        async loadEmployeeCenter() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    this.employees = [];\n                    employeeHandler\n                        .center(undefined)\n                        .then((res) => {\n                            this.showLoading = true;\n                            this.transaction.employee = {}\n                            this.employees = []\n                            if (res.data.statusCode === 200) {\n                                this.showLoading = false;\n                                this.employees = res.data.data;\n                                // if (this.employees.length > 0) {\n                                //     this.transaction.employee = this.employees[0];\n                                // }\n                            } else {\n                                this.showLoading = false;\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 10);\n            });\n        },\n        numberEditor(container, options) {\n            kendo\n                .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoNumericTextBox({\n                    decimals: 30,\n                    min: 0.0001,\n                    format: `${this.saleFormContent.decimal}`,\n                });\n        },\n        amountFormat(value) {\n            return kendo.toString(value.amount, `n${this.saleFormContent.decimal}`);\n        },\n        priceFormat(value) {\n            return kendo.toString(value.price, `n${this.saleFormContent.decimal}`);\n        },\n        Help(key_search) {\n            ShowResource(key_search);\n        },\n        initialData() {\n            if (this.initSaleQuote) {\n                // Edit Mode\n                this.transaction = this.initSaleQuote;\n                this.bindData();\n            } else {\n                // Brand New Mode\n                if (this.$route.params.id === undefined) {\n                    this.setDefaultData();\n                } else {\n                    this.loadViewSaleQuote();\n                }\n            }\n        },\n        setDefaultData() {\n            // Brand New Mode\n            this.isEdit = false;\n            //set default segment\n            // let s = {};\n            // if (this.segments.length > 0) {\n            //     s = this.segments[0];\n            // }\n            // //set default location\n            // let l = {};\n            // if (this.locations.length > 0) {\n            //     l = this.locations[0];\n            // }\n            // //set default employee\n            // let e = {};\n            // if (this.employees.length > 0) {\n            //     e = this.employees[0];\n            // }\n            // //transaction type\n            // let tt = {};\n            // if (this.transactionType.length > 0) {\n            //     tt = this.transactionType[0];\n            // }\n            // //payment term\n            // let p = {};\n            // if (this.paymentTerms.length > 0) {\n            //     p = this.paymentTerms[0];\n            // }\n            // //price level\n            // let pl = {};\n            // if (this.priceLevel.length > 0) {\n            //     pl = this.priceLevel[0];\n            // }\n            // //sale chanel\n            // let sc = {};\n            // if (this.saleChannelList.length > 0) {\n            //     sc = this.saleChannelList[0];\n            // }\n            this.transaction = new TransactionModel();\n            // Generate Number\n            this.itemLines = []\n            let ds = this.$refs.saleQuoteItemLineDS.kendoWidget();\n            ds.data([]);\n            // Add 2 default lines\n            // this.removeEmptyLine()\n            setTimeout(() => {\n                // this.addRow()\n                this.addRow()\n            }, 500)\n            // this.loadLead();\n            // this.loadSaleChannel();\n            // this.loadEmployeeCenter()\n            this.otherChargeList = []\n            this.mOtherCharge = []\n            this.taxListTotal = {}\n            this.mEmployee = {}\n            // this.loadLead()\n            this.leads = []\n        },\n        bindData() {\n            // Edit Mode\n            this.isEdit = true;\n            this.customer = this.transaction.customer;\n            // this.onChange(e)\n            this.billingAddress = this.transaction.customer.billingAddress;\n            this.deliveryAddress = this.transaction.customer.deliveryAddress;\n            this.taxListTotal = this.transaction.taxListTotal;\n            this.itemLines = this.transaction.itemLines;\n            this.mOtherCharge = this.transaction.otherCharge;\n            this.loadProjectByCustomer();\n            if (this.customer.hasOwnProperty(\"id\")) {\n                this.loadCustomerBalance(this.customer.id);\n            }\n        },\n        addSelect() {\n            let amount_num = this.numSelect.length;\n            let num = this.numSelect[amount_num - 1];\n            let new_num = num + 1;\n            let lenghtItem = this.specificDiscountItem.length;\n            if (new_num <= lenghtItem) {\n                this.numSelect.push(new_num);\n            }\n        },\n        removeSelect(index) {\n            this.numSelect.splice(index, 1);\n            // window.console.log(index, this.numSelect)\n            // this.selectDiscount.splice(index,1)\n            // window.console.log(\"remove\",this.selectDiscount)\n            // this.selectDiscount = this.selectDiscount.filter(item =>  item.id != val.id);\n        },\n        errorMessage() {\n        },\n        accountDropDownEditor() {\n        },\n        cancel() {\n            this.$swal({\n                title: i18n.t(\"msg_title_warning\"),\n                text: i18n.t(\"msg_discard\"),\n                icon: \"warning\",\n                showCancelButton: true,\n                cancelButtonText: i18n.t(\"cancel\"),\n                confirmButtonColor: \"#4d4848\",\n                cancelButtonColor: \"#ED1A3A\",\n                confirmButtonText: i18n.t(\"discard\"),\n            }).then((result) => {\n                if (result.value) {\n                    this.clear();\n                    this.$router.go(-1);\n                }\n            });\n        },\n        hide_smallsitebar() {\n            this.isHideBar = !this.isHideBar;\n        },\n        //number\n        generateNumber() {\n            // window.console.log('generateNumber')\n            let d = new Date().toISOString().substr(0, 10);\n            if (this.transaction.transactionDate) {\n                // window.console.log(this.transactionDate)\n                d = this.transaction.transactionDate;\n            }\n            let data = {\n                abbr: this.transaction.transactionType.abbr,\n                structure: this.transaction.transactionType.structure,\n                prefixSeparator: this.transaction.transactionType.prefixSeparator || '',\n                numberSeparator: this.transaction.transactionType.numberSeparator || '',\n                format: this.transaction.transactionType.format || 5,\n                sequcencing: this.transaction.transactionType.sequcencing,\n                transactionDate: d,\n                type: \"Sale Quote\",\n            };\n            this.showLoading = false;\n            billingHandler\n                .lastNumber(data)\n                .then((response) => {\n                    if (response.data.statusCode === 200) {\n                        const res = response.data.data;\n                        const lastNumber = this.zeroPad(\n                            parseInt(res.lastNumber),\n                            this.transaction.transactionType.format\n                        );\n                        const number =\n                            res.suffix +\n                            this.transaction.transactionType.numberSeparator +\n                            lastNumber;\n                        this.transaction.number = number;\n                        this.showLoading = false;\n                    }\n                })\n                .catch((e) => {\n                    this.showLoading = false;\n                    this.errors.push(e);\n                });\n        },\n        zeroPad(num, places) {\n            return String(num).padStart(places, \"0\");\n        },\n        //customer\n        onChange(event) {\n            window.console.log(event, 'customer');\n            const value = event.value;\n            if (value && value[textField] === emptyItem[textField]) {\n                return;\n            }\n            this.customer = value;\n            this.transaction.customer = value;\n            // this.invoice = value\n            window.console.log(value, 'customer')\n            this.transaction.priceLevel = value.priceLevel ? value.priceLevel : {}\n            this.billingAddress = value.hasOwnProperty(\"billingAddress\")\n                ? value.billingAddress\n                : [];\n            this.deliveryAddress = value.hasOwnProperty(\"deliveryAddress\")\n                ? value.deliveryAddress\n                : [];\n            if (this.billingAddress.length > 0) {\n                this.transaction.billingAddress = this.billingAddress[0];\n            }\n            if (this.deliveryAddress.length > 0) {\n                this.transaction.deliveryAddress = this.deliveryAddress[0];\n            }\n            this.onQuoteDateChanged();\n            this.loadProjectByCustomer();\n            const priceLevel = value.hasOwnProperty(\"priceLevel\")\n                ? value.priceLevel\n                : {};\n            const baseCurrency = value.hasOwnProperty(\"baseCurrency\")\n                ? value.baseCurrency\n                : {};\n            if (baseCurrency.hasOwnProperty(\"code\")) {\n                this.baseCurrencyCode = baseCurrency.code;\n            }\n            if (priceLevel.hasOwnProperty(\"currency\")) {\n                if (priceLevel.currency.hasOwnProperty(\"id\")) {\n                    this.loadTransactionRate();\n                }\n            }\n            // const creditLimit = value.hasOwnProperty(\"creditLimit\")\n            //     ? value.creditLimit\n            //     : 0;\n            // this.transaction.creditLimit = kendo.parseFloat(creditLimit);\n            // this.loadCustomerBalance(this.customer.id);\n            // this.loadPaymentTermList();\n            // this.loadCreditLimit();\n        },\n        onFilterChange(event) {\n            const filter = event.filter.value;\n            this.requestData(0, filter, this.cusBaseUrl);\n            this.filter = filter;\n        },\n        requestData(skip, filter, baseUrl) {\n            const url = baseUrl + `?filter=${filter}`;\n            this.requestStarted = true;\n            fetch(url)\n                .then((response) => {\n                    return response.json();\n                })\n                .then(this.afterFetch);\n        },\n        requestData_(skip, filter, baseUrl) {\n            const url = baseUrl + `/${filter}`;\n            this.requestStarted = true;\n            fetch(url)\n                .then((response) => {\n                    return response.json();\n                })\n                .then(this.afterFetch_);\n        },\n        afterFetch_(json) {\n            this.employees = json.data;\n        },\n        afterFetch(json) {\n            this.customerList = json.data;\n        },\n        removeRow(e) {\n            e.preventDefault();\n            const grid = kendo.jQuery(\"#gridItemLineSaleQuote\").data(\"kendoGrid\"),\n                dataSource = grid.dataSource,\n                dataItem = grid.dataItem($(e.currentTarget).closest(\"tr\"));\n\n            if (dataSource.total() > 1) {\n                dataSource.remove(dataItem);\n            }\n            this.autoCalculate();\n        },\n        //date\n        async onQuoteDateChanged() {\n            if (this.transaction) {\n                this.transaction.monthOf = new Date(this.transaction.transactionDate).toISOString().substr(0, 7)\n            }\n            await this.loadPaymentTermList();\n            await this.loadCreditLimit();\n            await this.loadCustomerBalance(this.customer.id);\n            await this.onPriceLevelChange();\n            if (this.customer) {\n                const paymentTerm = this.customer.paymentTerm || {}\n                const netDue = paymentTerm.netDue;\n                let someDate = new Date(this.transaction.transactionDate);\n                someDate.setDate(someDate.getDate() + parseInt(netDue)); //number  of days to add, e.x. 15 days\n                // window.console.log(someDate, 'this.transaction.validityDate ')\n                // this.transaction.validityDate = someDate.toISOString().substr(0, 10);\n            }\n            if (this.$route.params.id === undefined) {\n                // window.console.log(\"onQuoteDateChanged\");\n                this.generateNumber();\n            }\n        },\n        //employee\n        onEmployeeChanged(event) {\n            const value = event.value;\n            if (value && value[textField] === emptyItem[textField]) {\n                return;\n            }\n            this.mEmployee = value;\n            this.transaction.employee = value;\n        },\n        onEmployeeFilterChanged(event) {\n            const filter = event.filter.value;\n            this.requestData_(0, filter, this.empBaseUrl);\n            this.filter_ = filter;\n        },\n        onPaymentTermChanged() {\n            if (this.customer) {\n                const paymentTerm = this.transaction.paymentTerm || {}\n                const netDue = paymentTerm.netDue || 0;\n                const someDate = new Date(this.transaction.transactionDate);\n                someDate.setDate(someDate.getDate() + parseInt(netDue)); //number  of days to add, e.x. 15 days\n                // this.transaction.validityDate = someDate.toISOString().substr(0, 10)\n                // window.console.log(\"im\", someDate, netDue);\n            }\n            // this.onQuoteDateChanged();\n        },\n        //number\n        numberFormat(value) {\n            // window.console.log(this.saleFormContent.decimal,'nimol')\n            return kendo.toString(value, `n${this.saleFormContent.decimal}`);\n            // return value\n        },\n        //\n        async loadLead() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const strFilter = \"?type=Sale Lead\";\n                    billingHandler.list(strFilter).then((res) => {\n                        this.showLoading = false;\n                        let lead = res.data.data.filter((obj) => {\n                            return obj.status != 0;\n                        });\n                        if (lead.length > 0) {\n                            this.leads = lead;\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async loadPaymentTerm() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    paymentTermHandler.getAll().then((res) => {\n                        this.showLoading = false;\n                        this.paymentTerms = res.data.data;\n                        if (this.paymentTerms.length > 0) {\n                            if (\n                                this.$route.params.id !== undefined ||\n                                this.$route.params.id != \"\"\n                            ) {\n                                this.transaction.paymentTerm = this.paymentTerms[0];\n                            }\n                        }\n                    });\n                }, 10);\n            });\n        },\n        onPriceLevelChange() {\n            this.isPriceLevelChanged = true\n            this.loadTransactionRate()\n            this.clearUOMItem()\n        },\n        async loadPriceLevel() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const strFilter = '?nature=sale'\n                    priceLevelHandler.get(strFilter).then((res) => {\n                        this.priceLevel = res;\n                        if (this.priceLevel.length > 0) {\n                            if (\n                                this.$route.params.id !== undefined ||\n                                this.$route.params.id != \"\"\n                            ) {\n                                // this.transaction.priceLevel = this.priceLevel[0];\n                                this.loadTransactionRate();\n                            }\n                        }\n                    });\n                }, 10);\n            });\n        },\n        removeDuplicate(array) {\n            const result = [];\n            const map = new Map();\n            for (const item of array) {\n                if (!map.has(item.id)) {\n                    map.set(item.id, true); // set any value to Map\n                    result.push(item);\n                }\n            }\n            return result;\n        },\n        autoCalculateDiscount(discountItem, subTotal) {\n            if (discountItem) {\n                const nature = discountItem.nature || ''\n                const amount = discountItem.amount || 0\n                if (nature === 'Amount') {\n                    return parseFloat(amount)\n                } else if (nature === 'Percentage') {\n                    return (subTotal * (parseFloat(amount) / 100))\n                } else {\n                    return 0\n                }\n            } else {\n                return 0\n            }\n        },\n        autoCalculateTax(tax, amount) {\n            if (tax) {\n                var formula = tax.formula;\n                var inAmt = kendo.parseFloat(amount);\n                var nAmt = kendo.parseFloat(amount);\n                var taxBase = kendo.parseFloat(tax.taxBase) / 100;\n                var rate = kendo.parseFloat(tax.rate) / 100;\n                var total = eval(formula);\n                window.console.log(inAmt, nAmt, taxBase, rate, formula, total);\n                // window.console.log(amount)\n                return total;\n            }\n            // return 0\n        },\n        autoCalculateTaxByType(tax) {\n            // return by a key\n            const groupAll = (list) =>\n                list.reduce((tax, item) => {\n                    const taxAmount = tax[item.name] || 0;\n                    return Object.assign({}, tax, {\n                        [item.name]: taxAmount + parseFloat(item.amount),\n                    });\n                }, {});\n            this.taxListTotal = groupAll(tax);\n            // window.console.log('nimol', groupAll(tax))\n            // this.\n        },\n        taxMapping(objTax, tax) {\n            const taxId = tax.id || ''\n            const tax_ = objTax.filter(t => t.id === taxId)[0]\n            return tax_ || {\n                id: '',\n                defaultTax: ''\n            }\n        },\n        dataSourceChanged(e) {\n            if (e.field) {\n                let dataRow = e.items[0], vTax = {}, spTax = {}, otTax = {}, plTax = {},\n                    buom = {},\n                    conversionRate = 1,\n                    wac = 0,\n                    qoh = 0,\n                    amount = 0,\n                    xAmount = 0;\n                switch (e.field) {\n                    case \"item\":\n                        // this.attribute_ = this.attributes.filter(m => m.type.id === dataRow.variant.id)\n                        dataRow.set(\"description\", dataRow.item.description);\n                        buom = dataRow.item.uom || {};\n                        dataRow.set(\"buom\", buom);\n                        // dataRow.set('uom', buom)\n                        // window.console.log(dataRow.item,'row')\n                        // await this.inventoryBalance(dataRow, dataRow.item.id)\n                        break;\n                    case \"price\":\n                        try {\n                            amount = parseFloat(dataRow.price) * parseFloat(dataRow.qty);\n                            xAmount = amount * parseFloat(this.transaction.txnRate);\n\n                            dataRow.set(\"price\", parseFloat(dataRow.price));\n                            dataRow.set(\"amount\", amount);\n                            dataRow.set(\"exchangeAmount\", xAmount);\n                            // window.console.log('price',dataRow.price)\n                        } catch {\n                            dataRow.set(\"price\", 0);\n                            dataRow.set(\"amount\", 0);\n                            dataRow.set(\"exchangeAmount\", 0);\n                        }\n                        break;\n                    case \"uom\":\n                        if (this.isPriceLevelChanged === false) {\n                            try {\n                                buom = dataRow.uom.buom || {};\n                                qoh = dataRow.uom.qoh || 0;\n                                conversionRate = dataRow.uom.conversionRate || 1;\n                                wac = dataRow.uom.wac || 0;\n                                dataRow.set(\"buom\", buom);\n                                dataRow.set(\"wac\", wac);\n                                dataRow.set(\"qoh\", qoh);\n                                dataRow.set(\"conversionRate\", parseFloat(conversionRate));\n                                /* todo: mapping tax object */\n                                vTax = this.taxMapping(this.vatTax, dataRow.uom.vatTax || {})\n                                otTax = this.taxMapping(this.otherTax, dataRow.uom.otherTax || {})\n                                spTax = this.taxMapping(this.specificTax, dataRow.uom.specificTax || {})\n                                plTax = this.taxMapping(this.publicLightingTax, dataRow.uom.publicLightingTax || {})\n\n                                dataRow.set(\"vatTax\", vTax);\n                                dataRow.set(\"specificTax\", otTax);\n                                dataRow.set(\"otherTax\", spTax);\n                                dataRow.set(\"publicLightingTax\", plTax);\n\n                                if (dataRow.uom) {\n                                    amount =\n                                        parseFloat(dataRow.uom.price) * parseFloat(dataRow.qty);\n                                    xAmount = amount * parseFloat(this.transaction.txnRate);\n\n                                    dataRow.set(\"price\", parseFloat(dataRow.uom.price));\n                                    dataRow.set(\"amount\", amount);\n                                    dataRow.set(\"exchangeAmount\", xAmount);\n                                } else {\n                                    amount = parseFloat(dataRow.price) * parseFloat(dataRow.qty);\n                                    xAmount = amount * parseFloat(this.transaction.txnRate);\n\n                                    dataRow.set(\"price\", parseFloat(dataRow.price));\n                                    dataRow.set(\"amount\", amount);\n                                    dataRow.set(\"exchangeAmount\", xAmount);\n                                }\n                            } catch (err) {\n                                window.console.log(\"error\", err);\n                                dataRow.set(\"buom\", {});\n                                dataRow.set(\"conversionRate\", 1);\n                                dataRow.set(\"price\", 0);\n                                dataRow.set(\"qoh\", 0);\n                                dataRow.set(\"wac\", 0);\n                                dataRow.set(\"amount\", 0);\n                                dataRow.set(\"exchangeAmount\", 0);\n                            }\n                        }\n                        break;\n                    case \"qty\":\n                        try {\n                            amount = parseFloat(dataRow.price) * parseFloat(dataRow.qty);\n                            xAmount = amount * parseFloat(this.transaction.txnRate);\n\n                            dataRow.set(\"price\", parseFloat(dataRow.price));\n                            dataRow.set(\"amount\", amount);\n                            dataRow.set(\"exchangeAmount\", xAmount);\n                        } catch {\n                            dataRow.set(\"price\", 0);\n                            dataRow.set(\"amount\", 0);\n                            dataRow.set(\"exchangeAmount\", 0);\n                        }\n                        break;\n                    case \"otherTax\":\n                        // window.console.log(\"--\", dataRow)\n                        break;\n                    default:\n                        break;\n                }\n                if (e.field) {\n                    this.autoCalculate();\n                }\n            }\n        },\n        // itemChange(dataItem){\n        //     window.console.log(dataItem)\n        //     this.loadUOMbyItem(dataItem.id)\n        //     // uomPriceHandler.getURL(options.model.item.id, this.quote.priceLevel.id),\n        // },\n        // loadUOMbyItem(item) {\n        //     // uomPriceHandler.getURL(item, this.quote.priceLevel.id).then(response => {\n        //     //     if (response.data.statusCode === 200) {\n        //     //         const res = response.data.data\n        //     //         window.console.log(res);\n        //     //         // const lastNumber = this.zeroPad(parseInt(res.lastNumber), this.quote.prefix.format)\n        //     //         // const number = res.suffix + this.quote.prefix.numberSeparator + lastNumber\n        //     //         // this.quote.number = number\n        //     //     }\n        //     // }).catch(e => {\n        //     //     this.errors.push(e)\n        //     // })\n        //     // new Promise(resolve => {\n        //     //     setTimeout(() => {\n        //     //         resolve('resolved');\n        //     //         uomPriceHandler.getURL(item, this.quote.priceLevel.id).then(res => {\n        //     //             if (res.data.statusCode === 200) {\n        //     //                 const data = res.data.data\n        //     //                 window.console.log(data);\n        //     //             }\n        //     //         })\n        //     //     }, 10)\n        //     // })\n        // },\n        autoCalculate() {\n            let ds = this.$refs.saleQuoteItemLineDS.kendoWidget(),\n                subTotal = 0,\n                totalTax = 0,\n                discountTotal = 0,\n                spTax = 0,\n                pltax = 0,\n                otherTax = 0,\n                vatTax = 0,\n                discountInvoice = 0,\n                taxList = [],\n                discountItem = [],\n                saleUnit = [],\n                inclusiveTax = 0,\n                itemSubtotal = 0,\n                txnItmSubtotal = 0,\n                serviceSubtotal = 0,\n                itemDiscount = 0,\n                serviceDiscount = 0,\n                txnDiscount = 0;\n            const rows = ds.data().filter((m) => parseFloat(m.amount) > 0);\n            rows.forEach((value) => {\n                let modifierPrice = 0;\n                if (value.modifier) {\n                    modifierPrice = kendo.parseFloat(value.modifier.price);\n                }\n\n                // subTotal += (kendo.parseFloat(value.amount) + modifierPrice)\n                let discount = 0;\n                if (value.discountItem) {\n                    let subTo =\n                        kendo.parseFloat(value.price) * kendo.parseFloat(value.qty);\n                    discount = this.autoCalculateDiscount(value.discountItem, subTo);\n                    discount = this.autoCalculateDiscount(value.discountItem, subTo);\n                    value[\"discountAmount\"] = discount;\n                    value[\"discountExchangeAmount\"] =\n                        discount * kendo.parseFloat(this.transaction.txnRate);\n                    if (value.discountItem.hasOwnProperty(\"id\")) {\n                        discountItem.push(value.discountItem);\n                    }\n                    discountTotal += discount;\n                }\n                if (value.saleUnit) {\n                    if (value.saleUnit.hasOwnProperty(\"id\")) {\n                        saleUnit.push(value.saleUnit);\n                    }\n                }\n                if (value.specificTax) {\n                    spTax = this.autoCalculateTax(\n                        value.specificTax,\n                        kendo.parseFloat(value.amount) - kendo.parseFloat(discount)\n                    );\n                    // window.console.log('sp ', discount)\n                    spTax = kendo.parseFloat(spTax) ? kendo.parseFloat(spTax) : 0;\n                    value[\"specificTaxAmount\"] = spTax;\n                    value[\"specificTaxExchangeAmount\"] =\n                        spTax * kendo.parseFloat(this.transaction.txnRate);\n                    const tax = value.specificTax;\n                    const baseAmount = tax.baseAmount;\n                    if (baseAmount) {\n                        if (baseAmount.toLowerCase() === \"inclusive\") {\n                            inclusiveTax += spTax;\n                        }\n                    }\n                    if (value.specificTax.hasOwnProperty(\"taxType\")) {\n                        taxList.push({\n                            name: value.specificTax.taxType.name,\n                            amount: spTax,\n                            id: value.specificTax.taxType.id,\n                        });\n                    }\n                }\n                if (value.publicLightingTax) {\n                    pltax = this.autoCalculateTax(\n                        value.publicLightingTax,\n                        kendo.parseFloat(value.amount) - kendo.parseFloat(discount)\n                    );\n                    pltax = kendo.parseFloat(pltax) ? kendo.parseFloat(pltax) : 0;\n                    value[\"publicLightingTaxAmount\"] = pltax;\n                    value[\"publicLightingTaxExchangeAmount\"] =\n                        pltax * kendo.parseFloat(this.transaction.txnRate);\n                    const tax = value.publicLightingTax;\n                    const baseAmount = tax.baseAmount;\n                    if (baseAmount) {\n                        if (baseAmount.toLowerCase() === \"inclusive\") {\n                            inclusiveTax += pltax;\n                        }\n                    }\n                    if (value.publicLightingTax.hasOwnProperty(\"taxType\")) {\n                        taxList.push({\n                            name: value.publicLightingTax.taxType.name,\n                            amount: pltax,\n                            id: value.publicLightingTax.taxType.id,\n                        });\n                    }\n                }\n                if (value.otherTax) {\n                    otherTax = this.autoCalculateTax(\n                        value.otherTax,\n                        kendo.parseFloat(value.amount) - kendo.parseFloat(discount)\n                    );\n                    otherTax = kendo.parseFloat(otherTax)\n                        ? kendo.parseFloat(otherTax)\n                        : 0;\n                    value[\"otherTaxAmount\"] = otherTax;\n                    value[\"otherTaxExchangeAmount\"] =\n                        otherTax * kendo.parseFloat(this.transaction.txnRate);\n                    const tax = value.publicLightingTax;\n                    const baseAmount = tax.baseAmount;\n                    if (baseAmount) {\n                        if (baseAmount.toLowerCase() === \"inclusive\") {\n                            inclusiveTax += otherTax;\n                        }\n                    }\n                    if (value.otherTax.hasOwnProperty(\"taxType\")) {\n                        taxList.push({\n                            name: value.otherTax.taxType.name,\n                            amount: otherTax,\n                            id: value.otherTax.taxType.id,\n                        });\n                    }\n                }\n\n                if (value.vatTax) {\n                    // window.console.log('Vat Tax', value.vatTax)\n                    let amt =\n                        kendo.parseFloat(spTax ? spTax : 0) +\n                        kendo.parseFloat(pltax ? pltax : 0) +\n                        kendo.parseFloat(otherTax ? otherTax : 0) +\n                        (kendo.parseFloat(value.amount ? value.amount : 0) -\n                            (discount ? discount : 0));\n                    vatTax = this.autoCalculateTax(value.vatTax, amt);\n                    vatTax = kendo.parseFloat(vatTax) ? kendo.parseFloat(vatTax) : 0;\n                    value[\"vatTaxAmount\"] = vatTax;\n                    value[\"vatTaxExchangeAmount\"] =\n                        vatTax * kendo.parseFloat(this.transaction.txnRate);\n                    const tax = value.vatTax;\n                    const baseAmount = tax.baseAmount;\n                    if (baseAmount) {\n                        if (baseAmount.toLowerCase() === \"inclusive\") {\n                            inclusiveTax += vatTax;\n                        }\n                    }\n                    if (value.vatTax.hasOwnProperty(\"taxType\")) {\n                        taxList.push({\n                            name: value.vatTax.taxType.name,\n                            amount: vatTax,\n                            id: value.vatTax.taxType.id,\n                        });\n                    }\n                }\n                totalTax +=\n                    kendo.parseFloat(spTax ? spTax : 0) +\n                    kendo.parseFloat(pltax ? pltax : 0) +\n                    kendo.parseFloat(otherTax ? otherTax : 0) +\n                    kendo.parseFloat(vatTax ? vatTax : 0);\n                subTotal +=\n                    kendo.parseFloat(value.amount) + modifierPrice - inclusiveTax;\n\n                const item = value.item;\n                const itmType = item.type || \"\";\n                if (itmType === \"Variant\") {\n                    itemSubtotal +=\n                        kendo.parseFloat(value.cost) * kendo.parseFloat(value.qty);\n                    itemDiscount += kendo.parseFloat(discount);\n                } else if (itmType === \"Service\") {\n                    serviceSubtotal +=\n                        kendo.parseFloat(value.cost) * kendo.parseFloat(value.qty);\n                    itemDiscount += kendo.parseFloat(discount);\n                } else {\n                    txnItmSubtotal +=\n                        kendo.parseFloat(value.cost) * kendo.parseFloat(value.qty);\n                    itemDiscount += kendo.parseFloat(discount);\n                }\n                //include Tax Amount\n                const amountNodiscount =\n                    kendo.parseFloat(value.price) * kendo.parseFloat(value.qty) -\n                    discount;\n                const includeTaxAmount =\n                    amountNodiscount + vatTax + pltax + spTax + otherTax;\n                value[\"includeTaxAmount\"] = includeTaxAmount;\n                value[\"includeTaxExchangeAmount\"] =\n                    includeTaxAmount * kendo.parseFloat(this.transaction.txnRate);\n            });\n\n            this.transaction.itemSubtotal = itemSubtotal;\n            this.transaction.exchangeItemSubtotal =\n                itemSubtotal * kendo.parseFloat(this.transaction.txnRate);\n            this.transaction.serviceSubtotal = serviceSubtotal;\n            this.transaction.exchangeServiceSubtotal =\n                serviceSubtotal * kendo.parseFloat(this.transaction.txnRate);\n            this.transaction.txnItmSubtotal = txnItmSubtotal;\n            this.transaction.exchangeTxnItmSubtotal =\n                txnItmSubtotal * kendo.parseFloat(this.transaction.txnRate);\n            this.transaction.itemDiscount = itemDiscount;\n            this.transaction.exchangeItemDiscount =\n                itemDiscount * kendo.parseFloat(this.transaction.txnRate);\n            this.transaction.serviceDiscount = serviceDiscount;\n            this.transaction.exchangeServiceDiscount =\n                serviceDiscount * kendo.parseFloat(this.transaction.txnRate);\n            this.transaction.txnItmDiscount = txnDiscount;\n            this.transaction.exchangeTxnItmDiscount =\n                txnDiscount * kendo.parseFloat(this.transaction.txnRate);\n\n            discountTotal = discountTotal ? discountTotal : 0;\n\n            // window.console.log(spTax, pltax, otherTax, vatTax)\n            let total =\n                kendo.parseFloat(subTotal) -\n                kendo.parseFloat(discountTotal) +\n                kendo.parseFloat(totalTax);\n            this.transaction.subTotal = subTotal;\n            $(\"#subtotal\").text(kendo.parseFloat(subTotal));\n            this.transaction.totalTaxAmount = kendo.parseFloat(totalTax);\n            this.transaction.discountTotal = kendo.parseFloat(discountTotal);\n            if (this.transaction.specificDiscountItem) {\n                discountInvoice = this.autoCalculateDiscount(\n                    this.transaction.specificDiscountItem,\n                    kendo.parseFloat(subTotal)\n                );\n                discountInvoice = discountInvoice ? discountInvoice : 0;\n            }\n            // this.onOtherChargeChange()\n            this.transaction.total =\n                kendo.parseFloat(total) -\n                discountInvoice +\n                kendo.parseFloat(this.transaction.otherChargeAmount);\n            this.transaction.exchangeAmount =\n                kendo.parseFloat(this.transaction.total) *\n                kendo.parseFloat(this.transaction.txnRate);\n            this.autoCalculateTaxByType(taxList);\n            this.customerDiscountItem = this.removeDuplicate(discountItem);\n            this.customerSaleUnit = this.removeDuplicate(saleUnit);\n            // window.console.log('discount ', this.customerDiscountItem)\n        },\n        rowNumberTmpl(dataItem) {\n            let ds = this.$refs.saleQuoteItemLineDS.kendoWidget(),\n                index = ds.indexOf(dataItem);\n            return index + 1;\n        },\n        async loadSaleFormContent() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    saleFormContentHandler.list().then((res) => {\n                        if (res.data.statusCode === 200) {\n                            const data = res.data.data;\n                            if (data.length > 0) {\n                                this.saleFormContent = data[0];\n                                // window.console.log(data[0])\n                            }\n                        }\n                    });\n                }, 10);\n            });\n        },\n        vatTemplate(dataItem) {\n            const vat = dataItem.vatTax;\n            if (vat) {\n                return `<span>${vat.defaultTax ? vat.defaultTax : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        itemTemplate(dataItem) {\n            const item = dataItem.item;\n            if (item) {\n                return `<span>${item.name ? item.name : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        UOMTemplate(dataItem) {\n            const uom = dataItem.uom;\n            const code = uom.code || ''\n            if (uom) {\n                return `<span>${uom.uom ? code : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        saleUnitTemplate(dataItem) {\n            const saleUnit = dataItem.saleUnit;\n            if (saleUnit) {\n                return `<span>${saleUnit.name ? saleUnit.name : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        discountItemTemplate(dataItem) {\n            const discountItem = dataItem.discountItem;\n            if (discountItem) {\n                return `<span>${discountItem.code ? discountItem.code : ``} - ${\n                    discountItem.name ? discountItem.name : ``\n                }</span>`;\n            } else {\n                return ``;\n            }\n        },\n        ServiceDateEditor(container, options) {\n            kendo\n                .jQuery('<input required name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDatePicker();\n\n            // let ds = this.$refs.itemLineDS.kendoWidget()\n            // window.console.log(ds.data())\n            // // const dateString = kendo.toString((new Date(options.model.items.serviceDate)), this.itemLine.dateFormat)\n            // // const dateString = kendo.toString(options.model.items.serviceDate)\n            // const $input = $(\"<input value=\" + options.model.serviceDate + \" />\").appendTo(container)\n            // $input.kendoDatePicker()\n            // // $input.appendTo(container)\n            // // options.model.items.serviceDate = dateString\n            // window.console.log($input)\n        },\n        ServiceDateToEditor(container, options) {\n            kendo\n                .jQuery('<input required name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDatePicker();\n        },\n        ItemDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"contains\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    headerTemplate:\n                        '<div class=\"dropdown-header k-widget k-header\">' +\n                        \"<span>Items </span>\" +\n                        \"<span></span>\" +\n                        \"</div>\",\n                    template: \"<span>#=name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        serverFiltering: true,\n                        transport: {\n                            read: {\n                                url: productVariantHandler.itemSearchURL('?plId=' + this.transaction.priceLevel.id),\n                            },\n                            dataType: \"json\",\n                        },\n                        schema: {\n                            model: {\n                                id: \"id\",\n                                fields: {\n                                    id: {type: \"string\"},\n                                    name: {type: \"string\"},\n                                    sku: {type: \"string\"},\n                                },\n                            },\n                            data: function (response) {\n                                return response.data;\n                            },\n                            total: function (response) {\n                                return response.data.count;\n                            },\n                        },\n                        // data: this.variants\n                    }),\n                });\n        },\n        UOMDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"code\",\n                    dataValueField: \"uomConvertId\",\n                    cascadeFrom: \"item\",\n                    template: \"<span>#=code || `No Price Level`#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        serverFiltering: true,\n                        transport: {\n                            read: {url: uomPriceHandler.uomPriceByPriceLevelURL(\"id=\" + options.model.item.id + \"&plId=\" + this.transaction.priceLevel.id + \"&date=\" + this.transaction.transactionDate),},\n                            dataType: \"json\",\n                        },\n                        schema: {\n                            model: {\n                                id: \"id\",\n                                fields: {\n                                    id: {type: \"string\"},\n                                    // name: {type: \"string\"},\n                                    // sku: {type: \"string\"},\n                                },\n                            },\n                            data: function (response) {\n                                return response.data;\n                            },\n                            total: function (response) {\n                                return response.data.count;\n                            },\n                        },\n                        // data: this.variants\n                    }),\n                });\n        },\n        DiscountItemDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    cascadeFrom: \"item\",\n                    template: \"<span>#=code# - #=name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        serverFiltering: true,\n                        transport: {\n                            read: {\n                                url: discountItemHandler.getURL(DISCOUNT_TYPE),\n                            },\n                            dataType: \"json\",\n                        },\n                        schema: {\n                            model: {\n                                id: \"id\",\n                                fields: {\n                                    id: {type: \"string\"},\n                                    // name: {type: \"string\"},\n                                    // sku: {type: \"string\"},\n                                },\n                            },\n                            data: function (response) {\n                                return response.data;\n                            },\n                            total: function (response) {\n                                return response.data.count;\n                            },\n                        },\n                    }),\n                });\n        },\n        SpecificTaxDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"defaultTax\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=defaultTax#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.specificTax.filter((m) => {\n                            if (options.model.hasOwnProperty(\"vatTax\")) {\n                                const vat = options.model.vatTax;\n                                if (vat) {\n                                    if (\n                                        options.model.vatTax !== null ||\n                                        options.model.vatTax !== \"null\"\n                                    ) {\n                                        if (options.model.vatTax.baseAmount) {\n                                            return (\n                                                m.baseAmount.toLowerCase() ===\n                                                options.model.vatTax.baseAmount.toLowerCase()\n                                            );\n                                        } else {\n                                            return m;\n                                        }\n                                    }\n                                } else {\n                                    return m;\n                                }\n                            }\n                        }),\n                    }),\n                });\n        },\n        PublicLightingTaxDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"defaultTax\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=defaultTax#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.publicLightingTax.filter((m) => {\n                            if (options.model.hasOwnProperty(\"vatTax\")) {\n                                const vat = options.model.vatTax;\n                                if (vat) {\n                                    if (\n                                        options.model.vatTax !== null &&\n                                        options.model.vatTax !== \"null\"\n                                    ) {\n                                        if (options.model.vatTax.baseAmount) {\n                                            return (\n                                                m.baseAmount.toLowerCase() ===\n                                                options.model.vatTax.baseAmount.toLowerCase()\n                                            );\n                                        } else {\n                                            return m;\n                                        }\n                                    }\n                                } else {\n                                    return m;\n                                }\n                            }\n                        }),\n                    }),\n                });\n        },\n        OtherTaxDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"defaultTax\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=defaultTax#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.otherTax.filter((m) => {\n                            if (options.model.hasOwnProperty(\"vatTax\")) {\n                                const vat = options.model.vatTax;\n                                if (vat) {\n                                    if (\n                                        options.model.vatTax !== null &&\n                                        options.model.vatTax !== \"null\"\n                                    ) {\n                                        if (options.model.vatTax.baseAmount) {\n                                            return (\n                                                m.baseAmount.toLowerCase() ===\n                                                options.model.vatTax.baseAmount.toLowerCase()\n                                            );\n                                        } else {\n                                            return m;\n                                        }\n                                    }\n                                } else {\n                                    return m;\n                                }\n                            }\n                        }),\n                    }),\n                });\n        },\n        VatTaxDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"defaultTax\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=defaultTax#</span>\",\n                    optionLabel: \"--Select--\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.vatTax,\n                    }),\n                });\n        },\n        SaleUnitDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=code# - #=name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.saleUnitItemList,\n                    }),\n                });\n        },\n        ModifierDropDownEditor(container, options) {\n            const item = options.model.item || {}\n            const uom = item.uom || {}\n            const itemId = item.id || ''\n            const uomId = uom.id || ''\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"contains\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    headerTemplate:\n                        '<div class=\"dropdown-header k-widget k-header\">' +\n                        \"<span>Modifier </span>\" +\n                        \"<span></span>\" +\n                        \"</div>\",\n                    template: \"<span>#=name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        serverFiltering: true,\n                        transport: {\n                            read: {\n                                url: itemModifierHandler.searchURL('?plId=' + this.transaction.priceLevel.id + '&id=' + itemId + '&uomId=' + uomId),\n                            },\n                            dataType: \"json\",\n                        },\n                        schema: {\n                            model: {\n                                id: \"id\",\n                                fields: {\n                                    id: {type: \"string\"},\n                                    name: {type: \"string\"},\n                                    price: {type: \"number\"},\n                                    uom: {type: \"string\"},\n                                },\n                            },\n                            data: function (response) {\n                                return response.data;\n                            },\n                            total: function (response) {\n                                return response.data.count;\n                            },\n                        },\n                    }),\n                });\n        },\n        EmployeeDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoMultiSelect({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    suggest: true,\n                    filter: \"contains\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    headerTemplate:\n                        '<div class=\"dropdown-header k-widget k-header\">' +\n                        \"<span>Employee </span>\" +\n                        \"<span></span>\" +\n                        \"</div>\",\n                    template: \"<span>#=name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        serverFiltering: true,\n                        transport: {\n                            read: {\n                                url: employeeHandler.searchURL(),\n                            },\n                            dataType: \"json\",\n                        },\n                        schema: {\n                            model: {\n                                id: \"id\",\n                                fields: {\n                                    id: {type: \"string\"},\n                                    name: {type: \"string\"},\n                                    firstName: {type: \"string\"},\n                                    lastName: {type: \"string\"},\n                                },\n                            },\n                            data: function (response) {\n                                return response.data;\n                            },\n                            total: function (response) {\n                                return response.data.count;\n                            },\n                        },\n                    }),\n                });\n        },\n        empImpl(dataItem) {\n            let empIds = [];\n            dataItem.employee.forEach((m) => {\n                empIds.push(m.firstName + \" - \" + m.lastName);\n            });\n            // window.console.log(empIds.join(', '))\n            return `<span>${empIds.join(\", \")}</span>`;\n        },\n        addRow() {\n            let ds = this.$refs.saleQuoteItemLineDS.kendoWidget(),\n                total = ds.total();\n            this.itemLine.id = invoicePrefix + uuid.v1();\n            ds.insert(total, this.itemLine);\n        },\n        onSpecificDiscountChanged() {\n            if (this.transaction.specificDiscountItem) {\n                const discountQuote = this.autoCalculateDiscount(\n                    this.transaction.specificDiscountItem,\n                    this.transaction.subTotal\n                );\n                this.transaction.specificDiscountTotal = kendo.toString(\n                    discountQuote ? discountQuote : 0,\n                    \"n\"\n                );\n                let total =\n                    kendo.parseFloat(this.transaction.subTotal) -\n                    (kendo.parseFloat(this.transaction.discountTotal) +\n                        kendo.parseFloat(this.transaction.totalTaxAmount)) -\n                    discountQuote;\n                this.transaction.total = kendo.toString(total, \"n\");\n            }\n        },\n        onOtherChargeChange() {\n            let otherCharge = 0;\n            this.mOtherCharge.forEach((m) => {\n                otherCharge += this.autoCalculateDiscount(m, this.transaction.subTotal);\n            });\n            this.transaction.otherChargeAmount = otherCharge;\n            this.autoCalculate();\n        },\n        async loadOtherCharge() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    otherChargeHandler.list().then((res) => {\n                        if (res.data.statusCode === 200) {\n                            this.otherChargeList = res.data.data;\n                        }\n                    });\n                }, 10);\n            });\n        },\n        onOtherAmount(value) {\n            return this.autoCalculateDiscount(value, this.transaction.subTotal);\n        },\n        async loadDiscountItem() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    discountItemHandler.list(DISCOUNT_TYPE).then((res) => {\n                        if (res.data.statusCode === 200) {\n                            this.specificDiscountItem = res.data.data;\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async loadSegment() {\n            const roleType = dataStore.roleType || 0\n            if (roleType === 0) {\n                if (dataStore.roleData) {\n                    const roleData = dataStore.roleData || []\n                    const segment = roleData.filter(itm => itm.type === 'segment')\n                    const segmentDefault = segment.filter(m => m.isDefault === 1)\n                    this.segments = segment\n                    if (this.$route.params.id === undefined || this.$route.params.id === '') {\n                        if (segmentDefault.length > 0) {\n                            this.transaction.segment = segmentDefault[0];\n                        }\n                    }\n                }\n            } else if (roleType === 1) {\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        this.segments = [];\n                        settingsHandler\n                            .getSeg()\n                            .then((res) => {\n                                this.showLoading = true;\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    this.segments = res.data.data;\n                                    if (this.segments.length > 0) {\n                                        this.transaction.segment = this.segments[0];\n                                    }\n                                }\n                            })\n                            .catch();\n                        {\n                            this.showLoading = false;\n                        }\n                    }, 10);\n                });\n            }\n        },\n        async loadLocation() {\n            this.locations = []\n            const roleType = dataStore.roleType || 0\n            if (roleType === 0) {\n                if (dataStore.roleData) {\n                    const roleData = dataStore.roleData || []\n                    const location = roleData.filter(itm => itm.type === 'location')\n                    const locationDefault = location.filter(m => m.isDefault === 1)\n                    this.locations = location\n                    if (this.$route.params.id === undefined || this.$route.params.id === '') {\n                        if (locationDefault.length > 0) {\n                            this.transaction.location = locationDefault[0];\n                        }\n                    }\n                }\n            } else if (roleType === 1) {\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        this.locations = [];\n                        locationHandler\n                            .list()\n                            .then((res) => {\n                                this.showLoading = true;\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    this.locations = res.data.data;\n                                    if ( this.locations.length > 0) {\n                                        this.transaction.location = this.locations[0];\n                                    }\n                                }\n                            })\n                            .catch();\n                        {\n                            this.showLoading = false;\n                        }\n                    }, 10);\n                });\n            }\n\n        },\n        async loadProjectByCustomer() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    projectHandler\n                        .getByCustomer(this.customer.id)\n                        .then((res) => {\n                            this.showLoading = true;\n                            if (res.data.statusCode === 200) {\n                                this.showLoading = false;\n                                this.customerProjects = res.data.data;\n                                if (this.customerProjects.length > 0) {\n                                    if (!this.initSaleQuote) {\n                                        this.transaction.project = this.customerProjects[0];\n                                    }\n                                }\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 10);\n            });\n        },\n        async loadSaleChannel() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    this.showLoading = true;\n                    saleChannelHandler.get().then((res) => {\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false;\n                            this.saleChannelList = res.data.data;\n                            if (this.saleChannelList.length > 0) {\n                                if (\n                                    this.$route.params.id !== undefined ||\n                                    this.$route.params.id != \"\"\n                                ) {\n                                    this.transaction.saleChannel = this.saleChannelList[0];\n                                }\n                            }\n                        } else {\n                            this.showLoading = false;\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async loadTax() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    settingHandler.get().then((res) => {\n                        this.tax = res;\n                        this.otherTax = this.tax.filter(\n                            (m) =>\n                                (m.taxType.typeId === 7 || m.taxType.typeId === 10) &&\n                                m.transactionType === \"Sale\"\n                        ); // valuable tax\n                        this.specificTax = this.tax.filter(\n                            (m) =>\n                                (m.taxType.typeId === 8 || m.taxType.typeId === 10) &&\n                                m.transactionType === \"Sale\"\n                        ); // valuable tax\n                        this.publicLightingTax = this.tax.filter(\n                            (m) =>\n                                (m.taxType.typeId === 9 || m.taxType.typeId === 10) &&\n                                m.transactionType === \"Sale\"\n                        ); // valuable tax\n                        this.vatTax = this.tax.filter(\n                            (m) =>\n                                (m.taxType.typeId === 1 ||\n                                    m.taxType.typeId === 8 ||\n                                    m.taxType.typeId === 10) &&\n                                m.transactionType === \"Sale\"\n                        ); // valuable tax\n                    });\n                }, 10);\n            });\n        },\n        async loadSaleUnitItems() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    saleUnitItemHandler.list().then((res) => {\n                        if (res.data.statusCode === 200)\n                            this.saleUnitItemList = res.data.data;\n                    });\n                }, 10);\n            });\n        },\n        close(data) {\n            this.loadEmployeeCenter()\n            this.transaction.customer = {};\n            let ds = this.$refs.saleQuoteItemLineDS.kendoWidget();\n            ds.data([]);\n            this.showLoading = false;\n            this.transaction = new TransactionModel({});\n            this.addRow()\n            window.history.go(-1);\n            // if (this.$route.params.id === undefined) {\n            //   this.$router.push({\n            //     name: \"Customers\",\n            //     params: {\n            //       data: data,\n            //     }\n            //   })\n            // } else {\n            //   window.history.go(-1)\n            // }\n            window.console.log(data, \"close\");\n            // localStorage.data.id = JSON.stringify(data)\n        },\n        //catalog\n        loadImage(dataItem) {\n            if (dataItem.hasOwnProperty(\"images\")) {\n                if (dataItem.images.hasOwnProperty(\"default\")) {\n                    const url = this.imgURL + dataItem.images.default.thumb;\n                    return (\n                        \"<img width='50' height='50' style= 'margin: auto;display: block;' src='\" +\n                        url +\n                        \"' />\"\n                    );\n                }\n            } else {\n                return \"\";\n            }\n        },\n        async loadCatalogs() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    this.showLoading = true;\n                    catalogHandler.get().then((res) => {\n                        this.showLoading = false;\n                        this.catalogs = res;\n                    });\n                }, 10);\n            });\n        },\n        addCatalog(e) {\n            e.preventDefault();\n            let grid = kendo.jQuery(\"#gridCatalog\").data(\"kendoGrid\");\n            let dataItem = grid.dataItem($(e.currentTarget).closest(\"tr\"));\n            // window.console.log(dataItem)\n            if (dataItem.variants.length > 0) {\n                dataItem.variants.forEach((m) => {\n                    if (m.hasOwnProperty(\"variant\")) {\n                        if (m.variant.hasOwnProperty(\"id\")) {\n                            this.loadSingleItem(m.variant.id, \"i\");\n                        }\n                    }\n                });\n                this.dialogCatalog = false;\n            }\n            if (dataItem.services.length > 0) {\n                dataItem.services.forEach((m) => {\n                    if (m.hasOwnProperty(\"service\")) {\n                        if (m.service.hasOwnProperty(\"id\")) {\n                            this.loadSingleItem(m.service.id, \"s\");\n                        }\n                    }\n                });\n                this.dialogCatalog = false;\n            }\n        },\n        async loadSingleItem(itemId, type) {\n            new Promise((resolve) => {\n                resolve(\"resolved\");\n                setTimeout(() => {\n                    this.showLoading = true;\n                    productHandler.getOne(itemId).then((res) => {\n                        this.showLoading = false;\n                        let data = res;\n                        window.console.log(data);\n                        let ds = this.$refs.saleQuoteItemLineDS.kendoWidget(),\n                            total = ds.total();\n                        this.itemLine.id = invoicePrefix + uuid.v1();\n                        this.itemLine.item = data;\n                        if (type == \"i\") {\n                            this.itemLine.description = data.variant.saleDescription;\n                        } else {\n                            this.itemLine.description = data.saleDescription;\n                        }\n                        ds.insert(total, this.itemLine);\n                    });\n                }, 10);\n            });\n        },\n        clear() {\n        },\n        async loadPrefix() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    prefixHandler.get(\"sale quote\").then((res) => {\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false;\n                            this.transactionType = res.data.data;\n                            if (this.transactionType.length > 0) {\n                                this.transaction.transactionType = this.transactionType[0];\n                                if (!this.initSaleQuote) {\n                                    window.console.log(\"load prefix\");\n                                    this.generateNumber();\n                                }\n                            }\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async loadViewSaleQuote() {\n            if (!this.initSaleQuote) {\n                window.console.log(\"here from id with no prop data\");\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        this.showLoading = true;\n                        transactionHandler\n                            .view(this.$route.params.id)\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    this.transaction = res.data.data[0];\n                                    this.bindData();\n                                }\n                            })\n                            .catch();\n                        {\n                            this.showLoading = false;\n                        }\n                    }, 10);\n                });\n            }\n        },\n        removeEmptyLine() {\n            const grid = kendo.jQuery(\"#gridItemLineSaleQuote\").data(\"kendoGrid\"),\n                dataSource = grid.dataSource;\n            if (dataSource.data().length > 0) {\n                dataSource.data().forEach((m) => {\n                    const itm = m.item || {}\n                    if (itm) {\n                        if (itm.id === undefined) {\n                            dataSource.remove(m);\n                        }\n                    }\n                });\n            }\n        },\n        async loadTransactionRate() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const date = new Date(this.transaction.transactionDate)\n                        .toISOString()\n                        .substr(0, 10);\n                    const priceLevel = this.transaction.priceLevel;\n                    let code = \"\";\n                    if (priceLevel.hasOwnProperty(\"currency\")) {\n                        if (priceLevel.currency.hasOwnProperty(\"code\")) {\n                            code = priceLevel.currency.code;\n                        }\n                    }\n                    if (code !== undefined || code !== \"\") {\n                        this.showLoading = true;\n                        currencyHandler\n                            .getLastExchangeRateByDate(date, code)\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    this.exchangeRate = res.data.data[0];\n                                    this.currencyCode = this.exchangeRate.code;\n                                    this.transactionRate = this.exchangeRate.rate;\n                                    this.transaction.txnRate = this.exchangeRate.rate;\n                                    this.transaction.exchangeRate = this.exchangeRate;\n                                    this.showLoading = false;\n                                }\n                            });\n                    }\n                }, 10);\n            });\n        },\n        creditLimitUsage(balance, creditLimit) {\n            if (creditLimit > 0) {\n                return (\n                    kendo.toString(\n                        (balance / creditLimit) * 100,\n                        `n${this.saleFormContent.decimal}`\n                    ) + \" %\"\n                );\n            } else {\n                return kendo.toString(0, `n${this.saleFormContent.decimal}`) + \" %\";\n            }\n        },\n        async loadCustomerBalance(id) {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const strFilter = id + \"?type=bal\";\n                    this.transaction.currentBalance = 0;\n                    billingHandler\n                        .balance(strFilter)\n                        .then((res) => {\n                            if (res.data.statusCode === 200) {\n                                const data = res.data.data;\n                                if (data.length > 0) {\n                                    this.transaction.currentBalance = data[0].balance;\n                                }\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 10);\n            });\n        },\n        handleSubmit(event) {\n            event.preventDefault();\n            this.success = true;\n        },\n        saveClose() {\n            this.isSaveClose = true;\n            this.saveOption = \"saveClose\";\n\n            let ds = this.$refs.saleQuoteItemLineDS.kendoWidget();\n            let d1 = ds.data().filter(n => n.amount > 0);\n            let dataValidate = 0;\n            d1.forEach((value, index) => {\n                window.console.log('index', value)\n                if (\n                    value.item.id == undefined ||\n                    value.uom.uom.id == undefined ||\n                    value.item.id == \"\" ||\n                    value.uom.uom.id == \"\"\n                ) {\n                    this.$snotify.error(\n                        \"Please check Item or Uom  on row \" + (index + 1)\n                    );\n                } else {\n                    dataValidate += 1;\n                }\n            });\n            if (d1.length == dataValidate) {\n                this.save();\n            }\n        },\n        savePrint() {\n            this.isSavePrint = true;\n            this.saveOption = \"savePrint\";\n            this.save();\n        },\n        saveNew() {\n            this.saveOption = \"saveNew\";\n            this.isSaveNew = true;\n            let ds = this.$refs.saleQuoteItemLineDS.kendoWidget();\n            let d1 = ds.data().filter(n => n.amount > 0);\n            let dataValidate = 0;\n            d1.forEach((value, index) => {\n                if (\n                    value.item.id == undefined ||\n                    value.uom.id == undefined ||\n                    value.item.id == \"\" ||\n                    value.uom.id == \"\"\n                ) {\n                    this.$snotify.error(\n                        \"Please check Item or Uom  on row \" + (index + 1)\n                    );\n                } else {\n                    dataValidate += 1;\n                }\n            });\n            if (d1.length == dataValidate) {\n                this.save();\n            }\n        },\n        saveDraft() {\n            this.saveOption = \"saveDraft\";\n            this.isSaveDraft = true;\n            this.save();\n        },\n        async save() {\n            if (!this.$refs.form.validate()) {\n                this.$refs.form.validate();\n                this.$snotify.error(\n                    \"Field is required, please check field each of tabs!\"\n                );\n                return;\n            }\n            let id = \"\";\n            if (this.customer.hasOwnProperty(\"id\")) {\n                id = this.customer.id || \"\";\n            }\n            if (id === \"\") {\n                this.$snotify.error(\"Customer is require\");\n                return;\n            }\n            this.removeEmptyLine()\n            let ds = this.$refs.saleQuoteItemLineDS.kendoWidget(),\n                total = ds.total()\n            if (total == 0) {\n                this.$snotify.error(\"Item is require\");\n                return\n            }\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    let txnList = [];\n                    if (this.transaction.lead.hasOwnProperty(\"id\")) {\n                        txnList.push(this.transaction.lead);\n                    }\n                    this.removeEmptyLine();\n                    let itemLineDS = this.$refs.saleQuoteItemLineDS.kendoWidget(),\n                        total = itemLineDS.total();\n                    if (total <= 0) {\n                        this.$snotify.error(\"Field Required!\");\n                        return;\n                    }\n                    const dataRow = itemLineDS.data().map((m) => {\n                        return new ItemLineModel(m);\n                    });\n\n                    let data = {\n                        id: this.transaction.id ? this.transaction.id : \"\",\n                        type: \"Sale Quote\",\n                        number: this.transaction.number,\n                        abbr: this.transaction.transactionType.abbr,\n                        transactionDate: this.transaction.transactionDate,\n                        validityDate: this.transaction.validityDate,\n                        monthOf: this.transaction.monthOf,\n                        customer: this.transaction.customer,\n                        paymentTerm: this.transaction.paymentTerm,\n                        transactionType: this.transaction.transactionType,\n                        discountPromotion: {},\n                        priceLevel: this.transaction.priceLevel,\n                        itemLines: dataRow,\n                        project: this.transaction.project,\n                        segment: this.transaction.segment ? this.transaction.segment : {},\n                        location: this.transaction.location\n                            ? this.transaction.location\n                            : {},\n                        saleChannel: this.transaction.saleChannel,\n                        billingAddress: this.transaction.billingAddress,\n                        deliveryAddress: this.transaction.deliveryAddress,\n                        deliveryDateTime: this.transaction.deliveryDateTime,\n                        transactionNote: this.transaction.transactionNote,\n                        subTotal: this.transaction.subTotal,\n                        total: this.transaction.total ? this.transaction.total : 0,\n                        amount: this.transaction.amountDue || 0,\n                        discountTotal: this.transaction.discountTotal,\n                        exchangeAmount: this.transaction.exchangeAmount,\n                        specificDiscountTotal: this.transaction.specificDiscountTotal,\n                        deliveryFee: this.transaction.deliveryFee,\n                        totalTaxAmount: this.transaction.totalTaxAmount,\n                        currentBalance: this.transaction.currentBalance,\n                        balance: this.transaction.balance,\n                        creditLimit: this.transaction.creditLimit,\n                        saveOption: this.saveOption,\n                        txnRate: this.transaction.txnRate,\n                        rate: this.transaction.txnRate,\n                        status: 1, //1 open, 0 used,\n                        approvedBy: this.transaction.approvedBy,\n                        rejectedBy: {},\n                        formTemplate: this.templatesForm[this.template],\n                        specificDiscountItem: this.transaction.specificDiscountItem,\n                        otherCharge: this.mOtherCharge,\n                        otherChargeAmount: this.transaction.otherChargeAmount,\n                        taxListTotal: this.taxListTotal,\n                        progressingStatus: \"\",\n                        customerDiscountItem: this.customerDiscountItem,\n                        customerSaleUnit: this.customerSaleUnit,\n                        loggedUser: this.loggedUser,\n                        txnList: txnList,\n                        publicLink: \"\",\n                        usedDateAt: \"\",\n                        deletedAt: \"\",\n                        deleted: 0,\n                        createdAt: new Date().toISOString().substr(0, 10),\n                        saleOrderType: 0,\n                        employee: this.mEmployee,\n                        supplier: {},\n                        exchangeRate: this.transaction.exchangeRate,\n                        form: 1,\n                        lead: this.transaction.lead,\n                        amountDue: this.transaction.amountDue,\n                        itemSubtotal: this.transaction.itemSubtotal,\n                        exchangeItemSubtotal: this.transaction.exchangeItemSubtotal,\n                        serviceSubtotal: this.transaction.serviceSubtotal,\n                        exchangeServiceSubtotal: this.transaction.exchangeServiceSubtotal,\n                        txnItmSubtotal: this.transaction.txnItmSubtotal,\n                        exchangeTxnItmSubtotal: this.transaction.exchangeTxnItmSubtotal,\n                        itemDiscount: this.transaction.itemDiscount,\n                        exchangeItemDiscount: this.transaction.exchangeItemDiscount,\n                        serviceDiscount: this.transaction.serviceDiscount,\n                        exchangeServiceDiscount: this.transaction.exchangeServiceDiscount,\n                        txnItmDiscount: this.transaction.txnItmDiscount,\n                        exchangeTxnItmDiscount: this.transaction.exchangeTxnItmDiscount,\n                        routeView: \"sale_quote_view\",\n                        exspectedDate: \"\",\n                    };\n                    this.showLoading = true;\n                    this.btnDisabled = true;\n                    // window.console.log(data);\n                    transactionHandler\n                        .create(data)\n                        .then((response) => {\n                            this.showLoading = false;\n                            this.btnDisabled = false\n                            if (response.data.statusCode === 201) {\n                                // this.$refs.form.reset();\n                                this.$snotify.success(\"Successfully\");\n                                if (this.isSaveNew == true) {\n                                    setTimeout(() => {\n                                        this.setDefaultData();\n                                    }, 10);\n                                } else {\n                                    this.close(response.data.data);\n                                }\n                            } else {\n                                this.showLoading = false;\n                                this.btnDisabled = false\n                            }\n                        })\n                        .catch((e) => {\n                            this.$snotify.error(\"Something went wrong\");\n                            this.errors.push(e);\n                            // window.console.log(e);\n                        });\n                }, 10);\n            });\n        },\n        dataBound() {\n            this.schemaModelFields = {\n                uom: {validation: {required: true}},\n                price: {validation: {required: true}},\n            };\n        },\n        async loadPaymentTermList() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    if (this.customer) {\n                        const strFilter = '?id=' + this.customer.id + '&transactionDate=' + this.transaction.transactionDate + '&type=Customer'\n                        this.transaction.paymentTerm = {}\n                        paymentTermHandler_.get(strFilter).then((res) => {\n                            if (res.data.statusCode === 200) {\n                                const terms = res.data.data\n                                this.transaction.paymentTerm = terms.term\n                            }\n                        });\n                    }\n                }, 10);\n            });\n        },\n        async loadCreditLimit() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    if (this.customer) {\n                        const strFilter = '?id=' + this.customer.id + '&transactionDate=' + this.transaction.transactionDate + '&type=Customer'\n                        this.transaction.creditLimit = 0\n                        creditLimitHandler.get(strFilter).then((res) => {\n                            if (res.data.statusCode === 200) {\n                                // this.creditLimitItem = res.data.data\n                                const credit = res.data.data\n                                this.transaction.creditLimit = kendo.parseFloat(credit.amount || 0);\n                            }\n                        });\n                    }\n                }, 10);\n            });\n        },\n        async clearUOMItem() {\n            let ds = this.$refs.saleQuoteItemLineDS.kendoWidget()\n            ds.data().map(n => {\n                n.set('uom', {})\n            })\n            this.isPriceLevelChanged = false\n        },\n        async loadQuote(id) {\n            window.console.log(id, 'load id')\n            this.showLoading = true\n            transactionHandler.view(id).then((res) => {\n                this.showLoading = false\n                this.isEdit = true\n                this.itemLines = []\n                this.transaction = res.data.data[0]\n                this.bindData();\n            })\n        },\n        async loadSingleData() {\n            this.btnDisabled = false\n            if (this.$route.name === 'Sale Quote') {\n                if (this.initSaleQuote) {\n                    // Edit Mode\n                    this.itemLines = []\n                    this.transaction = this.initSaleQuote;\n                    this.bindData();\n                } else {\n                    // new\n                    if (this.$route.params.id != undefined) {\n                        this.loadQuote(this.$route.params.id)\n                    } else {\n                        this.setDefaultData()\n                    }\n                }\n                prefixHandler.get(\"sale quote\").then((res) => {\n                    if (res.data.statusCode === 200) {\n                        this.showLoading = false;\n                        this.transactionType = res.data.data;\n                        if (this.transactionType.length > 0) {\n                            if (\n                                this.$route.params.id !== undefined ||\n                                this.$route.params.id != \"\"\n                            ) {\n                                this.transaction.transactionType = this.transactionType[0];\n                                if (!this.initSaleQuote && this.$route.params.id === undefined) {\n                                    this.generateNumber();\n                                }\n                            }\n                        }\n                    }\n                });\n                await this.loadPaymentTerm();\n                await this.loadSaleFormContent();\n                await this.loadOtherCharge();\n                await this.loadPriceLevel();\n                await this.loadDiscountItem(0);\n                await this.loadSaleChannel();\n                await this.loadCatalogs();\n                await this.loadLead();\n                this.loadTax();\n                this.loadSaleUnitItems();\n                this.loadSegment();\n                this.loadLocation();\n                this.loadEmployeeCenter();\n            }\n        },\n    },\n    computed: {\n        dateFormatted() {\n            return kendo.toString(new Date(), institute.dateFormat);\n        },\n        dateTimeFormatted() {\n            window.console.log(institute.dateFormat + \" HH:mm\", \"inst date\");\n            return kendo.toString(new Date(), institute.dateFormat + \" HH:mm\");\n        },\n        validCustomer() {\n            return this.customer.id !== undefined && this.customer.id !== null;\n        },\n        hiddenButton() {\n            if (this.$route.query.type == \"edit\") {\n                return true\n            } else {\n                return false\n            }\n\n        }\n    },\n    watch: {\n        '$route': 'loadSingleData',\n        // '$route': 'loadViewSaleQuote',\n        initSaleQuote() {\n            this.initialData();\n        },\n    },\n    created() {\n    },\n    mounted: async function () {\n        this.loadSingleData();\n        this.requestData(0, this.filter, this.cusBaseUrl);\n        this.requestData(0, this.filter, this.cusBaseUrl);\n    },\n};\n</script>\n\n<style scoped>\n.theme--light.v-data-table\n> .v-data-table__wrapper\n> table\n> tbody\n> tr:hover:not(.v-data-table__expanded__content):not(.v-data-table__empty-wrapper) {\n    background-color: transparent !important;\n}\n\n.hide_small_bar_class {\n    max-width: 0;\n    transition: 0.5s ease-in;\n    flex: 0 0 0;\n}\n\n.hide_big_bar_class {\n    max-width: 100%;\n    transition: 0.5s ease-in;\n    flex: 0 0 100%;\n}\n\n.small_sidebar {\n    height: 97%;\n    position: relative;\n    padding: 12px;\n    background-color: #edf1f5;\n}\n\n.iconArrow {\n    right: -35px;\n    position: absolute;\n    bottom: -10px;\n}\n\n.iconArrowHide {\n    position: absolute;\n    right: -7px;\n    bottom: -10px;\n}\n\n.detial_smallside_p {\n    position: absolute;\n    bottom: 12px;\n}\n\n.kendo_dropdown_custom .k-dropdown.k-header {\n    width: 100%;\n}\n</style>\n"]}]}