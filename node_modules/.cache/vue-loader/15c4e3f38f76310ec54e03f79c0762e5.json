{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/suppliers/RequestPayment.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/suppliers/RequestPayment.vue","mtime":1638499443347},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGkxOG4gfSBmcm9tICJAL2kxOG4iOwppbXBvcnQgRGF0ZVBpY2tlckNvbXBvbmVudCBmcm9tICJAL2NvbXBvbmVudHMvY3VzdG9tX3RlbXBsYXRlcy9EYXRlUGlja2VyQ29tcG9uZW50IjsKaW1wb3J0IHN1cHBsaWVySGFuZGxlciBmcm9tICJAL3NjcmlwdHMvc3VwcGxpZXJIYW5kbGVyIjsKaW1wb3J0IGpvdXJuYWxIYW5kbGVyIGZyb20gIkAvc2NyaXB0cy9qb3VybmFsSGFuZGxlciI7CmltcG9ydCBSZXF1ZXN0UGF5bWVudE1vZGVsIGZyb20gIkAvc2NyaXB0cy9yZXF1ZXN0LXBheW1lbnQvbW9kZWwvUmVxdWVzdFBheW1lbnQiOwppbXBvcnQgSXRlbUxpbmVNb2RlbCBmcm9tICJAL3NjcmlwdHMvcmVxdWVzdC1wYXltZW50L21vZGVsL0l0ZW1MaW5lIjsKaW1wb3J0IGtlbmRvIGZyb20gIkBwcm9ncmVzcy9rZW5kby11aSI7CmltcG9ydCBiaWxsaW5nSGFuZGxlciBmcm9tICJAL3NjcmlwdHMvaW52b2ljZS9oYW5kbGVyL2JpbGxpbmdIYW5kbGVyIjsKaW1wb3J0IHByZWZpeEhhbmRsZXIgZnJvbSAiQC9zY3JpcHRzL3ByZWZpeEhhbmRsZXIiOwppbXBvcnQgcHVyY2hhc2VGb3JtQ29udGVudEhhbmRsZXIgZnJvbSAiQC9zY3JpcHRzL3B1cmNoYXNlRm9ybUNvbnRlbnRIYW5kbGVyIjsKaW1wb3J0IHNldHRpbmdIYW5kbGVyIGZyb20gIkAvc2NyaXB0cy9zZXR0aW5nc0hhbmRsZXIiOwppbXBvcnQgeyBDdXJyZW5jeU1vZGVsLCBQYXltZW50VGVybU1vZGVsIH0gZnJvbSAiQC9zY3JpcHRzL21vZGVsL0FwcE1vZGVscyI7CmltcG9ydCBQYXltZW50T3B0aW9uTW9kZWwgZnJvbSAiQC9zY3JpcHRzL21vZGVsL1BheW1lbnRPcHRpb24iOwppbXBvcnQgQWNjb3VudE1hcHBpbmdNb2RlbCBmcm9tICJAL3NjcmlwdHMvYWNjb3VudC1tYXAvQWNjb3VudCI7CmltcG9ydCBTdXBwbGllck1vZGVsIGZyb20gIkAvc2NyaXB0cy9tb2RlbC9TdXBwbGllciI7CmltcG9ydCBIZWxwZXIgZnJvbSAiQC9oZWxwZXIiOwoKY29uc3QgY29va2llSlMgPSByZXF1aXJlKCJAL2Nvb2tpZS5qcyIpOwpjb25zdCBjb29raWUgPSBjb29raWVKUy5nZXRDb29raWUoKTsKY29uc3QgcmVxdWVzdFBheW1lbnRNb2RlbCA9IG5ldyBSZXF1ZXN0UGF5bWVudE1vZGVsKHt9KTsKY29uc3QgaXRlbUxpbmVNb2RlbCA9IG5ldyBJdGVtTGluZU1vZGVsKHt9KTsKCmNvbnN0IE9QVElPTl9UWVBFID0gIlN1cHBsaWVyIjsKY29uc3QgVFJBTlNBQ1RJT05fVFlQRSA9ICJSZXF1ZXN0IFBheW1lbnQiOwpjb25zdCBUWE5fVFlQRSA9ICJyZXF1ZXN0IHBheW1lbnQiOwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJSZXF1ZXN0UGF5bWVudCIsCiAgY29tcG9uZW50czogewogICAgTG9hZGluZ01lOiAoKSA9PiBpbXBvcnQoYEAvY29tcG9uZW50cy9Mb2FkaW5nYCksCiAgICAiYXBwLWRhdGVwaWNrZXIiOiBEYXRlUGlja2VyQ29tcG9uZW50LAogICAgInZlbmRvci1kcm9wZG93bmxpc3QiOiAoKSA9PgogICAgICBpbXBvcnQoIkAvY29tcG9uZW50cy9kcm9wZG93bmxpc3QvVmVuZG9yRHJvcGRvd24iKSwKICAgICJwYXltZW50b3B0aW9uLWRyb3Bkb3dubGlzdCI6ICgpID0+CiAgICAgIGltcG9ydCgiQC9jb21wb25lbnRzL2Ryb3Bkb3dubGlzdC9QYXltZW50T3B0aW9uRHJvcERvd25MaXN0IiksCiAgfSwKICBkYXRhOiAoKSA9PiAoewogICAgc2hvd0xvYWRpbmc6IGZhbHNlLAogICAgY3VzdG9tZXJMaXN0OiBbXSwKICAgIGdyb3VwOiBbXSwKICAgIHN1cHBsaWVyczogW10sCiAgICBjdXN0b21lcjoge30sCiAgICBvdmVyRHVlQW1vdW50OiAwLAogICAgcmVjZWl2YWJsZUJhbGFuY2U6IDAsCiAgICB0b2JlQ29sbGVjdGVkOiAwLAogICAgdmFsaWQ6IHRydWUsCiAgICB0ZW1wbGF0ZTogW10sCiAgICB0ZW1wbGF0ZXM6IFtdLAogICAgaXRlbUxpbmVzOiBbXSwKICAgIHRyYW5zYWN0aW9uVHlwZXM6IFtdLAogICAgcmVjZWl2YWJsZUxpc3Q6IFtdLAogICAgcmVxdWVzdFBheW1lbnQ6IHJlcXVlc3RQYXltZW50TW9kZWwsCiAgICBpdGVtTGluZTogaXRlbUxpbmVNb2RlbCwKICAgIHN1cEJhc2VVcmw6IHN1cHBsaWVySGFuZGxlci5zZWFyY2goKSwKICAgIHNlbGVjdGVkRXhwZW5zZUlkczogW10sCiAgICBwdXJjaGFzZUZvcm1Db250ZW50OiB7fSwKICAgIGJhbGFuY2U6IDAsCiAgICBqUmF3OiBbXSwKICAgIHR4bkxpc3Q6IFtdLAogICAgZ2Fpbkxvc3NBY2M6IHt9LAogICAgb3RoZXJSZXZlbnVlQWNjOiB7fSwKICAgIGdhaW5Pckxvc3NEZXNjcmlwdGlvbjogImdhaW4vbG9zcyBvbiBleGNoYW5nZSByYXRlIiwKICAgIHBlbmFsdHlEZXNjcmlwdGlvbjogInBlbmFsdHkiLAogICAgYmFzZUN1cnJlbmN5Q29kZTogIiIsCiAgICBsb2dnZWRVc2VyOiB7CiAgICAgIGlkOiBjb29raWUuY3JlYXRvciwKICAgICAgbmFtZTogY29va2llLmVtYWlsLAogICAgfSwKICAgIGNyOiAwLAogICAgZHI6IDAsCiAgICBmdW5kQmFsYW5jZTogMCwKICAgIHZlbmRvclJlbWFpbmluZ0JhbGFuY2U6IDAsCiAgICBmdW5kUmVtYWluQmFsYW5jZTogMCwKICAgIHNjaGVtYURlZmluaXRpb246IHsKICAgICAgbW9kZWw6IHsgaWQ6ICJsaW5lSWQiIH0sCiAgICB9LAogICAgaXNDaGVja0NoYW5nZWQ6IGZhbHNlLAogIH0pLAogIG1ldGhvZHM6IHsKICAgIG9uVmVuZG9yQ2hhbmdlZCh2YWx1ZSkgewogICAgICB0aGlzLnJlcXVlc3RQYXltZW50LnN1cHBsaWVyID0gdmFsdWU7CiAgICAgIGNvbnN0IHN1cHBsaWVyID0gdGhpcy5yZXF1ZXN0UGF5bWVudC5zdXBwbGllciB8fCB7fTsKICAgICAgY29uc3Qgc3VwcGxpZXJJZCA9IHN1cHBsaWVyLmlkIHx8ICIiOwogICAgICBpZiAoc3VwcGxpZXJJZCkgewogICAgICAgIHRoaXMubG9hZFZlbmRvckJhbGFuY2Uoc3VwcGxpZXJJZCk7CiAgICAgIH0KICAgIH0sCiAgICBjYW5jZWwoKSB7CiAgICAgIHRoaXMuJHN3YWwoewogICAgICAgIHRpdGxlOiBpMThuLnQoIm1zZ190aXRsZV93YXJuaW5nIiksCiAgICAgICAgdGV4dDogaTE4bi50KCJtc2dfZGlzY2FyZCIpLAogICAgICAgIGljb246ICJ3YXJuaW5nIiwKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IGkxOG4udCgiY2FuY2VsIiksCiAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzRkNDg0OCIsCiAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjRUQxQTNBIiwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogaTE4bi50KCJkaXNjYXJkIiksCiAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgIHRoaXMuJHJvdXRlci5nbygtMSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBjdXJyZW5jeShkYXRhSXRlbSkgewogICAgICBpZiAoZGF0YUl0ZW0pIHsKICAgICAgICBpZiAoZGF0YUl0ZW0uaGFzT3duUHJvcGVydHkoImN1cnJlbmN5Q29kZSIpKSB7CiAgICAgICAgICByZXR1cm4gZGF0YUl0ZW0uY3VycmVuY3lDb2RlOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gIiI7CiAgICB9LAogICAgcmVmZXJlbmNlTm9UbXAoZGF0YUl0ZW0pIHsKICAgICAgaWYgKGRhdGFJdGVtKSB7CiAgICAgICAgaWYgKGRhdGFJdGVtLmhhc093blByb3BlcnR5KCJyZWZlcmVuY2VObyIpKSB7CiAgICAgICAgICByZXR1cm4gZGF0YUl0ZW0ucmVmZXJlbmNlTm87CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiAiIjsKICAgIH0sCiAgICBiaWxsTnVtYmVyVG1wKGRhdGFJdGVtKSB7CiAgICAgIGlmIChkYXRhSXRlbSkgewogICAgICAgIGlmIChkYXRhSXRlbS5oYXNPd25Qcm9wZXJ0eSgiYmlsbE51bWJlciIpKSB7CiAgICAgICAgICByZXR1cm4gZGF0YUl0ZW0uYmlsbE51bWJlcjsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuICIiOwogICAgfSwKICAgIHBhaWRBbW91bnRUbXAoZGF0YUl0ZW0pIHsKICAgICAgaWYgKGRhdGFJdGVtKSB7CiAgICAgICAgaWYgKGRhdGFJdGVtLmhhc093blByb3BlcnR5KCJwYWlkQW1vdW50IikpIHsKICAgICAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyhkYXRhSXRlbS5wYWlkQW1vdW50LCBkYXRhSXRlbS5kZWNpbWFsRm9ybWF0KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuICIiOwogICAgfSwKICAgIGFtb3VudFRvYmVQYWlkKGRhdGFJdGVtKSB7CiAgICAgIGlmIChkYXRhSXRlbSkgewogICAgICAgIGlmIChkYXRhSXRlbS5oYXNPd25Qcm9wZXJ0eSgiYW1vdW50VG9iZVBhaWQiKSkgewogICAgICAgICAgcmV0dXJuIGtlbmRvLnRvU3RyaW5nKAogICAgICAgICAgICBkYXRhSXRlbS5hbW91bnRUb2JlUGFpZCwKICAgICAgICAgICAgZGF0YUl0ZW0uZGVjaW1hbEZvcm1hdAogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuICIiOwogICAgfSwKICAgIGRpc2NvdW50KGRhdGFJdGVtKSB7CiAgICAgIGlmIChkYXRhSXRlbSkgewogICAgICAgIGlmIChkYXRhSXRlbS5oYXNPd25Qcm9wZXJ0eSgiZGlzY291bnQiKSkgewogICAgICAgICAgY29uc3QgZGlzY291bnQgPSBkYXRhSXRlbS5kaXNjb3VudCB8fCAwOwogICAgICAgICAgcmV0dXJuIGtlbmRvLnRvU3RyaW5nKGRpc2NvdW50LCBkYXRhSXRlbS5kZWNpbWFsRm9ybWF0KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgYW1vdW50KGRhdGFJdGVtKSB7CiAgICAgIGlmIChkYXRhSXRlbSkgewogICAgICAgIGlmIChkYXRhSXRlbS5oYXNPd25Qcm9wZXJ0eSgiYW1vdW50IikpIHsKICAgICAgICAgIGNvbnN0IGFtb3VudCA9IGRhdGFJdGVtLmFtb3VudCB8fCAwOwogICAgICAgICAgcmV0dXJuIGtlbmRvLnRvU3RyaW5nKGFtb3VudCwgZGF0YUl0ZW0uZGVjaW1hbEZvcm1hdCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGJhbmtSZWZlcmVuY2VObyhkYXRhSXRlbSkgewogICAgICBpZiAoZGF0YUl0ZW0pIHsKICAgICAgICBpZiAoZGF0YUl0ZW0uaGFzT3duUHJvcGVydHkoIm92ZXJEdWUiKSkgewogICAgICAgICAgcmV0dXJuIGRhdGFJdGVtLmJhbmtSZWZlcmVuY2VObzsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuICIiOwogICAgfSwKICAgIG92ZXJEdWUoZGF0YUl0ZW0pIHsKICAgICAgaWYgKGRhdGFJdGVtKSB7CiAgICAgICAgaWYgKGRhdGFJdGVtLmhhc093blByb3BlcnR5KCJvdmVyRHVlIikpIHsKICAgICAgICAgIHJldHVybiBkYXRhSXRlbS5vdmVyRHVlOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBwYWlkQW1vdW50RWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICBrZW5kbwogICAgICAgIC5qUXVlcnkoJzxpbnB1dCBkYXRhLWJpbmQ9InZhbHVlOicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAua2VuZG9OdW1lcmljVGV4dEJveCh7CiAgICAgICAgICBkZWNpbWFsczogNSwKICAgICAgICAgIGZvcm1hdDogYG4ke3RoaXMucHVyY2hhc2VGb3JtQ29udGVudC5kZWNpbWFsfWAsCiAgICAgICAgICBtaW46IDAsCiAgICAgICAgfSk7CiAgICB9LAogICAgZGlzY291bnRFZGl0b3IoY29udGFpbmVyLCBvcHRpb25zKSB7CiAgICAgIGtlbmRvCiAgICAgICAgLmpRdWVyeSgnPGlucHV0IGRhdGEtYmluZD0idmFsdWU6JyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgIC5rZW5kb051bWVyaWNUZXh0Qm94KHsKICAgICAgICAgIGRlY2ltYWxzOiAzMCwKICAgICAgICAgIGZvcm1hdDogYG4ke3RoaXMucHVyY2hhc2VGb3JtQ29udGVudC5kZWNpbWFsfWAsCiAgICAgICAgICBtaW46IDAsCiAgICAgICAgfSk7CiAgICB9LAogICAgb25UcmFuc2FjdGlvbkRhdGVDaGFuZ2VkKCkgewogICAgICBpZiAodGhpcy5yZXF1ZXN0UGF5bWVudC5zdXBwbGllcikgewogICAgICAgIGNvbnN0IHN1cHBsaWVyID0gdGhpcy5yZXF1ZXN0UGF5bWVudC5zdXBwbGllciB8fCB7fTsKICAgICAgICBjb25zdCBzdXBJZCA9IHN1cHBsaWVyLmlkIHx8ICIiOwogICAgICAgIGlmIChzdXBJZCkgewogICAgICAgICAgdGhpcy5nZW5lcmF0ZU51bWJlcigpOwogICAgICAgICAgdGhpcy5zZWFyY2hQdXJjaGFzZU9yZGVyRXhwZW5zZSgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGdlbmVyYXRlTnVtYmVyKCkgewogICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkKSB7CiAgICAgICAgY29uc3QgdHJhbkRhdGUgPSBuZXcgRGF0ZSh0aGlzLnJlcXVlc3RQYXltZW50LnRyYW5zYWN0aW9uRGF0ZSk7CiAgICAgICAgY29uc3QgdHJhbkRhdGVSZWNlaXB0ID0gbmV3IERhdGUodGhpcy5yZXF1ZXN0UGF5bWVudC50cmFuc2FjdGlvbkRhdGUpOwogICAgICAgIGNvbnN0IHRyYW5EYXRlTSA9IHRyYW5EYXRlLmdldEZ1bGxZZWFyKCkgKyB0cmFuRGF0ZS5nZXRNb250aCgpOwogICAgICAgIGNvbnN0IHRyYW5EYXRlUmVjZWlwdE0gPQogICAgICAgICAgdHJhbkRhdGVSZWNlaXB0LmdldEZ1bGxZZWFyKCkgKyB0cmFuRGF0ZVJlY2VpcHQuZ2V0TW9udGgoKTsKICAgICAgICBpZiAodHJhbkRhdGVNID09PSB0cmFuRGF0ZVJlY2VpcHRNKSB7CiAgICAgICAgICB0aGlzLnJlcXVlc3RQYXltZW50LnJlZmVyZW5jZU5vID0gdGhpcy5yZWZlcmVuY2VObzsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0KICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKCJhYmJyIiwgdGhpcy5yZXF1ZXN0UGF5bWVudC50cmFuc2FjdGlvblR5cGUpOwogICAgICBpZiAodGhpcy5yZXF1ZXN0UGF5bWVudC50cmFuc2FjdGlvbkRhdGUgIT09ICIiKSB7CiAgICAgICAgbGV0IGRhdGEgPSB7CiAgICAgICAgICBhYmJyOiB0aGlzLnJlcXVlc3RQYXltZW50LnRyYW5zYWN0aW9uVHlwZS5hYmJyLAogICAgICAgICAgc3RydWN0dXJlOiB0aGlzLnJlcXVlc3RQYXltZW50LnRyYW5zYWN0aW9uVHlwZS5zdHJ1Y3R1cmUsCiAgICAgICAgICB0cmFuc2FjdGlvbkRhdGU6IG5ldyBEYXRlKHRoaXMucmVxdWVzdFBheW1lbnQudHJhbnNhY3Rpb25EYXRlKQogICAgICAgICAgICAudG9JU09TdHJpbmcoKQogICAgICAgICAgICAuc3Vic3RyKDAsIDEwKSwKICAgICAgICAgIHNlcXVjZW5jaW5nOiB0aGlzLnJlcXVlc3RQYXltZW50LnRyYW5zYWN0aW9uVHlwZS5zZXF1Y2VuY2luZywKICAgICAgICAgIHR5cGU6IFRSQU5TQUNUSU9OX1RZUEUsCiAgICAgICAgICBlbnRpdHk6IDEsCiAgICAgICAgfTsKICAgICAgICBiaWxsaW5nSGFuZGxlcgogICAgICAgICAgLmxhc3ROdW1iZXIoZGF0YSkKICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICBjb25zdCByZXMgPSByZXNwb25zZS5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgY29uc3QgbGFzdE51bWJlciA9IHRoaXMuemVyb1BhZCgKICAgICAgICAgICAgICAgIHBhcnNlSW50KHJlcy5sYXN0TnVtYmVyKSwKICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdFBheW1lbnQudHJhbnNhY3Rpb25UeXBlLmZvcm1hdAogICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgY29uc3QgbnVtYmVyID0KICAgICAgICAgICAgICAgIHJlcy5zdWZmaXggKwogICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0UGF5bWVudC50cmFuc2FjdGlvblR5cGUubnVtYmVyU2VwYXJhdG9yICsKICAgICAgICAgICAgICAgIGxhc3ROdW1iZXI7CiAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0UGF5bWVudC5udW1iZXIgPSBudW1iZXI7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0UGF5bWVudC50cmFuc2FjdGlvblR5cGUuaGFzT3duUHJvcGVydHkoCiAgICAgICAgICAgICAgICAgICJwcmVmaXhTZXBhcmF0b3IiCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwcmVmaXhTZXAgPSB0aGlzLnJlcXVlc3RQYXltZW50LnRyYW5zYWN0aW9uVHlwZQogICAgICAgICAgICAgICAgICAucHJlZml4U2VwYXJhdG9yOwogICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0UGF5bWVudC5yZWZlcmVuY2VObyA9CiAgICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdFBheW1lbnQudHJhbnNhY3Rpb25UeXBlLmFiYnIgKyBwcmVmaXhTZXAgKyBudW1iZXI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuZXJyb3JzLnB1c2goZSk7CiAgICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHplcm9QYWQobnVtLCBwbGFjZXMpIHsKICAgICAgcmV0dXJuIFN0cmluZyhudW0pLnBhZFN0YXJ0KHBsYWNlcywgIjAiKTsKICAgIH0sCiAgICByZW1vdmVEdXBsaWNhdGUoYXJyYXkpIHsKICAgICAgY29uc3QgcmVzdWx0ID0gW107CiAgICAgIGNvbnN0IG1hcCA9IG5ldyBNYXAoKTsKICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGFycmF5KSB7CiAgICAgICAgaWYgKCFtYXAuaGFzKGl0ZW0uaWQpKSB7CiAgICAgICAgICBtYXAuc2V0KGl0ZW0uaWQsIHRydWUpOyAvLyBzZXQgYW55IHZhbHVlIHRvIE1hcAogICAgICAgICAgcmVzdWx0LnB1c2goaXRlbSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9LAogICAgZm9ybWF0RGF0ZShkYXRhSXRlbSkgewogICAgICBpZiAoZGF0YUl0ZW0uaGFzT3duUHJvcGVydHkoImR1ZURhdGUiKSkgewogICAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyhuZXcgRGF0ZShkYXRhSXRlbS5kdWVEYXRlKSwgZGF0YUl0ZW0uZGF0ZUZvcm1hdCk7CiAgICAgIH0KICAgICAgcmV0dXJuICIiOwogICAgfSwKICAgIHNldHRsZW1lbnREaXNjb3VudChkYXRhSXRlbSkgewogICAgICBpZiAoZGF0YUl0ZW0uaGFzT3duUHJvcGVydHkoInBheW1lbnRUZXJtIikpIHsKICAgICAgICByZXR1cm4gZGF0YUl0ZW0ucGF5bWVudFRlcm0ubmFtZSB8fCAiIjsKICAgICAgfQogICAgICByZXR1cm4gIiI7CiAgICB9LAogICAgc3RhdHVzKGRhdGFJdGVtKSB7CiAgICAgIGlmIChkYXRhSXRlbSkgewogICAgICAgIGlmIChkYXRhSXRlbS5oYXNPd25Qcm9wZXJ0eSgic3RhdHVzIikpIHsKICAgICAgICAgIGNvbnN0IHN0YXR1cyA9IGRhdGFJdGVtLnN0YXR1czsKICAgICAgICAgIGxldCBzdGF0dXNUZXh0ID0gIiI7CiAgICAgICAgICBzd2l0Y2ggKHN0YXR1cykgewogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgc3RhdHVzVGV4dCA9ICJPUEVOIjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIHN0YXR1c1RleHQgPSAiUGFydGlhbGx5IFBhaWQiOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgc3RhdHVzVGV4dCA9ICJWT0lEIjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIHN0YXR1c1RleHQgPSAiUEFJRCI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gc3RhdHVzVGV4dDsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuICIiOwogICAgfSwKICAgIG9uUGF5bWVudE9wdGlvbkNoYW5nZWQodmFsdWUpIHsKICAgICAgdGhpcy5yZXF1ZXN0UGF5bWVudC5wYXltZW50T3B0aW9uID0gdmFsdWU7CiAgICAgIGNvbnN0IGFjY291bnQgPSB2YWx1ZS5hY2NvdW50IHx8IHt9OwogICAgICBjb25zdCBhY2NvdW50SWQgPSBhY2NvdW50LnV1aWQgfHwgIiI7CiAgICAgIGlmIChhY2NvdW50SWQpIHsKICAgICAgICBsZXQgY3VycmVudEZpc2NhbERhdGUgPSBIZWxwZXIuZ2V0RmlzY2FsRGF0ZUJ5RGF0ZShuZXcgRGF0ZSgpKTsKICAgICAgICBsZXQgc3RhcnREYXRlID0gY3VycmVudEZpc2NhbERhdGUuc3RhcnRfZGF0ZTsKICAgICAgICBjb25zdCBzdHJQYXJhbSA9IHsKICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICBzdGFydF9kYXRlOgogICAgICAgICAgICAgIGtlbmRvLnRvU3RyaW5nKG5ldyBEYXRlKHN0YXJ0RGF0ZSksICJ5eXl5LU1NLWRkIikgKwogICAgICAgICAgICAgICJUMDA6MDA6MDAuMDAwWiIsCiAgICAgICAgICAgIGVuZF9kYXRlOgogICAgICAgICAgICAgIGtlbmRvLnRvU3RyaW5nKAogICAgICAgICAgICAgICAgbmV3IERhdGUodGhpcy5yZXF1ZXN0UGF5bWVudC50cmFuc2FjdGlvbkRhdGUpLAogICAgICAgICAgICAgICAgInl5eXktTU0tZGQiCiAgICAgICAgICAgICAgKSArICJUMjM6NTk6NTkuOTk5WiIsCiAgICAgICAgICB9LAogICAgICAgIH07CiAgICAgICAgdGhpcy5sb2FkRW50cnlEZXRhaWxCeUFjY291bnQoYWNjb3VudElkLCBzdHJQYXJhbSk7CiAgICAgIH0KICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKHZhbHVlLCAicGF5bWVudE9wdGlvbiIpOwogICAgfSwKICAgIGFzeW5jIGxvYWRQcmVmaXgoKSB7CiAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgcHJlZml4SGFuZGxlci5nZXQoVFhOX1RZUEUpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb25UeXBlcyA9IHJlc3BvbnNlOwogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3RQYXltZW50LnRyYW5zYWN0aW9uVHlwZSA9IHJlc3BvbnNlWzBdOwogICAgICAgICAgICAgICAgaWYgKCF0aGlzLiRyb3V0ZS5wYXJhbXMuaWQpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZU51bWJlcigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSwgMTApOwogICAgICB9KTsKICAgIH0sCiAgICBhc3luYyBzZWFyY2hQdXJjaGFzZU9yZGVyRXhwZW5zZSgpIHsKICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICBsZXQgZGF0YSA9IHt9OwogICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICBjb25zdCBzdXBwbGllciA9IHRoaXMucmVxdWVzdFBheW1lbnQuc3VwcGxpZXIgfHwge307CiAgICAgICAgICBkYXRhID0gewogICAgICAgICAgICBzZWFyY2g6IHN1cHBsaWVyLmlkIHx8ICIiLAogICAgICAgICAgICB0eXBlOiAiVmVuZG9yIiwKICAgICAgICAgICAgdHJhbnNhY3Rpb25EYXRlOiBuZXcgRGF0ZSh0aGlzLnJlcXVlc3RQYXltZW50LnRyYW5zYWN0aW9uRGF0ZSkKICAgICAgICAgICAgICAudG9JU09TdHJpbmcoKQogICAgICAgICAgICAgIC5zdWJzdHIoMCwgMTApLAogICAgICAgICAgfTsKICAgICAgICAgIHRoaXMuaXRlbUxpbmVzID0gW107CiAgICAgICAgICBpZiAoZGF0YS5zZWFyY2gpIHsKICAgICAgICAgICAgaWYgKGRhdGEuc2VhcmNoLmxlbmd0aCA+IDQpIHsKICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYmlsbGluZ0hhbmRsZXIuc2VhcmNoQ2FzaFBheW1lbnQoZGF0YSkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSByZXMuZGF0YS5yZXN1bHQ7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1MaW5lcyA9IHJlc3BvbnNlOwogICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2JqID0gcmVzcG9uc2VbMF07CiAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KCJzdXBwbGllciIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdFBheW1lbnQuc3VwcGxpZXIgPSBvYmouc3VwcGxpZXI7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmouc3VwcGxpZXIuaGFzT3duUHJvcGVydHkoIm5hbWUiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubmFtZSA9IG9iai5zdXBwbGllci5uYW1lOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhc2VDdXJyZW5jeSA9IHJlc3VsdDsKICAgICAgICAgICAgICAgICAgICB0aGlzLmJhc2VDdXJyZW5jeSA9IGJhc2VDdXJyZW5jeTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3RQYXltZW50LmN1cnJlbmN5ID0gbmV3IEN1cnJlbmN5TW9kZWwoCiAgICAgICAgICAgICAgICAgICAgICBiYXNlQ3VycmVuY3kKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIGlmIChiYXNlQ3VycmVuY3kpIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChiYXNlQ3VycmVuY3kuaGFzT3duUHJvcGVydHkoImNvZGUiKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJhc2VDdXJyZW5jeUNvZGUgPSBiYXNlQ3VycmVuY3kuY29kZTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgKGNvZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIHRoaXMubG9hZFRyYW5zYWN0aW9uUmF0ZShiYXNlQ3VycmVuY3kuY29kZSkKICAgICAgICAgICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9LCAxMCk7CiAgICAgIH0pOwogICAgfSwKICAgIG9uR3JpZFJlcXVlc3RDaGFuZ2UoKSB7CiAgICAgIGNvbnN0IGdyaWQgPSB0aGlzLiRyZWZzLmdyaWRSZXF1ZXN0UGF5bWVudC5rZW5kb1dpZGdldCgpOwogICAgICB0aGlzLnNlbGVjdGVkRXhwZW5zZUlkcyA9IGdyaWQuc2VsZWN0ZWRLZXlOYW1lcygpOwogICAgICAvLyBsZXQgZHMgPSB0aGlzLiRyZWZzLml0ZW1MaW5lRFMua2VuZG9XaWRnZXQoKQogICAgICAvLyB0aGlzLmlzQ2hlY2tDaGFuZ2VkID0gdHJ1ZQogICAgICAvLyBjb25zdCByb3dzID0gZHMuZGF0YSgpOwogICAgICAvLyByb3dzLmZvckVhY2goKHZhbHVlKSA9PiB7CiAgICAgIC8vICAgICBpZiAofnRoaXMuc2VsZWN0ZWRFeHBlbnNlSWRzLmluZGV4T2YodmFsdWUubGluZUlkKSkgewogICAgICAvLyAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyh2YWx1ZSwgJ3ZhbHVlJykKICAgICAgLy8gICAgICAgICBpZiAodmFsdWUucGFpZEFtb3VudCA9PT0gMCkgewogICAgICAvLyAgICAgICAgICAgICBjb25zdCB0b2JlUGFpZCA9IHZhbHVlLmFtb3VudFRvYmVQYWlkIHx8IDAKICAgICAgLy8gICAgICAgICAgICAgdmFsdWUuc2V0KCdwYWlkQW1vdW50JywgdG9iZVBhaWQpCiAgICAgIC8vICAgICAgICAgfQogICAgICAvLyAgICAgfQogICAgICAvLyB9KQogICAgICAvLyB0aGlzLiRyZWZzLmdyaWRSZXF1ZXN0UGF5bWVudC5rZW5kb1dpZGdldCgpLnJlYWQoKQogICAgICAvLyB0aGlzLmlzQ2hlY2tDaGFuZ2VkID0gZmFsc2UKICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlKCk7CiAgICB9LAogICAgb25EYXRhU291cmNlQ2hhbmdlKGUpIHsKICAgICAgbGV0IGFtdFRvYmVQYWlkID0gMCwKICAgICAgICBhbW91bnQgPSAwLAogICAgICAgIGRpc2NvdW50ID0gMCwKICAgICAgICBwYWlkQW1vdW50ID0gMDsKICAgICAgbGV0IGRhdGFSb3cgPSBlLml0ZW1zWzBdIHx8IHt9OwogICAgICBpZiAoT2JqZWN0LmtleXMoZGF0YVJvdykubGVuZ3RoID4gMCkgewogICAgICAgIGRhdGFSb3cuc2V0KCJvcHRpb25UeXBlIiwgT1BUSU9OX1RZUEUpOwogICAgICB9CiAgICAgIGlmIChlLmZpZWxkKSB7CiAgICAgICAgbGV0IGRhdGFSb3cgPSBlLml0ZW1zWzBdOwogICAgICAgIHN3aXRjaCAoZS5maWVsZCkgewogICAgICAgICAgY2FzZSAiZGlzY291bnQiOgogICAgICAgICAgICBhbW91bnQgPSBkYXRhUm93LmFtb3VudCB8fCAwOwogICAgICAgICAgICBkaXNjb3VudCA9IGRhdGFSb3cuZGlzY291bnQgfHwgMDsKICAgICAgICAgICAgaWYgKGRpc2NvdW50ID4gYW1vdW50KSB7CiAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImRpc2NvdW50IiwgYW1vdW50KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkYXRhUm93LnNldCgKICAgICAgICAgICAgICAiYW1vdW50VG9iZVBhaWQiLAogICAgICAgICAgICAgIHBhcnNlRmxvYXQoZGF0YVJvdy5hbW91bnQpIC0gcGFyc2VGbG9hdChkYXRhUm93LmRpc2NvdW50IHx8IDApCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGRhdGFSb3cuc2V0KAogICAgICAgICAgICAgICJleGNoYW5nZURpc2NvdW50IiwKICAgICAgICAgICAgICBwYXJzZUZsb2F0KGRhdGFSb3cuZGlzY291bnQpICogcGFyc2VGbG9hdChkYXRhUm93LnJhdGVUb2Jhc2UgfHwgMSkKICAgICAgICAgICAgKTsKICAgICAgICAgICAgZGF0YVJvdy5zZXQoCiAgICAgICAgICAgICAgImV4Y2hhbmdlRGlzY291bnRUeG4iLAogICAgICAgICAgICAgIHBhcnNlRmxvYXQoZGF0YVJvdy5kaXNjb3VudCkgKiBwYXJzZUZsb2F0KGRhdGFSb3cudHhuUmF0ZSB8fCAxKQogICAgICAgICAgICApOwogICAgICAgICAgICBhbXRUb2JlUGFpZCA9IHBhcnNlRmxvYXQoZGF0YVJvdy5hbW91bnRUb2JlUGFpZCB8fCAwKTsKICAgICAgICAgICAgcGFpZEFtb3VudCA9IHBhcnNlRmxvYXQoZGF0YVJvdy5wYWlkQW1vdW50IHx8IDApOwogICAgICAgICAgICBpZiAocGFpZEFtb3VudCA+IGFtdFRvYmVQYWlkKSB7CiAgICAgICAgICAgICAgcGFpZEFtb3VudCA9IGFtdFRvYmVQYWlkOwogICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJwYWlkQW1vdW50IiwgcGFyc2VGbG9hdChwYWlkQW1vdW50KSk7CiAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoCiAgICAgICAgICAgICAgICAicGFpZEFtb3VudFRvYmFzZSIsCiAgICAgICAgICAgICAgICBwYXJzZUZsb2F0KHBhaWRBbW91bnQpICogcGFyc2VGbG9hdChkYXRhUm93LnJhdGVUb2Jhc2UgfHwgMSkKICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIGRhdGFSb3cuc2V0KAogICAgICAgICAgICAgICAgInBhaWRBbW91bnRUeG4iLAogICAgICAgICAgICAgICAgcGFpZEFtb3VudCAqIHBhcnNlRmxvYXQoZGF0YVJvdy50eG5SYXRlIHx8IDEpCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgInBhaWRBbW91bnQiOgogICAgICAgICAgICAvLyBpZiAodGhpcy5pc0NoZWNrQ2hhbmdlZCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgYW10VG9iZVBhaWQgPSBwYXJzZUZsb2F0KGRhdGFSb3cuYW1vdW50VG9iZVBhaWQgfHwgMCk7CiAgICAgICAgICAgIHBhaWRBbW91bnQgPSBwYXJzZUZsb2F0KGRhdGFSb3cucGFpZEFtb3VudCB8fCAwKTsKICAgICAgICAgICAgaWYgKHBhaWRBbW91bnQgPiBhbXRUb2JlUGFpZCkgewogICAgICAgICAgICAgIHBhaWRBbW91bnQgPSBhbXRUb2JlUGFpZDsKICAgICAgICAgICAgfQogICAgICAgICAgICBkYXRhUm93LnNldCgicGFpZEFtb3VudCIsIHBhcnNlRmxvYXQocGFpZEFtb3VudCkpOwogICAgICAgICAgICBkYXRhUm93LnNldCgKICAgICAgICAgICAgICAicGFpZEFtb3VudFRvYmFzZSIsCiAgICAgICAgICAgICAgcGFyc2VGbG9hdChwYWlkQW1vdW50KSAqIHBhcnNlRmxvYXQoZGF0YVJvdy5yYXRlVG9iYXNlIHx8IDEpCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGRhdGFSb3cuc2V0KAogICAgICAgICAgICAgICJwYWlkQW1vdW50VHhuIiwKICAgICAgICAgICAgICBwYWlkQW1vdW50ICogcGFyc2VGbG9hdChkYXRhUm93LnR4blJhdGUgfHwgMSkKICAgICAgICAgICAgKTsKICAgICAgICAgICAgLy8gfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5wdXJjaGFzZVR4bigpOwogICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpOwogICAgICB9CiAgICB9LAogICAgYXN5bmMgbG9hZFNhbGVGb3JtQ29udGVudCgpIHsKICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICBwdXJjaGFzZUZvcm1Db250ZW50SGFuZGxlci5saXN0KCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICBjb25zdCBkYXRhID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlRm9ybUNvbnRlbnQgPSBkYXRhWzBdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSwgMTApOwogICAgICB9KTsKICAgIH0sCiAgICBhc3luYyBsb2FkVmVuZG9yQmFsYW5jZShpZCkgewogICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgIGNvbnN0IHN0ckZpbHRlciA9IGlkICsgIj90eXBlPWJhbCI7CiAgICAgICAgICB0aGlzLnJlcXVlc3RQYXltZW50LnZlbmRvckJhbGFuY2UgPSAwOwogICAgICAgICAgYmlsbGluZ0hhbmRsZXIuYmFsYW5jZShzdHJGaWx0ZXIpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0UGF5bWVudC52ZW5kb3JCYWxhbmNlID0gZGF0YVswXS5iYWxhbmNlOwogICAgICAgICAgICAgICAgdGhpcy5iYWxhbmNlID0gdGhpcy5udW1iZXJGb3JtYXQoZGF0YVswXS5iYWxhbmNlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0sIDEwKTsKICAgICAgfSk7CiAgICB9LAogICAgbnVtYmVyRm9ybWF0KHZhbHVlKSB7CiAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyh2YWx1ZSwgYG4ke3RoaXMucHVyY2hhc2VGb3JtQ29udGVudC5kZWNpbWFsfWApOwogICAgfSwKICAgIGF1dG9DYWxjdWxhdGUoKSB7CiAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuaXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpLAogICAgICAgIHJlY2VpcHRBbW91bnQgPSAwLAogICAgICAgIGRpc2NvdW50ID0gMCwKICAgICAgICBjb252ZXJ0ZWRBbW91bnQgPSAwLAogICAgICAgIGV4Y2hhbmdlRGlzY291bnQgPSAwLAogICAgICAgIGV4Y2hhbmdlRGlzY291bnRUeG4gPSAwLAogICAgICAgIHBhaWRBbW91bnRUeG4gPSAwOwogICAgICB0aGlzLmpSYXcgPSBbXTsKICAgICAgY29uc3Qgcm93cyA9IGRzLmRhdGEoKS5maWx0ZXIoKG4pID0+IG4ucGFpZEFtb3VudCA+IDAgfHwgbi5kaXNjb3VudCA+IDApOwogICAgICByb3dzLmZvckVhY2goKHZhbHVlKSA9PiB7CiAgICAgICAgaWYgKH50aGlzLnNlbGVjdGVkRXhwZW5zZUlkcy5pbmRleE9mKHZhbHVlLmxpbmVJZCkpIHsKICAgICAgICAgIGxldCBuYXR1cmUgPSAiIiwKICAgICAgICAgICAgcHVyY2hhc2VSYXRlID0gMCwKICAgICAgICAgICAgcGF5bWVudFJhdGUgPSAwLAogICAgICAgICAgICByYXdQYWlkQW1vdW50ID0gMCwKICAgICAgICAgICAgcmF3RGlzY291bnRBbW91bnQgPSAwLAogICAgICAgICAgICBjdXJyZW5jeUNvZGUgPSAiIjsKICAgICAgICAgIGxldCBkaXNjb3VudEFtb3VudCA9IDAsCiAgICAgICAgICAgIGFwQW1vdW50ID0gMCwKICAgICAgICAgICAgcmVmTm8gPSAiIiwKICAgICAgICAgICAgcGF5T3B0aW9uID0ge30sCiAgICAgICAgICAgIGN1cnJlbmN5ID0ge30sCiAgICAgICAgICAgIGdhaW5Mb3NzID0gMCwKICAgICAgICAgICAgbGFzdFhSYXRlID0ge30sCiAgICAgICAgICAgIGxvY2F0aW9uID0ge30sCiAgICAgICAgICAgIHNlZ21lbnQgPSB7fSwKICAgICAgICAgICAgcHJvamVjdCA9IHt9LAogICAgICAgICAgICBsb2NhdGlvbklkID0gIiIsCiAgICAgICAgICAgIHNlZ21lbnRJZCA9ICIiLAogICAgICAgICAgICBwcm9qZWN0SWQgPSAiIiwKICAgICAgICAgICAgdHhuSWQgPSAiIiwKICAgICAgICAgICAgaW52UmF0ZSA9IDE7CiAgICAgICAgICBpZiAodmFsdWUucmVmZXJlbmNlTm8pIHsKICAgICAgICAgICAgcmVmTm8gPSB2YWx1ZS5yZWZlcmVuY2VObzsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh2YWx1ZS5pZCkgewogICAgICAgICAgICB0eG5JZCA9IHZhbHVlLmlkIHx8ICIiOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHZhbHVlLnR4blJhdGUpIHsKICAgICAgICAgICAgcHVyY2hhc2VSYXRlID0gcGFyc2VGbG9hdCh2YWx1ZS50eG5SYXRlKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh2YWx1ZS5jdXJyZW5jeUNvZGUpIHsKICAgICAgICAgICAgY3VycmVuY3lDb2RlID0gdmFsdWUuY3VycmVuY3lDb2RlIHx8ICIiOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHZhbHVlLmN1cnJlbmN5KSB7CiAgICAgICAgICAgIGN1cnJlbmN5ID0gdmFsdWUuY3VycmVuY3kgfHwge307CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodmFsdWUubG9jYXRpb24pIHsKICAgICAgICAgICAgbG9jYXRpb24gPSB2YWx1ZS5sb2NhdGlvbiB8fCB7fTsKICAgICAgICAgICAgaWYgKGxvY2F0aW9uLmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgbG9jYXRpb25JZCA9IGxvY2F0aW9uLmlkOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodmFsdWUuc2VnbWVudCkgewogICAgICAgICAgICBzZWdtZW50ID0gdmFsdWUuc2VnbWVudCB8fCB7fTsKICAgICAgICAgICAgaWYgKHNlZ21lbnQuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICBzZWdtZW50SWQgPSBzZWdtZW50LmlkOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodmFsdWUucHJvamVjdCkgewogICAgICAgICAgICBwcm9qZWN0ID0gdmFsdWUucHJvamVjdCB8fCB7fTsKICAgICAgICAgICAgaWYgKHByb2plY3QuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICBwcm9qZWN0SWQgPSBwcm9qZWN0LmlkOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodmFsdWUuZXhjaGFuZ2VSYXRlKSB7CiAgICAgICAgICAgIGxhc3RYUmF0ZSA9IHZhbHVlLmV4Y2hhbmdlUmF0ZSB8fCB7fTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh2YWx1ZS50eG5SYXRlKSB7CiAgICAgICAgICAgIGludlJhdGUgPSBwYXJzZUZsb2F0KHZhbHVlLnR4blJhdGUpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHZhbHVlLnJhdGVUb2Jhc2UpIHsKICAgICAgICAgICAgcGF5bWVudFJhdGUgPSBwYXJzZUZsb2F0KHZhbHVlLnJhdGVUb2Jhc2UpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHZhbHVlLnBhaWRBbW91bnQpIHsKICAgICAgICAgICAgcmVjZWlwdEFtb3VudCArPSBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnBhaWRBbW91bnQpOwogICAgICAgICAgICBjb252ZXJ0ZWRBbW91bnQgKz0KICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnBhaWRBbW91bnQpICogdmFsdWUucmF0ZVRvYmFzZTsKICAgICAgICAgICAgcGFpZEFtb3VudFR4biArPSBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnBhaWRBbW91bnQpICogaW52UmF0ZTsKICAgICAgICAgICAgLy8gcGFpZEFtdCA9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucGFpZEFtb3VudCkgKiBwdXJjaGFzZVJhdGUKICAgICAgICAgICAgcmF3UGFpZEFtb3VudCA9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucGFpZEFtb3VudCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodmFsdWUuZGlzY291bnQpIHsKICAgICAgICAgICAgLy8gZGlzY291bnQgKz0ga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5kaXNjb3VudCkKICAgICAgICAgICAgZGlzY291bnQgKz0ga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5kaXNjb3VudCkgKiB2YWx1ZS5yYXRlVG9iYXNlOwogICAgICAgICAgICBleGNoYW5nZURpc2NvdW50ICs9CiAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5leGNoYW5nZURpc2NvdW50KSAqIHZhbHVlLnJhdGVUb2Jhc2U7CiAgICAgICAgICAgIGV4Y2hhbmdlRGlzY291bnRUeG4gKz0ga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5kaXNjb3VudCkgKiBpbnZSYXRlOwogICAgICAgICAgICBkaXNjb3VudEFtb3VudCA9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuZGlzY291bnQpICogcGF5bWVudFJhdGU7CiAgICAgICAgICAgIHJhd0Rpc2NvdW50QW1vdW50ID0ga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5kaXNjb3VudCk7CiAgICAgICAgICB9CiAgICAgICAgICAvLyB0b2RvOiBnYWluIG9yIGxvc3MgZXhjaGFuZ2UgcmF0ZQogICAgICAgICAgZ2Fpbkxvc3MgPQogICAgICAgICAgICBwYXJzZUZsb2F0KAogICAgICAgICAgICAgIChwdXJjaGFzZVJhdGUgLSBwYXltZW50UmF0ZSkgKiAocmF3UGFpZEFtb3VudCArIHJhd0Rpc2NvdW50QW1vdW50KQogICAgICAgICAgICApICogLTE7CiAgICAgICAgICBpZiAoZ2Fpbkxvc3MgIT09IDApIHsKICAgICAgICAgICAgaWYgKGdhaW5Mb3NzID4gMCkgewogICAgICAgICAgICAgIG5hdHVyZSA9ICJkciI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbmF0dXJlID0gImNyIjsKICAgICAgICAgICAgfQogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coImdhaW5Mb3NzIiwgZ2Fpbkxvc3MpOwogICAgICAgICAgICBpZiAoZ2Fpbkxvc3MpIHsKICAgICAgICAgICAgICBpZiAodGhpcy5nYWluTG9zc0FjYy5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgdGhpcy5qUmF3LnB1c2goewogICAgICAgICAgICAgICAgICBpZDoKICAgICAgICAgICAgICAgICAgICB0aGlzLmdhaW5Mb3NzQWNjLmlkICsKICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgIG5hdHVyZSArCiAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUNvZGUgKwogICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgcHVyY2hhc2VSYXRlICsKICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uSWQgKwogICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgcHJvamVjdElkICsKICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgIHNlZ21lbnRJZCArCiAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICB0eG5JZCwKICAgICAgICAgICAgICAgICAgdHhuSWQ6IHR4bklkLAogICAgICAgICAgICAgICAgICBwcm9qZWN0OiBwcm9qZWN0LAogICAgICAgICAgICAgICAgICBsb2NhdGlvbjogbG9jYXRpb24sCiAgICAgICAgICAgICAgICAgIHNlZ21lbnQ6IHNlZ21lbnQsCiAgICAgICAgICAgICAgICAgIHByb2plY3RJZDogcHJvamVjdElkLAogICAgICAgICAgICAgICAgICBsb2NhdGlvbklkOiBsb2NhdGlvbklkLAogICAgICAgICAgICAgICAgICBzZWdtZW50SWQ6IHNlZ21lbnRJZCwKICAgICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlOiBjdXJyZW5jeUNvZGUsCiAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiBjdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgbGFzdFhSYXRlOiBsYXN0WFJhdGUsCiAgICAgICAgICAgICAgICAgIGxpbmU6IG5ldyBJdGVtTGluZU1vZGVsKHZhbHVlKSwKICAgICAgICAgICAgICAgICAgcmVjZWlwdFJhdGU6IGdhaW5Mb3NzID4gMCA/IHBheW1lbnRSYXRlIDogcHVyY2hhc2VSYXRlLAogICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5nYWluT3JMb3NzRGVzY3JpcHRpb24sCiAgICAgICAgICAgICAgICAgIGFjY291bnQ6IHRoaXMuZ2Fpbkxvc3NBY2MsCiAgICAgICAgICAgICAgICAgIGFjY291bnRJZDogdGhpcy5nYWluTG9zc0FjYy5pZCwKICAgICAgICAgICAgICAgICAgYW1vdW50OiAwLAogICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogZ2Fpbkxvc3MsCiAgICAgICAgICAgICAgICAgIHR5cGU6IG5hdHVyZSwKICAgICAgICAgICAgICAgICAgdHlwZUFzOiAiR2Fpbk9yTG9zcyIsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIC8vVG9kbzogQVAgIERyCiAgICAgICAgICBhcEFtb3VudCA9IHJhd1BhaWRBbW91bnQgKyByYXdEaXNjb3VudEFtb3VudDsKICAgICAgICAgIGlmIChhcEFtb3VudCA+IDApIHsKICAgICAgICAgICAgbmF0dXJlID0gImRyIjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5hdHVyZSA9ICJjciI7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodmFsdWUuaGFzT3duUHJvcGVydHkoImFwQWNjIikpIHsKICAgICAgICAgICAgY29uc3QgYXBBY2MgPSB2YWx1ZS5hcEFjYzsKICAgICAgICAgICAgaWYgKGFwQWNjKSB7CiAgICAgICAgICAgICAgaWYgKGFwQWNjLmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICB0aGlzLmpSYXcucHVzaCh7CiAgICAgICAgICAgICAgICAgIGlkOgogICAgICAgICAgICAgICAgICAgIGFwQWNjLmlkICsKICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgIG5hdHVyZSArCiAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUNvZGUgKwogICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgcHVyY2hhc2VSYXRlICsKICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uSWQgKwogICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgcHJvamVjdElkICsKICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgIHNlZ21lbnRJZCArCiAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICB0eG5JZCwKICAgICAgICAgICAgICAgICAgdHhuSWQ6IHR4bklkLAogICAgICAgICAgICAgICAgICBwcm9qZWN0OiBwcm9qZWN0LAogICAgICAgICAgICAgICAgICBsb2NhdGlvbjogbG9jYXRpb24sCiAgICAgICAgICAgICAgICAgIHNlZ21lbnQ6IHNlZ21lbnQsCiAgICAgICAgICAgICAgICAgIHByb2plY3RJZDogcHJvamVjdElkLAogICAgICAgICAgICAgICAgICBsb2NhdGlvbklkOiBsb2NhdGlvbklkLAogICAgICAgICAgICAgICAgICBzZWdtZW50SWQ6IHNlZ21lbnRJZCwKICAgICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlOiBjdXJyZW5jeUNvZGUsCiAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiBjdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgbGFzdFhSYXRlOiBsYXN0WFJhdGUsCiAgICAgICAgICAgICAgICAgIGxpbmU6IG5ldyBJdGVtTGluZU1vZGVsKHZhbHVlKSwKICAgICAgICAgICAgICAgICAgcmVjZWlwdFJhdGU6IHB1cmNoYXNlUmF0ZSwKICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHJlZk5vLAogICAgICAgICAgICAgICAgICBhY2NvdW50OiBhcEFjYywKICAgICAgICAgICAgICAgICAgYWNjb3VudElkOiBhcEFjYy5pZCwKICAgICAgICAgICAgICAgICAgYW1vdW50OiBhcEFtb3VudCwKICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQ6IGFwQW1vdW50ICogcHVyY2hhc2VSYXRlLAogICAgICAgICAgICAgICAgICB0eXBlOiBuYXR1cmUsCiAgICAgICAgICAgICAgICAgIHR5cGVBczogIkFQIiwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLy9Ub2RvOiBDYXNoIEFjY291bnQgIENSCiAgICAgICAgICBpZiAodGhpcy5yZXF1ZXN0UGF5bWVudC5wYXltZW50T3B0aW9uKSB7CiAgICAgICAgICAgIHBheU9wdGlvbiA9IHRoaXMucmVxdWVzdFBheW1lbnQucGF5bWVudE9wdGlvbjsKICAgICAgICAgICAgY29uc3QgY2FzaEFtb3VudCA9IHJhd1BhaWRBbW91bnQgKiAtMTsgLy8rICgocHVyY2hhc2VSYXRlIC0gcGF5bWVudFJhdGUpICogKHJhd1BhaWRBbW91bnQgKyByYXdEaXNjb3VudEFtb3VudCkpCiAgICAgICAgICAgIC8vIGNvbnN0IGNhc2hBbW91bnQgPSByYXdQYWlkQW1vdW50ICsgKGdhaW5Mb3NzICkgKyByYXdQYWlkQW1vdW50CiAgICAgICAgICAgIGlmIChjYXNoQW1vdW50ID4gMCkgewogICAgICAgICAgICAgIG5hdHVyZSA9ICJkciI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbmF0dXJlID0gImNyIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocGF5T3B0aW9uLmhhc093blByb3BlcnR5KCJhY2NvdW50IikpIHsKICAgICAgICAgICAgICBjb25zdCBwYXlPcHRpb25BY2MgPSBwYXlPcHRpb24uYWNjb3VudDsKICAgICAgICAgICAgICBpZiAocGF5T3B0aW9uQWNjLmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICB0aGlzLmpSYXcucHVzaCh7CiAgICAgICAgICAgICAgICAgIGlkOgogICAgICAgICAgICAgICAgICAgIHBheU9wdGlvbkFjYy5pZCArCiAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICBuYXR1cmUgKwogICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlICsKICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgIHB1cmNoYXNlUmF0ZSArCiAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbklkICsKICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgIHByb2plY3RJZCArCiAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICBzZWdtZW50SWQgKwogICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgdHhuSWQsCiAgICAgICAgICAgICAgICAgIHR4bklkOiB0eG5JZCwKICAgICAgICAgICAgICAgICAgcHJvamVjdDogcHJvamVjdCwKICAgICAgICAgICAgICAgICAgbG9jYXRpb246IGxvY2F0aW9uLAogICAgICAgICAgICAgICAgICBzZWdtZW50OiBzZWdtZW50LAogICAgICAgICAgICAgICAgICBwcm9qZWN0SWQ6IHByb2plY3RJZCwKICAgICAgICAgICAgICAgICAgbG9jYXRpb25JZDogbG9jYXRpb25JZCwKICAgICAgICAgICAgICAgICAgc2VnbWVudElkOiBzZWdtZW50SWQsCiAgICAgICAgICAgICAgICAgIGN1cnJlbmN5Q29kZTogY3VycmVuY3lDb2RlLAogICAgICAgICAgICAgICAgICBjdXJyZW5jeTogY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgIGxhc3RYUmF0ZTogbGFzdFhSYXRlLAogICAgICAgICAgICAgICAgICBsaW5lOiBuZXcgSXRlbUxpbmVNb2RlbCh2YWx1ZSksCiAgICAgICAgICAgICAgICAgIHJlY2VpcHRSYXRlOiBwdXJjaGFzZVJhdGUsCiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiByZWZObywKICAgICAgICAgICAgICAgICAgYWNjb3VudDogcGF5T3B0aW9uQWNjLAogICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IHBheU9wdGlvbkFjYy5pZCwKICAgICAgICAgICAgICAgICAgYW1vdW50OiBjYXNoQW1vdW50LAogICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogY2FzaEFtb3VudCAqIHBheW1lbnRSYXRlLAogICAgICAgICAgICAgICAgICB0eXBlOiBuYXR1cmUsCiAgICAgICAgICAgICAgICAgIHR5cGVBczogIkNhc2hBY2NvdW50IiwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLy9Ub2RvOiBTZXR0bGVtZW50IERpc2NvdW50ICBDcgogICAgICAgICAgaWYgKHZhbHVlLnBheW1lbnRUZXJtKSB7CiAgICAgICAgICAgIGNvbnN0IHNldHRsZW1lbnREaXNjID0gdmFsdWUucGF5bWVudFRlcm07CiAgICAgICAgICAgIGlmIChkaXNjb3VudEFtb3VudCA+IDApIHsKICAgICAgICAgICAgICBpZiAoZGlzY291bnRBbW91bnQgKiAtMSA+IDApIHsKICAgICAgICAgICAgICAgIG5hdHVyZSA9ICJkciI7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG5hdHVyZSA9ICJjciI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyhzZXR0bGVtZW50RGlzYywgInNldHRsZW1lbnREaXNjIik7CiAgICAgICAgICAgICAgaWYgKHNldHRsZW1lbnREaXNjLmhhc093blByb3BlcnR5KCJhY2NvdW50IikpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNldHRsZW1lbnREaXNjQWNjID0gc2V0dGxlbWVudERpc2MuYWNjb3VudDsKICAgICAgICAgICAgICAgIGlmIChzZXR0bGVtZW50RGlzY0FjYy5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgICB0aGlzLmpSYXcucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgaWQ6CiAgICAgICAgICAgICAgICAgICAgICBzZXR0bGVtZW50RGlzY0FjYy5pZCArCiAgICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgICAgbmF0dXJlICsKICAgICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUNvZGUgKwogICAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICAgIHB1cmNoYXNlUmF0ZSArCiAgICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25JZCArCiAgICAgICAgICAgICAgICAgICAgICAiLSIgKwogICAgICAgICAgICAgICAgICAgICAgcHJvamVjdElkICsKICAgICAgICAgICAgICAgICAgICAgICItIiArCiAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50SWQgKwogICAgICAgICAgICAgICAgICAgICAgIi0iICsKICAgICAgICAgICAgICAgICAgICAgIHR4bklkLAogICAgICAgICAgICAgICAgICAgIHR4bklkOiB0eG5JZCwKICAgICAgICAgICAgICAgICAgICBwcm9qZWN0OiBwcm9qZWN0LAogICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBsb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICBzZWdtZW50OiBzZWdtZW50LAogICAgICAgICAgICAgICAgICAgIHByb2plY3RJZDogcHJvamVjdElkLAogICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uSWQ6IGxvY2F0aW9uSWQsCiAgICAgICAgICAgICAgICAgICAgc2VnbWVudElkOiBzZWdtZW50SWQsCiAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lDb2RlOiBjdXJyZW5jeUNvZGUsCiAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k6IGN1cnJlbmN5LAogICAgICAgICAgICAgICAgICAgIGxhc3RYUmF0ZTogbGFzdFhSYXRlLAogICAgICAgICAgICAgICAgICAgIGxpbmU6IG5ldyBJdGVtTGluZU1vZGVsKHZhbHVlKSwKICAgICAgICAgICAgICAgICAgICByZWNlaXB0UmF0ZTogcGF5bWVudFJhdGUsCiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICJQdXJjaGFzZSBQYXltZW50IERpc2NvdW50IiwKICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiBzZXR0bGVtZW50RGlzY0FjYywKICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IHNldHRsZW1lbnREaXNjQWNjLmlkLAogICAgICAgICAgICAgICAgICAgIGFtb3VudDogcmF3RGlzY291bnRBbW91bnQgKiAtMSwKICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogZGlzY291bnRBbW91bnQgKiAtMSwKICAgICAgICAgICAgICAgICAgICB0eXBlOiBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgdHlwZUFzOiAiU2V0dGxlbWVudCBEaXNjb3VudCIsCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIC8vIHRoaXMuaW52b2ljZVR4bih0eG5JZHMpCgogICAgICB0aGlzLnJlcXVlc3RQYXltZW50LnRvdGFsID0gcmVjZWlwdEFtb3VudDsKICAgICAgdGhpcy5yZXF1ZXN0UGF5bWVudC5leGNoYW5nZUFtb3VudCA9IGNvbnZlcnRlZEFtb3VudDsKICAgICAgdGhpcy5yZXF1ZXN0UGF5bWVudC5kaXNjb3VudCA9IGRpc2NvdW50OwogICAgICB0aGlzLnJlcXVlc3RQYXltZW50LmV4Y2hhbmdlRGlzY291bnQgPSBleGNoYW5nZURpc2NvdW50OwogICAgICB0aGlzLnJlcXVlc3RQYXltZW50LnBhaWRBbW91bnRUeG4gPSBwYWlkQW1vdW50VHhuOwogICAgICB0aGlzLnJlcXVlc3RQYXltZW50LmV4Y2hhbmdlRGlzY291bnRUeG4gPSBleGNoYW5nZURpc2NvdW50VHhuOwogICAgICB0aGlzLnJlcXVlc3RQYXltZW50LmZ1bmRSZW1haW5CYWxhbmNlID0KICAgICAgICBwYXJzZUZsb2F0KHRoaXMucmVxdWVzdFBheW1lbnQuZnVuZEJhbGFuY2UgfHwgMCkgLQogICAgICAgIHBhcnNlRmxvYXQoY29udmVydGVkQW1vdW50KTsKICAgICAgdGhpcy5yZXF1ZXN0UGF5bWVudC52ZW5kb3JSZW1haW5pbmdCYWxhbmNlID0KICAgICAgICBwYXJzZUZsb2F0KHRoaXMucmVxdWVzdFBheW1lbnQudmVuZG9yQmFsYW5jZSB8fCAwKSAtCiAgICAgICAgKHBhcnNlRmxvYXQoY29udmVydGVkQW1vdW50KSArIGRpc2NvdW50KTsKCiAgICAgIHRoaXMudmVuZG9yUmVtYWluaW5nQmFsYW5jZSA9IHRoaXMubnVtYmVyRm9ybWF0KAogICAgICAgIHBhcnNlRmxvYXQodGhpcy5yZXF1ZXN0UGF5bWVudC52ZW5kb3JCYWxhbmNlIHx8IDApIC0KICAgICAgICAgIChwYXJzZUZsb2F0KGNvbnZlcnRlZEFtb3VudCkgKyBkaXNjb3VudCkKICAgICAgKTsKICAgICAgdGhpcy5mdW5kUmVtYWluQmFsYW5jZSA9IHRoaXMubnVtYmVyRm9ybWF0KAogICAgICAgIHBhcnNlRmxvYXQodGhpcy5yZXF1ZXN0UGF5bWVudC5mdW5kQmFsYW5jZSB8fCAwKSAtCiAgICAgICAgICBwYXJzZUZsb2F0KGNvbnZlcnRlZEFtb3VudCkKICAgICAgKTsKICAgICAgdGhpcy5zaHJpbmtEYXRhKHRoaXMualJhdyk7CiAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygiYWEiLCByb3dzKTsKICAgIH0sCiAgICBzaHJpbmtEYXRhKG9iaikgewogICAgICBjb25zdCB1bmlxdWVzID0gdGhpcy5yZW1vdmVEdXBsaWNhdGUob2JqKTsKICAgICAgdW5pcXVlcy5mb3JFYWNoKChuKSA9PiB7CiAgICAgICAgY29uc3QgZm91bmQgPSBvYmouZmlsdGVyKChtKSA9PiBtLmlkID09PSBuLmlkKTsKICAgICAgICBsZXQgYW1vdW50ID0gMCwKICAgICAgICAgIGV4Y2hhbmdlQW1vdW50ID0gMDsKICAgICAgICBmb3VuZC5mb3JFYWNoKCh6KSA9PiB7CiAgICAgICAgICBhbW91bnQgKz0gcGFyc2VGbG9hdCh6LmFtb3VudCB8fCAwKTsKICAgICAgICAgIGV4Y2hhbmdlQW1vdW50ICs9IHBhcnNlRmxvYXQoei5leGNoYW5nZUFtb3VudCB8fCAwKTsKICAgICAgICB9KTsKICAgICAgICBuLmV4Y2hhbmdlQW1vdW50ID0gcGFyc2VGbG9hdChleGNoYW5nZUFtb3VudCk7IC8vdGhpcy5udW1iZXJGb3JtYXQoYW1vdW50KQogICAgICAgIG4uYW1vdW50ID0gcGFyc2VGbG9hdChhbW91bnQpOyAvL3BhcnNlRmxvYXQocGFyc2VGbG9hdChhbW91bnQgLyBwYXJzZUZsb2F0KG4ucmVjZWlwdFJhdGUpKSkgLy90aGlzLm51bWJlckZvcm1hdChhbW91bnQgKiBwYXJzZUZsb2F0KHRoaXMuaW52b2ljZS50eG5SYXRlKSkgLy8udG9GaXhlZCh0aGlzLnNhbGVGb3JtQ29udGVudC5kZWNpbWFsKQogICAgICB9KTsKICAgICAgdGhpcy5qUmF3ID0gdW5pcXVlczsKICAgICAgbGV0IGRyID0gMCwKICAgICAgICBjciA9IDA7CiAgICAgIHRoaXMualJhdy5mb3JFYWNoKChqKSA9PiB7CiAgICAgICAgc3dpdGNoIChqLnR5cGUpIHsKICAgICAgICAgIGNhc2UgImNyIjoKICAgICAgICAgICAgY3IgKz0gcGFyc2VGbG9hdChqLmV4Y2hhbmdlQW1vdW50KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJkciI6CiAgICAgICAgICAgIGRyICs9IHBhcnNlRmxvYXQoai5leGNoYW5nZUFtb3VudCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHRoaXMualJhdyksICd1bmlxdWVzJykKICAgICAgY29uc3QgdHhuSWQgPSB0aGlzLmpSYXcubWFwKChvKSA9PiBvLnR4bklkKTsKICAgICAgY29uc3QgdVNldCA9IG5ldyBTZXQodHhuSWQpOwogICAgICBjb25zdCB1bmlxdWVTZXQgPSBbLi4udVNldF07CiAgICAgIGxldCBqUmF3cyA9IFtdOwogICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkodW5pcXVlU2V0KSwgJ3VuaXF1ZXMnKQogICAgICB1bmlxdWVTZXQuZm9yRWFjaCgobikgPT4gewogICAgICAgIGNvbnN0IGZvdW5kID0gdGhpcy5qUmF3LmZpbHRlcigobSkgPT4gbS50eG5JZCA9PT0gbik7CiAgICAgICAgY29uc3QgbGluZSA9IGZvdW5kWzBdLmxpbmU7CiAgICAgICAgY29uc3QgcmVmTm8gPSBsaW5lLnJlZmVyZW5jZU5vOwogICAgICAgIGpSYXdzLnB1c2goewogICAgICAgICAgaWQ6IG4sCiAgICAgICAgICBjdXJyZW5jeUNvZGU6IGZvdW5kWzBdLmN1cnJlbmN5Q29kZSwKICAgICAgICAgIHByb2plY3RJZDogZm91bmRbMF0ucHJvamVjdElkLAogICAgICAgICAgc2VnbWVudElkOiBmb3VuZFswXS5zZWdtZW50SWQsCiAgICAgICAgICBsb2NhdGlvbklkOiBmb3VuZFswXS5sb2NhdGlvbklkLAogICAgICAgICAgcmVmZXJlbmNlTm86IHJlZk5vIHx8ICIiLAogICAgICAgICAgZW50cmllczogZm91bmQsCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICB0aGlzLmpSYXcgPSBqUmF3czsKICAgICAgdGhpcy5kciA9IGRyOwogICAgICB0aGlzLmNyID0gY3I7CiAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygiZHI9IiwgZHIsICJjcj0iLCBjciwgImRyK2NyID0gIiwgZHIgKyBjcik7CiAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhqUmF3cywgInVuaXF1ZXMiKTsKICAgIH0sCiAgICBwdXJjaGFzZVR4bigpIHsKICAgICAgbGV0IHR4bklkcyA9IFtdLAogICAgICAgIGlkcyA9IFtdOwogICAgICB0aGlzLml0ZW1MaW5lcy5mb3JFYWNoKCh2YWx1ZSkgPT4gewogICAgICAgIGlmICh2YWx1ZS5pZCkgewogICAgICAgICAgdHhuSWRzLnB1c2goewogICAgICAgICAgICBpZDogdmFsdWUuaWQsCiAgICAgICAgICAgIHN0YXR1czogMSwKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIGlkcyA9IE9iamVjdC52YWx1ZXModHhuSWRzLnJlZHVjZSgociwgbykgPT4gKChyW28uaWRdID0gbyksIHIpLCB7fSkpOwogICAgICBpZHMuZm9yRWFjaCgobSkgPT4gewogICAgICAgIGNvbnN0IGxpbmVzID0gdGhpcy5pdGVtTGluZXMuZmlsdGVyKChuKSA9PiBuLmlkID09PSBtLmlkKTsKICAgICAgICBsZXQgcGFpZEFtdCA9IDA7CiAgICAgICAgbGV0IGFtb3VudFRvYmVQYWlkID0gMDsKICAgICAgICBsaW5lcy5mb3JFYWNoKCh4KSA9PiB7CiAgICAgICAgICBpZiAoeC5wYWlkQW1vdW50KSB7CiAgICAgICAgICAgIHBhaWRBbXQgKz0geC5wYWlkQW1vdW50OwogICAgICAgICAgfQogICAgICAgICAgaWYgKHguYW1vdW50VG9iZVBhaWQpIHsKICAgICAgICAgICAgYW1vdW50VG9iZVBhaWQgKz0geC5hbW91bnRUb2JlUGFpZDsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBjb25zdCBwQW10ID0gdGhpcy5udW1iZXJGb3JtYXQocGFpZEFtdCk7CiAgICAgICAgY29uc3QgYW10VG9iZVBhaWQgPSB0aGlzLm51bWJlckZvcm1hdChhbW91bnRUb2JlUGFpZCk7CiAgICAgICAgaWYgKHBBbXQgPT09IGFtdFRvYmVQYWlkKSB7CiAgICAgICAgICBtWyJzdGF0dXMiXSA9IDM7IC8vUGFpZAogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtWyJzdGF0dXMiXSA9IDI7IC8vIFBhcnRpYWxseSBQYWlkCiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy50eG5MaXN0ID0gaWRzOwogICAgfSwKICAgIGFzeW5jIGxvYWRPdGhlckFjY291bnQoKSB7CiAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgc2V0dGluZ0hhbmRsZXIKICAgICAgICAgICAgLmdldE90aGVyQWNjb3VudCgpCiAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gcmVzcG9uc2UuZmlsdGVyKAogICAgICAgICAgICAgICAgICAobykgPT4gby5iYW5oamlBY2NDb2RlID09PSAiNzQwMDEwIgogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGlmIChkYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgdGhpcy5nYWluTG9zc0FjYyA9IGRhdGFbMF0uYWNjb3VudDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFfID0gcmVzcG9uc2UuZmlsdGVyKAogICAgICAgICAgICAgICAgICAobykgPT4gby5iYW5oamlBY2NDb2RlID09PSAiNzQwMDQwIgogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGlmIChkYXRhXy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMub3RoZXJSZXZlbnVlQWNjID0gZGF0YV9bMF0uYWNjb3VudDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgpOwogICAgICAgICAgewogICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfSwgMTApOwogICAgICB9KTsKICAgIH0sCiAgICBhc3luYyBvblNhdmVDbG9zZSgpIHsKICAgICAgaWYgKCF0aGlzLiRyZWZzLmZvcm0udmFsaWRhdGUoKSkgewogICAgICAgIHRoaXMuJHJlZnMuZm9ybS52YWxpZGF0ZSgpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgIGxldCBpdGVtTGluZURTID0gdGhpcy4kcmVmcy5pdGVtTGluZURTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICBsZXQgaXRlbUxpbmVzID0gW107CiAgICAgICAgICBjb25zdCBzdXBwbGllciA9IHRoaXMucmVxdWVzdFBheW1lbnQuc3VwcGxpZXIgfHwge307CiAgICAgICAgICBpdGVtTGluZURTCiAgICAgICAgICAgIC5kYXRhKCkKICAgICAgICAgICAgLmZpbHRlcigobikgPT4gbi5wYWlkQW1vdW50ID4gMCB8fCBuLmRpc2NvdW50ID4gMCkKICAgICAgICAgICAgLm1hcCgobikgPT4gewogICAgICAgICAgICAgIGlmICh+dGhpcy5zZWxlY3RlZEV4cGVuc2VJZHMuaW5kZXhPZihuLmxpbmVJZCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbmN5ID0gbi5jdXJyZW5jeSB8fCB7fTsKICAgICAgICAgICAgICAgIG5bInBheW1lbnRPcHRpb24iXSA9IG5ldyBQYXltZW50T3B0aW9uTW9kZWwoCiAgICAgICAgICAgICAgICAgIG4ucGF5bWVudE9wdGlvbiB8fCB7fQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIG5bInBheW1lbnRUZXJtIl0gPSBuZXcgUGF5bWVudFRlcm1Nb2RlbChuLnBheW1lbnRUZXJtIHx8IHt9KTsKICAgICAgICAgICAgICAgIG5bImN1cnJlbmN5Il0gPSBuZXcgQ3VycmVuY3lNb2RlbChuLmN1cnJlbmN5IHx8IHt9KTsKICAgICAgICAgICAgICAgIG5bImN1cnJlbmN5Q29kZSJdID0gY3VycmVuY3kuY29kZSB8fCAiIjsKICAgICAgICAgICAgICAgIG5bImFwQWNjIl0gPSBuZXcgQWNjb3VudE1hcHBpbmdNb2RlbChuLmFwQWNjIHx8IHt9KTsKICAgICAgICAgICAgICAgIG5bInN1cHBsaWVyIl0gPSBuZXcgU3VwcGxpZXJNb2RlbChzdXBwbGllcik7CiAgICAgICAgICAgICAgICBuWyJpZCJdID0gblsidHhuSWQiXTsKICAgICAgICAgICAgICAgIGl0ZW1MaW5lcy5wdXNoKG5ldyBJdGVtTGluZU1vZGVsKG4pKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKGl0ZW1MaW5lcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGxldCBpc0F1dG9HZW5lcmF0ZSA9IDE7CiAgICAgICAgICAgIC8vdG9kbzogbWF0Y2ggUmVxdWVzdCBQYXltZW50IG1vZGVsCiAgICAgICAgICAgIHRoaXMucmVxdWVzdFBheW1lbnRbIml0ZW1MaW5lcyJdID0gaXRlbUxpbmVzOwogICAgICAgICAgICB0aGlzLnJlcXVlc3RQYXltZW50WyJ0eXBlIl0gPSBUUkFOU0FDVElPTl9UWVBFOwogICAgICAgICAgICB0aGlzLnJlcXVlc3RQYXltZW50WyJpc0F1dG9HZW5lcmF0ZSJdID0gaXNBdXRvR2VuZXJhdGU7CiAgICAgICAgICAgIHRoaXMucmVxdWVzdFBheW1lbnRbImFjdGlvblR5cGUiXSA9IHRoaXMuJHJvdXRlLnBhcmFtcy5pZAogICAgICAgICAgICAgID8gdGhpcy4kcm91dGUucXVlcnkudHlwZQogICAgICAgICAgICAgIDogIm5ldyI7CiAgICAgICAgICAgIHRoaXMucmVxdWVzdFBheW1lbnRbImxvZ2dlZFVzZXIiXSA9IHRoaXMubG9nZ2VkVXNlcjsKCiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coJ3RoaXMuaXRlbUxpbmVzJywgaXRlbUxpbmVzKQogICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coJ3RoaXMuaXRlbUxpbmVzJywgSlNPTi5zdHJpbmdpZnkoaXRlbUxpbmVzKSkKICAgICAgICAgICAgYmlsbGluZ0hhbmRsZXIKICAgICAgICAgICAgICAuY3JlYXRlUmVxdWVzdFBheW1lbnQoCiAgICAgICAgICAgICAgICBuZXcgUmVxdWVzdFBheW1lbnRNb2RlbCh0aGlzLnJlcXVlc3RQYXltZW50KQogICAgICAgICAgICAgICkKICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMSkgewogICAgICAgICAgICAgICAgICAvLyB0aGlzLmNsb3NlKHJlc3BvbnNlLmRhdGEuZGF0YSkKICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LnN1Y2Nlc3MoIlN1Y2Nlc3NmdWxseSIpOwogICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgIHdpbmRvdy5oaXN0b3J5LmdvKC0xKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcigiU29tZXRoaW5nIHdlbnQgd3JvbmciKTsKICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JzLnB1c2goZSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgMjApOwogICAgICB9KTsKICAgIH0sCiAgICBjbGVhcigpIHsKICAgICAgdGhpcy5pZCA9IHVuZGVmaW5lZDsKICAgICAgdGhpcy5yZXF1ZXN0UGF5bWVudCA9IG5ldyBSZXF1ZXN0UGF5bWVudE1vZGVsKHt9KTsKICAgICAgdGhpcy5pdGVtTGluZXMgPSBbXTsKICAgICAgdGhpcy5yZXF1ZXN0UGF5bWVudC50cmFuc2FjdGlvblR5cGUgPSB0aGlzLnRyYW5zYWN0aW9uVHlwZXNbMF07CiAgICAgIHRoaXMuZ2VuZXJhdGVOdW1iZXIoKTsKICAgIH0sCiAgICBhc3luYyBsb2FkRW50cnlEZXRhaWxCeUFjY291bnQoaWQsIHBhcmFtcykgewogICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgam91cm5hbEhhbmRsZXIuZ2V0RW50cnlEZXRhaWxCeUFjY291bnQoaWQsIHBhcmFtcykudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgIC8vIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLnJlcXVlc3RQYXltZW50LmZ1bmRCYWxhbmNlID0gcmVzLmVuZGluZ19iYWxhbmNlIHx8IDA7CiAgICAgICAgICAgIHRoaXMuZnVuZEJhbGFuY2UgPSB0aGlzLm51bWJlckZvcm1hdChyZXMuZW5kaW5nX2JhbGFuY2UgfHwgMCk7CiAgICAgICAgICAgIHRoaXMuZnVuZFJlbWFpbkJhbGFuY2UgPSB0aGlzLm51bWJlckZvcm1hdCgKICAgICAgICAgICAgICBwYXJzZUZsb2F0KHJlcy5lbmRpbmdfYmFsYW5jZSB8fCAwKSAtCiAgICAgICAgICAgICAgICBwYXJzZUZsb2F0KHRoaXMucmVxdWVzdFBheW1lbnQuZXhjaGFuZ2VBbW91bnQpCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHRoaXMucmVxdWVzdFBheW1lbnQuZnVuZFJlbWFpbkJhbGFuY2UgPQogICAgICAgICAgICAgIHBhcnNlRmxvYXQocmVzLmVuZGluZ19iYWxhbmNlIHx8IDApIC0KICAgICAgICAgICAgICBwYXJzZUZsb2F0KHRoaXMucmVxdWVzdFBheW1lbnQuZnVuZEJhbGFuY2UpOwogICAgICAgICAgICAvLyB9IGVsc2UgewogICAgICAgICAgICAvLyAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgIC8vIH0KICAgICAgICAgIH0pOwogICAgICAgIH0sIDEwKTsKICAgICAgfSk7CiAgICB9LAogIH0sCiAgbW91bnRlZDogYXN5bmMgZnVuY3Rpb24oKSB7CiAgICAvLyB0aGlzLmxvYWRTdXBwbGllcnMoKQogICAgLy8gdGhpcy5sb2FkVmVuZG9ycygnJywgdGhpcy5zdXBCYXNlVXJsKQogICAgYXdhaXQgdGhpcy5sb2FkUHJlZml4KCk7CiAgICBhd2FpdCB0aGlzLmxvYWRTYWxlRm9ybUNvbnRlbnQoKTsKICAgIGF3YWl0IHRoaXMubG9hZE90aGVyQWNjb3VudCgpOwogIH0sCiAgY29tcHV0ZWQ6IHt9LAp9Owo="},{"version":3,"sources":["RequestPayment.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAydA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"RequestPayment.vue","sourceRoot":"src/views/suppliers","sourcesContent":["<template>\n  <v-app>\n    <v-container>\n      <v-row>\n        <v-col cols=\"12\" sm=\"12\">\n          <v-card\n            outlined\n            dense\n            class=\"pa-4 no_border rounded-sm\"\n            color=\"white\"\n          >\n            <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n              <v-card outlined dense class=\"no_border mb-1\">\n                <h2 class=\"mb-0 \">{{ $t(\"payment_request\") }}</h2>\n                <v-icon\n                  @click=\"cancel()\"\n                  style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                  class=\"float-right\"\n                  >close\n                </v-icon>\n              </v-card>\n\n              <v-card outlined dense class=\"px-3 no_border mb-3\" color=\"white\">\n                <v-row style=\"background: #F8F8F9;\">\n                  <v-col\n                    sm=\"3\"\n                    cols=\"12\"\n                    class=\"kendo_dropdown_custom pt-3 pb-0\"\n                  >\n                    <label>{{ $t(\"vendor_name\") }}</label>\n                    <vendor-dropdownlist\n                      :initVendor=\"requestPayment.supplier\"\n                      @emitVendor=\"requestPayment.supplier = $event\"\n                      @onChange=\"onVendorChanged\"\n                    />\n                  </v-col>\n                  <v-col\n                    sm=\"3\"\n                    cols=\"12\"\n                    class=\"kendo_dropdown_custom pt-3 pb-0\"\n                  >\n                    <label>{{ $t(\"request_date\") }}</label>\n                    <app-datepicker\n                      :initialDate=\"requestPayment.transactionDate\"\n                      @emitDate=\"requestPayment.transactionDate = $event\"\n                    />\n                  </v-col>\n                  <v-col sm=\"4\">\n                    <label>{{ $t(\"number\") }}</label>\n                    <div class=\"d-flex mt-1\">\n                      <div class=\"code_text flex-1 text-bold\">\n                        {{ requestPayment.transactionType.abbr }}\n                      </div>\n\n                      <v-text-field\n                        class=\" custom-border flex-2\"\n                        v-model=\"requestPayment.number\"\n                        outlined\n                        disabled\n                        :rules=\"[(v) => !!v || 'Number is required']\"\n                        required\n                      />\n                      <v-icon\n                        color=\"black\"\n                        size=\"30\"\n                        style=\" height: 40px;\"\n                        class=\"border_qrcode ml-2\"\n                        @click=\"generateNumber\"\n                        >mdi-qrcode\n                      </v-icon>\n                    </div>\n                  </v-col>\n                  <v-col sm=\"1\" cols=\"1\" class=\"pb-0\">\n                    <v-btn\n                      color=\"primary mt-6 white--text\"\n                      @click=\"searchPurchaseOrderExpense\"\n                    >\n                      <i\n                        class=\"b-search\"\n                        style=\"font-size: 15px; color:#fff !important;\"\n                      />\n                    </v-btn>\n                  </v-col>\n                </v-row>\n                <v-row style=\"background: #F8F8F9;\"> </v-row>\n                <v-row>\n                  <v-col cols=\"12\" class=\"pt-0\">\n                    <template>\n                      <LoadingMe\n                        :isLoading=\"showLoading\"\n                        :fullPage=\"false\"\n                        :myLoading=\"true\"\n                      />\n                      <kendo-datasource\n                        ref=\"itemLineDS\"\n                        :change=\"onDataSourceChange\"\n                        :schema=\"schemaDefinition\"\n                        :data=\"itemLines\"\n                      />\n                      <kendo-grid\n                        id=\"gridRequestPayment_\"\n                        class=\"grid-function\"\n                        :data-source-ref=\"'itemLineDS'\"\n                        ref=\"gridRequestPayment\"\n                        :sortable=\"false\"\n                        :filterable=\"false\"\n                        :column-menu=\"true\"\n                        :editable=\"true\"\n                        :change=\"onGridRequestChange\"\n                        :noRecords=\"true\"\n                      >\n                        <kendo-grid-column\n                          :locked=\"true\"\n                          :selectable=\"true\"\n                          :width=\"40\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'billNumber'\"\n                          :title=\"$t('bill_number')\"\n                          :width=\"180\"\n                          :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                          :template=\"billNumberTmp\"\n                          :locked=\"true\"\n                          :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'referenceNo'\"\n                          :title=\"$t('transaction_num')\"\n                          :width=\"210\"\n                          :hidden=\"false\"\n                          :locked=\"true\"\n                          :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                          :template=\"referenceNoTmp\"\n                          :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'dueDate'\"\n                          :title=\"$t('due_date')\"\n                          :width=\"150\"\n                          :lockable=\"false\"\n                          :template=\"formatDate\"\n                          :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                          :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'txnNote'\"\n                          :title=\"$t('note')\"\n                          :width=\"200\"\n                          :hidden=\"false\"\n                          :lockable=\"false\"\n                          :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                          :attributes=\"{ style: 'text-align: left; ' }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'currencyCode'\"\n                          :title=\"$t('currency')\"\n                          :width=\"150\"\n                          :lockable=\"false\"\n                          :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                          :template=\"currency\"\n                          :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'amount'\"\n                          :title=\"$t('amount')\"\n                          :width=\"150\"\n                          :lockable=\"false\"\n                          :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                          :template=\"amount\"\n                          :attributes=\"{ style: 'text-align: right' }\"\n                          :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'discount'\"\n                          :title=\"$t('discount')\"\n                          :editor=\"discountEditor\"\n                          :template=\"discount\"\n                          :width=\"150\"\n                          :lockable=\"false\"\n                          :headerAttributes=\"{\n                            style:\n                              'text-align: right; background-color: #EDF1F5',\n                          }\"\n                          :attributes=\"{ style: 'text-align: right' }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'amountTobePaid'\"\n                          :title=\"$t('amount_to_be_paid')\"\n                          :width=\"210\"\n                          :lockable=\"false\"\n                          :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                          :template=\"amountTobePaid\"\n                          :attributes=\"{ style: 'text-align: right; ' }\"\n                          :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'paidAmount'\"\n                          :title=\"$t('paid_amount')\"\n                          :width=\"200\"\n                          :lockable=\"false\"\n                          :editor=\"paidAmountEditor\"\n                          :template=\"paidAmountTmp\"\n                          :headerAttributes=\"{\n                            style:\n                              'text-align: right; background-color: #EDF1F5',\n                          }\"\n                          :attributes=\"{ style: 'text-align: right; ' }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'overDue'\"\n                          :title=\"$t('over_due')\"\n                          :width=\"130\"\n                          :lockable=\"false\"\n                          :hidden=\"true\"\n                          :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                          :template=\"overDue\"\n                          :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'paymentTerm'\"\n                          :title=\"$t('payment_term')\"\n                          :width=\"200\"\n                          :lockable=\"false\"\n                          :hidden=\"true\"\n                          :template=\"settlementDiscount\"\n                          :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                          :headerAttributes=\"{\n                            style:\n                              'text-align: right; background-color: #EDF1F5',\n                          }\"\n                          :attributes=\"{ style: 'text-align: right; ' }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'bankReferenceNo'\"\n                          :title=\"$t('bank_reference_no')\"\n                          :width=\"180\"\n                          :lockable=\"false\"\n                          :hidden=\"true\"\n                          :template=\"bankReferenceNo\"\n                          :headerAttributes=\"{\n                            style:\n                              'text-align: right; background-color: #EDF1F5',\n                          }\"\n                          :attributes=\"{ style: 'text-align: right; ' }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'status'\"\n                          :title=\"$t('status')\"\n                          :width=\"150\"\n                          :lockable=\"false\"\n                          :template=\"status\"\n                          :hidden=\"true\"\n                          :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                          :headerAttributes=\"{\n                            style:\n                              'text-align: right; background-color: #EDF1F5',\n                          }\"\n                          :attributes=\"{ style: 'text-align: right; ' }\"\n                        />\n                      </kendo-grid>\n                    </template>\n                  </v-col>\n                  <v-col sm=\"12\" cols=\"12\" class=\"pb-0\">\n                    <v-row>\n                      <v-col sm=\"6\" cols=\"12\" class=\"\"></v-col>\n                      <v-col sm=\"6\" cols=\"12\">\n                        <v-simple-table>\n                          <template v-slot:default>\n                            <tbody>\n                              <tr>\n                                <td class=\"text-left text-uppercase\">\n                                  {{ $t(\"discount\") }}\n                                </td>\n                                <td class=\"text-center\">:</td>\n                                <td class=\"text-left primary--text text-bold\">\n                                  {{ numberFormat(requestPayment.discount) }}\n                                </td>\n                              </tr>\n                              <tr>\n                                <td class=\"text-left text-uppercase\">\n                                  {{ $t(\"exchange_amount\") }} -\n                                  {{ baseCurrencyCode }}\n                                </td>\n                                <td class=\"text-center\">:</td>\n                                <td class=\"text-left primary--text text-bold\">\n                                  {{\n                                    numberFormat(requestPayment.exchangeAmount)\n                                  }}\n                                </td>\n                              </tr>\n                              <tr hidden>\n                                <td class=\"text-left text-uppercase\">\n                                  {{ $t(\"dr\") }}\n                                </td>\n                                <td class=\"text-center\">:</td>\n                                <td class=\"text-left primary--text text-bold\">\n                                  {{ numberFormat(dr) }}\n                                </td>\n                              </tr>\n                              <tr hidden>\n                                <td class=\"text-left text-uppercase\">\n                                  {{ $t(\"cr\") }}\n                                </td>\n                                <td class=\"text-center\">:</td>\n                                <td class=\"text-left primary--text text-bold\">\n                                  {{ numberFormat(cr) }}\n                                </td>\n                              </tr>\n                            </tbody>\n                          </template>\n                        </v-simple-table>\n                      </v-col>\n                    </v-row>\n                  </v-col>\n                </v-row>\n                <!-- Payment Options & Position Analysis -->\n                <v-row>\n                  <v-col sm=\"4\" cols=\"4\" class=\"kendo_dropdown_custom\">\n                    <v-card outlined dense class=\"no_border pa-4\" color=\"grayBg\" >\n                      <h3 class=\"mb-1\">{{ $t(\"payment_option_position\") }}</h3>\n                      <label>{{ $t(\"payment_option\") }}</label>\n                      <div class=\"mb-3\">\n                      <paymentoption-dropdownlist\n                        :initPaymentOption=\"requestPayment.paymentOption\"\n                        :initType=\"'Supplier'\"\n                        @onChange=\"onPaymentOptionChanged\"\n                      />\n                      </div>\n\n                      <label>{{ $t(\"expected_payment_date\") }}</label>\n                      <app-datepicker\n                        :initialDate=\"requestPayment.expectedPaymentDate\"\n                        @emitDate=\"requestPayment.expectedPaymentDate = $event\"\n                      />\n                    </v-card>\n                  </v-col>\n                  <v-col sm=\"4\" cols=\"4\" class=\"kendo_dropdown_custom\">\n                    <!-- Fund Position  -->\n                    <v-card outlined dense class=\"no_border pa-4\" color=\"grayBg\" mind>\n                      <h3 class=\"mb-1\">{{ $t(\"fund_position\") }}</h3>\n                      <label>{{ $t(\"current_balance\") }}</label>\n                      <h1 class=\"font_16 primary--text my-3 text-right\">{{fundBalance}}</h1>\n\n                      <label>{{ $t(\"remaining_balance\") }}</label>\n                      <h1 class=\"font_16 primary--text my-3 text-right\">{{fundRemainBalance}}</h1>\n                    </v-card>\n                  </v-col>\n                  <v-col sm=\"4\" cols=\"4\">\n                    <!-- \tPayable Position  -->\n                    <v-card outlined dense class=\"no_border pa-4\" color=\"grayBg\">\n                      <h3 class=\"mb-1\">{{ $t(\"payable_position\") }}</h3>\n                      <label>{{ $t(\"current_balance\") }}</label>\n                      <v-text-field\n                        outlined\n                        :disabled=\"true\"\n                        v-model=\"balance\"\n                        class=\"mt-1\"\n                      />\n                      <label>{{ $t(\"remaining_balance\") }}</label>\n                      <v-text-field\n                        outlined\n                        :disabled=\"true\"\n                        v-model=\"vendorRemainingBalance\"\n                        class=\"mt-1\"\n                      />\n                    </v-card>\n                  </v-col>\n                </v-row>\n              </v-card>\n              <v-divider class=\"mt-4\" />\n              <v-card outlined dense class=\"no_border function_footer\">\n                <!--                                <v-menu>-->\n                <!--                                    <template v-slot:activator=\"{ on }\">-->\n                <!--                                        <v-btn-->\n                <!--                                            color=\"black\"-->\n                <!--                                            outlined-->\n                <!--                                            class=\"mr-2 text-capitalize  black&#45;&#45;text float-left\"-->\n                <!--                                            v-on=\"on\"-->\n                <!--                                        >-->\n                <!--                                            {{ $t(\"select_template\") }}-->\n                <!--                                            <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>-->\n                <!--                                        </v-btn>-->\n                <!--                                    </template>-->\n                <!--                                    <v-list>-->\n                <!--                                        <v-list-item-->\n                <!--                                            v-for=\"(item, index) in templates\"-->\n                <!--                                            :key=\"index\"-->\n                <!--                                        >-->\n                <!--                                            <v-list-item-title>{{ item.title }}</v-list-item-title>-->\n                <!--                                        </v-list-item>-->\n                <!--                                    </v-list>-->\n                <!--                                </v-menu>-->\n                <v-btn\n                  color=\"black\"\n                  class=\"text-capitalize  white--text float-left\"\n                  @click=\"cancel()\"\n                  >{{ $t(\"cancel\") }}\n                </v-btn>\n                <!--                                <v-btn-->\n                <!--                                    color=\"third\"-->\n                <!--                                    class=\"ml-3 float-right text-capitalize  white&#45;&#45;text\">-->\n                <!--                                    {{ $t(\"save_new\") }}-->\n                <!--                                </v-btn>-->\n                <v-btn\n                  @click=\"onSaveClose\"\n                  color=\"primary\"\n                  class=\" float-right text-capitalize  white--text\"\n                >\n                  {{ $t(\"save_close\") }}\n                </v-btn>\n              </v-card>\n            </v-form>\n          </v-card>\n        </v-col>\n      </v-row>\n    </v-container>\n  </v-app>\n</template>\n\n<script>\nimport { i18n } from \"@/i18n\";\nimport DatePickerComponent from \"@/components/custom_templates/DatePickerComponent\";\nimport supplierHandler from \"@/scripts/supplierHandler\";\nimport journalHandler from \"@/scripts/journalHandler\";\nimport RequestPaymentModel from \"@/scripts/request-payment/model/RequestPayment\";\nimport ItemLineModel from \"@/scripts/request-payment/model/ItemLine\";\nimport kendo from \"@progress/kendo-ui\";\nimport billingHandler from \"@/scripts/invoice/handler/billingHandler\";\nimport prefixHandler from \"@/scripts/prefixHandler\";\nimport purchaseFormContentHandler from \"@/scripts/purchaseFormContentHandler\";\nimport settingHandler from \"@/scripts/settingsHandler\";\nimport { CurrencyModel, PaymentTermModel } from \"@/scripts/model/AppModels\";\nimport PaymentOptionModel from \"@/scripts/model/PaymentOption\";\nimport AccountMappingModel from \"@/scripts/account-map/Account\";\nimport SupplierModel from \"@/scripts/model/Supplier\";\nimport Helper from \"@/helper\";\n\nconst cookieJS = require(\"@/cookie.js\");\nconst cookie = cookieJS.getCookie();\nconst requestPaymentModel = new RequestPaymentModel({});\nconst itemLineModel = new ItemLineModel({});\n\nconst OPTION_TYPE = \"Supplier\";\nconst TRANSACTION_TYPE = \"Request Payment\";\nconst TXN_TYPE = \"request payment\";\n\nexport default {\n  name: \"RequestPayment\",\n  components: {\n    LoadingMe: () => import(`@/components/Loading`),\n    \"app-datepicker\": DatePickerComponent,\n    \"vendor-dropdownlist\": () =>\n      import(\"@/components/dropdownlist/VendorDropdown\"),\n    \"paymentoption-dropdownlist\": () =>\n      import(\"@/components/dropdownlist/PaymentOptionDropDownList\"),\n  },\n  data: () => ({\n    showLoading: false,\n    customerList: [],\n    group: [],\n    suppliers: [],\n    customer: {},\n    overDueAmount: 0,\n    receivableBalance: 0,\n    tobeCollected: 0,\n    valid: true,\n    template: [],\n    templates: [],\n    itemLines: [],\n    transactionTypes: [],\n    receivableList: [],\n    requestPayment: requestPaymentModel,\n    itemLine: itemLineModel,\n    supBaseUrl: supplierHandler.search(),\n    selectedExpenseIds: [],\n    purchaseFormContent: {},\n    balance: 0,\n    jRaw: [],\n    txnList: [],\n    gainLossAcc: {},\n    otherRevenueAcc: {},\n    gainOrLossDescription: \"gain/loss on exchange rate\",\n    penaltyDescription: \"penalty\",\n    baseCurrencyCode: \"\",\n    loggedUser: {\n      id: cookie.creator,\n      name: cookie.email,\n    },\n    cr: 0,\n    dr: 0,\n    fundBalance: 0,\n    vendorRemainingBalance: 0,\n    fundRemainBalance: 0,\n    schemaDefinition: {\n      model: { id: \"lineId\" },\n    },\n    isCheckChanged: false,\n  }),\n  methods: {\n    onVendorChanged(value) {\n      this.requestPayment.supplier = value;\n      const supplier = this.requestPayment.supplier || {};\n      const supplierId = supplier.id || \"\";\n      if (supplierId) {\n        this.loadVendorBalance(supplierId);\n      }\n    },\n    cancel() {\n      this.$swal({\n        title: i18n.t(\"msg_title_warning\"),\n        text: i18n.t(\"msg_discard\"),\n        icon: \"warning\",\n        showCancelButton: true,\n        cancelButtonText: i18n.t(\"cancel\"),\n        confirmButtonColor: \"#4d4848\",\n        cancelButtonColor: \"#ED1A3A\",\n        confirmButtonText: i18n.t(\"discard\"),\n      }).then((result) => {\n        if (result.value) {\n          this.$router.go(-1);\n        }\n      });\n    },\n    currency(dataItem) {\n      if (dataItem) {\n        if (dataItem.hasOwnProperty(\"currencyCode\")) {\n          return dataItem.currencyCode;\n        }\n      }\n      return \"\";\n    },\n    referenceNoTmp(dataItem) {\n      if (dataItem) {\n        if (dataItem.hasOwnProperty(\"referenceNo\")) {\n          return dataItem.referenceNo;\n        }\n      }\n      return \"\";\n    },\n    billNumberTmp(dataItem) {\n      if (dataItem) {\n        if (dataItem.hasOwnProperty(\"billNumber\")) {\n          return dataItem.billNumber;\n        }\n      }\n      return \"\";\n    },\n    paidAmountTmp(dataItem) {\n      if (dataItem) {\n        if (dataItem.hasOwnProperty(\"paidAmount\")) {\n          return kendo.toString(dataItem.paidAmount, dataItem.decimalFormat);\n        }\n      }\n      return \"\";\n    },\n    amountTobePaid(dataItem) {\n      if (dataItem) {\n        if (dataItem.hasOwnProperty(\"amountTobePaid\")) {\n          return kendo.toString(\n            dataItem.amountTobePaid,\n            dataItem.decimalFormat\n          );\n        }\n      }\n      return \"\";\n    },\n    discount(dataItem) {\n      if (dataItem) {\n        if (dataItem.hasOwnProperty(\"discount\")) {\n          const discount = dataItem.discount || 0;\n          return kendo.toString(discount, dataItem.decimalFormat);\n        }\n      }\n      return 0;\n    },\n    amount(dataItem) {\n      if (dataItem) {\n        if (dataItem.hasOwnProperty(\"amount\")) {\n          const amount = dataItem.amount || 0;\n          return kendo.toString(amount, dataItem.decimalFormat);\n        }\n      }\n      return 0;\n    },\n    bankReferenceNo(dataItem) {\n      if (dataItem) {\n        if (dataItem.hasOwnProperty(\"overDue\")) {\n          return dataItem.bankReferenceNo;\n        }\n      }\n      return \"\";\n    },\n    overDue(dataItem) {\n      if (dataItem) {\n        if (dataItem.hasOwnProperty(\"overDue\")) {\n          return dataItem.overDue;\n        }\n      }\n      return 0;\n    },\n    paidAmountEditor(container, options) {\n      kendo\n        .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n        .appendTo(container)\n        .kendoNumericTextBox({\n          decimals: 5,\n          format: `n${this.purchaseFormContent.decimal}`,\n          min: 0,\n        });\n    },\n    discountEditor(container, options) {\n      kendo\n        .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n        .appendTo(container)\n        .kendoNumericTextBox({\n          decimals: 30,\n          format: `n${this.purchaseFormContent.decimal}`,\n          min: 0,\n        });\n    },\n    onTransactionDateChanged() {\n      if (this.requestPayment.supplier) {\n        const supplier = this.requestPayment.supplier || {};\n        const supId = supplier.id || \"\";\n        if (supId) {\n          this.generateNumber();\n          this.searchPurchaseOrderExpense();\n        }\n      }\n    },\n    generateNumber() {\n      if (this.$route.params.id) {\n        const tranDate = new Date(this.requestPayment.transactionDate);\n        const tranDateReceipt = new Date(this.requestPayment.transactionDate);\n        const tranDateM = tranDate.getFullYear() + tranDate.getMonth();\n        const tranDateReceiptM =\n          tranDateReceipt.getFullYear() + tranDateReceipt.getMonth();\n        if (tranDateM === tranDateReceiptM) {\n          this.requestPayment.referenceNo = this.referenceNo;\n          return;\n        }\n      }\n      // window.console.log(\"abbr\", this.requestPayment.transactionType);\n      if (this.requestPayment.transactionDate !== \"\") {\n        let data = {\n          abbr: this.requestPayment.transactionType.abbr,\n          structure: this.requestPayment.transactionType.structure,\n          transactionDate: new Date(this.requestPayment.transactionDate)\n            .toISOString()\n            .substr(0, 10),\n          sequcencing: this.requestPayment.transactionType.sequcencing,\n          type: TRANSACTION_TYPE,\n          entity: 1,\n        };\n        billingHandler\n          .lastNumber(data)\n          .then((response) => {\n            if (response.data.statusCode === 200) {\n              const res = response.data.data;\n              const lastNumber = this.zeroPad(\n                parseInt(res.lastNumber),\n                this.requestPayment.transactionType.format\n              );\n              const number =\n                res.suffix +\n                this.requestPayment.transactionType.numberSeparator +\n                lastNumber;\n              this.requestPayment.number = number;\n              if (\n                this.requestPayment.transactionType.hasOwnProperty(\n                  \"prefixSeparator\"\n                )\n              ) {\n                const prefixSep = this.requestPayment.transactionType\n                  .prefixSeparator;\n                this.requestPayment.referenceNo =\n                  this.requestPayment.transactionType.abbr + prefixSep + number;\n              }\n            }\n          })\n          .catch((e) => {\n            this.errors.push(e);\n          });\n      }\n    },\n    zeroPad(num, places) {\n      return String(num).padStart(places, \"0\");\n    },\n    removeDuplicate(array) {\n      const result = [];\n      const map = new Map();\n      for (const item of array) {\n        if (!map.has(item.id)) {\n          map.set(item.id, true); // set any value to Map\n          result.push(item);\n        }\n      }\n      return result;\n    },\n    formatDate(dataItem) {\n      if (dataItem.hasOwnProperty(\"dueDate\")) {\n        return kendo.toString(new Date(dataItem.dueDate), dataItem.dateFormat);\n      }\n      return \"\";\n    },\n    settlementDiscount(dataItem) {\n      if (dataItem.hasOwnProperty(\"paymentTerm\")) {\n        return dataItem.paymentTerm.name || \"\";\n      }\n      return \"\";\n    },\n    status(dataItem) {\n      if (dataItem) {\n        if (dataItem.hasOwnProperty(\"status\")) {\n          const status = dataItem.status;\n          let statusText = \"\";\n          switch (status) {\n            case 1:\n              statusText = \"OPEN\";\n              break;\n            case 2:\n              statusText = \"Partially Paid\";\n              break;\n            case 4:\n              statusText = \"VOID\";\n              break;\n            case 3:\n              statusText = \"PAID\";\n              break;\n          }\n          return statusText;\n        }\n      }\n      return \"\";\n    },\n    onPaymentOptionChanged(value) {\n      this.requestPayment.paymentOption = value;\n      const account = value.account || {};\n      const accountId = account.uuid || \"\";\n      if (accountId) {\n        let currentFiscalDate = Helper.getFiscalDateByDate(new Date());\n        let startDate = currentFiscalDate.start_date;\n        const strParam = {\n          params: {\n            start_date:\n              kendo.toString(new Date(startDate), \"yyyy-MM-dd\") +\n              \"T00:00:00.000Z\",\n            end_date:\n              kendo.toString(\n                new Date(this.requestPayment.transactionDate),\n                \"yyyy-MM-dd\"\n              ) + \"T23:59:59.999Z\",\n          },\n        };\n        this.loadEntryDetailByAccount(accountId, strParam);\n      }\n      // window.console.log(value, \"paymentOption\");\n    },\n    async loadPrefix() {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          prefixHandler.get(TXN_TYPE).then((res) => {\n            if (res.data.statusCode === 200) {\n              const response = res.data.data;\n              this.transactionTypes = response;\n              if (response.length > 0) {\n                this.requestPayment.transactionType = response[0];\n                if (!this.$route.params.id) {\n                  this.generateNumber();\n                }\n              }\n            }\n          });\n        }, 10);\n      });\n    },\n    async searchPurchaseOrderExpense() {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          let data = {};\n          this.showLoading = true;\n          const supplier = this.requestPayment.supplier || {};\n          data = {\n            search: supplier.id || \"\",\n            type: \"Vendor\",\n            transactionDate: new Date(this.requestPayment.transactionDate)\n              .toISOString()\n              .substr(0, 10),\n          };\n          this.itemLines = [];\n          if (data.search) {\n            if (data.search.length > 4) {\n              this.showLoading = true;\n              try {\n                billingHandler.searchCashPayment(data).then((res) => {\n                  this.showLoading = false;\n                  if (res.data.statusCode === 200) {\n                    const response = res.data.data;\n                    const result = res.data.result;\n                    this.showLoading = false;\n                    if (response.length > 0) {\n                      this.itemLines = response;\n                      const obj = response[0];\n                      if (obj.hasOwnProperty(\"supplier\")) {\n                        this.requestPayment.supplier = obj.supplier;\n                        if (obj.supplier.hasOwnProperty(\"name\")) {\n                          this.name = obj.supplier.name;\n                        }\n                      }\n                    }\n                    const baseCurrency = result;\n                    this.baseCurrency = baseCurrency;\n                    this.requestPayment.currency = new CurrencyModel(\n                      baseCurrency\n                    );\n                    if (baseCurrency) {\n                      if (baseCurrency.hasOwnProperty(\"code\")) {\n                        this.baseCurrencyCode = baseCurrency.code;\n                        // if (code) {\n                        //     this.loadTransactionRate(baseCurrency.code)\n                        // }\n                      }\n                    }\n                  }\n                });\n              } catch (e) {\n                this.showLoading = false;\n              }\n            } else {\n              this.showLoading = false;\n            }\n          } else {\n            this.showLoading = false;\n          }\n        }, 10);\n      });\n    },\n    onGridRequestChange() {\n      const grid = this.$refs.gridRequestPayment.kendoWidget();\n      this.selectedExpenseIds = grid.selectedKeyNames();\n      // let ds = this.$refs.itemLineDS.kendoWidget()\n      // this.isCheckChanged = true\n      // const rows = ds.data();\n      // rows.forEach((value) => {\n      //     if (~this.selectedExpenseIds.indexOf(value.lineId)) {\n      //         // window.console.log(value, 'value')\n      //         if (value.paidAmount === 0) {\n      //             const tobePaid = value.amountTobePaid || 0\n      //             value.set('paidAmount', tobePaid)\n      //         }\n      //     }\n      // })\n      // this.$refs.gridRequestPayment.kendoWidget().read()\n      // this.isCheckChanged = false\n      this.autoCalculate();\n    },\n    onDataSourceChange(e) {\n      let amtTobePaid = 0,\n        amount = 0,\n        discount = 0,\n        paidAmount = 0;\n      let dataRow = e.items[0] || {};\n      if (Object.keys(dataRow).length > 0) {\n        dataRow.set(\"optionType\", OPTION_TYPE);\n      }\n      if (e.field) {\n        let dataRow = e.items[0];\n        switch (e.field) {\n          case \"discount\":\n            amount = dataRow.amount || 0;\n            discount = dataRow.discount || 0;\n            if (discount > amount) {\n              dataRow.set(\"discount\", amount);\n            }\n            dataRow.set(\n              \"amountTobePaid\",\n              parseFloat(dataRow.amount) - parseFloat(dataRow.discount || 0)\n            );\n            dataRow.set(\n              \"exchangeDiscount\",\n              parseFloat(dataRow.discount) * parseFloat(dataRow.rateTobase || 1)\n            );\n            dataRow.set(\n              \"exchangeDiscountTxn\",\n              parseFloat(dataRow.discount) * parseFloat(dataRow.txnRate || 1)\n            );\n            amtTobePaid = parseFloat(dataRow.amountTobePaid || 0);\n            paidAmount = parseFloat(dataRow.paidAmount || 0);\n            if (paidAmount > amtTobePaid) {\n              paidAmount = amtTobePaid;\n              dataRow.set(\"paidAmount\", parseFloat(paidAmount));\n              dataRow.set(\n                \"paidAmountTobase\",\n                parseFloat(paidAmount) * parseFloat(dataRow.rateTobase || 1)\n              );\n              dataRow.set(\n                \"paidAmountTxn\",\n                paidAmount * parseFloat(dataRow.txnRate || 1)\n              );\n            }\n            break;\n          case \"paidAmount\":\n            // if (this.isCheckChanged === false) {\n            amtTobePaid = parseFloat(dataRow.amountTobePaid || 0);\n            paidAmount = parseFloat(dataRow.paidAmount || 0);\n            if (paidAmount > amtTobePaid) {\n              paidAmount = amtTobePaid;\n            }\n            dataRow.set(\"paidAmount\", parseFloat(paidAmount));\n            dataRow.set(\n              \"paidAmountTobase\",\n              parseFloat(paidAmount) * parseFloat(dataRow.rateTobase || 1)\n            );\n            dataRow.set(\n              \"paidAmountTxn\",\n              paidAmount * parseFloat(dataRow.txnRate || 1)\n            );\n            // }\n            break;\n          default:\n            break;\n        }\n\n        this.purchaseTxn();\n        this.autoCalculate();\n      }\n    },\n    async loadSaleFormContent() {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          purchaseFormContentHandler.list().then((res) => {\n            if (res.data.statusCode === 200) {\n              const data = res.data.data;\n              if (data.length > 0) {\n                this.purchaseFormContent = data[0];\n              }\n            }\n          });\n        }, 10);\n      });\n    },\n    async loadVendorBalance(id) {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          const strFilter = id + \"?type=bal\";\n          this.requestPayment.vendorBalance = 0;\n          billingHandler.balance(strFilter).then((res) => {\n            if (res.data.statusCode === 200) {\n              const data = res.data.data;\n              if (data.length > 0) {\n                this.requestPayment.vendorBalance = data[0].balance;\n                this.balance = this.numberFormat(data[0].balance);\n              }\n            }\n          });\n        }, 10);\n      });\n    },\n    numberFormat(value) {\n      return kendo.toString(value, `n${this.purchaseFormContent.decimal}`);\n    },\n    autoCalculate() {\n      let ds = this.$refs.itemLineDS.kendoWidget(),\n        receiptAmount = 0,\n        discount = 0,\n        convertedAmount = 0,\n        exchangeDiscount = 0,\n        exchangeDiscountTxn = 0,\n        paidAmountTxn = 0;\n      this.jRaw = [];\n      const rows = ds.data().filter((n) => n.paidAmount > 0 || n.discount > 0);\n      rows.forEach((value) => {\n        if (~this.selectedExpenseIds.indexOf(value.lineId)) {\n          let nature = \"\",\n            purchaseRate = 0,\n            paymentRate = 0,\n            rawPaidAmount = 0,\n            rawDiscountAmount = 0,\n            currencyCode = \"\";\n          let discountAmount = 0,\n            apAmount = 0,\n            refNo = \"\",\n            payOption = {},\n            currency = {},\n            gainLoss = 0,\n            lastXRate = {},\n            location = {},\n            segment = {},\n            project = {},\n            locationId = \"\",\n            segmentId = \"\",\n            projectId = \"\",\n            txnId = \"\",\n            invRate = 1;\n          if (value.referenceNo) {\n            refNo = value.referenceNo;\n          }\n          if (value.id) {\n            txnId = value.id || \"\";\n          }\n          if (value.txnRate) {\n            purchaseRate = parseFloat(value.txnRate);\n          }\n          if (value.currencyCode) {\n            currencyCode = value.currencyCode || \"\";\n          }\n          if (value.currency) {\n            currency = value.currency || {};\n          }\n          if (value.location) {\n            location = value.location || {};\n            if (location.hasOwnProperty(\"id\")) {\n              locationId = location.id;\n            }\n          }\n          if (value.segment) {\n            segment = value.segment || {};\n            if (segment.hasOwnProperty(\"id\")) {\n              segmentId = segment.id;\n            }\n          }\n          if (value.project) {\n            project = value.project || {};\n            if (project.hasOwnProperty(\"id\")) {\n              projectId = project.id;\n            }\n          }\n          if (value.exchangeRate) {\n            lastXRate = value.exchangeRate || {};\n          }\n          if (value.txnRate) {\n            invRate = parseFloat(value.txnRate);\n          }\n          if (value.rateTobase) {\n            paymentRate = parseFloat(value.rateTobase);\n          }\n          if (value.paidAmount) {\n            receiptAmount += kendo.parseFloat(value.paidAmount);\n            convertedAmount +=\n              kendo.parseFloat(value.paidAmount) * value.rateTobase;\n            paidAmountTxn += kendo.parseFloat(value.paidAmount) * invRate;\n            // paidAmt = kendo.parseFloat(value.paidAmount) * purchaseRate\n            rawPaidAmount = kendo.parseFloat(value.paidAmount);\n          }\n          if (value.discount) {\n            // discount += kendo.parseFloat(value.discount)\n            discount += kendo.parseFloat(value.discount) * value.rateTobase;\n            exchangeDiscount +=\n              kendo.parseFloat(value.exchangeDiscount) * value.rateTobase;\n            exchangeDiscountTxn += kendo.parseFloat(value.discount) * invRate;\n            discountAmount = kendo.parseFloat(value.discount) * paymentRate;\n            rawDiscountAmount = kendo.parseFloat(value.discount);\n          }\n          // todo: gain or loss exchange rate\n          gainLoss =\n            parseFloat(\n              (purchaseRate - paymentRate) * (rawPaidAmount + rawDiscountAmount)\n            ) * -1;\n          if (gainLoss !== 0) {\n            if (gainLoss > 0) {\n              nature = \"dr\";\n            } else {\n              nature = \"cr\";\n            }\n            window.console.log(\"gainLoss\", gainLoss);\n            if (gainLoss) {\n              if (this.gainLossAcc.hasOwnProperty(\"id\")) {\n                this.jRaw.push({\n                  id:\n                    this.gainLossAcc.id +\n                    \"-\" +\n                    nature +\n                    \"-\" +\n                    currencyCode +\n                    \"-\" +\n                    purchaseRate +\n                    \"-\" +\n                    locationId +\n                    \"-\" +\n                    projectId +\n                    \"-\" +\n                    segmentId +\n                    \"-\" +\n                    txnId,\n                  txnId: txnId,\n                  project: project,\n                  location: location,\n                  segment: segment,\n                  projectId: projectId,\n                  locationId: locationId,\n                  segmentId: segmentId,\n                  currencyCode: currencyCode,\n                  currency: currency,\n                  lastXRate: lastXRate,\n                  line: new ItemLineModel(value),\n                  receiptRate: gainLoss > 0 ? paymentRate : purchaseRate,\n                  description: this.gainOrLossDescription,\n                  account: this.gainLossAcc,\n                  accountId: this.gainLossAcc.id,\n                  amount: 0,\n                  exchangeAmount: gainLoss,\n                  type: nature,\n                  typeAs: \"GainOrLoss\",\n                });\n              }\n            }\n          }\n          //Todo: AP  Dr\n          apAmount = rawPaidAmount + rawDiscountAmount;\n          if (apAmount > 0) {\n            nature = \"dr\";\n          } else {\n            nature = \"cr\";\n          }\n          if (value.hasOwnProperty(\"apAcc\")) {\n            const apAcc = value.apAcc;\n            if (apAcc) {\n              if (apAcc.hasOwnProperty(\"id\")) {\n                this.jRaw.push({\n                  id:\n                    apAcc.id +\n                    \"-\" +\n                    nature +\n                    \"-\" +\n                    currencyCode +\n                    \"-\" +\n                    purchaseRate +\n                    \"-\" +\n                    locationId +\n                    \"-\" +\n                    projectId +\n                    \"-\" +\n                    segmentId +\n                    \"-\" +\n                    txnId,\n                  txnId: txnId,\n                  project: project,\n                  location: location,\n                  segment: segment,\n                  projectId: projectId,\n                  locationId: locationId,\n                  segmentId: segmentId,\n                  currencyCode: currencyCode,\n                  currency: currency,\n                  lastXRate: lastXRate,\n                  line: new ItemLineModel(value),\n                  receiptRate: purchaseRate,\n                  description: refNo,\n                  account: apAcc,\n                  accountId: apAcc.id,\n                  amount: apAmount,\n                  exchangeAmount: apAmount * purchaseRate,\n                  type: nature,\n                  typeAs: \"AP\",\n                });\n              }\n            }\n          }\n          //Todo: Cash Account  CR\n          if (this.requestPayment.paymentOption) {\n            payOption = this.requestPayment.paymentOption;\n            const cashAmount = rawPaidAmount * -1; //+ ((purchaseRate - paymentRate) * (rawPaidAmount + rawDiscountAmount))\n            // const cashAmount = rawPaidAmount + (gainLoss ) + rawPaidAmount\n            if (cashAmount > 0) {\n              nature = \"dr\";\n            } else {\n              nature = \"cr\";\n            }\n            if (payOption.hasOwnProperty(\"account\")) {\n              const payOptionAcc = payOption.account;\n              if (payOptionAcc.hasOwnProperty(\"id\")) {\n                this.jRaw.push({\n                  id:\n                    payOptionAcc.id +\n                    \"-\" +\n                    nature +\n                    \"-\" +\n                    currencyCode +\n                    \"-\" +\n                    purchaseRate +\n                    \"-\" +\n                    locationId +\n                    \"-\" +\n                    projectId +\n                    \"-\" +\n                    segmentId +\n                    \"-\" +\n                    txnId,\n                  txnId: txnId,\n                  project: project,\n                  location: location,\n                  segment: segment,\n                  projectId: projectId,\n                  locationId: locationId,\n                  segmentId: segmentId,\n                  currencyCode: currencyCode,\n                  currency: currency,\n                  lastXRate: lastXRate,\n                  line: new ItemLineModel(value),\n                  receiptRate: purchaseRate,\n                  description: refNo,\n                  account: payOptionAcc,\n                  accountId: payOptionAcc.id,\n                  amount: cashAmount,\n                  exchangeAmount: cashAmount * paymentRate,\n                  type: nature,\n                  typeAs: \"CashAccount\",\n                });\n              }\n            }\n          }\n          //Todo: Settlement Discount  Cr\n          if (value.paymentTerm) {\n            const settlementDisc = value.paymentTerm;\n            if (discountAmount > 0) {\n              if (discountAmount * -1 > 0) {\n                nature = \"dr\";\n              } else {\n                nature = \"cr\";\n              }\n              // window.console.log(settlementDisc, \"settlementDisc\");\n              if (settlementDisc.hasOwnProperty(\"account\")) {\n                const settlementDiscAcc = settlementDisc.account;\n                if (settlementDiscAcc.hasOwnProperty(\"id\")) {\n                  this.jRaw.push({\n                    id:\n                      settlementDiscAcc.id +\n                      \"-\" +\n                      nature +\n                      \"-\" +\n                      currencyCode +\n                      \"-\" +\n                      purchaseRate +\n                      \"-\" +\n                      locationId +\n                      \"-\" +\n                      projectId +\n                      \"-\" +\n                      segmentId +\n                      \"-\" +\n                      txnId,\n                    txnId: txnId,\n                    project: project,\n                    location: location,\n                    segment: segment,\n                    projectId: projectId,\n                    locationId: locationId,\n                    segmentId: segmentId,\n                    currencyCode: currencyCode,\n                    currency: currency,\n                    lastXRate: lastXRate,\n                    line: new ItemLineModel(value),\n                    receiptRate: paymentRate,\n                    description: \"Purchase Payment Discount\",\n                    account: settlementDiscAcc,\n                    accountId: settlementDiscAcc.id,\n                    amount: rawDiscountAmount * -1,\n                    exchangeAmount: discountAmount * -1,\n                    type: nature,\n                    typeAs: \"Settlement Discount\",\n                  });\n                }\n              }\n            }\n          }\n        }\n      });\n      // this.invoiceTxn(txnIds)\n\n      this.requestPayment.total = receiptAmount;\n      this.requestPayment.exchangeAmount = convertedAmount;\n      this.requestPayment.discount = discount;\n      this.requestPayment.exchangeDiscount = exchangeDiscount;\n      this.requestPayment.paidAmountTxn = paidAmountTxn;\n      this.requestPayment.exchangeDiscountTxn = exchangeDiscountTxn;\n      this.requestPayment.fundRemainBalance =\n        parseFloat(this.requestPayment.fundBalance || 0) -\n        parseFloat(convertedAmount);\n      this.requestPayment.vendorRemainingBalance =\n        parseFloat(this.requestPayment.vendorBalance || 0) -\n        (parseFloat(convertedAmount) + discount);\n\n      this.vendorRemainingBalance = this.numberFormat(\n        parseFloat(this.requestPayment.vendorBalance || 0) -\n          (parseFloat(convertedAmount) + discount)\n      );\n      this.fundRemainBalance = this.numberFormat(\n        parseFloat(this.requestPayment.fundBalance || 0) -\n          parseFloat(convertedAmount)\n      );\n      this.shrinkData(this.jRaw);\n      window.console.log(\"aa\", rows);\n    },\n    shrinkData(obj) {\n      const uniques = this.removeDuplicate(obj);\n      uniques.forEach((n) => {\n        const found = obj.filter((m) => m.id === n.id);\n        let amount = 0,\n          exchangeAmount = 0;\n        found.forEach((z) => {\n          amount += parseFloat(z.amount || 0);\n          exchangeAmount += parseFloat(z.exchangeAmount || 0);\n        });\n        n.exchangeAmount = parseFloat(exchangeAmount); //this.numberFormat(amount)\n        n.amount = parseFloat(amount); //parseFloat(parseFloat(amount / parseFloat(n.receiptRate))) //this.numberFormat(amount * parseFloat(this.invoice.txnRate)) //.toFixed(this.saleFormContent.decimal)\n      });\n      this.jRaw = uniques;\n      let dr = 0,\n        cr = 0;\n      this.jRaw.forEach((j) => {\n        switch (j.type) {\n          case \"cr\":\n            cr += parseFloat(j.exchangeAmount);\n            break;\n          case \"dr\":\n            dr += parseFloat(j.exchangeAmount);\n            break;\n          default:\n            break;\n        }\n      });\n      // window.console.log(JSON.stringify(this.jRaw), 'uniques')\n      const txnId = this.jRaw.map((o) => o.txnId);\n      const uSet = new Set(txnId);\n      const uniqueSet = [...uSet];\n      let jRaws = [];\n      // window.console.log(JSON.stringify(uniqueSet), 'uniques')\n      uniqueSet.forEach((n) => {\n        const found = this.jRaw.filter((m) => m.txnId === n);\n        const line = found[0].line;\n        const refNo = line.referenceNo;\n        jRaws.push({\n          id: n,\n          currencyCode: found[0].currencyCode,\n          projectId: found[0].projectId,\n          segmentId: found[0].segmentId,\n          locationId: found[0].locationId,\n          referenceNo: refNo || \"\",\n          entries: found,\n        });\n      });\n      this.jRaw = jRaws;\n      this.dr = dr;\n      this.cr = cr;\n      window.console.log(\"dr=\", dr, \"cr=\", cr, \"dr+cr = \", dr + cr);\n      window.console.log(jRaws, \"uniques\");\n    },\n    purchaseTxn() {\n      let txnIds = [],\n        ids = [];\n      this.itemLines.forEach((value) => {\n        if (value.id) {\n          txnIds.push({\n            id: value.id,\n            status: 1,\n          });\n        }\n      });\n      ids = Object.values(txnIds.reduce((r, o) => ((r[o.id] = o), r), {}));\n      ids.forEach((m) => {\n        const lines = this.itemLines.filter((n) => n.id === m.id);\n        let paidAmt = 0;\n        let amountTobePaid = 0;\n        lines.forEach((x) => {\n          if (x.paidAmount) {\n            paidAmt += x.paidAmount;\n          }\n          if (x.amountTobePaid) {\n            amountTobePaid += x.amountTobePaid;\n          }\n        });\n        const pAmt = this.numberFormat(paidAmt);\n        const amtTobePaid = this.numberFormat(amountTobePaid);\n        if (pAmt === amtTobePaid) {\n          m[\"status\"] = 3; //Paid\n        } else {\n          m[\"status\"] = 2; // Partially Paid\n        }\n      });\n      this.txnList = ids;\n    },\n    async loadOtherAccount() {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          settingHandler\n            .getOtherAccount()\n            .then((res) => {\n              if (res.data.statusCode === 200) {\n                this.showLoading = false;\n                const response = res.data.data;\n                const data = response.filter(\n                  (o) => o.banhjiAccCode === \"740010\"\n                );\n                if (data.length > 0) {\n                  this.gainLossAcc = data[0].account;\n                }\n                const data_ = response.filter(\n                  (o) => o.banhjiAccCode === \"740040\"\n                );\n                if (data_.length > 0) {\n                  this.otherRevenueAcc = data_[0].account;\n                }\n              }\n            })\n            .catch();\n          {\n            this.showLoading = false;\n          }\n        }, 10);\n      });\n    },\n    async onSaveClose() {\n      if (!this.$refs.form.validate()) {\n        this.$refs.form.validate();\n        return;\n      }\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          let itemLineDS = this.$refs.itemLineDS.kendoWidget();\n          let itemLines = [];\n          const supplier = this.requestPayment.supplier || {};\n          itemLineDS\n            .data()\n            .filter((n) => n.paidAmount > 0 || n.discount > 0)\n            .map((n) => {\n              if (~this.selectedExpenseIds.indexOf(n.lineId)) {\n                const currency = n.currency || {};\n                n[\"paymentOption\"] = new PaymentOptionModel(\n                  n.paymentOption || {}\n                );\n                n[\"paymentTerm\"] = new PaymentTermModel(n.paymentTerm || {});\n                n[\"currency\"] = new CurrencyModel(n.currency || {});\n                n[\"currencyCode\"] = currency.code || \"\";\n                n[\"apAcc\"] = new AccountMappingModel(n.apAcc || {});\n                n[\"supplier\"] = new SupplierModel(supplier);\n                n[\"id\"] = n[\"txnId\"];\n                itemLines.push(new ItemLineModel(n));\n              }\n            });\n          if (itemLines.length > 0) {\n            let isAutoGenerate = 1;\n            //todo: match Request Payment model\n            this.requestPayment[\"itemLines\"] = itemLines;\n            this.requestPayment[\"type\"] = TRANSACTION_TYPE;\n            this.requestPayment[\"isAutoGenerate\"] = isAutoGenerate;\n            this.requestPayment[\"actionType\"] = this.$route.params.id\n              ? this.$route.query.type\n              : \"new\";\n            this.requestPayment[\"loggedUser\"] = this.loggedUser;\n\n            this.showLoading = true;\n            // window.console.log('this.itemLines', itemLines)\n            // window.console.log('this.itemLines', JSON.stringify(itemLines))\n            billingHandler\n              .createRequestPayment(\n                new RequestPaymentModel(this.requestPayment)\n              )\n              .then((response) => {\n                if (response.data.statusCode === 201) {\n                  // this.close(response.data.data)\n                  this.showLoading = false;\n                  this.$snotify.success(\"Successfully\");\n                  this.clear();\n                  window.history.go(-1);\n                }\n              })\n              .catch((e) => {\n                this.showLoading = false;\n                this.$snotify.error(\"Something went wrong\");\n                this.errors.push(e);\n              });\n          }\n        }, 20);\n      });\n    },\n    clear() {\n      this.id = undefined;\n      this.requestPayment = new RequestPaymentModel({});\n      this.itemLines = [];\n      this.requestPayment.transactionType = this.transactionTypes[0];\n      this.generateNumber();\n    },\n    async loadEntryDetailByAccount(id, params) {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          this.showLoading = true;\n          journalHandler.getEntryDetailByAccount(id, params).then((res) => {\n            // if (res.data.statusCode === 200) {\n            this.showLoading = false;\n            this.requestPayment.fundBalance = res.ending_balance || 0;\n            this.fundBalance = this.numberFormat(res.ending_balance || 0);\n            this.fundRemainBalance = this.numberFormat(\n              parseFloat(res.ending_balance || 0) -\n                parseFloat(this.requestPayment.exchangeAmount)\n            );\n            this.requestPayment.fundRemainBalance =\n              parseFloat(res.ending_balance || 0) -\n              parseFloat(this.requestPayment.fundBalance);\n            // } else {\n            //     this.showLoading = true;\n            // }\n          });\n        }, 10);\n      });\n    },\n  },\n  mounted: async function() {\n    // this.loadSuppliers()\n    // this.loadVendors('', this.supBaseUrl)\n    await this.loadPrefix();\n    await this.loadSaleFormContent();\n    await this.loadOtherAccount();\n  },\n  computed: {},\n};\n</script>\n\n<style scoped>\n.theme--light.v-data-table\n  > .v-data-table__wrapper\n  > table\n  > tbody\n  > tr:not(:last-child)\n  > td:not(.v-data-table__mobile-row),\n.theme--light.v-data-table\n  > .v-data-table__wrapper\n  > table\n  > tbody\n  > tr:not(:last-child)\n  > th:not(.v-data-table__mobile-row) {\n  border-bottom: thin solid #dfdfdf;\n}\n\n.theme--light.v-data-table\n  > .v-data-table__wrapper\n  > table\n  > tbody\n  > tr:last-child\n  td {\n  border-bottom: thin solid #dfdfdf;\n}\n\n.theme--light.v-data-table\n  > .v-data-table__wrapper\n  > table\n  > tbody\n  > tr:first-child\n  td {\n  border-top: thin solid #dfdfdf;\n}\n\n.v-data-table > .v-data-table__wrapper > table > tbody > tr > td {\n  height: 32px !important;\n}\n\n@media (min-width: 1264px) {\n  .container {\n    max-width: 1280px !important;\n  }\n}\n</style>\n"]}]}