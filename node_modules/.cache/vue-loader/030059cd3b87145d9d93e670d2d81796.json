{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/suppliers/PurchaseOrder.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/suppliers/PurchaseOrder.vue","mtime":1638499443344},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7aTE4bn0gZnJvbSAiQC9pMThuIjsKaW1wb3J0IFRyYW5zYWN0aW9uTW9kZWwgZnJvbSAiQC9zY3JpcHRzL21vZGVsL1RyYW5zYWN0aW9uIjsKaW1wb3J0IHtEcm9wRG93bkxpc3R9IGZyb20gIkBwcm9ncmVzcy9rZW5kby12dWUtZHJvcGRvd25zIjsKaW1wb3J0IGtlbmRvIGZyb20gIkBwcm9ncmVzcy9rZW5kby11aSI7CmltcG9ydCB7dXVpZH0gZnJvbSAidnVlLXV1aWQiOwppbXBvcnQgUHVyY2hhc2VGb3JtQ29udGVudE1vZGVsIGZyb20gIkAvc2NyaXB0cy9tb2RlbC9QdXJjaGFzZUZvcm1Db250ZW50IjsKaW1wb3J0IHtkYXRhU3RvcmUsIFNob3dSZXNvdXJjZX0gZnJvbSAiQC9vYnNlcnZhYmxlL3N0b3JlIjsKCmltcG9ydCBJdGVtTGluZU1vZGVsIGZyb20gIkAvc2NyaXB0cy9pbnZvaWNlL21vZGVsL0l0ZW1MaW5lIjsKaW1wb3J0IGNyZWRpdExpbWl0SGFuZGxlciBmcm9tICJAL3NjcmlwdHMvY3JlZGl0TGltaXQvaGFuZGxlci9jcmVkaXRMaW1pdEhhbmRsZXIiOwppbXBvcnQgcGF5bWVudFRlcm1IYW5kbGVyXyBmcm9tICJAL3NjcmlwdHMvcGF5bWVudHRlcm0vaGFuZGxlci9wYXltZW50VGVybUhhbmRsZXIiOwoKY29uc3QgaXRlbUxpbmVNb2RlbCA9IG5ldyBJdGVtTGluZU1vZGVsKHt9KTsKCmNvbnN0IHRyYW5zYWN0aW9uSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy90cmFuc2FjdGlvbkhhbmRsZXIiKTsKY29uc3Qgc3VwcGxpZXJIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3N1cHBsaWVySGFuZGxlciIpOwpjb25zdCBjdXJyZW5jeUhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvY3VycmVuY3kvaGFuZGxlci9jdXJyZW5jeUhhbmRsZXIiKTsKY29uc3QgYmlsbGluZ0hhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvaW52b2ljZS9oYW5kbGVyL2JpbGxpbmdIYW5kbGVyIik7Ci8vIGNvbnN0IHBheW1lbnRUZXJtSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wYXltZW50VGVybUhhbmRsZXIiKTsKY29uc3QgcHVyY2hhc2VGb3JtQ29udGVudEhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvcHVyY2hhc2VGb3JtQ29udGVudEhhbmRsZXIiKTsKY29uc3Qgc2V0dGluZ0hhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvc2V0dGluZ0hhbmRsZXIiKTsKY29uc3QgbG9jYXRpb25IYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2xvY2F0aW9uSGFuZGxlciIpOwpjb25zdCBwcm9qZWN0SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wcm9qZWN0SGFuZGxlciIpOwpjb25zdCBkaXNjb3VudEl0ZW1IYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2Rpc2NvdW50SXRlbUhhbmRsZXIiKTsKY29uc3QgdW9tUHJpY2VIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3VvbVByaWNlSGFuZGxlciIpOwpjb25zdCBlbXBsb3llZUhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvZW1wbG95ZWVIYW5kbGVyIik7CmNvbnN0IHByaWNlTGV2ZWxIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3ByaWNlTGV2ZWxIYW5kbGVyIik7CmNvbnN0IHByb2R1Y3RWYXJpYW50SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wcm9kdWN0VmFyaWFudEhhbmRsZXIiKTsKY29uc3QgcHJlZml4SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wcmVmaXhIYW5kbGVyIik7CmNvbnN0IHNldHRpbmdzSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9zZXR0aW5nc0hhbmRsZXIiKTsKY29uc3Qgc2FsZVVuaXRJdGVtSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9zYWxlVW5pdEl0ZW1IYW5kbGVyIik7CmNvbnN0IGNhdGFsb2dIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2NhdGFsb2dIYW5kbGVyIik7CmNvbnN0IHByb2R1Y3RIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3Byb2R1Y3RIYW5kbGVyIik7Cgpjb25zdCAkID0ga2VuZG8ualF1ZXJ5CmNvbnN0IHRleHRGaWVsZCA9ICJudW1iZXJOYW1lIjsKY29uc3Qga2V5RmllbGQgPSAiaWQiOwpjb25zdCBkZWZhdWx0SXRlbSA9IHtbdGV4dEZpZWxkXTogIlNlbGVjdCBTdXBwbGllci4uLiIsIFtrZXlGaWVsZF06IG51bGx9Owpjb25zdCBlbXB0eUl0ZW0gPSB7W3RleHRGaWVsZF06ICJsb2FkaW5nIC4uLiJ9Owpjb25zdCB0cmFuc2FjdGlvblByZWZpeCA9ICJsaW4tIjsKY29uc3QgcHVyY2hhc2VGb3JtQ29udGVudE1vZGVsID0gbmV3IFB1cmNoYXNlRm9ybUNvbnRlbnRNb2RlbCh7fSk7CmNvbnN0IERJU0NPVU5UX1RZUEUgPSAiP3R5cGU9UHVyY2hhc2UiOwpjb25zdCBjb29raWVKUyA9IHJlcXVpcmUoIkAvY29va2llLmpzIik7CmNvbnN0IGNvb2tpZSA9IGNvb2tpZUpTLmdldENvb2tpZSgpOwoKY29uc3QgVFlQRSA9ICdwdXJjaGFzZScKZXhwb3J0IGRlZmF1bHQgewogICAgbmFtZTogIlB1cmNoYXNlT3JkZXIiLAogICAgcHJvcHM6IHsKICAgICAgICBpZDogewogICAgICAgICAgICB0eXBlOiBTdHJpbmcsCiAgICAgICAgfSwKICAgICAgICBpbml0UHVyY2hhc2VPcmRlcjogewogICAgICAgICAgICB0eXBlOiBUcmFuc2FjdGlvbk1vZGVsLAogICAgICAgIH0sCiAgICB9LAogICAgY29tcG9uZW50czogewogICAgICAgIExvYWRpbmdNZTogKCkgPT4gaW1wb3J0KGBAL2NvbXBvbmVudHMvTG9hZGluZ2ApLAogICAgICAgICJhcHAtZGF0ZXBpY2tlciI6ICgpID0+IGltcG9ydChgQC9jb21wb25lbnRzL2N1c3RvbV90ZW1wbGF0ZXMvRGF0ZVBpY2tlckNvbXBvbmVudGApLAogICAgICAgIGRyb3Bkb3dubGlzdDogRHJvcERvd25MaXN0LAogICAgICAgICJhcHAtbW9udGhvZi1waWNrZXIiOiAoKSA9PiBpbXBvcnQoIkAvY29tcG9uZW50cy9rZW5kb190ZW1wbGF0ZXMvTW9udGhPZlBpY2tlciIpLAogICAgfSwKICAgIGRhdGE6ICgpID0+ICh7CiAgICAgICAgc3VjY2VzczogZmFsc2UsCiAgICAgICAgaXNFZGl0OiBmYWxzZSwKICAgICAgICB0ZXh0RmllbGQ6ICJudW1iZXJOYW1lIiwKICAgICAgICBkYXRhSXRlbUtleTogImlkIiwKICAgICAgICBiYWxhbmNlOiAwLAogICAgICAgIC8vIExvYWRpbmdNZQogICAgICAgIHNob3dMb2FkaW5nOiBmYWxzZSwKICAgICAgICBhbGVydDogZmFsc2UsCiAgICAgICAgZmlsZXM6IFtdLAogICAgICAgIGRpYWxvZ0NhdGFsb2c6IGZhbHNlLAogICAgICAgIGdyaWRTY2hlbWE6IHsKICAgICAgICAgICAgbW9kZWw6IHsKICAgICAgICAgICAgICAgIGlkOiAiaWQiLAogICAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgLy8gRm9ybSB2YWxpZGF0aW9uCiAgICAgICAgdmFsaWQ6IHRydWUsCiAgICAgICAgdGVtcGxhdGVzOiBbCiAgICAgICAgICAgIHt0aXRsZTogIlB1cmNoYXNlIE9yZGVyIiwgdmFsdWU6ICJQdXJjaGFzZSBPcmRlciIsfSwKCiAgICAgICAgXSwKICAgICAgICBpc0hpZGVCYXI6IGZhbHNlLAogICAgICAgIHRyYW5zYWN0aW9uOiBuZXcgVHJhbnNhY3Rpb25Nb2RlbCh7fSksCiAgICAgICAgc3VwcGxpZXJMaXN0OiBbXSwKICAgICAgICBzdXBwbGllcjoge30sCiAgICAgICAgY2F0YWxvZ3M6IFtdLAogICAgICAgIGRpYWxvZ1RheDogZmFsc2UsCiAgICAgICAgYmFzZUN1cnJlbmN5Q29kZTogIiIsCiAgICAgICAgc3VwQmFzZVVybDogc3VwcGxpZXJIYW5kbGVyLnNlYXJjaCgpLAogICAgICAgIGV4Y2hhbmdlUmF0ZToge30sCiAgICAgICAgY3VycmVuY3lDb2RlOiAiIiwKICAgICAgICB0cmFuc2FjdGlvblJhdGU6IDEsCiAgICAgICAgcGF5bWVudFRlcm1zOiBbXSwKICAgICAgICBlbXBsb3llZXM6IFtdLAogICAgICAgIG1FbXBsb3llZToge30sCiAgICAgICAgcHVyY2hhc2VGb3JtQ29udGVudDogcHVyY2hhc2VGb3JtQ29udGVudE1vZGVsLAogICAgICAgIHNlZ21lbnRzOiBbXSwKICAgICAgICBsb2NhdGlvbnM6IFtdLAogICAgICAgIHRheExpc3RUb3RhbDoge30sCiAgICAgICAgaXRlbUxpbmVzOiBbXSwKICAgICAgICBpdGVtTGluZTogaXRlbUxpbmVNb2RlbCwKICAgICAgICBkYXRlRm9ybWF0OiBpdGVtTGluZU1vZGVsLmRhdGVGb3JtYXQsCiAgICAgICAgcHJvamVjdHM6IFtdLAogICAgICAgIGZpbHRlcjogIiIsCiAgICAgICAgcHVyY2hhc2VPcmRlclR5cGU6IDEsCiAgICAgICAgcHVyY2hhc2VPcmRlclR5cGVzOiBbCiAgICAgICAgICAgIHtuYW1lOiAiU3RhbmRhcmQgT3JkZXIiLCBpZDogMX0sCiAgICAgICAgICAgIHtuYW1lOiAiT3BlbiBPcmRlciIsIGlkOiAyfSwKICAgICAgICAgICAge25hbWU6ICJDb250cmFjdCIsIGlkOiAzfSwKICAgICAgICAgICAge25hbWU6ICJDb25zaWdubWVudCBPcmRlciIsIGlkOiA0fSwKICAgICAgICAgICAge25hbWU6ICJPcmRlciByZXF1aXJlZCBQdXJjaGFzZSIsIGlkOiA1fSwKICAgICAgICBdLAogICAgICAgIGRpc2NvdW50SXRlbTogW10sCiAgICAgICAgc2FsZVVuaXQ6IFtdLAogICAgICAgIGRlZmF1bHRJdGVtOiBkZWZhdWx0SXRlbSwKICAgICAgICB0eG5MaXN0czogW10sCiAgICAgICAgc2F2ZU9wdGlvbjogIiIsCiAgICAgICAgbG9nZ2VkVXNlcjogewogICAgICAgICAgICBpZDogY29va2llLmNyZWF0b3IsCiAgICAgICAgICAgIG5hbWU6IGNvb2tpZS5lbWFpbCwKICAgICAgICB9LAogICAgICAgIHNhbGVVbml0SXRlbUxpc3Q6IFtdLAogICAgICAgIHRheDogW10sCiAgICAgICAgb3RoZXJUYXg6IFtdLAogICAgICAgIHZhdFRheDogW10sCiAgICAgICAgdHhuVG9iZUFkZDogW10sCiAgICAgICAgLy8gd2l0aGhvbGRpbmdUYXg6IFtdLAogICAgICAgIHByaWNlTGV2ZWxzOiBbXSwKICAgICAgICBlcnJvcnM6IFtdLAogICAgICAgIGlzU2F2ZU5ldzogZmFsc2UsCiAgICAgICAgaXNTYXZlQ2xvc2U6IGZhbHNlLAogICAgICAgIGlzU2F2ZVByaW50OiBmYWxzZSwKICAgICAgICBpc1NhdmVEcmFmdDogZmFsc2UsCiAgICAgICAgaXNQcmljZUxldmVsQ2hhbmdlZDogZmFsc2UsCiAgICAgICAgdGF4TGlzdERldGFpbDogW10KICAgIH0pLAogICAgbWV0aG9kczogewogICAgICAgIGF1dG9DYWxjdWxhdGVUYXhEZXRhaWwoKSB7CiAgICAgICAgICAgIGxldCBpZHMgPSBbXQogICAgICAgICAgICB0aGlzLnRheExpc3REZXRhaWwuZm9yRWFjaChuID0+IHsKICAgICAgICAgICAgICAgIGlkcy5wdXNoKG4uaWQgfHwgJycpCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIGNvbnN0IHVuaXF1ZSA9IFsuLi5uZXcgU2V0KGlkcyldCiAgICAgICAgICAgIGxldCByZXN1bHQgPSBbXQogICAgICAgICAgICB1bmlxdWUuZm9yRWFjaChtID0+IHsKICAgICAgICAgICAgICAgIGxldCBhbW91bnQgPSAwLCByb3cgPSB7fSwgZGlzY291bnQgPSAwLCB4RGlzY291bnQgPSAwLCB4QW1vdW50ID0gMCwgdGF4QW1vdW50ID0gMCwgeFRheEFtb3VudCA9IDAKICAgICAgICAgICAgICAgIGxldCB0YXhEZXRhaWwgPSBbXSwgaXNWYXQgPSAwCiAgICAgICAgICAgICAgICBjb25zdCBmb3VuZCA9IHRoaXMudGF4TGlzdERldGFpbC5maWx0ZXIobiA9PiBuLmlkID09PSBtKQogICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKCd0YXhMaXN0RGV0YWlsaWRzJywgZm91bmQpCiAgICAgICAgICAgICAgICBmb3VuZC5mb3JFYWNoKGsgPT4gewogICAgICAgICAgICAgICAgICAgIHJvdyA9IGsKICAgICAgICAgICAgICAgICAgICBpZiAoay5pc1ZhdCA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICBpc1ZhdCA9IDEKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGV0YWlsXyA9IGsuZGV0YWlsIHx8IHt9CiAgICAgICAgICAgICAgICAgICAgICAgIHRheERldGFpbC5wdXNoKGRldGFpbF8pCgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0YXhBbW91bnQgKz0gay50YXhBbW91bnRfIHx8IDAKICAgICAgICAgICAgICAgICAgICB4VGF4QW1vdW50ICs9IChrLnRheEFtb3VudF8gfHwgMCkgKiAoay50eG5SYXRlIHx8IDEpCiAgICAgICAgICAgICAgICAgICAgYW1vdW50ICs9IChrLmFtb3VudCB8fCAwKQogICAgICAgICAgICAgICAgICAgIHhBbW91bnQgKz0gKGsuYW1vdW50IHx8IDApICogKGsudHhuUmF0ZSB8fCAxKQogICAgICAgICAgICAgICAgICAgIGRpc2NvdW50ICs9IChrLmRpc2NvdW50IHx8IDApCiAgICAgICAgICAgICAgICAgICAgeERpc2NvdW50ICs9IChrLmRpc2NvdW50IHx8IDApICogKGsudHhuUmF0ZSB8fCAxKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIGxldCBzcFRheEFtdCA9IDAsIHNwWFRheEFtdCA9IDAsIHBsVGF4QW10ID0gMCwgcGxYVGF4QW10ID0gMCwgb3RUYXhBbXQgPSAwLCBvdFhUYXhBbXQgPSAwLAogICAgICAgICAgICAgICAgICAgIHNwVGF4TmFtZSA9ICcnLCBwbFRheE5hbWUgPSAnJywgb3RUYXhOYW1lID0gJycsCiAgICAgICAgICAgICAgICAgICAgc3BUYXhOYW1lTG9jYWxlID0gJycsIHBsVGF4TmFtZUxvY2FsZSA9ICcnLCBvdFRheE5hbWVMb2NhbGUgPSAnJywKICAgICAgICAgICAgICAgICAgICBzcEFjY0lkID0gJycsIHBsQWNjSWQgPSAnJywgb3RBY2NJZCA9ICcnLAogICAgICAgICAgICAgICAgICAgIHNwUmF0ZSA9ICcnLCBwbFJhdGUgPSAnJywgb3RSYXRlID0gJycKICAgICAgICAgICAgICAgIHRheERldGFpbC5mb3JFYWNoKG4gPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNwVGF4ID0gbi5zcGVjaWZpY1RheCB8fCB7fQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBsVGF4ID0gbi5wdWJsaWNMaWdodGluZ1RheCB8fCB7fQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG90aGVyVGF4ID0gbi5vdGhlclRheCB8fCB7fQogICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhzcFRheCkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBzcFRheEFtdCArPSAoc3BUYXgudGF4QW1vdW50XyB8fCAwKQogICAgICAgICAgICAgICAgICAgICAgICBzcFhUYXhBbXQgKz0gKChzcFRheC50YXhBbW91bnRfIHx8IDApICogKHNwVGF4LnRheFJhdGUgfHwgMSkpCiAgICAgICAgICAgICAgICAgICAgICAgIHNwVGF4TmFtZSA9IHNwVGF4LmRlZmF1bHRUYXggfHwgJycKICAgICAgICAgICAgICAgICAgICAgICAgc3BUYXhOYW1lTG9jYWxlID0gc3BUYXguZGVmYXVsdFRheExvY2FsZSB8fCAnJwogICAgICAgICAgICAgICAgICAgICAgICBzcEFjY0lkID0gc3BUYXguYWNjb3VudCA/IHNwVGF4LmFjY291bnQuaWQgOiAnJwogICAgICAgICAgICAgICAgICAgICAgICBzcFJhdGUgPSBzcFRheC5yYXRlIHx8IDEKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKHBsVGF4KS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBsVGF4QW10ICs9IChwbFRheC50YXhBbW91bnRfIHx8IDApCiAgICAgICAgICAgICAgICAgICAgICAgIHBsWFRheEFtdCArPSAoKHBsVGF4LnRheEFtb3VudF8gfHwgMCkgKiAocGxUYXgudGF4UmF0ZSB8fCAxKSkKICAgICAgICAgICAgICAgICAgICAgICAgcGxUYXhOYW1lID0gcGxUYXguZGVmYXVsdFRheCB8fCAnJwogICAgICAgICAgICAgICAgICAgICAgICBwbFRheE5hbWVMb2NhbGUgPSBwbFRheC5kZWZhdWx0VGF4TG9jYWxlIHx8ICcnCiAgICAgICAgICAgICAgICAgICAgICAgIHBsQWNjSWQgPSBwbFRheC5hY2NvdW50ID8gcGxUYXguYWNjb3VudC5pZCA6ICcnCiAgICAgICAgICAgICAgICAgICAgICAgIHBsUmF0ZSA9IHBsVGF4LnJhdGUgfHwgMQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMob3RoZXJUYXgpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3RUYXhBbXQgKz0gKG90aGVyVGF4LnRheEFtb3VudF8gfHwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgb3RYVGF4QW10ICs9ICgob3RoZXJUYXgudGF4QW1vdW50XyB8fCAwKSAqIChwbFRheC50YXhSYXRlIHx8IDEpKQogICAgICAgICAgICAgICAgICAgICAgICBvdFRheE5hbWUgPSBvdGhlclRheC5kZWZhdWx0VGF4IHx8ICcnCiAgICAgICAgICAgICAgICAgICAgICAgIG90VGF4TmFtZUxvY2FsZSA9IG90aGVyVGF4LmRlZmF1bHRUYXhMb2NhbGUgfHwgJycKICAgICAgICAgICAgICAgICAgICAgICAgb3RBY2NJZCA9IG90aGVyVGF4LmFjY291bnQgPyBvdGhlclRheC5hY2NvdW50LmlkIDogJycKICAgICAgICAgICAgICAgICAgICAgICAgb3RSYXRlID0gb3RoZXJUYXgucmF0ZSB8fCAxCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIGlmIChpc1ZhdCA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgIHJvdy5kZXRhaWwgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNwZWNpZmljVGF4OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBzcFRheE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lTG9jYWxlOiBzcFRheE5hbWVMb2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IHNwVGF4QW10LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQ6IHNwWFRheEFtdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRJZDogc3BBY2NJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhdGU6IHNwUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljTGlnaHRpbmdUYXg6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHBsVGF4TmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVMb2NhbGU6IHBsVGF4TmFtZUxvY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogcGxUYXhBbXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogcGxYVGF4QW10LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudElkOiBwbEFjY0lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmF0ZTogcGxSYXRlLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBvdGhlclRheDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogb3RUYXhOYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZUxvY2FsZTogb3RUYXhOYW1lTG9jYWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBvdFRheEFtdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OiBvdFhUYXhBbXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IG90QWNjSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYXRlOiBvdFJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJvdy5kZXRhaWwgPSB7fQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJvd1snYW1vdW50J10gPSBhbW91bnQKICAgICAgICAgICAgICAgIHJvd1snZXhjaGFuZ2VBbW91bnQnXSA9IHhBbW91bnQKICAgICAgICAgICAgICAgIHJvd1sndGF4QW1vdW50J10gPSB0YXhBbW91bnQKICAgICAgICAgICAgICAgIHJvd1snZXhjaGFuZ2VUYXhBbW91bnQnXSA9IHhUYXhBbW91bnQKICAgICAgICAgICAgICAgIHJvd1snZGlzY291bnQnXSA9IGRpc2NvdW50CiAgICAgICAgICAgICAgICByb3dbJ2V4Y2hhbmdlRGlzY291bnQnXSA9IHhEaXNjb3VudAogICAgICAgICAgICAgICAgcm93WydjdXJyZW5jeSddID0gdGhpcy50cmFuc2FjdGlvbi5leGNoYW5nZVJhdGUgfHwge30KICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHJvdykKICAgICAgICAgICAgICAgIHRheERldGFpbCA9IFtdCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24uc2FsZVRheERldGFpbCA9IHJlc3VsdAogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFBheW1lbnRUZXJtTGlzdCgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3VwcGxpZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyRmlsdGVyID0gJz9pZD0nICsgdGhpcy5zdXBwbGllci5pZCArICcmdHJhbnNhY3Rpb25EYXRlPScgKyB0aGlzLnRyYW5zYWN0aW9uLnRyYW5zYWN0aW9uRGF0ZSArICcmdHlwZT1WZW5kb3InCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24ucGF5bWVudFRlcm0gPSB7fQogICAgICAgICAgICAgICAgICAgICAgICBwYXltZW50VGVybUhhbmRsZXJfLmdldChzdHJGaWx0ZXIpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRlcm1zID0gcmVzLmRhdGEuZGF0YQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24ucGF5bWVudFRlcm0gPSB0ZXJtcy50ZXJtCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vblBheW1lbnRUZXJtQ2hhbmdlZCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkQ3JlZGl0TGltaXQoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN1cHBsaWVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0ckZpbHRlciA9ICc/aWQ9JyArIHRoaXMuc3VwcGxpZXIuaWQgKyAnJnRyYW5zYWN0aW9uRGF0ZT0nICsgdGhpcy50cmFuc2FjdGlvbi50cmFuc2FjdGlvbkRhdGUgKyAnJnR5cGU9VmVuZG9yJwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLmNyZWRpdExpbWl0ID0gMAogICAgICAgICAgICAgICAgICAgICAgICBjcmVkaXRMaW1pdEhhbmRsZXIuZ2V0KHN0ckZpbHRlcikudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3JlZGl0ID0gcmVzLmRhdGEuZGF0YQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24uY3JlZGl0TGltaXQgPSBrZW5kby5wYXJzZUZsb2F0KGNyZWRpdC5hbW91bnQgfHwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkQ3VzdG9tZXJCYWxhbmNlKGlkKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0ckZpbHRlciA9IGlkICsgIj90eXBlPWJhbCI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5jdXJyZW50QmFsYW5jZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgYmlsbGluZ0hhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgLmJhbGFuY2Uoc3RyRmlsdGVyKQogICAgICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLmN1cnJlbnRCYWxhbmNlID0gZGF0YVswXS5iYWxhbmNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKCk7CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIG9uUHJpY2VMZXZlbENoYW5nZSgpIHsKICAgICAgICAgICAgdGhpcy5pc1ByaWNlTGV2ZWxDaGFuZ2VkID0gdHJ1ZQogICAgICAgICAgICB0aGlzLmxvYWRUcmFuc2FjdGlvblJhdGUoKQogICAgICAgICAgICB0aGlzLmNsZWFyVU9NSXRlbSgpCiAgICAgICAgfSwKICAgICAgICBhc3luYyBjbGVhclVPTUl0ZW0oKSB7CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuaXRlbUxpbmVQT0RTLmtlbmRvV2lkZ2V0KCkKICAgICAgICAgICAgZHMuZGF0YSgpLm1hcChuID0+IHsKICAgICAgICAgICAgICAgIG4uc2V0KCd1b20nLCB7fSkKICAgICAgICAgICAgfSkKICAgICAgICAgICAgdGhpcy5pc1ByaWNlTGV2ZWxDaGFuZ2VkID0gZmFsc2UKICAgICAgICB9LAogICAgICAgIG51bWJlckVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBkYXRhLWJpbmQ9InZhbHVlOicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvTnVtZXJpY1RleHRCb3goewogICAgICAgICAgICAgICAgICAgIGRlY2ltYWxzOiAzMCwKICAgICAgICAgICAgICAgICAgICBtaW46IDAuMDAwMDEsCiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBgJHt0aGlzLnB1cmNoYXNlRm9ybUNvbnRlbnQuZGVjaW1hbH1gLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBIZWxwKGtleV9zZWFyY2gpIHsKICAgICAgICAgICAgU2hvd1Jlc291cmNlKGtleV9zZWFyY2gpOwogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbERhdGEoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmlkKSB7CiAgICAgICAgICAgICAgICAvLyBFZGl0IE1vZGUKICAgICAgICAgICAgICAgIC8vIHRoaXMudHJhbnNhY3Rpb24gPSB0aGlzLmluaXRQdXJjaGFzZU9yZGVyOwogICAgICAgICAgICAgICAgdGhpcy5zZXREZWZhdWx0RGF0YSgpCiAgICAgICAgICAgICAgICB0aGlzLmxvYWRWaWV3UHVyY2hhc2VPcmRlcigpCiAgICAgICAgICAgICAgICAvLyB0aGlzLmJpbmREYXRhKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBCcmFuZCBOZXcgTW9kZQogICAgICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXREZWZhdWx0RGF0YSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzZXREZWZhdWx0RGF0YSgpIHsKICAgICAgICAgICAgLy8gQnJhbmQgTmV3IE1vZGUKICAgICAgICAgICAgdGhpcy5pc0VkaXQgPSBmYWxzZTsKICAgICAgICAgICAgY29uc3QgcGF5bWVudFRlcm0gPSB0aGlzLnRyYW5zYWN0aW9uLnBheW1lbnRUZXJtIHx8IHt9CiAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24gPSBuZXcgVHJhbnNhY3Rpb25Nb2RlbCh7fSk7CiAgICAgICAgICAgIC8vbW9udGggb2YKICAgICAgICAgICAgbGV0IG1vbnRoT2YgPSBrZW5kby50b1N0cmluZyhuZXcgRGF0ZSh0aGlzLnRyYW5zYWN0aW9uLnRyYW5zYWN0aW9uRGF0ZSksICJ5eXl5LU1NLWRkIik7CiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygnbW9udGhPZicsIG1vbnRoT2YpCiAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24ubW9udGhfb2YgPSBtb250aE9mOwogICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLmZvcm1UZW1wbGF0ZSA9IDE7CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuaXRlbUxpbmVQT0RTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgIGRzLmRhdGEoW10pOwogICAgICAgICAgICAvLyBBZGQgMiBkZWZhdWx0IGxpbmVzCiAgICAgICAgICAgIHRoaXMuYWRkUm93KCk7CiAgICAgICAgICAgIHRoaXMubG9hZFByZWZpeCgpOwogICAgICAgICAgICB0aGlzLmxvYWRQYXltZW50VGVybSgpOwogICAgICAgICAgICB0aGlzLmxvYWRQcmljZUxldmVsKCk7CiAgICAgICAgICAgIHRoaXMubG9hZFNlZ21lbnQoKTsKICAgICAgICAgICAgdGhpcy5sb2FkTG9jYXRpb24oKTsKICAgICAgICAgICAgdGhpcy5tRW1wbG95ZWUgPSB7fTsKICAgICAgICAgICAgdGhpcy50YXhMaXN0VG90YWwgPSB7fTsKICAgICAgICAgICAgdGhpcy5pc1NhdmVOZXcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5pc1NhdmVDbG9zZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmlzU2F2ZVByaW50ID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuaXNTYXZlRHJhZnQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5wYXltZW50VGVybSA9IHBheW1lbnRUZXJtCiAgICAgICAgfSwKICAgICAgICBiaW5kRGF0YSgpIHsKICAgICAgICAgICAgLy8gRWRpdCBNb2RlCiAgICAgICAgICAgIHRoaXMuaXNFZGl0ID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5zdXBwbGllciA9IHRoaXMudHJhbnNhY3Rpb24uc3VwcGxpZXI7CiAgICAgICAgICAgIHRoaXMudGF4TGlzdFRvdGFsID0gdGhpcy50cmFuc2FjdGlvbi50YXhMaXN0VG90YWw7CiAgICAgICAgICAgIHRoaXMuaXRlbUxpbmVzID0gdGhpcy50cmFuc2FjdGlvbi5pdGVtTGluZXM7CiAgICAgICAgICAgIC8vIGlmICh0aGlzLnN1cHBsaWVyLmhhc093blByb3BlcnR5KCdpZCcpKSB7CiAgICAgICAgICAgIC8vICAgdGhpcy5sb2FkUHJvamVjdEJ5U3VwcGxpZXIoKQogICAgICAgICAgICAvLyB9CiAgICAgICAgfSwKICAgICAgICBhZGRSb3coKSB7CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuaXRlbUxpbmVQT0RTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICB0b3RhbCA9IGRzLnRvdGFsKCk7CiAgICAgICAgICAgIHRoaXMuaXRlbUxpbmUuaWQgPSB0cmFuc2FjdGlvblByZWZpeCArIHV1aWQudjEoKTsKICAgICAgICAgICAgZHMuaW5zZXJ0KHRvdGFsLCB0aGlzLml0ZW1MaW5lKTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRQYXltZW50VGVybSgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyRmlsdGVyID0gIj90eXBlPXBtdC1zdXBwbGllciI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXltZW50VGVybXMgPSBbXQogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzSGFuZGxlci5nZXRQYXltZW50VGVybShzdHJGaWx0ZXIpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGF5bWVudFRlcm1zID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgKHRoaXMucGF5bWVudFRlcm1zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgIT09IHVuZGVmaW5lZCB8fAogICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgIHRoaXMuJHJvdXRlLnBhcmFtcy5pZCAhPT0gIiIKICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24ucGF5bWVudFRlcm0gPSB0aGlzLnBheW1lbnRUZXJtc1swXTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRQcmljZUxldmVsKCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJGaWx0ZXIgPSAnP25hdHVyZT0nICsgVFlQRQogICAgICAgICAgICAgICAgICAgIHByaWNlTGV2ZWxIYW5kbGVyLmdldChzdHJGaWx0ZXIpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByaWNlTGV2ZWxzID0gcmVzOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmljZUxldmVscy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGUucGFyYW1zLmlkICE9PSB1bmRlZmluZWQgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgIT09ICIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLnByaWNlTGV2ZWwgPSB0aGlzLnByaWNlTGV2ZWxzWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZFRyYW5zYWN0aW9uUmF0ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFNlZ21lbnQoKSB7CiAgICAgICAgICAgIHRoaXMuc2VnbWVudHMgPSBbXQogICAgICAgICAgICBjb25zdCByb2xlVHlwZSA9IGRhdGFTdG9yZS5yb2xlVHlwZSB8fCAwCiAgICAgICAgICAgIGlmIChyb2xlVHlwZSA9PT0gMCkgewogICAgICAgICAgICAgICAgaWYgKGRhdGFTdG9yZS5yb2xlRGF0YSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvbGVEYXRhID0gZGF0YVN0b3JlLnJvbGVEYXRhIHx8IFtdCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VnbWVudCA9IHJvbGVEYXRhLmZpbHRlcihpdG0gPT4gaXRtLnR5cGUgPT09ICdzZWdtZW50JykKICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWdtZW50RGVmYXVsdCA9IHNlZ21lbnQuZmlsdGVyKG0gPT4gbS5pc0RlZmF1bHQgPT09IDEpCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWdtZW50cyA9IHNlZ21lbnQKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkID09PSB1bmRlZmluZWQgfHwgdGhpcy4kcm91dGUucGFyYW1zLmlkID09PSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VnbWVudERlZmF1bHQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5zZWdtZW50ID0gc2VnbWVudERlZmF1bHRbMF07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1lbHNlIGlmIChyb2xlVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWdtZW50cyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5nc0hhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRTZWcoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWdtZW50cyA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZExvY2F0aW9uKCkgewogICAgICAgICAgICB0aGlzLmxvY2F0aW9ucyA9IFtdCiAgICAgICAgICAgIGNvbnN0IHJvbGVUeXBlID0gZGF0YVN0b3JlLnJvbGVUeXBlIHx8IDAKICAgICAgICAgICAgaWYgKHJvbGVUeXBlID09PSAwKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YVN0b3JlLnJvbGVEYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm9sZURhdGEgPSBkYXRhU3RvcmUucm9sZURhdGEgfHwgW10KICAgICAgICAgICAgICAgICAgICBjb25zdCBsb2NhdGlvbiA9IHJvbGVEYXRhLmZpbHRlcihpdG0gPT4gaXRtLnR5cGUgPT09ICdsb2NhdGlvbicpCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9jYXRpb25EZWZhdWx0ID0gbG9jYXRpb24uZmlsdGVyKG0gPT4gbS5pc0RlZmF1bHQgPT09IDEpCiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2NhdGlvbnMgPSBsb2NhdGlvbgogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09IHVuZGVmaW5lZCB8fCB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2NhdGlvbkRlZmF1bHQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5sb2NhdGlvbiA9IGxvY2F0aW9uRGVmYXVsdFswXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfWVsc2UgIGlmIChyb2xlVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2NhdGlvbnMgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25IYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAubGlzdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9jYXRpb25zID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAvLwogICAgICAgIGhpZGVfc21hbGxzaXRlYmFyKCkgewogICAgICAgICAgICB0aGlzLmlzSGlkZUJhciA9ICF0aGlzLmlzSGlkZUJhcjsKICAgICAgICB9LAogICAgICAgIC8vCiAgICAgICAgb25QYXltZW50VGVybUNoYW5nZWQoKSB7CiAgICAgICAgICAgIC8vIHRoaXMub25EYXRlQ2hhbmdlZCgpOwogICAgICAgICAgICBpZiAodGhpcy5zdXBwbGllcikgewogICAgICAgICAgICAgICAgY29uc3QgcGF5bWVudFRlcm0gPSB0aGlzLnRyYW5zYWN0aW9uLnBheW1lbnRUZXJtIHx8IHt9CiAgICAgICAgICAgICAgICBjb25zdCBuZXREdWUgPSBwYXltZW50VGVybS5uZXREdWUgfHwgMDsKICAgICAgICAgICAgICAgIGNvbnN0IHNvbWVEYXRlID0gbmV3IERhdGUodGhpcy50cmFuc2FjdGlvbi50cmFuc2FjdGlvbkRhdGUpOwogICAgICAgICAgICAgICAgc29tZURhdGUuc2V0RGF0ZShzb21lRGF0ZS5nZXREYXRlKCkgKyBwYXJzZUludChuZXREdWUpKTsgLy9udW1iZXIgIG9mIGRheXMgdG8gYWRkLCBlLnguIDE1IGRheXMKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24uZXhzcGVjdGVkRGF0ZSA9IHNvbWVEYXRlCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIG9uQ2hhbmdlKGV2ZW50KSB7CiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZXZlbnQudmFsdWU7CiAgICAgICAgICAgIGlmICh2YWx1ZSAmJiB2YWx1ZVt0ZXh0RmllbGRdID09PSBlbXB0eUl0ZW1bdGV4dEZpZWxkXSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuc3VwcGxpZXIgPSB2YWx1ZTsKICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5zdXBwbGllciA9IHZhbHVlOwogICAgICAgICAgICAvLyB0aGlzLmludm9pY2UgPSB2YWx1ZQogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coInByaWNlbHZlbCIsIHZhbHVlKQogICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLnBheW1lbnRUZXJtID0gdmFsdWUucGF5bWVudFRlcm0gfHwge307CiAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24ucHJpY2VMZXZlbCA9IHZhbHVlLnByaWNlTGV2ZWwgfHwge307CiAgICAgICAgICAgIGNvbnN0IGJhc2VDdXJyZW5jeSA9IHZhbHVlLmJhc2VDdXJyZW5jeSB8fCB7fTsKICAgICAgICAgICAgaWYgKGJhc2VDdXJyZW5jeS5oYXNPd25Qcm9wZXJ0eSgiY29kZSIpKSB7CiAgICAgICAgICAgICAgICB0aGlzLmJhc2VDdXJyZW5jeUNvZGUgPSBiYXNlQ3VycmVuY3kuY29kZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyB0aGlzLmxvYWRQcm9qZWN0QnlTdXBwbGllcigpCiAgICAgICAgICAgIC8vIHRoaXMubG9hZFB1cmNoYXNlKCk7CiAgICAgICAgICAgIHRoaXMub25EYXRlQ2hhbmdlZCgpOwogICAgICAgIH0sCiAgICAgICAgb25GaWx0ZXJDaGFuZ2UoZXZlbnQpIHsKICAgICAgICAgICAgY29uc3QgZmlsdGVyID0gZXZlbnQuZmlsdGVyLnZhbHVlOwogICAgICAgICAgICB0aGlzLnJlcXVlc3REYXRhKDAsIGZpbHRlciwgdGhpcy5zdXBCYXNlVXJsKTsKICAgICAgICAgICAgdGhpcy5maWx0ZXIgPSBmaWx0ZXI7CiAgICAgICAgfSwKICAgICAgICByZXF1ZXN0RGF0YShza2lwLCBmaWx0ZXIsIGJhc2VVcmwpIHsKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKGJhc2VVcmwsICJyZXF1Iik7CiAgICAgICAgICAgIGNvbnN0IHVybCA9IGJhc2VVcmwgKyBgP2ZpbHRlcj0ke2ZpbHRlcn1gOwogICAgICAgICAgICB0aGlzLnJlcXVlc3RTdGFydGVkID0gdHJ1ZTsKICAgICAgICAgICAgZmV0Y2godXJsKQogICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAudGhlbih0aGlzLmFmdGVyRmV0Y2gpOwogICAgICAgIH0sCiAgICAgICAgYWZ0ZXJGZXRjaChqc29uKSB7CiAgICAgICAgICAgIHRoaXMuc3VwcGxpZXJMaXN0ID0ganNvbi5kYXRhOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFRyYW5zYWN0aW9uUmF0ZSgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHRoaXMudHJhbnNhY3Rpb24udHJhbnNhY3Rpb25EYXRlKQogICAgICAgICAgICAgICAgICAgICAgICAudG9JU09TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgICAgICAuc3Vic3RyKDAsIDEwKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwcmljZUxldmVsID0gdGhpcy50cmFuc2FjdGlvbi5wcmljZUxldmVsOwogICAgICAgICAgICAgICAgICAgIGxldCBjb2RlID0gIiI7CiAgICAgICAgICAgICAgICAgICAgaWYgKHByaWNlTGV2ZWwuaGFzT3duUHJvcGVydHkoImN1cnJlbmN5IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByaWNlTGV2ZWwuY3VycmVuY3kuaGFzT3duUHJvcGVydHkoImNvZGUiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZSA9IHByaWNlTGV2ZWwuY3VycmVuY3kuY29kZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoY29kZSAhPT0gdW5kZWZpbmVkIHx8IGNvZGUgIT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRMYXN0RXhjaGFuZ2VSYXRlQnlEYXRlKGRhdGUsIGNvZGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXhjaGFuZ2VSYXRlID0gcmVzLmRhdGEuZGF0YVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW5jeUNvZGUgPSB0aGlzLmV4Y2hhbmdlUmF0ZS5jb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uUmF0ZSA9IHRoaXMuZXhjaGFuZ2VSYXRlLnJhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24udHhuUmF0ZSA9IHRoaXMuZXhjaGFuZ2VSYXRlLnJhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24uZXhjaGFuZ2VSYXRlID0gdGhpcy5leGNoYW5nZVJhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgb25EYXRlQ2hhbmdlZCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuc3VwcGxpZXIpIHsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMubG9hZFBheW1lbnRUZXJtTGlzdCgpOwogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5sb2FkQ3JlZGl0TGltaXQoKTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMubG9hZEN1c3RvbWVyQmFsYW5jZSh0aGlzLnN1cHBsaWVyLmlkKTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMub25QcmljZUxldmVsQ2hhbmdlKCk7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLm1vbnRoX29mID0ga2VuZG8udG9TdHJpbmcobmV3IERhdGUodGhpcy50cmFuc2FjdGlvbi50cmFuc2FjdGlvbkRhdGUpLCAneXl5eS1NTScpCiAgICAgICAgICAgICAgICAvLyBjb25zdCBwYXltZW50VGVybSA9IHRoaXMudHJhbnNhY3Rpb24ucGF5bWVudFRlcm0gfHwge30KICAgICAgICAgICAgICAgIC8vIGlmIChwYXltZW50VGVybSkgewogICAgICAgICAgICAgICAgLy8gICAgIGNvbnN0IG5ldER1ZSA9IHBheW1lbnRUZXJtLm5ldER1ZSB8fCAwOwogICAgICAgICAgICAgICAgLy8gICAgIGxldCBzb21lRGF0ZSA9IG5ldyBEYXRlKHRoaXMudHJhbnNhY3Rpb24udHJhbnNhY3Rpb25EYXRlKTsKICAgICAgICAgICAgICAgIC8vICAgICBzb21lRGF0ZS5zZXREYXRlKHNvbWVEYXRlLmdldERhdGUoKSArIHBhcnNlSW50KG5ldER1ZSkpOyAvL251bWJlciAgb2YgZGF5cyB0byBhZGQsIGUueC4gMTUgZGF5cwogICAgICAgICAgICAgICAgLy8gICAgIHdpbmRvdy5jb25zb2xlLmxvZygnc29tZURhdGUnLCBzb21lRGF0ZSwgcGF5bWVudFRlcm0pCiAgICAgICAgICAgICAgICAvLyAgICAgdGhpcy50cmFuc2FjdGlvbi5leHNwZWN0ZWREYXRlID0gc29tZURhdGUKICAgICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAgIC8vIHRoaXMub25QYXltZW50VGVybUNoYW5nZWQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09IHVuZGVmaW5lZCAmJiB0aGlzLmlzRWRpdCA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZU51bWJlcigpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBnZW5lcmF0ZU51bWJlcigpIHsKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKCdnZW5lcmF0ZU51bWJlcicpCiAgICAgICAgICAgIGxldCBkID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnN1YnN0cigwLCAxMCk7CiAgICAgICAgICAgIGlmICh0aGlzLnRyYW5zYWN0aW9uLnRyYW5zYWN0aW9uRGF0ZSkgewogICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKHRoaXMudHJhbnNhY3Rpb25EYXRlKQogICAgICAgICAgICAgICAgZCA9IHRoaXMudHJhbnNhY3Rpb24udHJhbnNhY3Rpb25EYXRlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCBkYXRhID0gewogICAgICAgICAgICAgICAgYWJicjogdGhpcy50cmFuc2FjdGlvbi50cmFuc2FjdGlvblR5cGUuYWJiciwKICAgICAgICAgICAgICAgIHN0cnVjdHVyZTogdGhpcy50cmFuc2FjdGlvbi50cmFuc2FjdGlvblR5cGUuc3RydWN0dXJlLAogICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25EYXRlOiBkLAogICAgICAgICAgICAgICAgdHlwZTogIlB1cmNoYXNlIE9yZGVyIiwKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYmlsbGluZ0hhbmRsZXIKICAgICAgICAgICAgICAgIC5sYXN0TnVtYmVyKGRhdGEpCiAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXN0TnVtYmVyID0gdGhpcy56ZXJvUGFkKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VJbnQocmVzLmxhc3ROdW1iZXIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi50cmFuc2FjdGlvblR5cGUuZm9ybWF0CiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG51bWJlciA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMuc3VmZml4ICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24udHJhbnNhY3Rpb25UeXBlLm51bWJlclNlcGFyYXRvciArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0TnVtYmVyOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLm51bWJlciA9IG51bWJlcjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvcnMucHVzaChlKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgemVyb1BhZChudW0sIHBsYWNlcykgewogICAgICAgICAgICByZXR1cm4gU3RyaW5nKG51bSkucGFkU3RhcnQocGxhY2VzLCAiMCIpOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFByZWZpeCgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgcHJlZml4SGFuZGxlci5nZXQoInB1cmNoYXNlIG9yZGVyIikudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb25UeXBlID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRyYW5zYWN0aW9uVHlwZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi50cmFuc2FjdGlvblR5cGUgPSB0aGlzLnRyYW5zYWN0aW9uVHlwZVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZU51bWJlcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRQdXJjaGFzZUZvcm1Db250ZW50KCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBwdXJjaGFzZUZvcm1Db250ZW50SGFuZGxlci5saXN0KCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2VGb3JtQ29udGVudCA9IGRhdGFbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkUHJvamVjdEJ5U3VwcGxpZXIoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIC8vIHByb2plY3RIYW5kbGVyLmdldEJ5U3VwcGxpZXIodGhpcy5zdXBwbGllci5pZCkudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgIHByb2plY3RIYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgIC5saXN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHJvamVjdHMgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmICh0aGlzLnByb2plY3RzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgaWYgKCF0aGlzLmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLnByb2plY3QgPSB0aGlzLnByb2plY3RzWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKTsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFRheCgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ0hhbmRsZXIuZ2V0KCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGF4ID0gcmVzOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm90aGVyVGF4ID0gdGhpcy50YXguZmlsdGVyKChtKSA9PiBtLnRheFR5cGUudHlwZUlkID09PSA3KTsgLy8gdmFsdWFibGUgdGF4CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMud2l0aGhvbGRpbmdUYXggPSB0aGlzLnRheC5maWx0ZXIobSA9PiBtLnRheFR5cGUudHlwZUlkID09PSAyICYmIG0udHJhbnNhY3Rpb25UeXBlID09PSAnU2FsZScpIC8vIHZhbHVhYmxlIHRheAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZhdFRheCA9IHRoaXMudGF4LmZpbHRlcigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChtKSA9PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0udGF4VHlwZS50eXBlSWQgPT09IDEgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLnRheFR5cGUudHlwZUlkID09PSA4IHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbS50YXhUeXBlLnR5cGVJZCA9PT0gMgogICAgICAgICAgICAgICAgICAgICAgICApOyAvLyB2YWx1YWJsZSB0YXgKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkU2FsZVVuaXRJdGVtcygpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgc2FsZVVuaXRJdGVtSGFuZGxlci5saXN0KCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNhbGVVbml0SXRlbUxpc3QgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIC8vaXRlbWxpbmUKICAgICAgICByZW1vdmVEdXBsaWNhdGUoYXJyYXkpIHsKICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gW107CiAgICAgICAgICAgIGNvbnN0IG1hcCA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGFycmF5KSB7CiAgICAgICAgICAgICAgICBpZiAoIW1hcC5oYXMoaXRlbS5pZCkpIHsKICAgICAgICAgICAgICAgICAgICBtYXAuc2V0KGl0ZW0uaWQsIHRydWUpOyAvLyBzZXQgYW55IHZhbHVlIHRvIE1hcAogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfSwKICAgICAgICBhdXRvQ2FsY3VsYXRlRGlzY291bnQoZGlzY291bnRJdGVtLCBzdWJUb3RhbCkgewogICAgICAgICAgICBpZiAoZGlzY291bnRJdGVtKSB7CiAgICAgICAgICAgICAgICBjb25zdCBuYXR1cmUgPSBkaXNjb3VudEl0ZW0ubmF0dXJlIHx8ICcnCiAgICAgICAgICAgICAgICBjb25zdCBhbW91bnQgPSBkaXNjb3VudEl0ZW0uYW1vdW50IHx8IDAKICAgICAgICAgICAgICAgIGlmIChuYXR1cmUgPT09ICdBbW91bnQnKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoYW1vdW50KQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuYXR1cmUgPT09ICdQZXJjZW50YWdlJykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAoc3ViVG90YWwgKiAocGFyc2VGbG9hdChhbW91bnQpIC8gMTAwKSkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGF1dG9DYWxjdWxhdGVUYXgodGF4LCBhbW91bnQpIHsKICAgICAgICAgICAgaWYgKHRheCkgewogICAgICAgICAgICAgICAgdmFyIGZvcm11bGEgPSB0YXguZm9ybXVsYTsKICAgICAgICAgICAgICAgIHZhciBpbkFtdCA9IGtlbmRvLnBhcnNlRmxvYXQoYW1vdW50KTsKICAgICAgICAgICAgICAgIHZhciBuQW10ID0ga2VuZG8ucGFyc2VGbG9hdChhbW91bnQpOwogICAgICAgICAgICAgICAgdmFyIHRheEJhc2UgPSBrZW5kby5wYXJzZUZsb2F0KHRheC50YXhCYXNlKSAvIDEwMDsKICAgICAgICAgICAgICAgIHZhciByYXRlID0ga2VuZG8ucGFyc2VGbG9hdCh0YXgucmF0ZSkgLyAxMDA7CiAgICAgICAgICAgICAgICB2YXIgdG90YWwgPSBldmFsKGZvcm11bGEpOwogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKGluQW10LCBuQW10LCB0YXhCYXNlLCByYXRlLCBmb3JtdWxhLCB0b3RhbCk7CiAgICAgICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2codGF4LCAidGF4Iik7CiAgICAgICAgICAgICAgICAvLyBpZiAodGF4Lmhhc093blByb3BlcnR5KCJ0YXhUeXBlIikpIHsKICAgICAgICAgICAgICAgIC8vICAgICBpZiAodGF4LnRheFR5cGUubmF0dXJlID09ICJEZWR1Y3QiKSB7CiAgICAgICAgICAgICAgICAvLyAgICAgICAgIHRvdGFsID0gdG90YWwgKiAtMTsKICAgICAgICAgICAgICAgIC8vICAgICB9CiAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgICByZXR1cm4gdG90YWw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gcmV0dXJuIDAKICAgICAgICB9LAogICAgICAgIGF1dG9DYWxjdWxhdGVUYXhCeVR5cGUodGF4KSB7CiAgICAgICAgICAgIC8vIHJldHVybiBieSBhIGtleQogICAgICAgICAgICBjb25zdCBncm91cEFsbCA9IChsaXN0KSA9PgogICAgICAgICAgICAgICAgbGlzdC5yZWR1Y2UoKHRheCwgaXRlbSkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRheEFtb3VudCA9IHRheFtpdGVtLm5hbWVdIHx8IDA7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIHRheCwgewogICAgICAgICAgICAgICAgICAgICAgICBbaXRlbS5uYW1lXTogdGF4QW1vdW50ICsgcGFyc2VGbG9hdChpdGVtLmFtb3VudCksCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCB7fSk7CiAgICAgICAgICAgIHRoaXMudGF4TGlzdFRvdGFsID0gZ3JvdXBBbGwodGF4KTsKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKCduaW1vbCcsIGdyb3VwQWxsKHRheCkpCiAgICAgICAgICAgIC8vIHRoaXMuCiAgICAgICAgfSwKICAgICAgICBkYXRhU291cmNlQ2hhbmdlZChlKSB7CiAgICAgICAgICAgIGlmIChlLmZpZWxkKSB7CiAgICAgICAgICAgICAgICBsZXQgZGF0YVJvdyA9IGUuaXRlbXNbMF0sCiAgICAgICAgICAgICAgICAgICAgYnVvbSA9IHt9LAogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNpb25SYXRlID0gMSwKICAgICAgICAgICAgICAgICAgICB3YWMgPSAwLAogICAgICAgICAgICAgICAgICAgIHFvaCA9IDAsCiAgICAgICAgICAgICAgICAgICAgYW1vdW50ID0gMCwKICAgICAgICAgICAgICAgICAgICB4QW1vdW50ID0gMDsKICAgICAgICAgICAgICAgIHN3aXRjaCAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgIml0ZW0iOgogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmF0dHJpYnV0ZV8gPSB0aGlzLmF0dHJpYnV0ZXMuZmlsdGVyKG0gPT4gbS50eXBlLmlkID09PSBkYXRhUm93LnZhcmlhbnQuaWQpCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJkZXNjcmlwdGlvbiIsIGRhdGFSb3cuaXRlbS5kZXNjcmlwdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGJ1b20gPSBkYXRhUm93Lml0ZW0udW9tIHx8IHt9OwogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiYnVvbSIsIGJ1b20pOwogICAgICAgICAgICAgICAgICAgICAgICAvLyBkYXRhUm93LnNldCgndW9tJywgYnVvbSkKICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKGRhdGFSb3cuaXRlbSwncm93JykKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXdhaXQgdGhpcy5pbnZlbnRvcnlCYWxhbmNlKGRhdGFSb3csIGRhdGFSb3cuaXRlbS5pZCkKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiY29zdCI6CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQgPSBwYXJzZUZsb2F0KGRhdGFSb3cuY29zdCkgKiBwYXJzZUZsb2F0KGRhdGFSb3cucXR5KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhBbW91bnQgPSBhbW91bnQgKiBwYXJzZUZsb2F0KHRoaXMudHJhbnNhY3Rpb24udHhuUmF0ZSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNvc3QiLCBwYXJzZUZsb2F0KGRhdGFSb3cuY29zdCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImFtb3VudCIsIGFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiZXhjaGFuZ2VBbW91bnQiLCB4QW1vdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZygncHJpY2UnLGRhdGFSb3cucHJpY2UpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNvc3QiLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJhbW91bnQiLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJleGNoYW5nZUFtb3VudCIsIDApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgInVvbSI6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzUHJpY2VMZXZlbENoYW5nZWQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1b20gPSBkYXRhUm93LnVvbS5idW9tIHx8IHt9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFvaCA9IGRhdGFSb3cudW9tLnFvaCB8fCAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNpb25SYXRlID0gZGF0YVJvdy51b20uY29udmVyc2lvblJhdGUgfHwgMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWMgPSBkYXRhUm93LnVvbS53YWMgfHwgMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiYnVvbSIsIGJ1b20pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJ3YWMiLCB3YWMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJxb2giLCBxb2gpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjb252ZXJzaW9uUmF0ZSIsIHBhcnNlRmxvYXQoY29udmVyc2lvblJhdGUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVJvdy51b20pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50ID0gcGFyc2VGbG9hdChkYXRhUm93LnVvbS5jb3N0KSAqIHBhcnNlRmxvYXQoZGF0YVJvdy5xdHkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4QW1vdW50ID0gYW1vdW50ICogcGFyc2VGbG9hdCh0aGlzLnRyYW5zYWN0aW9uLnR4blJhdGUpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNvc3QiLCBwYXJzZUZsb2F0KGRhdGFSb3cudW9tLmNvc3QpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImFtb3VudCIsIGFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJleGNoYW5nZUFtb3VudCIsIHhBbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudCA9IHBhcnNlRmxvYXQoZGF0YVJvdy5jb3N0KSAqIHBhcnNlRmxvYXQoZGF0YVJvdy5xdHkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4QW1vdW50ID0gYW1vdW50ICogcGFyc2VGbG9hdCh0aGlzLnRyYW5zYWN0aW9uLnR4blJhdGUpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNvc3QiLCBwYXJzZUZsb2F0KGRhdGFSb3cuY29zdCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiYW1vdW50IiwgYW1vdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImV4Y2hhbmdlQW1vdW50IiwgeEFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCJlcnJvciIsIGVycik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImJ1b20iLCB7fSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNvbnZlcnNpb25SYXRlIiwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNvc3QiLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgicW9oIiwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoIndhYyIsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJhbW91bnQiLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiZXhjaGFuZ2VBbW91bnQiLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJxdHkiOgogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50ID0gcGFyc2VGbG9hdChkYXRhUm93LmNvc3QpICogcGFyc2VGbG9hdChkYXRhUm93LnF0eSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4QW1vdW50ID0gYW1vdW50ICogcGFyc2VGbG9hdCh0aGlzLnRyYW5zYWN0aW9uLnR4blJhdGUpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjb3N0IiwgcGFyc2VGbG9hdChkYXRhUm93LmNvc3QpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJhbW91bnQiLCBhbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImV4Y2hhbmdlQW1vdW50IiwgeEFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNvc3QiLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJhbW91bnQiLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJleGNoYW5nZUFtb3VudCIsIDApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgIm90aGVyVGF4IjoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKCItLSIsIGRhdGFSb3cpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGUuZmllbGQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmF1dG9DYWxjdWxhdGUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYXV0b0NhbGN1bGF0ZSgpIHsKICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5pdGVtTGluZVBPRFMua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIHN1YlRvdGFsID0gMCwKICAgICAgICAgICAgICAgIHRvdGFsVGF4ID0gMCwKICAgICAgICAgICAgICAgIGRpc2NvdW50VG90YWwgPSAwLAogICAgICAgICAgICAgICAgc3BUYXggPSAwLAogICAgICAgICAgICAgICAgcGx0YXggPSAwLAogICAgICAgICAgICAgICAgb3RoZXJUYXggPSAwLAogICAgICAgICAgICAgICAgdmF0VGF4ID0gMCwKICAgICAgICAgICAgICAgIGRpc2NvdW50SW52b2ljZSA9IDAsCiAgICAgICAgICAgICAgICB0YXhMaXN0ID0gW10sCiAgICAgICAgICAgICAgICBkaXNjb3VudEl0ZW0gPSBbXSwKICAgICAgICAgICAgICAgIHRheExpc3REZXRhaWwgPSBbXSwKICAgICAgICAgICAgICAgIHNhbGVVbml0ID0gW10sCiAgICAgICAgICAgICAgICBpbmNsdXNpdmVUYXggPSAwLAogICAgICAgICAgICAgICAgaXRlbVN1YnRvdGFsID0gMCwKICAgICAgICAgICAgICAgIHR4bkl0bVN1YnRvdGFsID0gMCwKICAgICAgICAgICAgICAgIHNlcnZpY2VTdWJ0b3RhbCA9IDAsCiAgICAgICAgICAgICAgICBpdGVtRGlzY291bnQgPSAwLAogICAgICAgICAgICAgICAgc2VydmljZURpc2NvdW50ID0gMCwKICAgICAgICAgICAgICAgIHdpdGhob2xkaW5nVGF4QW1vdW50ID0gMCwKICAgICAgICAgICAgICAgIHR4bkRpc2NvdW50ID0gMDsKCiAgICAgICAgICAgIGRzLmRhdGEoKS5mb3JFYWNoKCh2YWx1ZSkgPT4gewogICAgICAgICAgICAgICAgbGV0IG1vZGlmaWVyUHJpY2UgPSAwLCBpbmNUYXggPSAwLCB0YXhUeXBlSWQgPSAwOwogICAgICAgICAgICAgICAgbGV0IHZhdFNwVGF4ID0ge30sIHZhdFBMVGF4ID0ge30sIHZhdE90aGVyVGF4ID0ge30KICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5tb2RpZmllcikgewogICAgICAgICAgICAgICAgICAgIG1vZGlmaWVyUHJpY2UgPSBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLm1vZGlmaWVyLnByaWNlIHx8IDApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIHN1YlRvdGFsICs9IChrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmFtb3VudCkgKyBtb2RpZmllclByaWNlKQogICAgICAgICAgICAgICAgbGV0IGRpc2NvdW50ID0gMDsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5kaXNjb3VudEl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICBsZXQgc3ViVG8gPQogICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmNvc3QpICoga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5xdHkpOwogICAgICAgICAgICAgICAgICAgIGRpc2NvdW50ID0gdGhpcy5hdXRvQ2FsY3VsYXRlRGlzY291bnQodmFsdWUuZGlzY291bnRJdGVtLCBzdWJUbyk7CiAgICAgICAgICAgICAgICAgICAgdmFsdWVbImRpc2NvdW50QW1vdW50Il0gPSBkaXNjb3VudDsKICAgICAgICAgICAgICAgICAgICB2YWx1ZVsiZGlzY291bnRFeGNoYW5nZUFtb3VudCJdID0KICAgICAgICAgICAgICAgICAgICAgICAgZGlzY291bnQgKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMudHJhbnNhY3Rpb24udHhuUmF0ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmRpc2NvdW50SXRlbS5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudEl0ZW0ucHVzaCh2YWx1ZS5kaXNjb3VudEl0ZW0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBkaXNjb3VudFRvdGFsICs9IGRpc2NvdW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHZhbHVlLnNhbGVVbml0KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnNhbGVVbml0Lmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNhbGVVbml0LnB1c2godmFsdWUuc2FsZVVuaXQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5zcGVjaWZpY1RheCkgewogICAgICAgICAgICAgICAgICAgIHNwVGF4ID0gdGhpcy5hdXRvQ2FsY3VsYXRlVGF4KAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZS5zcGVjaWZpY1RheCwKICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5hbW91bnQpIC0ga2VuZG8ucGFyc2VGbG9hdChkaXNjb3VudCkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZygnc3AgJywgZGlzY291bnQpCiAgICAgICAgICAgICAgICAgICAgc3BUYXggPSBrZW5kby5wYXJzZUZsb2F0KHNwVGF4KSA/IGtlbmRvLnBhcnNlRmxvYXQoc3BUYXgpIDogMDsKICAgICAgICAgICAgICAgICAgICB2YWx1ZVsic3BlY2lmaWNUYXhBbW91bnQiXSA9IHNwVGF4OwogICAgICAgICAgICAgICAgICAgIHZhbHVlWyJzcGVjaWZpY1RheEV4Y2hhbmdlQW1vdW50Il0gPQogICAgICAgICAgICAgICAgICAgICAgICBzcFRheCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy50cmFuc2FjdGlvbi50eG5SYXRlKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXggPSB2YWx1ZS5zcGVjaWZpY1RheDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiYXNlQW1vdW50ID0gdGF4LmJhc2VBbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKGJhc2VBbW91bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJhc2VBbW91bnQudG9Mb3dlckNhc2UoKSA9PT0gImluY2x1c2l2ZSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluY2x1c2l2ZVRheCArPSBwYXJzZUZsb2F0KHNwVGF4IHx8IDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5jVGF4ICs9IHBhcnNlRmxvYXQoc3BUYXggfHwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuc3BlY2lmaWNUYXguaGFzT3duUHJvcGVydHkoInRheFR5cGUiKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0YXhMaXN0LnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdmFsdWUuc3BlY2lmaWNUYXgudGF4VHlwZS5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBzcFRheCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB2YWx1ZS5zcGVjaWZpY1RheC50YXhUeXBlLmlkLAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3BUYXhfID0gdmFsdWUuc3BlY2lmaWNUYXggfHwge30KICAgICAgICAgICAgICAgICAgICAgICAgc3BUYXhfWyd0YXhBbW91bnRfJ10gPSBzcFRheAogICAgICAgICAgICAgICAgICAgICAgICAvLyBzcFRheF9bJ3RheEFtb3VudCddID0gc3BUYXgKICAgICAgICAgICAgICAgICAgICAgICAgc3BUYXhfWydhbW91bnQnXSA9IHZhbHVlLmFtb3VudCB8fCAwCiAgICAgICAgICAgICAgICAgICAgICAgIHNwVGF4X1snZGlzY291bnQnXSA9IGRpc2NvdW50IHx8IDAKICAgICAgICAgICAgICAgICAgICAgICAgc3BUYXhfWyd0eG5SYXRlJ10gPSB0aGlzLnRyYW5zYWN0aW9uLnR4blJhdGUgfHwgMQogICAgICAgICAgICAgICAgICAgICAgICB0YXhMaXN0RGV0YWlsLnB1c2goc3BUYXhfKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmF0U3BUYXggPSBzcFRheF8KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodmFsdWUucHVibGljTGlnaHRpbmdUYXgpIHsKICAgICAgICAgICAgICAgICAgICBwbHRheCA9IHRoaXMuYXV0b0NhbGN1bGF0ZVRheCgKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUucHVibGljTGlnaHRpbmdUYXgsCiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuYW1vdW50KSAtIGtlbmRvLnBhcnNlRmxvYXQoZGlzY291bnQpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBwbHRheCA9IGtlbmRvLnBhcnNlRmxvYXQocGx0YXgpID8ga2VuZG8ucGFyc2VGbG9hdChwbHRheCkgOiAwOwogICAgICAgICAgICAgICAgICAgIHZhbHVlWyJwdWJsaWNMaWdodGluZ1RheEFtb3VudCJdID0gcGx0YXg7CiAgICAgICAgICAgICAgICAgICAgdmFsdWVbInB1YmxpY0xpZ2h0aW5nVGF4RXhjaGFuZ2VBbW91bnQiXSA9CiAgICAgICAgICAgICAgICAgICAgICAgIHBsdGF4ICoga2VuZG8ucGFyc2VGbG9hdCh0aGlzLnRyYW5zYWN0aW9uLnR4blJhdGUpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRheCA9IHZhbHVlLnB1YmxpY0xpZ2h0aW5nVGF4OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhc2VBbW91bnQgPSB0YXguYmFzZUFtb3VudDsKICAgICAgICAgICAgICAgICAgICBpZiAoYmFzZUFtb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmFzZUFtb3VudC50b0xvd2VyQ2FzZSgpID09PSAiaW5jbHVzaXZlIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5jbHVzaXZlVGF4ICs9IHBhcnNlRmxvYXQocGx0YXggfHwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNUYXggKz0gcGFyc2VGbG9hdChwbHRheCB8fCAwKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5wdWJsaWNMaWdodGluZ1RheC5oYXNPd25Qcm9wZXJ0eSgidGF4VHlwZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRheExpc3QucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB2YWx1ZS5wdWJsaWNMaWdodGluZ1RheC50YXhUeXBlLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IHBsdGF4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHZhbHVlLnB1YmxpY0xpZ2h0aW5nVGF4LnRheFR5cGUuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwbFRheF8gPSB2YWx1ZS5wdWJsaWNMaWdodGluZ1RheCB8fCB7fQogICAgICAgICAgICAgICAgICAgICAgICAvLyB0YXhfWyd0YXhBbW91bnQnXSA9IHBsdGF4CiAgICAgICAgICAgICAgICAgICAgICAgIHBsVGF4X1sndGF4QW1vdW50XyddID0gcGx0YXgKICAgICAgICAgICAgICAgICAgICAgICAgcGxUYXhfWydhbW91bnQnXSA9IHZhbHVlLmFtb3VudCB8fCAwCiAgICAgICAgICAgICAgICAgICAgICAgIHBsVGF4X1snZGlzY291bnQnXSA9IGRpc2NvdW50IHx8IDAKICAgICAgICAgICAgICAgICAgICAgICAgcGxUYXhfWyd0eG5SYXRlJ10gPSB0aGlzLnRyYW5zYWN0aW9uLnR4blJhdGUgfHwgMQogICAgICAgICAgICAgICAgICAgICAgICB0YXhMaXN0RGV0YWlsLnB1c2gocGxUYXhfKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmF0UExUYXggPSBwbFRheF8KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodmFsdWUub3RoZXJUYXgpIHsKICAgICAgICAgICAgICAgICAgICBvdGhlclRheCA9IHRoaXMuYXV0b0NhbGN1bGF0ZVRheCgKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUub3RoZXJUYXgsCiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuYW1vdW50KSAtIGtlbmRvLnBhcnNlRmxvYXQoZGlzY291bnQpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBvdGhlclRheCA9IGtlbmRvLnBhcnNlRmxvYXQob3RoZXJUYXgpCiAgICAgICAgICAgICAgICAgICAgICAgID8ga2VuZG8ucGFyc2VGbG9hdChvdGhlclRheCkKICAgICAgICAgICAgICAgICAgICAgICAgOiAwOwogICAgICAgICAgICAgICAgICAgIHZhbHVlWyJvdGhlclRheEFtb3VudCJdID0gb3RoZXJUYXg7CiAgICAgICAgICAgICAgICAgICAgdmFsdWVbIm90aGVyVGF4RXhjaGFuZ2VBbW91bnQiXSA9CiAgICAgICAgICAgICAgICAgICAgICAgIG90aGVyVGF4ICoga2VuZG8ucGFyc2VGbG9hdCh0aGlzLnRyYW5zYWN0aW9uLnR4blJhdGUpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRheCA9IHZhbHVlLm90aGVyVGF4OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhc2VBbW91bnQgPSB0YXguYmFzZUFtb3VudDsKICAgICAgICAgICAgICAgICAgICBpZiAoYmFzZUFtb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmFzZUFtb3VudC50b0xvd2VyQ2FzZSgpID09PSAiaW5jbHVzaXZlIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5jbHVzaXZlVGF4ICs9IHBhcnNlRmxvYXQob3RoZXJUYXggfHwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNUYXggKz0gcGFyc2VGbG9hdChvdGhlclRheCB8fCAwKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5vdGhlclRheC5oYXNPd25Qcm9wZXJ0eSgidGF4VHlwZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRheExpc3QucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB2YWx1ZS5vdGhlclRheC50YXhUeXBlLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IG90aGVyVGF4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHZhbHVlLm90aGVyVGF4LnRheFR5cGUuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXhfXyA9IHZhbHVlLnNwZWNpZmljVGF4IHx8IHt9CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRheF9fWyd0YXhBbW91bnQnXSA9IG90aGVyVGF4CiAgICAgICAgICAgICAgICAgICAgICAgIHRheF9fWyd0YXhBbW91bnRfJ10gPSBvdGhlclRheAogICAgICAgICAgICAgICAgICAgICAgICB0YXhfX1snYW1vdW50J10gPSB2YWx1ZS5hbW91bnQgfHwgMAogICAgICAgICAgICAgICAgICAgICAgICB0YXhfX1snZGlzY291bnQnXSA9IGRpc2NvdW50IHx8IDAKICAgICAgICAgICAgICAgICAgICAgICAgdGF4X19bJ3R4blJhdGUnXSA9IHRoaXMudHJhbnNhY3Rpb24udHhuUmF0ZSB8fCAxCiAgICAgICAgICAgICAgICAgICAgICAgIHRheExpc3REZXRhaWwucHVzaCh0YXhfXyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhdE90aGVyVGF4ID0gdGF4X18KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHZhbHVlLnZhdFRheCkgewogICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZygnVmF0IFRheCcsIHZhbHVlLnZhdFRheCkKICAgICAgICAgICAgICAgICAgICBsZXQgYW10ID0KICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdChzcFRheCA/IHNwVGF4IDogMCkgKwogICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHBsdGF4ID8gcGx0YXggOiAwKSArCiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQob3RoZXJUYXggPyBvdGhlclRheCA6IDApICsKICAgICAgICAgICAgICAgICAgICAgICAgKGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuYW1vdW50ID8gdmFsdWUuYW1vdW50IDogMCkgLQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGRpc2NvdW50ID8gZGlzY291bnQgOiAwKSk7CiAgICAgICAgICAgICAgICAgICAgdmF0VGF4ID0gdGhpcy5hdXRvQ2FsY3VsYXRlVGF4KHZhbHVlLnZhdFRheCwgYW10KTsKICAgICAgICAgICAgICAgICAgICB2YXRUYXggPSBrZW5kby5wYXJzZUZsb2F0KHZhdFRheCkgPyBrZW5kby5wYXJzZUZsb2F0KHZhdFRheCkgOiAwOwogICAgICAgICAgICAgICAgICAgIHZhbHVlWyJ2YXRUYXhBbW91bnQiXSA9IHZhdFRheDsKICAgICAgICAgICAgICAgICAgICB2YWx1ZVsidmF0VGF4RXhjaGFuZ2VBbW91bnQiXSA9CiAgICAgICAgICAgICAgICAgICAgICAgIHZhdFRheCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy50cmFuc2FjdGlvbi50eG5SYXRlKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXggPSB2YWx1ZS52YXRUYXg7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFzZUFtb3VudCA9IHRheC5iYXNlQW1vdW50OwogICAgICAgICAgICAgICAgICAgIGlmIChiYXNlQW1vdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiYXNlQW1vdW50LnRvTG93ZXJDYXNlKCkgPT09ICJpbmNsdXNpdmUiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNsdXNpdmVUYXggKz0gdmF0VGF4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5jVGF4ICs9IHZhdFRheAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS52YXRUYXguaGFzT3duUHJvcGVydHkoInRheFR5cGUiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXhUeXBlID0gdmFsdWUudmF0VGF4LnRheFR5cGUgfHwge307CiAgICAgICAgICAgICAgICAgICAgICAgIHRheFR5cGVJZCA9IHRheFR5cGUudHlwZUlkIHx8IDA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh0YXhUeXBlSWQgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2l0aGhvbGRpbmdUYXhBbW91bnQgKz0gdmF0VGF4OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUudmF0VGF4Lmhhc093blByb3BlcnR5KCJ0YXhUeXBlIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGF4TGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHZhbHVlLnZhdFRheC50YXhUeXBlLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IHZhdFRheCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB2YWx1ZS52YXRUYXgudGF4VHlwZS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhdFRheF8gPSB2YWx1ZS52YXRUYXggfHwge30KICAgICAgICAgICAgICAgICAgICAgICAgLy8gdmF0VGF4X1sndGF4QW1vdW50J10gPSB2YXRUYXgKICAgICAgICAgICAgICAgICAgICAgICAgdmF0VGF4X1sndGF4QW1vdW50XyddID0gdmF0VGF4CiAgICAgICAgICAgICAgICAgICAgICAgIHZhdFRheF9bJ2Ftb3VudCddID0gdmFsdWUuYW1vdW50IHx8IDAKICAgICAgICAgICAgICAgICAgICAgICAgdmF0VGF4X1snZGlzY291bnQnXSA9IGRpc2NvdW50IHx8IDAKICAgICAgICAgICAgICAgICAgICAgICAgdmF0VGF4X1sndHhuUmF0ZSddID0gdGhpcy50cmFuc2FjdGlvbi50eG5SYXRlIHx8IDEKICAgICAgICAgICAgICAgICAgICAgICAgdmF0VGF4X1snaXNWYXQnXSA9IDEKICAgICAgICAgICAgICAgICAgICAgICAgdmF0VGF4Xy5kZXRhaWwgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGVjaWZpY1RheDogdmF0U3BUYXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWNMaWdodGluZ1RheDogdmF0UExUYXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdGhlclRheDogdmF0T3RoZXJUYXgsCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdGF4TGlzdERldGFpbC5wdXNoKHZhdFRheF8pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRvdGFsVGF4ICs9CiAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdChzcFRheCA/IHNwVGF4IDogMCkgKwogICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQocGx0YXggPyBwbHRheCA6IDApICsKICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KG90aGVyVGF4ID8gb3RoZXJUYXggOiAwKSArCiAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YXRUYXggPyB2YXRUYXggOiAwKTsKICAgICAgICAgICAgICAgIHN1YlRvdGFsICs9CiAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5hbW91bnQpICsgbW9kaWZpZXJQcmljZSAtIGluY1RheDsKICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygnc3ViVG90YWwgJywgc3ViVG90YWwsICcgdmFsdWUuYW1vdW50PScsIHZhbHVlLmFtb3VudCwgJyBtb2RpZmllclByaWNlPScsIG1vZGlmaWVyUHJpY2UpCgogICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IHZhbHVlLml0ZW07CiAgICAgICAgICAgICAgICBjb25zdCBpdG1UeXBlID0gaXRlbS50eXBlIHx8ICIiOwogICAgICAgICAgICAgICAgaWYgKGl0bVR5cGUgPT09ICJWYXJpYW50IikgewogICAgICAgICAgICAgICAgICAgIGl0ZW1TdWJ0b3RhbCArPQogICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmNvc3QpICoga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5xdHkpOwogICAgICAgICAgICAgICAgICAgIGl0ZW1EaXNjb3VudCArPSBrZW5kby5wYXJzZUZsb2F0KGRpc2NvdW50KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRtVHlwZSA9PT0gIlNlcnZpY2UiKSB7CiAgICAgICAgICAgICAgICAgICAgc2VydmljZVN1YnRvdGFsICs9CiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuY29zdCkgKiBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnF0eSk7CiAgICAgICAgICAgICAgICAgICAgaXRlbURpc2NvdW50ICs9IGtlbmRvLnBhcnNlRmxvYXQoZGlzY291bnQpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0eG5JdG1TdWJ0b3RhbCArPQogICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmNvc3QpICoga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5xdHkpOwogICAgICAgICAgICAgICAgICAgIGl0ZW1EaXNjb3VudCArPSBrZW5kby5wYXJzZUZsb2F0KGRpc2NvdW50KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvL2luY2x1ZGUgVGF4IEFtb3VudAogICAgICAgICAgICAgICAgY29uc3QgYW1vdW50Tm9kaXNjb3VudCA9CiAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5jb3N0KSAqIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucXR5KSAtCiAgICAgICAgICAgICAgICAgICAgZGlzY291bnQ7CiAgICAgICAgICAgICAgICBjb25zdCBpbmNsdWRlVGF4QW1vdW50ID0KICAgICAgICAgICAgICAgICAgICBhbW91bnROb2Rpc2NvdW50ICsgdmF0VGF4ICsgcGx0YXggKyBzcFRheCArIG90aGVyVGF4OwogICAgICAgICAgICAgICAgdmFsdWVbImluY2x1ZGVUYXhBbW91bnQiXSA9IGluY2x1ZGVUYXhBbW91bnQ7CiAgICAgICAgICAgICAgICB2YWx1ZVsiaW5jbHVkZVRheEV4Y2hhbmdlQW1vdW50Il0gPQogICAgICAgICAgICAgICAgICAgIGluY2x1ZGVUYXhBbW91bnQgKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMudHJhbnNhY3Rpb24udHhuUmF0ZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLml0ZW1TdWJ0b3RhbCA9IGl0ZW1TdWJ0b3RhbDsKICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5pbmNsdXNpdmVUYXhBbW91bnQgPSBpbmNsdXNpdmVUYXg7CiAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24uZXhjaGFuZ2VJdGVtU3VidG90YWwgPQogICAgICAgICAgICAgICAgaXRlbVN1YnRvdGFsICoga2VuZG8ucGFyc2VGbG9hdCh0aGlzLnRyYW5zYWN0aW9uLnR4blJhdGUpOwogICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLnNlcnZpY2VTdWJ0b3RhbCA9IHNlcnZpY2VTdWJ0b3RhbDsKICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5leGNoYW5nZVNlcnZpY2VTdWJ0b3RhbCA9CiAgICAgICAgICAgICAgICBzZXJ2aWNlU3VidG90YWwgKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMudHJhbnNhY3Rpb24udHhuUmF0ZSk7CiAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24udHhuSXRtU3VidG90YWwgPSB0eG5JdG1TdWJ0b3RhbDsKICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5leGNoYW5nZVR4bkl0bVN1YnRvdGFsID0KICAgICAgICAgICAgICAgIHR4bkl0bVN1YnRvdGFsICoga2VuZG8ucGFyc2VGbG9hdCh0aGlzLnRyYW5zYWN0aW9uLnR4blJhdGUpOwogICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLml0ZW1EaXNjb3VudCA9IGl0ZW1EaXNjb3VudDsKICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5leGNoYW5nZUl0ZW1EaXNjb3VudCA9CiAgICAgICAgICAgICAgICBpdGVtRGlzY291bnQgKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMudHJhbnNhY3Rpb24udHhuUmF0ZSk7CiAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24uc2VydmljZURpc2NvdW50ID0gc2VydmljZURpc2NvdW50OwogICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLmV4Y2hhbmdlU2VydmljZURpc2NvdW50ID0KICAgICAgICAgICAgICAgIHNlcnZpY2VEaXNjb3VudCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy50cmFuc2FjdGlvbi50eG5SYXRlKTsKICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi50eG5JdG1EaXNjb3VudCA9IHR4bkRpc2NvdW50OwogICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLmV4Y2hhbmdlVHhuSXRtRGlzY291bnQgPQogICAgICAgICAgICAgICAgdHhuRGlzY291bnQgKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMudHJhbnNhY3Rpb24udHhuUmF0ZSk7CiAgICAgICAgICAgIGRpc2NvdW50VG90YWwgPSBkaXNjb3VudFRvdGFsID8gZGlzY291bnRUb3RhbCA6IDA7CgogICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coc3BUYXgsIHBsdGF4LCBvdGhlclRheCwgdmF0VGF4KQogICAgICAgICAgICBsZXQgdG90YWwgPQogICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdChzdWJUb3RhbCkgLQogICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdChkaXNjb3VudFRvdGFsKSArCiAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHRvdGFsVGF4KTsKICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5zdWJUb3RhbCA9IHN1YlRvdGFsOwogICAgICAgICAgICAkKCIjc3VidG90YWwiKS50ZXh0KGtlbmRvLnBhcnNlRmxvYXQoc3ViVG90YWwpKTsKICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi53aXRoaG9sZGluZ1RheEFtb3VudCA9IHdpdGhob2xkaW5nVGF4QW1vdW50CiAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24udG90YWxUYXhBbW91bnQgPSBrZW5kby5wYXJzZUZsb2F0KHRvdGFsVGF4KTsKICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5kaXNjb3VudFRvdGFsID0ga2VuZG8ucGFyc2VGbG9hdChkaXNjb3VudFRvdGFsKTsKICAgICAgICAgICAgaWYgKHRoaXMudHJhbnNhY3Rpb24uc3BlY2lmaWNEaXNjb3VudEl0ZW0pIHsKICAgICAgICAgICAgICAgIGRpc2NvdW50SW52b2ljZSA9IHRoaXMuYXV0b0NhbGN1bGF0ZURpc2NvdW50KAogICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24uc3BlY2lmaWNEaXNjb3VudEl0ZW0sCiAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdChzdWJUb3RhbCkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBkaXNjb3VudEludm9pY2UgPSBkaXNjb3VudEludm9pY2UgPyBkaXNjb3VudEludm9pY2UgOiAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIHRoaXMub25PdGhlckNoYXJnZUNoYW5nZSgpCiAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24udG90YWwgPSBrZW5kby5wYXJzZUZsb2F0KHRvdGFsKSAtIGRpc2NvdW50SW52b2ljZSAtIHBhcnNlRmxvYXQod2l0aGhvbGRpbmdUYXhBbW91bnQpOwogICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLmV4Y2hhbmdlQW1vdW50ID0KICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodGhpcy50cmFuc2FjdGlvbi50b3RhbCkgKgogICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh0aGlzLnRyYW5zYWN0aW9uLnR4blJhdGUpOwogICAgICAgICAgICB0aGlzLmF1dG9DYWxjdWxhdGVUYXhCeVR5cGUodGF4TGlzdCk7CiAgICAgICAgICAgIHRoaXMuZGlzY291bnRJdGVtID0gdGhpcy5yZW1vdmVEdXBsaWNhdGUoZGlzY291bnRJdGVtKTsKICAgICAgICAgICAgdGhpcy5zYWxlVW5pdCA9IHRoaXMucmVtb3ZlRHVwbGljYXRlKHNhbGVVbml0KTsKICAgICAgICAgICAgdGhpcy50YXhMaXN0RGV0YWlsID0gdGF4TGlzdERldGFpbAogICAgICAgICAgICB0aGlzLmF1dG9DYWxjdWxhdGVUYXhEZXRhaWwoKTsKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKCdkaXNjb3VudCAnLCB0aGlzLmN1c3RvbWVyRGlzY291bnRJdGVtKQogICAgICAgIH0sCiAgICAgICAgcm93TnVtYmVyVG1wbChkYXRhSXRlbSkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLml0ZW1MaW5lUE9EUy5rZW5kb1dpZGdldCgpLAogICAgICAgICAgICAgICAgaW5kZXggPSBkcy5pbmRleE9mKGRhdGFJdGVtKTsKICAgICAgICAgICAgcmV0dXJuIGluZGV4ICsgMTsKICAgICAgICB9LAogICAgICAgIHZhdFRlbXBsYXRlKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGNvbnN0IHZhdCA9IGRhdGFJdGVtLnZhdFRheDsKICAgICAgICAgICAgaWYgKHZhdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGA8c3Bhbj4ke3ZhdC5kZWZhdWx0VGF4ID8gdmF0LmRlZmF1bHRUYXggOiBgYH08L3NwYW4+YDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBgYDsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaXRlbVRlbXBsYXRlKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBkYXRhSXRlbS5pdGVtOwogICAgICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGA8c3Bhbj4ke2l0ZW0ubmFtZSA/IGl0ZW0ubmFtZSA6IGBgfTwvc3Bhbj5gOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGBgOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBVT01UZW1wbGF0ZShkYXRhSXRlbSkgewogICAgICAgICAgICBjb25zdCB1b20gPSBkYXRhSXRlbS51b207CiAgICAgICAgICAgIGlmICh1b20pIHsKICAgICAgICAgICAgICAgIHJldHVybiBgPHNwYW4+JHt1b20udW9tID8gdW9tLnVvbS5uYW1lIDogYGB9PC9zcGFuPmA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYGA7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHNhbGVVbml0VGVtcGxhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3Qgc2FsZVVuaXQgPSBkYXRhSXRlbS5zYWxlVW5pdDsKICAgICAgICAgICAgaWYgKHNhbGVVbml0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYDxzcGFuPiR7c2FsZVVuaXQubmFtZSA/IHNhbGVVbml0Lm5hbWUgOiBgYH08L3NwYW4+YDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBgYDsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZGlzY291bnRJdGVtVGVtcGxhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3QgZGlzY291bnRJdGVtID0gZGF0YUl0ZW0uZGlzY291bnRJdGVtOwogICAgICAgICAgICBpZiAoZGlzY291bnRJdGVtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYDxzcGFuPiR7ZGlzY291bnRJdGVtLmNvZGUgPyBkaXNjb3VudEl0ZW0uY29kZSA6IGBgfSAtICR7CiAgICAgICAgICAgICAgICAgICAgZGlzY291bnRJdGVtLm5hbWUgPyBkaXNjb3VudEl0ZW0ubmFtZSA6IGBgCiAgICAgICAgICAgICAgICB9PC9zcGFuPmA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYGA7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIFNlcnZpY2VEYXRlRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IHJlcXVpcmVkIG5hbWU9IicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvRGF0ZVBpY2tlcigpOwoKICAgICAgICAgICAgLy8gbGV0IGRzID0gdGhpcy4kcmVmcy5pdGVtTGluZURTLmtlbmRvV2lkZ2V0KCkKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKGRzLmRhdGEoKSkKICAgICAgICAgICAgLy8gLy8gY29uc3QgZGF0ZVN0cmluZyA9IGtlbmRvLnRvU3RyaW5nKChuZXcgRGF0ZShvcHRpb25zLm1vZGVsLml0ZW1zLnNlcnZpY2VEYXRlKSksIHRoaXMuaXRlbUxpbmUuZGF0ZUZvcm1hdCkKICAgICAgICAgICAgLy8gLy8gY29uc3QgZGF0ZVN0cmluZyA9IGtlbmRvLnRvU3RyaW5nKG9wdGlvbnMubW9kZWwuaXRlbXMuc2VydmljZURhdGUpCiAgICAgICAgICAgIC8vIGNvbnN0ICRpbnB1dCA9ICQoIjxpbnB1dCB2YWx1ZT0iICsgb3B0aW9ucy5tb2RlbC5zZXJ2aWNlRGF0ZSArICIgLz4iKS5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgIC8vICRpbnB1dC5rZW5kb0RhdGVQaWNrZXIoKQogICAgICAgICAgICAvLyAvLyAkaW5wdXQuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAvLyAvLyBvcHRpb25zLm1vZGVsLml0ZW1zLnNlcnZpY2VEYXRlID0gZGF0ZVN0cmluZwogICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coJGlucHV0KQogICAgICAgIH0sCiAgICAgICAgU2VydmljZURhdGVUb0VkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCByZXF1aXJlZCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0RhdGVQaWNrZXIoKTsKICAgICAgICB9LAogICAgICAgIEl0ZW1Ecm9wRG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCByZXF1aXJlZCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogImNvbnRhaW5zIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVGV4dEZpZWxkOiAibmFtZSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlRmllbGQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgaGVhZGVyVGVtcGxhdGU6ICIiLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAiPHNwYW4+Iz1uYW1lIzwvc3Bhbj4iLAogICAgICAgICAgICAgICAgICAgIG9wdGlvbkxhYmVsOiAiLS0tIFNlbGVjdCAtLS0iLAogICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IG5ldyBrZW5kby5kYXRhLkRhdGFTb3VyY2UoewogICAgICAgICAgICAgICAgICAgICAgICBzZXJ2ZXJGaWx0ZXJpbmc6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zcG9ydDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogcHJvZHVjdFZhcmlhbnRIYW5kbGVyLml0ZW1TZWFyY2hVUkwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogImpzb24iLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBzY2hlbWE6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBza3U6IHt0eXBlOiAic3RyaW5nIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGEuY291bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAvLyBkYXRhOiB0aGlzLnZhcmlhbnRzCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIFVPTURyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IG5hbWU9IicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgICAgICAgICAgICBhdXRvQmluZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiAic3RhcnRzd2l0aCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogInVvbS5uYW1lIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogInVvbS5pZCIsCiAgICAgICAgICAgICAgICAgICAgY2FzY2FkZUZyb206ICJpdGVtIiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9dW9tLm5hbWUjPC9zcGFuPiIsCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6ICItLS0gU2VsZWN0IC0tLSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZTogbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZlckZpbHRlcmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNwb3J0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB1b21QcmljZUhhbmRsZXIudW9tUHJpY2VCeVByaWNlTGV2ZWxVUkwoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpZD0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5tb2RlbC5pdGVtLmlkICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiZwbElkPSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLnByaWNlTGV2ZWwuaWQgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiJmRhdGU9IiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24udHJhbnNhY3Rpb25EYXRlICsgIiZuYXR1cmU9cHVyY2hhc2UiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogImpzb24iLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBzY2hlbWE6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBuYW1lOiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBza3U6IHt0eXBlOiAic3RyaW5nIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGEuY291bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAvLyBkYXRhOiB0aGlzLnZhcmlhbnRzCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIERpc2NvdW50SXRlbURyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IG5hbWU9IicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgICAgICAgICAgICBhdXRvQmluZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiAic3RhcnRzd2l0aCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogIm5hbWUiLAogICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZUZpZWxkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgIGNhc2NhZGVGcm9tOiAiaXRlbSIsCiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICI8c3Bhbj4jPWNvZGUjIC0gIz1uYW1lIzwvc3Bhbj4iLAogICAgICAgICAgICAgICAgICAgIG9wdGlvbkxhYmVsOiAiLS0tIFNlbGVjdCAtLS0iLAogICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IG5ldyBrZW5kby5kYXRhLkRhdGFTb3VyY2UoewogICAgICAgICAgICAgICAgICAgICAgICBzZXJ2ZXJGaWx0ZXJpbmc6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zcG9ydDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogZGlzY291bnRJdGVtSGFuZGxlci5nZXRVUkwoRElTQ09VTlRfVFlQRSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDoge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbmFtZToge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2t1OiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhLmNvdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgUHVibGljTGlnaHRpbmdUYXhEcm9wRG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogInN0YXJ0c3dpdGgiLAogICAgICAgICAgICAgICAgICAgIGRhdGFUZXh0RmllbGQ6ICJkZWZhdWx0VGF4IiwKICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogImlkIiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9ZGVmYXVsdFRheCM8L3NwYW4+IiwKICAgICAgICAgICAgICAgICAgICBvcHRpb25MYWJlbDogIi0tLSBTZWxlY3QgLS0tIiwKICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlOiBuZXcga2VuZG8uZGF0YS5EYXRhU291cmNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogdGhpcy5wdWJsaWNMaWdodGluZ1RheC5maWx0ZXIoKG0pID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLm1vZGVsLmhhc093blByb3BlcnR5KCJ2YXRUYXgiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhdCA9IG9wdGlvbnMubW9kZWwudmF0VGF4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5tb2RlbC52YXRUYXggIT09IG51bGwgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubW9kZWwudmF0VGF4ICE9PSAibnVsbCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5tb2RlbC52YXRUYXguYmFzZUFtb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0uYmFzZUFtb3VudC50b0xvd2VyQ2FzZSgpID09PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm1vZGVsLnZhdFRheC5iYXNlQW1vdW50LnRvTG93ZXJDYXNlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIE90aGVyVGF4RHJvcERvd25FZGl0b3IoY29udGFpbmVyLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAualF1ZXJ5KCc8aW5wdXQgbmFtZT0iJyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgICAgICAua2VuZG9Ecm9wRG93bkxpc3QoewogICAgICAgICAgICAgICAgICAgIGF1dG9CaW5kOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGF1dG9XaWR0aDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDQwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXI6ICJzdGFydHN3aXRoIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVGV4dEZpZWxkOiAiZGVmYXVsdFRheCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlRmllbGQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICI8c3Bhbj4jPWRlZmF1bHRUYXgjPC9zcGFuPiIsCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6ICItLS0gU2VsZWN0IC0tLSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZTogbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHRoaXMub3RoZXJUYXguZmlsdGVyKChtKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5tb2RlbC5oYXNPd25Qcm9wZXJ0eSgidmF0VGF4IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YXQgPSBvcHRpb25zLm1vZGVsLnZhdFRheDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmF0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubW9kZWwudmF0VGF4ICE9PSBudWxsICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm1vZGVsLnZhdFRheCAhPT0gIm51bGwiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMubW9kZWwudmF0VGF4LmJhc2VBbW91bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLmJhc2VBbW91bnQudG9Mb3dlckNhc2UoKSA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5tb2RlbC52YXRUYXguYmFzZUFtb3VudC50b0xvd2VyQ2FzZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBWYXRUYXhEcm9wRG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogInN0YXJ0c3dpdGgiLAogICAgICAgICAgICAgICAgICAgIGRhdGFUZXh0RmllbGQ6ICJkZWZhdWx0VGF4IiwKICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogImlkIiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9ZGVmYXVsdFRheCM8L3NwYW4+IiwKICAgICAgICAgICAgICAgICAgICBvcHRpb25MYWJlbDogIi0tU2VsZWN0LS0iLAogICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IG5ldyBrZW5kby5kYXRhLkRhdGFTb3VyY2UoewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLnZhdFRheCwKICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgU2FsZVVuaXREcm9wRG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogInN0YXJ0c3dpdGgiLAogICAgICAgICAgICAgICAgICAgIGRhdGFUZXh0RmllbGQ6ICJuYW1lIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogImlkIiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9Y29kZSMgLSAjPW5hbWUjPC9zcGFuPiIsCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6ICItLS0gU2VsZWN0IC0tLSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZTogbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHRoaXMuc2FsZVVuaXRJdGVtTGlzdCwKICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgRW1wbG95ZWVEcm9wRG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBkYXRhLWJpbmQ9InZhbHVlOicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvTXVsdGlTZWxlY3QoewogICAgICAgICAgICAgICAgICAgIGF1dG9CaW5kOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGF1dG9XaWR0aDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDQwMCwKICAgICAgICAgICAgICAgICAgICBzdWdnZXN0OiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogImNvbnRhaW5zIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVGV4dEZpZWxkOiAibmFtZSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlRmllbGQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgaGVhZGVyVGVtcGxhdGU6CiAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJkcm9wZG93bi1oZWFkZXIgay13aWRnZXQgay1oZWFkZXIiPicgKwogICAgICAgICAgICAgICAgICAgICAgICAiPHNwYW4+RW1wbG95ZWUgPC9zcGFuPiIgKwogICAgICAgICAgICAgICAgICAgICAgICAiPHNwYW4+PC9zcGFuPiIgKwogICAgICAgICAgICAgICAgICAgICAgICAiPC9kaXY+IiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9bmFtZSM8L3NwYW4+IiwKICAgICAgICAgICAgICAgICAgICBvcHRpb25MYWJlbDogIi0tLSBTZWxlY3QgLS0tIiwKICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlOiBuZXcga2VuZG8uZGF0YS5EYXRhU291cmNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyRmlsdGVyaW5nOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc3BvcnQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGVtcGxveWVlSGFuZGxlci5zZWFyY2hVUkwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogImpzb24iLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBzY2hlbWE6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdE5hbWU6IHt0eXBlOiAic3RyaW5nIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3ROYW1lOiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhLmNvdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgZW1wSW1wbChkYXRhSXRlbSkgewogICAgICAgICAgICBsZXQgZW1wSWRzID0gW107CiAgICAgICAgICAgIGRhdGFJdGVtLmVtcGxveWVlLmZvckVhY2goKG0pID0+IHsKICAgICAgICAgICAgICAgIGVtcElkcy5wdXNoKG0uZmlyc3ROYW1lICsgIiAtICIgKyBtLmxhc3ROYW1lKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyhlbXBJZHMuam9pbignLCAnKSkKICAgICAgICAgICAgcmV0dXJuIGA8c3Bhbj4ke2VtcElkcy5qb2luKCIsICIpfTwvc3Bhbj5gOwogICAgICAgIH0sCiAgICAgICAgcmVtb3ZlUm93KGUpIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBjb25zdCBncmlkID0ga2VuZG8ualF1ZXJ5KCIjZ3JpZEl0ZW1MaW5lIikuZGF0YSgia2VuZG9HcmlkIiksCiAgICAgICAgICAgICAgICBkYXRhU291cmNlID0gZ3JpZC5kYXRhU291cmNlLAogICAgICAgICAgICAgICAgZGF0YUl0ZW0gPSBncmlkLmRhdGFJdGVtKCQoZS5jdXJyZW50VGFyZ2V0KS5jbG9zZXN0KCJ0ciIpKTsKCiAgICAgICAgICAgIGlmIChkYXRhU291cmNlLnRvdGFsKCkgPiAxKSB7CiAgICAgICAgICAgICAgICBkYXRhU291cmNlLnJlbW92ZShkYXRhSXRlbSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGVycm9yTWVzc2FnZSgpIHsKICAgICAgICB9LAogICAgICAgIC8vY2F0YWxvZwogICAgICAgIGxvYWRJbWFnZShkYXRhSXRlbSkgewogICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaGFzT3duUHJvcGVydHkoImltYWdlcyIpKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaW1hZ2VzLmhhc093blByb3BlcnR5KCJkZWZhdWx0IikpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB1cmwgPSB0aGlzLmltZ1VSTCArIGRhdGFJdGVtLmltYWdlcy5kZWZhdWx0LnRodW1iOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgICI8aW1nIHdpZHRoPSc1MCcgaGVpZ2h0PSc1MCcgc3R5bGU9ICdtYXJnaW46IGF1dG87ZGlzcGxheTogYmxvY2s7JyBzcmM9JyIgKwogICAgICAgICAgICAgICAgICAgICAgICB1cmwgKwogICAgICAgICAgICAgICAgICAgICAgICAiJyAvPiIKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkQ2F0YWxvZ3MoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGNhdGFsb2dIYW5kbGVyLmdldCgpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2F0YWxvZ3MgPSByZXM7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYWRkQ2F0YWxvZyhlKSB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgbGV0IGdyaWQgPSBrZW5kby5qUXVlcnkoIiNncmlkQ2F0YWxvZyIpLmRhdGEoImtlbmRvR3JpZCIpOwogICAgICAgICAgICBsZXQgZGF0YUl0ZW0gPSBncmlkLmRhdGFJdGVtKCQoZS5jdXJyZW50VGFyZ2V0KS5jbG9zZXN0KCJ0ciIpKTsKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKGRhdGFJdGVtKQogICAgICAgICAgICBpZiAoZGF0YUl0ZW0udmFyaWFudHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgZGF0YUl0ZW0udmFyaWFudHMuZm9yRWFjaCgobSkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChtLmhhc093blByb3BlcnR5KCJ2YXJpYW50IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG0udmFyaWFudC5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkU2luZ2xlSXRlbShtLnZhcmlhbnQuaWQsICJpIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHRoaXMuZGlhbG9nQ2F0YWxvZyA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChkYXRhSXRlbS5zZXJ2aWNlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBkYXRhSXRlbS5zZXJ2aWNlcy5mb3JFYWNoKChtKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG0uaGFzT3duUHJvcGVydHkoInNlcnZpY2UiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAobS5zZXJ2aWNlLmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRTaW5nbGVJdGVtKG0uc2VydmljZS5pZCwgInMiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy5kaWFsb2dDYXRhbG9nID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRTaW5nbGVJdGVtKGl0ZW1JZCwgdHlwZSkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHByb2R1Y3RIYW5kbGVyLmdldE9uZShpdGVtSWQpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkYXRhID0gcmVzOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLml0ZW1MaW5lUE9EUy5rZW5kb1dpZGdldCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWwgPSBkcy50b3RhbCgpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1MaW5lLmlkID0gdHJhbnNhY3Rpb25QcmVmaXggKyB1dWlkLnYxKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbUxpbmUuaXRlbSA9IGRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09ICJpIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtTGluZS5kZXNjcmlwdGlvbiA9IGRhdGEudmFyaWFudC5zYWxlRGVzY3JpcHRpb247CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1MaW5lLmRlc2NyaXB0aW9uID0gZGF0YS5zYWxlRGVzY3JpcHRpb247CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZHMuaW5zZXJ0KHRvdGFsLCB0aGlzLml0ZW1MaW5lKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sIDUwMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgb25FbXBsb3llZUNoYW5nZWQoZXZlbnQpIHsKICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBldmVudC52YWx1ZTsKICAgICAgICAgICAgaWYgKHZhbHVlICYmIHZhbHVlW3RleHRGaWVsZF0gPT09IGVtcHR5SXRlbVt0ZXh0RmllbGRdKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5tRW1wbG95ZWUgPSB2YWx1ZTsKICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5lbXBsb3llZSA9IHZhbHVlOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZEVtcGxveWVlQ2VudGVyKCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVtcGxveWVlcyA9IFtdOwogICAgICAgICAgICAgICAgICAgIGVtcGxveWVlSGFuZGxlcgogICAgICAgICAgICAgICAgICAgICAgICAuY2VudGVyKHVuZGVmaW5lZCkKICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW1wbG95ZWVzID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiAodGhpcy5lbXBsb3llZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICB0aGlzLnRyYW5zYWN0aW9uLmVtcGxveWVlID0gdGhpcy5lbXBsb3llZXNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKTsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgb25FbXBsb3llZUZpbHRlckNoYW5nZWQoKSB7CiAgICAgICAgfSwKICAgICAgICBudW1iZXJGb3JtYXQodmFsdWUpIHsKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKHRoaXMuc2FsZUZvcm1Db250ZW50LmRlY2ltYWwsJ25pbW9sJykKICAgICAgICAgICAgcmV0dXJuIGtlbmRvLnRvU3RyaW5nKHZhbHVlLCBgbiR7dGhpcy5wdXJjaGFzZUZvcm1Db250ZW50LmRlY2ltYWx9YCk7CiAgICAgICAgICAgIC8vIHJldHVybiB2YWx1ZQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFR4bigpIHsKICAgICAgICAgICAgaWYgKHRoaXMuc2FsZU9yZGVyLmN1c3RvbWVyKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMucXVvdGVzID0gW107CiAgICAgICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogImJ5X2N1c3RvbWVyIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbWVyOiB0aGlzLnRyYW5zYWN0aW9uLnN1cHBsaWVyLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIlNhbGUgT3JkZXIiLAogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbkhhbmRsZXIuc2VhcmNoKGRhdGEpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50eG5Ub2JlQWRkID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHJlbW92ZUVtcHR5TGluZSgpIHsKICAgICAgICAgICAgY29uc3QgZ3JpZCA9IGtlbmRvLmpRdWVyeSgiI2dyaWRJdGVtTGluZSIpLmRhdGEoImtlbmRvR3JpZCIpLAogICAgICAgICAgICAgICAgZGF0YVNvdXJjZSA9IGdyaWQuZGF0YVNvdXJjZTsKICAgICAgICAgICAgZGF0YVNvdXJjZS5kYXRhKCkuZm9yRWFjaCgobSkgPT4gewogICAgICAgICAgICAgICAgaWYgKG0uaXRlbS5pZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZS5yZW1vdmUobSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgLy9zYXZlCiAgICAgICAgY2xlYXIoKSB7CgogICAgICAgIH0sCiAgICAgICAgY2xvc2UoZGF0YSkgewogICAgICAgICAgICAvLyBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgLy8gICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgLy8gICAgICAgICBuYW1lOiAiUHVyY2hhc2VPcmRlciIsCiAgICAgICAgICAgIC8vICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgIC8vICAgICAgICAgfQogICAgICAgICAgICAvLyAgICAgfSkKICAgICAgICAgICAgLy8gfSBlbHNlIHsKICAgICAgICAgICAgd2luZG93Lmhpc3RvcnkuZ28oLTEpOwogICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhkYXRhLCAiY2xvc2UiKTsKICAgICAgICAgICAgLy8gbG9jYWxTdG9yYWdlLmRhdGEuaWQgPSBKU09OLnN0cmluZ2lmeShkYXRhKQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFB1cmNoYXNlKCkgewogICAgICAgICAgICBpZiAodGhpcy50cmFuc2FjdGlvbi5zdXBwbGllcikgewogICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogImJ5X3N1cHBsaWVyIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1cHBsaWVyOiB0aGlzLnRyYW5zYWN0aW9uLnN1cHBsaWVyLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIlB1cmNoYXNlIE9yZGVyIiwKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25IYW5kbGVyLnNlYXJjaChkYXRhKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhyZXMsICJzZWFyY2ggYnkgc3VwcGxpZXIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHNhdmVDbG9zZSgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLiRyZWZzLmZvcm0udmFsaWRhdGUoKSkgewogICAgICAgICAgICAgICAgdGhpcy4kcmVmcy5mb3JtLnZhbGlkYXRlKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IGlkID0gIiI7CiAgICAgICAgICAgIGlmICh0aGlzLnN1cHBsaWVyLmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICBpZCA9IHRoaXMuc3VwcGxpZXIuaWQgfHwgIiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGlkID09PSAiIikgewogICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcigic3VwcGxpZXIgaXMgcmVxdWlyZSIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuaXRlbUxpbmVQT0RTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgIGxldCBkMSA9IGRzLmRhdGEoKTsKICAgICAgICAgICAgbGV0IGRhdGFWYWxpZGF0ZSA9IDA7CiAgICAgICAgICAgIGQxLmZvckVhY2goKHZhbHVlLCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgIHZhbHVlLml0ZW0uaWQgPT0gdW5kZWZpbmVkIHx8CiAgICAgICAgICAgICAgICAgICAgdmFsdWUudW9tLnVvbS5pZCA9PSB1bmRlZmluZWQgfHwKICAgICAgICAgICAgICAgICAgICB2YWx1ZS5pdGVtLmlkID09ICIiIHx8CiAgICAgICAgICAgICAgICAgICAgdmFsdWUudW9tLnVvbS5pZCA9PSAiIgogICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcigKICAgICAgICAgICAgICAgICAgICAgICAgIlBsZWFzZSBjaGVjayBJdGVtIG9yIFVvbSAgb24gcm93ICIgKyAoaW5kZXggKyAxKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGRhdGFWYWxpZGF0ZSArPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKGQxLmxlbmd0aCA9PSBkYXRhVmFsaWRhdGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuaXNTYXZlQ2xvc2UgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5zYXZlT3B0aW9uID0gInNhdmVDbG9zZSI7CiAgICAgICAgICAgICAgICB0aGlzLnNhdmUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc2F2ZVByaW50KCkgewogICAgICAgICAgICBpZiAoIXRoaXMuJHJlZnMuZm9ybS52YWxpZGF0ZSgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRyZWZzLmZvcm0udmFsaWRhdGUoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgaWQgPSAiIjsKICAgICAgICAgICAgaWYgKHRoaXMuc3VwcGxpZXIuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgIGlkID0gdGhpcy5zdXBwbGllci5pZCB8fCAiIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaWQgPT09ICIiKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LmVycm9yKCJzdXBwbGllciBpcyByZXF1aXJlIik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5pdGVtTGluZVBPRFMua2VuZG9XaWRnZXQoKTsKICAgICAgICAgICAgbGV0IGQxID0gZHMuZGF0YSgpOwogICAgICAgICAgICBsZXQgZGF0YVZhbGlkYXRlID0gMDsKICAgICAgICAgICAgZDEuZm9yRWFjaCgodmFsdWUsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgdmFsdWUuaXRlbS5pZCA9PSB1bmRlZmluZWQgfHwKICAgICAgICAgICAgICAgICAgICB2YWx1ZS51b20uaWQgPT0gdW5kZWZpbmVkIHx8CiAgICAgICAgICAgICAgICAgICAgdmFsdWUuaXRlbS5pZCA9PSAiIiB8fAogICAgICAgICAgICAgICAgICAgIHZhbHVlLnVvbS5pZCA9PSAiIgogICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcigKICAgICAgICAgICAgICAgICAgICAgICAgIlBsZWFzZSBjaGVjayBJdGVtIG9yIFVvbSAgb24gcm93ICIgKyAoaW5kZXggKyAxKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGRhdGFWYWxpZGF0ZSArPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKGQxLmxlbmd0aCA9PSBkYXRhVmFsaWRhdGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuaXNTYXZlUHJpbnQgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5zYXZlT3B0aW9uID0gInNhdmVQcmludCI7CiAgICAgICAgICAgICAgICB0aGlzLnNhdmUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc2F2ZU5ldygpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLiRyZWZzLmZvcm0udmFsaWRhdGUoKSkgewogICAgICAgICAgICAgICAgdGhpcy4kcmVmcy5mb3JtLnZhbGlkYXRlKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IGlkID0gIiI7CiAgICAgICAgICAgIGlmICh0aGlzLnN1cHBsaWVyLmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICBpZCA9IHRoaXMuc3VwcGxpZXIuaWQgfHwgIiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGlkID09PSAiIikgewogICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcigic3VwcGxpZXIgaXMgcmVxdWlyZSIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuaXRlbUxpbmVQT0RTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgIGxldCBkMSA9IGRzLmRhdGEoKTsKICAgICAgICAgICAgbGV0IGRhdGFWYWxpZGF0ZSA9IDA7CiAgICAgICAgICAgIGQxLmZvckVhY2goKHZhbHVlLCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgIHZhbHVlLml0ZW0uaWQgPT0gdW5kZWZpbmVkIHx8CiAgICAgICAgICAgICAgICAgICAgdmFsdWUuaXRlbS5pZCA9PSAiIiB8fAogICAgICAgICAgICAgICAgICAgIHZhbHVlLnVvbS51b20gPT0gdW5kZWZpbmVkCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LmVycm9yKAogICAgICAgICAgICAgICAgICAgICAgICAiUGxlYXNlIGNoZWNrIEl0ZW0gb3IgVW9tICBvbiByb3cgIiArIChpbmRleCArIDEpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbGlkYXRlICs9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAoZDEubGVuZ3RoID09IGRhdGFWYWxpZGF0ZSkgewogICAgICAgICAgICAgICAgdGhpcy5zYXZlT3B0aW9uID0gInNhdmVOZXciOwogICAgICAgICAgICAgICAgdGhpcy5pc1NhdmVOZXcgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5zYXZlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGNhbmNlbCgpIHsKICAgICAgICAgICAgdGhpcy4kc3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogaTE4bi50KCJtc2dfdGl0bGVfd2FybmluZyIpLAogICAgICAgICAgICAgICAgdGV4dDogaTE4bi50KCJtc2dfZGlzY2FyZCIpLAogICAgICAgICAgICAgICAgaWNvbjogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IGkxOG4udCgiY2FuY2VsIiksCiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjNGQ0ODQ4IiwKICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI0VEMUEzQSIsCiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogaTE4bi50KCJkaXNjYXJkIiksCiAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdENlbikgPT4gewogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlc3VsdENlbik7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0Q2VuLnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLmdvKC0xKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBzYXZlRHJhZnQoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy4kcmVmcy5mb3JtLnZhbGlkYXRlKCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuJHJlZnMuZm9ybS52YWxpZGF0ZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCBpZCA9ICIiOwogICAgICAgICAgICBpZiAodGhpcy5zdXBwbGllci5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgaWQgPSB0aGlzLnN1cHBsaWVyLmlkIHx8ICIiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpZCA9PT0gIiIpIHsKICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoInN1cHBsaWVyIGlzIHJlcXVpcmUiKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLml0ZW1MaW5lUE9EUy5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICBsZXQgZDEgPSBkcy5kYXRhKCk7CiAgICAgICAgICAgIGxldCBkYXRhVmFsaWRhdGUgPSAwOwogICAgICAgICAgICBkMS5mb3JFYWNoKCh2YWx1ZSwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICB2YWx1ZS5pdGVtLmlkID09IHVuZGVmaW5lZCB8fAogICAgICAgICAgICAgICAgICAgIHZhbHVlLnVvbS5pZCA9PSB1bmRlZmluZWQgfHwKICAgICAgICAgICAgICAgICAgICB2YWx1ZS5pdGVtLmlkID09ICIiIHx8CiAgICAgICAgICAgICAgICAgICAgdmFsdWUudW9tLmlkID09ICIiCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LmVycm9yKAogICAgICAgICAgICAgICAgICAgICAgICAiUGxlYXNlIGNoZWNrIEl0ZW0gb3IgVW9tICBvbiByb3cgIiArIChpbmRleCArIDEpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbGlkYXRlICs9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAoZDEubGVuZ3RoID09IGRhdGFWYWxpZGF0ZSkgewogICAgICAgICAgICAgICAgdGhpcy5zYXZlT3B0aW9uID0gInNhdmVEcmFmdCI7CiAgICAgICAgICAgICAgICB0aGlzLmlzU2F2ZURyYWZ0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuc2F2ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhc3luYyBzYXZlKCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUVtcHR5TGluZSgpOwogICAgICAgICAgICAgICAgICAgIGxldCBpdGVtTGluZURTID0gdGhpcy4kcmVmcy5pdGVtTGluZVBPRFMua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgdG90YWwgPSBpdGVtTGluZURTLnRvdGFsKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRvdGFsIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcigiRmllbGQgUmVxdWlyZWQhIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YVJvdyA9IGl0ZW1MaW5lRFMKICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGEoKQogICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChvKSA9PiBvLmFtb3VudCA+IDApCiAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKG4pID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSXRlbUxpbmVNb2RlbChuKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgbGV0IHR4bkxpc3QgPSBbXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsZWFkID0gdGhpcy50cmFuc2FjdGlvbi5sZWFkIHx8IHt9CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGVhZElkID0gbGVhZC5pZCB8fCAnJwogICAgICAgICAgICAgICAgICAgIGlmIChsZWFkSWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHhuTGlzdC5wdXNoKGxlYWQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRoaXMudHJhbnNhY3Rpb24uaWQgPyB0aGlzLnRyYW5zYWN0aW9uLmlkIDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJQdXJjaGFzZSBPcmRlciIsCiAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlcjogdGhpcy50cmFuc2FjdGlvbi5udW1iZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIGFiYnI6IHRoaXMudHJhbnNhY3Rpb24udHJhbnNhY3Rpb25UeXBlLmFiYnIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogdGhpcy50cmFuc2FjdGlvbi50cmFuc2FjdGlvbkRhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkaXR5RGF0ZTogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRoT2Y6IHRoaXMudHJhbnNhY3Rpb24ubW9udGhPZiwKICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tZXI6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBwYXltZW50VGVybTogdGhpcy50cmFuc2FjdGlvbi5wYXltZW50VGVybSwKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25UeXBlOiB0aGlzLnRyYW5zYWN0aW9uLnRyYW5zYWN0aW9uVHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgZGlzY291bnRQcm9tb3Rpb246IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBwcmljZUxldmVsOiB0aGlzLnRyYW5zYWN0aW9uLnByaWNlTGV2ZWwsCiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1MaW5lczogZGF0YVJvdywKICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdDogdGhpcy50cmFuc2FjdGlvbi5wcm9qZWN0IHx8IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50OiB0aGlzLnRyYW5zYWN0aW9uLnNlZ21lbnQgPyB0aGlzLnRyYW5zYWN0aW9uLnNlZ21lbnQgOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IHRoaXMudHJhbnNhY3Rpb24ubG9jYXRpb24gPyB0aGlzLnRyYW5zYWN0aW9uLmxvY2F0aW9uIDoge30sCiAgICAgICAgICAgICAgICAgICAgICAgIHNhbGVDaGFubmVsOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgYmlsbGluZ0FkZHJlc3M6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBkZWxpdmVyeUFkZHJlc3M6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBkZWxpdmVyeURhdGVUaW1lOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25Ob3RlOiB0aGlzLnRyYW5zYWN0aW9uLnRyYW5zYWN0aW9uTm90ZSwKICAgICAgICAgICAgICAgICAgICAgICAgc3ViVG90YWw6IHRoaXMudHJhbnNhY3Rpb24uc3ViVG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiB0aGlzLnRyYW5zYWN0aW9uLnRvdGFsID8gdGhpcy50cmFuc2FjdGlvbi50b3RhbCA6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50VG90YWw6IHRoaXMudHJhbnNhY3Rpb24uZGlzY291bnRUb3RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQ6IHRoaXMudHJhbnNhY3Rpb24uZXhjaGFuZ2VBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgIHNwZWNpZmljRGlzY291bnRUb3RhbDogdGhpcy50cmFuc2FjdGlvbi5zcGVjaWZpY0Rpc2NvdW50VG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGl2ZXJ5RmVlOiB0aGlzLnRyYW5zYWN0aW9uLmRlbGl2ZXJ5RmVlLAogICAgICAgICAgICAgICAgICAgICAgICB0b3RhbFRheEFtb3VudDogdGhpcy50cmFuc2FjdGlvbi50b3RhbFRheEFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEJhbGFuY2U6IHRoaXMudHJhbnNhY3Rpb24uY3VycmVudEJhbGFuY2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGJhbGFuY2U6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWRpdExpbWl0OiAwLAogICAgICAgICAgICAgICAgICAgICAgICBzYXZlT3B0aW9uOiB0aGlzLnNhdmVPcHRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIHR4blJhdGU6IHRoaXMudHJhbnNhY3Rpb24udHhuUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgcmF0ZTogdGhpcy50cmFuc2FjdGlvbi50eG5SYXRlLAogICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IDEsIC8vMSBvcGVuLCAwIHVzZWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGFwcHJvdmVkQnk6IHRoaXMudHJhbnNhY3Rpb24uYXBwcm92ZWRCeSwKICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0ZWRCeToge30sCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1UZW1wbGF0ZTogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHNwZWNpZmljRGlzY291bnRJdGVtOiB0aGlzLnRyYW5zYWN0aW9uLnNwZWNpZmljRGlzY291bnRJdGVtLAogICAgICAgICAgICAgICAgICAgICAgICBvdGhlckNoYXJnZTogW10sCiAgICAgICAgICAgICAgICAgICAgICAgIG90aGVyQ2hhcmdlQW1vdW50OiAwLAogICAgICAgICAgICAgICAgICAgICAgICB0YXhMaXN0VG90YWw6IHRoaXMudGF4TGlzdFRvdGFsLAogICAgICAgICAgICAgICAgICAgICAgICBwcm9ncmVzc2luZ1N0YXR1czogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbWVyU2FsZVVuaXQ6IHRoaXMuY3VzdG9tZXJTYWxlVW5pdCwKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VkVXNlcjogdGhpcy5sb2dnZWRVc2VyLAogICAgICAgICAgICAgICAgICAgICAgICB0eG5MaXN0OiB0eG5MaXN0LAogICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWNMaW5rOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgdXNlZERhdGVBdDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRBdDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZWQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnN1YnN0cigwLCAxMCksCiAgICAgICAgICAgICAgICAgICAgICAgIHNhbGVPcmRlclR5cGU6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGVtcGxveWVlOiB0aGlzLnRyYW5zYWN0aW9uLmVtcGxveWVlLAogICAgICAgICAgICAgICAgICAgICAgICBzdXBwbGllcjogdGhpcy50cmFuc2FjdGlvbi5zdXBwbGllciwKICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VSYXRlOiB0aGlzLnRyYW5zYWN0aW9uLmV4Y2hhbmdlUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgZm9ybTogMSwKICAgICAgICAgICAgICAgICAgICAgICAgbGVhZDoge30sCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZkZyb206IHRoaXMudHJhbnNhY3Rpb24ucmVmRnJvbSB8fCBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgcmVmVG86IHRoaXMudHJhbnNhY3Rpb24ucmVmVG8gfHwgW10sCiAgICAgICAgICAgICAgICAgICAgICAgIGV4c3BlY3RlZERhdGU6IHRoaXMudHJhbnNhY3Rpb24uZXhzcGVjdGVkRGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50RHVlOiB0aGlzLnRyYW5zYWN0aW9uLmFtb3VudER1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgc2FsZVRheERldGFpbDogdGhpcy50cmFuc2FjdGlvbi5zYWxlVGF4RGV0YWlsIHx8IFtdLAogICAgICAgICAgICAgICAgICAgICAgICBpbmNsdXNpdmVUYXhBbW91bnQ6IHRoaXMudHJhbnNhY3Rpb24uaW5jbHVzaXZlVGF4QW1vdW50IHx8IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlVmlldzogInB1cmNoYXNlX29yZGVyX3ZpZXciLAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCd0aGlzLnRyYW5zYWN0aW9uLnN1cHBsaWVyJywgSlNPTi5zdHJpbmdpZnkodGhpcy50cmFuc2FjdGlvbi5zdXBwbGllcikpCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25IYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgIC5jcmVhdGUoZGF0YSkKICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXNDb2RlID09PSAyMDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1NhdmVOZXcgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldERlZmF1bHREYXRhKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZShyZXNwb25zZS5kYXRhLmRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRyZWZzLmZvcm0ucmVzZXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LnN1Y2Nlc3MoIlN1Y2Nlc3NmdWxseSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoIlNvbWV0aGluZyB3ZW50IHdyb25nIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9ycy5wdXNoKGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKGUpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkVmlld1B1cmNoYXNlT3JkZXIoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgncmVzb2x2ZWQnKQogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0VkaXQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlkID0gdGhpcy4kcm91dGUucGFyYW1zLmlkCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyRmlsdGVyID0gJz90eXBlPVB1cmNoYXNlIE9yZGVyJwogICAgICAgICAgICAgICAgICAgIGJpbGxpbmdIYW5kbGVyLnZpZXdQdXJjaGFzZShpZCwgc3RyRmlsdGVyKS50aGVuKGFzeW5jIChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0VkaXQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gcmVzLmRhdGEuZGF0YVswXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbiA9IHJlc3BvbnNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhd2FpdCB0aGlzLm9uRGF0ZUNoYW5nZWQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdXBwbGllciA9IHRoaXMudHJhbnNhY3Rpb24uc3VwcGxpZXIgfHwge30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubUVtcGxveWVlID0gdGhpcy50cmFuc2FjdGlvbi5lbXBsb3llZSB8fCB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtTGluZXMgPSB0aGlzLnRyYW5zYWN0aW9uLml0ZW1MaW5lcyB8fCBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy50cmFuc2FjdGlvbi5wYXltZW50VGVybSA9IHJlc3BvbnNlLnBheW1lbnRUZXJtIHx8IHt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLm1vbnRoX29mID0ga2VuZG8udG9TdHJpbmcobmV3IERhdGUodGhpcy50cmFuc2FjdGlvbi50cmFuc2FjdGlvbkRhdGUpLCAneXl5eS1NTScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coJ3RyYW5zYWN0aW9uLnBheW1lbnRUZXJtJywgcmVzcG9uc2UucGF5bWVudFRlcm0pCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNFZGl0ID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LCAxMCkKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgfSwKICAgIHdhdGNoOiB7CiAgICAgICAgJyRyb3V0ZSc6ICdpbml0aWFsRGF0YScKICAgICAgICAvLyBpbml0UHVyY2hhc2VPcmRlcigpIHsKICAgICAgICAvLyAgIHRoaXMuaW5pdGlhbERhdGEoKTsKICAgICAgICAvLyB9LAogICAgfSwKICAgIGNyZWF0ZWQoKSB7CiAgICAgICAgdGhpcy5sb2FkVGF4KCk7CiAgICAgICAgdGhpcy5sb2FkU2FsZVVuaXRJdGVtcygpOwogICAgICAgIHRoaXMubG9hZFNlZ21lbnQoKTsKICAgICAgICB0aGlzLmxvYWRMb2NhdGlvbigpOwogICAgICAgIHRoaXMubG9hZFByb2plY3RCeVN1cHBsaWVyKCk7CiAgICB9LAogICAgbW91bnRlZDogYXN5bmMgZnVuY3Rpb24gKCkgewogICAgICAgIGF3YWl0IHRoaXMubG9hZFB1cmNoYXNlRm9ybUNvbnRlbnQoKTsKICAgICAgICB0aGlzLnJlcXVlc3REYXRhKDAsIHRoaXMuZmlsdGVyLCB0aGlzLnN1cEJhc2VVcmwpOwogICAgICAgIGF3YWl0IHRoaXMubG9hZEVtcGxveWVlQ2VudGVyKCk7CiAgICAgICAgYXdhaXQgdGhpcy5sb2FkQ2F0YWxvZ3MoKTsKICAgICAgICBhd2FpdCB0aGlzLmluaXRpYWxEYXRhKCk7CiAgICB9LAogICAgY29tcHV0ZWQ6IHsKICAgICAgICB2YWxpZDE6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgbGV0IHN1cHBsaWVyID0gdGhpcy50cmFuc2FjdGlvbi5zdXBwbGllcjsKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKDEsIHN1cHBsaWVyLmlkKTsKICAgICAgICAgICAgcmV0dXJuIHN1cHBsaWVyLmlkICE9PSB1bmRlZmluZWQgJiYgc3VwcGxpZXIuaWQgIT09IG51bGw7CiAgICAgICAgfSwKICAgICAgICB2YWxpZGF0aW9uTWVzc2FnZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBsZXQgc3VwcGxpZXIgPSB0aGlzLnRyYW5zYWN0aW9uLnN1cHBsaWVyOwogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coMiwgc3VwcGxpZXIuaWQpOwogICAgICAgICAgICByZXR1cm4gc3VwcGxpZXIuaWQgIT09IHVuZGVmaW5lZCAmJiBzdXBwbGllci5pZCA9PT0gbnVsbAogICAgICAgICAgICAgICAgPyAiUGxlYXNlIHNlbGVjdCBhIFZlbmRvciEiCiAgICAgICAgICAgICAgICA6ICJQbGVhc2Ugc2VsZWN0IGEgVmVuZG9yIjsKICAgICAgICB9LAogICAgICAgIGhpZGRlbkJ1dHRvbigpIHsKICAgICAgICAgICAgcmV0dXJuICEhdGhpcy4kcm91dGUucGFyYW1zLmlkOwogICAgICAgIH0KICAgIH0sCn07Cg=="},{"version":3,"sources":["PurchaseOrder.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAy5BA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PurchaseOrder.vue","sourceRoot":"src/views/suppliers","sourcesContent":["<template>\n    <v-app>\n        <v-container>\n            <v-row>\n                <v-col sm=\"12\" cols=\"12\">\n                    <v-card\n                        outlined\n                        dense\n                        class=\"pa-4 no_border rounded-sm\"\n                        color=\"white\">\n                        <v-row>\n                            <v-col\n                                class=\"bigSide pr-2 py-0\"\n                                sm=\"8\"\n                                cols=\"12\"\n                                style=\"transition: .3s ease-in;\"\n                                :class=\"{ hide_big_bar_class: isHideBar }\">\n                                <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                                    <v-card outlined dense class=\"no_border\">\n                                        <h2 class=\"mb-0\">{{ $t(\"purchase_order\") }}</h2>\n                                        <v-icon\n                                            v-if=\"isHideBar\"\n                                            @click=\"cancel()\"\n                                            style=\"cursor: pointer; font-size: 40px;\"\n                                            color=\"grey\"\n                                            class=\"float-right\"\n                                        >close\n                                        </v-icon>\n                                        <span\n                                            style=\"transition: .3s ease-in; z-index:10;\"\n                                            :class=\"{\n                        iconArrow: !isHideBar,\n                        iconArrowHide: isHideBar,\n                      }\">\n                      <v-icon\n                          size=\"22\"\n                          class=\"arr_icon\"\n                          @click=\"hide_smallsitebar\"\n                          v-if=\"isHideBar\">\n                        mdi-chevron-left-circle\n                      </v-icon>\n                      <v-icon\n                          size=\"22\"\n                          class=\"arr_icon\"\n                          @click=\"hide_smallsitebar\"\n                          v-if=\"!isHideBar\">\n                        mdi-chevron-right-circle\n                      </v-icon></span\n                                        >\n                                    </v-card>\n\n                                    <!-- Body -->\n\n                                    <v-card\n                                        outlined\n                                        dense\n                                        class=\"px-3 rounded-4 no_border\"\n                                        color=\"grayBg\"\n                                        height=\"254px\"\n                                    >\n                                        <v-row>\n                                            <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                                                <label class=\"label\">{{ $t(\"supplier\") }}</label>\n                                                <div class=\"kendo_dropdown_custom pb-3 mt-1\">\n                                                    <dropdownlist\n                                                        class=\"v-input__slot\"\n                                                        :data-items=\"supplierList\"\n                                                        @change=\"onChange\"\n                                                        :value=\"transaction.supplier\"\n                                                        :data-item-key=\"dataItemKey\"\n                                                        :text-field=\"textField\"\n                                                        :default-item=\"defaultItem\"\n                                                        :filterable=\"true\"\n                                                        :required=\"true\"\n                                                        :valid=\"valid1\"\n                                                        @filterchange=\"onFilterChange\"\n                                                    >\n                                                    </dropdownlist>\n                                                </div>\n                                                <label class=\"label\">{{ $t(\"number\") }}</label>\n                                                <v-row class=\"mt-1 mr-0\">\n                                                    <v-col sm=\"3\" cols=\"3\" class=\"pt-0 pb-0 pr-0\">\n                                                        <div class=\"code_text text-bold\">\n                                                            {{ transaction.transactionType.abbr }}\n                                                        </div>\n                                                    </v-col>\n                                                    <v-col sm=\"7\" cols=\"7\" class=\"pt-0 pb-0 pl-0 pr-1\">\n                                                        <v-text-field\n                                                            class=\" custom-border \"\n                                                            v-model=\"transaction.number\"\n                                                            disabled\n                                                            outlined\n                                                            :rules=\"[(v) => !!v || 'Number is required']\"\n                                                            required\n                                                        />\n                                                    </v-col>\n                                                    <v-col sm=\"2\" cols=\"2\" class=\"pt-0 pb-0 px-0\">\n                                                        <v-icon\n                                                            color=\"black\"\n                                                            :disabled=\"hiddenButton\"\n                                                            size=\"30\"\n                                                            class=\"border_qrcode\"\n                                                            @click=\"generateNumber\"\n                                                        >mdi-qrcode\n                                                        </v-icon>\n                                                    </v-col>\n                                                </v-row>\n                                                <v-row class=\"mt-0\">\n                                                    <v-col sm=\"12\" cols=\"12\" class=\" pt-0\">\n                                                        <p class=\"mb-1 d-block\">\n                                                            {{ $t(\"credit_limit_allowed\") }}\n                                                        </p>\n                                                        <h3 class=\"primary--text mt-2 ml-1 float-left\">\n                                                            {{ numberFormat(transaction.creditLimit) }}\n                                                        </h3>\n                                                    </v-col>\n                                                </v-row>\n\n                                                <!-- <label class=\"label\">{{\n                                                  $t(\"purchase_order_type\")\n                                                }}</label>\n                                                <v-select\n                                                  class=\"mt-1\"\n                                                  v-model=\"purchaseOrderType\"\n                                                  :items=\"purchaseOrderTypes\"\n                                                  item-text=\"name\"\n                                                  item-value=\"id\"\n                                                  placeholder=\"Type\"\n                                                  outlined\n                                                /> -->\n                                            </v-col>\n                                            <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                                                <label class=\"label\" style=\"\">{{ $t(\"date\") }}</label>\n                                                <app-datepicker\n                                                    :initialDate=\"transaction.transactionDate\"\n                                                    @onChanged=\"onDateChanged\"\n                                                    @emitDate=\"transaction.transactionDate = $event\"\n                                                />\n                                                <label class=\"label\" style=\"\">{{\n                                                        $t(\"due_date\")\n                                                    }}</label>\n                                                <app-datepicker\n                                                    :initialDate=\"transaction.exspectedDate\"\n                                                    @emitDate=\"transaction.exspectedDate = $event\"\n                                                />\n                                                <v-row>\n                                                    <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                                        <p class=\"mb-1 d-block\">\n                                                            {{ $t(\"current_balance\") }}\n                                                        </p>\n                                                        <h3 class=\"primary--text mt-3 ml-1 float-left\">\n                                                            {{ numberFormat(transaction.currentBalance) }}\n                                                        </h3>\n                                                    </v-col>\n                                                </v-row>\n\n                                                <!-- <label class=\"label\" style=\"\">{{\n                                                  $t(\"expected_date\")\n                                                }}</label>\n                                                <app-datepicker\n                                                  :initialDate=\"transaction.exspectedDate\"\n                                                  @emitDate=\"transaction.exspectedDate = $event\"\n                                                /> -->\n                                            </v-col>\n                                            <v-col sm=\"4\" cols=\"12\" class=\"pb-0 pt-2\">\n                                                <!-- <p class=\"mb-2 ml-n3 color_grey\">{{ $t('additional_information') }}</p> -->\n\n                                                <v-row\n                                                    style=\"background-color: #fff; height: 92%;\"\n                                                    class=\"mr-0\"\n                                                >\n                                                    <v-col class=\"pb-0 pt-1\" sm=\"12\" cols=\"12\">\n                                                        <label class=\"label\">{{ $t(\"term\") }}</label>\n                                                        <v-select\n                                                            class=\"mt-1\"\n                                                            v-model=\"transaction.paymentTerm\"\n                                                            :items=\"paymentTerms\"\n                                                            @change=\"onPaymentTermChanged\"\n                                                            placeholder=\"Term\"\n                                                            item-text=\"name\"\n                                                            item-value=\"id\"\n                                                            return-object\n                                                            outlined\n                                                        />\n\n                                                        <label class=\"label mb-0\">{{\n                                                                $t(\"price_level\")\n                                                            }}</label>\n                                                        <v-select\n                                                            class=\"mt-1\"\n                                                            v-model=\"transaction.priceLevel\"\n                                                            :items=\"priceLevels\"\n                                                            @change=\"onPriceLevelChange\"\n                                                            item-value=\"id\"\n                                                            item-text=\"name\"\n                                                            return-object\n                                                            placeholder=\"Price Level\"\n                                                            outlined\n                                                        />\n                                                        <v-col\n                                                            sm=\"6\"\n                                                            col=\"6\"\n                                                            class=\" py-0 d-flex justify-space-between\"\n                                                        >\n                                                            <div>\n                                                                <p class=\"label mb-0\">{{ $t(\"currency\") }}</p>\n                                                                <p class=\"label mb-0 pt-4 pb-3\">\n                                                                    {{ currencyCode }}\n                                                                </p>\n                                                            </div>\n                                                            <div class=\"ml-6\">\n                                                                <p class=\"label mb-2\">{{ $t(\"rate\") }}</p>\n                                                                <p class=\"label  pt-2 pb-3\">\n                                                                    {{ transactionRate }}\n                                                                </p>\n                                                            </div>\n                                                        </v-col>\n                                                    </v-col>\n                                                </v-row>\n                                            </v-col>\n                                        </v-row>\n                                    </v-card>\n\n                                    <v-row style=\"background-color: #fff;\">\n                                        <v-col sm=\"12\" cols=\"12\" class=\"pb-0\">\n                                            <kendo-datasource\n                                                ref=\"itemLinePODS\"\n                                                :data=\"itemLines\"\n                                                :change=\"dataSourceChanged\"\n                                            />\n                                            <kendo-grid\n                                                id=\"gridItemLine\"\n                                                class=\"grid-function\"\n                                                :data-source-ref=\"'itemLinePODS'\"\n                                                :sortable=\"false\"\n                                                :column-menu=\"true\"\n                                                :editable=\"true\"\n                                                :scrollable-virtual=\"true\"\n                                            >\n                                                <kendo-grid-column\n                                                    :command=\"{\n                            iconClass: 'k-icon k-i-trash',\n                            text: ' ',\n                            click: removeRow,\n                            class: 'btn-plus',\n                          }\"\n                                                    :title=\"' '\"\n                                                    :width=\"63\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :title=\"$t('no.')\"\n                                                    :width=\"53\"\n                                                    :column-menu=\"false\"\n                                                    :template=\"rowNumberTmpl\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5;',\n                            class: 'text-products',\n                          }\"\n                                                    :attributes=\"{\n                            style: 'text-align: products',\n                          }\"\n                                                />\n\n                                                <kendo-grid-column\n                                                    class=\"status\"\n                                                    :field=\"'item'\"\n                                                    :title=\"$t('item')\"\n                                                    :template=\"itemTemplate\"\n                                                    :editor=\"ItemDropDownEditor\"\n                                                    :width=\"200\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'description'\"\n                                                    :title=\"$t('description')\"\n                                                    :template=\"'<span>#=description#</span>'\"\n                                                    :width=\"160\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n\n                                                <kendo-grid-column\n                                                    :field=\"'uom'\"\n                                                    :title=\"$t('uom')\"\n                                                    :width=\"100\"\n                                                    :template=\"UOMTemplate\"\n                                                    :editor=\"UOMDropDownEditor\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{\n                            style: 'text-align: left',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'qty'\"\n                                                    :title=\"$t('qty')\"\n                                                    :format=\"'{0:n}'\"\n                                                    :template=\"'<span>#=qty#</span>'\"\n                                                    :width=\"80\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: left; ' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'cost'\"\n                                                    :title=\"$t('cost')\"\n                                                    :width=\"200\"\n                                                    :template=\"\n                            '<span>#=kendo.toString(cost || 0, decimalFormat)#</span>'\n                          \"\n                                                    :editor=\"numberEditor\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{\n                            style: 'text-align: right',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'amount'\"\n                                                    :title=\"$t('amount')\"\n                                                    :width=\"200\"\n                                                    :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                                                    :template=\"\n                            '<span>#=kendo.toString(amount || 0, decimalFormat)#</span>'\n                          \"\n                                                    :editor=\"numberEditor\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{\n                            style: 'text-align: right',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'vatTax'\"\n                                                    :title=\"$t('tax')\"\n                                                    :width=\"200\"\n                                                    :template=\"vatTemplate\"\n                                                    :editor=\"VatTaxDropDownEditor\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: left' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'serviceDate'\"\n                                                    :title=\"$t('date_from')\"\n                                                    :width=\"160\"\n                                                    :hidden=\"!purchaseFormContent.serviceDate\"\n                                                    :template=\"\n                            '<span>#= kendo.toString(new Date(serviceDate), dateFormat)#</span>'\n                          \"\n                                                    :editor=\"ServiceDateEditor\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'serviceDateTo'\"\n                                                    :title=\"$t('date_to')\"\n                                                    :width=\"160\"\n                                                    :hidden=\"!purchaseFormContent.serviceDateTo\"\n                                                    :template=\"\n                            '<span>#= kendo.toString(new Date(serviceDateTo), dateFormat)#</span>'\n                          \"\n                                                    :editor=\"ServiceDateToEditor\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'discountItem'\"\n                                                    :title=\"$t('discount_item')\"\n                                                    :width=\"200\"\n                                                    :hidden=\"!purchaseFormContent.discountItem\"\n                                                    :template=\"discountItemTemplate\"\n                                                    :editor=\"DiscountItemDropDownEditor\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                                                    :attributes=\"{\n                            style: 'text-align: left',\n                          }\"\n                                                />\n\n                                                <!--                                                <kendo-grid-column-->\n                                                <!--                                                    :field=\"'otherTax'\"-->\n                                                <!--                                                    :title=\"$t('otherTax')\"-->\n                                                <!--                                                    :width=\"200\"-->\n                                                <!--                                                    :hidden=\"!purchaseFormContent.otherTax\"-->\n                                                <!--                                                    :template=\"-->\n                                                <!--                            '<span>#=otherTax.defaultTax?otherTax.defaultTax:``#</span>'-->\n                                                <!--                          \"-->\n                                                <!--                                                    :editor=\"OtherTaxDropDownEditor\"-->\n                                                <!--                                                    :headerAttributes=\"{-->\n                                                <!--                            style:-->\n                                                <!--                              'text-align: left; background-color: #EDF1F5',-->\n                                                <!--                          }\"-->\n                                                <!--                                                    :attributes=\"{ style: 'text-align: left' }\"-->\n                                                <!--                                                />-->\n                                            </kendo-grid>\n                                        </v-col>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"pt-1\">\n\n                                            <v-btn\n                                                color=\"primary\"\n                                                class=\"float-left btn_plus mr-2\"\n                                                @click=\"addRow\"\n                                            >\n                                                <v-icon size=\"\" class=\"ma-1\">mdi-plus</v-icon>\n                                            </v-btn>\n\n                                        </v-col>\n                                    </v-row>\n\n                                    <v-row style=\"background-color: #fff;\">\n                                        <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                            <v-row>\n                                                <v-col class=\"pt-0\" sm=\"6\" cols=\"6\">\n                                                    <v-card\n                                                        class=\"no-boxshadow px-3 pt-3\"\n                                                        color=\"grayBg\"\n                                                        height=\"230px\"\n                                                    >\n                                                        <label>{{ $t(\"msg_on_voucher\") }}</label>\n                                                        <v-textarea\n                                                            class=\"mt-1\"\n                                                            no-resize\n                                                            height=\"70px\"\n                                                            v-model=\"transaction.transactionNote\"\n                                                            outlined\n                                                            clearable\n                                                            rows=\"3\"\n                                                            placeholder=\"This will appear on the purchase order\"\n                                                        />\n                                                        <label>{{ $t(\"message_for_journal\") }}</label>\n                                                        <v-textarea\n                                                            class=\"mt-1\"\n                                                            no-resize\n                                                            height=\"70px\"\n                                                            v-model=\"transaction.journalNote\"\n                                                            outlined\n                                                            clearable\n                                                            rows=\"3\"\n                                                            placeholder=\"This will appear on the journal entry\"\n                                                        />\n                                                    </v-card>\n                                                </v-col>\n                                                <v-col class=\"pt-0\" sm=\"6\" cols=\"6\">\n                                                    <v-simple-table>\n                                                        <template v-slot:default>\n                                                            <tbody>\n                                                            <tr>\n                                                                <td class=\"text-left pr-0\">\n                                                                    {{ $t(\"subtotal\") }}\n                                                                </td>\n                                                                <td class=\"text-center\">:</td>\n                                                                <td class=\"text-right\">\n                                                                    {{ numberFormat(transaction.subTotal) }}\n                                                                </td>\n                                                            </tr>\n                                                            <tr>\n                                                                <td class=\"text-left pr-0\">\n                                                                    {{ $t(\"general_discount\") }}\n                                                                </td>\n                                                                <td class=\"text-center\">:</td>\n                                                                <td class=\"text-right\">\n                                                                    ({{\n                                                                        numberFormat(transaction.discountTotal)\n                                                                    }})\n                                                                </td>\n                                                            </tr>\n                                                            <tr>\n                                                                <td class=\"text-left pr-0\">\n                                                                    {{ $t(\"total_tax\") }}\n                                                                    <v-btn\n                                                                        @click=\"dialogTax = true\"\n                                                                        color=\"primary\"\n                                                                        outlined\n                                                                        class=\"primary--white text-bold  float-right text-uppercase\"\n                                                                        style=\"height: 30px !important;\"\n                                                                    >\n                                                                        {{ $t(\"tax\") }}\n                                                                    </v-btn>\n                                                                </td>\n                                                                <td class=\"text-center\">:</td>\n                                                                <td class=\"text-right\">\n                                                                    {{\n                                                                        numberFormat(transaction.totalTaxAmount)\n                                                                    }}\n                                                                </td>\n                                                            </tr>\n                                                            <tr>\n                                                                <td\n                                                                    class=\"text-left grayBg text-uppercase pr-0\"\n                                                                >\n                                                                    {{ $t(\"total\") }}\n                                                                </td>\n                                                                <td class=\"text-center grayBg\">:</td>\n                                                                <td\n                                                                    class=\"text-right grayBg text-bold\"\n                                                                    id=\"total\"\n                                                                >\n                                                                    {{ numberFormat(transaction.total) }}\n                                                                </td>\n                                                            </tr>\n                                                            </tbody>\n                                                        </template>\n                                                    </v-simple-table>\n                                                </v-col>\n                                            </v-row>\n                                        </v-col>\n                                    </v-row>\n\n                                    <v-divider/>\n                                    <v-card outlined dense class=\"no_border function_footer\">\n                                        <v-alert type=\"warning\" v-model=\"alert\" dismissible>\n                                            <span v-html=\"errorMessage\"/>\n                                        </v-alert>\n                                        <v-menu>\n                                            <template v-slot:activator=\"{ on }\">\n                                                <v-btn\n                                                    class=\"mr-2 text-capitalize  black--text float-left\"\n                                                    v-on=\"on\"\n                                                >\n                                                    {{ $t(\"select_template\") }}\n                                                    <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>\n                                                </v-btn>\n                                            </template>\n                                            <v-list>\n                                                <v-list-item\n                                                    v-for=\"(item, index) in templates\"\n                                                    :key=\"index\"\n                                                >\n                                                    <v-list-item-title>{{\n                                                            item.title\n                                                        }}\n                                                    </v-list-item-title>\n                                                </v-list-item>\n                                            </v-list>\n                                        </v-menu>\n                                        <v-btn\n                                            color=\"primary\"\n                                            outlined\n                                            class=\"text-capitalize  black--text float-left\"\n                                            @click=\"cancel\"\n                                        >{{ $t(\"cancel\") }}\n                                        </v-btn>\n                                        <!--                    <v-menu>-->\n                                        <!--                      <template v-slot:activator=\"{ on }\">-->\n                                        <!--                        <v-btn-->\n                                        <!--                            color=\"primary\"-->\n                                        <!--                            class=\"ml-2 float-right text-capitalize  white&#45;&#45;text\"-->\n                                        <!--                            v-on=\"on\"-->\n                                        <!--                        >-->\n                                        <!--                          {{ $t(\"save_option\") }}-->\n                                        <!--                          <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>-->\n                                        <!--                        </v-btn>-->\n                                        <!--                      </template>-->\n                                        <!--                      <v-list rounded>-->\n                                        <!--                        <v-list-item-group>-->\n                                        <!--                          <v-list-item>-->\n                                        <!--                            <v-list-item-content>-->\n                                        <!--                              <v-list-item-title-->\n                                        <!--                                  v-if=\"!isEdit\"-->\n                                        <!--                                  @click=\"saveClose\"-->\n                                        <!--                              >-->\n                                        <!--                                {{ $t(\"save_close\") }}-->\n                                        <!--                              </v-list-item-title>-->\n                                        <!--                            </v-list-item-content>-->\n                                        <!--                          </v-list-item>-->\n                                        <!--                          <v-list-item>-->\n                                        <!--                            <v-list-item-content>-->\n                                        <!--                              <v-list-item-title-->\n                                        <!--                                  v-if=\"!isEdit\"-->\n                                        <!--                                  @click=\"saveNew\"-->\n                                        <!--                              >-->\n                                        <!--                                {{ $t(\"save_new\") }}-->\n                                        <!--                              </v-list-item-title>-->\n                                        <!--                            </v-list-item-content>-->\n                                        <!--                          </v-list-item>-->\n                                        <!--                          <v-list-item>-->\n                                        <!--                            <v-list-item-content>-->\n                                        <!--                              <v-list-item-title @click=\"savePrint\"-->\n                                        <!--                              >{{ $t(\"save_print\") }}-->\n                                        <!--                              </v-list-item-title>-->\n                                        <!--                            </v-list-item-content>-->\n                                        <!--                          </v-list-item>-->\n                                        <!--                        </v-list-item-group>-->\n                                        <!--                      </v-list>-->\n                                        <!--                    </v-menu>-->\n                                        <v-btn\n                                            @click=\"saveClose\"\n                                            color=\"primary\"\n                                            class=\"float-right white--text text-capitalize \">\n                                            {{ $t(\"save_close\") }}\n                                        </v-btn>\n                                        <v-btn color=\"secondary\"\n                                               style=\"margin-right: 10px !important\"\n                                               class=\"white--text float-right text-capitalize\"\n                                               @click=\"saveNew\" :hidden=\"hiddenButton\">{{ $t(\"save_new\") }}\n                                        </v-btn>\n                                    </v-card>\n                                </v-form>\n                            </v-col>\n                            <v-col\n                                class=\"smallSide pl-2\"\n                                sm=\"4\"\n                                style=\"transition: .3s ease-in;\"\n                                :class=\"{ hide_small_bar_class: isHideBar }\"\n                            >\n                                <div class=\"d-flex justify-end\">\n                                    <h3\n                                        style=\"color: #b3b5bc; font-size:20px;\"\n                                        v-if=\"!isHideBar\"\n                                        class=\"text-uppercase float-right mt-n3\"\n                                    >\n                    <span class=\"pointer\" @click=\"Help('purchase order')\">\n                      {{ $t(\"help\") }}\n                    </span>\n                                        <v-icon\n                                            @click=\"cancel()\"\n                                            style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                                            class=\"float-right mt-n1\"\n                                        >close\n                                        </v-icon>\n                                    </h3>\n                                </div>\n\n                                <div v-if=\"!isHideBar\" class=\"small_sidebar mt-2 grayBg\">\n                                    <v-card outlined dense class=\"pa-3 no_border my_card rounded-4 white--text\"\n                                            color=\"primary\" height=\"60px\">\n                                        <h3 class=\"text-left font_13 flex-1 text-uppercase\">{{\n                                                $t('amount_ordered')\n                                            }}</h3>\n                                        <h3 class=\"text-right flex-1 font_20 niradei_heavy\">\n                                            {{ numberFormat(transaction.total) }} </h3>\n                                    </v-card>\n                                    <v-row>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"pb-0 pt-5\">\n                                            <!-- <h4 class=\"mb-3 text-uppercase\">{{ $t('analysis') }}</h4> -->\n                                            <label class=\"label mb-0\">{{ $t(\"segment\") }}</label>\n                                            <v-select\n                                                class=\"mt-1\"\n                                                v-model=\"transaction.segment\"\n                                                :items=\"segments\"\n                                                item-value=\"id\"\n                                                :item-text=\"(item) => `${item.code} - ${item.name}`\"\n                                                return-object\n                                                tage=\"sub Of\"\n                                                placeholder=\"Sub Of\"\n                                                outlined=\"\"\n                                            />\n                                            <label class=\"label mb-0\">{{ $t(\"location\") }}</label>\n                                            <v-select\n                                                class=\"mt-1\"\n                                                v-model=\"transaction.location\"\n                                                :items=\"locations\"\n                                                item-value=\"id\"\n                                                :item-text=\"(item) => `${item.code} - ${item.name}`\"\n                                                return-object\n                                                tage=\"Location\"\n                                                placeholder=\"bu/location\"\n                                                outlined=\"\"\n                                            />\n                                            <label class=\"label\">{{ $t(\"project\") }}</label>\n                                            <v-select\n                                                class=\"mt-1\"\n                                                v-model=\"transaction.project\"\n                                                :items=\"projects\"\n                                                :item-text=\"(item) => `${item.code} - ${item.name}`\"\n                                                item-value=\"id\"\n                                                clearable\n                                                placeholder=\"project\"\n                                                outlined\n                                            />\n                                            <label class=\"label\">{{ $t(\"for_month_of\") }}</label>\n                                            <app-monthof-picker\n                                                :initMonthOf=\"transaction.month_of\"\n                                                @emitMonthOf=\"transaction.month_of = $event\"\n                                            />\n\n                                            <label class=\"label\">{{ $t(\"employee\") }}</label>\n                                            <v-col\n                                                sm=\"12\"\n                                                cols=\"12\"\n                                                class=\"kendo_dropdown_custom pl-0 pb-3 pt-0\"\n                                                style=\"padding: 0\"\n                                            >\n                                                <dropdownlist\n                                                    style=\"width: 100%\"\n                                                    class=\" mt-1\"\n                                                    :data-items=\"employees\"\n                                                    @change=\"onEmployeeChanged\"\n                                                    :value=\"mEmployee\"\n                                                    :data-item-key=\"'id'\"\n                                                    :text-field=\"'name'\"\n                                                    :default-item=\"defaultItem\"\n                                                    :filterable=\"true\"\n                                                    @filterchange=\"onEmployeeFilterChanged\"\n                                                >\n                                                </dropdownlist>\n                                            </v-col>\n                                        </v-col>\n                                    </v-row>\n                                    <v-divider class=\"\"/>\n                                    <!--                                    <v-row>-->\n                                    <!--                                        <v-col sm=\"12\" cols=\"12\">-->\n                                    <!--                                            <label class=\"label text-bold text-uppercase\">{{-->\n                                    <!--                                                    $t(\"tnc_to_be_added\")-->\n                                    <!--                                                }}</label>-->\n                                    <!--                                            <template v-slot:item=\"{ item }\">-->\n                                    <!--                                                <p class=\"d-block text-center\">-->\n                                    <!--                                                    {{ item.id }}. {{ item.name }}-->\n                                    <!--                                                </p>-->\n                                    <!--                                                <br/>-->\n                                    <!--                                                <div class=\"item_list d-flex\">-->\n                                    <!--                          <span>-->\n                                    <!--                            {{ item.no }}-->\n                                    <!--                          </span>-->\n                                    <!--                                                    <v-btn>{{ $t(\"add\") }}</v-btn>-->\n                                    <!--                                                </div>-->\n                                    <!--                                            </template>-->\n\n                                    <!--                                            <v-row>-->\n                                    <!--                                                <label class=\"text-bold ml-9\" style=\"font-size: 12px;\"-->\n                                    <!--                                                >1. {{ $t(\"sale_order\") }}</label-->\n                                    <!--                                                >-->\n                                    <!--                                                <v-row v-for=\"item in txnTobeAdd\" v-bind:key=\"item.id\">-->\n                                    <!--                                                    <v-col sm=\"9\" cols=\"9\" class=\"py-0 pr-0\">-->\n                                    <!--                                                        <v-card-->\n                                    <!--                                                            outlined-->\n                                    <!--                                                            class=\"px-3 py-1 text-white no-boxshadow no_border justify-left d-flex\"-->\n                                    <!--                                                            style=\"background-color: #92d050; height: 30px\"-->\n                                    <!--                                                        >-->\n                                    <!--                                                            <p class=\"mb-0\" style=\"width: 100%\">-->\n                                    <!--                                <span class=\"pl-3 float-left\">{{-->\n                                    <!--                                        item.number-->\n                                    <!--                                    }}</span>-->\n                                    <!--                                                                <span class=\"float-right\">{{-->\n                                    <!--                                                                        numberFormat(item.total)-->\n                                    <!--                                                                    }}</span>-->\n                                    <!--                                                            </p>-->\n                                    <!--                                                        </v-card>-->\n                                    <!--                                                    </v-col>-->\n                                    <!--                                                    <v-col sm=\"3\" cols=\"3\" class=\"py-0  pl-1\">-->\n                                    <!--                                                        <v-btn-->\n                                    <!--                                                            class=\"text-white text-bold rounded-0 float-right text-uppercase\"-->\n                                    <!--                                                            style=\"height: 30px !important; background-color: rgb(0, 176, 80) !important\"-->\n                                    <!--                                                            @click=\"addQuote(item)\"-->\n                                    <!--                                                        >-->\n                                    <!--                                                            {{ $t(\"add\") }}-->\n                                    <!--                                                        </v-btn>-->\n                                    <!--                                                    </v-col>-->\n                                    <!--                                                </v-row>-->\n                                    <!--                                            </v-row>-->\n                                    <!--                                        </v-col>-->\n                                    <!--                                    </v-row>-->\n\n                                    <p class=\"mb-0 detial_smallside_p pl-4\">\n                                        {{ $t(\"purchae_order_funct_detial\") }}\n                                    </p>\n                                </div>\n                            </v-col>\n                        </v-row>\n                    </v-card>\n                </v-col>\n            </v-row>\n            <LoadingMe\n                :isLoading=\"showLoading\"\n                :fullPage=\"false\"\n                :myLoading=\"true\"/>\n            <v-dialog v-model=\"dialogTax\" max-width=\"450px\">\n                <v-card>\n                    <div class=\"modal_header\">\n                        <v-card-title>{{ $t(\"tax_list\") }}</v-card-title>\n                        <v-icon class=\"btn_close\" @click=\"dialogTax = false\">close</v-icon>\n                    </div>\n                    <v-card-text class=\"modal_text_content\">\n                        <v-row>\n                            <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                <v-simple-table>\n                                    <template v-slot:default>\n                                        <tbody>\n                                        <tr\n                                            v-for=\"(value, name) in taxListTotal\"\n                                            v-bind:key=\"name\"\n                                        >\n                                            <td class=\"text-left\" width=\"180px\">{{ name }}</td>\n                                            <td class=\"text-center\">:</td>\n                                            <td class=\"text-right\">\n                                                {{ numberFormat(value) }}\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td class=\"text-left\" width=\"180px\">\n                                                {{ $t(\"total\") }}\n                                            </td>\n                                            <td class=\"text-center\">:</td>\n                                            <td class=\"text-right\">\n                                                {{ numberFormat(transaction.totalTaxAmount) }}\n                                            </td>\n                                        </tr>\n                                        </tbody>\n                                    </template>\n                                </v-simple-table>\n                            </v-col>\n                        </v-row>\n                    </v-card-text>\n                    <v-divider/>\n                </v-card>\n            </v-dialog>\n            <v-dialog v-model=\"dialogCatalog\" max-width=\"850px\">\n                <v-card>\n                    <div class=\"modal_header\">\n                        <v-card-title>{{ $t(\"catalog\") }}</v-card-title>\n                        <v-icon @click=\"dialogCatalog = false\"\n                        >close\n                        </v-icon\n                        >\n                    </div>\n                    <v-card-text cl ass=\"modal_text_content\">\n                        <v-row>\n                            <v-col sm=\"12\" cols=\"12\" class=\"pb-0\">\n                                <v-simple-table>\n                                    <kendo-datasource\n                                        ref=\"catalogDatasource\"\n                                        :data=\"catalogs\"\n                                        :schema=\"gridSchema\"\n                                    />\n                                    <kendo-grid\n                                        id=\"gridCatalog\"\n                                        class=\"grid-function\"\n                                        :data-source-ref=\"'catalogDatasource'\"\n                                        :style=\"{ width: '100%' }\"\n                                        :noRecords=\"true\"\n                                        :pageable-numeric=\"false\"\n                                        :pageable-previous-next=\"false\"\n                                        :pageable-messages-display=\"'Showing {2} data items'\"\n                                        :scrollable-virtual=\"true\"\n                                    >\n                                        <kendo-grid-column\n                                            :field=\"'images'\"\n                                            :title=\"$t('image')\"\n                                            :width=\"50\"\n                                            :template=\"loadImage\"\n                                            :headerAttributes=\"{ style: 'background-color: #EDF1F5' }\"\n                                        />\n                                        <kendo-grid-column\n                                            :field=\"'number'\"\n                                            :title=\"$t('number')\"\n                                            :width=\"70\"\n                                            :template=\"'<span>#=number#</span>'\"\n                                            :groupHeaderColumnTemplate=\"'#=value#'\"\n                                            :headerAttributes=\"{ style: 'background-color: #EDF1F5' }\"\n                                        />\n                                        <kendo-grid-column\n                                            :field=\"'name'\"\n                                            :title=\"$t('name')\"\n                                            :width=\"100\"\n                                            :template=\"'<span>#=name#</span>'\"\n                                            :headerAttributes=\"{ style: 'background-color: #EDF1F5' }\"\n                                        />\n                                        <kendo-grid-column\n                                            :field=\"'description'\"\n                                            :title=\"$t('description')\"\n                                            :width=\"100\"\n                                            :template=\"'<span>#=description#</span>'\"\n                                            :headerAttributes=\"{ style: 'background-color: #EDF1F5' }\"\n                                        />\n                                        <kendo-grid-column\n                                            :field=\"'noOfProduct'\"\n                                            :title=\"$t('products')\"\n                                            :template=\"'<span>#=noOfProduct#</span>'\"\n                                            :width=\"50\"\n                                            :headerAttributes=\"{\n                        style: 'text-align: left; background-color: #EDF1F5',\n                      }\"\n                                        />\n                                        <kendo-grid-column\n                                            :field=\"''\"\n                                            :title=\"$t('action')\"\n                                            :width=\"60\"\n                                            :command=\"[{ text: $t('add'), click: addCatalog }]\"\n                                            :headerAttributes=\"{\n                        style: 'text-align: left; background-color: #EDF1F5',\n                      }\"\n                                        />\n                                    </kendo-grid>\n                                </v-simple-table>\n                            </v-col>\n                        </v-row>\n                    </v-card-text>\n                    <v-divider/>\n                </v-card>\n            </v-dialog>\n        </v-container>\n    </v-app>\n</template>\n\n<script>\nimport {i18n} from \"@/i18n\";\nimport TransactionModel from \"@/scripts/model/Transaction\";\nimport {DropDownList} from \"@progress/kendo-vue-dropdowns\";\nimport kendo from \"@progress/kendo-ui\";\nimport {uuid} from \"vue-uuid\";\nimport PurchaseFormContentModel from \"@/scripts/model/PurchaseFormContent\";\nimport {dataStore, ShowResource} from \"@/observable/store\";\n\nimport ItemLineModel from \"@/scripts/invoice/model/ItemLine\";\nimport creditLimitHandler from \"@/scripts/creditLimit/handler/creditLimitHandler\";\nimport paymentTermHandler_ from \"@/scripts/paymentterm/handler/paymentTermHandler\";\n\nconst itemLineModel = new ItemLineModel({});\n\nconst transactionHandler = require(\"@/scripts/transactionHandler\");\nconst supplierHandler = require(\"@/scripts/supplierHandler\");\nconst currencyHandler = require(\"@/scripts/currency/handler/currencyHandler\");\nconst billingHandler = require(\"@/scripts/invoice/handler/billingHandler\");\n// const paymentTermHandler = require(\"@/scripts/paymentTermHandler\");\nconst purchaseFormContentHandler = require(\"@/scripts/purchaseFormContentHandler\");\nconst settingHandler = require(\"@/scripts/settingHandler\");\nconst locationHandler = require(\"@/scripts/locationHandler\");\nconst projectHandler = require(\"@/scripts/projectHandler\");\nconst discountItemHandler = require(\"@/scripts/discountItemHandler\");\nconst uomPriceHandler = require(\"@/scripts/uomPriceHandler\");\nconst employeeHandler = require(\"@/scripts/employeeHandler\");\nconst priceLevelHandler = require(\"@/scripts/priceLevelHandler\");\nconst productVariantHandler = require(\"@/scripts/productVariantHandler\");\nconst prefixHandler = require(\"@/scripts/prefixHandler\");\nconst settingsHandler = require(\"@/scripts/settingsHandler\");\nconst saleUnitItemHandler = require(\"@/scripts/saleUnitItemHandler\");\nconst catalogHandler = require(\"@/scripts/catalogHandler\");\nconst productHandler = require(\"@/scripts/productHandler\");\n\nconst $ = kendo.jQuery\nconst textField = \"numberName\";\nconst keyField = \"id\";\nconst defaultItem = {[textField]: \"Select Supplier...\", [keyField]: null};\nconst emptyItem = {[textField]: \"loading ...\"};\nconst transactionPrefix = \"lin-\";\nconst purchaseFormContentModel = new PurchaseFormContentModel({});\nconst DISCOUNT_TYPE = \"?type=Purchase\";\nconst cookieJS = require(\"@/cookie.js\");\nconst cookie = cookieJS.getCookie();\n\nconst TYPE = 'purchase'\nexport default {\n    name: \"PurchaseOrder\",\n    props: {\n        id: {\n            type: String,\n        },\n        initPurchaseOrder: {\n            type: TransactionModel,\n        },\n    },\n    components: {\n        LoadingMe: () => import(`@/components/Loading`),\n        \"app-datepicker\": () => import(`@/components/custom_templates/DatePickerComponent`),\n        dropdownlist: DropDownList,\n        \"app-monthof-picker\": () => import(\"@/components/kendo_templates/MonthOfPicker\"),\n    },\n    data: () => ({\n        success: false,\n        isEdit: false,\n        textField: \"numberName\",\n        dataItemKey: \"id\",\n        balance: 0,\n        // LoadingMe\n        showLoading: false,\n        alert: false,\n        files: [],\n        dialogCatalog: false,\n        gridSchema: {\n            model: {\n                id: \"id\",\n            },\n        },\n        // Form validation\n        valid: true,\n        templates: [\n            {title: \"Purchase Order\", value: \"Purchase Order\",},\n\n        ],\n        isHideBar: false,\n        transaction: new TransactionModel({}),\n        supplierList: [],\n        supplier: {},\n        catalogs: [],\n        dialogTax: false,\n        baseCurrencyCode: \"\",\n        supBaseUrl: supplierHandler.search(),\n        exchangeRate: {},\n        currencyCode: \"\",\n        transactionRate: 1,\n        paymentTerms: [],\n        employees: [],\n        mEmployee: {},\n        purchaseFormContent: purchaseFormContentModel,\n        segments: [],\n        locations: [],\n        taxListTotal: {},\n        itemLines: [],\n        itemLine: itemLineModel,\n        dateFormat: itemLineModel.dateFormat,\n        projects: [],\n        filter: \"\",\n        purchaseOrderType: 1,\n        purchaseOrderTypes: [\n            {name: \"Standard Order\", id: 1},\n            {name: \"Open Order\", id: 2},\n            {name: \"Contract\", id: 3},\n            {name: \"Consignment Order\", id: 4},\n            {name: \"Order required Purchase\", id: 5},\n        ],\n        discountItem: [],\n        saleUnit: [],\n        defaultItem: defaultItem,\n        txnLists: [],\n        saveOption: \"\",\n        loggedUser: {\n            id: cookie.creator,\n            name: cookie.email,\n        },\n        saleUnitItemList: [],\n        tax: [],\n        otherTax: [],\n        vatTax: [],\n        txnTobeAdd: [],\n        // withholdingTax: [],\n        priceLevels: [],\n        errors: [],\n        isSaveNew: false,\n        isSaveClose: false,\n        isSavePrint: false,\n        isSaveDraft: false,\n        isPriceLevelChanged: false,\n        taxListDetail: []\n    }),\n    methods: {\n        autoCalculateTaxDetail() {\n            let ids = []\n            this.taxListDetail.forEach(n => {\n                ids.push(n.id || '')\n            })\n            const unique = [...new Set(ids)]\n            let result = []\n            unique.forEach(m => {\n                let amount = 0, row = {}, discount = 0, xDiscount = 0, xAmount = 0, taxAmount = 0, xTaxAmount = 0\n                let taxDetail = [], isVat = 0\n                const found = this.taxListDetail.filter(n => n.id === m)\n                // window.console.log('taxListDetailids', found)\n                found.forEach(k => {\n                    row = k\n                    if (k.isVat === 1) {\n                        isVat = 1\n                        const detail_ = k.detail || {}\n                        taxDetail.push(detail_)\n\n                    }\n                    taxAmount += k.taxAmount_ || 0\n                    xTaxAmount += (k.taxAmount_ || 0) * (k.txnRate || 1)\n                    amount += (k.amount || 0)\n                    xAmount += (k.amount || 0) * (k.txnRate || 1)\n                    discount += (k.discount || 0)\n                    xDiscount += (k.discount || 0) * (k.txnRate || 1)\n                })\n                let spTaxAmt = 0, spXTaxAmt = 0, plTaxAmt = 0, plXTaxAmt = 0, otTaxAmt = 0, otXTaxAmt = 0,\n                    spTaxName = '', plTaxName = '', otTaxName = '',\n                    spTaxNameLocale = '', plTaxNameLocale = '', otTaxNameLocale = '',\n                    spAccId = '', plAccId = '', otAccId = '',\n                    spRate = '', plRate = '', otRate = ''\n                taxDetail.forEach(n => {\n                    const spTax = n.specificTax || {}\n                    const plTax = n.publicLightingTax || {}\n                    const otherTax = n.otherTax || {}\n                    if (Object.keys(spTax).length > 0) {\n                        spTaxAmt += (spTax.taxAmount_ || 0)\n                        spXTaxAmt += ((spTax.taxAmount_ || 0) * (spTax.taxRate || 1))\n                        spTaxName = spTax.defaultTax || ''\n                        spTaxNameLocale = spTax.defaultTaxLocale || ''\n                        spAccId = spTax.account ? spTax.account.id : ''\n                        spRate = spTax.rate || 1\n                    }\n                    if (Object.keys(plTax).length > 0) {\n                        plTaxAmt += (plTax.taxAmount_ || 0)\n                        plXTaxAmt += ((plTax.taxAmount_ || 0) * (plTax.taxRate || 1))\n                        plTaxName = plTax.defaultTax || ''\n                        plTaxNameLocale = plTax.defaultTaxLocale || ''\n                        plAccId = plTax.account ? plTax.account.id : ''\n                        plRate = plTax.rate || 1\n                    }\n                    if (Object.keys(otherTax).length > 0) {\n                        otTaxAmt += (otherTax.taxAmount_ || 0)\n                        otXTaxAmt += ((otherTax.taxAmount_ || 0) * (plTax.taxRate || 1))\n                        otTaxName = otherTax.defaultTax || ''\n                        otTaxNameLocale = otherTax.defaultTaxLocale || ''\n                        otAccId = otherTax.account ? otherTax.account.id : ''\n                        otRate = otherTax.rate || 1\n                    }\n                })\n                if (isVat === 1) {\n                    row.detail = {\n                        specificTax: {\n                            name: spTaxName,\n                            nameLocale: spTaxNameLocale,\n                            amount: spTaxAmt,\n                            exchangeAmount: spXTaxAmt,\n                            accountId: spAccId,\n                            rate: spRate,\n                        },\n                        publicLightingTax: {\n                            name: plTaxName,\n                            nameLocale: plTaxNameLocale,\n                            amount: plTaxAmt,\n                            exchangeAmount: plXTaxAmt,\n                            accountId: plAccId,\n                            rate: plRate,\n                        },\n                        otherTax: {\n                            name: otTaxName,\n                            nameLocale: otTaxNameLocale,\n                            amount: otTaxAmt,\n                            exchangeAmount: otXTaxAmt,\n                            accountId: otAccId,\n                            rate: otRate,\n                        }\n                    }\n                } else {\n                    row.detail = {}\n                }\n\n                row['amount'] = amount\n                row['exchangeAmount'] = xAmount\n                row['taxAmount'] = taxAmount\n                row['exchangeTaxAmount'] = xTaxAmount\n                row['discount'] = discount\n                row['exchangeDiscount'] = xDiscount\n                row['currency'] = this.transaction.exchangeRate || {}\n                result.push(row)\n                taxDetail = []\n            })\n            this.transaction.saleTaxDetail = result\n        },\n        async loadPaymentTermList() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    if (this.supplier) {\n                        const strFilter = '?id=' + this.supplier.id + '&transactionDate=' + this.transaction.transactionDate + '&type=Vendor'\n                        this.transaction.paymentTerm = {}\n                        paymentTermHandler_.get(strFilter).then((res) => {\n                            if (res.data.statusCode === 200) {\n                                const terms = res.data.data\n                                this.transaction.paymentTerm = terms.term\n                                this.onPaymentTermChanged()\n                            }\n                        });\n                    }\n                }, 10);\n            });\n        },\n        async loadCreditLimit() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    if (this.supplier) {\n                        const strFilter = '?id=' + this.supplier.id + '&transactionDate=' + this.transaction.transactionDate + '&type=Vendor'\n                        this.transaction.creditLimit = 0\n                        creditLimitHandler.get(strFilter).then((res) => {\n                            if (res.data.statusCode === 200) {\n                                const credit = res.data.data\n                                this.transaction.creditLimit = kendo.parseFloat(credit.amount || 0);\n                            }\n                        });\n                    }\n                }, 10);\n            });\n        },\n        async loadCustomerBalance(id) {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const strFilter = id + \"?type=bal\";\n                    this.transaction.currentBalance = 0;\n                    billingHandler\n                        .balance(strFilter)\n                        .then((res) => {\n                            if (res.data.statusCode === 200) {\n                                const data = res.data.data;\n                                if (data.length > 0) {\n                                    this.transaction.currentBalance = data[0].balance;\n                                }\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 10);\n            });\n        },\n        onPriceLevelChange() {\n            this.isPriceLevelChanged = true\n            this.loadTransactionRate()\n            this.clearUOMItem()\n        },\n        async clearUOMItem() {\n            let ds = this.$refs.itemLinePODS.kendoWidget()\n            ds.data().map(n => {\n                n.set('uom', {})\n            })\n            this.isPriceLevelChanged = false\n        },\n        numberEditor(container, options) {\n            kendo\n                .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoNumericTextBox({\n                    decimals: 30,\n                    min: 0.00001,\n                    format: `${this.purchaseFormContent.decimal}`,\n                });\n        },\n        Help(key_search) {\n            ShowResource(key_search);\n        },\n        initialData() {\n            if (this.id) {\n                // Edit Mode\n                // this.transaction = this.initPurchaseOrder;\n                this.setDefaultData()\n                this.loadViewPurchaseOrder()\n                // this.bindData();\n            } else {\n                // Brand New Mode\n                if (this.$route.params.id === undefined) {\n                    this.setDefaultData();\n                }\n            }\n        },\n        setDefaultData() {\n            // Brand New Mode\n            this.isEdit = false;\n            const paymentTerm = this.transaction.paymentTerm || {}\n            this.transaction = new TransactionModel({});\n            //month of\n            let monthOf = kendo.toString(new Date(this.transaction.transactionDate), \"yyyy-MM-dd\");\n            window.console.log('monthOf', monthOf)\n            this.transaction.month_of = monthOf;\n            this.transaction.formTemplate = 1;\n            let ds = this.$refs.itemLinePODS.kendoWidget();\n            ds.data([]);\n            // Add 2 default lines\n            this.addRow();\n            this.loadPrefix();\n            this.loadPaymentTerm();\n            this.loadPriceLevel();\n            this.loadSegment();\n            this.loadLocation();\n            this.mEmployee = {};\n            this.taxListTotal = {};\n            this.isSaveNew = false;\n            this.isSaveClose = false;\n            this.isSavePrint = false;\n            this.isSaveDraft = false;\n            this.transaction.paymentTerm = paymentTerm\n        },\n        bindData() {\n            // Edit Mode\n            this.isEdit = true;\n            this.supplier = this.transaction.supplier;\n            this.taxListTotal = this.transaction.taxListTotal;\n            this.itemLines = this.transaction.itemLines;\n            // if (this.supplier.hasOwnProperty('id')) {\n            //   this.loadProjectBySupplier()\n            // }\n        },\n        addRow() {\n            let ds = this.$refs.itemLinePODS.kendoWidget(),\n                total = ds.total();\n            this.itemLine.id = transactionPrefix + uuid.v1();\n            ds.insert(total, this.itemLine);\n        },\n        async loadPaymentTerm() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const strFilter = \"?type=pmt-supplier\";\n                    this.paymentTerms = []\n                    settingsHandler.getPaymentTerm(strFilter).then((res) => {\n                        this.showLoading = false;\n                        this.paymentTerms = res.data.data;\n                        // if (this.paymentTerms.length > 0) {\n                        //     if (\n                        //         this.$route.params.id !== undefined ||\n                        //         this.$route.params.id !== \"\"\n                        //     ) {\n                        //         this.transaction.paymentTerm = this.paymentTerms[0];\n                        //     }\n                        // }\n                    });\n                }, 10);\n            });\n        },\n        async loadPriceLevel() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const strFilter = '?nature=' + TYPE\n                    priceLevelHandler.get(strFilter).then((res) => {\n                        this.priceLevels = res;\n                        if (this.priceLevels.length > 0) {\n                            if (\n                                this.$route.params.id !== undefined ||\n                                this.$route.params.id !== \"\"\n                            ) {\n                                this.transaction.priceLevel = this.priceLevels[0];\n                                this.loadTransactionRate();\n                            }\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async loadSegment() {\n            this.segments = []\n            const roleType = dataStore.roleType || 0\n            if (roleType === 0) {\n                if (dataStore.roleData) {\n                    const roleData = dataStore.roleData || []\n                    const segment = roleData.filter(itm => itm.type === 'segment')\n                    const segmentDefault = segment.filter(m => m.isDefault === 1)\n                    this.segments = segment\n                    if (this.$route.params.id === undefined || this.$route.params.id === '') {\n                        if (segmentDefault.length > 0) {\n                            this.transaction.segment = segmentDefault[0];\n                        }\n                    }\n                }\n            }else if (roleType === 1) {\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        this.segments = [];\n                        settingsHandler\n                            .getSeg()\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.segments = res.data.data;\n                                }\n                            })\n                    }, 10);\n                });\n            }\n        },\n        async loadLocation() {\n            this.locations = []\n            const roleType = dataStore.roleType || 0\n            if (roleType === 0) {\n                if (dataStore.roleData) {\n                    const roleData = dataStore.roleData || []\n                    const location = roleData.filter(itm => itm.type === 'location')\n                    const locationDefault = location.filter(m => m.isDefault === 1)\n                    this.locations = location\n                    if (this.$route.params.id === undefined || this.$route.params.id === '') {\n                        if (locationDefault.length > 0) {\n                            this.transaction.location = locationDefault[0];\n                        }\n                    }\n                }\n            }else  if (roleType === 1) {\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        this.locations = [];\n                        locationHandler\n                            .list()\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    this.locations = res.data.data;\n                                }\n                            })\n                    }, 10);\n                });\n            }\n        },\n        //\n        hide_smallsitebar() {\n            this.isHideBar = !this.isHideBar;\n        },\n        //\n        onPaymentTermChanged() {\n            // this.onDateChanged();\n            if (this.supplier) {\n                const paymentTerm = this.transaction.paymentTerm || {}\n                const netDue = paymentTerm.netDue || 0;\n                const someDate = new Date(this.transaction.transactionDate);\n                someDate.setDate(someDate.getDate() + parseInt(netDue)); //number  of days to add, e.x. 15 days\n                this.transaction.exspectedDate = someDate\n            }\n        },\n        onChange(event) {\n            const value = event.value;\n            if (value && value[textField] === emptyItem[textField]) {\n                return;\n            }\n            this.supplier = value;\n            this.transaction.supplier = value;\n            // this.invoice = value\n            window.console.log(\"pricelvel\", value)\n            this.transaction.paymentTerm = value.paymentTerm || {};\n            this.transaction.priceLevel = value.priceLevel || {};\n            const baseCurrency = value.baseCurrency || {};\n            if (baseCurrency.hasOwnProperty(\"code\")) {\n                this.baseCurrencyCode = baseCurrency.code;\n            }\n            // this.loadProjectBySupplier()\n            // this.loadPurchase();\n            this.onDateChanged();\n        },\n        onFilterChange(event) {\n            const filter = event.filter.value;\n            this.requestData(0, filter, this.supBaseUrl);\n            this.filter = filter;\n        },\n        requestData(skip, filter, baseUrl) {\n            window.console.log(baseUrl, \"requ\");\n            const url = baseUrl + `?filter=${filter}`;\n            this.requestStarted = true;\n            fetch(url)\n                .then((response) => {\n                    return response.json();\n                })\n                .then(this.afterFetch);\n        },\n        afterFetch(json) {\n            this.supplierList = json.data;\n        },\n        async loadTransactionRate() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const date = new Date(this.transaction.transactionDate)\n                        .toISOString()\n                        .substr(0, 10);\n                    const priceLevel = this.transaction.priceLevel;\n                    let code = \"\";\n                    if (priceLevel.hasOwnProperty(\"currency\")) {\n                        if (priceLevel.currency.hasOwnProperty(\"code\")) {\n                            code = priceLevel.currency.code;\n                        }\n                    }\n                    if (code !== undefined || code !== \"\") {\n                        this.showLoading = true;\n                        currencyHandler\n                            .getLastExchangeRateByDate(date, code)\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    this.exchangeRate = res.data.data[0];\n                                    this.currencyCode = this.exchangeRate.code;\n                                    this.transactionRate = this.exchangeRate.rate;\n                                    this.transaction.txnRate = this.exchangeRate.rate;\n                                    this.transaction.exchangeRate = this.exchangeRate;\n                                    this.showLoading = false;\n                                }\n                            });\n                    }\n                }, 10);\n            });\n        },\n        async onDateChanged() {\n            if (this.supplier) {\n                await this.loadPaymentTermList();\n                await this.loadCreditLimit();\n                await this.loadCustomerBalance(this.supplier.id);\n                await this.onPriceLevelChange();\n                this.transaction.month_of = kendo.toString(new Date(this.transaction.transactionDate), 'yyyy-MM')\n                // const paymentTerm = this.transaction.paymentTerm || {}\n                // if (paymentTerm) {\n                //     const netDue = paymentTerm.netDue || 0;\n                //     let someDate = new Date(this.transaction.transactionDate);\n                //     someDate.setDate(someDate.getDate() + parseInt(netDue)); //number  of days to add, e.x. 15 days\n                //     window.console.log('someDate', someDate, paymentTerm)\n                //     this.transaction.exspectedDate = someDate\n                // }\n                // this.onPaymentTermChanged()\n            }\n            if (this.$route.params.id === undefined && this.isEdit == false) {\n                this.generateNumber();\n            }\n        },\n        generateNumber() {\n            // window.console.log('generateNumber')\n            let d = new Date().toISOString().substr(0, 10);\n            if (this.transaction.transactionDate) {\n                // window.console.log(this.transactionDate)\n                d = this.transaction.transactionDate;\n            }\n            let data = {\n                abbr: this.transaction.transactionType.abbr,\n                structure: this.transaction.transactionType.structure,\n                transactionDate: d,\n                type: \"Purchase Order\",\n            };\n            billingHandler\n                .lastNumber(data)\n                .then((response) => {\n                    if (response.data.statusCode === 200) {\n                        const res = response.data.data;\n                        const lastNumber = this.zeroPad(\n                            parseInt(res.lastNumber),\n                            this.transaction.transactionType.format\n                        );\n                        const number =\n                            res.suffix +\n                            this.transaction.transactionType.numberSeparator +\n                            lastNumber;\n                        this.transaction.number = number;\n                    }\n                })\n                .catch((e) => {\n                    this.errors.push(e);\n                });\n        },\n        zeroPad(num, places) {\n            return String(num).padStart(places, \"0\");\n        },\n        async loadPrefix() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    prefixHandler.get(\"purchase order\").then((res) => {\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false;\n                            this.transactionType = res.data.data;\n                            if (this.transactionType.length > 0) {\n                                this.transaction.transactionType = this.transactionType[0];\n                                if (!this.id) {\n                                    this.generateNumber();\n                                }\n                            }\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async loadPurchaseFormContent() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    purchaseFormContentHandler.list().then((res) => {\n                        if (res.data.statusCode === 200) {\n                            const data = res.data.data;\n                            if (data.length > 0) {\n                                this.purchaseFormContent = data[0];\n                            }\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async loadProjectBySupplier() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    // projectHandler.getBySupplier(this.supplier.id).then(res => {\n                    projectHandler\n                        .list()\n                        .then((res) => {\n                            this.showLoading = true;\n                            if (res.data.statusCode === 200) {\n                                this.showLoading = false;\n                                this.projects = res.data.data;\n                                // if (this.projects.length > 0) {\n                                //     if (!this.id) {\n                                //         this.transaction.project = this.projects[0];\n                                //     }\n                                // }\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 10);\n            });\n        },\n        async loadTax() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    settingHandler.get().then((res) => {\n                        this.tax = res;\n                        this.otherTax = this.tax.filter((m) => m.taxType.typeId === 7); // valuable tax\n                        // this.withholdingTax = this.tax.filter(m => m.taxType.typeId === 2 && m.transactionType === 'Sale') // valuable tax\n                        this.vatTax = this.tax.filter(\n                            (m) =>\n                                m.taxType.typeId === 1 ||\n                                m.taxType.typeId === 8 ||\n                                m.taxType.typeId === 2\n                        ); // valuable tax\n                    });\n                }, 10);\n            });\n        },\n        async loadSaleUnitItems() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    saleUnitItemHandler.list().then((res) => {\n                        if (res.data.statusCode === 200)\n                            this.saleUnitItemList = res.data.data;\n                    });\n                }, 10);\n            });\n        },\n        //itemline\n        removeDuplicate(array) {\n            const result = [];\n            const map = new Map();\n            for (const item of array) {\n                if (!map.has(item.id)) {\n                    map.set(item.id, true); // set any value to Map\n                    result.push(item);\n                }\n            }\n            return result;\n        },\n        autoCalculateDiscount(discountItem, subTotal) {\n            if (discountItem) {\n                const nature = discountItem.nature || ''\n                const amount = discountItem.amount || 0\n                if (nature === 'Amount') {\n                    return parseFloat(amount)\n                } else if (nature === 'Percentage') {\n                    return (subTotal * (parseFloat(amount) / 100))\n                } else {\n                    return 0\n                }\n            } else {\n                return 0\n            }\n        },\n        autoCalculateTax(tax, amount) {\n            if (tax) {\n                var formula = tax.formula;\n                var inAmt = kendo.parseFloat(amount);\n                var nAmt = kendo.parseFloat(amount);\n                var taxBase = kendo.parseFloat(tax.taxBase) / 100;\n                var rate = kendo.parseFloat(tax.rate) / 100;\n                var total = eval(formula);\n                window.console.log(inAmt, nAmt, taxBase, rate, formula, total);\n                // window.console.log(tax, \"tax\");\n                // if (tax.hasOwnProperty(\"taxType\")) {\n                //     if (tax.taxType.nature == \"Deduct\") {\n                //         total = total * -1;\n                //     }\n                // }\n                return total;\n            }\n            // return 0\n        },\n        autoCalculateTaxByType(tax) {\n            // return by a key\n            const groupAll = (list) =>\n                list.reduce((tax, item) => {\n                    const taxAmount = tax[item.name] || 0;\n                    return Object.assign({}, tax, {\n                        [item.name]: taxAmount + parseFloat(item.amount),\n                    });\n                }, {});\n            this.taxListTotal = groupAll(tax);\n            // window.console.log('nimol', groupAll(tax))\n            // this.\n        },\n        dataSourceChanged(e) {\n            if (e.field) {\n                let dataRow = e.items[0],\n                    buom = {},\n                    conversionRate = 1,\n                    wac = 0,\n                    qoh = 0,\n                    amount = 0,\n                    xAmount = 0;\n                switch (e.field) {\n                    case \"item\":\n                        // this.attribute_ = this.attributes.filter(m => m.type.id === dataRow.variant.id)\n                        dataRow.set(\"description\", dataRow.item.description);\n                        buom = dataRow.item.uom || {};\n                        dataRow.set(\"buom\", buom);\n                        // dataRow.set('uom', buom)\n                        // window.console.log(dataRow.item,'row')\n                        // await this.inventoryBalance(dataRow, dataRow.item.id)\n                        break;\n                    case \"cost\":\n                        try {\n                            amount = parseFloat(dataRow.cost) * parseFloat(dataRow.qty);\n                            xAmount = amount * parseFloat(this.transaction.txnRate);\n\n                            dataRow.set(\"cost\", parseFloat(dataRow.cost));\n                            dataRow.set(\"amount\", amount);\n                            dataRow.set(\"exchangeAmount\", xAmount);\n                            // window.console.log('price',dataRow.price)\n                        } catch {\n                            dataRow.set(\"cost\", 0);\n                            dataRow.set(\"amount\", 0);\n                            dataRow.set(\"exchangeAmount\", 0);\n                        }\n                        break;\n                    case \"uom\":\n                        if (this.isPriceLevelChanged === false) {\n                            try {\n                                buom = dataRow.uom.buom || {};\n                                qoh = dataRow.uom.qoh || 0;\n                                conversionRate = dataRow.uom.conversionRate || 1;\n                                wac = dataRow.uom.wac || 0;\n                                dataRow.set(\"buom\", buom);\n                                dataRow.set(\"wac\", wac);\n                                dataRow.set(\"qoh\", qoh);\n                                dataRow.set(\"conversionRate\", parseFloat(conversionRate));\n                                if (dataRow.uom) {\n                                    amount = parseFloat(dataRow.uom.cost) * parseFloat(dataRow.qty);\n                                    xAmount = amount * parseFloat(this.transaction.txnRate);\n\n                                    dataRow.set(\"cost\", parseFloat(dataRow.uom.cost));\n                                    dataRow.set(\"amount\", amount);\n                                    dataRow.set(\"exchangeAmount\", xAmount);\n                                } else {\n                                    amount = parseFloat(dataRow.cost) * parseFloat(dataRow.qty);\n                                    xAmount = amount * parseFloat(this.transaction.txnRate);\n\n                                    dataRow.set(\"cost\", parseFloat(dataRow.cost));\n                                    dataRow.set(\"amount\", amount);\n                                    dataRow.set(\"exchangeAmount\", xAmount);\n                                }\n                            } catch (err) {\n                                window.console.log(\"error\", err);\n                                dataRow.set(\"buom\", {});\n                                dataRow.set(\"conversionRate\", 1);\n                                dataRow.set(\"cost\", 0);\n                                dataRow.set(\"qoh\", 0);\n                                dataRow.set(\"wac\", 0);\n                                dataRow.set(\"amount\", 0);\n                                dataRow.set(\"exchangeAmount\", 0);\n                            }\n                        }\n                        break;\n                    case \"qty\":\n                        try {\n                            amount = parseFloat(dataRow.cost) * parseFloat(dataRow.qty);\n                            xAmount = amount * parseFloat(this.transaction.txnRate);\n\n                            dataRow.set(\"cost\", parseFloat(dataRow.cost));\n                            dataRow.set(\"amount\", amount);\n                            dataRow.set(\"exchangeAmount\", xAmount);\n                        } catch {\n                            dataRow.set(\"cost\", 0);\n                            dataRow.set(\"amount\", 0);\n                            dataRow.set(\"exchangeAmount\", 0);\n                        }\n                        break;\n                    case \"otherTax\":\n                        // window.console.log(\"--\", dataRow)\n                        break;\n                    default:\n                        break;\n                }\n                if (e.field) {\n                    this.autoCalculate();\n                }\n            }\n        },\n        autoCalculate() {\n            let ds = this.$refs.itemLinePODS.kendoWidget(),\n                subTotal = 0,\n                totalTax = 0,\n                discountTotal = 0,\n                spTax = 0,\n                pltax = 0,\n                otherTax = 0,\n                vatTax = 0,\n                discountInvoice = 0,\n                taxList = [],\n                discountItem = [],\n                taxListDetail = [],\n                saleUnit = [],\n                inclusiveTax = 0,\n                itemSubtotal = 0,\n                txnItmSubtotal = 0,\n                serviceSubtotal = 0,\n                itemDiscount = 0,\n                serviceDiscount = 0,\n                withholdingTaxAmount = 0,\n                txnDiscount = 0;\n\n            ds.data().forEach((value) => {\n                let modifierPrice = 0, incTax = 0, taxTypeId = 0;\n                let vatSpTax = {}, vatPLTax = {}, vatOtherTax = {}\n                if (value.modifier) {\n                    modifierPrice = kendo.parseFloat(value.modifier.price || 0);\n                }\n\n                // subTotal += (kendo.parseFloat(value.amount) + modifierPrice)\n                let discount = 0;\n                if (value.discountItem) {\n                    let subTo =\n                        kendo.parseFloat(value.cost) * kendo.parseFloat(value.qty);\n                    discount = this.autoCalculateDiscount(value.discountItem, subTo);\n                    value[\"discountAmount\"] = discount;\n                    value[\"discountExchangeAmount\"] =\n                        discount * kendo.parseFloat(this.transaction.txnRate);\n                    if (value.discountItem.hasOwnProperty(\"id\")) {\n                        discountItem.push(value.discountItem);\n                    }\n                    discountTotal += discount;\n                }\n                if (value.saleUnit) {\n                    if (value.saleUnit.hasOwnProperty(\"id\")) {\n                        saleUnit.push(value.saleUnit);\n                    }\n                }\n                if (value.specificTax) {\n                    spTax = this.autoCalculateTax(\n                        value.specificTax,\n                        kendo.parseFloat(value.amount) - kendo.parseFloat(discount)\n                    );\n                    // window.console.log('sp ', discount)\n                    spTax = kendo.parseFloat(spTax) ? kendo.parseFloat(spTax) : 0;\n                    value[\"specificTaxAmount\"] = spTax;\n                    value[\"specificTaxExchangeAmount\"] =\n                        spTax * kendo.parseFloat(this.transaction.txnRate);\n                    const tax = value.specificTax;\n                    const baseAmount = tax.baseAmount;\n                    if (baseAmount) {\n                        if (baseAmount.toLowerCase() === \"inclusive\") {\n                            inclusiveTax += parseFloat(spTax || 0);\n                            incTax += parseFloat(spTax || 0)\n                        }\n                    }\n                    if (value.specificTax.hasOwnProperty(\"taxType\")) {\n                        taxList.push({\n                            name: value.specificTax.taxType.name,\n                            amount: spTax,\n                            id: value.specificTax.taxType.id,\n                        });\n                        const spTax_ = value.specificTax || {}\n                        spTax_['taxAmount_'] = spTax\n                        // spTax_['taxAmount'] = spTax\n                        spTax_['amount'] = value.amount || 0\n                        spTax_['discount'] = discount || 0\n                        spTax_['txnRate'] = this.transaction.txnRate || 1\n                        taxListDetail.push(spTax_);\n                        vatSpTax = spTax_\n                    }\n                }\n                if (value.publicLightingTax) {\n                    pltax = this.autoCalculateTax(\n                        value.publicLightingTax,\n                        kendo.parseFloat(value.amount) - kendo.parseFloat(discount)\n                    );\n                    pltax = kendo.parseFloat(pltax) ? kendo.parseFloat(pltax) : 0;\n                    value[\"publicLightingTaxAmount\"] = pltax;\n                    value[\"publicLightingTaxExchangeAmount\"] =\n                        pltax * kendo.parseFloat(this.transaction.txnRate);\n                    const tax = value.publicLightingTax;\n                    const baseAmount = tax.baseAmount;\n                    if (baseAmount) {\n                        if (baseAmount.toLowerCase() === \"inclusive\") {\n                            inclusiveTax += parseFloat(pltax || 0);\n                            incTax += parseFloat(pltax || 0)\n                        }\n                    }\n                    if (value.publicLightingTax.hasOwnProperty(\"taxType\")) {\n                        taxList.push({\n                            name: value.publicLightingTax.taxType.name,\n                            amount: pltax,\n                            id: value.publicLightingTax.taxType.id,\n                        });\n                        const plTax_ = value.publicLightingTax || {}\n                        // tax_['taxAmount'] = pltax\n                        plTax_['taxAmount_'] = pltax\n                        plTax_['amount'] = value.amount || 0\n                        plTax_['discount'] = discount || 0\n                        plTax_['txnRate'] = this.transaction.txnRate || 1\n                        taxListDetail.push(plTax_);\n                        vatPLTax = plTax_\n                    }\n                }\n                if (value.otherTax) {\n                    otherTax = this.autoCalculateTax(\n                        value.otherTax,\n                        kendo.parseFloat(value.amount) - kendo.parseFloat(discount)\n                    );\n                    otherTax = kendo.parseFloat(otherTax)\n                        ? kendo.parseFloat(otherTax)\n                        : 0;\n                    value[\"otherTaxAmount\"] = otherTax;\n                    value[\"otherTaxExchangeAmount\"] =\n                        otherTax * kendo.parseFloat(this.transaction.txnRate);\n                    const tax = value.otherTax;\n                    const baseAmount = tax.baseAmount;\n                    if (baseAmount) {\n                        if (baseAmount.toLowerCase() === \"inclusive\") {\n                            inclusiveTax += parseFloat(otherTax || 0);\n                            incTax += parseFloat(otherTax || 0)\n                        }\n                    }\n                    if (value.otherTax.hasOwnProperty(\"taxType\")) {\n                        taxList.push({\n                            name: value.otherTax.taxType.name,\n                            amount: otherTax,\n                            id: value.otherTax.taxType.id,\n                        });\n                        const tax__ = value.specificTax || {}\n                        // tax__['taxAmount'] = otherTax\n                        tax__['taxAmount_'] = otherTax\n                        tax__['amount'] = value.amount || 0\n                        tax__['discount'] = discount || 0\n                        tax__['txnRate'] = this.transaction.txnRate || 1\n                        taxListDetail.push(tax__);\n                        vatOtherTax = tax__\n                    }\n                }\n\n                if (value.vatTax) {\n                    // window.console.log('Vat Tax', value.vatTax)\n                    let amt =\n                        kendo.parseFloat(spTax ? spTax : 0) +\n                        kendo.parseFloat(pltax ? pltax : 0) +\n                        kendo.parseFloat(otherTax ? otherTax : 0) +\n                        (kendo.parseFloat(value.amount ? value.amount : 0) -\n                            (discount ? discount : 0));\n                    vatTax = this.autoCalculateTax(value.vatTax, amt);\n                    vatTax = kendo.parseFloat(vatTax) ? kendo.parseFloat(vatTax) : 0;\n                    value[\"vatTaxAmount\"] = vatTax;\n                    value[\"vatTaxExchangeAmount\"] =\n                        vatTax * kendo.parseFloat(this.transaction.txnRate);\n                    const tax = value.vatTax;\n                    const baseAmount = tax.baseAmount;\n                    if (baseAmount) {\n                        if (baseAmount.toLowerCase() === \"inclusive\") {\n                            inclusiveTax += vatTax;\n                            incTax += vatTax\n                        }\n                    }\n                    if (value.vatTax.hasOwnProperty(\"taxType\")) {\n                        const taxType = value.vatTax.taxType || {};\n                        taxTypeId = taxType.typeId || 0;\n                    }\n                    if (taxTypeId === 2) {\n                        withholdingTaxAmount += vatTax;\n                    }\n                    if (value.vatTax.hasOwnProperty(\"taxType\")) {\n                        taxList.push({\n                            name: value.vatTax.taxType.name,\n                            amount: vatTax,\n                            id: value.vatTax.taxType.id,\n                        });\n                        const vatTax_ = value.vatTax || {}\n                        // vatTax_['taxAmount'] = vatTax\n                        vatTax_['taxAmount_'] = vatTax\n                        vatTax_['amount'] = value.amount || 0\n                        vatTax_['discount'] = discount || 0\n                        vatTax_['txnRate'] = this.transaction.txnRate || 1\n                        vatTax_['isVat'] = 1\n                        vatTax_.detail = {\n                            specificTax: vatSpTax,\n                            publicLightingTax: vatPLTax,\n                            otherTax: vatOtherTax,\n                        }\n                        taxListDetail.push(vatTax_);\n                    }\n                }\n                totalTax +=\n                    kendo.parseFloat(spTax ? spTax : 0) +\n                    kendo.parseFloat(pltax ? pltax : 0) +\n                    kendo.parseFloat(otherTax ? otherTax : 0) +\n                    kendo.parseFloat(vatTax ? vatTax : 0);\n                subTotal +=\n                    kendo.parseFloat(value.amount) + modifierPrice - incTax;\n                window.console.log('subTotal ', subTotal, ' value.amount=', value.amount, ' modifierPrice=', modifierPrice)\n\n                const item = value.item;\n                const itmType = item.type || \"\";\n                if (itmType === \"Variant\") {\n                    itemSubtotal +=\n                        kendo.parseFloat(value.cost) * kendo.parseFloat(value.qty);\n                    itemDiscount += kendo.parseFloat(discount);\n                } else if (itmType === \"Service\") {\n                    serviceSubtotal +=\n                        kendo.parseFloat(value.cost) * kendo.parseFloat(value.qty);\n                    itemDiscount += kendo.parseFloat(discount);\n                } else {\n                    txnItmSubtotal +=\n                        kendo.parseFloat(value.cost) * kendo.parseFloat(value.qty);\n                    itemDiscount += kendo.parseFloat(discount);\n                }\n\n                //include Tax Amount\n                const amountNodiscount =\n                    kendo.parseFloat(value.cost) * kendo.parseFloat(value.qty) -\n                    discount;\n                const includeTaxAmount =\n                    amountNodiscount + vatTax + pltax + spTax + otherTax;\n                value[\"includeTaxAmount\"] = includeTaxAmount;\n                value[\"includeTaxExchangeAmount\"] =\n                    includeTaxAmount * kendo.parseFloat(this.transaction.txnRate);\n            });\n            this.transaction.itemSubtotal = itemSubtotal;\n            this.transaction.inclusiveTaxAmount = inclusiveTax;\n            this.transaction.exchangeItemSubtotal =\n                itemSubtotal * kendo.parseFloat(this.transaction.txnRate);\n            this.transaction.serviceSubtotal = serviceSubtotal;\n            this.transaction.exchangeServiceSubtotal =\n                serviceSubtotal * kendo.parseFloat(this.transaction.txnRate);\n            this.transaction.txnItmSubtotal = txnItmSubtotal;\n            this.transaction.exchangeTxnItmSubtotal =\n                txnItmSubtotal * kendo.parseFloat(this.transaction.txnRate);\n            this.transaction.itemDiscount = itemDiscount;\n            this.transaction.exchangeItemDiscount =\n                itemDiscount * kendo.parseFloat(this.transaction.txnRate);\n            this.transaction.serviceDiscount = serviceDiscount;\n            this.transaction.exchangeServiceDiscount =\n                serviceDiscount * kendo.parseFloat(this.transaction.txnRate);\n            this.transaction.txnItmDiscount = txnDiscount;\n            this.transaction.exchangeTxnItmDiscount =\n                txnDiscount * kendo.parseFloat(this.transaction.txnRate);\n            discountTotal = discountTotal ? discountTotal : 0;\n\n            // window.console.log(spTax, pltax, otherTax, vatTax)\n            let total =\n                kendo.parseFloat(subTotal) -\n                kendo.parseFloat(discountTotal) +\n                kendo.parseFloat(totalTax);\n            this.transaction.subTotal = subTotal;\n            $(\"#subtotal\").text(kendo.parseFloat(subTotal));\n            this.transaction.withholdingTaxAmount = withholdingTaxAmount\n            this.transaction.totalTaxAmount = kendo.parseFloat(totalTax);\n            this.transaction.discountTotal = kendo.parseFloat(discountTotal);\n            if (this.transaction.specificDiscountItem) {\n                discountInvoice = this.autoCalculateDiscount(\n                    this.transaction.specificDiscountItem,\n                    kendo.parseFloat(subTotal)\n                );\n                discountInvoice = discountInvoice ? discountInvoice : 0;\n            }\n            // this.onOtherChargeChange()\n            this.transaction.total = kendo.parseFloat(total) - discountInvoice - parseFloat(withholdingTaxAmount);\n            this.transaction.exchangeAmount =\n                kendo.parseFloat(this.transaction.total) *\n                kendo.parseFloat(this.transaction.txnRate);\n            this.autoCalculateTaxByType(taxList);\n            this.discountItem = this.removeDuplicate(discountItem);\n            this.saleUnit = this.removeDuplicate(saleUnit);\n            this.taxListDetail = taxListDetail\n            this.autoCalculateTaxDetail();\n            // window.console.log('discount ', this.customerDiscountItem)\n        },\n        rowNumberTmpl(dataItem) {\n            let ds = this.$refs.itemLinePODS.kendoWidget(),\n                index = ds.indexOf(dataItem);\n            return index + 1;\n        },\n        vatTemplate(dataItem) {\n            const vat = dataItem.vatTax;\n            if (vat) {\n                return `<span>${vat.defaultTax ? vat.defaultTax : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        itemTemplate(dataItem) {\n            const item = dataItem.item;\n            if (item) {\n                return `<span>${item.name ? item.name : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        UOMTemplate(dataItem) {\n            const uom = dataItem.uom;\n            if (uom) {\n                return `<span>${uom.uom ? uom.uom.name : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        saleUnitTemplate(dataItem) {\n            const saleUnit = dataItem.saleUnit;\n            if (saleUnit) {\n                return `<span>${saleUnit.name ? saleUnit.name : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        discountItemTemplate(dataItem) {\n            const discountItem = dataItem.discountItem;\n            if (discountItem) {\n                return `<span>${discountItem.code ? discountItem.code : ``} - ${\n                    discountItem.name ? discountItem.name : ``\n                }</span>`;\n            } else {\n                return ``;\n            }\n        },\n        ServiceDateEditor(container, options) {\n            kendo\n                .jQuery('<input required name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDatePicker();\n\n            // let ds = this.$refs.itemLineDS.kendoWidget()\n            // window.console.log(ds.data())\n            // // const dateString = kendo.toString((new Date(options.model.items.serviceDate)), this.itemLine.dateFormat)\n            // // const dateString = kendo.toString(options.model.items.serviceDate)\n            // const $input = $(\"<input value=\" + options.model.serviceDate + \" />\").appendTo(container)\n            // $input.kendoDatePicker()\n            // // $input.appendTo(container)\n            // // options.model.items.serviceDate = dateString\n            // window.console.log($input)\n        },\n        ServiceDateToEditor(container, options) {\n            kendo\n                .jQuery('<input required name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDatePicker();\n        },\n        ItemDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input required name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"contains\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    headerTemplate: \"\",\n                    template: \"<span>#=name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        serverFiltering: true,\n                        transport: {\n                            read: {\n                                url: productVariantHandler.itemSearchURL(),\n                            },\n                            dataType: \"json\",\n                        },\n                        schema: {\n                            model: {\n                                id: \"id\",\n                                fields: {\n                                    id: {type: \"string\"},\n                                    name: {type: \"string\"},\n                                    sku: {type: \"string\"},\n                                },\n                            },\n                            data: function (response) {\n                                return response.data;\n                            },\n                            total: function (response) {\n                                return response.data.count;\n                            },\n                        },\n                        // data: this.variants\n                    }),\n                });\n        },\n        UOMDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"uom.name\",\n                    dataValueField: \"uom.id\",\n                    cascadeFrom: \"item\",\n                    template: \"<span>#=uom.name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        serverFiltering: true,\n                        transport: {\n                            read: {\n                                url: uomPriceHandler.uomPriceByPriceLevelURL(\n                                    \"id=\" +\n                                    options.model.item.id +\n                                    \"&plId=\" +\n                                    this.transaction.priceLevel.id +\n                                    \"&date=\" +\n                                    this.transaction.transactionDate + \"&nature=purchase\"\n                                ),\n                            },\n                            dataType: \"json\",\n                        },\n                        schema: {\n                            model: {\n                                id: \"id\",\n                                fields: {\n                                    id: {type: \"string\"},\n                                    // name: {type: \"string\"},\n                                    // sku: {type: \"string\"},\n                                },\n                            },\n                            data: function (response) {\n                                return response.data;\n                            },\n                            total: function (response) {\n                                return response.data.count;\n                            },\n                        },\n                        // data: this.variants\n                    }),\n                });\n        },\n        DiscountItemDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    cascadeFrom: \"item\",\n                    template: \"<span>#=code# - #=name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        serverFiltering: true,\n                        transport: {\n                            read: {\n                                url: discountItemHandler.getURL(DISCOUNT_TYPE),\n                            },\n                            dataType: \"json\",\n                        },\n                        schema: {\n                            model: {\n                                id: \"id\",\n                                fields: {\n                                    id: {type: \"string\"},\n                                    // name: {type: \"string\"},\n                                    // sku: {type: \"string\"},\n                                },\n                            },\n                            data: function (response) {\n                                return response.data;\n                            },\n                            total: function (response) {\n                                return response.data.count;\n                            },\n                        },\n                    }),\n                });\n        },\n        PublicLightingTaxDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"defaultTax\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=defaultTax#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.publicLightingTax.filter((m) => {\n                            if (options.model.hasOwnProperty(\"vatTax\")) {\n                                const vat = options.model.vatTax;\n                                if (vat) {\n                                    if (\n                                        options.model.vatTax !== null &&\n                                        options.model.vatTax !== \"null\"\n                                    ) {\n                                        if (options.model.vatTax.baseAmount) {\n                                            return (\n                                                m.baseAmount.toLowerCase() ===\n                                                options.model.vatTax.baseAmount.toLowerCase()\n                                            );\n                                        } else {\n                                            return m;\n                                        }\n                                    }\n                                } else {\n                                    return m;\n                                }\n                            }\n                        }),\n                    }),\n                });\n        },\n        OtherTaxDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"defaultTax\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=defaultTax#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.otherTax.filter((m) => {\n                            if (options.model.hasOwnProperty(\"vatTax\")) {\n                                const vat = options.model.vatTax;\n                                if (vat) {\n                                    if (\n                                        options.model.vatTax !== null &&\n                                        options.model.vatTax !== \"null\"\n                                    ) {\n                                        if (options.model.vatTax.baseAmount) {\n                                            return (\n                                                m.baseAmount.toLowerCase() ===\n                                                options.model.vatTax.baseAmount.toLowerCase()\n                                            );\n                                        } else {\n                                            return m;\n                                        }\n                                    }\n                                } else {\n                                    return m;\n                                }\n                            }\n                        }),\n                    }),\n                });\n        },\n        VatTaxDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"defaultTax\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=defaultTax#</span>\",\n                    optionLabel: \"--Select--\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.vatTax,\n                    }),\n                });\n        },\n        SaleUnitDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=code# - #=name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.saleUnitItemList,\n                    }),\n                });\n        },\n        EmployeeDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoMultiSelect({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    suggest: true,\n                    filter: \"contains\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    headerTemplate:\n                        '<div class=\"dropdown-header k-widget k-header\">' +\n                        \"<span>Employee </span>\" +\n                        \"<span></span>\" +\n                        \"</div>\",\n                    template: \"<span>#=name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        serverFiltering: true,\n                        transport: {\n                            read: {\n                                url: employeeHandler.searchURL(),\n                            },\n                            dataType: \"json\",\n                        },\n                        schema: {\n                            model: {\n                                id: \"id\",\n                                fields: {\n                                    id: {type: \"string\"},\n                                    name: {type: \"string\"},\n                                    firstName: {type: \"string\"},\n                                    lastName: {type: \"string\"},\n                                },\n                            },\n                            data: function (response) {\n                                return response.data;\n                            },\n                            total: function (response) {\n                                return response.data.count;\n                            },\n                        },\n                    }),\n                });\n        },\n        empImpl(dataItem) {\n            let empIds = [];\n            dataItem.employee.forEach((m) => {\n                empIds.push(m.firstName + \" - \" + m.lastName);\n            });\n            // window.console.log(empIds.join(', '))\n            return `<span>${empIds.join(\", \")}</span>`;\n        },\n        removeRow(e) {\n            e.preventDefault();\n            const grid = kendo.jQuery(\"#gridItemLine\").data(\"kendoGrid\"),\n                dataSource = grid.dataSource,\n                dataItem = grid.dataItem($(e.currentTarget).closest(\"tr\"));\n\n            if (dataSource.total() > 1) {\n                dataSource.remove(dataItem);\n            }\n        },\n        errorMessage() {\n        },\n        //catalog\n        loadImage(dataItem) {\n            if (dataItem.hasOwnProperty(\"images\")) {\n                if (dataItem.images.hasOwnProperty(\"default\")) {\n                    const url = this.imgURL + dataItem.images.default.thumb;\n                    return (\n                        \"<img width='50' height='50' style= 'margin: auto;display: block;' src='\" +\n                        url +\n                        \"' />\"\n                    );\n                }\n            } else {\n                return \"\";\n            }\n        },\n        async loadCatalogs() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    this.showLoading = true;\n                    catalogHandler.get().then((res) => {\n                        this.showLoading = false;\n                        this.catalogs = res;\n                    });\n                }, 10);\n            });\n        },\n        addCatalog(e) {\n            e.preventDefault();\n            let grid = kendo.jQuery(\"#gridCatalog\").data(\"kendoGrid\");\n            let dataItem = grid.dataItem($(e.currentTarget).closest(\"tr\"));\n            // window.console.log(dataItem)\n            if (dataItem.variants.length > 0) {\n                dataItem.variants.forEach((m) => {\n                    if (m.hasOwnProperty(\"variant\")) {\n                        if (m.variant.hasOwnProperty(\"id\")) {\n                            this.loadSingleItem(m.variant.id, \"i\");\n                        }\n                    }\n                });\n                this.dialogCatalog = false;\n            }\n            if (dataItem.services.length > 0) {\n                dataItem.services.forEach((m) => {\n                    if (m.hasOwnProperty(\"service\")) {\n                        if (m.service.hasOwnProperty(\"id\")) {\n                            this.loadSingleItem(m.service.id, \"s\");\n                        }\n                    }\n                });\n                this.dialogCatalog = false;\n            }\n        },\n        async loadSingleItem(itemId, type) {\n            new Promise((resolve) => {\n                resolve(\"resolved\");\n                setTimeout(() => {\n                    this.showLoading = true;\n                    productHandler.getOne(itemId).then((res) => {\n                        this.showLoading = false;\n                        let data = res;\n                        let ds = this.$refs.itemLinePODS.kendoWidget(),\n                            total = ds.total();\n                        this.itemLine.id = transactionPrefix + uuid.v1();\n                        this.itemLine.item = data;\n                        if (type == \"i\") {\n                            this.itemLine.description = data.variant.saleDescription;\n                        } else {\n                            this.itemLine.description = data.saleDescription;\n                        }\n                        ds.insert(total, this.itemLine);\n                    });\n                }, 500);\n            });\n        },\n        onEmployeeChanged(event) {\n            const value = event.value;\n            if (value && value[textField] === emptyItem[textField]) {\n                return;\n            }\n            this.mEmployee = value;\n            this.transaction.employee = value;\n        },\n        async loadEmployeeCenter() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    this.employees = [];\n                    employeeHandler\n                        .center(undefined)\n                        .then((res) => {\n                            this.showLoading = true;\n                            if (res.data.statusCode === 200) {\n                                this.showLoading = false;\n                                this.employees = res.data.data;\n                                // if (this.employees.length > 0) {\n                                //     this.transaction.employee = this.employees[0];\n                                // }\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 10);\n            });\n        },\n        onEmployeeFilterChanged() {\n        },\n        numberFormat(value) {\n            // window.console.log(this.saleFormContent.decimal,'nimol')\n            return kendo.toString(value, `n${this.purchaseFormContent.decimal}`);\n            // return value\n        },\n        async loadTxn() {\n            if (this.saleOrder.customer) {\n                this.showLoading = true;\n                this.quotes = [];\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        let data = {\n                            method: \"by_customer\",\n                            customer: this.transaction.supplier.id,\n                            type: \"Sale Order\",\n                        };\n                        transactionHandler.search(data).then((res) => {\n                            this.showLoading = false;\n                            this.txnTobeAdd = res.data.data;\n                        });\n                    }, 10);\n                });\n            }\n        },\n        removeEmptyLine() {\n            const grid = kendo.jQuery(\"#gridItemLine\").data(\"kendoGrid\"),\n                dataSource = grid.dataSource;\n            dataSource.data().forEach((m) => {\n                if (m.item.id === undefined) {\n                    dataSource.remove(m);\n                }\n            });\n        },\n        //save\n        clear() {\n\n        },\n        close(data) {\n            // if (this.$route.params.id === undefined) {\n            //     this.$router.push({\n            //         name: \"PurchaseOrder\",\n            //         params: {\n            //             data: data,\n            //         }\n            //     })\n            // } else {\n            window.history.go(-1);\n            // }\n            window.console.log(data, \"close\");\n            // localStorage.data.id = JSON.stringify(data)\n        },\n        async loadPurchase() {\n            if (this.transaction.supplier) {\n                this.showLoading = true;\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        let data = {\n                            method: \"by_supplier\",\n                            supplier: this.transaction.supplier.id,\n                            type: \"Purchase Order\",\n                        };\n                        transactionHandler.search(data).then((res) => {\n                            this.showLoading = false;\n                            window.console.log(res, \"search by supplier\");\n                        });\n                    }, 10);\n                });\n            }\n        },\n        saveClose() {\n            if (!this.$refs.form.validate()) {\n                this.$refs.form.validate();\n                return;\n            }\n            let id = \"\";\n            if (this.supplier.hasOwnProperty(\"id\")) {\n                id = this.supplier.id || \"\";\n            }\n            if (id === \"\") {\n                this.$snotify.error(\"supplier is require\");\n                return;\n            }\n            let ds = this.$refs.itemLinePODS.kendoWidget();\n            let d1 = ds.data();\n            let dataValidate = 0;\n            d1.forEach((value, index) => {\n                if (\n                    value.item.id == undefined ||\n                    value.uom.uom.id == undefined ||\n                    value.item.id == \"\" ||\n                    value.uom.uom.id == \"\"\n                ) {\n                    this.$snotify.error(\n                        \"Please check Item or Uom  on row \" + (index + 1)\n                    );\n                } else {\n                    dataValidate += 1;\n                }\n            });\n            if (d1.length == dataValidate) {\n                this.isSaveClose = true;\n                this.saveOption = \"saveClose\";\n                this.save();\n            }\n        },\n        savePrint() {\n            if (!this.$refs.form.validate()) {\n                this.$refs.form.validate();\n                return;\n            }\n            let id = \"\";\n            if (this.supplier.hasOwnProperty(\"id\")) {\n                id = this.supplier.id || \"\";\n            }\n            if (id === \"\") {\n                this.$snotify.error(\"supplier is require\");\n                return;\n            }\n            let ds = this.$refs.itemLinePODS.kendoWidget();\n            let d1 = ds.data();\n            let dataValidate = 0;\n            d1.forEach((value, index) => {\n                if (\n                    value.item.id == undefined ||\n                    value.uom.id == undefined ||\n                    value.item.id == \"\" ||\n                    value.uom.id == \"\"\n                ) {\n                    this.$snotify.error(\n                        \"Please check Item or Uom  on row \" + (index + 1)\n                    );\n                } else {\n                    dataValidate += 1;\n                }\n            });\n            if (d1.length == dataValidate) {\n                this.isSavePrint = true;\n                this.saveOption = \"savePrint\";\n                this.save();\n            }\n        },\n        saveNew() {\n            if (!this.$refs.form.validate()) {\n                this.$refs.form.validate();\n                return;\n            }\n            let id = \"\";\n            if (this.supplier.hasOwnProperty(\"id\")) {\n                id = this.supplier.id || \"\";\n            }\n            if (id === \"\") {\n                this.$snotify.error(\"supplier is require\");\n                return;\n            }\n            let ds = this.$refs.itemLinePODS.kendoWidget();\n            let d1 = ds.data();\n            let dataValidate = 0;\n            d1.forEach((value, index) => {\n                if (\n                    value.item.id == undefined ||\n                    value.item.id == \"\" ||\n                    value.uom.uom == undefined\n                ) {\n                    this.$snotify.error(\n                        \"Please check Item or Uom  on row \" + (index + 1)\n                    );\n                } else {\n                    dataValidate += 1;\n                }\n            });\n            if (d1.length == dataValidate) {\n                this.saveOption = \"saveNew\";\n                this.isSaveNew = true;\n                this.save();\n            }\n        },\n        cancel() {\n            this.$swal({\n                title: i18n.t(\"msg_title_warning\"),\n                text: i18n.t(\"msg_discard\"),\n                icon: \"warning\",\n                showCancelButton: true,\n                cancelButtonText: i18n.t(\"cancel\"),\n                confirmButtonColor: \"#4d4848\",\n                cancelButtonColor: \"#ED1A3A\",\n                confirmButtonText: i18n.t(\"discard\"),\n            }).then((resultCen) => {\n                window.console.log(resultCen);\n                if (resultCen.value) {\n                    this.$router.go(-1);\n                }\n            });\n        },\n        saveDraft() {\n            if (!this.$refs.form.validate()) {\n                this.$refs.form.validate();\n                return;\n            }\n            let id = \"\";\n            if (this.supplier.hasOwnProperty(\"id\")) {\n                id = this.supplier.id || \"\";\n            }\n            if (id === \"\") {\n                this.$snotify.error(\"supplier is require\");\n                return;\n            }\n            let ds = this.$refs.itemLinePODS.kendoWidget();\n            let d1 = ds.data();\n            let dataValidate = 0;\n            d1.forEach((value, index) => {\n                if (\n                    value.item.id == undefined ||\n                    value.uom.id == undefined ||\n                    value.item.id == \"\" ||\n                    value.uom.id == \"\"\n                ) {\n                    this.$snotify.error(\n                        \"Please check Item or Uom  on row \" + (index + 1)\n                    );\n                } else {\n                    dataValidate += 1;\n                }\n            });\n            if (d1.length == dataValidate) {\n                this.saveOption = \"saveDraft\";\n                this.isSaveDraft = true;\n                this.save();\n            }\n        },\n        async save() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    this.removeEmptyLine();\n                    let itemLineDS = this.$refs.itemLinePODS.kendoWidget(),\n                        total = itemLineDS.total();\n                    if (total <= 0) {\n                        this.$snotify.error(\"Field Required!\");\n                        return;\n                    }\n                    const dataRow = itemLineDS\n                        .data()\n                        .filter((o) => o.amount > 0)\n                        .map((n) => {\n                            return new ItemLineModel(n);\n                        });\n                    let txnList = [];\n                    const lead = this.transaction.lead || {}\n                    const leadId = lead.id || ''\n                    if (leadId) {\n                        txnList.push(lead);\n                    }\n                    let data = {\n                        id: this.transaction.id ? this.transaction.id : \"\",\n                        type: \"Purchase Order\",\n                        number: this.transaction.number,\n                        abbr: this.transaction.transactionType.abbr,\n                        transactionDate: this.transaction.transactionDate,\n                        validityDate: \"\",\n                        monthOf: this.transaction.monthOf,\n                        customer: {},\n                        paymentTerm: this.transaction.paymentTerm,\n                        transactionType: this.transaction.transactionType,\n                        discountPromotion: {},\n                        priceLevel: this.transaction.priceLevel,\n                        itemLines: dataRow,\n                        project: this.transaction.project || {},\n                        segment: this.transaction.segment ? this.transaction.segment : {},\n                        location: this.transaction.location ? this.transaction.location : {},\n                        saleChannel: {},\n                        billingAddress: {},\n                        deliveryAddress: {},\n                        deliveryDateTime: \"\",\n                        transactionNote: this.transaction.transactionNote,\n                        subTotal: this.transaction.subTotal,\n                        total: this.transaction.total ? this.transaction.total : 0,\n                        discountTotal: this.transaction.discountTotal,\n                        exchangeAmount: this.transaction.exchangeAmount,\n                        specificDiscountTotal: this.transaction.specificDiscountTotal,\n                        deliveryFee: this.transaction.deliveryFee,\n                        totalTaxAmount: this.transaction.totalTaxAmount,\n                        currentBalance: this.transaction.currentBalance,\n                        balance: 0,\n                        creditLimit: 0,\n                        saveOption: this.saveOption,\n                        txnRate: this.transaction.txnRate,\n                        rate: this.transaction.txnRate,\n                        status: 1, //1 open, 0 used,\n                        approvedBy: this.transaction.approvedBy,\n                        rejectedBy: {},\n                        formTemplate: \"\",\n                        specificDiscountItem: this.transaction.specificDiscountItem,\n                        otherCharge: [],\n                        otherChargeAmount: 0,\n                        taxListTotal: this.taxListTotal,\n                        progressingStatus: \"\",\n                        customerSaleUnit: this.customerSaleUnit,\n                        loggedUser: this.loggedUser,\n                        txnList: txnList,\n                        publicLink: \"\",\n                        usedDateAt: \"\",\n                        deletedAt: \"\",\n                        deleted: 0,\n                        createdAt: new Date().toISOString().substr(0, 10),\n                        saleOrderType: 0,\n                        employee: this.transaction.employee,\n                        supplier: this.transaction.supplier,\n                        exchangeRate: this.transaction.exchangeRate,\n                        form: 1,\n                        lead: {},\n                        refFrom: this.transaction.refFrom || [],\n                        refTo: this.transaction.refTo || [],\n                        exspectedDate: this.transaction.exspectedDate,\n                        amountDue: this.transaction.amountDue,\n                        saleTaxDetail: this.transaction.saleTaxDetail || [],\n                        inclusiveTaxAmount: this.transaction.inclusiveTaxAmount || 0,\n                        routeView: \"purchase_order_view\",\n                    };\n                    window.console.log('this.transaction.supplier', JSON.stringify(this.transaction.supplier))\n                    this.showLoading = true;\n                    transactionHandler\n                        .create(data)\n                        .then((response) => {\n                            this.showLoading = false;\n                            if (response.data.statusCode === 201) {\n                                if (this.isSaveNew == true) {\n                                    this.setDefaultData();\n                                } else {\n                                    this.close(response.data.data);\n                                }\n                                this.$refs.form.reset();\n                                this.$snotify.success(\"Successfully\");\n                            }\n                        })\n                        .catch((e) => {\n                            window.console.log(2);\n                            this.$snotify.error(\"Something went wrong\");\n                            this.errors.push(e);\n                            window.console.log(e);\n                        });\n                }, 10);\n            });\n        },\n        async loadViewPurchaseOrder() {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved')\n                    this.showLoading = true\n                    this.isEdit = false\n                    const id = this.$route.params.id\n                    const strFilter = '?type=Purchase Order'\n                    billingHandler.viewPurchase(id, strFilter).then(async (res) => {\n                        if (res.data.statusCode === 200) {\n                            this.isEdit = true\n                            this.showLoading = false\n                            const response = res.data.data[0]\n                            this.transaction = response\n                            // await this.onDateChanged()\n                            this.supplier = this.transaction.supplier || {}\n                            this.mEmployee = this.transaction.employee || {}\n                            this.itemLines = this.transaction.itemLines || []\n                            // this.transaction.paymentTerm = response.paymentTerm || {}\n                            this.transaction.month_of = kendo.toString(new Date(this.transaction.transactionDate), 'yyyy-MM')\n                            window.console.log('transaction.paymentTerm', response.paymentTerm)\n                        } else {\n                            this.showLoading = false\n                            this.isEdit = false\n                        }\n                    })\n                }, 10)\n            })\n        },\n    },\n    watch: {\n        '$route': 'initialData'\n        // initPurchaseOrder() {\n        //   this.initialData();\n        // },\n    },\n    created() {\n        this.loadTax();\n        this.loadSaleUnitItems();\n        this.loadSegment();\n        this.loadLocation();\n        this.loadProjectBySupplier();\n    },\n    mounted: async function () {\n        await this.loadPurchaseFormContent();\n        this.requestData(0, this.filter, this.supBaseUrl);\n        await this.loadEmployeeCenter();\n        await this.loadCatalogs();\n        await this.initialData();\n    },\n    computed: {\n        valid1: function () {\n            let supplier = this.transaction.supplier;\n            window.console.log(1, supplier.id);\n            return supplier.id !== undefined && supplier.id !== null;\n        },\n        validationMessage: function () {\n            let supplier = this.transaction.supplier;\n            window.console.log(2, supplier.id);\n            return supplier.id !== undefined && supplier.id === null\n                ? \"Please select a Vendor!\"\n                : \"Please select a Vendor\";\n        },\n        hiddenButton() {\n            return !!this.$route.params.id;\n        }\n    },\n};\n</script>\n\n<style scoped>\n.small_sidebar {\n    height: 97%;\n    position: relative;\n    padding: 12px;\n}\n\n.hide_small_bar_class {\n    max-width: 0;\n    transition: 0.5s ease-in;\n    flex: 0 0 0;\n    padding: 0;\n}\n\n.hide_big_bar_class {\n    max-width: 100%;\n    transition: 0.5s ease-in;\n    flex: 0 0 100%;\n}\n\n.iconArrow {\n    right: -35px;\n    position: absolute;\n    bottom: -10px;\n}\n\n.iconArrowHide {\n    position: absolute;\n    right: -7px;\n    bottom: -10px;\n}\n\n.theme--light.v-data-table\n> .v-data-table__wrapper\n> table\n> tbody\n> tr:hover:not(.v-data-table__expanded__content):not(.v-data-table__empty-wrapper) {\n    background-color: transparent !important;\n}\n\n.detial_smallside_p {\n    position: absolute;\n    bottom: 10px;\n}\n</style>\n"]}]}