{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/finances/management/loan_center/ListOfLoan.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/finances/management/loan_center/ListOfLoan.vue","mtime":1638499443236},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGkxOG4gfSBmcm9tICdAL2kxOG4nOwppbXBvcnQga2VuZG8gZnJvbSAiQHByb2dyZXNzL2tlbmRvLXVpIgpjb25zdCAkID0ga2VuZG8ualF1ZXJ5CmNvbnN0IGN1cnJlbmN5SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9jdXJyZW5jeS9oYW5kbGVyL2N1cnJlbmN5SGFuZGxlciIpCmltcG9ydCBMb2FuUmVjZWlwdE1vZGVsIGZyb20gJ0Avc2NyaXB0cy9maW5hbmNpbmcvbW9kZWwvTG9hblJlY2VpcHQnCmltcG9ydCB7ZGF0YVN0b3JlfSBmcm9tICdAL29ic2VydmFibGUvc3RvcmUnCmNvbnN0IGxvYW5IYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2ZpbmFuY2luZy9oYW5kbGVyL2xvYW5IYW5kbGVyIikKY29uc3QgYWNjb3VudEhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvaGFuZGxlci9hY2NvdW50aW5nL2FjY291bnQiKQovLyBqb3VybmFsCmNvbnN0IHN0b3JlID0gcmVxdWlyZSgiQC9pbnN0aXR1dGUuanMiKQpjb25zdCB7Y29va2llc30gPSBzdG9yZS5kZWZhdWx0LnN0YXRlCmltcG9ydCB7Sm91cm5hbE1vZGVsLCBVc2VyTW9kZWx9IGZyb20gIkAvc2NyaXB0cy9tb2RlbC9BcHBNb2RlbHMiCmltcG9ydCBIZWxwZXIgZnJvbSAiQC9oZWxwZXIuanMiCmltcG9ydCBzYWxlRm9ybUNvbnRlbnRIYW5kbGVyIGZyb20gIkAvc2NyaXB0cy9zYWxlRm9ybUNvbnRlbnRIYW5kbGVyIjsKaW1wb3J0IGJpbGxpbmdIYW5kbGVyIGZyb20gIkAvc2NyaXB0cy9pbnZvaWNlL2hhbmRsZXIvYmlsbGluZ0hhbmRsZXIiOwovLyBpbXBvcnQgTG9hblR5cGUgZnJvbSAiQC9zY3JpcHRzL2RlZmF1bHRfc2V0dXAvTG9hblR5cGUuanMiOwppbXBvcnQge3ByZWZpeEhhbmRsZXJ9IGZyb20gIkAvc2NyaXB0cy9BcHBIYW5kbGVycyI7CmNvbnN0IHsgam91cm5hbEhhbmRsZXIgfSA9IHJlcXVpcmUoIkAvc2NyaXB0cy9BcHBIYW5kbGVycyIpOwpjb25zdCB7RW50aXR5VHlwZX0gPSByZXF1aXJlKCJAL3NjcmlwdHMvZGVmYXVsdF9zZXR1cC9Db2xsZWN0aW9ucyIpCmNvbnN0IExvYW5UeXBlID0gcmVxdWlyZSgiQC9zY3JpcHRzL2RlZmF1bHRfc2V0dXAvTG9hblR5cGUuanMiKTsKZXhwb3J0IGRlZmF1bHQgewogICAgbmFtZTogIkxpc3RPZkxvYW4iLAogICAgcHJvcHM6IHtsaXN0T2ZMb2FuOiB7fX0sCiAgICBjb21wdXRlZDogewogICAgICAgIGxvYW5OdW1iZXIoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmxpc3RPZkxvYW4pIHsKICAgICAgICAgICAgICAgIHRoaXMubWFrZVNjaGVkdWxlKCkKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmxpc3RPZkxvYW4uYXBwcm92ZU51bWJlcgogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAnJwogICAgICAgIH0sCiAgICAgICAgY3VycmVuY3lDb2RlKCkgewogICAgICAgICAgICBpZiAodGhpcy5saXN0T2ZMb2FuKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5saXN0T2ZMb2FuLmhhc093blByb3BlcnR5KCdjdXJyZW5jeScpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGlzdE9mTG9hbi5jdXJyZW5jeS5jb2RlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgfSwKICAgICAgICBsb2FuTmFtZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMubGlzdE9mTG9hbikgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGlzdE9mTG9hbi5hcHByb3ZlTnVtYmVyICsgJy0nICsgdGhpcy5saXN0T2ZMb2FuLm5hbWUKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJycKICAgICAgICB9LAogICAgICAgIG91dFN0YW5kaW5nQmFsYW5jZSgpewogICAgICAgICAgICBpZiAodGhpcy5saXN0T2ZMb2FuKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5saXN0T2ZMb2FuLm91dFN0YW5kaW5nQmFsYW5jZQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAnJwogICAgICAgIH0sCiAgICAgICAgSW50ZXJlc3QoKXsKICAgICAgICAgICAgaWYgKHRoaXMubGlzdE9mTG9hbikgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGlzdE9mTG9hbi50b3RhbEludGVyZXN0CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgfSwKICAgICAgICBpdGVtczogewogICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2NoZWR1bGVBUi5zbGljZSh0aGlzLnNraXAsIHRoaXMudGFrZSArIHRoaXMuc2tpcCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHRvdGFsICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2NoZWR1bGVBUiA/IHRoaXMuc2NoZWR1bGVBUi5sZW5ndGggOiAwOwogICAgICAgIH0KICAgIH0sCiAgICBjb21wb25lbnRzOiB7CiAgICAgICAgTG9hZGluZ01lOiAoKSA9PiBpbXBvcnQoYEAvY29tcG9uZW50cy9Mb2FkaW5nYCksCiAgICAgICAgJ2FwcC1kYXRlcGlja2VyJzogKCkgPT4gaW1wb3J0KCdAL2NvbXBvbmVudHMvY3VzdG9tX3RlbXBsYXRlcy9EYXRlUGlja2VyQ29tcG9uZW50JykKICAgIH0sCiAgICBkYXRhOiAoKSA9PiAoewogICAgICAgIGVycm9yczogW10sCiAgICAgICAgc2tpcDogMCwKICAgICAgICB0YWtlOiAxMCwKICAgICAgICBwYWdlU2l6ZTogMTAsCiAgICAgICAgcGFnZWFibGU6IHsKICAgICAgICAgICAgaW5mbzogdHJ1ZSwKICAgICAgICAgICAgdHlwZTogJ251bWVyaWMnLAogICAgICAgICAgICBwYWdlU2l6ZXM6IHRydWUsCiAgICAgICAgICAgIHByZXZpb3VzTmV4dDogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgam91cm5hbE51bWJlcjogJycsCiAgICAgICAgam91cm5hbFByZWZpeDogJycsCiAgICAgICAgam91cm5hbFR4blR5cGU6IEVudGl0eVR5cGUuSk9VUk5BTCwKICAgICAgICBsb2dnZWRVc2VyOiBuZXcgVXNlck1vZGVsKGNvb2tpZXMudXNlciksCiAgICAgICAgc2NoZWR1bGVBUjogW10sCiAgICAgICAgaW5mbzoge30sCiAgICAgICAgdG90YWxQYXltZW50OiAwLAogICAgICAgIGZvcm1hdDogJycsCiAgICAgICAgdG90YWxQYWlkOiAnJywKICAgICAgICBlbmRpbmdCYWxhbmNlOiAnJywKICAgICAgICBudW1iZXJGb3JtYXQ6ICduMCcsCiAgICAgICAgZXhjaGFuZ2VSYXRlOiB7fSwKICAgICAgICByYXRlOiAxLAogICAgICAgIHI6IG5ldyBMb2FuUmVjZWlwdE1vZGVsKHt9KSwKICAgICAgICBpc1BhaWQ6IGZhbHNlLAogICAgICAgIHNlZ21lbnQ6IHt9LAogICAgICAgIHBpbjogZGF0YVN0b3JlLnBpbiwKICAgICAgICBzZWdtZW50czogW10sCiAgICAgICAgY2FzaEFjY291bnRzOiBbXSwKICAgICAgICBzY2hlZHVsZTogW10sCiAgICAgICAgcGVuYWx0eUFjY291bnQ6IHt9LAogICAgICAgIHNob3dSZWNlaXB0OiBmYWxzZSwKICAgICAgICB2YWxpZDogdHJ1ZSwKICAgICAgICByZWNlaXB0QW1vdW50OiAwLAogICAgICAgIGludGVyZXN0QW1vdW50OiAwLAogICAgICAgIHNob3dMb2FkaW5nOiBmYWxzZSwKICAgICAgICBwZW5hbHR5QWNjb3VudHM6IFtdLAogICAgICAgIHNhbGVGb3JtQ29udGVudDoge30sCiAgICAgICAgdHJhbnNhY3Rpb25UeXBlOiB7fSwKICAgICAgICBzdWZmaXg6ICcnLAogICAgICAgIGxvYW46IHt9LAogICAgICAgIGpvdXJuYWw6IHt9CiAgICB9KSwKICAgIHdhdGNoOiB7fSwKICAgIG1ldGhvZHM6IHsKICAgICAgICB6ZXJvUGFkKG51bSwgcGxhY2VzKSB7CiAgICAgICAgICAgIHJldHVybiBTdHJpbmcobnVtKS5wYWRTdGFydChwbGFjZXMsICIwIik7CiAgICAgICAgfSwKICAgICAgICBkYXRhU291cmNlQ2hhbmdlZChlKSB7CiAgICAgICAgICAgIGlmIChlLmZpZWxkKSB7CiAgICAgICAgICAgICAgICBsZXQgZGF0YVJvdyA9IGUuaXRlbXNbMF0KICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhkYXRhUm93KQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAvLyBhc3luYyBsb2FkRGVjaW1hbCgpIHsKICAgICAgICAvLyAgICAgbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7CiAgICAgICAgLy8gICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAvLyAgICAgICAgICAgICByZXNvbHZlKCdyZXNvbHZlZCcpOwogICAgICAgIC8vICAgICAgICAgICAgIGxvYW5IYW5kbGVyLmRlY2ltYWxHZXQoKS50aGVuKHJlcyA9PiB7CiAgICAgICAgLy8gICAgICAgICAgICAgICAgIHRoaXMuZGVjaW1hbHMgPSByZXMuZGF0YS5kYXRhCiAgICAgICAgLy8gICAgICAgICAgICAgfSkKICAgICAgICAvLyAgICAgICAgIH0sIDMwMCk7CiAgICAgICAgLy8gICAgIH0pCiAgICAgICAgLy8gICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgLy8gICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAvLyAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgIC8vICAgICAgICAgICAgIHNhbGVGb3JtQ29udGVudEhhbmRsZXIubGlzdCgpLnRoZW4oKHJlcykgPT4gewogICAgICAgIC8vICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNhbGVGb3JtQ29udGVudCA9IGRhdGFbMF07CiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5udW1iZXJGb3JtYXQgPSAnbicgKyB0aGlzLnNhbGVGb3JtQ29udGVudC5kZWNpbWFsCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FuLmRlY2ltYWwgPSBkYXRhWzBdLmRlY2ltYWwKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAvLyAgICAgICAgICAgICAgICAgfQogICAgICAgIC8vICAgICAgICAgICAgIH0pOwogICAgICAgIC8vICAgICAgICAgfSwgMTApOwogICAgICAgIC8vICAgICB9KTsKICAgICAgICAvLyB9LAogICAgICAgIGFjdGlvblRtcGwoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKGRhdGFJdGVtKQogICAgICAgICAgICBpZihkYXRhSXRlbS5udW1TdGF0dXMgPT0gMil7CiAgICAgICAgICAgICAgICByZXR1cm4gaTE4bi50KCdwYWlkJykKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICByZXR1cm4gYDx2LWJ0biBjb2xvcj0icHJpbWFyeSIgY2xhc3M9IiIgdi1zaG93PSJkLm51bVN0YXR1cyA9PSAxIiBAY2xpY2s9IntzZWFyY2hMb2FuUGFpZChkYXRhSXRlbSl9IiBzdHlsZT0iZm9udC1zaXplOiAxNHB4OyI+YCArIGkxOG4udCgncGF5JykgKyBgPC92LWJ0bj5gCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHJvd051bWJlclRtcGwoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgaWYoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuc2NoZWR1bGVBUi5rZW5kb1dpZGdldCgpLAogICAgICAgICAgICAgICAgICAgIGluZGV4ID0gZHMuaW5kZXhPZihkYXRhSXRlbSk7CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09ICh0aGlzLnNjaGVkdWxlQVIubGVuZ3RoIC0gMSkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJycKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGluZGV4ICsgMQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAgJycKICAgICAgICB9LAogICAgICAgIGFzeW5jIG1ha2VTY2hlZHVsZSgpewogICAgICAgICAgICB0aGlzLnNjaGVkdWxlQVIgPSBbXQogICAgICAgICAgICB0aGlzLmVuZGluZ0JhbGFuY2UgPSAnJwogICAgICAgICAgICB0aGlzLnRvdGFsUGFpZCA9ICcnCiAgICAgICAgICAgIHRoaXMudG90YWxQYXltZW50ID0gJycKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCdhJykKICAgICAgICAgICAgaWYodGhpcy5saXN0T2ZMb2FuLnN0YXR1cyA9PSAiYWN0aXZlIiB8fCB0aGlzLmxpc3RPZkxvYW4uc3RhdHVzID09ICJjbG9zZSIpIHsKICAgICAgICAgICAgICAgIHRoaXMubG9hbiA9IHRoaXMubGlzdE9mTG9hbgogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHRoaXMubGlzdE9mTG9hbiwgJ2InKQogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5sb2FkU2NoZWR1bGUodGhpcy5saXN0T2ZMb2FuLmlkKQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBkYXRhQm91bmQ6IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGNvbnN0IGl0ZW1zID0gZS5zZW5kZXIuaXRlbXMoKQogICAgICAgICAgICBpZihpdGVtcy5sZW5ndGggPiAwKXsKICAgICAgICAgICAgICAgIGNvbnN0IGdyaWQgPSBrZW5kby5qUXVlcnkoIiNsb2FuU2NoZWR1bGUiKS5kYXRhKCJrZW5kb0dyaWQiKQogICAgICAgICAgICAgICAgaWYoZ3JpZCl7CiAgICAgICAgICAgICAgICAgICAgaXRlbXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkYXRhSXRlbSA9IGdyaWQuZGF0YUl0ZW0odGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhkYXRhSXRlbS5udW1TdGF0dXMpCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGtlbmRvLmpRdWVyeSgidHJbZGF0YS11aWQ9JyIgKyBkYXRhSXRlbS51aWQgKyAiJ10iKS5maW5kKCIuaXNTdGF0dXMiKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhSXRlbS5udW1TdGF0dXMgPT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhrZW5kby5qUXVlcnkodGhpcyksICd3b3cnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLmpRdWVyeSh0aGlzKS5maW5kKCd0ZCcpLmVxKDUpLnRleHQoaTE4bi50KCdwYWlkJykpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGtlbmRvLmpRdWVyeSh0aGlzKS5yZW1vdmVDbGFzcygnay1zdGF0ZS1kaXNhYmxlZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZSBpZihkYXRhSXRlbS5udW1TdGF0dXMgPT0gMyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ualF1ZXJ5KHRoaXMpLmZpbmQoJ3RkJykuZXEoNSkudGV4dCgnJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIC8vICkKICAgICAgICAgICAgICAgICAgICAgICAgLy8gfSkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhc3luYyBzZWFyY2hMb2FuUGFpZChlKXsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBsZXQgZ3JpZCA9IGtlbmRvLmpRdWVyeSgiI2xvYW5TY2hlZHVsZSIpLmRhdGEoImtlbmRvR3JpZCIpOwogICAgICAgICAgICBsZXQgZGF0YUl0ZW0gPSBncmlkLmRhdGFJdGVtKCQoZS5jdXJyZW50VGFyZ2V0KS5jbG9zZXN0KCJ0ciIpKTsKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKGRhdGFJdGVtKQogICAgICAgICAgICBhd2FpdCB0aGlzLmxvYWRQcmVmaXgoKQogICAgICAgICAgICB0aGlzLmxvYWRUcmFuc2FjdGlvblJhdGUoKQogICAgICAgICAgICBsZXQgZGF0YSA9IFtdCiAgICAgICAgICAgIGRhdGEucHVzaChkYXRhSXRlbSkKICAgICAgICAgICAgdGhpcy5jYWxSZWNlaXB0KGRhdGEpCiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkVHJhbnNhY3Rpb25SYXRlKCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoJ3Jlc29sdmVkJykKICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUodGhpcy5yLmlzc3VlZERhdGUpLnRvSVNPU3RyaW5nKCkuc3Vic3RyKDAsIDEwKQogICAgICAgICAgICAgICAgICAgIGxldCBjb2RlID0gdGhpcy5jdXJyZW5jeUNvZGUKICAgICAgICAgICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2codGhpcy5jdXJyZW5jeUNvZGUsICd0cmFuc2FjdGlvbiByYXRlJykKICAgICAgICAgICAgICAgICAgICBpZiAoY29kZSAhPT0gdW5kZWZpbmVkIHx8IGNvZGUgIT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5SGFuZGxlci5nZXRMYXN0RXhjaGFuZ2VSYXRlQnlEYXRlKGRhdGUsIGNvZGUpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHJlcy5kYXRhLmRhdGFbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV4Y2hhbmdlUmF0ZSA9IHJlc3BvbnNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yYXRlID0gcmVzcG9uc2UucmF0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuci51c2VyUGluID0gdGhpcy5waW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLnIucmF0ZSA9IHJlc3BvbnNlLnJhdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnIuZXhjaGFuZ2VSYXRlID0gcmVzcG9uc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAzMDApCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBjYWxSZWNlaXB0KGRhdGEpIHsKICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgbGV0IHRvdGFsID0gMAogICAgICAgICAgICAgICAgbGV0IGludGVyZXN0ID0gMAogICAgICAgICAgICAgICAgLy8gbGV0IHMgPSBbXQogICAgICAgICAgICAgICAgbGV0IHNlbGYgPSB0aGlzCiAgICAgICAgICAgICAgICBsZXQgcGVuYWx0eSA9IDAKICAgICAgICAgICAgICAgIGxldCBzcyA9IFtdCiAgICAgICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coZGF0YSwgJ2NhbCByZWNlaXB0JykKICAgICAgICAgICAgICAgICQuZWFjaChkYXRhLCBmdW5jdGlvbiAoaSwgdikgewogICAgICAgICAgICAgICAgICAgIGludGVyZXN0ICs9IHBhcnNlRmxvYXQodi5pbnRlcmVzdCkKICAgICAgICAgICAgICAgICAgICBsZXQgcCA9IHNlbGYubGlzdE9mTG9hbgogICAgICAgICAgICAgICAgICAgIGxldCBpbnQgPSAwCiAgICAgICAgICAgICAgICAgICAgbGV0IHN0YXJ0ZGF0ZSA9IG5ldyBEYXRlKHYuZGF0ZSkKICAgICAgICAgICAgICAgICAgICBsZXQgZW5kZGF0ZSA9IG5ldyBEYXRlKCkKICAgICAgICAgICAgICAgICAgICBsZXQgbW9udGhzID0gZW5kZGF0ZS5nZXRNb250aCgpIC0gc3RhcnRkYXRlLmdldE1vbnRoKCkgKyAoMTIgKiAoZW5kZGF0ZS5nZXRGdWxsWWVhcigpIC0gc3RhcnRkYXRlLmdldEZ1bGxZZWFyKCkpKQogICAgICAgICAgICAgICAgICAgIGlmIChtb250aHMgPj0gMykgewogICAgICAgICAgICAgICAgICAgICAgICBpbnQgPSAocGFyc2VGbG9hdCh2LmludGVyZXN0KSAqIHBhcnNlRmxvYXQocC5wcm9kdWN0LmR1ZVRocmVlTW9udGgpKSAvIDEwMAogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobW9udGhzIDwgMyAmJiBtb250aHMgPj0gMikgewogICAgICAgICAgICAgICAgICAgICAgICBpbnQgPSAocGFyc2VGbG9hdCh2LmludGVyZXN0KSAqIHBhcnNlRmxvYXQocC5wcm9kdWN0LmR1ZVR3b01vbnRoKSkgLyAxMDAKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1vbnRocyA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGludCA9IChwYXJzZUZsb2F0KHYuaW50ZXJlc3QpICogcGFyc2VGbG9hdChwLnByb2R1Y3QuZHVlT25lTW9udGgpKSAvIDEwMAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2cocGFyc2VGbG9hdCh2LnByaW5jaXBhbCksICdwcmluY2lwYWwnKQogICAgICAgICAgICAgICAgICAgIHNzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICBpZDogdi5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogdi5kYXRlLAogICAgICAgICAgICAgICAgICAgICAgICBwcmluY2lwYWw6IGtlbmRvLnRvU3RyaW5nKHBhcnNlRmxvYXQodi5wcmluY2lwYWwpLCB2Lm51bWJlckZvcm1hdCksCiAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZXN0OiBrZW5kby50b1N0cmluZyhwYXJzZUZsb2F0KHYuaW50ZXJlc3QpLCB2Lm51bWJlckZvcm1hdCksCiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiBrZW5kby50b1N0cmluZyhwYXJzZUZsb2F0KHYudG90YWwpLCB2Lm51bWJlckZvcm1hdCksCiAgICAgICAgICAgICAgICAgICAgICAgIHBlbmFsdHk6IGludAogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgdG90YWwgKz0gcGFyc2VGbG9hdCh2LnRvdGFsKSArIGludAogICAgICAgICAgICAgICAgICAgIHBlbmFsdHkgKz0gaW50CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgaWYgKHNzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNjaGVkdWxlID0gc3MKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0b3RhbCA+IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnIucGVuYWx0eUFtb3VudCA9IHBlbmFsdHkKICAgICAgICAgICAgICAgICAgICB0aGlzLnIuc2NoZWR1bGVzID0gdGhpcy5zY2hlZHVsZQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLmxpc3RPZkxvYW4sICdsaXN0IGxvYW4nKQogICAgICAgICAgICAgICAgICAgIHRoaXMuci5sb2FuID0gewogICAgICAgICAgICAgICAgICAgICAgICBpZDogdGhpcy5saXN0T2ZMb2FuLmlkLAogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB0aGlzLmxpc3RPZkxvYW4ubmFtZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLnJlY2VpcHRBbW91bnQgPSBrZW5kby50b1N0cmluZyh0b3RhbCwgdGhpcy5udW1iZXJGb3JtYXQpCiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnRlcmVzdEFtb3VudCA9IGtlbmRvLnRvU3RyaW5nKGludGVyZXN0LCB0aGlzLm51bWJlckZvcm1hdCkKICAgICAgICAgICAgICAgICAgICB0aGlzLnIucmVjZWlwdEFtb3VudCA9IHRvdGFsCiAgICAgICAgICAgICAgICAgICAgdGhpcy5yLmludGVyZXN0QW1vdW50ID0gaW50ZXJlc3QKICAgICAgICAgICAgICAgICAgICB0aGlzLnIucHJpbmNpcGFsQW1vdW50ID0gdG90YWwgLSBpbnRlcmVzdAogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1JlY2VpcHQgPSB0cnVlCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaXNQYWlkID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuc3VjY2VzcygnQWxyZWFkeSBwYWlkIScpCiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5zY2hlZHVsZXMgPSBbXQogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1JlY2VpcHQgPSB0cnVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLmlzUGFpZCA9IHRydWUKICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuc3VjY2VzcygnQWxyZWFkeSBwYWlkIScpCiAgICAgICAgICAgICAgICAvLyB0aGlzLnNjaGVkdWxlcyA9IFtdCiAgICAgICAgICAgICAgICB0aGlzLnNob3dSZWNlaXB0ID0gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBsb2FkU2NoZWR1bGVhKGRhdGEpewogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coZGF0YSwgJ3NjaGVkdWxlJykKICAgICAgICAgICAgbGV0IHNlbGYgPSB0aGlzCiAgICAgICAgICAgIC8vIGxldCBpYW10ID0gMAogICAgICAgICAgICBsZXQgdGFtdCA9IDAKICAgICAgICAgICAgbGV0IHBhbXQgPSAwCiAgICAgICAgICAgIGxldCBpc0NoZWNrRmlyc3QgPSBmYWxzZQogICAgICAgICAgICAkLmVhY2goZGF0YSwgZnVuY3Rpb24gKGksdil7CiAgICAgICAgICAgICAgICBsZXQgc3RhdHVzID0gJycKICAgICAgICAgICAgICAgIGxldCBuU3RhdHVzID0gMwogICAgICAgICAgICAgICAgaWYodi5zdGF0dXMgPT0gMil7CiAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gaTE4bi50KCdwYWlkJykKICAgICAgICAgICAgICAgICAgICBwYW10ICs9IHYuZGF0YS50b3RhbAogICAgICAgICAgICAgICAgICAgIG5TdGF0dXMgPSAyCiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICBpZihpc0NoZWNrRmlyc3QgPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgblN0YXR1cyA9IHYuc3RhdHVzCiAgICAgICAgICAgICAgICAgICAgICAgIGlzQ2hlY2tGaXJzdCA9IHRydWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZWxmLnNjaGVkdWxlQVIucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgaWQ6IHYucGssCiAgICAgICAgICAgICAgICAgICAgbm86IGkgKzEsCiAgICAgICAgICAgICAgICAgICAgZGF0ZTogdi5kYXRhLmRhdGUsCiAgICAgICAgICAgICAgICAgICAgaW50ZXJlc3Q6IHYuZGF0YS5pbnRlcmVzdCwKICAgICAgICAgICAgICAgICAgICBpbnRlcmVzdEFtb3VudDoga2VuZG8udG9TdHJpbmcodi5kYXRhLmludGVyZXN0LCB2LmRhdGEubnVtYmVyRm9ybWF0KSwKICAgICAgICAgICAgICAgICAgICBsb2NhbGU6IHYuZGF0YS5sb2NhbGUsCiAgICAgICAgICAgICAgICAgICAgbnVtYmVyRm9ybWF0OiB2LmRhdGEubnVtYmVyRm9ybWF0LAogICAgICAgICAgICAgICAgICAgIHByaW5jaXBhbDogdi5kYXRhLnByaW5jaXBhbCwKICAgICAgICAgICAgICAgICAgICBwcmluY2lwYWxBbW91bnQ6IGtlbmRvLnRvU3RyaW5nKHYuZGF0YS5wcmluY2lwYWwsIHYuZGF0YS5udW1iZXJGb3JtYXQpLAogICAgICAgICAgICAgICAgICAgIHByaW5jaXBhbF9yOiBrZW5kby50b1N0cmluZyh2LmRhdGEucHJpbmNpcGFsX3IsIHYuZGF0YS5udW1iZXJGb3JtYXQpLAogICAgICAgICAgICAgICAgICAgIHRvdGFsQW1vdW50OiBrZW5kby50b1N0cmluZyh2LmRhdGEudG90YWwsIHYuZGF0YS5udW1iZXJGb3JtYXQpLAogICAgICAgICAgICAgICAgICAgIHRvdGFsOiB2LmRhdGEudG90YWwsCiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBzdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgbnVtU3RhdHVzOiBuU3RhdHVzLAogICAgICAgICAgICAgICAgICAgIGVuZGluZ0JhbGFuY2U6IGtlbmRvLnRvU3RyaW5nKHYuZGF0YS5wcmluY2lwYWxfciAtIHYuZGF0YS5wcmluY2lwYWwsIHYuZGF0YS5udW1iZXJGb3JtYXQpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLy8gaWFtdCArPSB2LmludGVyZXN0CiAgICAgICAgICAgICAgICB0YW10ICs9IHYuZGF0YS50b3RhbAogICAgICAgICAgICAgICAgLy8gc2VsZi5jdXJyZW5jeUNvZGUgPSB2LmRhdGEubG9jYWxlCiAgICAgICAgICAgICAgICBzZWxmLm51bWJlckZvcm1hdCA9IHYuZGF0YS5udW1iZXJGb3JtYXQKICAgICAgICAgICAgfSkKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHRhbXQpCiAgICAgICAgICAgIHRoaXMudG90YWxQYXltZW50ID0ga2VuZG8udG9TdHJpbmcodGFtdCwgdGhpcy5udW1iZXJGb3JtYXQpCiAgICAgICAgICAgIHRoaXMudG90YWxQYWlkID0ga2VuZG8udG9TdHJpbmcocGFtdCwgdGhpcy5udW1iZXJGb3JtYXQpCiAgICAgICAgICAgIHRoaXMuZW5kaW5nQmFsYW5jZSA9IGtlbmRvLnRvU3RyaW5nKHRhbXQgLSBwYW10LCB0aGlzLm51bWJlckZvcm1hdCkKICAgICAgICAgICAgLy8gdGhpcy5hZGRUb3RhbCgpCiAgICAgICAgfSwKICAgICAgICBsb2FkU2NoZWR1bGUobG9hbklkKXsKICAgICAgICAgICAgbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCdyZXNvbHZlZCcpCiAgICAgICAgICAgICAgICAgICAgbG9hbkhhbmRsZXIubG9hblNjaGVkdWxlR2V0KGxvYW5JZCkudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkYXRhID0gcmVzLmRhdGEuZGF0YQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHNlbGYgPSB0aGlzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcyA9IFtdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNjaGVkdWxlQVIgPSBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoZGF0YS5sZW5ndGggPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgaWFtdCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdGFtdCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGFtdCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgaXNDaGVja0ZpcnN0ID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goZGF0YSwgZnVuY3Rpb24gKGksdil7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzdGF0dXMgPSAnJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgblN0YXR1cyA9IDMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodi5zdGF0dXMgPT0gMil7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSBpMThuLnQoJ3BhaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFtdCArPSB2LmRhdGEudG90YWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5TdGF0dXMgPSAyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXNDaGVja0ZpcnN0ID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgblN0YXR1cyA9IHYuc3RhdHVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNDaGVja0ZpcnN0ID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogdi5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vOiBpICsxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogdi5kYXRhLmRhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmVzdDogdi5kYXRhLmludGVyZXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJlc3RBbW91bnQ6IGtlbmRvLnRvU3RyaW5nKHYuZGF0YS5pbnRlcmVzdCwgdi5kYXRhLm51bWJlckZvcm1hdCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbGU6IHYuZGF0YS5sb2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1iZXJGb3JtYXQ6IHYuZGF0YS5udW1iZXJGb3JtYXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmluY2lwYWw6IHYuZGF0YS5wcmluY2lwYWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmluY2lwYWxBbW91bnQ6IGtlbmRvLnRvU3RyaW5nKHYuZGF0YS5wcmluY2lwYWwsIHYuZGF0YS5udW1iZXJGb3JtYXQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbmNpcGFsX3I6IGtlbmRvLnRvU3RyaW5nKHYuZGF0YS5wcmluY2lwYWxfciwgdi5kYXRhLm51bWJlckZvcm1hdCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEFtb3VudDoga2VuZG8udG9TdHJpbmcodi5kYXRhLnRvdGFsLCB2LmRhdGEubnVtYmVyRm9ybWF0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiB2LmRhdGEudG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHN0YXR1cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bVN0YXR1czogblN0YXR1cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZGluZ0JhbGFuY2U6IGtlbmRvLnRvU3RyaW5nKHYuZGF0YS5wcmluY2lwYWxfciAtIHYuZGF0YS5wcmluY2lwYWwsIHYuZGF0YS5udW1iZXJGb3JtYXQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlhbXQgKz0gdi5kYXRhLmludGVyZXN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhbXQgKz0gdi5kYXRhLnRvdGFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNlbGYuY3VycmVuY3lDb2RlID0gdi5kYXRhLmxvY2FsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm51bWJlckZvcm1hdCA9IHYuZGF0YS5udW1iZXJGb3JtYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0YW10KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudG90YWxJbnRlcmVzdCA9IGtlbmRvLnRvU3RyaW5nKGlhbXQsIHRoaXMubnVtYmVyRm9ybWF0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudG90YWxQYXltZW50ID0ga2VuZG8udG9TdHJpbmcodGFtdCwgdGhpcy5udW1iZXJGb3JtYXQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50b3RhbFBhaWQgPSBrZW5kby50b1N0cmluZyhwYW10LCB0aGlzLm51bWJlckZvcm1hdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVuZGluZ0JhbGFuY2UgPSBrZW5kby50b1N0cmluZyh0YW10IC0gcGFtdCwgdGhpcy5udW1iZXJGb3JtYXQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5hZGRUb3RhbCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYocy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVBUiA9IHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaCgpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAzMDApCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBhZGRUb3RhbCgpIHsKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHRoaXMubGlzdE9mTG9hbikKICAgICAgICAgICAgdGhpcy5zY2hlZHVsZUFSLnB1c2goewogICAgICAgICAgICAgICAgaWQ6ICcnLAogICAgICAgICAgICAgICAgbm86IHRoaXMuc2NoZWR1bGVBUi5sZW5ndGggKyAxLAogICAgICAgICAgICAgICAgcHJpbmNpcGFsX3I6ICcnLAogICAgICAgICAgICAgICAgcHJpbmNpcGFsQW1vdW50OiBrZW5kby50b1N0cmluZyhwYXJzZUZsb2F0KHRoaXMubGlzdE9mTG9hbi5hcHByb3ZlZEFtb3VudCksIHRoaXMubnVtYmVyRm9ybWF0KSwKICAgICAgICAgICAgICAgIGludGVyZXN0QW1vdW50OiBrZW5kby50b1N0cmluZyh0aGlzLnRvdGFsSW50ZXJlc3QsIHRoaXMubnVtYmVyRm9ybWF0KSwKICAgICAgICAgICAgICAgIHRvdGFsQW1vdW50OiBrZW5kby50b1N0cmluZyh0aGlzLnRvdGFsUGF5bWVudCwgdGhpcy5udW1iZXJGb3JtYXQpLAogICAgICAgICAgICAgICAgZGF0ZTogJ1RvdGFsJywKICAgICAgICAgICAgICAgIGxvY2FsZTogdGhpcy5jdXJyZW5jeUNvZGUsCiAgICAgICAgICAgICAgICBudW1iZXJGb3JtYXQ6IHRoaXMubnVtYmVyRm9ybWF0LAogICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25fbnVtYmVyOiAnJywKICAgICAgICAgICAgICAgIHN0YXR1czogJycsCiAgICAgICAgICAgICAgICBlbmRpbmdCYWxhbmNlOiAnJwogICAgICAgICAgICB9KQogICAgICAgICAgICAvLyBsZXQgZHMgPSB0aGlzLiRyZWZzLnNjaGVkdWxlQVIua2VuZG9XaWRnZXQoKQogICAgICAgICAgICAvLyBkcy5zZXREYXRhU291cmNlKHRoaXMuc2NoZWR1bGVBUikKICAgICAgICAgICAgLy8gJC5lYWNoKHRoaXMuc2NoZWR1bGVBUiwgZnVuY3Rpb24gKGksdil7CiAgICAgICAgICAgIC8vICAgICBkcy5hZGQoewogICAgICAgICAgICAvLyAgICAgICAgIHByaW5jaXBhbF9yOiB2LnByaW5jaXBhbF9yLAogICAgICAgICAgICAvLyAgICAgICAgIHByaW5jaXBhbDogdi5wcmluY2lwYWwsCiAgICAgICAgICAgIC8vICAgICAgICAgaW50ZXJlc3Q6IHYuaW50ZXJlc3QsCiAgICAgICAgICAgIC8vICAgICAgICAgdG90YWw6IHYudG90YWwsCiAgICAgICAgICAgIC8vICAgICAgICAgZGF0ZTogdi5kYXRlLAogICAgICAgICAgICAvLyAgICAgICAgIGxvY2FsZTogdi5sb2NhbGUsCiAgICAgICAgICAgIC8vICAgICAgICAgbnVtYmVyRm9ybWF0OiB2Lm51bWJlckZvcm1hdCwKICAgICAgICAgICAgLy8gICAgICAgICB0cmFuc2FjdGlvbl9udW1iZXI6IHYudHJhbnNhY3Rpb25fbnVtYmVyLAogICAgICAgICAgICAvLyAgICAgICAgIHN0YXR1czogdi5zdGF0dXMKICAgICAgICAgICAgLy8gICAgIH0pCiAgICAgICAgICAgIC8vIH0pCiAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLnNjaGVkdWxlQVIsICdzJykKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRBY2NvdW50KCkgewogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2codGhpcy5saXN0T2ZMb2FuLCAnbGlzdCcpCiAgICAgICAgICAgIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgncmVzb2x2ZWQnKTsKICAgICAgICAgICAgICAgICAgICBhY2NvdW50SGFuZGxlci5nZXRBbGwoKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhyZXMsICdhY2NvdW50JykKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXNoQWNjb3VudHMgPSByZXMuZGF0YS5maWx0ZXIobSA9PiBtLmFjY291bnRfdHlwZS5udW1iZXIgPT09IDEpLm1hcChpdG0gPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogaXRtLnV1aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXVpZDogaXRtLnV1aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogaXRtLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxfbmFtZTogaXRtLmxvY2FsX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyOiBpdG0ubnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX3RheGFibGU6IGl0bS5pc190YXhhYmxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhbmhqaUFjY0NvZGU6IGl0bS5iYW5oamlBY2NDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwX2NvZGU6IGl0bS5ncm91cF9jb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudF9hY2NvdW50OiBpdG0ucGFyZW50X2FjY291bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZV9jb2RlOiBpdG0udHlwZV9jb2RlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGVuYWx0eUFjY291bnRzID0gcmVzLmRhdGEuZmlsdGVyKG0gPT4gbS5hY2NvdW50X3R5cGUubnVtYmVyID09PSAzOCkubWFwKGl0bSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBpdG0udXVpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dWlkOiBpdG0udXVpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBpdG0ubmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9uYW1lOiBpdG0ubG9jYWxfbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IGl0bS5udW1iZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNfdGF4YWJsZTogaXRtLmlzX3RheGFibGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFuaGppQWNjQ29kZTogaXRtLmJhbmhqaUFjY0NvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBfY29kZTogaXRtLmdyb3VwX2NvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50X2FjY291bnQ6IGl0bS5wYXJlbnRfYWNjb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlX2NvZGU6IGl0bS50eXBlX2NvZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2FzaEFjY291bnRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuci5jYXNoQWNjb3VudCA9IHRoaXMuY2FzaEFjY291bnRzWzBdCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5wZW5hbHR5QWNjb3VudHMubGVuZ3RoID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnIucGVuYWx0eUFjY291bnQgPSB0aGlzLnBlbmFsdHlBY2NvdW50c1swXQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sIDMwMCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICAvLyBqb3VuYWwKICAgICAgICBhc3luYyBnZXRKb3VybmFsTnVtYmVyKCkgewogICAgICAgICAgICBsZXQgbnVtID0gYXdhaXQgSGVscGVyLmdlbmVyYXRlQWNjb3VudGluZ051bWJlcih0aGlzLmpvdXJuYWxUeG5UeXBlLCB0aGlzLnIuaXNzdWVkRGF0ZSkKICAgICAgICAgICAgdGhpcy5qb3VybmFsTnVtYmVyID0gbnVtLm51bWJlcgogICAgICAgICAgICB0aGlzLmpvdXJuYWxQcmVmaXggPSBudW0ucHJlZml4X2Zvcm1hdAogICAgICAgICAgICB0aGlzLnIubnVtYmVyID0gbnVtLm51bWJlcgogICAgICAgICAgICB0aGlzLnIuam91cm5hbE51bWJlciA9IG51bS5udW1iZXIKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRTaW5nbGVQZW5hbHR5KCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoJ3Jlc29sdmVkJykKICAgICAgICAgICAgICAgICAgICBsb2FuSGFuZGxlci5wZW5hbHR5R2V0KCkudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5kYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBlbmFsdHlBY2NvdW50ID0gcmVzLmRhdGEuZGF0YVswXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMzAwKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgYWRkSm91cm5hbCgpIHsKICAgICAgICAgICAgbGV0IGludCA9IDAKICAgICAgICAgICAgJC5lYWNoKHRoaXMuc2NoZWR1bGVzLCBmdW5jdGlvbiAoaSwgdikgewogICAgICAgICAgICAgICAgaW50ICs9IHBhcnNlRmxvYXQodi5pbnQpCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHRoaXMuci5wZW5hbHR5QW1vdW50ID0gaW50CiAgICAgICAgICAgIGNvbnN0IG9iaiA9IHRoaXMucgogICAgICAgICAgICAvLyBjb25zdCBzZWcgPSB0aGlzLnNlZ21lbnQKICAgICAgICAgICAgaWYgKCF0aGlzLiRyZWZzLmZvcm0udmFsaWRhdGUoKSkgewogICAgICAgICAgICAgICAgdGhpcy4kcmVmcy5mb3JtLnZhbGlkYXRlKCkKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLnIucmVjZWlwdEFtb3VudCA8PSAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LmVycm9yKCdBbW91bnQgbXVzdCBiZSBvdmVyIDAnKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWUKICAgICAgICAgICAgLy8gQVBJIEpvdXJuYWwKICAgICAgICAgICAgbGV0IHNlbGYgPSB0aGlzOwogICAgICAgICAgICBsZXQgamogPSBbXQogICAgICAgICAgICBqai5wdXNoKHsKICAgICAgICAgICAgICAgICJ1dWlkIjogIiIsCiAgICAgICAgICAgICAgICAiYWNjb3VudCI6IG9iai5jYXNoQWNjb3VudCwKICAgICAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6IHRoaXMuam91cm5hbC5kZXNjcmlwdGlvbiwKICAgICAgICAgICAgICAgICJ0aGlyZF9jb250YWN0cyI6IFtdLAogICAgICAgICAgICAgICAgInJlZl9udW1iZXIiOiAnJywKICAgICAgICAgICAgICAgICJhbW91bnQiOiBwYXJzZUZsb2F0KG9iai5yZWNlaXB0QW1vdW50KSAqIC0xLAogICAgICAgICAgICAgICAgImRpc2NvdW50Ijoge30sCiAgICAgICAgICAgICAgICAibWFya191cCI6IDAsCiAgICAgICAgICAgICAgICAiYmlsbGFibGUiOiAwLAogICAgICAgICAgICAgICAgInRheF9jb2RlIjogIiIsCiAgICAgICAgICAgICAgICAicGF5bWVudF9tZXRob2QiOiB7fSwKICAgICAgICAgICAgICAgICJjdXJyZW5jeSI6IHRoaXMuZXhjaGFuZ2VSYXRlLAogICAgICAgICAgICAgICAgImV4Y2hhbmdlX3JhdGVfdXVpZCI6ICIiLAogICAgICAgICAgICAgICAgImV4Y2hhbmdlX3JhdGUiOiB0aGlzLnJhdGUsCiAgICAgICAgICAgICAgICAiZXhjaGFuZ2VkX2Ftb3VudCI6IChwYXJzZUZsb2F0KG9iai5yZWNlaXB0QW1vdW50KSAqIC0xKSAqIHBhcnNlRmxvYXQodGhpcy5yYXRlKSwKICAgICAgICAgICAgICAgICJ0YXhfYW1vdW50IjogMCwKICAgICAgICAgICAgICAgICJleGNoYW5nZWRfdGF4X2Ftb3VudCI6IDAsCiAgICAgICAgICAgICAgICAiaXNfcmVjb25jaWxlZCI6IDAsCiAgICAgICAgICAgICAgICAiaXNfc2V0dGxlZCI6IDAsCiAgICAgICAgICAgICAgICAiY2xhc3NfMV91dWlkIjogIiIsCiAgICAgICAgICAgICAgICAiY2xhc3NfMl91dWlkIjogIiIsCiAgICAgICAgICAgICAgICAiY2xhc3NfM191dWlkIjogIiIsCiAgICAgICAgICAgICAgICAiY2xhc3NfNF91dWlkIjogIiIsCiAgICAgICAgICAgICAgICAiY2xhc3NfNV91dWlkIjogIiIsCiAgICAgICAgICAgICAgICAicGF5bWVudF9tZXRob2RfYXMiOiAiIiwKICAgICAgICAgICAgICAgICJjcmVhdGVkX2J5IjogbnVsbCwKICAgICAgICAgICAgICAgICJtb2RpZmllZF9ieSI6IG51bGwsCiAgICAgICAgICAgICAgICAiY3JlYXRlZF9kYXRlIjogbnVsbCwKICAgICAgICAgICAgICAgICJtb2RpZmllZF9kYXRlIjogbnVsbAogICAgICAgICAgICB9KQogICAgICAgICAgICBpZiAob2JqLnByaW5jaXBhbEFtb3VudCA+IDApIHsKICAgICAgICAgICAgICAgIGpqLnB1c2goewogICAgICAgICAgICAgICAgICAgICJ1dWlkIjogIiIsCiAgICAgICAgICAgICAgICAgICAgImFjY291bnQiOiB0aGlzLmxpc3RPZkxvYW4ubG9hbkFjY291bnQsCiAgICAgICAgICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogJycsCiAgICAgICAgICAgICAgICAgICAgInRoaXJkX2NvbnRhY3RzIjogW10sCiAgICAgICAgICAgICAgICAgICAgInJlZl9udW1iZXIiOiAnJywKICAgICAgICAgICAgICAgICAgICAiYW1vdW50IjogcGFyc2VGbG9hdChvYmoucHJpbmNpcGFsQW1vdW50KSwKICAgICAgICAgICAgICAgICAgICAiZGlzY291bnQiOiB7fSwKICAgICAgICAgICAgICAgICAgICAibWFya191cCI6IDAsCiAgICAgICAgICAgICAgICAgICAgImJpbGxhYmxlIjogMCwKICAgICAgICAgICAgICAgICAgICAidGF4X2NvZGUiOiAiIiwKICAgICAgICAgICAgICAgICAgICAicGF5bWVudF9tZXRob2QiOiB7fSwKICAgICAgICAgICAgICAgICAgICAiY3VycmVuY3kiOiB0aGlzLmV4Y2hhbmdlUmF0ZSwKICAgICAgICAgICAgICAgICAgICAiZXhjaGFuZ2VfcmF0ZV91dWlkIjogIiIsCiAgICAgICAgICAgICAgICAgICAgImV4Y2hhbmdlX3JhdGUiOiB0aGlzLnJhdGUsCiAgICAgICAgICAgICAgICAgICAgImV4Y2hhbmdlZF9hbW91bnQiOiBwYXJzZUZsb2F0KG9iai5wcmluY2lwYWxBbW91bnQpICogcGFyc2VGbG9hdCh0aGlzLnJhdGUpLAogICAgICAgICAgICAgICAgICAgICJ0YXhfYW1vdW50IjogMCwKICAgICAgICAgICAgICAgICAgICAiZXhjaGFuZ2VkX3RheF9hbW91bnQiOiAwLAogICAgICAgICAgICAgICAgICAgICJpc19yZWNvbmNpbGVkIjogMCwKICAgICAgICAgICAgICAgICAgICAiaXNfc2V0dGxlZCI6IDAsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzXzFfdXVpZCI6ICIiLAogICAgICAgICAgICAgICAgICAgICJjbGFzc18yX3V1aWQiOiAiIiwKICAgICAgICAgICAgICAgICAgICAiY2xhc3NfM191dWlkIjogIiIsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzXzRfdXVpZCI6ICIiLAogICAgICAgICAgICAgICAgICAgICJjbGFzc181X3V1aWQiOiAiIiwKICAgICAgICAgICAgICAgICAgICAicGF5bWVudF9tZXRob2RfYXMiOiAiIiwKICAgICAgICAgICAgICAgICAgICAiY3JlYXRlZF9ieSI6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgIm1vZGlmaWVkX2J5IjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAiY3JlYXRlZF9kYXRlIjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAibW9kaWZpZWRfZGF0ZSI6IG51bGwKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9iai5pbnRlcmVzdEFtb3VudCA+IDApIHsKICAgICAgICAgICAgICAgIGpqLnB1c2goewogICAgICAgICAgICAgICAgICAgICJ1dWlkIjogIiIsCiAgICAgICAgICAgICAgICAgICAgImFjY291bnQiOiB0aGlzLmxpc3RPZkxvYW4uaW50ZXJlc3RBY2NvdW50LAogICAgICAgICAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICcnLAogICAgICAgICAgICAgICAgICAgICJ0aGlyZF9jb250YWN0cyI6IFtdLAogICAgICAgICAgICAgICAgICAgICJyZWZfbnVtYmVyIjogJycsCiAgICAgICAgICAgICAgICAgICAgImFtb3VudCI6IHBhcnNlRmxvYXQob2JqLmludGVyZXN0QW1vdW50KSwKICAgICAgICAgICAgICAgICAgICAiZGlzY291bnQiOiB7fSwKICAgICAgICAgICAgICAgICAgICAibWFya191cCI6IDAsCiAgICAgICAgICAgICAgICAgICAgImJpbGxhYmxlIjogMCwKICAgICAgICAgICAgICAgICAgICAidGF4X2NvZGUiOiAiIiwKICAgICAgICAgICAgICAgICAgICAicGF5bWVudF9tZXRob2QiOiB7fSwKICAgICAgICAgICAgICAgICAgICAiY3VycmVuY3kiOiB0aGlzLmV4Y2hhbmdlUmF0ZSwKICAgICAgICAgICAgICAgICAgICAiZXhjaGFuZ2VfcmF0ZV91dWlkIjogIiIsCiAgICAgICAgICAgICAgICAgICAgImV4Y2hhbmdlX3JhdGUiOiB0aGlzLnJhdGUsCiAgICAgICAgICAgICAgICAgICAgImV4Y2hhbmdlZF9hbW91bnQiOiBwYXJzZUZsb2F0KG9iai5pbnRlcmVzdEFtb3VudCkgKiBwYXJzZUZsb2F0KHRoaXMucmF0ZSksCiAgICAgICAgICAgICAgICAgICAgInRheF9hbW91bnQiOiAwLAogICAgICAgICAgICAgICAgICAgICJleGNoYW5nZWRfdGF4X2Ftb3VudCI6IDAsCiAgICAgICAgICAgICAgICAgICAgImlzX3JlY29uY2lsZWQiOiAwLAogICAgICAgICAgICAgICAgICAgICJpc19zZXR0bGVkIjogMCwKICAgICAgICAgICAgICAgICAgICAiY2xhc3NfMV91dWlkIjogIiIsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzXzJfdXVpZCI6ICIiLAogICAgICAgICAgICAgICAgICAgICJjbGFzc18zX3V1aWQiOiAiIiwKICAgICAgICAgICAgICAgICAgICAiY2xhc3NfNF91dWlkIjogIiIsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzXzVfdXVpZCI6ICIiLAogICAgICAgICAgICAgICAgICAgICJwYXltZW50X21ldGhvZF9hcyI6ICIiLAogICAgICAgICAgICAgICAgICAgICJjcmVhdGVkX2J5IjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAibW9kaWZpZWRfYnkiOiBudWxsLAogICAgICAgICAgICAgICAgICAgICJjcmVhdGVkX2RhdGUiOiBudWxsLAogICAgICAgICAgICAgICAgICAgICJtb2RpZmllZF9kYXRlIjogbnVsbAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob2JqLnBlbmFsdHlBbW91bnQgPiAwKSB7CiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5yLnBlbmFsdHlBY2NvdW50KS5sZW5ndGggPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoJ1BsZWFzZSBzZWxlY3QgcGVuYWx0eSBhY2NvdW50JykKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGpqLnB1c2goewogICAgICAgICAgICAgICAgICAgICJ1dWlkIjogIiIsCiAgICAgICAgICAgICAgICAgICAgImFjY291bnQiOiB0aGlzLnBlbmFsdHlBY2NvdW50LAogICAgICAgICAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICcnLAogICAgICAgICAgICAgICAgICAgICJ0aGlyZF9jb250YWN0cyI6IFtdLAogICAgICAgICAgICAgICAgICAgICJyZWZfbnVtYmVyIjogJycsCiAgICAgICAgICAgICAgICAgICAgImFtb3VudCI6IHBhcnNlRmxvYXQob2JqLnBlbmFsdHlBbW91bnQpLAogICAgICAgICAgICAgICAgICAgICJkaXNjb3VudCI6IHt9LAogICAgICAgICAgICAgICAgICAgICJtYXJrX3VwIjogMCwKICAgICAgICAgICAgICAgICAgICAiYmlsbGFibGUiOiAwLAogICAgICAgICAgICAgICAgICAgICJ0YXhfY29kZSI6ICIiLAogICAgICAgICAgICAgICAgICAgICJwYXltZW50X21ldGhvZCI6IHt9LAogICAgICAgICAgICAgICAgICAgICJjdXJyZW5jeSI6IHRoaXMuZXhjaGFuZ2VSYXRlLAogICAgICAgICAgICAgICAgICAgICJleGNoYW5nZV9yYXRlX3V1aWQiOiAiIiwKICAgICAgICAgICAgICAgICAgICAiZXhjaGFuZ2VfcmF0ZSI6IHRoaXMucmF0ZSwKICAgICAgICAgICAgICAgICAgICAiZXhjaGFuZ2VkX2Ftb3VudCI6IHBhcnNlRmxvYXQob2JqLnBlbmFsdHlBbW91bnQpICogcGFyc2VGbG9hdCh0aGlzLnJhdGUpLAogICAgICAgICAgICAgICAgICAgICJ0YXhfYW1vdW50IjogMCwKICAgICAgICAgICAgICAgICAgICAiZXhjaGFuZ2VkX3RheF9hbW91bnQiOiAwLAogICAgICAgICAgICAgICAgICAgICJpc19yZWNvbmNpbGVkIjogMCwKICAgICAgICAgICAgICAgICAgICAiaXNfc2V0dGxlZCI6IDAsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzXzFfdXVpZCI6ICIiLAogICAgICAgICAgICAgICAgICAgICJjbGFzc18yX3V1aWQiOiAiIiwKICAgICAgICAgICAgICAgICAgICAiY2xhc3NfM191dWlkIjogIiIsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzXzRfdXVpZCI6ICIiLAogICAgICAgICAgICAgICAgICAgICJjbGFzc181X3V1aWQiOiAiIiwKICAgICAgICAgICAgICAgICAgICAicGF5bWVudF9tZXRob2RfYXMiOiAiIiwKICAgICAgICAgICAgICAgICAgICAiY3JlYXRlZF9ieSI6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgIm1vZGlmaWVkX2J5IjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAiY3JlYXRlZF9kYXRlIjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAibW9kaWZpZWRfZGF0ZSI6IG51bGwKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gbGV0IGRhdGEgPSB7CiAgICAgICAgICAgIC8vICAgICAibnVtYmVyIjogdGhpcy5qb3VybmFsTnVtYmVyLAogICAgICAgICAgICAvLyAgICAgImRlc2NyaXB0aW9uIjogIkxvYW4gUmVjZWlwdCIsCiAgICAgICAgICAgIC8vICAgICAiam91cm5hbF90eXBlIjogImdlbmVyYWxfam91cm5hbCIsCiAgICAgICAgICAgIC8vICAgICAiam91cm5hbF9kYXRlIjogbmV3IERhdGUob2JqLmlzc3VlZERhdGUpLAogICAgICAgICAgICAvLyAgICAgImN1cnJlbmN5X2NvZGUiOiB0aGlzLmN1cnJlbmN5Q29kZSwKICAgICAgICAgICAgLy8gICAgICJidWluc2Vzc191bml0X3V1aWQiOiAiIiwKICAgICAgICAgICAgLy8gICAgICJsb2NhdGlvbl91dWlkIjogIiIsCiAgICAgICAgICAgIC8vICAgICAicHJvamVjdF91dWlkIjogIiIsCiAgICAgICAgICAgIC8vICAgICAic2VnbWVudF91dWlkIjogIiIsCiAgICAgICAgICAgIC8vICAgICAiam91cm5hbF9lbnRyaWVzIjogamosCiAgICAgICAgICAgIC8vICAgICAidHJhbnNhY3Rpb25fdHlwZSI6ICJqb3VybmFsIiwKICAgICAgICAgICAgLy8gICAgICJpc19kcmFmdCI6IDAsCiAgICAgICAgICAgIC8vICAgICAiaXNfcmV2ZXJzZWQiOiAwLAogICAgICAgICAgICAvLyAgICAgInByZWZpeF9mb3JtYXQiOiB0aGlzLmpvdXJuYWxQcmVmaXgsCiAgICAgICAgICAgIC8vICAgICAiY3JlYXRlZF9ieSI6IHRoaXMubG9nZ2VkVXNlcgogICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIHRoaXMuam91cm5hbC5wcmVmaXhfZm9ybWF0ID0gdGhpcy5qb3VybmFsUHJlZml4CiAgICAgICAgICAgIHRoaXMuam91cm5hbC5qb3VybmFsX2VudHJpZXMgPSBqagogICAgICAgICAgICB0aGlzLmpvdXJuYWwuY3VycmVuY3lfY29kZSA9IHRoaXMuY3VycmVuY3lDb2RlCiAgICAgICAgICAgIHRoaXMuam91cm5hbC5qb3VybmFsX2RhdGUgPSBIZWxwZXIudG9JU09EYXRlKHRoaXMuci5pc3N1ZWREYXRlKQogICAgICAgICAgICB0aGlzLmpvdXJuYWwuY3JlYXRlZF9ieSA9IHRoaXMubG9nZ2VkVXNlcgogICAgICAgICAgICBpZih0aGlzLmxpc3RPZkxvYW4uaGFzT3duUHJvcGVydHkoJ3NlZ21lbnQnKSl7CiAgICAgICAgICAgICAgICB0aGlzLmpvdXJuYWwuc2VnbWVudF91dWlkID0gdGhpcy5saXN0T2ZMb2FuLnNlZ21lbnQuaWQKICAgICAgICAgICAgfQogICAgICAgICAgICBpZih0aGlzLmxpc3RPZkxvYW4uaGFzT3duUHJvcGVydHkoJ2xvY2F0aW9uJykpewogICAgICAgICAgICAgICAgdGhpcy5qb3VybmFsLmxvY2F0aW9uX3V1aWQgPSB0aGlzLmxpc3RPZkxvYW4ubG9jYXRpb24uaWQKICAgICAgICAgICAgfQogICAgICAgICAgICBqb3VybmFsSGFuZGxlci5zYXZlKG5ldyBKb3VybmFsTW9kZWwodGhpcy5qb3VybmFsKSkKICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyhyZXNwb25zZSwgJ3JlcycpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5yLnVzZXIgPSBzZWxmLmxvZ2dlZFVzZXIKICAgICAgICAgICAgICAgICAgICBzZWxmLnIubG9hbiA9IHNlbGYubGlzdE9mTG9hbgogICAgICAgICAgICAgICAgICAgIHNlbGYuci5qb3VybmFsID0gSlNPTi5zdHJpbmdpZnkoc2VsZi5qb3VybmFsKQogICAgICAgICAgICAgICAgICAgIHNlbGYuci5qb3VybmFsSWQgPSByZXNwb25zZS5kYXRhLnV1aWQKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coc2VsZi5yLCAncmVjZWlwdCBvYmonKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2F2ZVJlY2VpcHQoKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICBIZWxwZXIuYWxlcnRFcnJvck1zZyhlcnJvcikKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coZXJyb3IpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmZpbmFsbHkoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHNlbGYuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFNlZ21lbnQoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgncmVzb2x2ZWQnKQogICAgICAgICAgICAgICAgICAgIHRoaXMuc2VnbWVudCA9IHt9CiAgICAgICAgICAgICAgICAgICAgbG9hbkhhbmRsZXIuYnVzaW5lc3NTZXR0aW5nR2V0KCkudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzID0gcmVzLmRhdGEuZGF0YS5maWx0ZXIoKG9iaikgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmoudHlwZSA9PSAiQ3JlZGl0IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlZ21lbnQgPSBzWzBdLnNlZ21lbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcignUGxlYXNlIHNlbGVjdCBzZWdtZW50IG9uIHNldHRpbmcgcGFnZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW5jZWwoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMzAwKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgc2F2ZVJlY2VpcHQoKSB7CiAgICAgICAgICAgIGxvYW5IYW5kbGVyLmxvYW5QYXltZW50Q3JlYXRlKG5ldyBMb2FuUmVjZWlwdE1vZGVsKHRoaXMucikpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXNDb2RlID09PSAyMDEpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LnN1Y2Nlc3MoJ1N1Y2Nlc3NmdWxseScpCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93UmVjZWlwdCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYWtlU2NoZWR1bGUoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS5jYXRjaChlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcignU29tZXRoaW5nIHdlbnQgd3JvbmcnKQogICAgICAgICAgICAgICAgdGhpcy5lcnJvcnMucHVzaChlKQogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKGUsICdlcnJvcicpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkU2FsZUZvcm1Db250ZW50KCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBzYWxlRm9ybUNvbnRlbnRIYW5kbGVyLmxpc3QoKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYWxlRm9ybUNvbnRlbnQgPSBkYXRhWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyhkYXRhWzBdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgbnVtYmVyRm9ybWF0YSh2YWx1ZSkgewogICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2codGhpcy5zYWxlRm9ybUNvbnRlbnQuZGVjaW1hbCwnbmltb2wnKQogICAgICAgICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcodmFsdWUsIGBuJHt0aGlzLnNhbGVGb3JtQ29udGVudC5kZWNpbWFsfWApOwogICAgICAgICAgICAvLyByZXR1cm4gdmFsdWUKICAgICAgICB9LAogICAgICAgIGdlbmVyYXRlTnVtYmVyKCkgewogICAgICAgICAgICBsZXQgZGF0YSA9IHsKICAgICAgICAgICAgICAgIGFiYnI6IHRoaXMudHJhbnNhY3Rpb25UeXBlLmFiYnIsCiAgICAgICAgICAgICAgICBzdHJ1Y3R1cmU6IHRoaXMudHJhbnNhY3Rpb25UeXBlLnN0cnVjdHVyZSwKICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogdGhpcy5yLmlzc3VlZERhdGUsCiAgICAgICAgICAgICAgICB0eXBlOiAiUmVjb3JkIExvYW4gUGVyaW9kaWMgUGF5bWVudCIsCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGJpbGxpbmdIYW5kbGVyCiAgICAgICAgICAgICAgICAubGFzdE51bWJlcihkYXRhKQogICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdWZmaXggPSByZXMuc3VmZml4OwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldExhc3ROdW0oKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvcnMucHVzaChlKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgZ2V0TGFzdE51bSgpewogICAgICAgICAgICBsZXQgZCA9IHsKICAgICAgICAgICAgICAgIHR5cGU6ICJSZWNvcmRQYXltZW50IiwKICAgICAgICAgICAgfTsKICAgICAgICAgICAgbG9hbkhhbmRsZXIKICAgICAgICAgICAgICAgIC5nZXRMYXN0TnVtYmVyKGQpCiAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGFzdE51bWJlciA9IHRoaXMuemVyb1BhZCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlSW50KHJlcy5sYXN0TnVtYmVyKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb25UeXBlLmZvcm1hdAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnIubGFzdE51bWJlciA9IHBhcnNlSW50KHJlcy5sYXN0TnVtYmVyKQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBudW1iZXIgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdWZmaXggKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvblR5cGUubnVtYmVyU2VwYXJhdG9yICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3ROdW1iZXI7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkZXMgPSAnJwogICAgICAgICAgICAgICAgICAgICAgICBpZihPYmplY3Qua2V5cyh0aGlzLmxvYW4pLmxlbmd0aCA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzID0gYFBheSBMb2FuIGZyb20gJHt0aGlzLmxvYW4uZmluYW5jaWFsSW5zdGl0dXRpb25zLm5hbWV9IEZvciBMb2FuIE51bWJlciAke3RoaXMubG9hbi5hcHByb3ZlTnVtYmVyfWA7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuam91cm5hbCA9IG5ldyBKb3VybmFsTW9kZWwoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGRlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uX3R5cGU6IExvYW5UeXBlLlJFUEFZTUVOVCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvdXJuYWxfdHlwZTogTG9hblR5cGUuUkVQQVlNRU5ULAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5qb3VybmFsLmFiYnIgPSB0aGlzLnRyYW5zYWN0aW9uVHlwZS5hYmJyCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMubG9hbi5hY3RpdmVEYXRlID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnN1YnN0cigwLCAxMCk7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGQgMiBkZWZhdWx0IHJvd3MKICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5hZGRSb3dUKHRoaXMuJHJlZnMuY2FzaEJhbmtBY2NvdW50RFMua2VuZG9XaWRnZXQoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCAyOyBpbmRleCsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICB0aGlzLmFkZFJvdyh0aGlzLiRyZWZzLnJlbGF0ZWRDb3N0RFMua2VuZG9XaWRnZXQoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5qb3VybmFsLm51bWJlciA9IHRoaXMudHJhbnNhY3Rpb25UeXBlLmFiYnIgKyB0aGlzLnRyYW5zYWN0aW9uVHlwZS5udW1iZXJTZXBhcmF0b3IgKyBudW1iZXIKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yLmFiYnIgPSB0aGlzLnRyYW5zYWN0aW9uVHlwZS5hYmJyCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuci5udW1iZXIgPSB0aGlzLnRyYW5zYWN0aW9uVHlwZS5hYmJyICsgdGhpcy50cmFuc2FjdGlvblR5cGUubnVtYmVyU2VwYXJhdG9yICsgbnVtYmVyOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRQcmVmaXgoKSB7CiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlCiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIHByZWZpeEhhbmRsZXIuZ2V0KCJyZWNvcmQgbG9hbiBwZXJpb2RpYyBwYXltZW50IikudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb25UeXBlID0gcmVzLmRhdGEuZGF0YVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVOdW1iZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgfSwKICAgIG1vdW50ZWQ6IGFzeW5jIGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyBhd2FpdCB0aGlzLmxvYWRDdXJyZW5jeURhdGEoKQogICAgICAgIC8vIGF3YWl0IHRoaXMubG9hZERlY2ltYWwoKQogICAgICAgIC8vIGF3YWl0IHRoaXMubG9hZFNlZ21lbnQoKQogICAgICAgIGF3YWl0IHRoaXMuZ2V0Sm91cm5hbE51bWJlcigpCiAgICAgICAgYXdhaXQgdGhpcy5sb2FkU2FsZUZvcm1Db250ZW50KCkKICAgICAgICAvLyBhd2FpdCB0aGlzLmxvYWRTaW5nbGVQZW5hbHR5KCkKICAgIH0sCiAgICBjcmVhdGVkOiBhc3luYyBmdW5jdGlvbiAoKSB7CiAgICAgICAgYXdhaXQgdGhpcy5sb2FkQWNjb3VudCgpCiAgICB9LAp9Cg=="},{"version":3,"sources":["ListOfLoan.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ListOfLoan.vue","sourceRoot":"src/views/finances/management/loan_center","sourcesContent":["<template>\n    <v-row>\n        <v-col sm=\"12\" cols=\"12\" class=\"pt-0\">\n            <v-simple-table>\n                <template v-slot:default>\n                    <tbody>\n                    <tr>\n                        <td class=\"text-uppercase\">{{ $t('ending_balance') }}</td>\n                        <td class=\"\">:</td>\n                        <td class=\"text-left text-bold\">{{ numberFormata(outStandingBalance) }}</td>\n                    </tr>\n                    <tr>\n                        <td class=\"text-uppercase\">{{ $t('total_paid') }}</td>\n                        <td class=\"\">:</td>\n                        <td class=\"text-left text-bold\">{{ numberFormata(totalPaid) }}</td>\n                    </tr>\n                    <tr>\n                        <td class=\"third white--text text-uppercase mt-5\">{{ $t('loan_number') }}</td>\n                        <td class=\"third white--text \">:</td>\n                        <td class=\"third white--text text-left text-bold mt-5\">{{ loanNumber }}</td>\n                    </tr>\n                    <tr>\n                        <td class=\"third white--text text-uppercase mt-5\">{{ $t('total_payment') }}</td>\n                        <td class=\"third white--text \">:</td>\n                        <td class=\"third white--text text-left text-bold mt-5\">{{ numberFormata(totalPayment) }}</td>\n                    </tr>\n                    <tr>\n                        <td class=\"secondary white--text text-uppercase mt-5\">{{ $t('total_interest') }}</td>\n                        <td class=\"secondary white--text\">:</td>\n                        <td class=\"secondary white--text text-left text-bold mt-5\">{{numberFormata(Interest)}}</td>\n                    </tr>\n                    <tr>\n                        <td class=\"secondary white--text text-uppercase mt-5\">{{ $t('currency') }}</td>\n                        <td class=\"secondary white--text\">:</td>\n                        <td class=\"secondary white--text text-left text-bold mt-5\">{{currencyCode}}</td>\n                    </tr>\n                    </tbody>\n                </template>\n            </v-simple-table>\n        </v-col>\n        <v-col sm=\"12\" cols=\"12\" class=\"pt-0\">\n            <v-simple-table>\n                <template>\n                    <v-simple-table class=\"attachment_table\">\n                        <template>\n                            <kendo-datasource\n                                ref=\"loanSchedule\"\n                                :change=\"dataSourceChanged\"\n                                :page-size='10'\n                                :data=\"scheduleAR\"/>\n                            <kendo-grid\n                                id=\"loanSchedule\" class=\"grid-function\"\n                                :data-source-ref=\"'loanSchedule'\"\n                                :sortable=\"false\"\n                                :filterable=\"false\"\n                                :column-menu=\"false\"\n                                :editable=\"true\"\n                                :data-items=\"items\"\n                                :skip= \"skip\"\n                                :take=\"take\"\n                                :total=\"total\"\n                                :pageable=\"true\"\n                                :page-size=\"pageSize\"\n                                :scrollable-virtual=\"false\"\n                                v-on:databound=\"dataBound\"\n                            >\n                                <kendo-grid-column\n                                    :field=\"'date'\"\n                                    :title=\"$t('date')\"\n                                    :width=\"200\"\n                                    :editable=\"()=>{ return false}\"\n                                    :headerAttributes=\"{style: 'background-color: #EDF1F5'}\"\n                                />\n                                <kendo-grid-column\n                                    :field=\"'totalAmount'\"\n                                    :title=\"$t('pay')\"\n                                    :width=\"150\"\n                                    :editable=\"()=>{ return false}\"\n                                    :headerAttributes=\"{style: 'background-color: #EDF1F5'}\"\n                                />\n                                <kendo-grid-column\n                                    :field=\"'principalAmount'\"\n                                    :title=\"$t('principal')\"\n                                    :width=\"150\"\n                                    :format=\"'{0:n}'\"\n                                    :editable=\"()=>{ return false}\"\n                                    :headerAttributes=\"{style: 'background-color: #EDF1F5'}\"\n                                />\n                                <kendo-grid-column\n                                    :field=\"'interestAmount'\"\n                                    :title=\"$t('interest')\"\n                                    :width=\"150\"\n                                    :format=\"'{0:n}'\"\n                                    :editable=\"()=>{ return false}\"\n                                    :headerAttributes=\"{style: 'background-color: #EDF1F5'}\"\n                                />\n                                <kendo-grid-column\n                                    :field=\"'endingBalance'\"\n                                    :title=\"$t('balance')\"\n                                    :width=\"150\"\n                                    :format=\"'{0:n}'\"\n                                    :headerAttributes=\"{style: 'background-color: #EDF1F5'}\"\n                                />\n                                <kendo-grid-column\n                                    :field=\"'numStatus'\"\n                                    :title=\"$t('action')\"\n                                    :command=\"[{text: $t('pay'), click: searchLoanPaid }]\"\n                                    :headerAttributes=\"{ style: 'background-color: #EDF1F5' }\"/>\n                            </kendo-grid>\n                        </template>\n                        <!--                                    :template=\"actionTmpl\"-->\n<!--                        <template v-slot:default>-->\n<!--                            <thead>-->\n<!--                            <tr>-->\n<!--                                <th class=\"text-uppercase px-2 py-2\" style=\"text-align: left;\">{{ $t('date') }}</th>-->\n<!--                                <th class=\"text-uppercase px-2 py-2\" style=\"text-align: left;\">{{ $t('pay') }}</th>-->\n<!--                                <th class=\"text-uppercase px-2 py-2\" style=\"text-align: left;\">{{ $t('principal') }}</th>-->\n<!--                                <th class=\"text-uppercase px-2 py-2\" style=\"text-align: left;\">{{ $t('interest') }}</th>-->\n<!--                                <th class=\"text-uppercase px-2 py-2\" style=\"text-align: left;\">{{ $t('balance') }}</th>-->\n<!--                                <th class=\"text-uppercase px-2 py-2\" style=\"text-align: left;\">{{ $t('action') }}</th>-->\n<!--                            </tr>-->\n<!--                            </thead>-->\n<!--                            <tbody>-->\n<!--                            <tr v-for=\"d in scheduleAR\" v-bind:key=\"d.no\">-->\n<!--                                <td>{{ d.date != 'Total' ? d.date : $t('total') }}</td>-->\n<!--                                <td class=\"px-2\" style=\"text-align: right;\">{{ d.totalAmount }}</td>-->\n<!--                                <td class=\"px-2\" style=\"text-align: right;\">{{ d.principalAmount }}</td>-->\n<!--                                <td class=\"px-2\" style=\"text-align: right;\">{{ d.interestAmount }}</td>-->\n<!--                                <td class=\"px-2\" style=\"text-align: right;\">{{ d.date != 'Total' ? d.endingBalance : '' }}</td>-->\n<!--                                <td class=\"px-2 py-1\" style=\"text-align: center;\">-->\n<!--                                    {{ d.numStatus == 2 ? d.status : '' }}-->\n<!--                                    <v-btn color=\"primary\" class=\"\" v-show=\"d.numStatus == 1\" @click=\"searchLoanPaid(d)\" style=\"font-size: 14px;\">-->\n<!--                                        {{ $t('pay') }}-->\n<!--                                    </v-btn>-->\n<!--                                </td>-->\n<!--                            </tr>-->\n<!--                            </tbody>-->\n<!--                        </template>-->\n                    </v-simple-table>\n                </template>\n\n            </v-simple-table>\n        </v-col>\n        <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n            <v-row>\n                <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                    <v-dialog v-model=\"showReceipt\" max-width=\"850px\">\n                        <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                            <v-card>\n                                <v-card-title><h3>{{ loanName }}</h3></v-card-title>\n                                <v-icon class=\"btn_close\" @click=\"showReceipt = false\"  \n                                    style=\"cursor: pointer; color: #333; font-size: 40px;\">close</v-icon>\n                                <v-divider/>\n                                <v-card-text style=\"height: 450px; color: #333333;\">\n                                    <v-row class=\"px-4 mb-4\">\n                                        <v-col sm=\"6\" cols=\"12\" class=\"\">\n                                            <label class=\"label\">{{ $t('date') }}</label>\n                                            <app-datepicker\n                                                class=\"mt-1\"\n                                                :initialDate=\"r.issuedDate\"\n                                                @emitDate=\"r.issuedDate = $event\"/>\n                                            <label class=\"label\">{{ $t('cash_account') }}</label>\n                                            <v-select\n                                                class=\"mt-1\"\n                                                outlined\n                                                return-object\n                                                id=\"\"\n                                                :items=\"cashAccounts\"\n                                                item-text=\"name\"\n                                                item-value=\"id\"\n                                                v-model=\"r.cashAccount\"\n                                            />\n                                            <label class=\"label\">{{ $t('penalty_account') }}</label>\n                                            <v-select\n                                                class=\"mt-1\"\n                                                outlined\n                                                return-object\n                                                id=\"\"\n                                                :items=\"penaltyAccounts\"\n                                                item-text=\"name\"\n                                                item-value=\"id\"\n                                                v-model=\"r.penaltyAccount\"\n                                            />\n                                        </v-col>\n                                        <v-col sm=\"6\" cols=\"12\" class=\"function_content pa-3\">\n                                            <v-card class=\"pa-3 no-boxshadow d-flex justify-space-between align-center\"\n                                                    min-height=\"50px\" color=\"primary\">\n                                                <h3 style=\"font-size: 18px\" class=\"text-white text-uppercase\">\n                                                {{ $t('pay_amount') }}</h3>\n                                                <h3 class=\"text-bold float-right text-white\" style=\"font-size: 22px\">\n                                                {{(receiptAmount) }}</h3>\n                                                \n                                            </v-card>\n                                            <v-simple-table>\n                                                <template v-slot:default>\n                                                    <tbody>\n                                                        <tr>\n                                                            <td class=\"text-left pr-0\" style=\"height: 48px !important;\">{{\n                                                                $t('currency')\n                                                            }}\n                                                            </td>\n                                                            <td class=\"text-center\">:</td>\n                                                            <td class=\"text-right\">\n                                                                {{ (currencyCode) }}\n                                                            </td>\n                                                        </tr>\n                                                        <tr>\n                                                            <td class=\"text-left pr-0\" style=\"height: 48px !important;\">{{\n                                                                    $t('rate')\n                                                                }}\n                                                            </td>\n                                                            <td class=\"text-center\">:</td>\n                                                            <td class=\"text-right\">\n                                                                {{ (rate) }}\n                                                            </td>\n                                                        </tr>\n                                                        <tr>\n                                                            <td class=\"text-left pr-0\">{{\n                                                                $t('number')\n                                                            }}\n                                                            </td>\n                                                            <td class=\"text-center\">:</td>\n                                                            <td class=\"text-right\">\n                                                                <v-text-field\n                                                                    v-model=\"r.number\"\n                                                                    style=\"text-align:right;direction: rtl;display: inline;\"\n                                                                    disabled/>\n                                                            </td>\n                                                        </tr>\n                                                        \n                                                    </tbody>\n                                                </template>\n                                            </v-simple-table>\n                                        </v-col>\n                                    </v-row>\n                                    <template>\n                                        <kendo-datasource\n                                            ref=\"receiptList\"\n                                            :change=\"dataSourceChanged\"\n                                            :data=\"schedule\"/>\n                                        <kendo-grid\n                                            id=\"gridSaleDeposit\" class=\"grid-function\"\n                                            :data-source-ref=\"'receiptList'\"\n                                            :sortable=\"true\"\n                                            :filterable=\"false\"\n                                            :column-menu=\"false\"\n                                            :editable=\"true\"\n                                            :scrollable-virtual=\"true\"\n                                        >\n                                            <kendo-grid-column\n                                                :field=\"'date'\"\n                                                :title=\"$t('payment_date')\"\n                                                :width=\"200\"\n                                                :editable=\"()=>{ return false}\"\n                                                :headerAttributes=\"{style: 'background-color: #EDF1F5'}\"\n                                            />\n                                            <kendo-grid-column\n                                                :field=\"'principal'\"\n                                                :title=\"$t('principle_amount')\"\n                                                :width=\"200\"\n                                                :editable=\"()=>{ return false}\"\n                                                :headerAttributes=\"{style: 'background-color: #EDF1F5'}\"\n                                            />\n                                            <kendo-grid-column\n                                                :field=\"'interest'\"\n                                                :title=\"$t('interest')\"\n                                                :width=\"200\"\n                                                :format=\"'{0:n}'\"\n                                                :editable=\"()=>{ return false}\"\n                                                :headerAttributes=\"{style: 'background-color: #EDF1F5'}\"\n                                            />\n                                            <kendo-grid-column\n                                                :field=\"'total'\"\n                                                :title=\"$t('total_payment')\"\n                                                :width=\"200\"\n                                                :format=\"'{0:n}'\"\n                                                :editable=\"()=>{ return false}\"\n                                                :hidden=\"true\"\n                                                :headerAttributes=\"{style: 'background-color: #EDF1F5'}\"\n                                            />\n                                            <kendo-grid-column\n                                                :field=\"'penalty'\"\n                                                :title=\"$t('penalty')\"\n                                                :width=\"200\"\n                                                :format=\"'{0:n}'\"\n                                                :headerAttributes=\"{style: 'background-color: #EDF1F5'}\"\n                                            />\n                                        </kendo-grid>\n                                    </template>\n                                </v-card-text>\n                                <v-divider/>\n                                <v-card-actions class=\"pa-4\">\n                                    <v-row>\n                                        <v-col sm=\"6\" cols=\"6\" class=\"py-0\">\n                                            <v-btn color=\"black\"\n                                                   outlined\n                                                   class=\" text-capitalize rounded-pill black--text float-left\"\n                                                   @click=\"showReceipt = false\">{{ $t('cancel') }}\n                                            </v-btn>\n                                        </v-col>\n                                        <v-col sm=\"6\" cols=\"6\" class=\"py-0\">\n                                            <v-btn color=\"secondary\"\n                                                   v-show=\"!isPaid\"\n                                                   class=\"px-3 rounded-pill white--text text-capitalize float-right\"\n                                                   @click=\"addJournal\">\n                                                {{ $t('save') }}\n                                            </v-btn>\n                                        </v-col>\n                                    </v-row>\n                                </v-card-actions>\n                            </v-card>\n                        </v-form>\n                    </v-dialog>\n                </v-col>\n            </v-row>\n        </v-col>\n        <LoadingMe\n            :isLoading=\"showLoading\"\n            :fullPage=\"true\"\n            type=\"loading\"\n            :myLoading=\"true\"/>\n    </v-row>\n</template>\n<script>\nimport { i18n } from '@/i18n';\nimport kendo from \"@progress/kendo-ui\"\nconst $ = kendo.jQuery\nconst currencyHandler = require(\"@/scripts/currency/handler/currencyHandler\")\nimport LoanReceiptModel from '@/scripts/financing/model/LoanReceipt'\nimport {dataStore} from '@/observable/store'\nconst loanHandler = require(\"@/scripts/financing/handler/loanHandler\")\nconst accountHandler = require(\"@/scripts/handler/accounting/account\")\n// journal\nconst store = require(\"@/institute.js\")\nconst {cookies} = store.default.state\nimport {JournalModel, UserModel} from \"@/scripts/model/AppModels\"\nimport Helper from \"@/helper.js\"\nimport saleFormContentHandler from \"@/scripts/saleFormContentHandler\";\nimport billingHandler from \"@/scripts/invoice/handler/billingHandler\";\n// import LoanType from \"@/scripts/default_setup/LoanType.js\";\nimport {prefixHandler} from \"@/scripts/AppHandlers\";\nconst { journalHandler } = require(\"@/scripts/AppHandlers\");\nconst {EntityType} = require(\"@/scripts/default_setup/Collections\")\nconst LoanType = require(\"@/scripts/default_setup/LoanType.js\");\nexport default {\n    name: \"ListOfLoan\",\n    props: {listOfLoan: {}},\n    computed: {\n        loanNumber() {\n            if (this.listOfLoan) {\n                this.makeSchedule()\n                return this.listOfLoan.approveNumber\n            }\n            return ''\n        },\n        currencyCode() {\n            if (this.listOfLoan) {\n                if (this.listOfLoan.hasOwnProperty('currency')) {\n                    return this.listOfLoan.currency.code\n                }\n            }\n            return ''\n        },\n        loanName() {\n            if (this.listOfLoan) {\n                return this.listOfLoan.approveNumber + '-' + this.listOfLoan.name\n            }\n            return ''\n        },\n        outStandingBalance(){\n            if (this.listOfLoan) {\n                return this.listOfLoan.outStandingBalance\n            }\n            return ''\n        },\n        Interest(){\n            if (this.listOfLoan) {\n                return this.listOfLoan.totalInterest\n            }\n            return ''\n        },\n        items: {\n            get: function() {\n                return this.scheduleAR.slice(this.skip, this.take + this.skip);\n            }\n        },\n        total () {\n            return this.scheduleAR ? this.scheduleAR.length : 0;\n        }\n    },\n    components: {\n        LoadingMe: () => import(`@/components/Loading`),\n        'app-datepicker': () => import('@/components/custom_templates/DatePickerComponent')\n    },\n    data: () => ({\n        errors: [],\n        skip: 0,\n        take: 10,\n        pageSize: 10,\n        pageable: {\n            info: true,\n            type: 'numeric',\n            pageSizes: true,\n            previousNext: true\n        },\n        journalNumber: '',\n        journalPrefix: '',\n        journalTxnType: EntityType.JOURNAL,\n        loggedUser: new UserModel(cookies.user),\n        scheduleAR: [],\n        info: {},\n        totalPayment: 0,\n        format: '',\n        totalPaid: '',\n        endingBalance: '',\n        numberFormat: 'n0',\n        exchangeRate: {},\n        rate: 1,\n        r: new LoanReceiptModel({}),\n        isPaid: false,\n        segment: {},\n        pin: dataStore.pin,\n        segments: [],\n        cashAccounts: [],\n        schedule: [],\n        penaltyAccount: {},\n        showReceipt: false,\n        valid: true,\n        receiptAmount: 0,\n        interestAmount: 0,\n        showLoading: false,\n        penaltyAccounts: [],\n        saleFormContent: {},\n        transactionType: {},\n        suffix: '',\n        loan: {},\n        journal: {}\n    }),\n    watch: {},\n    methods: {\n        zeroPad(num, places) {\n            return String(num).padStart(places, \"0\");\n        },\n        dataSourceChanged(e) {\n            if (e.field) {\n                let dataRow = e.items[0]\n                window.console.log(dataRow)\n            }\n        },\n        // async loadDecimal() {\n        //     new Promise(resolve => {\n        //         setTimeout(() => {\n        //             resolve('resolved');\n        //             loanHandler.decimalGet().then(res => {\n        //                 this.decimals = res.data.data\n        //             })\n        //         }, 300);\n        //     })\n        //     new Promise((resolve) => {\n        //         setTimeout(() => {\n        //             resolve(\"resolved\");\n        //             saleFormContentHandler.list().then((res) => {\n        //                 if (res.data.statusCode === 200) {\n        //                     const data = res.data.data;\n        //                     if (data.length > 0) {\n        //                         this.saleFormContent = data[0];\n        //                         this.numberFormat = 'n' + this.saleFormContent.decimal\n        //                         this.loan.decimal = data[0].decimal\n        //                     }\n        //                 }\n        //             });\n        //         }, 10);\n        //     });\n        // },\n        actionTmpl(dataItem) {\n            window.console.log(dataItem)\n            if(dataItem.numStatus == 2){\n                return i18n.t('paid')\n            }else{\n                return `<v-btn color=\"primary\" class=\"\" v-show=\"d.numStatus == 1\" @click=\"{searchLoanPaid(dataItem)}\" style=\"font-size: 14px;\">` + i18n.t('pay') + `</v-btn>`\n            }\n        },\n        rowNumberTmpl(dataItem) {\n            if(dataItem) {\n                let ds = this.$refs.scheduleAR.kendoWidget(),\n                    index = ds.indexOf(dataItem);\n                if (index === (this.scheduleAR.length - 1)) {\n                    return ''\n                } else {\n                    return index + 1\n                }\n            }\n            return  ''\n        },\n        async makeSchedule(){\n            this.scheduleAR = []\n            this.endingBalance = ''\n            this.totalPaid = ''\n            this.totalPayment = ''\n            window.console.log('a')\n            if(this.listOfLoan.status == \"active\" || this.listOfLoan.status == \"close\") {\n                this.loan = this.listOfLoan\n                window.console.log(this.listOfLoan, 'b')\n                await this.loadSchedule(this.listOfLoan.id)\n            }\n        },\n        dataBound: function (e) {\n            const items = e.sender.items()\n            if(items.length > 0){\n                const grid = kendo.jQuery(\"#loanSchedule\").data(\"kendoGrid\")\n                if(grid){\n                    items.each(function () {\n                        let dataItem = grid.dataItem(this);\n                        window.console.log(dataItem.numStatus)\n                        // kendo.jQuery(\"tr[data-uid='\" + dataItem.uid + \"']\").find(\".isStatus\").each(function () {\n                            if (dataItem.numStatus == 2) {\n                                window.console.log(kendo.jQuery(this), 'wow')\n                                kendo.jQuery(this).find('td').eq(5).text(i18n.t('paid'));\n                                // kendo.jQuery(this).removeClass('k-state-disabled')\n                            }else if(dataItem.numStatus == 3){\n                                kendo.jQuery(this).find('td').eq(5).text('');\n                            }\n                        // )\n                        // })\n                    })\n                }\n            }\n        },\n        async searchLoanPaid(e){\n            e.preventDefault();\n            let grid = kendo.jQuery(\"#loanSchedule\").data(\"kendoGrid\");\n            let dataItem = grid.dataItem($(e.currentTarget).closest(\"tr\"));\n            // window.console.log(dataItem)\n            await this.loadPrefix()\n            this.loadTransactionRate()\n            let data = []\n            data.push(dataItem)\n            this.calReceipt(data)\n        },\n        async loadTransactionRate() {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved')\n                    const date = new Date(this.r.issuedDate).toISOString().substr(0, 10)\n                    let code = this.currencyCode\n                    // window.console.log(this.currencyCode, 'transaction rate')\n                    if (code !== undefined || code !== '') {\n                        this.showLoading = true\n                        currencyHandler.getLastExchangeRateByDate(date, code).then(res => {\n                            if (res.data.statusCode === 200) {\n                                this.showLoading = false\n                                const response = res.data.data[0]\n                                this.exchangeRate = response\n                                this.rate = response.rate\n                                this.showLoading = false\n                                // this.r.userPin = this.pin\n                                // this.r.rate = response.rate\n                                this.r.exchangeRate = response\n                            }\n                        })\n                    }\n                }, 300)\n            })\n        },\n        calReceipt(data) {\n            if (data.length > 0) {\n                let total = 0\n                let interest = 0\n                // let s = []\n                let self = this\n                let penalty = 0\n                let ss = []\n                // window.console.log(data, 'cal receipt')\n                $.each(data, function (i, v) {\n                    interest += parseFloat(v.interest)\n                    let p = self.listOfLoan\n                    let int = 0\n                    let startdate = new Date(v.date)\n                    let enddate = new Date()\n                    let months = enddate.getMonth() - startdate.getMonth() + (12 * (enddate.getFullYear() - startdate.getFullYear()))\n                    if (months >= 3) {\n                        int = (parseFloat(v.interest) * parseFloat(p.product.dueThreeMonth)) / 100\n                    } else if (months < 3 && months >= 2) {\n                        int = (parseFloat(v.interest) * parseFloat(p.product.dueTwoMonth)) / 100\n                    } else if (months == 1) {\n                        int = (parseFloat(v.interest) * parseFloat(p.product.dueOneMonth)) / 100\n                    }\n                    // window.console.log(parseFloat(v.principal), 'principal')\n                    ss.push({\n                        id: v.id,\n                        date: v.date,\n                        principal: kendo.toString(parseFloat(v.principal), v.numberFormat),\n                        interest: kendo.toString(parseFloat(v.interest), v.numberFormat),\n                        total: kendo.toString(parseFloat(v.total), v.numberFormat),\n                        penalty: int\n                    })\n                    total += parseFloat(v.total) + int\n                    penalty += int\n                })\n                if (ss.length > 0) {\n                    this.schedule = ss\n                }\n                if (total > 0) {\n                    this.r.penaltyAmount = penalty\n                    this.r.schedules = this.schedule\n                    window.console.log(this.listOfLoan, 'list loan')\n                    this.r.loan = {\n                        id: this.listOfLoan.id,\n                        name: this.listOfLoan.name\n                    }\n                    this.receiptAmount = kendo.toString(total, this.numberFormat)\n                    this.interestAmount = kendo.toString(interest, this.numberFormat)\n                    this.r.receiptAmount = total\n                    this.r.interestAmount = interest\n                    this.r.principalAmount = total - interest\n                    this.showReceipt = true\n                } else {\n                    this.isPaid = true\n                    this.$snotify.success('Already paid!')\n                    // this.schedules = []\n                    this.showReceipt = true\n                }\n            } else {\n                this.isPaid = true\n                this.$snotify.success('Already paid!')\n                // this.schedules = []\n                this.showReceipt = true\n            }\n        },\n        loadSchedulea(data){\n            window.console.log(data, 'schedule')\n            let self = this\n            // let iamt = 0\n            let tamt = 0\n            let pamt = 0\n            let isCheckFirst = false\n            $.each(data, function (i,v){\n                let status = ''\n                let nStatus = 3\n                if(v.status == 2){\n                    status = i18n.t('paid')\n                    pamt += v.data.total\n                    nStatus = 2\n                }else{\n                    if(isCheckFirst == false) {\n                        nStatus = v.status\n                        isCheckFirst = true\n                    }\n                }\n                self.scheduleAR.push({\n                    id: v.pk,\n                    no: i +1,\n                    date: v.data.date,\n                    interest: v.data.interest,\n                    interestAmount: kendo.toString(v.data.interest, v.data.numberFormat),\n                    locale: v.data.locale,\n                    numberFormat: v.data.numberFormat,\n                    principal: v.data.principal,\n                    principalAmount: kendo.toString(v.data.principal, v.data.numberFormat),\n                    principal_r: kendo.toString(v.data.principal_r, v.data.numberFormat),\n                    totalAmount: kendo.toString(v.data.total, v.data.numberFormat),\n                    total: v.data.total,\n                    status: status,\n                    numStatus: nStatus,\n                    endingBalance: kendo.toString(v.data.principal_r - v.data.principal, v.data.numberFormat)\n                })\n                // iamt += v.interest\n                tamt += v.data.total\n                // self.currencyCode = v.data.locale\n                self.numberFormat = v.data.numberFormat\n            })\n            window.console.log(tamt)\n            this.totalPayment = kendo.toString(tamt, this.numberFormat)\n            this.totalPaid = kendo.toString(pamt, this.numberFormat)\n            this.endingBalance = kendo.toString(tamt - pamt, this.numberFormat)\n            // this.addTotal()\n        },\n        loadSchedule(loanId){\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved')\n                    loanHandler.loanScheduleGet(loanId).then(res => {\n                        this.showLoading = true\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false\n                            let data = res.data.data\n                            let self = this\n                            let s = []\n                            this.scheduleAR = []\n                            if(data.length > 0){\n                                let iamt = 0\n                                let tamt = 0\n                                let pamt = 0\n                                let isCheckFirst = false\n                                $.each(data, function (i,v){\n                                    let status = ''\n                                    let nStatus = 3\n                                    if(v.status == 2){\n                                        status = i18n.t('paid')\n                                        pamt += v.data.total\n                                        nStatus = 2\n                                    }else{\n                                        if(isCheckFirst == false) {\n                                            nStatus = v.status\n                                            isCheckFirst = true\n                                        }\n                                    }\n                                    s.push({\n                                        id: v.id,\n                                        no: i +1,\n                                        date: v.data.date,\n                                        interest: v.data.interest,\n                                        interestAmount: kendo.toString(v.data.interest, v.data.numberFormat),\n                                        locale: v.data.locale,\n                                        numberFormat: v.data.numberFormat,\n                                        principal: v.data.principal,\n                                        principalAmount: kendo.toString(v.data.principal, v.data.numberFormat),\n                                        principal_r: kendo.toString(v.data.principal_r, v.data.numberFormat),\n                                        totalAmount: kendo.toString(v.data.total, v.data.numberFormat),\n                                        total: v.data.total,\n                                        status: status,\n                                        numStatus: nStatus,\n                                        endingBalance: kendo.toString(v.data.principal_r - v.data.principal, v.data.numberFormat)\n                                    })\n                                    iamt += v.data.interest\n                                    tamt += v.data.total\n                                    // self.currencyCode = v.data.locale\n                                    self.numberFormat = v.data.numberFormat\n                                })\n                                window.console.log(tamt)\n                                this.totalInterest = kendo.toString(iamt, this.numberFormat)\n                                this.totalPayment = kendo.toString(tamt, this.numberFormat)\n                                this.totalPaid = kendo.toString(pamt, this.numberFormat)\n                                this.endingBalance = kendo.toString(tamt - pamt, this.numberFormat)\n                                // this.addTotal()\n                                if(s.length > 0) {\n                                    this.scheduleAR = s\n                                }\n                            }\n                        }\n                    }).catch()\n                    {\n                        this.showLoading = false\n                    }\n                }, 300)\n            })\n        },\n        addTotal() {\n            window.console.log(this.listOfLoan)\n            this.scheduleAR.push({\n                id: '',\n                no: this.scheduleAR.length + 1,\n                principal_r: '',\n                principalAmount: kendo.toString(parseFloat(this.listOfLoan.approvedAmount), this.numberFormat),\n                interestAmount: kendo.toString(this.totalInterest, this.numberFormat),\n                totalAmount: kendo.toString(this.totalPayment, this.numberFormat),\n                date: 'Total',\n                locale: this.currencyCode,\n                numberFormat: this.numberFormat,\n                transaction_number: '',\n                status: '',\n                endingBalance: ''\n            })\n            // let ds = this.$refs.scheduleAR.kendoWidget()\n            // ds.setDataSource(this.scheduleAR)\n            // $.each(this.scheduleAR, function (i,v){\n            //     ds.add({\n            //         principal_r: v.principal_r,\n            //         principal: v.principal,\n            //         interest: v.interest,\n            //         total: v.total,\n            //         date: v.date,\n            //         locale: v.locale,\n            //         numberFormat: v.numberFormat,\n            //         transaction_number: v.transaction_number,\n            //         status: v.status\n            //     })\n            // })\n            // window.console.log(this.scheduleAR, 's')\n        },\n        async loadAccount() {\n            window.console.log(this.listOfLoan, 'list')\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved');\n                    accountHandler.getAll().then(res => {\n                        window.console.log(res, 'account')\n                        this.cashAccounts = res.data.filter(m => m.account_type.number === 1).map(itm => {\n                            return {\n                                id: itm.uuid,\n                                uuid: itm.uuid,\n                                name: itm.name,\n                                local_name: itm.local_name,\n                                number: itm.number,\n                                is_taxable: itm.is_taxable,\n                                banhjiAccCode: itm.banhjiAccCode,\n                                group_code: itm.group_code,\n                                parent_account: itm.parent_account,\n                                type_code: itm.type_code\n                            }\n                        })\n                        this.penaltyAccounts = res.data.filter(m => m.account_type.number === 38).map(itm => {\n                            return {\n                                id: itm.uuid,\n                                uuid: itm.uuid,\n                                name: itm.name,\n                                local_name: itm.local_name,\n                                number: itm.number,\n                                is_taxable: itm.is_taxable,\n                                banhjiAccCode: itm.banhjiAccCode,\n                                group_code: itm.group_code,\n                                parent_account: itm.parent_account,\n                                type_code: itm.type_code\n                            }\n                        })\n                        if (this.cashAccounts.length > 0) {\n                            this.r.cashAccount = this.cashAccounts[0]\n                        }\n                        if(this.penaltyAccounts.length > 0){\n                            this.r.penaltyAccount = this.penaltyAccounts[0]\n                        }\n                    })\n                }, 300);\n            })\n        },\n        // jounal\n        async getJournalNumber() {\n            let num = await Helper.generateAccountingNumber(this.journalTxnType, this.r.issuedDate)\n            this.journalNumber = num.number\n            this.journalPrefix = num.prefix_format\n            this.r.number = num.number\n            this.r.journalNumber = num.number\n        },\n        async loadSinglePenalty() {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved')\n                    loanHandler.penaltyGet().then(res => {\n                        this.showLoading = true\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false\n                            if (res.data.data.length > 0) {\n                                this.penaltyAccount = res.data.data[0]\n                            }\n                        }\n                    }).catch()\n                    {\n                        this.showLoading = false\n                    }\n                }, 300)\n            })\n        },\n        async addJournal() {\n            let int = 0\n            $.each(this.schedules, function (i, v) {\n                int += parseFloat(v.int)\n            })\n            this.r.penaltyAmount = int\n            const obj = this.r\n            // const seg = this.segment\n            if (!this.$refs.form.validate()) {\n                this.$refs.form.validate()\n                return\n            }\n            if (this.r.receiptAmount <= 0) {\n                this.$snotify.error('Amount must be over 0')\n                return\n            }\n            this.showLoading = true\n            // API Journal\n            let self = this;\n            let jj = []\n            jj.push({\n                \"uuid\": \"\",\n                \"account\": obj.cashAccount,\n                \"description\": this.journal.description,\n                \"third_contacts\": [],\n                \"ref_number\": '',\n                \"amount\": parseFloat(obj.receiptAmount) * -1,\n                \"discount\": {},\n                \"mark_up\": 0,\n                \"billable\": 0,\n                \"tax_code\": \"\",\n                \"payment_method\": {},\n                \"currency\": this.exchangeRate,\n                \"exchange_rate_uuid\": \"\",\n                \"exchange_rate\": this.rate,\n                \"exchanged_amount\": (parseFloat(obj.receiptAmount) * -1) * parseFloat(this.rate),\n                \"tax_amount\": 0,\n                \"exchanged_tax_amount\": 0,\n                \"is_reconciled\": 0,\n                \"is_settled\": 0,\n                \"class_1_uuid\": \"\",\n                \"class_2_uuid\": \"\",\n                \"class_3_uuid\": \"\",\n                \"class_4_uuid\": \"\",\n                \"class_5_uuid\": \"\",\n                \"payment_method_as\": \"\",\n                \"created_by\": null,\n                \"modified_by\": null,\n                \"created_date\": null,\n                \"modified_date\": null\n            })\n            if (obj.principalAmount > 0) {\n                jj.push({\n                    \"uuid\": \"\",\n                    \"account\": this.listOfLoan.loanAccount,\n                    \"description\": '',\n                    \"third_contacts\": [],\n                    \"ref_number\": '',\n                    \"amount\": parseFloat(obj.principalAmount),\n                    \"discount\": {},\n                    \"mark_up\": 0,\n                    \"billable\": 0,\n                    \"tax_code\": \"\",\n                    \"payment_method\": {},\n                    \"currency\": this.exchangeRate,\n                    \"exchange_rate_uuid\": \"\",\n                    \"exchange_rate\": this.rate,\n                    \"exchanged_amount\": parseFloat(obj.principalAmount) * parseFloat(this.rate),\n                    \"tax_amount\": 0,\n                    \"exchanged_tax_amount\": 0,\n                    \"is_reconciled\": 0,\n                    \"is_settled\": 0,\n                    \"class_1_uuid\": \"\",\n                    \"class_2_uuid\": \"\",\n                    \"class_3_uuid\": \"\",\n                    \"class_4_uuid\": \"\",\n                    \"class_5_uuid\": \"\",\n                    \"payment_method_as\": \"\",\n                    \"created_by\": null,\n                    \"modified_by\": null,\n                    \"created_date\": null,\n                    \"modified_date\": null\n                })\n            }\n            if (obj.interestAmount > 0) {\n                jj.push({\n                    \"uuid\": \"\",\n                    \"account\": this.listOfLoan.interestAccount,\n                    \"description\": '',\n                    \"third_contacts\": [],\n                    \"ref_number\": '',\n                    \"amount\": parseFloat(obj.interestAmount),\n                    \"discount\": {},\n                    \"mark_up\": 0,\n                    \"billable\": 0,\n                    \"tax_code\": \"\",\n                    \"payment_method\": {},\n                    \"currency\": this.exchangeRate,\n                    \"exchange_rate_uuid\": \"\",\n                    \"exchange_rate\": this.rate,\n                    \"exchanged_amount\": parseFloat(obj.interestAmount) * parseFloat(this.rate),\n                    \"tax_amount\": 0,\n                    \"exchanged_tax_amount\": 0,\n                    \"is_reconciled\": 0,\n                    \"is_settled\": 0,\n                    \"class_1_uuid\": \"\",\n                    \"class_2_uuid\": \"\",\n                    \"class_3_uuid\": \"\",\n                    \"class_4_uuid\": \"\",\n                    \"class_5_uuid\": \"\",\n                    \"payment_method_as\": \"\",\n                    \"created_by\": null,\n                    \"modified_by\": null,\n                    \"created_date\": null,\n                    \"modified_date\": null\n                })\n            }\n            if (obj.penaltyAmount > 0) {\n                if (Object.keys(this.r.penaltyAccount).length == 0) {\n                    this.$snotify.error('Please select penalty account')\n                    return\n                }\n                jj.push({\n                    \"uuid\": \"\",\n                    \"account\": this.penaltyAccount,\n                    \"description\": '',\n                    \"third_contacts\": [],\n                    \"ref_number\": '',\n                    \"amount\": parseFloat(obj.penaltyAmount),\n                    \"discount\": {},\n                    \"mark_up\": 0,\n                    \"billable\": 0,\n                    \"tax_code\": \"\",\n                    \"payment_method\": {},\n                    \"currency\": this.exchangeRate,\n                    \"exchange_rate_uuid\": \"\",\n                    \"exchange_rate\": this.rate,\n                    \"exchanged_amount\": parseFloat(obj.penaltyAmount) * parseFloat(this.rate),\n                    \"tax_amount\": 0,\n                    \"exchanged_tax_amount\": 0,\n                    \"is_reconciled\": 0,\n                    \"is_settled\": 0,\n                    \"class_1_uuid\": \"\",\n                    \"class_2_uuid\": \"\",\n                    \"class_3_uuid\": \"\",\n                    \"class_4_uuid\": \"\",\n                    \"class_5_uuid\": \"\",\n                    \"payment_method_as\": \"\",\n                    \"created_by\": null,\n                    \"modified_by\": null,\n                    \"created_date\": null,\n                    \"modified_date\": null\n                })\n            }\n            // let data = {\n            //     \"number\": this.journalNumber,\n            //     \"description\": \"Loan Receipt\",\n            //     \"journal_type\": \"general_journal\",\n            //     \"journal_date\": new Date(obj.issuedDate),\n            //     \"currency_code\": this.currencyCode,\n            //     \"buinsess_unit_uuid\": \"\",\n            //     \"location_uuid\": \"\",\n            //     \"project_uuid\": \"\",\n            //     \"segment_uuid\": \"\",\n            //     \"journal_entries\": jj,\n            //     \"transaction_type\": \"journal\",\n            //     \"is_draft\": 0,\n            //     \"is_reversed\": 0,\n            //     \"prefix_format\": this.journalPrefix,\n            //     \"created_by\": this.loggedUser\n            // }\n            this.journal.prefix_format = this.journalPrefix\n            this.journal.journal_entries = jj\n            this.journal.currency_code = this.currencyCode\n            this.journal.journal_date = Helper.toISODate(this.r.issuedDate)\n            this.journal.created_by = this.loggedUser\n            if(this.listOfLoan.hasOwnProperty('segment')){\n                this.journal.segment_uuid = this.listOfLoan.segment.id\n            }\n            if(this.listOfLoan.hasOwnProperty('location')){\n                this.journal.location_uuid = this.listOfLoan.location.id\n            }\n            journalHandler.save(new JournalModel(this.journal))\n                .then(function (response) {\n                    // window.console.log(response, 'res')\n                    self.r.user = self.loggedUser\n                    self.r.loan = self.listOfLoan\n                    self.r.journal = JSON.stringify(self.journal)\n                    self.r.journalId = response.data.uuid\n                    window.console.log(self.r, 'receipt obj')\n                    self.saveReceipt()\n                })\n                .catch(function (error) {\n                    Helper.alertErrorMsg(error)\n                    window.console.log(error)\n                })\n                .finally(() => {\n                    self.showLoading = false;\n                });\n        },\n        async loadSegment() {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved')\n                    this.segment = {}\n                    loanHandler.businessSettingGet().then(res => {\n                        this.showLoading = true\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false\n                            let s = res.data.data.filter((obj) => {\n                                return obj.type == \"Credit\"\n                            })\n                            if (s.length > 0) {\n                                this.segment = s[0].segment\n                            } else {\n                                this.$snotify.error('Please select segment on setting page')\n                                this.cancel()\n                            }\n                        }\n                    }).catch()\n                    {\n                        this.showLoading = false\n                    }\n                }, 300)\n            })\n        },\n        saveReceipt() {\n            loanHandler.loanPaymentCreate(new LoanReceiptModel(this.r)).then(response => {\n                this.showLoading = false\n                if (response.data.statusCode === 201) {\n                    this.$snotify.success('Successfully')\n                    this.showReceipt = false\n                    this.makeSchedule()\n                }\n            }).catch(e => {\n                this.showLoading = false\n                this.$snotify.error('Something went wrong')\n                this.errors.push(e)\n                window.console.log(e, 'error')\n            })\n        },\n        async loadSaleFormContent() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    saleFormContentHandler.list().then((res) => {\n                        if (res.data.statusCode === 200) {\n                            const data = res.data.data;\n                            if (data.length > 0) {\n                                this.saleFormContent = data[0];\n                                // window.console.log(data[0])\n                            }\n                        }\n                    });\n                }, 10);\n            });\n        },\n        numberFormata(value) {\n            // window.console.log(this.saleFormContent.decimal,'nimol')\n            return kendo.toString(value, `n${this.saleFormContent.decimal}`);\n            // return value\n        },\n        generateNumber() {\n            let data = {\n                abbr: this.transactionType.abbr,\n                structure: this.transactionType.structure,\n                transactionDate: this.r.issuedDate,\n                type: \"Record Loan Periodic Payment\",\n            };\n            billingHandler\n                .lastNumber(data)\n                .then((response) => {\n                    if (response.data.statusCode === 200) {\n                        const res = response.data.data;\n                        this.suffix = res.suffix;\n                        this.getLastNum();\n                    }\n                })\n                .catch((e) => {\n                    this.errors.push(e);\n                });\n        },\n        getLastNum(){\n            let d = {\n                type: \"RecordPayment\",\n            };\n            loanHandler\n                .getLastNumber(d)\n                .then((response) => {\n                    if (response.data.statusCode === 200) {\n                        this.showLoading = false\n                        const res = response.data.data;\n                        const lastNumber = this.zeroPad(\n                            parseInt(res.lastNumber),\n                            this.transactionType.format\n                        );\n                        this.r.lastNumber = parseInt(res.lastNumber)\n                        const number =\n                            this.suffix +\n                            this.transactionType.numberSeparator +\n                            lastNumber;\n                        let des = ''\n                        if(Object.keys(this.loan).length > 0){\n                            des = `Pay Loan from ${this.loan.financialInstitutions.name} For Loan Number ${this.loan.approveNumber}`;\n                        }\n\n                        this.journal = new JournalModel({\n                            description: des,\n                            transaction_type: LoanType.REPAYMENT,\n                            journal_type: LoanType.REPAYMENT,\n                        });\n                        this.journal.abbr = this.transactionType.abbr\n                        // this.loan.activeDate = new Date().toISOString().substr(0, 10);\n\n                        // Add 2 default rows\n                        // this.addRowT(this.$refs.cashBankAccountDS.kendoWidget());\n                        // for (let index = 0; index < 2; index++) {\n                        //     this.addRow(this.$refs.relatedCostDS.kendoWidget());\n                        // }\n                        this.journal.number = this.transactionType.abbr + this.transactionType.numberSeparator + number\n                        this.r.abbr = this.transactionType.abbr\n                        this.r.number = this.transactionType.abbr + this.transactionType.numberSeparator + number;\n                    }\n                })\n                .catch((e) => {\n                    window.console.log(e);\n                });\n        },\n        async loadPrefix() {\n            this.showLoading = true\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    prefixHandler.get(\"record loan periodic payment\").then((res) => {\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false;\n                            this.transactionType = res.data.data[0];\n                            this.generateNumber();\n                        }\n                    });\n                }, 10);\n            });\n        },\n    },\n    mounted: async function () {\n        // await this.loadCurrencyData()\n        // await this.loadDecimal()\n        // await this.loadSegment()\n        await this.getJournalNumber()\n        await this.loadSaleFormContent()\n        // await this.loadSinglePenalty()\n    },\n    created: async function () {\n        await this.loadAccount()\n    },\n}\n</script>\n<style scoped>\n.attachment_table table tr th {\n    vertical-align: baseline !important;\n}\n\n.theme--light.v-data-table > .v-data-table__wrapper > table > tbody > tr.third:hover:not(.v-data-table__expanded__content):not(.v-data-table__empty-wrapper) {\n    background-color: #92d050 !important;\n}\n\n\n\n.theme--light.v-data-table > .v-data-table__wrapper > table > tbody > tr:not(:last-child) > td:not(.v-data-table__mobile-row),\n.theme--light.v-data-table > .v-data-table__wrapper > table > tbody > tr:not(:last-child) > th:not(.v-data-table__mobile-row) {\n    border-bottom: thin solid #ddd;\n}\n\n.v-data-table > .v-data-table__wrapper > table > tbody > tr > td {\n    height: 32px !important;\n}\n\n.v-application .third,\n.v-application .secondary {\n    border-color: #fff !important;\n}\n</style>"]}]}