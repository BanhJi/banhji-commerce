{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/insurance/InsurancePurchase.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/insurance/InsurancePurchase.vue","mtime":1638499443244},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGkxOG4gfSBmcm9tICJAL2kxOG4iOwppbXBvcnQga2VuZG8gZnJvbSAiQHByb2dyZXNzL2tlbmRvLXVpIjsKaW1wb3J0IEhlbHBlciBmcm9tICJAL2hlbHBlci5qcyI7Cgpjb25zdCBwdXJjaGFzZUZvcm1Db250ZW50SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wdXJjaGFzZUZvcm1Db250ZW50SGFuZGxlciIpOwpjb25zdCBiaWxsaW5nSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9pbnZvaWNlL2hhbmRsZXIvYmlsbGluZ0hhbmRsZXIiKTsKaW1wb3J0IHsKICBFeHBlbnNlTW9kZWwsCiAgRXhwZW5zZUVudHJ5TW9kZWwsCiAgRXhwZW5zZUVudHJ5RXh0ZW5kZWRNb2RlbCwKICBKb3VybmFsTW9kZWwsCiAgSm91cm5hbEVudHJ5TW9kZWwsCiAgQWNjb3VudE1vZGVsLAogIEN1cnJlbmN5TW9kZWwsCiAgRXhjaGFuZ2VSYXRlTW9kZWwsCiAgUGF5bWVudFRlcm1Nb2RlbCwKICBTdXBwbGllck1vZGVsLAogIEVtcGxveWVlTW9kZWwsCiAgQ29udGFjdE1vZGVsLAogIENsYXNzTW9kZWwsCiAgVW9tTW9kZWwsCiAgTG9jYXRpb25Nb2RlbCwKICBTZWdtZW50TW9kZWwsCiAgUHJvamVjdE1vZGVsLAogIERpc2NvdW50SXRlbU1vZGVsLAogIFRheE1vZGVsLAogIEV4cGVuc2VzLAogIFB1cmNoYXNlRm9ybUNvbnRlbnQsCn0gZnJvbSAiQC9zY3JpcHRzL21vZGVsL0FwcE1vZGVscyI7CmltcG9ydCB7IFNob3dSZXNvdXJjZSB9IGZyb20gIkAvb2JzZXJ2YWJsZS9zdG9yZSI7Cgpjb25zdCAkID0gcmVxdWlyZSgianF1ZXJ5Iik7CgovKiBTdG9yZSAqLwppbXBvcnQgc3RvcmUgZnJvbSAiQC9zdG9yZSIKY29uc3QgaW5zdGl0dXRlID0gc3RvcmUuc3RhdGUuaW5zdGl0dXRlLmluc3RpdHV0ZQoKY29uc3QgewogIGV4cGVuc2VIYW5kbGVyLAogIGNhc2hBZHZhbmNlSGFuZGxlciwKICBhY2NvdW50SGFuZGxlciwKICBqb3VybmFsSGFuZGxlciwKICBkaXNjb3VudEl0ZW1IYW5kbGVyLAogIHRheEhhbmRsZXIsCiAgdW9tSGFuZGxlciwKICBjbGFzc0hhbmRsZXIsCn0gPSByZXF1aXJlKCJAL3NjcmlwdHMvQXBwSGFuZGxlcnMiKTsKY29uc3QgewogIEFjY291bnRFZGl0b3IsCiAgQ2xhc3NFZGl0b3IsCiAgVW9tRWRpdG9yLAogIC8vIEJpbGxhYmxlRWRpdG9yLAogIFB1cmNoYXNlRGlzY291bnRJdGVtRWRpdG9yLAogIFBheW1lbnRNZXRob2RFZGl0b3IsCiAgUHVyY2hhc2VUYXhFZGl0b3IsCiAgLy8gTWFya3VwRWRpdG9yLAp9ID0gcmVxdWlyZSgiQC9zY3JpcHRzL2tlbmRvX2VkaXRvci9Db2xsZWN0aW9ucyIpOwpjb25zdCB7CiAgRW50aXR5VHlwZSwKICBTYXZlT3B0aW9uLAogIEFjY291bnRUeXBlQ29kZSwKfSA9IHJlcXVpcmUoIkAvc2NyaXB0cy9kZWZhdWx0X3NldHVwL0NvbGxlY3Rpb25zIik7CmNvbnN0IFBBWU1FTlRfVEVSTV9UWVBFID0gInBtdC1zdXBwbGllciI7CmNvbnN0IERJU0NPVU5UX0lURU1fVFlQRSA9ICI/dHlwZT1QdXJjaGFzZSI7Ci8vIGNvbnN0IFBBWU1FTlRfTUVUSE9EX0FTID0gJz9vcHRpb25UeXBlPVN1cHBsaWVyJwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkV4cGVuc2UiLAogIGNvbXBvbmVudHM6IHsKICAgIExvYWRpbmdNZTogKCkgPT4gaW1wb3J0KCJAL2NvbXBvbmVudHMvTG9hZGluZyIpLAogICAgImFwcC1kYXRlcGlja2VyIjogKCkgPT4KICAgICAgaW1wb3J0KCJAL2NvbXBvbmVudHMvY3VzdG9tX3RlbXBsYXRlcy9EYXRlUGlja2VyQ29tcG9uZW50IiksCiAgICAiYXBwLW1vbnRob2YtcGlja2VyIjogKCkgPT4KICAgICAgaW1wb3J0KCJAL2NvbXBvbmVudHMva2VuZG9fdGVtcGxhdGVzL01vbnRoT2ZQaWNrZXIiKSwKICAgICJhcHAtc2VnbWVudC1kcm9wZG93bmxpc3QiOiAoKSA9PgogICAgICBpbXBvcnQoIkAvY29tcG9uZW50cy9kcm9wZG93bmxpc3QvU2VnbWVudCIpLAogIH0sCiAgcHJvcHM6IHsKICAgIGluaXRFeHBlbnNlOiB7CiAgICAgIHR5cGU6IEV4cGVuc2VNb2RlbCwKICAgIH0sCiAgfSwKICBkYXRhOiAoKSA9PiAoewogICAgLy8gT2JqCiAgICBleHBlbnNlOiBuZXcgRXhwZW5zZU1vZGVsKCksCiAgICBqb3VybmFsOiBuZXcgSm91cm5hbE1vZGVsKCksCiAgICBqb3VybmFsRW50cmllczogW10sCiAgICBlbXBsb3llZTogbmV3IEVtcGxveWVlTW9kZWwoKSwKICAgIHN1cHBsaWVyOiBuZXcgU3VwcGxpZXJNb2RlbCgpLAogICAgcGF5bWVudFRlcm06IG5ldyBQYXltZW50VGVybU1vZGVsKCksCiAgICBjdXJyZW5jeTogbmV3IEN1cnJlbmN5TW9kZWwoaW5zdGl0dXRlLmJhc2VDdXJyZW5jeSksCiAgICBleGNoYW5nZVJhdGU6IG5ldyBFeGNoYW5nZVJhdGVNb2RlbChpbnN0aXR1dGUuYmFzZUN1cnJlbmN5KSwKICAgIHRyYW5zYWN0aW9uQWNjb3VudDogbmV3IEFjY291bnRNb2RlbCgpLAogICAgYWR2YW5jZVNldHRsZW1lbnRDbGVhcmluZ0FjY291bnQ6IG5ldyBBY2NvdW50TW9kZWwoKSwKICAgIG90aGVyQ2xlYXJpbmdTdXNwZW5zZUFjY291bnQ6IG5ldyBBY2NvdW50TW9kZWwoKSwKICAgIGxvY2F0aW9uOiBuZXcgTG9jYXRpb25Nb2RlbCgpLAogICAgc2VnbWVudDogbmV3IFNlZ21lbnRNb2RlbCgpLAogICAgcHJvamVjdDogbmV3IFByb2plY3RNb2RlbCgpLAogICAgLy8gTGlzdAogICAgY2FzaEFkdmFuY2VzOiBbXSwKICAgIGFjY291bnRzOiBbXSwKICAgIGV4cGVuc2VBY2NvdW50czogW10sCiAgICB0cmFuc2FjdGlvbkFjY291bnRzOiBbXSwKICAgIGV4cGVuc2VFbnRyaWVzOiBbXSwKICAgIC8vIEVudHJ5IFV1aWQKICAgIGRlcG9zaXRFbnRyeVV1aWQ6IGtlbmRvLmd1aWQoKSwKICAgIHRyYW5zYWN0aW9uRW50cnlVdWlkOiBrZW5kby5ndWlkKCksCiAgICAvLyBPdGhlcgogICAgc3ViVG90YWw6IDAsCiAgICBkaXNjb3VudEFtb3VudDogMCwKICAgIHB1cmNoYXNlVGF4OiAwLAogICAgd2hkVGF4OiAwLAogICAgdG90YWxBbW91bnQ6IDAsCiAgICBzdXBwbGllckRlcG9zaXRBbW91bnQ6IDAsCiAgICBkZXBvc2l0QW1vdW50OiAwLAogICAgYW1vdW50RHVlOiAwLAogICAgaGFzQWRkaXRpb25hbENvc3Q6IGZhbHNlLAogICAgZmlsZXM6IFtdLAogICAgdXNlcjogSGVscGVyLmdldFVzZXIoKSwKICAgIHRlbXBsYXRlczogW10sCiAgICBwYXltZW50VGVybVR5cGU6IFBBWU1FTlRfVEVSTV9UWVBFLAogICAgLy8gRm9ybSB2YWxpZGF0aW9uCiAgICB2YWxpZDogdHJ1ZSwKICAgIGlzRWRpdDogZmFsc2UsCiAgICBhbGVydDogZmFsc2UsCiAgICBlcnJvck1lc3NhZ2U6ICIiLAogICAgc2F2ZU1vZGU6ICIiLAogICAgU2F2ZU9wdGlvbjogU2F2ZU9wdGlvbiwKICAgIC8vIEVkaXRvcnMKICAgIEFjY291bnRFZGl0b3I6IEFjY291bnRFZGl0b3IsCiAgICBDbGFzc0VkaXRvcjogQ2xhc3NFZGl0b3IsCiAgICBVb21FZGl0b3I6IFVvbUVkaXRvciwKICAgIC8vIEJpbGxhYmxlRWRpdG9yOiBCaWxsYWJsZUVkaXRvciwKICAgIFB1cmNoYXNlRGlzY291bnRJdGVtRWRpdG9yOiBQdXJjaGFzZURpc2NvdW50SXRlbUVkaXRvciwKICAgIFBheW1lbnRNZXRob2RFZGl0b3I6IFBheW1lbnRNZXRob2RFZGl0b3IsCiAgICBQdXJjaGFzZVRheEVkaXRvcjogUHVyY2hhc2VUYXhFZGl0b3IsCiAgICAvLyBNYXJrdXBFZGl0b3I6IE1hcmt1cEVkaXRvciwKICAgIC8vIFNpZGViYXIKICAgIGNvbF9leHBhbmQ6IDksCiAgICBjb2xfaGlkZTogMywKICAgIGlzSGlkZUJhcjogZmFsc2UsCiAgICAvLyBMb2FkaW5nTWUKICAgIHNob3dMb2FkaW5nOiBmYWxzZSwKICAgIGxvYWRpbmdBbGVydDogZmFsc2UsCiAgICBsb2FkaW5nQ29sb3JBbGVydDogIiIsCiAgICBsb2FkaW5nVGV4dEFsZXJ0OiAiIiwKICAgIC8vIEJ5IEIgTmltb2wKICAgIGRlY2ltYWxGb3JtYXQ6ICJuMiIsCiAgICBwdXJjaGFzZUZvcm1Db250ZW50OiBQdXJjaGFzZUZvcm1Db250ZW50LAogICAgZGVwb3NpdEJhbGFuY2U6IDAsCiAgICB0eG5FeHBlbnNlOiBuZXcgRXhwZW5zZXMoKSwKICAgIHRyYW5zYWN0aW9uVHlwZToge30sCiAgICBzdXBwbGllckRpc2NvdW50SXRlbTogW10sCiAgfSksCiAgbWV0aG9kczogewogICAgcmVtb3ZlRW1wdHlWYWx1ZXMob2JqKSB7CiAgICAgIGZvciAobGV0IHByb3BOYW1lIGluIG9iaikgewogICAgICAgIGlmICghb2JqW3Byb3BOYW1lXSB8fCBvYmpbcHJvcE5hbWVdLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgZGVsZXRlIG9ialtwcm9wTmFtZV07CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygb2JqW3Byb3BOYW1lXSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgIHRoaXMucmVtb3ZlRW1wdHlWYWx1ZXMob2JqW3Byb3BOYW1lXSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBvYmo7CiAgICB9LAogICAgb25Mb2NhdGlvbkNoYW5nZSgpIHsKICAgICAgd2luZG93LmNvbnNvbGUubG9nKAogICAgICAgICJsb2NhdGlvbiIsCiAgICAgICAgdGhpcy5yZW1vdmVFbXB0eVZhbHVlcyh0aGlzLnNlZ21lbnQpLAogICAgICAgIHRoaXMucmVtb3ZlRW1wdHlWYWx1ZXModGhpcy5sb2NhdGlvbikKICAgICAgKTsKICAgIH0sCiAgICBtYXBwaW5nRXhwZW5zZShleHBlbnNlKSB7CiAgICAgIGNvbnN0IGRzID0gdGhpcy4kcmVmcy5leHBlbnNlQWNjb3VudERTLmtlbmRvV2lkZ2V0KCk7CiAgICAgIGNvbnN0IGFjY291bnRMaW5lID0gZHMuZGF0YSgpLmZpbHRlcigobikgPT4gbi5hbW91bnQgPiAwKTsKICAgICAgdGhpcy50eG5FeHBlbnNlLmlkID0gZXhwZW5zZS51dWlkOwogICAgICB0aGlzLnR4bkV4cGVuc2Uuam91cm5hbF91dWlkID0gZXhwZW5zZS5qb3VybmFsX3V1aWQ7CiAgICAgIHRoaXMudHhuRXhwZW5zZS50eXBlID0gIkV4cGVuc2UiOwogICAgICB0aGlzLnR4bkV4cGVuc2UuYWJiciA9IHRoaXMuYWJicih0aGlzLnRyYW5zYWN0aW9uVHlwZSk7CiAgICAgIHRoaXMudHhuRXhwZW5zZS50cmFuc2FjdGlvblR5cGUgPSB0aGlzLnRyYW5zYWN0aW9uVHlwZTsKICAgICAgdGhpcy50eG5FeHBlbnNlLnJlZmVyZW5jZU5vID0gZXhwZW5zZS5udW1iZXI7CiAgICAgIC8vIHRoaXMudHhuRXhwZW5zZS5yZWZlcmVuY2VObyA9IGV4cGVuc2UubnVtYmVyCiAgICAgIHRoaXMudHhuRXhwZW5zZS50cmFuc2FjdGlvbkRhdGUgPSBleHBlbnNlLmV4cGVuc2VfZGF0ZTsKICAgICAgdGhpcy50eG5FeHBlbnNlLmR1ZURhdGUgPSBleHBlbnNlLmR1ZV9kYXRlOwogICAgICB0aGlzLnR4bkV4cGVuc2UuYmlsbERhdGUgPSBleHBlbnNlLmJpbGxfZGF0ZTsKICAgICAgdGhpcy50eG5FeHBlbnNlLmJpbGxOdW1iZXIgPSBleHBlbnNlLmJpbGxfbnVtYmVyOwogICAgICB0aGlzLnR4bkV4cGVuc2UuY3VycmVuY3kgPSB0aGlzLnJlbW92ZUVtcHR5VmFsdWVzKGV4cGVuc2UuYmlsbF9jdXJyZW5jeSk7CiAgICAgIHRoaXMudHhuRXhwZW5zZS5zdXBwbGllciA9IHRoaXMuc3VwcGxpZXJNYXAoZXhwZW5zZS5zdXBwbGllcik7CiAgICAgIHRoaXMudHhuRXhwZW5zZS5lbXBsb3llZSA9IHRoaXMucmVtb3ZlRW1wdHlWYWx1ZXMoZXhwZW5zZS5lbXBsb3llZSk7CiAgICAgIHRoaXMudHhuRXhwZW5zZS5wYXltZW50VGVybSA9IHRoaXMucmVtb3ZlRW1wdHlWYWx1ZXModGhpcy5wYXltZW50VGVybSk7CiAgICAgIHRoaXMudHhuRXhwZW5zZS5zZWdtZW50ID0gdGhpcy5yZW1vdmVFbXB0eVZhbHVlcyh0aGlzLnNlZ21lbnQpOwogICAgICB0aGlzLnR4bkV4cGVuc2UubG9jYXRpb24gPSB0aGlzLnJlbW92ZUVtcHR5VmFsdWVzKHRoaXMubG9jYXRpb24pOwogICAgICB0aGlzLnR4bkV4cGVuc2UucHJvamVjdCA9IHRoaXMucmVtb3ZlRW1wdHlWYWx1ZXModGhpcy5wcm9qZWN0KTsKICAgICAgdGhpcy50eG5FeHBlbnNlLm1vbnRoT2YgPSBleHBlbnNlLm1vbnRoX29mOwoKICAgICAgdGhpcy50eG5FeHBlbnNlLmFkZGl0aW9uYWxDb3N0U3VwcGxpZXIgPSB0aGlzLnJlbW92ZUVtcHR5VmFsdWVzKAogICAgICAgIGV4cGVuc2UuYWRkaXRpb25hbF9jb3N0X3N1cHBsaWVyCiAgICAgICk7CiAgICAgIHRoaXMudHhuRXhwZW5zZS51c2VfZm9yX3RyYW5zYWN0aW9uX3V1aWQgPQogICAgICAgIGV4cGVuc2UudXNlX2Zvcl90cmFuc2FjdGlvbl91dWlkOwogICAgICB0aGlzLnR4bkV4cGVuc2UudXNlRm9yT3B0aW9uID0gZXhwZW5zZS51c2VfZm9yX29wdGlvbjsKICAgICAgdGhpcy50eG5FeHBlbnNlLnRyYW5zYWN0aW9uTm90ZSA9IGV4cGVuc2Uudm91Y2hlcl9ub3RlOwogICAgICB0aGlzLnR4bkV4cGVuc2Uuam91cm5hbE5vdGUgPSBleHBlbnNlLmpvdXJuYWxfbm90ZTsKICAgICAgdGhpcy50eG5FeHBlbnNlLml0ZW1MaW5lcyA9IGFjY291bnRMaW5lOwogICAgICB0aGlzLnR4bkV4cGVuc2UuYWNjb3VudCA9IHRoaXMucmVtb3ZlRW1wdHlWYWx1ZXMoCiAgICAgICAgdGhpcy5hY2NvdW50KHRoaXMudHJhbnNhY3Rpb25BY2NvdW50KQogICAgICApOwogICAgICB0aGlzLnR4bkV4cGVuc2Uuc2F2ZU9wdGlvbiA9IGV4cGVuc2UuaXNfZHJhZnQ7CiAgICAgIHRoaXMudHhuRXhwZW5zZS5zdGF0dXMgPSAxOwogICAgICB0aGlzLnR4bkV4cGVuc2UuY3JlYXRlZEF0ID0gZXhwZW5zZS5jcmVhdGVkX2RhdGU7CgogICAgICB0aGlzLnR4bkV4cGVuc2UudG90YWwgPSB0aGlzLnRvdGFsQW1vdW50OwogICAgICB0aGlzLnR4bkV4cGVuc2UuYW1vdW50RHVlID0gdGhpcy5hbW91bnREdWU7CiAgICAgIHRoaXMudHhuRXhwZW5zZS5yZW1haW5pbmdBbW91bnQgPSB0aGlzLmFtb3VudER1ZTsKICAgICAgdGhpcy50eG5FeHBlbnNlLnN1YlRvdGFsID0gdGhpcy5zdWJUb3RhbDsKICAgICAgdGhpcy50eG5FeHBlbnNlLnB1cmNoYXNlVGF4ID0gdGhpcy5wdXJjaGFzZVRheDsKICAgICAgdGhpcy50eG5FeHBlbnNlLndoZFRheCA9IHRoaXMud2hkVGF4OwogICAgICB0aGlzLnR4bkV4cGVuc2Uuc3VwcGxpZXJEaXNjb3VudEl0ZW0gPSB0aGlzLnN1cHBsaWVyRGlzY291bnRJdGVtOwogICAgICB0aGlzLnR4bkV4cGVuc2UubG9nZ2VkVXNlciA9IHRoaXMubG9nZ2VkVXNlcih0aGlzLmV4cGVuc2UuY3JlYXRlZF9ieSk7CgogICAgICB0aGlzLnR4bkV4cGVuc2UudHhuUmF0ZSA9IHRoaXMuZXhjaGFuZ2VSYXRlLnJhdGU7CiAgICAgIHRoaXMudHhuRXhwZW5zZS5kaXNjb3VudFRvdGFsID0gdGhpcy5kaXNjb3VudEFtb3VudDsKICAgICAgdGhpcy50eG5FeHBlbnNlLmRlcG9zaXRBbW91bnQgPSB0aGlzLmRlcG9zaXRCYWxhbmNlOwogICAgICB0aGlzLnR4bkV4cGVuc2UuZGVwb3NpdERlZHVjdGlvbiA9IHRoaXMuZGVwb3NpdEFtb3VudDsKICAgICAgdGhpcy50eG5FeHBlbnNlLmV4Y2hhbmdlRGVwb3NpdERlZHVjdGlvbiA9CiAgICAgICAgdGhpcy5kZXBvc2l0QW1vdW50ICogdGhpcy5leGNoYW5nZVJhdGUucmF0ZSB8fCAwOwogICAgICB0aGlzLnR4bkV4cGVuc2UuZXhjaGFuZ2VBbW91bnQgPQogICAgICAgIHRoaXMuYW1vdW50RHVlICogdGhpcy5leGNoYW5nZVJhdGUucmF0ZSB8fCAwOwoKICAgICAgd2luZG93LmNvbnNvbGUubG9nKCJFeHBlbnNlIiwgdGhpcy50eG5FeHBlbnNlKTsKICAgIH0sCiAgICBsb2dnZWRVc2VyKHVzZXIpIHsKICAgICAgaWYgKHVzZXIpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgaWQ6IHVzZXIuaWQsCiAgICAgICAgICBuYW1lOiB1c2VyLnVzZXJfbmFtZSwKICAgICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLAogICAgICAgIH07CiAgICAgIH0KICAgICAgcmV0dXJuIHt9OwogICAgfSwKICAgIHN1cHBsaWVyTWFwKHN1cHBsaWVyKSB7CiAgICAgIGlmIChzdXBwbGllcikgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBpZDogc3VwcGxpZXIudXVpZCwKICAgICAgICAgIG5hbWU6IHN1cHBsaWVyLm5hbWUsCiAgICAgICAgICBlbWFpbDogc3VwcGxpZXIuZW1haWwsCiAgICAgICAgICBwaG9uZTogc3VwcGxpZXIucGhvbmUsCiAgICAgICAgICBhZGRyZXNzOiBzdXBwbGllci5hZGRyZXNzLAogICAgICAgIH07CiAgICAgIH0KICAgICAgcmV0dXJuIHt9OwogICAgfSwKICAgIHNhdmVUeG5FeHBlbnNlKGV4cGVuc2VJZCwgam91cm5hbElkKSB7CiAgICAgIHRoaXMudHhuRXhwZW5zZVsidXVpZCJdID0gZXhwZW5zZUlkOwogICAgICB0aGlzLnR4bkV4cGVuc2VbImlkIl0gPSB0aGlzLnR4bkV4cGVuc2UuaWQgPyB0aGlzLnR4bkV4cGVuc2UuaWQgOiAiIjsKICAgICAgdGhpcy50eG5FeHBlbnNlWyJqb3VybmFsX3V1aWQiXSA9IGpvdXJuYWxJZDsKICAgICAgdGhpcy50eG5FeHBlbnNlWyJhY3Rpb25UeXBlIl0gPSB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQKICAgICAgICA/IHRoaXMuJHJvdXRlLnF1ZXJ5LnR5cGUKICAgICAgICA6ICJuZXciOwogICAgICBsZXQgZGF0YSA9IHRoaXMudHhuRXhwZW5zZTsKICAgICAgYmlsbGluZ0hhbmRsZXIKICAgICAgICAuY3JlYXRlRXhwZW5zZShkYXRhKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAxKSB7CiAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuc3VjY2VzcygiU3VjY2Vzc2Z1bGx5Iik7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoIlNvbWV0aGluZyB3ZW50IHdyb25nIik7CiAgICAgICAgICB0aGlzLmVycm9ycy5wdXNoKGUpOwogICAgICAgIH0pOwogICAgfSwKICAgIHJlbW92ZUR1cGxpY2F0ZShhcnJheSkgewogICAgICBjb25zdCByZXN1bHQgPSBbXTsKICAgICAgY29uc3QgbWFwID0gbmV3IE1hcCgpOwogICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgYXJyYXkpIHsKICAgICAgICBpZiAoIW1hcC5oYXMoaXRlbS5pZCkpIHsKICAgICAgICAgIG1hcC5zZXQoaXRlbS5pZCwgdHJ1ZSk7IC8vIHNldCBhbnkgdmFsdWUgdG8gTWFwCiAgICAgICAgICByZXN1bHQucHVzaChpdGVtKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0sCiAgICBhY2NvdW50KHR4bkFjY291bnQpIHsKICAgICAgaWYgKHR4bkFjY291bnQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgaWQ6IHR4bkFjY291bnQudXVpZCwKICAgICAgICAgIG5hbWU6IHR4bkFjY291bnQubmFtZSwKICAgICAgICAgIGxvY2FsX25hbWU6IHR4bkFjY291bnQubG9jYWxfbmFtZSwKICAgICAgICAgIG51bWJlcjogdHhuQWNjb3VudC5udW1iZXIsCiAgICAgICAgICBpc190YXhhYmxlOiB0eG5BY2NvdW50LmlzX3RheGFibGUsCiAgICAgICAgICBiYW5oamlBY2NDb2RlOiB0eG5BY2NvdW50LmJhbmhqaUFjY0NvZGUsCiAgICAgICAgICBncm91cF9jb2RlOiB0eG5BY2NvdW50Lmdyb3VwX2NvZGUsCiAgICAgICAgICBwYXJlbnRfYWNjb3VudDogdHhuQWNjb3VudC5wYXJlbnRfYWNjb3VudCwKICAgICAgICAgIHR5cGVfY29kZTogdHhuQWNjb3VudC50eXBlX2NvZGUsCiAgICAgICAgICBhY2NvdW50X3R5cGU6IHR4bkFjY291bnQuYWNjb3VudF90eXBlLAogICAgICAgIH07CiAgICAgIH0KICAgICAgcmV0dXJuIHt9OwogICAgfSwKICAgIGFiYnIodHJhbnNhY3Rpb25UeXBlKSB7CiAgICAgIGlmICh0cmFuc2FjdGlvblR5cGUpIHsKICAgICAgICByZXR1cm4gdHJhbnNhY3Rpb25UeXBlLmFiYnI7CiAgICAgIH0KICAgICAgcmV0dXJuICIiOwogICAgfSwKICAgIHN1cHBsaWVyRGVwb3NpdEJhbGFuY2UoKSB7CiAgICAgIHRoaXMuc3VwcGxpZXJEZXBvc2l0QW1vdW50ID0gMDsKICAgICAgaWYgKHRoaXMuZGVwb3NpdEJhbGFuY2UgPiAwKSB7CiAgICAgICAgdGhpcy5zdXBwbGllckRlcG9zaXRBbW91bnQgPQogICAgICAgICAgdGhpcy5kZXBvc2l0QmFsYW5jZSAvIHRoaXMuZXhjaGFuZ2VSYXRlLnJhdGU7CiAgICAgIH0KICAgIH0sCiAgICBhc3luYyBsb2FkRGVwb3NpdEJhbGFuY2UoaWQpIHsKICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICBjb25zdCBzdHJGaWx0ZXIgPSBpZCArICI/dHlwZT1kZXAiOwogICAgICAgICAgdGhpcy5zdXBwbGllckRlcG9zaXRBbW91bnQgPSAwOwogICAgICAgICAgdGhpcy5kZXBvc2l0QW1vdW50ID0gMDsKICAgICAgICAgIGJpbGxpbmdIYW5kbGVyCiAgICAgICAgICAgIC5iYWxhbmNlKHN0ckZpbHRlcikKICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICB0aGlzLmRlcG9zaXRCYWxhbmNlID0gZGF0YVswXS5iYWxhbmNlOwogICAgICAgICAgICAgICAgICB0aGlzLnN1cHBsaWVyRGVwb3NpdEJhbGFuY2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgpOwogICAgICAgICAgewogICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfSwgMzAwKTsKICAgICAgfSk7CiAgICB9LAogICAgYXN5bmMgbG9hZFB1cmNoYXNlRm9ybUNvbnRlbnQoKSB7CiAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgcHVyY2hhc2VGb3JtQ29udGVudEhhbmRsZXIubGlzdCgpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgY29uc3Qgc3VwcGxpZXJTZXR0aW5nID0gZGF0YVswXTsKICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2VGb3JtQ29udGVudCA9IHN1cHBsaWVyU2V0dGluZzsKICAgICAgICAgICAgICAgIGlmIChzdXBwbGllclNldHRpbmcuaGFzT3duUHJvcGVydHkoImRlY2ltYWwiKSkgewogICAgICAgICAgICAgICAgICB0aGlzLmRlY2ltYWxGb3JtYXQgPSAibiIgKyBzdXBwbGllclNldHRpbmcuZGVjaW1hbDsKICAgICAgICAgICAgICAgICAgLy8gQWRkIDIgZGVmYXVsdCBsaW5lcwogICAgICAgICAgICAgICAgICB0aGlzLmFkZFJvdygpOwogICAgICAgICAgICAgICAgICB0aGlzLmFkZFJvdygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSwgMTAwKTsKICAgICAgfSk7CiAgICB9LAogICAgbnVtYmVyRm9ybWF0KHZhbHVlKSB7CiAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyh2YWx1ZSwgYCR7dGhpcy5kZWNpbWFsRm9ybWF0fWApOwogICAgfSwKICAgIG9uRHVlRGF0ZUNoYW5nZWQoKSB7CiAgICAgIHRoaXMuY2FsY3VsYXRlRHVlRGF0ZSh0aGlzLnBheW1lbnRUZXJtKTsKICAgIH0sCiAgICBhc3luYyBvblZlbmRvckNoYW5nZWQoKSB7CiAgICAgIGxldCBwYXltZW50QmlsbGluZyA9IHt9OwogICAgICBpZiAoCiAgICAgICAgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaXMuc3VwcGxpZXIsICJwYXltZW50QmlsbGluZyIpCiAgICAgICkgewogICAgICAgIHBheW1lbnRCaWxsaW5nID0gdGhpcy5zdXBwbGllci5wYXltZW50QmlsbGluZzsKICAgICAgICBpZiAoCiAgICAgICAgICBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocGF5bWVudEJpbGxpbmcsICJwYXltZW50VGVybSIpCiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLnBheW1lbnRUZXJtID0gbmV3IFBheW1lbnRUZXJtTW9kZWwocGF5bWVudEJpbGxpbmcucGF5bWVudFRlcm0pOwogICAgICAgICAgdGhpcy5jYWxjdWxhdGVEdWVEYXRlKHBheW1lbnRCaWxsaW5nLnBheW1lbnRUZXJtKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5sb2FkRGVwb3NpdEJhbGFuY2UodGhpcy5zdXBwbGllci5pZCk7CiAgICB9LAogICAgY2FsY3VsYXRlRHVlRGF0ZShwYXltZW50VGVybSkgewogICAgICBpZiAocGF5bWVudFRlcm0uaGFzT3duUHJvcGVydHkoIm5ldER1ZSIpKSB7CiAgICAgICAgY29uc3QgbmV0RHVlID0gcGF5bWVudFRlcm0ubmV0RHVlOwogICAgICAgIGNvbnN0IGR1ZURhdGUgPSBuZXcgRGF0ZSh0aGlzLmV4cGVuc2UuZXhwZW5zZV9kYXRlKTsKICAgICAgICBkdWVEYXRlLnNldERhdGUoZHVlRGF0ZS5nZXREYXRlKCkgKyBwYXJzZUludChuZXREdWUpKTsgLy9udW1iZXIgIG9mIGRheXMgdG8gYWRkLCBlLnguIDE1IGRheXMKICAgICAgICB0aGlzLmV4cGVuc2UuZHVlX2RhdGUgPSBkdWVEYXRlLnRvSVNPU3RyaW5nKCkuc3Vic3RyKDAsIDEwKTsKICAgICAgfQogICAgfSwKICAgIG51bWJlckVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAga2VuZG8KICAgICAgICAualF1ZXJ5KCc8aW5wdXQgZGF0YS1iaW5kPSJ2YWx1ZTonICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgLmtlbmRvTnVtZXJpY1RleHRCb3goewogICAgICAgICAgZGVjaW1hbHM6IDMwLAogICAgICAgICAgZm9ybWF0OiBgJHt0aGlzLmRlY2ltYWxGb3JtYXR9YCwKICAgICAgICB9KTsKICAgIH0sCiAgICBIZWxwKGtleV9zZWFyY2gpIHsKICAgICAgU2hvd1Jlc291cmNlKGtleV9zZWFyY2gpOwogICAgfSwKICAgIC8vIEluaXRpYWwgRGF0YQogICAgaW5pdGlhbERhdGEoKSB7CiAgICAgIGlmICh0aGlzLmluaXRFeHBlbnNlKSB7CiAgICAgICAgLy8gRWRpdCBNb2RlCiAgICAgICAgdGhpcy5leHBlbnNlID0gdGhpcy5pbml0RXhwZW5zZTsKICAgICAgICB0aGlzLmJpbmREYXRhKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gQnJhbmQgTmV3IE1vZGUKICAgICAgICB0aGlzLnNldERlZmF1bHREYXRhKCk7CiAgICAgIH0KICAgIH0sCiAgICAvLyBTZXQgZGVmYXVsdCBkYXRhCiAgICBzZXREZWZhdWx0RGF0YSgpIHsKICAgICAgLy8gQnJhbmQgTmV3IE1vZGUKICAgICAgdGhpcy5pc0VkaXQgPSBmYWxzZTsKCiAgICAgIHRoaXMuZXhwZW5zZSA9IG5ldyBFeHBlbnNlTW9kZWwoewogICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zdWJzdHIoMCwgMTApLAogICAgICAgIGR1ZV9kYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3Vic3RyKDAsIDEwKSwKICAgICAgICBiaWxsX2RhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zdWJzdHIoMCwgMTApLAogICAgICAgIG1vbnRoX29mOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3Vic3RyKDAsIDcpLAogICAgICB9KTsKCiAgICAgIC8vIEVudHJ5IFV1aWQKICAgICAgdGhpcy5kZXBvc2l0RW50cnlVdWlkID0ga2VuZG8uZ3VpZCgpOwogICAgICB0aGlzLnRyYW5zYWN0aW9uRW50cnlVdWlkID0ga2VuZG8uZ3VpZCgpOwoKICAgICAgLy8gR2VuZXJhdGUgTnVtYmVyCiAgICAgIHRoaXMuZ2VuZXJhdGVOdW1iZXIoKTsKCiAgICAgIC8vIEFkZCAyIGRlZmF1bHQgbGluZXMKICAgICAgLy8gdGhpcy5hZGRSb3coKTsKICAgICAgLy8gdGhpcy5hZGRSb3coKTsKCiAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpOwogICAgfSwKICAgIC8vIEJpbmQgZGF0YSBmcm9tIHByb3AgZm9yIGVkaXQgbW9kZQogICAgYXN5bmMgYmluZERhdGEoKSB7CiAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwoKICAgICAgLy8gRWRpdCBNb2RlCiAgICAgIHRoaXMuaXNFZGl0ID0gdHJ1ZTsKCiAgICAgIC8vIEN1cnJlbmN5CiAgICAgIHRoaXMuY3VycmVuY3kgPSBuZXcgQ3VycmVuY3lNb2RlbCh0aGlzLmV4cGVuc2UuYmlsbF9jdXJyZW5jeSk7CiAgICAgIHRoaXMuZXhjaGFuZ2VSYXRlID0gbmV3IEV4Y2hhbmdlUmF0ZU1vZGVsKHRoaXMuZXhwZW5zZS5iaWxsX2N1cnJlbmN5KTsKICAgICAgdGhpcy5leGNoYW5nZVJhdGUuaWQgPSB0aGlzLmV4cGVuc2UuZXhwZW5zZV9lbnRyaWVzWzBdLmV4Y2hhbmdlX3JhdGVfdXVpZDsKICAgICAgdGhpcy5leGNoYW5nZVJhdGUucmF0ZSA9IHRoaXMuZXhwZW5zZS5leHBlbnNlX2VudHJpZXNbMF0uZXhjaGFuZ2VfcmF0ZTsKCiAgICAgIC8vIFBheW1lbnQgVGVybQogICAgICBsZXQgcGF5bWVudFRlcm1zID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ3BheW1lbnRUZXJtcy9nZXRMaXN0Jyk7CiAgICAgIHRoaXMucGF5bWVudFRlcm0gPSBwYXltZW50VGVybXMuZmluZChpID0+IGkuaWQgPT09IHRoaXMuZXhwZW5zZS5wYXltZW50X3Rlcm0pOwoKICAgICAgLy8gQ29udGFjdHMKICAgICAgdGhpcy5zdXBwbGllciA9IG5ldyBTdXBwbGllck1vZGVsKHRoaXMuZXhwZW5zZS5zdXBwbGllcik7CiAgICAgIHRoaXMuZW1wbG95ZWUgPSBuZXcgRW1wbG95ZWVNb2RlbCh0aGlzLmV4cGVuc2UuZW1wbG95ZWUpOwogICAgICB0aGlzLmxvYWRDYXNoQWR2YW5jZSgpOwogICAgICB0aGlzLmhhc0FkZGl0aW9uYWxDb3N0ID0gQm9vbGVhbigKICAgICAgICB0aGlzLmV4cGVuc2UuYWRkaXRpb25hbF9jb3N0X3N1cHBsaWVyLnV1aWQKICAgICAgKTsKCiAgICAgIC8vIFNpZGViYXIKCQkJbGV0IGxvY2F0aW9ucyA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdsb2NhdGlvbnMvZ2V0TGlzdCcpOwoJCQl0aGlzLmxvY2F0aW9uID0gbmV3IExvY2F0aW9uTW9kZWwobG9jYXRpb25zLmZpbmQoaSA9PiBpLmlkID09PSB0aGlzLmV4cGVuc2UubG9jYXRpb25fdXVpZCkpOwoKCQkJbGV0IHNlZ21lbnRzID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ3NlZ21lbnRzL2dldExpc3QnKTsKCQkJdGhpcy5zZWdtZW50ID0gbmV3IFNlZ21lbnRNb2RlbChzZWdtZW50cy5maW5kKGkgPT4gaS5pZCA9PT0gdGhpcy5leHBlbnNlLnNlZ21lbnRfdXVpZCkpOwoKCQkJbGV0IHByb2plY3RzID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ3Byb2plY3RzL2dldExpc3QnKTsKCQkJdGhpcy5wcm9qZWN0ID0gbmV3IFByb2plY3RNb2RlbChwcm9qZWN0cy5maW5kKGkgPT4gaS5pZCA9PT0gdGhpcy5leHBlbnNlLnByb2plY3RfdXVpZCkpOwoKICAgICAgLy8gRW50cmllcwogICAgICBsZXQgZXhwZW5zZUVudHJpZXMgPSBbXSwKICAgICAgICBzdWJUb3RhbCA9IDAsCiAgICAgICAgZGlzY291bnRBbW91bnQgPSAwLAogICAgICAgIHB1cmNoYXNlVGF4QW1vdW50ID0gMCwKICAgICAgICB3aGRUYXhBbW91bnQgPSAwLAogICAgICAgIGRpc2NvdW50SXRlbXMgPSBhd2FpdCBkaXNjb3VudEl0ZW1IYW5kbGVyLmdldEFsbCgiP3R5cGU9UHVyY2hhc2UiKSwKICAgICAgICB0YXhJdGVtcyA9IGF3YWl0IHRheEhhbmRsZXIuZ2V0QWxsKCksCiAgICAgICAgdW9tcyA9IGF3YWl0IHVvbUhhbmRsZXIuZ2V0QWxsKCksCiAgICAgICAgY2xhenogPSBhd2FpdCBjbGFzc0hhbmRsZXIuZ2V0QWxsKCk7CgogICAgICB0aGlzLmV4cGVuc2UuZXhwZW5zZV9lbnRyaWVzLmZvckVhY2goKHZhbHVlKSA9PiB7CiAgICAgICAgaWYgKAogICAgICAgICAgdmFsdWUuYW1vdW50ID4gMCAmJgogICAgICAgICAgdmFsdWUuYWNjb3VudC5hY2NvdW50X3R5cGUubnVtYmVyICE9PSBBY2NvdW50VHlwZUNvZGUuUFVSQ0hBU0VfVEFYCiAgICAgICAgKSB7CiAgICAgICAgICBsZXQgZXhwID0gbmV3IEV4cGVuc2VFbnRyeU1vZGVsKHZhbHVlKTsKCiAgICAgICAgICAvLyBTdWJ0b3RhbAogICAgICAgICAgc3ViVG90YWwgKz0gdmFsdWUuYW1vdW50OwoKICAgICAgICAgIC8vIFVPTQogICAgICAgICAgZXhwLnVvbSA9IG5ldyBVb21Nb2RlbCgKICAgICAgICAgICAgdW9tcy5kYXRhLmRhdGEuZmluZCgoaXRlbSkgPT4gaXRlbS5pZCA9PT0gdmFsdWUudW9tX3V1aWQpCiAgICAgICAgICApOwoKICAgICAgICAgIC8vIERpc2NvdW50CiAgICAgICAgICBleHAuZGlzY291bnQgPSBuZXcgRGlzY291bnRJdGVtTW9kZWwoCiAgICAgICAgICAgIGRpc2NvdW50SXRlbXMuZGF0YS5kYXRhLmZpbmQoKGl0ZW0pID0+IGl0ZW0uaWQgPT09IHZhbHVlLmRpc2NvdW50LnV1aWQpCiAgICAgICAgICApOwoKICAgICAgICAgIC8vIFRheAogICAgICAgICAgZXhwLnRheF9pdGVtID0gbmV3IFRheE1vZGVsKAogICAgICAgICAgICB0YXhJdGVtcy5kYXRhLmRhdGEuZmluZCgoaXRlbSkgPT4gaXRlbS5pZCA9PT0gdmFsdWUudGF4X2l0ZW0udXVpZCkKICAgICAgICAgICk7CgogICAgICAgICAgLy8gQ2xhc3NlcwogICAgICAgICAgZXhwLmNsYXNzMSA9IG5ldyBDbGFzc01vZGVsKAogICAgICAgICAgICBjbGF6ei5kYXRhLmRhdGEuZmluZCgoaXRlbSkgPT4gaXRlbS5pZCA9PT0gdmFsdWUuY2xhc3NfMV91dWlkKQogICAgICAgICAgKTsKICAgICAgICAgIGV4cC5jbGFzczIgPSBuZXcgQ2xhc3NNb2RlbCgKICAgICAgICAgICAgY2xhenouZGF0YS5kYXRhLmZpbmQoKGl0ZW0pID0+IGl0ZW0uaWQgPT09IHZhbHVlLmNsYXNzXzJfdXVpZCkKICAgICAgICAgICk7CiAgICAgICAgICBleHAuY2xhc3MzID0gbmV3IENsYXNzTW9kZWwoCiAgICAgICAgICAgIGNsYXp6LmRhdGEuZGF0YS5maW5kKChpdGVtKSA9PiBpdGVtLmlkID09PSB2YWx1ZS5jbGFzc18zX3V1aWQpCiAgICAgICAgICApOwogICAgICAgICAgZXhwLmNsYXNzNCA9IG5ldyBDbGFzc01vZGVsKAogICAgICAgICAgICBjbGF6ei5kYXRhLmRhdGEuZmluZCgoaXRlbSkgPT4gaXRlbS5pZCA9PT0gdmFsdWUuY2xhc3NfNF91dWlkKQogICAgICAgICAgKTsKICAgICAgICAgIGV4cC5jbGFzczUgPSBuZXcgQ2xhc3NNb2RlbCgKICAgICAgICAgICAgY2xhenouZGF0YS5kYXRhLmZpbmQoKGl0ZW0pID0+IGl0ZW0uaWQgPT09IHZhbHVlLmNsYXNzXzVfdXVpZCkKICAgICAgICAgICk7CgogICAgICAgICAgZXhwZW5zZUVudHJpZXMucHVzaChleHApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBEaXNjb3VudAogICAgICAgICAgaWYgKHZhbHVlLmFjY291bnQuYWNjb3VudF90eXBlLm51bWJlciA9PT0gQWNjb3VudFR5cGVDb2RlLkRJU0NPVU5UKSB7CiAgICAgICAgICAgIGRpc2NvdW50QW1vdW50ICs9IHZhbHVlLmFtb3VudCAqIC0xOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIFdIRCBUYXgKICAgICAgICAgIGlmICh2YWx1ZS5hY2NvdW50LmFjY291bnRfdHlwZS5udW1iZXIgPT09IEFjY291bnRUeXBlQ29kZS5XSERfVEFYKSB7CiAgICAgICAgICAgIHdoZFRheEFtb3VudCArPSB2YWx1ZS5hbW91bnQgKiAtMTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBEZXBvc2l0CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIH5BY2NvdW50VHlwZUNvZGUuUFVSQ0hBU0VfREVQT1NJVFMuaW5kZXhPZigKICAgICAgICAgICAgICB2YWx1ZS5hY2NvdW50LmFjY291bnRfdHlwZS5udW1iZXIKICAgICAgICAgICAgKQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuZGVwb3NpdEFtb3VudCA9IHZhbHVlLmFtb3VudCAqIC0xOwogICAgICAgICAgICB0aGlzLmRlcG9zaXRFbnRyeVV1aWQgPSB2YWx1ZS51dWlkOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIFRyYW5zYWN0aW9uIEFjY291bnQgKFBheWFibGUgQWNjb3VudCAvIENsZWFyaW5nIEFjY291bnQpCiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIH5BY2NvdW50VHlwZUNvZGUuUEFZQUJMRV9BQ0NPVU5UUy5pbmRleE9mKAogICAgICAgICAgICAgIHZhbHVlLmFjY291bnQuYWNjb3VudF90eXBlLm51bWJlcgogICAgICAgICAgICApIHx8CiAgICAgICAgICAgIHZhbHVlLmFjY291bnQubnVtYmVyID09PQogICAgICAgICAgICAgIEFjY291bnRUeXBlQ29kZS5BRFZBTkNFX1NFVFRMRU1FTlRfQ0xFQVJJTkdfQ09ERQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuYW1vdW50RHVlID0gdmFsdWUuYW1vdW50ICogLTE7CiAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb25FbnRyeVV1aWQgPSB2YWx1ZS51dWlkOwogICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uQWNjb3VudCA9IG5ldyBBY2NvdW50TW9kZWwodmFsdWUuYWNjb3VudCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBQdXJjaGFzZSBUYXgKICAgICAgICBpZiAoCiAgICAgICAgICB2YWx1ZS5hY2NvdW50LmFjY291bnRfdHlwZS5udW1iZXIgPT09IEFjY291bnRUeXBlQ29kZS5QVVJDSEFTRV9UQVgKICAgICAgICApIHsKICAgICAgICAgIHB1cmNoYXNlVGF4QW1vdW50ICs9IHZhbHVlLmFtb3VudDsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgLy8gQmluZCBFeHBlbnNlIEVudHJpZXMKICAgICAgdGhpcy5leHBlbnNlRW50cmllcyA9IGV4cGVuc2VFbnRyaWVzOwoKICAgICAgLy8gQ2FsY3VsYXRpb24KICAgICAgdGhpcy5zdWJUb3RhbCA9IHN1YlRvdGFsOwogICAgICB0aGlzLmRpc2NvdW50QW1vdW50ID0gZGlzY291bnRBbW91bnQ7CiAgICAgIHRoaXMucHVyY2hhc2VUYXggPSBwdXJjaGFzZVRheEFtb3VudDsKICAgICAgdGhpcy53aGRUYXggPSB3aGRUYXhBbW91bnQ7CiAgICAgIHRoaXMudG90YWxBbW91bnQgPQogICAgICAgIHN1YlRvdGFsIC0gdGhpcy5kaXNjb3VudEFtb3VudCArIHRoaXMucHVyY2hhc2VUYXggLSB0aGlzLndoZFRheDsKCiAgICAgIC8vSm91cm5hbAogICAgICBsZXQgam91cm5hbHMgPSBhd2FpdCBqb3VybmFsSGFuZGxlci5nZXRPbmUodGhpcy5leHBlbnNlLmpvdXJuYWxfdXVpZCk7CiAgICAgIHRoaXMuam91cm5hbCA9IGpvdXJuYWxzLmRhdGE7CiAgICAgIHRoaXMuam91cm5hbEVudHJpZXMgPSB0aGlzLmpvdXJuYWwuam91cm5hbF9lbnRyaWVzOwoKICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgfSwKICAgIC8vIE51bWJlcgogICAgYXN5bmMgZ2VuZXJhdGVOdW1iZXIoKSB7CiAgICAgIGxldCBudW0gPSBhd2FpdCBIZWxwZXIuZ2VuZXJhdGVBY2NvdW50aW5nTnVtYmVyKAogICAgICAgIEVudGl0eVR5cGUuRVhQRU5TRVMsCiAgICAgICAgdGhpcy5leHBlbnNlLmV4cGVuc2VfZGF0ZQogICAgICApOwoKICAgICAgdGhpcy5leHBlbnNlLm51bWJlciA9IG51bS5udW1iZXI7CiAgICAgIHRoaXMudHJhbnNhY3Rpb25UeXBlID0gbnVtLnByZWZpeDsKICAgICAgdGhpcy5leHBlbnNlLnByZWZpeF9mb3JtYXQgPSBudW0ucHJlZml4X2Zvcm1hdDsKICAgIH0sCiAgICAvLyBHZXQgRXhjaGFuZ2UgUmF0ZQogICAgYXN5bmMgZ2V0RXhjaGFuZ2VSYXRlKCkgewogICAgICBpZiAodGhpcy5leHBlbnNlLmV4cGVuc2VfZGF0ZSAmJiB0aGlzLmN1cnJlbmN5LmNvZGUgIT09ICIiKSB7CiAgICAgICAgdGhpcy5leGNoYW5nZVJhdGUgPSBhd2FpdCBIZWxwZXIuZ2V0TGFzdEV4Y2hhbmdlUmF0ZUJ5RGF0ZSgKICAgICAgICAgIHRoaXMuZXhwZW5zZS5leHBlbnNlX2RhdGUsCiAgICAgICAgICB0aGlzLmN1cnJlbmN5LmNvZGUKICAgICAgICApOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZXhjaGFuZ2VSYXRlID0gbmV3IEV4Y2hhbmdlUmF0ZU1vZGVsKGluc3RpdHV0ZS5iYXNlQ3VycmVuY3kpOwogICAgICB9CiAgICAgIHRoaXMuc3VwcGxpZXJEZXBvc2l0QmFsYW5jZSgpOwogICAgfSwKICAgIC8vIExvYWQgQ2FzaCBBZHZhbmNlCiAgICBsb2FkQ2FzaEFkdmFuY2UoKSB7CiAgICAgIGlmICh0aGlzLmVtcGxveWVlLmlkICE9PSAiIikgewogICAgICAgIC8vIENsZWFyIFNlbGVjdGVkIENhc2ggQWR2YW5jZQogICAgICAgIHRoaXMuZXhwZW5zZS51c2VfZm9yX3RyYW5zYWN0aW9uX3V1aSA9ICIiOwoKICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICBjYXNoQWR2YW5jZUhhbmRsZXIKICAgICAgICAgIC5nZXRCeUVtcGxveWVlSWQodGhpcy5lbXBsb3llZS5pZCkKICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgaWYgKHJlcy5kYXRhKSB7CiAgICAgICAgICAgICAgdGhpcy5jYXNoQWR2YW5jZXMgPSByZXMuZGF0YTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICAgIC5maW5hbGx5KCgpID0+IHsKICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICAvLyBPbiBFbXBsb3llZSBSYWRpbyBDaGFuZ2VzCiAgICBvblVzZUZvck9wdGlvbkNoYW5nZXMoKSB7CiAgICAgIC8vIENsZWFyIFNlbGVjdGVkIENhc2ggQWR2YW5jZQogICAgICB0aGlzLmV4cGVuc2UudXNlX2Zvcl90cmFuc2FjdGlvbl91dWlkID0gIiI7CiAgICAgIHRoaXMudHJhbnNhY3Rpb25BY2NvdW50ID0gbmV3IEFjY291bnRNb2RlbCgpOwoKICAgICAgdGhpcy5maWx0ZXJUcmFuc2FjdGlvbkFjY291bnQoKTsKICAgIH0sCiAgICAvLyBGaWx0ZXIgVHJhbnNhdGlvbiBBY2NvdW50CiAgICBmaWx0ZXJUcmFuc2FjdGlvbkFjY291bnQoKSB7CiAgICAgIGlmICh0aGlzLmV4cGVuc2UudXNlX2Zvcl9vcHRpb24gPT09IDApIHsKICAgICAgICAvLyBDcmVkaXQKICAgICAgICB0aGlzLnRyYW5zYWN0aW9uQWNjb3VudHMgPSB0aGlzLmFjY291bnRzLmZpbHRlcigKICAgICAgICAgIChpdGVtKSA9PgogICAgICAgICAgICB+QWNjb3VudFR5cGVDb2RlLlBBWUFCTEVfQUNDT1VOVFMuaW5kZXhPZihpdGVtLmFjY291bnRfdHlwZS5udW1iZXIpCiAgICAgICAgKTsgLy8gUGF5YWJsZSBBY2NvdW50CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gUmVpbWJ1cnNlbWVudCAvIENhc2ggQWR2YW5jZQogICAgICAgIHRoaXMudHJhbnNhY3Rpb25BY2NvdW50ID0gdGhpcy5hZHZhbmNlU2V0dGxlbWVudENsZWFyaW5nQWNjb3VudDsKICAgICAgICB0aGlzLnRyYW5zYWN0aW9uQWNjb3VudHMgPSBbdGhpcy5hZHZhbmNlU2V0dGxlbWVudENsZWFyaW5nQWNjb3VudF07CiAgICAgIH0KICAgIH0sCiAgICAvLyBPbiBBZGRpdGlvbmFsIENvc3QgQ2hhbmdlcwogICAgb25BZGRpdGlvbmFsQ29zdENoZWNrYm94Q2hhbmdlcygpIHsKICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5leHBlbnNlQWNjb3VudERTLmtlbmRvV2lkZ2V0KCk7CiAgICAgIGRzLmRhdGEoW10pOwoKICAgICAgaWYgKHRoaXMuaGFzQWRkaXRpb25hbENvc3QpIHsKICAgICAgICB0aGlzLmV4cGVuc2VBY2NvdW50cyA9IFt0aGlzLm90aGVyQ2xlYXJpbmdTdXNwZW5zZUFjY291bnRdOwoKICAgICAgICAvLyBJbnNlcnQgcm93CiAgICAgICAgbGV0IGplID0gbmV3IEV4cGVuc2VFbnRyeUV4dGVuZGVkTW9kZWwoewogICAgICAgICAgdXVpZDoga2VuZG8uZ3VpZCgpLAogICAgICAgICAgYWNjb3VudDogdGhpcy5vdGhlckNsZWFyaW5nU3VzcGVuc2VBY2NvdW50LAogICAgICAgICAgZGVjaW1hbEZvcm1hdDogdGhpcy5kZWNpbWFsRm9ybWF0LAogICAgICAgIH0pOwoKICAgICAgICBkcy5hZGQoamUpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZXhwZW5zZS5hZGRpdGlvbmFsX2Nvc3Rfc3VwcGxpZXIgPSBudWxsOwogICAgICAgIHRoaXMuZXhwZW5zZUFjY291bnRzID0gdGhpcy5hY2NvdW50czsKICAgICAgICB0aGlzLmFkZFJvdygpOwogICAgICAgIHRoaXMuYWRkUm93KCk7CiAgICAgIH0KICAgIH0sCiAgICAvKiBLZW5kbyAqLwogICAgLy8gRGF0YVNvdXJjZSBDaGFuZ2VzCiAgICBvbkV4cGVuc2VBY2NvdW50RFNDaGFuZ2VzKGUpIHsKICAgICAgaWYgKGUuZmllbGQpIHsKICAgICAgICBsZXQgZGF0YVJvdyA9IGUuaXRlbXNbMF07CgogICAgICAgIGlmIChlLmZpZWxkID09PSAiYWNjb3VudCIpIHsKICAgICAgICAgIHRoaXMuYWRkRXh0cmFSb3coZGF0YVJvdy51aWQpOwogICAgICAgIH0gZWxzZSBpZiAoZS5maWVsZCA9PT0gInF1YW50aXR5IiB8fCBlLmZpZWxkID09PSAicHJpY2UiKSB7CiAgICAgICAgICBsZXQgYW10ID0KICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdChkYXRhUm93LnF1YW50aXR5KSAqCiAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQoZGF0YVJvdy5wcmljZSk7CiAgICAgICAgICBkYXRhUm93LnNldCgiYW1vdW50IiwgYW10KTsKICAgICAgICB9IGVsc2UgaWYgKGUuZmllbGQgPT09ICJ1b20iKSB7CiAgICAgICAgICBpZiAoZGF0YVJvdy51b20pIHsKICAgICAgICAgICAgZGF0YVJvdy5zZXQoInVvbV91dWlkIiwgZGF0YVJvdy51b20uaWQpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZS5maWVsZCA9PT0gImNsYXNzMSIpIHsKICAgICAgICAgIGlmIChkYXRhUm93LmNsYXNzMSAhPT0gbnVsbCkgewogICAgICAgICAgICBkYXRhUm93LnNldCgiY2xhc3NfMV91dWlkIiwgZGF0YVJvdy5jbGFzczEuaWQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gU2V0IGRlZmF1bHQgd2hlbiBkZXNlbGVjdAogICAgICAgICAgICBkYXRhUm93LnNldCgiY2xhc3NfMV91dWlkIiwgIiIpOwogICAgICAgICAgICBkYXRhUm93LnNldCgiY2xhc3MxIiwgbmV3IENsYXNzTW9kZWwoKSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChlLmZpZWxkID09PSAiY2xhc3MyIikgewogICAgICAgICAgaWYgKGRhdGFSb3cuY2xhc3MyICE9PSBudWxsKSB7CiAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjbGFzc18yX3V1aWQiLCBkYXRhUm93LmNsYXNzMi5pZCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBTZXQgZGVmYXVsdCB3aGVuIGRlc2VsZWN0CiAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjbGFzc18yX3V1aWQiLCAiIik7CiAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjbGFzczIiLCBuZXcgQ2xhc3NNb2RlbCgpKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGUuZmllbGQgPT09ICJjbGFzczMiKSB7CiAgICAgICAgICBpZiAoZGF0YVJvdy5jbGFzczMgIT09IG51bGwpIHsKICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNsYXNzXzNfdXVpZCIsIGRhdGFSb3cuY2xhc3MzLmlkKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFNldCBkZWZhdWx0IHdoZW4gZGVzZWxlY3QKICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNsYXNzXzNfdXVpZCIsICIiKTsKICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNsYXNzMyIsIG5ldyBDbGFzc01vZGVsKCkpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZS5maWVsZCA9PT0gImNsYXNzNCIpIHsKICAgICAgICAgIGlmIChkYXRhUm93LmNsYXNzNCAhPT0gbnVsbCkgewogICAgICAgICAgICBkYXRhUm93LnNldCgiY2xhc3NfNF91dWlkIiwgZGF0YVJvdy5jbGFzczQuaWQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gU2V0IGRlZmF1bHQgd2hlbiBkZXNlbGVjdAogICAgICAgICAgICBkYXRhUm93LnNldCgiY2xhc3NfNF91dWlkIiwgIiIpOwogICAgICAgICAgICBkYXRhUm93LnNldCgiY2xhc3M0IiwgbmV3IENsYXNzTW9kZWwoKSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChlLmZpZWxkID09PSAiY2xhc3M1IikgewogICAgICAgICAgaWYgKGRhdGFSb3cuY2xhc3M1ICE9PSBudWxsKSB7CiAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjbGFzc181X3V1aWQiLCBkYXRhUm93LmNsYXNzNS5pZCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBTZXQgZGVmYXVsdCB3aGVuIGRlc2VsZWN0CiAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjbGFzc181X3V1aWQiLCAiIik7CiAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjbGFzczUiLCBuZXcgQ2xhc3NNb2RlbCgpKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpOwogICAgICB9CiAgICB9LAogICAgY2FsY3VsYXRlRGlzY291bnQoZGlzY291bnRJdGVtLCBzdWJUb3RhbCkgewogICAgICBpZiAoZGlzY291bnRJdGVtKSB7CiAgICAgICAgY29uc3QgbmF0dXJlID0gZGlzY291bnRJdGVtLm5hdHVyZTsKICAgICAgICBjb25zdCBhbW91bnQgPSBkaXNjb3VudEl0ZW0uYW1vdW50OwogICAgICAgIGlmIChuYXR1cmUgPT09ICJBbW91bnQiKSB7CiAgICAgICAgICByZXR1cm4ga2VuZG8ucGFyc2VGbG9hdChhbW91bnQpOwogICAgICAgIH0gZWxzZSBpZiAobmF0dXJlID09PSAiUGVyY2VudGFnZSIpIHsKICAgICAgICAgIHJldHVybiBzdWJUb3RhbCAqIChrZW5kby5wYXJzZUZsb2F0KGFtb3VudCkgLyAxMDApOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGF1dG9DYWxjdWxhdGVUYXgodGF4LCBhbW91bnQpIHsKICAgICAgaWYgKHRheCkgewogICAgICAgIHZhciBmb3JtdWxhID0gdGF4LmZvcm11bGE7CiAgICAgICAgdmFyIGluQW10ID0ga2VuZG8ucGFyc2VGbG9hdChhbW91bnQpOwogICAgICAgIHZhciBuQW10ID0ga2VuZG8ucGFyc2VGbG9hdChhbW91bnQpOwogICAgICAgIHZhciB0YXhCYXNlID0ga2VuZG8ucGFyc2VGbG9hdCh0YXgudGF4QmFzZSkgLyAxMDA7CiAgICAgICAgdmFyIHJhdGUgPSBrZW5kby5wYXJzZUZsb2F0KHRheC5yYXRlKSAvIDEwMDsKICAgICAgICB2YXIgdG90YWwgPSBldmFsKGZvcm11bGEpOwogICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhpbkFtdCwgbkFtdCwgdGF4QmFzZSwgcmF0ZSwgZm9ybXVsYSwgdG90YWwpOwogICAgICAgIHJldHVybiB0b3RhbDsKICAgICAgfQogICAgICAvLyByZXR1cm4gMAogICAgfSwKICAgIC8vIEF1dG8gQ2FsY3VsYXRlIEluIERhdGFTb3VyY2UKICAgIGF1dG9DYWxjdWxhdGUoKSB7CiAgICAgIGxldCBleHBEUyA9IHRoaXMuJHJlZnMuZXhwZW5zZUFjY291bnREUy5rZW5kb1dpZGdldCgpLAogICAgICAgIHN1YlRvdGFsID0gMCwKICAgICAgICBkaXNjb3VudCA9IDAsCiAgICAgICAgcHVyY2hhc2VUYXggPSAwLAogICAgICAgIHdoZFRheCA9IDAsCiAgICAgICAgZGlzY291bnRJdGVtID0gW107CgogICAgICAvLyBFeHBlbnNlCiAgICAgIGV4cERTLmRhdGEoKS5mb3JFYWNoKCh2YWx1ZSkgPT4gewogICAgICAgIGxldCBhbXQgPSBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmFtb3VudCk7CiAgICAgICAgc3ViVG90YWwgKz0gYW10OwoKICAgICAgICAvLyBEaXNjb3VudAogICAgICAgIGxldCBkaXNjb3VudEFtb3VudCA9IDA7CiAgICAgICAgaWYgKHZhbHVlLmRpc2NvdW50LmlkICE9PSAiIikgewogICAgICAgICAgbGV0IHN1YlRvID0KICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5wcmljZSkgKiBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnF1YW50aXR5KTsKICAgICAgICAgIGNvbnN0IGRpc0FNdCA9IHRoaXMuY2FsY3VsYXRlRGlzY291bnQodmFsdWUuZGlzY291bnQsIHN1YlRvKTsKICAgICAgICAgIGRpc2NvdW50QW1vdW50ID0gZGlzQU10OwogICAgICAgICAgZGlzY291bnQgKz0gZGlzQU10OwogICAgICAgICAgaWYgKHZhbHVlLmRpc2NvdW50Lmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgIGRpc2NvdW50SXRlbS5wdXNoKHZhbHVlLmRpc2NvdW50KTsKICAgICAgICAgIH0KICAgICAgICAgIC8vIEJpbmQgQWNjb3VudCBNb2RlbAogICAgICAgICAgdmFsdWUuZGlzY291bnQuYWNjb3VudCA9IG5ldyBBY2NvdW50TW9kZWwodmFsdWUuZGlzY291bnQuYWNjb3VudCk7CiAgICAgICAgfQoKICAgICAgICAvLyBUYXgKICAgICAgICBpZiAodmFsdWUudGF4X2l0ZW0uaWQgIT09ICIiKSB7CiAgICAgICAgICBsZXQgYW10QWZ0ZXJEaXNjb3VudCA9CiAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuYW1vdW50KSAtIGRpc2NvdW50QW1vdW50OwogICAgICAgICAgY29uc3QgdGF4QW1vdW50ID0gdGhpcy5hdXRvQ2FsY3VsYXRlVGF4KAogICAgICAgICAgICB2YWx1ZS50YXhfaXRlbSwKICAgICAgICAgICAgYW10QWZ0ZXJEaXNjb3VudAogICAgICAgICAgKTsKICAgICAgICAgIGlmICh2YWx1ZS50YXhfaXRlbS5oYXNPd25Qcm9wZXJ0eSgidGF4VHlwZSIpKSB7CiAgICAgICAgICAgIGNvbnN0IHRheFR5cGUgPSB2YWx1ZS50YXhfaXRlbS50YXhUeXBlOwogICAgICAgICAgICBsZXQgdGF4VHlwZUlkID0gMDsKICAgICAgICAgICAgaWYgKHRheFR5cGUuaGFzT3duUHJvcGVydHkoInR5cGVJZCIpKSB7CiAgICAgICAgICAgICAgdGF4VHlwZUlkID0gdGF4VHlwZS50eXBlSWQ7CiAgICAgICAgICAgICAgaWYgKHRheFR5cGVJZCA9PT0gMikgewogICAgICAgICAgICAgICAgd2hkVGF4ICs9IHRheEFtb3VudDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcHVyY2hhc2VUYXggKz0gdGF4QW1vdW50OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLy8gQmluZCBBY2NvdW50IE1vZGVsCiAgICAgICAgICB2YWx1ZS50YXhfaXRlbS5hY2NvdW50ID0gbmV3IEFjY291bnRNb2RlbCh2YWx1ZS50YXhfaXRlbS5hY2NvdW50KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLnN1YlRvdGFsID0gc3ViVG90YWw7CiAgICAgIHRoaXMuZGlzY291bnRBbW91bnQgPSBkaXNjb3VudDsKICAgICAgdGhpcy5wdXJjaGFzZVRheCA9IHB1cmNoYXNlVGF4OwogICAgICB0aGlzLndoZFRheCA9IHdoZFRheDsKICAgICAgdGhpcy50b3RhbEFtb3VudCA9IHN1YlRvdGFsIC0gZGlzY291bnQgKyBwdXJjaGFzZVRheCAtIHdoZFRheDsKICAgICAgdGhpcy5hbW91bnREdWUgPSB0aGlzLnRvdGFsQW1vdW50IC0gdGhpcy5kZXBvc2l0QW1vdW50OwogICAgICB0aGlzLnN1cHBsaWVyRGlzY291bnRJdGVtID0gdGhpcy5yZW1vdmVEdXBsaWNhdGUoZGlzY291bnRJdGVtKTsKICAgIH0sCiAgICAvLyBSb3cgTnVtYmVyIFRlbXBsYXRlCiAgICByb3dOdW1iZXJUbXBsKGRhdGFJdGVtKSB7CiAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuZXhwZW5zZUFjY291bnREUy5rZW5kb1dpZGdldCgpLAogICAgICAgIGluZGV4ID0gZHMuaW5kZXhPZihkYXRhSXRlbSk7CgogICAgICByZXR1cm4gaW5kZXggKyAxOwogICAgfSwKICAgIC8vIEdyaWQgQ3VzdG9tIEVkaXRvcgogICAgZXhwZW5zZUFjY291bnRFZGl0b3IoY29udGFpbmVyLCBvcHRpb25zKSB7CiAgICAgIHJldHVybiBIZWxwZXIuYWNjb3VudEVkaXRvcihjb250YWluZXIsIG9wdGlvbnMsIHRoaXMuZXhwZW5zZUFjY291bnRzKTsKICAgIH0sCiAgICAvLyBBZGQgTmV3IFJvdwogICAgYWRkUm93KCkgewogICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLmV4cGVuc2VBY2NvdW50RFMua2VuZG9XaWRnZXQoKSwKICAgICAgICBsYXN0ID0gZHMudG90YWwoKTsKCiAgICAgIGxldCBqZSA9IG5ldyBFeHBlbnNlRW50cnlFeHRlbmRlZE1vZGVsKCk7CiAgICAgIGplLnV1aWQgPSBrZW5kby5ndWlkKCk7CiAgICAgIGplLnF1YW50aXR5ID0gMTsKICAgICAgamUuZGlzY291bnRBcyA9IERJU0NPVU5UX0lURU1fVFlQRTsKICAgICAgamUuZGVjaW1hbEZvcm1hdCA9IHRoaXMuZGVjaW1hbEZvcm1hdDsKCiAgICAgIGRzLmluc2VydChsYXN0LCBqZSk7CiAgICB9LAogICAgLy8gQWRkIEV4dHJhIFJvdwogICAgYWRkRXh0cmFSb3codWlkKSB7CiAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuZXhwZW5zZUFjY291bnREUy5rZW5kb1dpZGdldCgpLAogICAgICAgIHRvdGFsID0gZHMudG90YWwoKSwKICAgICAgICByb3cgPSBkcy5nZXRCeVVpZCh1aWQpLAogICAgICAgIGluZGV4ID0gZHMuaW5kZXhPZihyb3cpOwoKICAgICAgaWYgKGluZGV4ID09PSB0b3RhbCAtIDEpIHsKICAgICAgICB0aGlzLmFkZFJvdygpOwogICAgICB9CiAgICB9LAogICAgLy8gUmVtb3ZlIFJvdwogICAgcmVtb3ZlUm93KGUpIHsKICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgbGV0IGdyaWQgPSB0aGlzLiRyZWZzLmV4cGVuc2VHcmlkLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgZHMgPSBncmlkLmRhdGFTb3VyY2UsCiAgICAgICAgZGF0YUl0ZW0gPSBncmlkLmRhdGFJdGVtKCQoZS5jdXJyZW50VGFyZ2V0KS5jbG9zZXN0KCJ0ciIpKTsKCiAgICAgIGlmIChkcy5kYXRhKCkubGVuZ3RoID4gMikgewogICAgICAgIGRzLnJlbW92ZShkYXRhSXRlbSk7CiAgICAgIH0KICAgIH0sCiAgICAvLyBTaHJpbmsgRGF0YQogICAgc2hyaW5rRGF0YSgpIHsKICAgICAgbGV0IGVudHJpZXMgPSBbXSwKICAgICAgICBkaXNjb3VudEdyb3VwcyA9IHt9LAogICAgICAgIHRheEdyb3VwcyA9IHt9LAogICAgICAgIGV4cERTID0gdGhpcy4kcmVmcy5leHBlbnNlQWNjb3VudERTLmtlbmRvV2lkZ2V0KCk7CgogICAgICAvLyBEYXRlCiAgICAgIHRoaXMuZXhwZW5zZS5leHBlbnNlX2RhdGUgPSBIZWxwZXIudG9JU09EYXRlKHRoaXMuZXhwZW5zZS5leHBlbnNlX2RhdGUpOwogICAgICB0aGlzLmV4cGVuc2UuYmlsbF9kYXRlID0gSGVscGVyLnRvSVNPRGF0ZSh0aGlzLmV4cGVuc2UuYmlsbF9kYXRlKTsKICAgICAgdGhpcy5leHBlbnNlLmR1ZV9kYXRlID0gSGVscGVyLnRvSVNPRGF0ZSh0aGlzLmV4cGVuc2UuZHVlX2RhdGUpOwogICAgICB0aGlzLmV4cGVuc2UucGF5bWVudF90ZXJtID0gdGhpcy5wYXltZW50VGVybS5pZDsKCiAgICAgIC8vIEN1cnJlbmN5CiAgICAgIHRoaXMuZXhwZW5zZS5iaWxsX2N1cnJlbmN5ID0gdGhpcy5jdXJyZW5jeTsKCiAgICAgIC8vIFN1cHBsaWVyCiAgICAgIHRoaXMuZXhwZW5zZS5zdXBwbGllciA9IG5ldyBDb250YWN0TW9kZWwodGhpcy5zdXBwbGllcik7CgogICAgICAvLyBFbXBsb3llZQogICAgICB0aGlzLmV4cGVuc2UuZW1wbG95ZWUgPSBuZXcgQ29udGFjdE1vZGVsKHRoaXMuZW1wbG95ZWUpOwoKICAgICAgLy8gU2lkZWJhcgogICAgICB0aGlzLmV4cGVuc2UubG9jYXRpb25fdXVpZCA9IHRoaXMubG9jYXRpb24uaWQ7CiAgICAgIHRoaXMuZXhwZW5zZS5zZWdtZW50X3V1aWQgPSB0aGlzLnNlZ21lbnQuaWQ7CiAgICAgIHRoaXMuZXhwZW5zZS5wcm9qZWN0X3V1aWQgPSB0aGlzLnByb2plY3QuaWQ7CgogICAgICAvLyBVc2VyCiAgICAgIGlmICh0aGlzLmlzRWRpdCkgewogICAgICAgIHRoaXMuZXhwZW5zZS5tb2RpZmllZF9ieSA9IHRoaXMudXNlcjsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmV4cGVuc2UuY3JlYXRlZF9ieSA9IHRoaXMudXNlcjsKICAgICAgfQoKICAgICAgLy8gRXhwZW5zZSBFbnRyaWVzIG9uIERyCiAgICAgIGV4cERTLmRhdGEoKS5mb3JFYWNoKCh2YWx1ZSkgPT4gewogICAgICAgIC8vIEZpbHRlciBzZWxlY3RlZCBhY2NvdW50CiAgICAgICAgaWYgKHZhbHVlLmFjY291bnQubmFtZSAhPT0gIiIgJiYgdmFsdWUuYW1vdW50ID4gMCkgewogICAgICAgICAgLy8gQWNjb3VudAogICAgICAgICAgdmFsdWUuc2V0KCJhY2NvdW50IiwgbmV3IEFjY291bnRNb2RlbCh2YWx1ZS5hY2NvdW50KSk7CgogICAgICAgICAgLy8gQ29udGFjdAogICAgICAgICAgdmFsdWUuc2V0KCJwcmltYXJ5X2NvbnRhY3QiLCBuZXcgQ29udGFjdE1vZGVsKHRoaXMuc3VwcGxpZXIpKTsKICAgICAgICAgIHZhbHVlLnNldCgic2Vjb25kYXJ5X2NvbnRhY3RzIiwgW25ldyBDb250YWN0TW9kZWwodGhpcy5lbXBsb3llZSldKTsKCiAgICAgICAgICAvLyB2YWx1ZS5zZXQoImJpbGxhYmxlIiwgTnVtYmVyKHZhbHVlLmJpbGxhYmxlKSk7CgogICAgICAgICAgLy8gQ3VycmVuY3kKICAgICAgICAgIHZhbHVlLnNldCgiY3VycmVuY3kiLCBuZXcgQ3VycmVuY3lNb2RlbCh0aGlzLmN1cnJlbmN5KSk7CiAgICAgICAgICB2YWx1ZS5zZXQoImV4Y2hhbmdlX3JhdGVfdXVpZCIsIHRoaXMuZXhjaGFuZ2VSYXRlLmlkKTsKICAgICAgICAgIHZhbHVlLnNldCgiZXhjaGFuZ2VfcmF0ZSIsIHRoaXMuZXhjaGFuZ2VSYXRlLnJhdGUpOwogICAgICAgICAgdmFsdWUuc2V0KCJleGNoYW5nZWRfYW1vdW50IiwgdmFsdWUuYW1vdW50ICogdGhpcy5leGNoYW5nZVJhdGUucmF0ZSk7CgogICAgICAgICAgLy8gRGlzY291bnQKICAgICAgICAgIHZhbHVlLnNldCgiZGlzY291bnQiLCBuZXcgRGlzY291bnRJdGVtTW9kZWwodmFsdWUuZGlzY291bnQpKTsKCiAgICAgICAgICAvLyBUYXgKICAgICAgICAgIHZhbHVlLnNldCgidGF4X2l0ZW0iLCBuZXcgVGF4TW9kZWwodmFsdWUudGF4X2l0ZW0pKTsKCiAgICAgICAgICAvLyBBZGQgRW50cnkKICAgICAgICAgIGVudHJpZXMucHVzaChuZXcgRXhwZW5zZUVudHJ5TW9kZWwodmFsdWUpKTsKCiAgICAgICAgICAvLyBEaXNjb3VudCBvbiBDcgogICAgICAgICAgbGV0IGRpc2NvdW50QW1vdW50ID0gMDsKICAgICAgICAgIGlmICh2YWx1ZS5kaXNjb3VudC5pZCAhPT0gIiIpIHsKICAgICAgICAgICAgbGV0IHN1YlRvID0KICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnByaWNlKSAqIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucXVhbnRpdHkpOwogICAgICAgICAgICBkaXNjb3VudEFtb3VudCA9IHRoaXMuY2FsY3VsYXRlRGlzY291bnQodmFsdWUuZGlzY291bnQsIHN1YlRvKTsKCiAgICAgICAgICAgIC8vIEdyb3VwIERpc2NvdW50J3MgQWNjb3VudAogICAgICAgICAgICBpZiAoZGlzY291bnRHcm91cHNbdmFsdWUuZGlzY291bnQuYWNjb3VudC51dWlkXSkgewogICAgICAgICAgICAgIGRpc2NvdW50R3JvdXBzW3ZhbHVlLmRpc2NvdW50LmFjY291bnQudXVpZF1bCiAgICAgICAgICAgICAgICAiYW1vdW50IgogICAgICAgICAgICAgIF0gKz0gZGlzY291bnRBbW91bnQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZGlzY291bnRHcm91cHNbdmFsdWUuZGlzY291bnQuYWNjb3VudC51dWlkXSA9IHsKICAgICAgICAgICAgICAgIHV1aWQ6IGtlbmRvLmd1aWQoKSwKICAgICAgICAgICAgICAgIGFtb3VudDogZGlzY291bnRBbW91bnQsCiAgICAgICAgICAgICAgICBhY2NvdW50OiBuZXcgQWNjb3VudE1vZGVsKHZhbHVlLmRpc2NvdW50LmFjY291bnQpLAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvLyBUYXhlcyBvbiBEcgogICAgICAgICAgaWYgKHZhbHVlLnRheF9pdGVtLmlkICE9PSAiIikgewogICAgICAgICAgICBsZXQgYW10QWZ0ZXJEaXNjb3VudCA9CiAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5hbW91bnQpIC0gZGlzY291bnRBbW91bnQ7CiAgICAgICAgICAgIGxldCB0YXhBbW91bnQgPSB0aGlzLmF1dG9DYWxjdWxhdGVUYXgoCiAgICAgICAgICAgICAgdmFsdWUudGF4X2l0ZW0sCiAgICAgICAgICAgICAgYW10QWZ0ZXJEaXNjb3VudAogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAodmFsdWUudGF4X2l0ZW0uaGFzT3duUHJvcGVydHkoInRheFR5cGUiKSkgewogICAgICAgICAgICAgIGNvbnN0IHRheFR5cGUgPSB2YWx1ZS50YXhfaXRlbS50YXhUeXBlOwogICAgICAgICAgICAgIGlmICh0YXhUeXBlLmhhc093blByb3BlcnR5KCJ0eXBlSWQiKSkgewogICAgICAgICAgICAgICAgaWYgKHRheFR5cGUudHlwZUlkID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIC8vIFdIRCBUYXgKICAgICAgICAgICAgICAgICAgdGF4QW1vdW50ICo9IC0xOyAvLyBDciBzaWRlCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gR3JvdXAgVGF4J3MgQWNjb3VudAogICAgICAgICAgICAgICAgaWYgKHRheEdyb3Vwc1t2YWx1ZS50YXhfaXRlbS5hY2NvdW50LnV1aWRdKSB7CiAgICAgICAgICAgICAgICAgIHRheEdyb3Vwc1t2YWx1ZS50YXhfaXRlbS5hY2NvdW50LnV1aWRdWyJhbW91bnQiXSArPSB0YXhBbW91bnQ7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0YXhHcm91cHNbdmFsdWUudGF4X2l0ZW0uYWNjb3VudC51dWlkXSA9IHsKICAgICAgICAgICAgICAgICAgICB1dWlkOiBrZW5kby5ndWlkKCksCiAgICAgICAgICAgICAgICAgICAgYW1vdW50OiB0YXhBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogbmV3IEFjY291bnRNb2RlbCh2YWx1ZS50YXhfaXRlbS5hY2NvdW50KSwKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgLy8gRWRpdCBNb2RlCiAgICAgIGlmICh0aGlzLmlzRWRpdCkgewogICAgICAgIHRoaXMuam91cm5hbEVudHJpZXMuZm9yRWFjaCgodmFsdWUpID0+IHsKICAgICAgICAgIC8vIERpc2NvdW50CiAgICAgICAgICBpZiAoZGlzY291bnRHcm91cHNbdmFsdWUuYWNjb3VudC51dWlkXSkgewogICAgICAgICAgICAvLyBTZXQgcHJldmlvdXNlIHV1aWQgaWYgZXhpc3RzCiAgICAgICAgICAgIGRpc2NvdW50R3JvdXBzW3ZhbHVlLmFjY291bnQudXVpZF1bInV1aWQiXSA9IHZhbHVlLnV1aWQ7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gVGF4ZXMKICAgICAgICAgIGlmICh0YXhHcm91cHNbdmFsdWUuYWNjb3VudC51dWlkXSkgewogICAgICAgICAgICAvLyBTZXQgcHJldmlvdXNlIHV1aWQgaWYgZXhpc3RzCiAgICAgICAgICAgIHRheEdyb3Vwc1t2YWx1ZS5hY2NvdW50LnV1aWRdWyJ1dWlkIl0gPSB2YWx1ZS51dWlkOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICAvLyBUYXhlczogUHVyY2hhc2UgVGF4IG9uIERyIGFuZCBXSEQgVGF4IG9uIENyCiAgICAgIGZvciAobGV0IHRheEtleSBpbiB0YXhHcm91cHMpCiAgICAgICAgZW50cmllcy5wdXNoKAogICAgICAgICAgbmV3IEV4cGVuc2VFbnRyeU1vZGVsKHsKICAgICAgICAgICAgdXVpZDogdGF4R3JvdXBzW3RheEtleV0udXVpZCwKICAgICAgICAgICAgYWNjb3VudDogbmV3IEFjY291bnRNb2RlbCh0YXhHcm91cHNbdGF4S2V5XS5hY2NvdW50KSwKICAgICAgICAgICAgcHJpbWFyeV9jb250YWN0OiBuZXcgQ29udGFjdE1vZGVsKHRoaXMuc3VwcGxpZXIpLAogICAgICAgICAgICBzZWNvbmRhcnlfY29udGFjdHM6IFtuZXcgQ29udGFjdE1vZGVsKHRoaXMuZW1wbG95ZWUpXSwKICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuZXhwZW5zZS5qb3VybmFsX25vdGUsCiAgICAgICAgICAgIGN1cnJlbmN5OiBuZXcgQ3VycmVuY3lNb2RlbCh0aGlzLmN1cnJlbmN5KSwKICAgICAgICAgICAgYW1vdW50OiB0YXhHcm91cHNbdGF4S2V5XS5hbW91bnQsCiAgICAgICAgICAgIGV4Y2hhbmdlX3JhdGVfdXVpZDogdGhpcy5leGNoYW5nZVJhdGUuaWQsCiAgICAgICAgICAgIGV4Y2hhbmdlX3JhdGU6IHRoaXMuZXhjaGFuZ2VSYXRlLnJhdGUsCiAgICAgICAgICB9KQogICAgICAgICk7CgogICAgICAvLyBEaXNjb3VudCBBY2NvdW50IG9uIENyCiAgICAgIGZvciAobGV0IGRpc0tleSBpbiBkaXNjb3VudEdyb3VwcykKICAgICAgICBlbnRyaWVzLnB1c2goCiAgICAgICAgICBuZXcgRXhwZW5zZUVudHJ5TW9kZWwoewogICAgICAgICAgICB1dWlkOiBkaXNjb3VudEdyb3Vwc1tkaXNLZXldLnV1aWQsCiAgICAgICAgICAgIGFjY291bnQ6IG5ldyBBY2NvdW50TW9kZWwoZGlzY291bnRHcm91cHNbZGlzS2V5XS5hY2NvdW50KSwKICAgICAgICAgICAgcHJpbWFyeV9jb250YWN0OiBuZXcgQ29udGFjdE1vZGVsKHRoaXMuc3VwcGxpZXIpLAogICAgICAgICAgICBzZWNvbmRhcnlfY29udGFjdHM6IFtuZXcgQ29udGFjdE1vZGVsKHRoaXMuZW1wbG95ZWUpXSwKICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuZXhwZW5zZS5qb3VybmFsX25vdGUsCiAgICAgICAgICAgIGN1cnJlbmN5OiBuZXcgQ3VycmVuY3lNb2RlbCh0aGlzLmN1cnJlbmN5KSwKICAgICAgICAgICAgYW1vdW50OiBkaXNjb3VudEdyb3Vwc1tkaXNLZXldLmFtb3VudCAqIC0xLCAvLyBDciBzaWRlIGlzIG5lZ2F0aXZlCiAgICAgICAgICAgIGV4Y2hhbmdlX3JhdGVfdXVpZDogdGhpcy5leGNoYW5nZVJhdGUuaWQsCiAgICAgICAgICAgIGV4Y2hhbmdlX3JhdGU6IHRoaXMuZXhjaGFuZ2VSYXRlLnJhdGUsCiAgICAgICAgICB9KQogICAgICAgICk7CgogICAgICAvLyBEZXBvc2l0IEFjY291bnQgb24gQ3IKICAgICAgaWYgKHRoaXMuZGVwb3NpdEFtb3VudCA+IDApIHsKICAgICAgICBlbnRyaWVzLnB1c2goCiAgICAgICAgICBuZXcgRXhwZW5zZUVudHJ5TW9kZWwoewogICAgICAgICAgICB1dWlkOiB0aGlzLmRlcG9zaXRFbnRyeVV1aWQsCiAgICAgICAgICAgIGFjY291bnQ6IG5ldyBBY2NvdW50TW9kZWwoCiAgICAgICAgICAgICAgdGhpcy5zdXBwbGllci5hY2NvdW50VGF4LnB1cmNoYXNlRGVwb3NpdEFjYwogICAgICAgICAgICApLAogICAgICAgICAgICBwcmltYXJ5X2NvbnRhY3Q6IG5ldyBDb250YWN0TW9kZWwodGhpcy5zdXBwbGllciksCiAgICAgICAgICAgIHNlY29uZGFyeV9jb250YWN0czogW25ldyBDb250YWN0TW9kZWwodGhpcy5lbXBsb3llZSldLAogICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5leHBlbnNlLmpvdXJuYWxfbm90ZSwKICAgICAgICAgICAgY3VycmVuY3k6IG5ldyBDdXJyZW5jeU1vZGVsKHRoaXMuY3VycmVuY3kpLAogICAgICAgICAgICBhbW91bnQ6IHRoaXMuZGVwb3NpdEFtb3VudCAqIC0xLCAvLyBDciBzaWRlIGlzIG5lZ2F0aXZlCiAgICAgICAgICAgIGV4Y2hhbmdlX3JhdGVfdXVpZDogdGhpcy5leGNoYW5nZVJhdGUuaWQsCiAgICAgICAgICAgIGV4Y2hhbmdlX3JhdGU6IHRoaXMuZXhjaGFuZ2VSYXRlLnJhdGUsCiAgICAgICAgICB9KQogICAgICAgICk7CiAgICAgIH0KCiAgICAgIC8vIFRyYW5zYWN0aW9uIEVudHJpZXMgb24gQ3IKICAgICAgZW50cmllcy5wdXNoKAogICAgICAgIG5ldyBFeHBlbnNlRW50cnlNb2RlbCh7CiAgICAgICAgICB1dWlkOiB0aGlzLnRyYW5zYWN0aW9uRW50cnlVdWlkLAogICAgICAgICAgYWNjb3VudDogbmV3IEFjY291bnRNb2RlbCh0aGlzLnRyYW5zYWN0aW9uQWNjb3VudCksCiAgICAgICAgICBwcmltYXJ5X2NvbnRhY3Q6IG5ldyBDb250YWN0TW9kZWwodGhpcy5zdXBwbGllciksCiAgICAgICAgICBzZWNvbmRhcnlfY29udGFjdHM6IFtuZXcgQ29udGFjdE1vZGVsKHRoaXMuZW1wbG95ZWUpXSwKICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmV4cGVuc2Uuam91cm5hbF9ub3RlLAogICAgICAgICAgY3VycmVuY3k6IG5ldyBDdXJyZW5jeU1vZGVsKHRoaXMuY3VycmVuY3kpLAogICAgICAgICAgYW1vdW50OiB0aGlzLmFtb3VudER1ZSAqIC0xLCAvLyBDciBzaWRlIGlzIG5lZ2F0aXZlCiAgICAgICAgICBleGNoYW5nZV9yYXRlX3V1aWQ6IHRoaXMuZXhjaGFuZ2VSYXRlLmlkLAogICAgICAgICAgZXhjaGFuZ2VfcmF0ZTogdGhpcy5leGNoYW5nZVJhdGUucmF0ZSwKICAgICAgICB9KQogICAgICApOwoKICAgICAgdGhpcy5leHBlbnNlLmV4cGVuc2VfZW50cmllcyA9IGVudHJpZXM7CiAgICAgIC8vIG1hcHBpbmcgdG8gRHluYW1vZGIgKCBleHBlbnNlIHJlY29yZCApIC0+IHNhdmUgZXZlcnl3aGVyZSBtb3JuZyBeX14KICAgICAgdGhpcy5tYXBwaW5nRXhwZW5zZSh0aGlzLmV4cGVuc2UpOwogICAgfSwKICAgIC8vIEFkZCBKb3VybmFsCiAgICBhZGRKb3VybmFsKCkgewogICAgICBsZXQgZW50cmllcyA9IFtdOwoKICAgICAgdGhpcy5leHBlbnNlLmV4cGVuc2VfZW50cmllcy5mb3JFYWNoKCh2YWx1ZSkgPT4gewogICAgICAgIGVudHJpZXMucHVzaChuZXcgSm91cm5hbEVudHJ5TW9kZWwodmFsdWUpKTsKICAgICAgfSk7CgogICAgICAvLyBKb3VybmFsIEVudHJpZXMKICAgICAgdGhpcy5qb3VybmFsRW50cmllcyA9IGVudHJpZXM7CgogICAgICAvLyBKb3VybmFsCiAgICAgIHRoaXMuam91cm5hbC5udW1iZXIgPSB0aGlzLmV4cGVuc2UubnVtYmVyOwogICAgICB0aGlzLmpvdXJuYWwuZGVzY3JpcHRpb24gPSB0aGlzLmV4cGVuc2Uuam91cm5hbF9ub3RlOwogICAgICB0aGlzLmpvdXJuYWwuam91cm5hbF9kYXRlID0gSGVscGVyLnRvSVNPRGF0ZSh0aGlzLmV4cGVuc2UuZXhwZW5zZV9kYXRlKTsKICAgICAgdGhpcy5qb3VybmFsLmpvdXJuYWxfdHlwZSA9IEVudGl0eVR5cGUuQVVUT19KT1VSTkFMOwogICAgICB0aGlzLmpvdXJuYWwudHJhbnNhY3Rpb25fdHlwZSA9IEVudGl0eVR5cGUuRVhQRU5TRVM7CiAgICAgIHRoaXMuam91cm5hbC5yZWxhdGVkX3RyYW5zYWN0aW9uX3V1aWQgPSB0aGlzLmV4cGVuc2UudXNlX2Zvcl90cmFuc2FjdGlvbl91dWlkOwogICAgICB0aGlzLmpvdXJuYWwubW9udGhfb2YgPSB0aGlzLmV4cGVuc2UubW9udGhfb2Y7CiAgICAgIHRoaXMuam91cm5hbC5sb2NhdGlvbl91dWlkID0gdGhpcy5leHBlbnNlLmxvY2F0aW9uX3V1aWQ7CiAgICAgIHRoaXMuam91cm5hbC5wcm9qZWN0X3V1aWQgPSB0aGlzLmV4cGVuc2UucHJvamVjdF91dWlkOwogICAgICB0aGlzLmpvdXJuYWwuc2VnbWVudF91dWlkID0gdGhpcy5leHBlbnNlLnNlZ21lbnRfdXVpZDsKICAgICAgdGhpcy5qb3VybmFsLnByZWZpeF9mb3JtYXQgPSB0aGlzLmV4cGVuc2UucHJlZml4X2Zvcm1hdDsKICAgICAgdGhpcy5qb3VybmFsLmlzX2RyYWZ0ID0gdGhpcy5leHBlbnNlLmlzX2RyYWZ0OwogICAgICB0aGlzLmpvdXJuYWwuY3JlYXRlZF9kYXRlID0gdGhpcy5leHBlbnNlLmNyZWF0ZWRfZGF0ZTsKICAgICAgdGhpcy5qb3VybmFsLmNyZWF0ZWRfYnkgPSB0aGlzLmV4cGVuc2UuY3JlYXRlZF9ieTsKICAgICAgdGhpcy5qb3VybmFsLm1vZGlmaWVkX2J5ID0gdGhpcy5leHBlbnNlLm1vZGlmaWVkX2J5OwogICAgfSwKICAgIC8vIFZhbGlkYXRpbmcKICAgIHZhbGlkYXRlRm9ybSgpIHsKICAgICAgbGV0IHJlc3VsdCA9IHRydWUsCiAgICAgICAgZXhwRFMgPSB0aGlzLiRyZWZzLmV4cGVuc2VBY2NvdW50RFMua2VuZG9XaWRnZXQoKSwKICAgICAgICBtc2cgPSAiIiwKICAgICAgICBjb3VudEV4cGVuc2UgPSAwOwoKICAgICAgLy8gU3VwcGxpZXIKICAgICAgaWYgKHRoaXMuc3VwcGxpZXIuaWQgPT09ICIiKSB7CiAgICAgICAgbXNnICs9IGA8cD4ke2kxOG4udCgic3VwcGxpZXJfaXNfcmVxdWlyZWQiKX08L3A+YDsKICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgLy8gRXhwZW5zZQogICAgICBleHBEUy5kYXRhKCkuZm9yRWFjaCgodmFsdWUsIGluZGV4KSA9PiB7CiAgICAgICAgLy8gTm8gYWNjb3VudAogICAgICAgIGlmICh2YWx1ZS5hY2NvdW50Lm5hbWUgPT09ICIiICYmIHZhbHVlLmFtb3VudCA+IDApIHsKICAgICAgICAgIHJlc3VsdCA9IGZhbHNlOwogICAgICAgICAgbXNnICs9IGA8cD4ke2kxOG4udCgKICAgICAgICAgICAgInBsZWFzZV9zZWxlY3RfZXhwZW5zZV9hY2NvdW50X2F0X3Jvd19udW1iZXIiCiAgICAgICAgICApfSAke2luZGV4ICsgMX08L3A+YDsKICAgICAgICB9CgogICAgICAgIC8vIE5vIGFtb3VudAogICAgICAgIGlmICh2YWx1ZS5hY2NvdW50Lm5hbWUgIT09ICIiICYmIHZhbHVlLmFtb3VudCA9PT0gMCkgewogICAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICBtc2cgKz0gYDxwPiR7dmFsdWUuYWNjb3VudC5uYW1lfSAke2kxOG4udCgiaGFzX25vX2Ftb3VudCIpfTwvcD5gOwogICAgICAgIH0KCiAgICAgICAgLy8gRGlzY291bnQKICAgICAgICBpZiAodmFsdWUuZGlzY291bnQuaWQgIT09ICIiKSB7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIHZhbHVlLmRpc2NvdW50LmFjY291bnQudXVpZCA9PT0gIiIgfHwKICAgICAgICAgICAgdmFsdWUuZGlzY291bnQuYWNjb3VudC5hY2NvdW50X3R5cGUubnVtYmVyID09PSAwCiAgICAgICAgICApIHsKICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICAgIG1zZyArPSBgPHA+JHtpMThuLnQoCiAgICAgICAgICAgICAgImludmFsaWRfZGlzY291bnRfYWNjb3VudF9hdF9yb3dfbnVtYmVyIgogICAgICAgICAgICApfSAke2luZGV4ICsgMX08L3A+YDsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFRheAogICAgICAgIGlmICh2YWx1ZS50YXhfaXRlbS5pZCAhPT0gIiIpIHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgdmFsdWUudGF4X2l0ZW0uYWNjb3VudC51dWlkID09PSAiIiB8fAogICAgICAgICAgICB2YWx1ZS50YXhfaXRlbS5hY2NvdW50LmFjY291bnRfdHlwZS5udW1iZXIgPT09IDAKICAgICAgICAgICkgewogICAgICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgICAgICAgbXNnICs9IGA8cD4ke2kxOG4udCgiaW52YWxpZF90YXhfYWNjb3VudF9hdF9yb3dfbnVtYmVyIil9ICR7aW5kZXggKwogICAgICAgICAgICAgIDF9PC9wPmA7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBDb3VudCBFbXB0eSBSb3cKICAgICAgICBpZiAodmFsdWUuYWNjb3VudC5uYW1lICE9PSAiIiAmJiB2YWx1ZS5hbW91bnQgPiAwKSB7CiAgICAgICAgICBjb3VudEV4cGVuc2UrKzsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgLy8gRW1wdHkgUm93CiAgICAgIGlmIChjb3VudEV4cGVuc2UgPT09IDApIHsKICAgICAgICBtc2cgKz0gYDxwPiR7aTE4bi50KCJwbGVhc2Vfc2VsZWN0X2V4cGVuc2VfYWNjb3VudCIpfTwvcD5gOwogICAgICAgIHJlc3VsdCA9IGZhbHNlOwogICAgICB9CgogICAgICAvLyBUcmFuc2FjdGlvbiBBY2NvdW50CiAgICAgIGlmICh0aGlzLnRyYW5zYWN0aW9uQWNjb3VudC51dWlkID09PSAiIikgewogICAgICAgIG1zZyArPSBgPHA+JHtpMThuLnQoInBsZWFzZV9zZWxlY3RfdHJhbnNhY3Rpb25fYWNjb3VudCIpfTwvcD5gOwogICAgICAgIHJlc3VsdCA9IGZhbHNlOwogICAgICB9CgogICAgICAvLyBVc2UgZm9yIENhc2ggQWR2YW5jZQogICAgICBpZiAoCiAgICAgICAgdGhpcy5leHBlbnNlLnVzZV9mb3Jfb3B0aW9uID09PSAyICYmCiAgICAgICAgdGhpcy5leHBlbnNlLnVzZV9mb3JfdHJhbnNhY3Rpb25fdXVpZCA9PT0gIiIKICAgICAgKSB7CiAgICAgICAgbXNnICs9IGA8cD4ke2kxOG4udCgicGxlYXNlX3NlbGVjdF9yZWxhdGVkX2Nhc2hfYWR2YW5jZSIpfTwvcD5gOwogICAgICAgIHJlc3VsdCA9IGZhbHNlOwogICAgICB9CgogICAgICAvLyBTaG93IEFsZXJ0CiAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gbXNnOwoKICAgICAgdGhpcy5hbGVydCA9IHJlc3VsdCA9PT0gZmFsc2U7CgogICAgICByZXR1cm4gcmVzdWx0OwogICAgfSwKICAgIC8vIEFsbCBTYXZlcwogICAgYXN5bmMgb25TYXZlT3B0aW9uQ2xpY2sobW9kZSkgewogICAgICBpZiAodGhpcy4kcmVmcy5mb3JtLnZhbGlkYXRlKCkgJiYgdGhpcy52YWxpZGF0ZUZvcm0oKSkgewogICAgICAgIGxldCBpc1ZhbGlkQ2xvc2luZ0RhdGUgPSBhd2FpdCBIZWxwZXIudmFsaWRhdGVDbG9zaW5nRGF0ZSgKICAgICAgICAgIHRoaXMuZXhwZW5zZS5leHBlbnNlX2RhdGUKICAgICAgICApOwogICAgICAgIGlmIChpc1ZhbGlkQ2xvc2luZ0RhdGUpIHsKICAgICAgICAgIHRoaXMuc2F2ZU1vZGUgPSBtb2RlOwogICAgICAgICAgdGhpcy5zYXZlKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgY2FuY2VsKCkgewogICAgICB0aGlzLiRzd2FsKHsKICAgICAgICB0aXRsZTogaTE4bi50KCJtc2dfdGl0bGVfd2FybmluZyIpLAogICAgICAgIHRleHQ6IGkxOG4udCgibXNnX2Rpc2NhcmQiKSwKICAgICAgICBpY29uOiAid2FybmluZyIsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBpMThuLnQoImNhbmNlbCIpLAogICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiM0ZDQ4NDgiLAogICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI0VEMUEzQSIsCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IGkxOG4udCgiZGlzY2FyZCIpLAogICAgICB9KS50aGVuKChyZXN1bHQpID0+IHsKICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICB0aGlzLmNsZWFyKCk7CiAgICAgICAgICB0aGlzLnNldERlZmF1bHREYXRhKCk7CiAgICAgICAgICB0aGlzLiRyb3V0ZXIuZ28oLTEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgY2xlYXIoKSB7CiAgICAgIC8vIFJlc2V0IEZvcm0KICAgICAgdGhpcy5pc0VkaXQgPSBmYWxzZTsKICAgICAgdGhpcy5zYXZlTW9kZSA9ICIiOwoKICAgICAgLy8gRW50cnkgVXVpZAogICAgICB0aGlzLmRlcG9zaXRFbnRyeVV1aWQgPSBrZW5kby5ndWlkKCk7CiAgICAgIHRoaXMudHJhbnNhY3Rpb25FbnRyeVV1aWQgPSBrZW5kby5ndWlkKCk7CgogICAgICB0aGlzLnN1YlRvdGFsID0gMDsKICAgICAgdGhpcy5kaXNjb3VudEFtb3VudCA9IDA7CiAgICAgIHRoaXMucHVyY2hhc2VUYXggPSAwOwogICAgICB0aGlzLndoZFRheCA9IDA7CiAgICAgIHRoaXMudG90YWxBbW91bnQgPSAwOwogICAgICB0aGlzLnN1cHBsaWVyRGVwb3NpdEFtb3VudCA9IDA7CiAgICAgIHRoaXMuZGVwb3NpdEFtb3VudCA9IDA7CiAgICAgIHRoaXMuYW1vdW50RHVlID0gMDsKICAgICAgdGhpcy5oYXNBZGRpdGlvbmFsQ29zdCA9IGZhbHNlOwoKICAgICAgdGhpcy5leHBlbnNlID0gbmV3IEV4cGVuc2VNb2RlbCgpOwogICAgICB0aGlzLmpvdXJuYWwgPSBuZXcgSm91cm5hbE1vZGVsKCk7CiAgICAgIHRoaXMuam91cm5hbEVudHJpZXMgPSBbXTsKICAgICAgdGhpcy5lbXBsb3llZSA9IG5ldyBFbXBsb3llZU1vZGVsKCk7CiAgICAgIHRoaXMuc3VwcGxpZXIgPSBuZXcgU3VwcGxpZXJNb2RlbCgpOwogICAgICB0aGlzLnBheW1lbnRUZXJtID0gbmV3IFBheW1lbnRUZXJtTW9kZWwoKTsKICAgICAgdGhpcy5jdXJyZW5jeSA9IG5ldyBDdXJyZW5jeU1vZGVsKGluc3RpdHV0ZS5iYXNlQ3VycmVuY3kpOwogICAgICB0aGlzLmV4Y2hhbmdlUmF0ZSA9IG5ldyBFeGNoYW5nZVJhdGVNb2RlbChpbnN0aXR1dGUuYmFzZUN1cnJlbmN5KTsKICAgICAgdGhpcy5hZHZhbmNlU2V0dGxlbWVudENsZWFyaW5nQWNjb3VudCA9IG5ldyBBY2NvdW50TW9kZWwoKTsKICAgICAgdGhpcy50cmFuc2FjdGlvbkFjY291bnQgPSBuZXcgQWNjb3VudE1vZGVsKCk7CiAgICAgIHRoaXMubG9jYXRpb24gPSBuZXcgTG9jYXRpb25Nb2RlbCgpOwogICAgICB0aGlzLnNlZ21lbnQgPSBuZXcgU2VnbWVudE1vZGVsKCk7CiAgICAgIHRoaXMucHJvamVjdCA9IG5ldyBQcm9qZWN0TW9kZWwoKTsKCiAgICAgIGxldCBleHBEUyA9IHRoaXMuJHJlZnMuZXhwZW5zZUFjY291bnREUy5rZW5kb1dpZGdldCgpOwogICAgICBleHBEUy5kYXRhKFtdKTsKICAgIH0sCiAgICBzYXZlKCkgewogICAgICBsZXQgc2VsZiA9IHRoaXM7CgogICAgICAvLyBEcmFmdCBNb2RlCiAgICAgIGlmICh0aGlzLnNhdmVNb2RlID09PSBTYXZlT3B0aW9uLlNBVkVEUkFGVCkgewogICAgICAgIHRoaXMuZXhwZW5zZS5pc19kcmFmdCA9IDE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5leHBlbnNlLmlzX2RyYWZ0ID0gMDsKICAgICAgfQoKICAgICAgLy8gU2hyaW5rIERhdGEKICAgICAgdGhpcy5zaHJpbmtEYXRhKCk7CgogICAgICAvLyBBZGQgSm91cm5hbAogICAgICB0aGlzLmFkZEpvdXJuYWwoKTsKCiAgICAgIC8vIFN5bmMgRGF0YQogICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgZXhwZW5zZUhhbmRsZXIKICAgICAgICAuc2F2ZSh7CiAgICAgICAgICBleHBlbnNlOiBuZXcgRXhwZW5zZU1vZGVsKHRoaXMuZXhwZW5zZSksCiAgICAgICAgICBqb3VybmFsOiBuZXcgSm91cm5hbE1vZGVsKHRoaXMuam91cm5hbCksCiAgICAgICAgICBqb3VybmFsX2VudHJpZXM6IHRoaXMuam91cm5hbEVudHJpZXMsCiAgICAgICAgfSkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZSkgewogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2cocmVzcG9uc2UsICJyZXNwb25zZSIsIHJlc3BvbnNlLmRhdGEudXVpZCk7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnV1aWQpIHsKICAgICAgICAgICAgICB0aGlzLnNhdmVUeG5FeHBlbnNlKAogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS51dWlkLAogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5qb3VybmFsX3V1aWQKICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlbGYucmVzcG9uc2VTdGF0dXMocmVzcG9uc2Uuc3RhdHVzKTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIEhlbHBlci5hbGVydEVycm9yTXNnKGVycm9yKTsKICAgICAgICB9KQogICAgICAgIC5maW5hbGx5KCgpID0+IHsKICAgICAgICAgIHNlbGYuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICAvLyBSZXNwb25zZSBTdGF0dXMKICAgIHJlc3BvbnNlU3RhdHVzKHN0YXR1cykgewogICAgICBzd2l0Y2ggKHN0YXR1cykgewogICAgICAgIGNhc2UgMjAwOiAvLyBPawogICAgICAgICAgdGhpcy5zaG93QWxlcnQoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjAxOiAvLyBEdXBsaWNhdGUKICAgICAgICAgIEhlbHBlci5hbGVydEVycm9yTXNnKCJEdXBsaWNhdGUgZW50cnkhIik7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0sCiAgICAvLyBTd2VldGFsZXJ0MgogICAgY2hhbmdlQWxlcnRTdGF0dXMoKSB7CiAgICAgIHRoaXMubG9hZGluZ0FsZXJ0ID0gdHJ1ZTsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgdGhpcy5sb2FkaW5nQWxlcnQgPSBmYWxzZTsKICAgICAgfSwgNjIwMCk7CiAgICB9LAogICAgc2hvd0FsZXJ0KCkgewogICAgICB0aGlzLmNoYW5nZUFsZXJ0U3RhdHVzKCk7CiAgICAgIHRoaXMubG9hZGluZ1RleHRBbGVydCA9ICJBZGRlZCBTdWNjZXNzZnVsIjsKICAgICAgdGhpcy5sb2FkaW5nQ29sb3JBbGVydCA9ICIjM0RBNzJFIjsKICAgICAgc3dpdGNoICh0aGlzLnNhdmVNb2RlKSB7CiAgICAgICAgY2FzZSAic2F2ZUNsb3NlIjogLy8gU2F2ZSBDbG9zZQogICAgICAgICAgLy8gdGhpcy4kc3dhbCh7CiAgICAgICAgICAvLyAJcG9zaXRpb246ICdwcm9kdWN0cycsCiAgICAgICAgICAvLyAJaWNvbjogJ3N1Y2Nlc3MnLAogICAgICAgICAgLy8gCXRpdGxlOiAnWW91ciB3b3JrIGhhcyBiZWVuIHNhdmVkJywKICAgICAgICAgIC8vIAlzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgIC8vIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgLy8gCWlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgIC8vIAkJd2luZG93Lmhpc3RvcnkuZ28oLTEpCgogICAgICAgICAgLy8gCQlyZXR1cm4gZmFsc2UKICAgICAgICAgIC8vIAl9CiAgICAgICAgICAvLyB9KQogICAgICAgICAgaWYgKHRoaXMuaXNFZGl0KSB7CiAgICAgICAgICAgIHRoaXMuZ29CYWNrVG9WaWV3UGFnZSgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy4kcm91dGVyLmdvKC0xKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmNsZWFyKCk7CiAgICAgICAgICB0aGlzLnNldERlZmF1bHREYXRhKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgLy8gU2F2ZSBOZXcKICAgICAgICAgIC8vIHRoaXMuJHN3YWwoewogICAgICAgICAgLy8gCXBvc2l0aW9uOiAncHJvZHVjdHMnLAogICAgICAgICAgLy8gCWljb246ICdzdWNjZXNzJywKICAgICAgICAgIC8vIAl0aXRsZTogJ1lvdXIgd29yayBoYXMgYmVlbiBzYXZlZCcsCiAgICAgICAgICAvLyAJc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgLy8gCXRpbWVyOiAxNTAwCiAgICAgICAgICAvLyB9KQogICAgICAgICAgdGhpcy5jbGVhcigpOwogICAgICAgICAgdGhpcy5zZXREZWZhdWx0RGF0YSgpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0sCiAgICAvLyBHbyBiYWNrIHRvIHZpZXcgcGFnZSBhZnRlciBlZGl0IG1vZGUKICAgIGdldEV4cGVuc2UoKSB7CiAgICAgIHJldHVybiBuZXcgRXhwZW5zZU1vZGVsKHRoaXMuZXhwZW5zZSk7CiAgICB9LAogICAgZ29CYWNrVG9WaWV3UGFnZSgpIHsKICAgICAgdGhpcy4kcm91dGVyLnJlcGxhY2UoewogICAgICAgIG5hbWU6ICJFeHBlbnNlcyBWaWV3IiwKICAgICAgICBwYXJhbXM6IHsgaW5pdEV4cGVuc2U6IHRoaXMuZ2V0RXhwZW5zZSgpIH0sCiAgICAgIH0pOwogICAgfSwKICAgIEhpZGVTbWFsbFNpZGVCYXIoKSB7CiAgICAgIHRoaXMuaXNIaWRlQmFyID0gIXRoaXMuaXNIaWRlQmFyOwogICAgfSwKICB9LAogIHdhdGNoOiB7CiAgICBpbml0RXhwZW5zZSgpIHsKICAgICAgdGhpcy5pbml0aWFsRGF0YSgpOwogICAgfSwKICB9LAogIGNyZWF0ZWQoKSB7CiAgICAvLyBDYWxsIEFjY291bnQgTGlzdAogICAgYWNjb3VudEhhbmRsZXIuZ2V0QWxsKCkudGhlbigocmVzKSA9PiB7CiAgICAgIHRoaXMuYWNjb3VudHMgPSByZXMuZGF0YTsKICAgICAgdGhpcy5leHBlbnNlQWNjb3VudHMgPSByZXMuZGF0YTsKCiAgICAgIC8vIEFkdmFuY2UgU2V0dGxlbWVudCBDbGVhcmluZyBBY2NvdW50IGJ5IGJhbmhqaV9hY2NvdW50X251bWJlcgogICAgICBsZXQgYWR2U2V0Q2xyQWNjID0gcmVzLmRhdGEuZmluZCgKICAgICAgICAodmFsdWUpID0+CiAgICAgICAgICB2YWx1ZS5udW1iZXIgPT09IEFjY291bnRUeXBlQ29kZS5BRFZBTkNFX1NFVFRMRU1FTlRfQ0xFQVJJTkdfQ09ERQogICAgICApOyAvLyBXaWxsIGNoYW5nZSBsYXRlcgogICAgICB0aGlzLmFkdmFuY2VTZXR0bGVtZW50Q2xlYXJpbmdBY2NvdW50ID0gbmV3IEFjY291bnRNb2RlbChhZHZTZXRDbHJBY2MpOwoKICAgICAgLy8gT3RoZXIgQ2xlYXJpbmcgU3VzcGVuc2VzIEFjY291bnQgYnkgYmFuaGppX2FjY291bnRfbnVtYmVyCiAgICAgIGxldCBvdGhlckNsclN1c0FjYyA9IHJlcy5kYXRhLmZpbmQoCiAgICAgICAgKHZhbHVlKSA9PgogICAgICAgICAgdmFsdWUubnVtYmVyID09PSBBY2NvdW50VHlwZUNvZGUuT1RIRVJfQ0xFQVJJTkdfU1VTUEVOU0VTX0NPREUKICAgICAgKTsgLy8gV2lsbCBjaGFuZ2UgbGF0ZXIKICAgICAgdGhpcy5vdGhlckNsZWFyaW5nU3VzcGVuc2VBY2NvdW50ID0gbmV3IEFjY291bnRNb2RlbChvdGhlckNsclN1c0FjYyk7CgogICAgICAvLyBGaWx0ZXIgVHJhbnNhY3Rpb24gQWNjb3VudHMKICAgICAgdGhpcy5maWx0ZXJUcmFuc2FjdGlvbkFjY291bnQoKTsKICAgIH0pOwogIH0sCiAgbW91bnRlZDogYXN5bmMgZnVuY3Rpb24oKSB7CiAgICAvLyBTdXBwbGllciBTZXR0aW5nIHN1Y2ggYXMgZGVjaW1hbCBmb3JtYXQKICAgIGF3YWl0IHRoaXMubG9hZFB1cmNoYXNlRm9ybUNvbnRlbnQoKTsKCiAgICAvLyBJbml0aWFsIERhdGEKICAgIHRoaXMuaW5pdGlhbERhdGEoKTsKICB9LAp9Owo="},{"version":3,"sources":["InsurancePurchase.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0cA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"InsurancePurchase.vue","sourceRoot":"src/views/insurance","sourcesContent":["<template>\n  <v-app>\n    <v-container>\n      <v-row>\n        <v-col sm=\"12\" cols=\"12\">\n          <v-card\n            outlined\n            dense\n            class=\"pa-4 no_border rounded-sm\"\n            color=\"white\"\n          >\n            <v-row>\n              <v-col\n                class=\"bigSide py-0 pr-1\"\n                sm=\"8\"\n                cols=\"12\"\n                style=\"transition: 0.3s ease-in\"\n                :class=\"{ hide_big_bar_class: isHideBar }\"\n              >\n                <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                  <v-card outlined dense class=\"no_border\">\n                    <h2 class=\"mb-0\">\n                      {{ $t(\"insurance_purchase\") }}\n                    </h2>\n\n                    <v-icon\n                      v-if=\"isHideBar\"\n                      onclick=\"window.history.go(-1); return false;\"\n                      style=\"\n                            cursor: pointer;\n                            color: #333;\n                            font-size: 40px;\n                                            \"\n                      class=\"float-right\"\n                      >close\n                    </v-icon>\n                    <span\n                      style=\"\n                                transition: 0.3s ease-in;\n                                z-index: 10;\n                            \"\n                      :class=\"{\n                        iconArrow: !isHideBar,\n                        iconArrowHide: isHideBar,\n                      }\"\n                    >\n                      <v-icon\n                        size=\"22\"\n                        class=\"arr_icon\"\n                        @click=\"HideSmallSideBar\"\n                        v-if=\"isHideBar\"\n                      >\n                        mdi-chevron-left-circle\n                      </v-icon>\n                      <v-icon\n                        size=\"22\"\n                        class=\"arr_icon\"\n                        @click=\"HideSmallSideBar\"\n                        v-if=\"!isHideBar\"\n                      >\n                        mdi-chevron-right-circle\n                      </v-icon>\n                    </span>\n                  </v-card>\n                  <v-card outlined dense class=\"px-1 no_border\" >\n                    <v-row>\n                      <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                        <label class=\"label\">{{ $t(\"vendors\") }}</label>\n                        <v-select outlined class=\"mt-1\" />\n\n                        <label class=\"label\" style=\"\">{{ $t(\"date\") }}</label>\n                        <app-datepicker\n                          :initialDate=\"expense.expense_date\"\n                          @emitDate=\"expense.expense_date = $event\"\n                          @onChanged=\"getExchangeRate\"\n                        />\n                        <label class=\"label\">{{ $t(\"number\") }}</label>\n                        <v-row class=\"mt-1 mr-0\">\n                          <v-col sm=\"3\" cols=\"2\" class=\"pt-0 pr-0\">\n                            <div class=\"code_text text-bold\">\n                                BIL\n                            </div>\n                          </v-col>\n                          <v-col sm=\"7\" cols=\"8\" class=\"py-0 pl-0 pr-0 pr-1\">\n                            <v-text-field\n                              :rules=\"[(v) => !!v || 'Number is required']\"\n                              v-model=\"expense.number\"\n                              class=\"custom-border\"\n                              outlined\n                              readonly\n                              required\n                            />\n                          </v-col>\n                          <v-col sm=\"2\" cols=\"2\" class=\"py-0 px-0\">\n                            <v-icon\n                              color=\"black\"\n                              size=\"30\"\n                              class=\"border_qrcode\"\n                              @click=\"generateNumber\"\n                              >mdi-qrcode\n                            </v-icon>\n                          </v-col>\n                        </v-row>\n                      </v-col>\n                      <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                        <label class=\"label\">{{\n                          $t(\"vendors_invoice_no\")\n                        }}</label>\n                        <v-text-field outlined class=\"mt-1\" />\n\n                        <label class=\"label\" style=\"\">{{ $t(\"term\") }}</label>\n                        <v-select outlined class=\"mt-1\" />\n\n                        <label class=\"label\">{{ $t(\"payable_account\") }}</label>\n                        <v-select outlined class=\"mt-1\" />\n                      </v-col>\n                      <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                        <label class=\"label\">{{ $t(\"invoice_number\") }}</label>\n                        <v-text-field outlined class=\"mt-1\" />\n\n                        <label class=\"label\" style=\"\">{{\n                          $t(\"due_date\")\n                        }}</label>\n                        <app-datepicker\n                          :initialDate=\"expense.expense_date\"\n                          @emitDate=\"expense.expense_date = $event\"\n                          @onChanged=\"getExchangeRate\"\n                        />\n                        <label class=\"label\">{{ $t(\"bill_currency\") }}</label>\n                        <v-select outlined class=\"mt-1\" placeholder=\"USD\" />\n                      </v-col>\n                    </v-row>\n                    <v-row>\n                      <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                        <kendo-datasource\n                          ref=\"expenseAccountDS\"\n                          :data=\"expenseEntries\"\n                          :change=\"onExpenseAccountDSChanges\"\n                        />\n                        <kendo-grid\n                          id=\"expenseGrid\"\n                          ref=\"expenseGrid\"\n                          class=\"grid-function\"\n                          :data-source-ref=\"'expenseAccountDS'\"\n                          :sortable=\"false\"\n                          :filterable=\"false\"\n                          :column-menu=\"true\"\n                          :editable=\"true\"\n                          :scrollable-virtual=\"true\"\n                        >\n                          <kendo-grid-column\n                            :title=\"$t('type_of_insurance')\"\n                            :template=\"rowNumberTmpl\"\n                            :width=\"120\"\n                            :column-menu=\"false\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5;',\n                              class: 'text-products',\n                            }\"\n                            :attributes=\"{\n                              style: 'text-align: products',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'account'\"\n                            :title=\"$t('policy_no')\"\n                            :width=\"200\"\n                            :template=\"'<span>#=account.name||``#</span>'\"\n                            :editor=\"expenseAccountEditor\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'description'\"\n                            :title=\"$t('account')\"\n                            :width=\"200\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'quantity'\"\n                            :title=\"$t('description')\"\n                            :width=\"160\"\n                            :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'uom'\"\n                            :title=\"$t('qty')\"\n                            :editor=\"UomEditor\"\n                            :template=\"'<span>#=uom.name||``#</span>'\"\n                            :width=\"150\"\n                            :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                            :attributes=\"{\n                              style: 'text-align: right;',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'price'\"\n                            :title=\"$t('price')\"\n                            :width=\"150\"\n                            :editor=\"numberEditor\"\n                            :template=\"\n                              '<span>#=kendo.toString(price, decimalFormat)#</span>'\n                            \"\n                            :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                            :attributes=\"{\n                              style: 'text-align: right',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'amount'\"\n                            :title=\"$t('amount')\"\n                            :width=\"150\"\n                            :editable=\"\n                              () => {\n                                return false;\n                              }\n                            \"\n                            :editor=\"numberEditor\"\n                            :template=\"\n                              '<span>#=kendo.toString(amount, decimalFormat)#</span>'\n                            \"\n                            :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                            :attributes=\"{\n                              style: 'text-align: right',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'discount'\"\n                            :title=\"$t('discount')\"\n                            :template=\"'<span>#=discount.name||``#</span>'\"\n                            :editor=\"PurchaseDiscountItemEditor\"\n                            :width=\"150\"\n                            :hidden=\"!purchaseFormContent.discountItem\"\n                            :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                            :attributes=\"{\n                              style: 'text-align: right',\n                            }\"\n                          />\n                          <kendo-grid-column\n                            :field=\"'tax_item'\"\n                            :title=\"$t('tax')\"\n                            :template=\"\n                              '<span>#=tax_item.defaultTax||``#</span>'\n                            \"\n                            :editor=\"PurchaseTaxEditor\"\n                            :width=\"150\"\n                            :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                            :attributes=\"{\n                              style: 'text-align: right',\n                            }\"\n                          />\n                  \n                          <kendo-grid-column\n                            :command=\"{\n                              iconClass: 'k-icon k-i-trash',\n                              text: 'Delete',\n                              click: removeRow,\n                              class: 'btn-plus',\n                            }\"\n                            :title=\"'&nbsp;'\"\n                            :width=\"100\"\n                            :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                          />\n                        </kendo-grid>\n                      </v-col>\n                      <v-col sm=\"12\" cols=\"12\" class=\"py-0 pb-3\">\n                        <v-row>\n                          <v-col sm=\"9\" cols=\"12\" class=\"py-0\">\n                            <v-btn\n                              color=\"primary\"\n                              class=\"float-left mt-2 btn_plus rounded-0 white--text mr-2\"\n                              @click=\"addRow\"\n                            >\n                              <v-icon size=\"\" class=\"ma-1\">mdi-plus </v-icon>\n                            </v-btn>\n                          </v-col>\n                        </v-row>\n                      </v-col>\n                    </v-row>\n                  </v-card>\n                  <v-divider />\n                  <v-card outlined dense class=\"no_border function_footer\">\n                    <v-menu>\n                      <template v-slot:activator=\"{ on }\">\n                        <v-btn\n                          color=\"black\"\n                          outlined\n                          class=\"mr-2 text-capitalize  black--text float-left\"\n                          v-on=\"on\"\n                        >\n                          {{ $t(\"select_template\") }}\n                          <v-icon size=\"\" class=\"ma-1\">expand_more </v-icon>\n                        </v-btn>\n                      </template>\n                      <v-list>\n                        <v-list-item\n                          v-for=\"(item, index) in templates\"\n                          :key=\"index\"\n                        >\n                          <v-list-item-title\n                            >{{ item.title }}\n                          </v-list-item-title>\n                        </v-list-item>\n                      </v-list>\n                    </v-menu>\n                    <v-btn\n                      color=\"black\"\n                      class=\"text-capitalize  white--text float-left\"\n                      @click=\"cancel\"\n                      >{{ $t(\"cancel\") }}\n                    </v-btn>\n                    <v-menu>\n                      <template v-slot:activator=\"{ on }\">\n                        <v-btn\n                          color=\"primary\"\n                          class=\"ml-2 float-right text-capitalize  white--text\"\n                          v-on=\"on\"\n                        >\n                          {{ $t(\"save_option\") }}\n                          <v-icon size=\"\" class=\"ma-1\">expand_more </v-icon>\n                        </v-btn>\n                      </template>\n                      <v-list rounded>\n                        <v-list-item-group>\n                          <v-list-item v-if=\"!isEdit\">\n                            <v-list-item-content>\n                              <v-list-item-title\n                                @click=\"onSaveOptionClick(SaveOption.SAVEDRAFT)\"\n                              >\n                                {{ $t(\"save_close\") }}\n                              </v-list-item-title>\n                            </v-list-item-content>\n                          </v-list-item>\n                          <v-list-item v-if=\"!isEdit\">\n                            <v-list-item-content>\n                              <v-list-item-title\n                                @click=\"onSaveOptionClick(SaveOption.SAVENEW)\"\n                              >\n                                {{ $t(\"save_new\") }}\n                              </v-list-item-title>\n                            </v-list-item-content>\n                          </v-list-item>\n                          <v-list-item>\n                            <v-list-item-content>\n                              <v-list-item-title\n                                @click=\"onSaveOptionClick(SaveOption.SAVEPRINT)\"\n                              >\n                                {{ $t(\"save_print\") }}\n                              </v-list-item-title>\n                            </v-list-item-content>\n                          </v-list-item>\n                        </v-list-item-group>\n                      </v-list>\n                    </v-menu>\n                    <v-btn\n                      color=\"secondary\"\n                      class=\"float-right white--text text-capitalize \"\n                      @click=\"onSaveOptionClick(SaveOption.SAVECLOSE)\"\n                    >\n                      {{ $t(\"save_close\") }}\n                    </v-btn>\n                  </v-card>\n                </v-form>\n              </v-col>\n              <v-col\n                class=\"smallSide\"\n                sm=\"4\"\n                style=\"transition: 0.3s ease-in\"\n                :class=\"{ hide_small_bar_class: isHideBar }\"\n              >\n                <h3\n                  style=\"color: #b3b5bc; font-size: 20px\"\n                  v-if=\"!isHideBar\"\n                  class=\"text-uppercase float-right mt-n3\"\n                >\n                  <span class=\"pointer\" @click=\"Help('insurance purchase')\">\n                    {{ $t(\"help\") }}\n                  </span>\n                  <v-icon\n                    onclick=\"window.history.go(-1); return false;\"\n                    style=\"\n                                            cursor: pointer;\n                                            color: #333;\n                                            font-size: 40px;\n                                        \"\n                    class=\"float-right mt-n1\"\n                    >close\n                  </v-icon>\n                </h3>\n\n                <div v-if=\"!isHideBar\" class=\"small_sidebar mt-9 px-4 grayBg\">\n                   <v-card class=\"pa-3 no-boxshadow d-flex justify-space-between align-center\"\n                          min-height=\"50px\" color=\"primary\">\n                    <h3 style=\"font-size: 16px\" class=\"text-white text-uppercase\">\n                      {{ $t('expense_amount') }}</h3>\n                    <h3 class=\"text-bold float-right text-white mt-1\" style=\"font-size: 20px\">\n                      10,000,000</h3>\n                  </v-card>\n                  <v-row>\n                    <v-col sm=\"12\" cols=\"12\" class=\"pb-0 pt-2\">\n                      <h4 class=\"text-uppercase\">\n                        {{ $t(\"analysis\") }}\n                      </h4>\n                      <label class=\"label\">{{ $t(\"segment\") }}</label>\n                      <app-segment-dropdownlist\n\n                        :initSegment=\"segment\"\n                        @emitSegment=\"segment = $event\"\n                      />\n                      <label class=\"label\">{{ $t(\"for_the_month_of\") }}</label>\n                      <app-monthof-picker\n                        :initMonthOf=\"expense.month_of\"\n                        @emitMonthOf=\"expense.month_of = $event\"\n                      />\n                    </v-col>\n                  </v-row>\n                </div>\n              </v-col>\n            </v-row>\n          </v-card>\n        </v-col>\n      </v-row>\n      <LoadingMe\n        :isLoading=\"showLoading\"\n        :fullPage=\"true\"\n        :myLoading=\"true\"\n        :alertMessage=\"loadingAlert\"\n        :color=\"loadingColorAlert\"\n        :alertText=\"loadingTextAlert\"\n      />\n    </v-container>\n  </v-app>\n</template>\n\n<script>\nimport { i18n } from \"@/i18n\";\nimport kendo from \"@progress/kendo-ui\";\nimport Helper from \"@/helper.js\";\n\nconst purchaseFormContentHandler = require(\"@/scripts/purchaseFormContentHandler\");\nconst billingHandler = require(\"@/scripts/invoice/handler/billingHandler\");\nimport {\n  ExpenseModel,\n  ExpenseEntryModel,\n  ExpenseEntryExtendedModel,\n  JournalModel,\n  JournalEntryModel,\n  AccountModel,\n  CurrencyModel,\n  ExchangeRateModel,\n  PaymentTermModel,\n  SupplierModel,\n  EmployeeModel,\n  ContactModel,\n  ClassModel,\n  UomModel,\n  LocationModel,\n  SegmentModel,\n  ProjectModel,\n  DiscountItemModel,\n  TaxModel,\n  Expenses,\n  PurchaseFormContent,\n} from \"@/scripts/model/AppModels\";\nimport { ShowResource } from \"@/observable/store\";\n\nconst $ = require(\"jquery\");\n\n/* Store */\nimport store from \"@/store\"\nconst institute = store.state.institute.institute\n\nconst {\n  expenseHandler,\n  cashAdvanceHandler,\n  accountHandler,\n  journalHandler,\n  discountItemHandler,\n  taxHandler,\n  uomHandler,\n  classHandler,\n} = require(\"@/scripts/AppHandlers\");\nconst {\n  AccountEditor,\n  ClassEditor,\n  UomEditor,\n  // BillableEditor,\n  PurchaseDiscountItemEditor,\n  PaymentMethodEditor,\n  PurchaseTaxEditor,\n  // MarkupEditor,\n} = require(\"@/scripts/kendo_editor/Collections\");\nconst {\n  EntityType,\n  SaveOption,\n  AccountTypeCode,\n} = require(\"@/scripts/default_setup/Collections\");\nconst PAYMENT_TERM_TYPE = \"pmt-supplier\";\nconst DISCOUNT_ITEM_TYPE = \"?type=Purchase\";\n// const PAYMENT_METHOD_AS = '?optionType=Supplier'\nexport default {\n  name: \"Expense\",\n  components: {\n    LoadingMe: () => import(\"@/components/Loading\"),\n    \"app-datepicker\": () =>\n      import(\"@/components/custom_templates/DatePickerComponent\"),\n    \"app-monthof-picker\": () =>\n      import(\"@/components/kendo_templates/MonthOfPicker\"),\n    \"app-segment-dropdownlist\": () =>\n      import(\"@/components/dropdownlist/Segment\"),\n  },\n  props: {\n    initExpense: {\n      type: ExpenseModel,\n    },\n  },\n  data: () => ({\n    // Obj\n    expense: new ExpenseModel(),\n    journal: new JournalModel(),\n    journalEntries: [],\n    employee: new EmployeeModel(),\n    supplier: new SupplierModel(),\n    paymentTerm: new PaymentTermModel(),\n    currency: new CurrencyModel(institute.baseCurrency),\n    exchangeRate: new ExchangeRateModel(institute.baseCurrency),\n    transactionAccount: new AccountModel(),\n    advanceSettlementClearingAccount: new AccountModel(),\n    otherClearingSuspenseAccount: new AccountModel(),\n    location: new LocationModel(),\n    segment: new SegmentModel(),\n    project: new ProjectModel(),\n    // List\n    cashAdvances: [],\n    accounts: [],\n    expenseAccounts: [],\n    transactionAccounts: [],\n    expenseEntries: [],\n    // Entry Uuid\n    depositEntryUuid: kendo.guid(),\n    transactionEntryUuid: kendo.guid(),\n    // Other\n    subTotal: 0,\n    discountAmount: 0,\n    purchaseTax: 0,\n    whdTax: 0,\n    totalAmount: 0,\n    supplierDepositAmount: 0,\n    depositAmount: 0,\n    amountDue: 0,\n    hasAdditionalCost: false,\n    files: [],\n    user: Helper.getUser(),\n    templates: [],\n    paymentTermType: PAYMENT_TERM_TYPE,\n    // Form validation\n    valid: true,\n    isEdit: false,\n    alert: false,\n    errorMessage: \"\",\n    saveMode: \"\",\n    SaveOption: SaveOption,\n    // Editors\n    AccountEditor: AccountEditor,\n    ClassEditor: ClassEditor,\n    UomEditor: UomEditor,\n    // BillableEditor: BillableEditor,\n    PurchaseDiscountItemEditor: PurchaseDiscountItemEditor,\n    PaymentMethodEditor: PaymentMethodEditor,\n    PurchaseTaxEditor: PurchaseTaxEditor,\n    // MarkupEditor: MarkupEditor,\n    // Sidebar\n    col_expand: 9,\n    col_hide: 3,\n    isHideBar: false,\n    // LoadingMe\n    showLoading: false,\n    loadingAlert: false,\n    loadingColorAlert: \"\",\n    loadingTextAlert: \"\",\n    // By B Nimol\n    decimalFormat: \"n2\",\n    purchaseFormContent: PurchaseFormContent,\n    depositBalance: 0,\n    txnExpense: new Expenses(),\n    transactionType: {},\n    supplierDiscountItem: [],\n  }),\n  methods: {\n    removeEmptyValues(obj) {\n      for (let propName in obj) {\n        if (!obj[propName] || obj[propName].length === 0) {\n          delete obj[propName];\n        } else if (typeof obj[propName] === \"object\") {\n          this.removeEmptyValues(obj[propName]);\n        }\n      }\n      return obj;\n    },\n    onLocationChange() {\n      window.console.log(\n        \"location\",\n        this.removeEmptyValues(this.segment),\n        this.removeEmptyValues(this.location)\n      );\n    },\n    mappingExpense(expense) {\n      const ds = this.$refs.expenseAccountDS.kendoWidget();\n      const accountLine = ds.data().filter((n) => n.amount > 0);\n      this.txnExpense.id = expense.uuid;\n      this.txnExpense.journal_uuid = expense.journal_uuid;\n      this.txnExpense.type = \"Expense\";\n      this.txnExpense.abbr = this.abbr(this.transactionType);\n      this.txnExpense.transactionType = this.transactionType;\n      this.txnExpense.referenceNo = expense.number;\n      // this.txnExpense.referenceNo = expense.number\n      this.txnExpense.transactionDate = expense.expense_date;\n      this.txnExpense.dueDate = expense.due_date;\n      this.txnExpense.billDate = expense.bill_date;\n      this.txnExpense.billNumber = expense.bill_number;\n      this.txnExpense.currency = this.removeEmptyValues(expense.bill_currency);\n      this.txnExpense.supplier = this.supplierMap(expense.supplier);\n      this.txnExpense.employee = this.removeEmptyValues(expense.employee);\n      this.txnExpense.paymentTerm = this.removeEmptyValues(this.paymentTerm);\n      this.txnExpense.segment = this.removeEmptyValues(this.segment);\n      this.txnExpense.location = this.removeEmptyValues(this.location);\n      this.txnExpense.project = this.removeEmptyValues(this.project);\n      this.txnExpense.monthOf = expense.month_of;\n\n      this.txnExpense.additionalCostSupplier = this.removeEmptyValues(\n        expense.additional_cost_supplier\n      );\n      this.txnExpense.use_for_transaction_uuid =\n        expense.use_for_transaction_uuid;\n      this.txnExpense.useForOption = expense.use_for_option;\n      this.txnExpense.transactionNote = expense.voucher_note;\n      this.txnExpense.journalNote = expense.journal_note;\n      this.txnExpense.itemLines = accountLine;\n      this.txnExpense.account = this.removeEmptyValues(\n        this.account(this.transactionAccount)\n      );\n      this.txnExpense.saveOption = expense.is_draft;\n      this.txnExpense.status = 1;\n      this.txnExpense.createdAt = expense.created_date;\n\n      this.txnExpense.total = this.totalAmount;\n      this.txnExpense.amountDue = this.amountDue;\n      this.txnExpense.remainingAmount = this.amountDue;\n      this.txnExpense.subTotal = this.subTotal;\n      this.txnExpense.purchaseTax = this.purchaseTax;\n      this.txnExpense.whdTax = this.whdTax;\n      this.txnExpense.supplierDiscountItem = this.supplierDiscountItem;\n      this.txnExpense.loggedUser = this.loggedUser(this.expense.created_by);\n\n      this.txnExpense.txnRate = this.exchangeRate.rate;\n      this.txnExpense.discountTotal = this.discountAmount;\n      this.txnExpense.depositAmount = this.depositBalance;\n      this.txnExpense.depositDeduction = this.depositAmount;\n      this.txnExpense.exchangeDepositDeduction =\n        this.depositAmount * this.exchangeRate.rate || 0;\n      this.txnExpense.exchangeAmount =\n        this.amountDue * this.exchangeRate.rate || 0;\n\n      window.console.log(\"Expense\", this.txnExpense);\n    },\n    loggedUser(user) {\n      if (user) {\n        return {\n          id: user.id,\n          name: user.user_name,\n          email: user.email,\n        };\n      }\n      return {};\n    },\n    supplierMap(supplier) {\n      if (supplier) {\n        return {\n          id: supplier.uuid,\n          name: supplier.name,\n          email: supplier.email,\n          phone: supplier.phone,\n          address: supplier.address,\n        };\n      }\n      return {};\n    },\n    saveTxnExpense(expenseId, journalId) {\n      this.txnExpense[\"uuid\"] = expenseId;\n      this.txnExpense[\"id\"] = this.txnExpense.id ? this.txnExpense.id : \"\";\n      this.txnExpense[\"journal_uuid\"] = journalId;\n      this.txnExpense[\"actionType\"] = this.$route.params.id\n        ? this.$route.query.type\n        : \"new\";\n      let data = this.txnExpense;\n      billingHandler\n        .createExpense(data)\n        .then((response) => {\n          if (response.data.statusCode === 201) {\n            this.$snotify.success(\"Successfully\");\n          }\n        })\n        .catch((e) => {\n          this.$snotify.error(\"Something went wrong\");\n          this.errors.push(e);\n        });\n    },\n    removeDuplicate(array) {\n      const result = [];\n      const map = new Map();\n      for (const item of array) {\n        if (!map.has(item.id)) {\n          map.set(item.id, true); // set any value to Map\n          result.push(item);\n        }\n      }\n      return result;\n    },\n    account(txnAccount) {\n      if (txnAccount) {\n        return {\n          id: txnAccount.uuid,\n          name: txnAccount.name,\n          local_name: txnAccount.local_name,\n          number: txnAccount.number,\n          is_taxable: txnAccount.is_taxable,\n          banhjiAccCode: txnAccount.banhjiAccCode,\n          group_code: txnAccount.group_code,\n          parent_account: txnAccount.parent_account,\n          type_code: txnAccount.type_code,\n          account_type: txnAccount.account_type,\n        };\n      }\n      return {};\n    },\n    abbr(transactionType) {\n      if (transactionType) {\n        return transactionType.abbr;\n      }\n      return \"\";\n    },\n    supplierDepositBalance() {\n      this.supplierDepositAmount = 0;\n      if (this.depositBalance > 0) {\n        this.supplierDepositAmount =\n          this.depositBalance / this.exchangeRate.rate;\n      }\n    },\n    async loadDepositBalance(id) {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          const strFilter = id + \"?type=dep\";\n          this.supplierDepositAmount = 0;\n          this.depositAmount = 0;\n          billingHandler\n            .balance(strFilter)\n            .then((res) => {\n              if (res.data.statusCode === 200) {\n                const data = res.data.data;\n                if (data.length > 0) {\n                  this.depositBalance = data[0].balance;\n                  this.supplierDepositBalance();\n                }\n              }\n            })\n            .catch();\n          {\n            this.showLoading = false;\n          }\n        }, 300);\n      });\n    },\n    async loadPurchaseFormContent() {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          purchaseFormContentHandler.list().then((res) => {\n            if (res.data.statusCode === 200) {\n              const data = res.data.data;\n              if (data.length > 0) {\n                const supplierSetting = data[0];\n                this.purchaseFormContent = supplierSetting;\n                if (supplierSetting.hasOwnProperty(\"decimal\")) {\n                  this.decimalFormat = \"n\" + supplierSetting.decimal;\n                  // Add 2 default lines\n                  this.addRow();\n                  this.addRow();\n                }\n              }\n            }\n          });\n        }, 100);\n      });\n    },\n    numberFormat(value) {\n      return kendo.toString(value, `${this.decimalFormat}`);\n    },\n    onDueDateChanged() {\n      this.calculateDueDate(this.paymentTerm);\n    },\n    async onVendorChanged() {\n      let paymentBilling = {};\n      if (\n        Object.prototype.hasOwnProperty.call(this.supplier, \"paymentBilling\")\n      ) {\n        paymentBilling = this.supplier.paymentBilling;\n        if (\n          Object.prototype.hasOwnProperty.call(paymentBilling, \"paymentTerm\")\n        ) {\n          this.paymentTerm = new PaymentTermModel(paymentBilling.paymentTerm);\n          this.calculateDueDate(paymentBilling.paymentTerm);\n        }\n      }\n      this.loadDepositBalance(this.supplier.id);\n    },\n    calculateDueDate(paymentTerm) {\n      if (paymentTerm.hasOwnProperty(\"netDue\")) {\n        const netDue = paymentTerm.netDue;\n        const dueDate = new Date(this.expense.expense_date);\n        dueDate.setDate(dueDate.getDate() + parseInt(netDue)); //number  of days to add, e.x. 15 days\n        this.expense.due_date = dueDate.toISOString().substr(0, 10);\n      }\n    },\n    numberEditor(container, options) {\n      kendo\n        .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n        .appendTo(container)\n        .kendoNumericTextBox({\n          decimals: 30,\n          format: `${this.decimalFormat}`,\n        });\n    },\n    Help(key_search) {\n      ShowResource(key_search);\n    },\n    // Initial Data\n    initialData() {\n      if (this.initExpense) {\n        // Edit Mode\n        this.expense = this.initExpense;\n        this.bindData();\n      } else {\n        // Brand New Mode\n        this.setDefaultData();\n      }\n    },\n    // Set default data\n    setDefaultData() {\n      // Brand New Mode\n      this.isEdit = false;\n\n      this.expense = new ExpenseModel({\n        date: new Date().toISOString().substr(0, 10),\n        due_date: new Date().toISOString().substr(0, 10),\n        bill_date: new Date().toISOString().substr(0, 10),\n        month_of: new Date().toISOString().substr(0, 7),\n      });\n\n      // Entry Uuid\n      this.depositEntryUuid = kendo.guid();\n      this.transactionEntryUuid = kendo.guid();\n\n      // Generate Number\n      this.generateNumber();\n\n      // Add 2 default lines\n      // this.addRow();\n      // this.addRow();\n\n      this.autoCalculate();\n    },\n    // Bind data from prop for edit mode\n    async bindData() {\n      this.showLoading = true;\n\n      // Edit Mode\n      this.isEdit = true;\n\n      // Currency\n      this.currency = new CurrencyModel(this.expense.bill_currency);\n      this.exchangeRate = new ExchangeRateModel(this.expense.bill_currency);\n      this.exchangeRate.id = this.expense.expense_entries[0].exchange_rate_uuid;\n      this.exchangeRate.rate = this.expense.expense_entries[0].exchange_rate;\n\n      // Payment Term\n      let paymentTerms = await this.$store.dispatch('paymentTerms/getList');\n      this.paymentTerm = paymentTerms.find(i => i.id === this.expense.payment_term);\n\n      // Contacts\n      this.supplier = new SupplierModel(this.expense.supplier);\n      this.employee = new EmployeeModel(this.expense.employee);\n      this.loadCashAdvance();\n      this.hasAdditionalCost = Boolean(\n        this.expense.additional_cost_supplier.uuid\n      );\n\n      // Sidebar\n\t\t\tlet locations = await this.$store.dispatch('locations/getList');\n\t\t\tthis.location = new LocationModel(locations.find(i => i.id === this.expense.location_uuid));\n\n\t\t\tlet segments = await this.$store.dispatch('segments/getList');\n\t\t\tthis.segment = new SegmentModel(segments.find(i => i.id === this.expense.segment_uuid));\n\n\t\t\tlet projects = await this.$store.dispatch('projects/getList');\n\t\t\tthis.project = new ProjectModel(projects.find(i => i.id === this.expense.project_uuid));\n\n      // Entries\n      let expenseEntries = [],\n        subTotal = 0,\n        discountAmount = 0,\n        purchaseTaxAmount = 0,\n        whdTaxAmount = 0,\n        discountItems = await discountItemHandler.getAll(\"?type=Purchase\"),\n        taxItems = await taxHandler.getAll(),\n        uoms = await uomHandler.getAll(),\n        clazz = await classHandler.getAll();\n\n      this.expense.expense_entries.forEach((value) => {\n        if (\n          value.amount > 0 &&\n          value.account.account_type.number !== AccountTypeCode.PURCHASE_TAX\n        ) {\n          let exp = new ExpenseEntryModel(value);\n\n          // Subtotal\n          subTotal += value.amount;\n\n          // UOM\n          exp.uom = new UomModel(\n            uoms.data.data.find((item) => item.id === value.uom_uuid)\n          );\n\n          // Discount\n          exp.discount = new DiscountItemModel(\n            discountItems.data.data.find((item) => item.id === value.discount.uuid)\n          );\n\n          // Tax\n          exp.tax_item = new TaxModel(\n            taxItems.data.data.find((item) => item.id === value.tax_item.uuid)\n          );\n\n          // Classes\n          exp.class1 = new ClassModel(\n            clazz.data.data.find((item) => item.id === value.class_1_uuid)\n          );\n          exp.class2 = new ClassModel(\n            clazz.data.data.find((item) => item.id === value.class_2_uuid)\n          );\n          exp.class3 = new ClassModel(\n            clazz.data.data.find((item) => item.id === value.class_3_uuid)\n          );\n          exp.class4 = new ClassModel(\n            clazz.data.data.find((item) => item.id === value.class_4_uuid)\n          );\n          exp.class5 = new ClassModel(\n            clazz.data.data.find((item) => item.id === value.class_5_uuid)\n          );\n\n          expenseEntries.push(exp);\n        } else {\n          // Discount\n          if (value.account.account_type.number === AccountTypeCode.DISCOUNT) {\n            discountAmount += value.amount * -1;\n          }\n\n          // WHD Tax\n          if (value.account.account_type.number === AccountTypeCode.WHD_TAX) {\n            whdTaxAmount += value.amount * -1;\n          }\n\n          // Deposit\n          if (\n            ~AccountTypeCode.PURCHASE_DEPOSITS.indexOf(\n              value.account.account_type.number\n            )\n          ) {\n            this.depositAmount = value.amount * -1;\n            this.depositEntryUuid = value.uuid;\n          }\n\n          // Transaction Account (Payable Account / Clearing Account)\n          if (\n            ~AccountTypeCode.PAYABLE_ACCOUNTS.indexOf(\n              value.account.account_type.number\n            ) ||\n            value.account.number ===\n              AccountTypeCode.ADVANCE_SETTLEMENT_CLEARING_CODE\n          ) {\n            this.amountDue = value.amount * -1;\n            this.transactionEntryUuid = value.uuid;\n            this.transactionAccount = new AccountModel(value.account);\n          }\n        }\n\n        // Purchase Tax\n        if (\n          value.account.account_type.number === AccountTypeCode.PURCHASE_TAX\n        ) {\n          purchaseTaxAmount += value.amount;\n        }\n      });\n\n      // Bind Expense Entries\n      this.expenseEntries = expenseEntries;\n\n      // Calculation\n      this.subTotal = subTotal;\n      this.discountAmount = discountAmount;\n      this.purchaseTax = purchaseTaxAmount;\n      this.whdTax = whdTaxAmount;\n      this.totalAmount =\n        subTotal - this.discountAmount + this.purchaseTax - this.whdTax;\n\n      //Journal\n      let journals = await journalHandler.getOne(this.expense.journal_uuid);\n      this.journal = journals.data;\n      this.journalEntries = this.journal.journal_entries;\n\n      this.showLoading = false;\n    },\n    // Number\n    async generateNumber() {\n      let num = await Helper.generateAccountingNumber(\n        EntityType.EXPENSES,\n        this.expense.expense_date\n      );\n\n      this.expense.number = num.number;\n      this.transactionType = num.prefix;\n      this.expense.prefix_format = num.prefix_format;\n    },\n    // Get Exchange Rate\n    async getExchangeRate() {\n      if (this.expense.expense_date && this.currency.code !== \"\") {\n        this.exchangeRate = await Helper.getLastExchangeRateByDate(\n          this.expense.expense_date,\n          this.currency.code\n        );\n      } else {\n        this.exchangeRate = new ExchangeRateModel(institute.baseCurrency);\n      }\n      this.supplierDepositBalance();\n    },\n    // Load Cash Advance\n    loadCashAdvance() {\n      if (this.employee.id !== \"\") {\n        // Clear Selected Cash Advance\n        this.expense.use_for_transaction_uui = \"\";\n\n        this.showLoading = true;\n        cashAdvanceHandler\n          .getByEmployeeId(this.employee.id)\n          .then((res) => {\n            if (res.data) {\n              this.cashAdvances = res.data;\n            }\n          })\n          .finally(() => {\n            this.showLoading = false;\n          });\n      }\n    },\n    // On Employee Radio Changes\n    onUseForOptionChanges() {\n      // Clear Selected Cash Advance\n      this.expense.use_for_transaction_uuid = \"\";\n      this.transactionAccount = new AccountModel();\n\n      this.filterTransactionAccount();\n    },\n    // Filter Transation Account\n    filterTransactionAccount() {\n      if (this.expense.use_for_option === 0) {\n        // Credit\n        this.transactionAccounts = this.accounts.filter(\n          (item) =>\n            ~AccountTypeCode.PAYABLE_ACCOUNTS.indexOf(item.account_type.number)\n        ); // Payable Account\n      } else {\n        // Reimbursement / Cash Advance\n        this.transactionAccount = this.advanceSettlementClearingAccount;\n        this.transactionAccounts = [this.advanceSettlementClearingAccount];\n      }\n    },\n    // On Additional Cost Changes\n    onAdditionalCostCheckboxChanges() {\n      let ds = this.$refs.expenseAccountDS.kendoWidget();\n      ds.data([]);\n\n      if (this.hasAdditionalCost) {\n        this.expenseAccounts = [this.otherClearingSuspenseAccount];\n\n        // Insert row\n        let je = new ExpenseEntryExtendedModel({\n          uuid: kendo.guid(),\n          account: this.otherClearingSuspenseAccount,\n          decimalFormat: this.decimalFormat,\n        });\n\n        ds.add(je);\n      } else {\n        this.expense.additional_cost_supplier = null;\n        this.expenseAccounts = this.accounts;\n        this.addRow();\n        this.addRow();\n      }\n    },\n    /* Kendo */\n    // DataSource Changes\n    onExpenseAccountDSChanges(e) {\n      if (e.field) {\n        let dataRow = e.items[0];\n\n        if (e.field === \"account\") {\n          this.addExtraRow(dataRow.uid);\n        } else if (e.field === \"quantity\" || e.field === \"price\") {\n          let amt =\n            kendo.parseFloat(dataRow.quantity) *\n            kendo.parseFloat(dataRow.price);\n          dataRow.set(\"amount\", amt);\n        } else if (e.field === \"uom\") {\n          if (dataRow.uom) {\n            dataRow.set(\"uom_uuid\", dataRow.uom.id);\n          }\n        } else if (e.field === \"class1\") {\n          if (dataRow.class1 !== null) {\n            dataRow.set(\"class_1_uuid\", dataRow.class1.id);\n          } else {\n            // Set default when deselect\n            dataRow.set(\"class_1_uuid\", \"\");\n            dataRow.set(\"class1\", new ClassModel());\n          }\n        } else if (e.field === \"class2\") {\n          if (dataRow.class2 !== null) {\n            dataRow.set(\"class_2_uuid\", dataRow.class2.id);\n          } else {\n            // Set default when deselect\n            dataRow.set(\"class_2_uuid\", \"\");\n            dataRow.set(\"class2\", new ClassModel());\n          }\n        } else if (e.field === \"class3\") {\n          if (dataRow.class3 !== null) {\n            dataRow.set(\"class_3_uuid\", dataRow.class3.id);\n          } else {\n            // Set default when deselect\n            dataRow.set(\"class_3_uuid\", \"\");\n            dataRow.set(\"class3\", new ClassModel());\n          }\n        } else if (e.field === \"class4\") {\n          if (dataRow.class4 !== null) {\n            dataRow.set(\"class_4_uuid\", dataRow.class4.id);\n          } else {\n            // Set default when deselect\n            dataRow.set(\"class_4_uuid\", \"\");\n            dataRow.set(\"class4\", new ClassModel());\n          }\n        } else if (e.field === \"class5\") {\n          if (dataRow.class5 !== null) {\n            dataRow.set(\"class_5_uuid\", dataRow.class5.id);\n          } else {\n            // Set default when deselect\n            dataRow.set(\"class_5_uuid\", \"\");\n            dataRow.set(\"class5\", new ClassModel());\n          }\n        }\n\n        this.autoCalculate();\n      }\n    },\n    calculateDiscount(discountItem, subTotal) {\n      if (discountItem) {\n        const nature = discountItem.nature;\n        const amount = discountItem.amount;\n        if (nature === \"Amount\") {\n          return kendo.parseFloat(amount);\n        } else if (nature === \"Percentage\") {\n          return subTotal * (kendo.parseFloat(amount) / 100);\n        }\n      }\n    },\n    autoCalculateTax(tax, amount) {\n      if (tax) {\n        var formula = tax.formula;\n        var inAmt = kendo.parseFloat(amount);\n        var nAmt = kendo.parseFloat(amount);\n        var taxBase = kendo.parseFloat(tax.taxBase) / 100;\n        var rate = kendo.parseFloat(tax.rate) / 100;\n        var total = eval(formula);\n        window.console.log(inAmt, nAmt, taxBase, rate, formula, total);\n        return total;\n      }\n      // return 0\n    },\n    // Auto Calculate In DataSource\n    autoCalculate() {\n      let expDS = this.$refs.expenseAccountDS.kendoWidget(),\n        subTotal = 0,\n        discount = 0,\n        purchaseTax = 0,\n        whdTax = 0,\n        discountItem = [];\n\n      // Expense\n      expDS.data().forEach((value) => {\n        let amt = kendo.parseFloat(value.amount);\n        subTotal += amt;\n\n        // Discount\n        let discountAmount = 0;\n        if (value.discount.id !== \"\") {\n          let subTo =\n            kendo.parseFloat(value.price) * kendo.parseFloat(value.quantity);\n          const disAMt = this.calculateDiscount(value.discount, subTo);\n          discountAmount = disAMt;\n          discount += disAMt;\n          if (value.discount.hasOwnProperty(\"id\")) {\n            discountItem.push(value.discount);\n          }\n          // Bind Account Model\n          value.discount.account = new AccountModel(value.discount.account);\n        }\n\n        // Tax\n        if (value.tax_item.id !== \"\") {\n          let amtAfterDiscount =\n            kendo.parseFloat(value.amount) - discountAmount;\n          const taxAmount = this.autoCalculateTax(\n            value.tax_item,\n            amtAfterDiscount\n          );\n          if (value.tax_item.hasOwnProperty(\"taxType\")) {\n            const taxType = value.tax_item.taxType;\n            let taxTypeId = 0;\n            if (taxType.hasOwnProperty(\"typeId\")) {\n              taxTypeId = taxType.typeId;\n              if (taxTypeId === 2) {\n                whdTax += taxAmount;\n              } else {\n                purchaseTax += taxAmount;\n              }\n            }\n          }\n          // Bind Account Model\n          value.tax_item.account = new AccountModel(value.tax_item.account);\n        }\n      });\n      this.subTotal = subTotal;\n      this.discountAmount = discount;\n      this.purchaseTax = purchaseTax;\n      this.whdTax = whdTax;\n      this.totalAmount = subTotal - discount + purchaseTax - whdTax;\n      this.amountDue = this.totalAmount - this.depositAmount;\n      this.supplierDiscountItem = this.removeDuplicate(discountItem);\n    },\n    // Row Number Template\n    rowNumberTmpl(dataItem) {\n      let ds = this.$refs.expenseAccountDS.kendoWidget(),\n        index = ds.indexOf(dataItem);\n\n      return index + 1;\n    },\n    // Grid Custom Editor\n    expenseAccountEditor(container, options) {\n      return Helper.accountEditor(container, options, this.expenseAccounts);\n    },\n    // Add New Row\n    addRow() {\n      let ds = this.$refs.expenseAccountDS.kendoWidget(),\n        last = ds.total();\n\n      let je = new ExpenseEntryExtendedModel();\n      je.uuid = kendo.guid();\n      je.quantity = 1;\n      je.discountAs = DISCOUNT_ITEM_TYPE;\n      je.decimalFormat = this.decimalFormat;\n\n      ds.insert(last, je);\n    },\n    // Add Extra Row\n    addExtraRow(uid) {\n      let ds = this.$refs.expenseAccountDS.kendoWidget(),\n        total = ds.total(),\n        row = ds.getByUid(uid),\n        index = ds.indexOf(row);\n\n      if (index === total - 1) {\n        this.addRow();\n      }\n    },\n    // Remove Row\n    removeRow(e) {\n      e.preventDefault();\n\n      let grid = this.$refs.expenseGrid.kendoWidget(),\n        ds = grid.dataSource,\n        dataItem = grid.dataItem($(e.currentTarget).closest(\"tr\"));\n\n      if (ds.data().length > 2) {\n        ds.remove(dataItem);\n      }\n    },\n    // Shrink Data\n    shrinkData() {\n      let entries = [],\n        discountGroups = {},\n        taxGroups = {},\n        expDS = this.$refs.expenseAccountDS.kendoWidget();\n\n      // Date\n      this.expense.expense_date = Helper.toISODate(this.expense.expense_date);\n      this.expense.bill_date = Helper.toISODate(this.expense.bill_date);\n      this.expense.due_date = Helper.toISODate(this.expense.due_date);\n      this.expense.payment_term = this.paymentTerm.id;\n\n      // Currency\n      this.expense.bill_currency = this.currency;\n\n      // Supplier\n      this.expense.supplier = new ContactModel(this.supplier);\n\n      // Employee\n      this.expense.employee = new ContactModel(this.employee);\n\n      // Sidebar\n      this.expense.location_uuid = this.location.id;\n      this.expense.segment_uuid = this.segment.id;\n      this.expense.project_uuid = this.project.id;\n\n      // User\n      if (this.isEdit) {\n        this.expense.modified_by = this.user;\n      } else {\n        this.expense.created_by = this.user;\n      }\n\n      // Expense Entries on Dr\n      expDS.data().forEach((value) => {\n        // Filter selected account\n        if (value.account.name !== \"\" && value.amount > 0) {\n          // Account\n          value.set(\"account\", new AccountModel(value.account));\n\n          // Contact\n          value.set(\"primary_contact\", new ContactModel(this.supplier));\n          value.set(\"secondary_contacts\", [new ContactModel(this.employee)]);\n\n          // value.set(\"billable\", Number(value.billable));\n\n          // Currency\n          value.set(\"currency\", new CurrencyModel(this.currency));\n          value.set(\"exchange_rate_uuid\", this.exchangeRate.id);\n          value.set(\"exchange_rate\", this.exchangeRate.rate);\n          value.set(\"exchanged_amount\", value.amount * this.exchangeRate.rate);\n\n          // Discount\n          value.set(\"discount\", new DiscountItemModel(value.discount));\n\n          // Tax\n          value.set(\"tax_item\", new TaxModel(value.tax_item));\n\n          // Add Entry\n          entries.push(new ExpenseEntryModel(value));\n\n          // Discount on Cr\n          let discountAmount = 0;\n          if (value.discount.id !== \"\") {\n            let subTo =\n              kendo.parseFloat(value.price) * kendo.parseFloat(value.quantity);\n            discountAmount = this.calculateDiscount(value.discount, subTo);\n\n            // Group Discount's Account\n            if (discountGroups[value.discount.account.uuid]) {\n              discountGroups[value.discount.account.uuid][\n                \"amount\"\n              ] += discountAmount;\n            } else {\n              discountGroups[value.discount.account.uuid] = {\n                uuid: kendo.guid(),\n                amount: discountAmount,\n                account: new AccountModel(value.discount.account),\n              };\n            }\n          }\n\n          // Taxes on Dr\n          if (value.tax_item.id !== \"\") {\n            let amtAfterDiscount =\n              kendo.parseFloat(value.amount) - discountAmount;\n            let taxAmount = this.autoCalculateTax(\n              value.tax_item,\n              amtAfterDiscount\n            );\n            if (value.tax_item.hasOwnProperty(\"taxType\")) {\n              const taxType = value.tax_item.taxType;\n              if (taxType.hasOwnProperty(\"typeId\")) {\n                if (taxType.typeId === 2) {\n                  // WHD Tax\n                  taxAmount *= -1; // Cr side\n                }\n\n                // Group Tax's Account\n                if (taxGroups[value.tax_item.account.uuid]) {\n                  taxGroups[value.tax_item.account.uuid][\"amount\"] += taxAmount;\n                } else {\n                  taxGroups[value.tax_item.account.uuid] = {\n                    uuid: kendo.guid(),\n                    amount: taxAmount,\n                    account: new AccountModel(value.tax_item.account),\n                  };\n                }\n              }\n            }\n          }\n        }\n      });\n\n      // Edit Mode\n      if (this.isEdit) {\n        this.journalEntries.forEach((value) => {\n          // Discount\n          if (discountGroups[value.account.uuid]) {\n            // Set previouse uuid if exists\n            discountGroups[value.account.uuid][\"uuid\"] = value.uuid;\n          }\n\n          // Taxes\n          if (taxGroups[value.account.uuid]) {\n            // Set previouse uuid if exists\n            taxGroups[value.account.uuid][\"uuid\"] = value.uuid;\n          }\n        });\n      }\n\n      // Taxes: Purchase Tax on Dr and WHD Tax on Cr\n      for (let taxKey in taxGroups)\n        entries.push(\n          new ExpenseEntryModel({\n            uuid: taxGroups[taxKey].uuid,\n            account: new AccountModel(taxGroups[taxKey].account),\n            primary_contact: new ContactModel(this.supplier),\n            secondary_contacts: [new ContactModel(this.employee)],\n            description: this.expense.journal_note,\n            currency: new CurrencyModel(this.currency),\n            amount: taxGroups[taxKey].amount,\n            exchange_rate_uuid: this.exchangeRate.id,\n            exchange_rate: this.exchangeRate.rate,\n          })\n        );\n\n      // Discount Account on Cr\n      for (let disKey in discountGroups)\n        entries.push(\n          new ExpenseEntryModel({\n            uuid: discountGroups[disKey].uuid,\n            account: new AccountModel(discountGroups[disKey].account),\n            primary_contact: new ContactModel(this.supplier),\n            secondary_contacts: [new ContactModel(this.employee)],\n            description: this.expense.journal_note,\n            currency: new CurrencyModel(this.currency),\n            amount: discountGroups[disKey].amount * -1, // Cr side is negative\n            exchange_rate_uuid: this.exchangeRate.id,\n            exchange_rate: this.exchangeRate.rate,\n          })\n        );\n\n      // Deposit Account on Cr\n      if (this.depositAmount > 0) {\n        entries.push(\n          new ExpenseEntryModel({\n            uuid: this.depositEntryUuid,\n            account: new AccountModel(\n              this.supplier.accountTax.purchaseDepositAcc\n            ),\n            primary_contact: new ContactModel(this.supplier),\n            secondary_contacts: [new ContactModel(this.employee)],\n            description: this.expense.journal_note,\n            currency: new CurrencyModel(this.currency),\n            amount: this.depositAmount * -1, // Cr side is negative\n            exchange_rate_uuid: this.exchangeRate.id,\n            exchange_rate: this.exchangeRate.rate,\n          })\n        );\n      }\n\n      // Transaction Entries on Cr\n      entries.push(\n        new ExpenseEntryModel({\n          uuid: this.transactionEntryUuid,\n          account: new AccountModel(this.transactionAccount),\n          primary_contact: new ContactModel(this.supplier),\n          secondary_contacts: [new ContactModel(this.employee)],\n          description: this.expense.journal_note,\n          currency: new CurrencyModel(this.currency),\n          amount: this.amountDue * -1, // Cr side is negative\n          exchange_rate_uuid: this.exchangeRate.id,\n          exchange_rate: this.exchangeRate.rate,\n        })\n      );\n\n      this.expense.expense_entries = entries;\n      // mapping to Dynamodb ( expense record ) -> save everywhere morng ^_^\n      this.mappingExpense(this.expense);\n    },\n    // Add Journal\n    addJournal() {\n      let entries = [];\n\n      this.expense.expense_entries.forEach((value) => {\n        entries.push(new JournalEntryModel(value));\n      });\n\n      // Journal Entries\n      this.journalEntries = entries;\n\n      // Journal\n      this.journal.number = this.expense.number;\n      this.journal.description = this.expense.journal_note;\n      this.journal.journal_date = Helper.toISODate(this.expense.expense_date);\n      this.journal.journal_type = EntityType.AUTO_JOURNAL;\n      this.journal.transaction_type = EntityType.EXPENSES;\n      this.journal.related_transaction_uuid = this.expense.use_for_transaction_uuid;\n      this.journal.month_of = this.expense.month_of;\n      this.journal.location_uuid = this.expense.location_uuid;\n      this.journal.project_uuid = this.expense.project_uuid;\n      this.journal.segment_uuid = this.expense.segment_uuid;\n      this.journal.prefix_format = this.expense.prefix_format;\n      this.journal.is_draft = this.expense.is_draft;\n      this.journal.created_date = this.expense.created_date;\n      this.journal.created_by = this.expense.created_by;\n      this.journal.modified_by = this.expense.modified_by;\n    },\n    // Validating\n    validateForm() {\n      let result = true,\n        expDS = this.$refs.expenseAccountDS.kendoWidget(),\n        msg = \"\",\n        countExpense = 0;\n\n      // Supplier\n      if (this.supplier.id === \"\") {\n        msg += `<p>${i18n.t(\"supplier_is_required\")}</p>`;\n        result = false;\n      }\n\n      // Expense\n      expDS.data().forEach((value, index) => {\n        // No account\n        if (value.account.name === \"\" && value.amount > 0) {\n          result = false;\n          msg += `<p>${i18n.t(\n            \"please_select_expense_account_at_row_number\"\n          )} ${index + 1}</p>`;\n        }\n\n        // No amount\n        if (value.account.name !== \"\" && value.amount === 0) {\n          result = false;\n          msg += `<p>${value.account.name} ${i18n.t(\"has_no_amount\")}</p>`;\n        }\n\n        // Discount\n        if (value.discount.id !== \"\") {\n          if (\n            value.discount.account.uuid === \"\" ||\n            value.discount.account.account_type.number === 0\n          ) {\n            result = false;\n            msg += `<p>${i18n.t(\n              \"invalid_discount_account_at_row_number\"\n            )} ${index + 1}</p>`;\n          }\n        }\n\n        // Tax\n        if (value.tax_item.id !== \"\") {\n          if (\n            value.tax_item.account.uuid === \"\" ||\n            value.tax_item.account.account_type.number === 0\n          ) {\n            result = false;\n            msg += `<p>${i18n.t(\"invalid_tax_account_at_row_number\")} ${index +\n              1}</p>`;\n          }\n        }\n\n        // Count Empty Row\n        if (value.account.name !== \"\" && value.amount > 0) {\n          countExpense++;\n        }\n      });\n\n      // Empty Row\n      if (countExpense === 0) {\n        msg += `<p>${i18n.t(\"please_select_expense_account\")}</p>`;\n        result = false;\n      }\n\n      // Transaction Account\n      if (this.transactionAccount.uuid === \"\") {\n        msg += `<p>${i18n.t(\"please_select_transaction_account\")}</p>`;\n        result = false;\n      }\n\n      // Use for Cash Advance\n      if (\n        this.expense.use_for_option === 2 &&\n        this.expense.use_for_transaction_uuid === \"\"\n      ) {\n        msg += `<p>${i18n.t(\"please_select_related_cash_advance\")}</p>`;\n        result = false;\n      }\n\n      // Show Alert\n      this.errorMessage = msg;\n\n      this.alert = result === false;\n\n      return result;\n    },\n    // All Saves\n    async onSaveOptionClick(mode) {\n      if (this.$refs.form.validate() && this.validateForm()) {\n        let isValidClosingDate = await Helper.validateClosingDate(\n          this.expense.expense_date\n        );\n        if (isValidClosingDate) {\n          this.saveMode = mode;\n          this.save();\n        }\n      }\n    },\n    cancel() {\n      this.$swal({\n        title: i18n.t(\"msg_title_warning\"),\n        text: i18n.t(\"msg_discard\"),\n        icon: \"warning\",\n        showCancelButton: true,\n        cancelButtonText: i18n.t(\"cancel\"),\n        confirmButtonColor: \"#4d4848\",\n        cancelButtonColor: \"#ED1A3A\",\n        confirmButtonText: i18n.t(\"discard\"),\n      }).then((result) => {\n        if (result.value) {\n          this.clear();\n          this.setDefaultData();\n          this.$router.go(-1);\n        }\n      });\n    },\n    clear() {\n      // Reset Form\n      this.isEdit = false;\n      this.saveMode = \"\";\n\n      // Entry Uuid\n      this.depositEntryUuid = kendo.guid();\n      this.transactionEntryUuid = kendo.guid();\n\n      this.subTotal = 0;\n      this.discountAmount = 0;\n      this.purchaseTax = 0;\n      this.whdTax = 0;\n      this.totalAmount = 0;\n      this.supplierDepositAmount = 0;\n      this.depositAmount = 0;\n      this.amountDue = 0;\n      this.hasAdditionalCost = false;\n\n      this.expense = new ExpenseModel();\n      this.journal = new JournalModel();\n      this.journalEntries = [];\n      this.employee = new EmployeeModel();\n      this.supplier = new SupplierModel();\n      this.paymentTerm = new PaymentTermModel();\n      this.currency = new CurrencyModel(institute.baseCurrency);\n      this.exchangeRate = new ExchangeRateModel(institute.baseCurrency);\n      this.advanceSettlementClearingAccount = new AccountModel();\n      this.transactionAccount = new AccountModel();\n      this.location = new LocationModel();\n      this.segment = new SegmentModel();\n      this.project = new ProjectModel();\n\n      let expDS = this.$refs.expenseAccountDS.kendoWidget();\n      expDS.data([]);\n    },\n    save() {\n      let self = this;\n\n      // Draft Mode\n      if (this.saveMode === SaveOption.SAVEDRAFT) {\n        this.expense.is_draft = 1;\n      } else {\n        this.expense.is_draft = 0;\n      }\n\n      // Shrink Data\n      this.shrinkData();\n\n      // Add Journal\n      this.addJournal();\n\n      // Sync Data\n      this.showLoading = true;\n      expenseHandler\n        .save({\n          expense: new ExpenseModel(this.expense),\n          journal: new JournalModel(this.journal),\n          journal_entries: this.journalEntries,\n        })\n        .then((response) => {\n          if (response) {\n            window.console.log(response, \"response\", response.data.uuid);\n            if (response.data.uuid) {\n              this.saveTxnExpense(\n                response.data.uuid,\n                response.data.journal_uuid\n              );\n            }\n            self.responseStatus(response.status);\n          }\n        })\n        .catch((error) => {\n          Helper.alertErrorMsg(error);\n        })\n        .finally(() => {\n          self.showLoading = false;\n        });\n    },\n    // Response Status\n    responseStatus(status) {\n      switch (status) {\n        case 200: // Ok\n          this.showAlert();\n          break;\n        case 201: // Duplicate\n          Helper.alertErrorMsg(\"Duplicate entry!\");\n          break;\n        default:\n          break;\n      }\n    },\n    // Sweetalert2\n    changeAlertStatus() {\n      this.loadingAlert = true;\n      setTimeout(() => {\n        this.loadingAlert = false;\n      }, 6200);\n    },\n    showAlert() {\n      this.changeAlertStatus();\n      this.loadingTextAlert = \"Added Successful\";\n      this.loadingColorAlert = \"#3DA72E\";\n      switch (this.saveMode) {\n        case \"saveClose\": // Save Close\n          // this.$swal({\n          // \tposition: 'products',\n          // \ticon: 'success',\n          // \ttitle: 'Your work has been saved',\n          // \tshowConfirmButton: true,\n          // }).then((result) => {\n          // \tif (result.value) {\n          // \t\twindow.history.go(-1)\n\n          // \t\treturn false\n          // \t}\n          // })\n          if (this.isEdit) {\n            this.goBackToViewPage();\n          } else {\n            this.$router.go(-1);\n          }\n\n          this.clear();\n          this.setDefaultData();\n          break;\n        default:\n          // Save New\n          // this.$swal({\n          // \tposition: 'products',\n          // \ticon: 'success',\n          // \ttitle: 'Your work has been saved',\n          // \tshowConfirmButton: false,\n          // \ttimer: 1500\n          // })\n          this.clear();\n          this.setDefaultData();\n          break;\n      }\n    },\n    // Go back to view page after edit mode\n    getExpense() {\n      return new ExpenseModel(this.expense);\n    },\n    goBackToViewPage() {\n      this.$router.replace({\n        name: \"Expenses View\",\n        params: { initExpense: this.getExpense() },\n      });\n    },\n    HideSmallSideBar() {\n      this.isHideBar = !this.isHideBar;\n    },\n  },\n  watch: {\n    initExpense() {\n      this.initialData();\n    },\n  },\n  created() {\n    // Call Account List\n    accountHandler.getAll().then((res) => {\n      this.accounts = res.data;\n      this.expenseAccounts = res.data;\n\n      // Advance Settlement Clearing Account by banhji_account_number\n      let advSetClrAcc = res.data.find(\n        (value) =>\n          value.number === AccountTypeCode.ADVANCE_SETTLEMENT_CLEARING_CODE\n      ); // Will change later\n      this.advanceSettlementClearingAccount = new AccountModel(advSetClrAcc);\n\n      // Other Clearing Suspenses Account by banhji_account_number\n      let otherClrSusAcc = res.data.find(\n        (value) =>\n          value.number === AccountTypeCode.OTHER_CLEARING_SUSPENSES_CODE\n      ); // Will change later\n      this.otherClearingSuspenseAccount = new AccountModel(otherClrSusAcc);\n\n      // Filter Transaction Accounts\n      this.filterTransactionAccount();\n    });\n  },\n  mounted: async function() {\n    // Supplier Setting such as decimal format\n    await this.loadPurchaseFormContent();\n\n    // Initial Data\n    this.initialData();\n  },\n};\n</script>\n\n<style scoped>\n.v-input.custom-radio\n  .v-input--selection-controls__input\n  .v-input--selection-controls__ripple {\n  display: none !important;\n}\n\n.function_wrapper {\n  box-shadow: none !important;\n}\n\n.v-application--is-ltr .v-text-field .v-input__append-inner {\n  margin-top: 0 !important;\n}\n\n.v-input__slot {\n  background-color: #fff !important;\n}\n\n.function_content .label {\n  margin-bottom: 10px;\n  display: inline-block;\n}\n\n.border_radius10 {\n  border-radius: 10px !important;\n  background-color: #f2f2f2;\n}\n\n.pa-3.v-card h4 {\n  font-size: 18px;\n  color: #333;\n}\n\n.pa-3.v-card p {\n  font-size: 12px;\n  color: #b5b5b5;\n}\n\n.attachment_file {\n  background-color: #efeded;\n  border-radius: 0 !important;\n}\n\n.attachment_table.v-data-table table {\n  border: thin solid rgba(0, 0, 0, 0.12);\n}\n\n.attachment_table table tr th {\n  border-left: thin solid rgba(0, 0, 0, 0.12);\n  height: 35px;\n  border-right: thin solid rgba(0, 0, 0, 0.12);\n}\n\n.block_debit,\n.block_credit {\n  border-bottom: 1px solid #fff;\n}\n\n.block_debit p.number,\n.block_credit p.number {\n  font-size: 25px;\n  color: #7f7f7f;\n}\n\n.block_debit h5,\n.block_credit h5,\n.block_difference h5 {\n  text-transform: uppercase;\n  color: #7f7f7f;\n  font-size: 15px;\n  font-weight: normal;\n}\n\n.block_difference h5 {\n  font-size: 18px;\n}\n\n.block_difference h5 span {\n  font-size: 15px;\n}\n\n.custom_grid table th:last-child {\n  text-align: right !important;\n}\n\n@media (min-width: 1264px) {\n  .container {\n    max-width: 1250px;\n  }\n}\n\n@media (max-width: 576px) {\n  .pt-6.col-sm-5.col-12 {\n    padding-top: 0 !important;\n  }\n\n  .code_text {\n    width: 100%;\n  }\n\n  .phone_no_pt {\n    padding-top: 0 !important;\n  }\n\n  .select_template,\n  .save_option {\n    margin-bottom: 10px;\n  }\n}\n\n.hide_small_bar_class {\n  max-width: 0;\n  transition: 0.5s ease-in;\n  flex: 0 0 0;\n  padding: 0;\n}\n\n.hide_big_bar_class {\n  max-width: 100%;\n  transition: 0.5s ease-in;\n  flex: 0 0 100%;\n}\n\n.info_add {\n  background-color: #ffffff;\n}\n\n.small_sidebar {\n  height: 98%;\n  position: relative;\n  padding: 12px;\n  background-color: #edf1f5;\n}\n\n.iconArrow {\n  right: -35px;\n  position: absolute;\n  bottom: -10px;\n}\n\n.iconArrowHide {\n  position: absolute;\n  right: -7px;\n  bottom: -10px;\n}\n\n.color_grey {\n  color: #808080;\n}\n\n.card_green {\n  min-height: 70px;\n  background-color: #00b050 !important;\n  color: #ffffff;\n}\n\n.lb_bold {\n  font-size: 12px;\n}\n\n.detial_smallside_p {\n  position: absolute;\n  bottom: 10px;\n}\n\n.card_background {\n  background-color: #edf1f5;\n  min-height: 120px;\n}\n\n.deposite_input {\n  width: 100px;\n}\n\n.btn_save_draft {\n  color: #ffffff;\n  background-color: #00b0f0 !important;\n  text-transform: capitalize;\n}\n\n.save_option {\n  background-color: #203864 !important;\n}\n\n.btn_add_small {\n  height: 27px !important;\n  min-width: 25px !important;\n  font-size: 10px;\n  padding: 0 22px !important;\n  background-color: #00b050 !important;\n  color: #ffffff;\n  border-radius: 0 !important;\n}\n\n.list_site_inv {\n  background-color: #92d050;\n  color: #ffffff;\n  font-size: 12px;\n}\n\n.list_site_exp {\n  background-color: #c5e0b4;\n  color: #000000;\n  font-size: 12px;\n  line-height: 16px;\n  min-height: 40px;\n}\n\n.checkbox_inv {\n  padding: 2px;\n  margin-top: 3px;\n  margin-right: 2px;\n}\n\n.exp_select {\n  font-size: 12px !important;\n}\n\n.theme--light.v-data-table\n  > .v-data-table__wrapper\n  > table\n  > tbody\n  > tr:hover:not(.v-data-table__expanded__content):not(.v-data-table__empty-wrapper) {\n  background-color: transparent !important;\n}\n</style>\n"]}]}