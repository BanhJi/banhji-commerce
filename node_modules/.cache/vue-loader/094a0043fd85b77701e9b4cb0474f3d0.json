{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/micro_edition/purchases/CreditPurchase.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/micro_edition/purchases/CreditPurchase.vue","mtime":1640595536818},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8vIGltcG9ydCBrZW5kbyBmcm9tICJAcHJvZ3Jlc3Mva2VuZG8tdWkiCmltcG9ydCB7IGkxOG4gfSBmcm9tICJAL2kxOG4iOwppbXBvcnQgUHVyY2hhc2VNb2RlbCBmcm9tICJAL3NjcmlwdHMvcHVyY2hhc2UvbW9kZWwvUHVyY2hhc2UiOwppbXBvcnQgSXRlbUxpbmVNb2RlbCBmcm9tICJAL3NjcmlwdHMvcHVyY2hhc2UvbW9kZWwvSXRlbUxpbmUiOwppbXBvcnQgeyB1dWlkIH0gZnJvbSAidnVlLXV1aWQiOwppbXBvcnQgeyBEcm9wRG93bkxpc3QgfSBmcm9tICJAcHJvZ3Jlc3Mva2VuZG8tdnVlLWRyb3Bkb3ducyI7CmltcG9ydCBrZW5kbyBmcm9tICJAcHJvZ3Jlc3Mva2VuZG8tdWkiOwppbXBvcnQgUHVyY2hhc2VGb3JtQ29udGVudE1vZGVsIGZyb20gIkAvc2NyaXB0cy9tb2RlbC9QdXJjaGFzZUZvcm1Db250ZW50IjsKaW1wb3J0IHsgZGF0YVN0b3JlLCBTaG93UmVzb3VyY2UgfSBmcm9tICJAL29ic2VydmFibGUvc3RvcmUiOwppbXBvcnQgcGF5bWVudFRlcm1IYW5kbGVyXyBmcm9tICJAL3NjcmlwdHMvcGF5bWVudHRlcm0vaGFuZGxlci9wYXltZW50VGVybUhhbmRsZXIiOwppbXBvcnQgY3JlZGl0TGltaXRIYW5kbGVyIGZyb20gIkAvc2NyaXB0cy9jcmVkaXRMaW1pdC9oYW5kbGVyL2NyZWRpdExpbWl0SGFuZGxlciI7CmltcG9ydCBzYWxlT3JkZXJIYW5kbGVyIGZyb20gIkAvc2NyaXB0cy90cmFuc2FjdGlvbkhhbmRsZXIiOwppbXBvcnQgSGVscGVyIGZyb20gIkAvaGVscGVyIjsKaW1wb3J0IHNldHRpbmdzSGFuZGxlciBmcm9tICJAL3NjcmlwdHMvc2V0dGluZ3NIYW5kbGVyIjsKCmNvbnN0IHN1cHBsaWVySGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9zdXBwbGllckhhbmRsZXIiKTsKLy8gaW1wb3J0IGtlbmRvIGZyb20gIkBwcm9ncmVzcy9rZW5kby11aSI7Cgpjb25zdCBwcm9qZWN0SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wcm9qZWN0SGFuZGxlciIpOwpjb25zdCBwcmljZUxldmVsSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wcmljZUxldmVsSGFuZGxlciIpOwpjb25zdCBjdXJyZW5jeUhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvY3VycmVuY3kvaGFuZGxlci9jdXJyZW5jeUhhbmRsZXIiKTsKCi8vIGNvbnN0IHNldHRpbmdzSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9zZXR0aW5nc0hhbmRsZXIiKTsKY29uc3QgZW1wbG95ZWVIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2VtcGxveWVlSGFuZGxlciIpOwpjb25zdCBsb2NhdGlvbkhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvbG9jYXRpb25IYW5kbGVyIik7Ci8vIGNvbnN0IHBheW1lbnRUZXJtSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wYXltZW50VGVybUhhbmRsZXIiKTsKY29uc3QgYWNjb3VudEhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvaGFuZGxlci9hY2NvdW50aW5nL2FjY291bnQiKTsKY29uc3QgcHJvZHVjdFZhcmlhbnRIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3Byb2R1Y3RWYXJpYW50SGFuZGxlciIpOwpjb25zdCB1b21QcmljZUhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvdW9tUHJpY2VIYW5kbGVyIik7CmNvbnN0IGRpc2NvdW50SXRlbUhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvZGlzY291bnRJdGVtSGFuZGxlciIpOwpjb25zdCBzZXR0aW5nSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9zZXR0aW5nSGFuZGxlciIpOwpjb25zdCBvdGhlckNoYXJnZUhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvb3RoZXJDaGFyZ2VIYW5kbGVyIik7CmNvbnN0IHB1cmNoYXNlRm9ybUNvbnRlbnRIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3B1cmNoYXNlRm9ybUNvbnRlbnRIYW5kbGVyIik7CmNvbnN0IHByZWZpeEhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvcHJlZml4SGFuZGxlciIpOwpjb25zdCBiaWxsaW5nSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9pbnZvaWNlL2hhbmRsZXIvYmlsbGluZ0hhbmRsZXIiKTsKCmNvbnN0IHB1cmNoYXNlTW9kZWwgPSBuZXcgUHVyY2hhc2VNb2RlbCh7fSk7CmNvbnN0IGl0ZW1MaW5lTW9kZWwgPSBuZXcgSXRlbUxpbmVNb2RlbCh7fSk7CmNvbnN0IHB1cmNoYXNlRm9ybUNvbnRlbnRNb2RlbCA9IG5ldyBQdXJjaGFzZUZvcm1Db250ZW50TW9kZWwoe30pOwpjb25zdCAkID0ga2VuZG8ualF1ZXJ5OwoKY29uc3QgdGV4dEZpZWxkID0gIm51bWJlck5hbWUiOwpjb25zdCBrZXlGaWVsZCA9ICJpZCI7CmNvbnN0IGRlZmF1bHRJdGVtID0geyBbdGV4dEZpZWxkXTogIlNlbGVjdCB2ZW5kb3IuLi4iLCBba2V5RmllbGRdOiBudWxsIH07CmNvbnN0IGVtcHR5SXRlbSA9IHsgW3RleHRGaWVsZF06ICJsb2FkaW5nIC4uLiIgfTsKY29uc3QgcGFnZVNpemUgPSAxMDsKY29uc3QgaXRlbUxpbmVQcmVmaXggPSAibGluLSI7CmNvbnN0IGxvYWRpbmdEYXRhID0gW107CndoaWxlIChsb2FkaW5nRGF0YS5sZW5ndGggPCBwYWdlU2l6ZSkgewogIGxvYWRpbmdEYXRhLnB1c2goeyAuLi5lbXB0eUl0ZW0gfSk7Cn0KY29uc3QgeyBDbGFzc0VkaXRvciB9ID0gcmVxdWlyZSgiQC9zY3JpcHRzL2tlbmRvX2VkaXRvci9Db2xsZWN0aW9ucyIpOwpjb25zdCBESVNDT1VOVF9UWVBFID0gIj90eXBlPVB1cmNoYXNlIjsKY29uc3QgVFJBTlNBQ1RJT05fVFlQRSA9ICJQdXJjaGFzZSI7CmNvbnN0IGNvb2tpZUpTID0gcmVxdWlyZSgiQC9jb29raWUuanMiKTsKY29uc3QgY29va2llID0gY29va2llSlMuZ2V0Q29va2llKCk7CmNvbnN0IE5BVFVSRSA9ICJwdXJjaGFzZSI7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiQ3JlZGl0UHVyY2hhc2UiLAogIHByb3BzOiBbImlkIiwgInRyYW5zYWN0aW9uRGF0ZSJdLAogIGNvbXBvbmVudHM6IHsKICAgIExvYWRpbmdNZTogKCkgPT4gaW1wb3J0KGBAL2NvbXBvbmVudHMvTG9hZGluZ2ApLAogICAgImFwcC1kYXRlcGlja2VyIjogKCkgPT4KICAgICAgaW1wb3J0KCJAL2NvbXBvbmVudHMvY3VzdG9tX3RlbXBsYXRlcy9EYXRlUGlja2VyQ29tcG9uZW50IiksCiAgICAvLyAibW9udGgtcGlja2VyIjogKCkgPT4gaW1wb3J0KCJAL2NvbXBvbmVudHMvY3VzdG9tX3RlbXBsYXRlcy9Nb250aFBpY2tlciIpLAogICAgZHJvcGRvd25saXN0OiBEcm9wRG93bkxpc3QsCiAgfSwKICBkYXRhOiAoKSA9PiAoewogICAgaXNFZGl0OiBmYWxzZSwKICAgIHNob3dMb2FkaW5nVHhuOiBmYWxzZSwKICAgIHNob3dMb2FkaW5nVHhuQWRkaXRpb25hbENvc3Q6IGZhbHNlLAogICAgbU90aGVyQ2hhcmdlOiBbXSwKICAgIG1PdGhlckNoYXJnZUFtb3VudDogW10sCiAgICBwdXJjaGFzZU9yZGVyczogW10sCiAgICBudW1TZWxlY3Q6IFsxXSwKICAgIGRpYWxvZ1RheDogZmFsc2UsCiAgICB2ZW5kb3JMaXN0OiBbXSwKICAgIHNob3dMb2FkaW5nOiBmYWxzZSwKICAgIGJpbGxfZGF0ZTogIiIsCiAgICBhbGVydDogZmFsc2UsCiAgICBmaWxlczogW10sCiAgICAvLyBGb3JtIHZhbGlkYXRpb24KICAgIHZhbGlkOiB0cnVlLAogICAgaXRlbUxpbmVzOiBbXSwKICAgIHR4bkRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zdWJzdHIoMCwgMTApLAogICAgYmlsbERhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zdWJzdHIoMCwgMTApLAogICAgaW52b2ljZURhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zdWJzdHIoMCwgMTApLAogICAgbW9udGhPZjogIiIsCiAgICB0ZW1wbGF0ZXM6IFt7IHRpdGxlOiAiUHVyY2hhc2UiLCB2YWx1ZTogIlB1cmNoYXNlIiB9XSwKICAgIGlzSGlkZUJhcjogZmFsc2UsCiAgICB2ZW5kb3I6IHt9LAogICAgZGVmYXVsdEl0ZW06IGRlZmF1bHRJdGVtLAogICAgcHVyY2hhc2U6IHB1cmNoYXNlTW9kZWwsCiAgICB0cmFuc2FjdGlvblR5cGU6IFsiSW52b2ljZSIsICJDb21tZXJjaWFsIEludm9pY2UiLCAiVGF4IEludm9pY2UiXSwKICAgIGN1c0Jhc2VVcmw6IHN1cHBsaWVySGFuZGxlci5zZWFyY2goKSwKICAgIGVtcEJhc2VVcmw6IGVtcGxveWVlSGFuZGxlci5zZWFyY2goKSwKICAgIGluaXQ6IHsgbWV0aG9kOiAiR0VUIiwgYWNjZXB0OiAiYXBwbGljYXRpb24vanNvbiIsIGhlYWRlcnM6IFtdIH0sCiAgICBwZW5kaW5nUmVxdWVzdDogdW5kZWZpbmVkLAogICAgcmVxdWVzdFN0YXJ0ZWQ6IGZhbHNlLAogICAgc2tpcDogMCwKICAgIHRlbXBTa2lwOiBudWxsLAogICAgdG90YWw6IDAsCiAgICBmaWx0ZXI6ICIiLAogICAgcmVmZXJlbmNlTm86ICIiLAogICAgZmlsdGVyXzogIiIsCiAgICB0ZXh0RmllbGQ6ICJudW1iZXJOYW1lIiwKICAgIGRhdGFJdGVtS2V5OiAiaWQiLAogICAgc2VnbWVudHM6IFtdLAogICAgZW1wbG95ZWVzOiBbXSwKICAgIG1ldGhvZHM6IFsiUXR5IEJhc2VkIiwgIkFtb3VudCBCYXNlZCJdLAogICAgbUVtcGxveWVlOiB7fSwKICAgIGN1c3RvbWVyUHJvamVjdHM6IFtdLAogICAgYmlsbGluZ0FkZHJlc3M6IFtdLAogICAgZGVsaXZlcnlBZGRyZXNzOiBbXSwKICAgIGRlbGl2ZXJ5RGF0ZVRpbWU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zdWJzdHIoMCwgMTApLAogICAgcHJpY2VMZXZlbDogW10sCiAgICBsb2NhdGlvbnM6IFtdLAogICAgcGF5bWVudFRlcm1zOiBbXSwKICAgIGFjY1BheWFibGU6IFtdLAogICAgY3VycmVuY2llczogW10sCiAgICBpdGVtTGluZTogaXRlbUxpbmVNb2RlbCwKICAgIHVvbXM6IFtdLAogICAgdGF4OiBbXSwKICAgIHNwZWNpZmljRGlzY291bnRJdGVtOiBbXSwKICAgIG90aGVyQ2hhcmdlTGlzdDogW10sCiAgICBkZXBvc2l0QmFsYW5jZTogMCwKICAgIHNjaGVtYURlZmluaXRpb246IHsKICAgICAgbW9kZWw6IHsKICAgICAgICBpZDogImlkIiwKICAgICAgfSwKICAgIH0sCiAgICBwdXJjaGFzZUZvcm1Db250ZW50OiBwdXJjaGFzZUZvcm1Db250ZW50TW9kZWwsCiAgICBDbGFzc0VkaXRvcjogQ2xhc3NFZGl0b3IsCiAgICB0YXhMaXN0VG90YWw6IHt9LAogICAgcHVyY2hhc2VUeXBlczogW10sCiAgICB0YXhMaXN0RGV0YWlsOiBbXSwKICAgIHN1cHBsaWVyRGlzY291bnRJdGVtOiBbXSwKICAgIGxhdGVGZWVMaXN0OiBbXSwKICAgIGxvZ2dlZFVzZXI6IHsKICAgICAgaWQ6IGNvb2tpZS5jcmVhdG9yLAogICAgICBuYW1lOiBjb29raWUuZW1haWwsCiAgICB9LAogICAgZXhjaGFuZ2VSYXRlOiB7fSwKICAgIGJhc2VDdXJyZW5jeUNvZGU6ICIiLAogICAgY3VycmVuY3lDb2RlOiAiIiwKICAgIHRyYW5zYWN0aW9uUmF0ZTogMSwKICAgIGpSYXc6IFtdLAogICAgcmVmRnJvbTogW10sCiAgICBpc1ByaWNlTGV2ZWxDaGFuZ2VkOiBmYWxzZSwKICAgIGV4cGVuc2VzOiBbXSwKICAgIGFkZGl0aW9uYWxDb3N0VG90YWw6IDAsCiAgICBjaGtDaGVja2VkOiBbXSwKICAgIGFjY1dpdGhob2xkaW5nRXhwZW5zZTogW10sCiAgfSksCiAgbWV0aG9kczogewogICAgZGF0YUJvdW5kOiBmdW5jdGlvbiAoZSkgewogICAgICBjb25zdCBncmlkID0ga2VuZG8ualF1ZXJ5KCIjZ3JpZEl0ZW1MaW5lIikuZGF0YSgia2VuZG9HcmlkIik7CiAgICAgIGNvbnN0IGl0ZW1zID0gZS5zZW5kZXIuaXRlbXMoKTsKICAgICAgaWYgKGdyaWQpIHsKICAgICAgICBpdGVtcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGxldCBkYXRhSXRlbSA9IGdyaWQuZGF0YUl0ZW0odGhpcyk7CiAgICAgICAgICAkKCJ0cltkYXRhLXVpZD0nIiArIGRhdGFJdGVtLnVpZCArICInXSIpCiAgICAgICAgICAgIC5maW5kKCIuaXNFZGl0YWJsZSIpCiAgICAgICAgICAgIC5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaXNFZGl0YWJsZSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoImstc3RhdGUtZGlzYWJsZWQiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgb25NZXRob2RDaGFuZ2VkKCkgewogICAgICBpZiAodGhpcy5pc0l0ZW0oKSkgewogICAgICAgIHRoaXMuY2FsY3VsYXRlQWRkaXRpb25hbENvc3QoKTsKICAgICAgICB0aGlzLmF1dG9DYWxjdWxhdGUoKTsKICAgICAgfQogICAgfSwKICAgIG9uQ2hlY2tDaGFuZ2VkKCkgewogICAgICBpZiAodGhpcy5pc0l0ZW0oKSkgewogICAgICAgIHRoaXMuYWRkaXRpb25hbENvc3RUb3RhbCA9IDA7CiAgICAgICAgdGhpcy5qUmF3ID0gW107CiAgICAgICAgaWYgKHRoaXMuY2hrQ2hlY2tlZCkgewogICAgICAgICAgdGhpcy5jaGtDaGVja2VkLmZvckVhY2goKG0pID0+IHsKICAgICAgICAgICAgaWYgKG0pIHsKICAgICAgICAgICAgICBjb25zdCB4QW1vdW50ID0gbS5leGNoYW5nZUFtb3VudCB8fCAwOwogICAgICAgICAgICAgIHRoaXMuYWRkaXRpb25hbENvc3RUb3RhbCArPSBwYXJzZUZsb2F0KHhBbW91bnQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMucHVyY2hhc2UuYWRkaXRpb25hbENvc3QgPSB0aGlzLmNoa0NoZWNrZWQ7CiAgICAgICAgICB0aGlzLnB1cmNoYXNlLmFkZGl0aW9uYWxDb3N0VG90YWwgPSB0aGlzLmFkZGl0aW9uYWxDb3N0VG90YWw7CiAgICAgICAgICAvLyBpZiAodGhpcy5wdXJjaGFzZS5hZGRpdGlvbmFsQ29zdE1ldGhvZCA9PT0gJ1F0eSBCYXNlZCcpIHsKICAgICAgICAgIC8vICAgICB0aGlzLnBlcmNlbnRhZ2VBcHBsaWVkKCkKICAgICAgICAgIC8vIH0gZWxzZSB7CiAgICAgICAgICAvLyAgICAgdGhpcy5hbW91bnRBcHBsaWVkKCkKICAgICAgICAgIC8vIH0KICAgICAgICAgIHRoaXMuY2FsY3VsYXRlQWRkaXRpb25hbENvc3QoKTsKICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIG9uUHJpY2VMZXZlbENoYW5nZSgpIHsKICAgICAgdGhpcy5pc1ByaWNlTGV2ZWxDaGFuZ2VkID0gdHJ1ZTsKICAgICAgdGhpcy5sb2FkVHJhbnNhY3Rpb25SYXRlKCk7CiAgICAgIHRoaXMuY2xlYXJVT01JdGVtKCk7CiAgICB9LAogICAgYXN5bmMgY2xlYXJVT01JdGVtKCkgewogICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLml0ZW1MaW5lRFMua2VuZG9XaWRnZXQoKTsKICAgICAgZHMuZGF0YSgpLm1hcCgobikgPT4gewogICAgICAgIG4uc2V0KCJ1b20iLCB7fSk7CiAgICAgIH0pOwogICAgICB0aGlzLmlzUHJpY2VMZXZlbENoYW5nZWQgPSBmYWxzZTsKICAgIH0sCiAgICBhc3luYyBsb2FkUGF5bWVudFRlcm1MaXN0KCkgewogICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgIGlmICh0aGlzLnZlbmRvcikgewogICAgICAgICAgICBjb25zdCBzdHJGaWx0ZXIgPQogICAgICAgICAgICAgICI/aWQ9IiArCiAgICAgICAgICAgICAgdGhpcy52ZW5kb3IuaWQgKwogICAgICAgICAgICAgICImdHJhbnNhY3Rpb25EYXRlPSIgKwogICAgICAgICAgICAgIHRoaXMucHVyY2hhc2UudHJhbnNhY3Rpb25EYXRlICsKICAgICAgICAgICAgICAiJnR5cGU9VmVuZG9yIjsKICAgICAgICAgICAgdGhpcy5wdXJjaGFzZS5wYXltZW50VGVybSA9IHt9OwogICAgICAgICAgICBwYXltZW50VGVybUhhbmRsZXJfLmdldChzdHJGaWx0ZXIpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRlcm1zID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2UucGF5bWVudFRlcm0gPSB0ZXJtcy50ZXJtOwogICAgICAgICAgICAgICAgdGhpcy5vblBheW1lbnRUZXJtQ2hhbmdlZCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgMTApOwogICAgICB9KTsKICAgIH0sCiAgICBhc3luYyBsb2FkQ3JlZGl0TGltaXQoKSB7CiAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgaWYgKHRoaXMudmVuZG9yKSB7CiAgICAgICAgICAgIGNvbnN0IHN0ckZpbHRlciA9CiAgICAgICAgICAgICAgIj9pZD0iICsKICAgICAgICAgICAgICB0aGlzLnZlbmRvci5pZCArCiAgICAgICAgICAgICAgIiZ0cmFuc2FjdGlvbkRhdGU9IiArCiAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZS50cmFuc2FjdGlvbkRhdGUgKwogICAgICAgICAgICAgICImdHlwZT1WZW5kb3IiOwogICAgICAgICAgICB0aGlzLnB1cmNoYXNlLmNyZWRpdExpbWl0ID0gMDsKICAgICAgICAgICAgY3JlZGl0TGltaXRIYW5kbGVyLmdldChzdHJGaWx0ZXIpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNyZWRpdCA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlLmNyZWRpdExpbWl0ID0ga2VuZG8ucGFyc2VGbG9hdCgKICAgICAgICAgICAgICAgICAgY3JlZGl0LmFtb3VudCB8fCAwCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgMTApOwogICAgICB9KTsKICAgIH0sCiAgICBhc3luYyBvYnNlcnZlckNsZWFuKG9iaikgewogICAgICByZXR1cm4gT2JqZWN0LmtleXMob2JqKS5yZWR1Y2UoCiAgICAgICAgKHJlcywgZSkgPT4gT2JqZWN0LmFzc2lnbihyZXMsIHsgW2VdOiBvYmpbZV0gfSksCiAgICAgICAge30KICAgICAgKTsKICAgIH0sCiAgICBIZWxwKGtleV9zZWFyY2gpIHsKICAgICAgU2hvd1Jlc291cmNlKGtleV9zZWFyY2gpOwogICAgfSwKICAgIEFtb3VudEVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAga2VuZG8KICAgICAgICAualF1ZXJ5KCc8aW5wdXQgZGF0YS1iaW5kPSJ2YWx1ZTonICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgLmtlbmRvTnVtZXJpY1RleHRCb3goewogICAgICAgICAgZGVjaW1hbHM6IDMwLAogICAgICAgICAgZm9ybWF0OiBgJHt0aGlzLnB1cmNoYXNlRm9ybUNvbnRlbnQuZGVjaW1hbH1gLAogICAgICAgIH0pOwogICAgfSwKICAgIHZhdFRlbXBsYXRlKGRhdGFJdGVtKSB7CiAgICAgIGNvbnN0IHZhdCA9IGRhdGFJdGVtLnZhdFRheCB8fCB7fTsKICAgICAgaWYgKHZhdCkgewogICAgICAgIHJldHVybiBgPHNwYW4+JHt2YXQuZGVmYXVsdFRheCA/IHZhdC5kZWZhdWx0VGF4IDogYGB9PC9zcGFuPmA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGBgOwogICAgICB9CiAgICB9LAogICAgaXRlbVRlbXBsYXRlKGRhdGFJdGVtKSB7CiAgICAgIGNvbnN0IGl0ZW0gPSBkYXRhSXRlbS5pdGVtOwogICAgICBpZiAoaXRlbSkgewogICAgICAgIHJldHVybiBgPHNwYW4+JHtpdGVtLm5hbWUgPyBpdGVtLm5hbWUgOiBgYH08L3NwYW4+YDsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gYGA7CiAgICAgIH0KICAgIH0sCiAgICBVT01UZW1wbGF0ZShkYXRhSXRlbSkgewogICAgICBjb25zdCB1b20gPSBkYXRhSXRlbS51b20gfHwge307CiAgICAgIGNvbnN0IGNvZGUgPSB1b20uY29kZSB8fCAiIjsKICAgICAgaWYgKHVvbSkgewogICAgICAgIHJldHVybiBgPHNwYW4+JHt1b20udW9tID8gY29kZSA6IGBgfTwvc3Bhbj5gOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBgYDsKICAgICAgfQogICAgfSwKICAgIGRpc2NvdW50SXRlbVRlbXBsYXRlKGRhdGFJdGVtKSB7CiAgICAgIGNvbnN0IGRpc2NvdW50SXRlbSA9IGRhdGFJdGVtLmRpc2NvdW50SXRlbTsKICAgICAgaWYgKGRpc2NvdW50SXRlbSkgewogICAgICAgIHJldHVybiBgPHNwYW4+JHtkaXNjb3VudEl0ZW0uY29kZSA/IGRpc2NvdW50SXRlbS5jb2RlIDogYGB9IC0gJHsKICAgICAgICAgIGRpc2NvdW50SXRlbS5uYW1lID8gZGlzY291bnRJdGVtLm5hbWUgOiBgYAogICAgICAgIH08L3NwYW4+YDsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gYGA7CiAgICAgIH0KICAgIH0sCiAgICBhZGRTZWxlY3QoKSB7CiAgICAgIGxldCBhbW91bnRfbnVtID0gdGhpcy5udW1TZWxlY3QubGVuZ3RoOwogICAgICBsZXQgbnVtID0gdGhpcy5udW1TZWxlY3RbYW1vdW50X251bSAtIDFdOwogICAgICBsZXQgbmV3X251bSA9IG51bSArIDE7CiAgICAgIGxldCBsZW5naHRJdGVtID0gdGhpcy5zcGVjaWZpY0Rpc2NvdW50SXRlbS5sZW5ndGg7CiAgICAgIGlmIChuZXdfbnVtIDw9IGxlbmdodEl0ZW0pIHsKICAgICAgICB0aGlzLm51bVNlbGVjdC5wdXNoKG5ld19udW0pOwogICAgICB9CiAgICB9LAogICAgcmVtb3ZlU2VsZWN0KGluZGV4KSB7CiAgICAgIHRoaXMubnVtU2VsZWN0LnNwbGljZShpbmRleCwgMSk7CiAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyhpbmRleCwgdGhpcy5udW1TZWxlY3QpCiAgICAgIC8vIHRoaXMuc2VsZWN0RGlzY291bnQuc3BsaWNlKGluZGV4LDEpCiAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZygicmVtb3ZlIix0aGlzLnNlbGVjdERpc2NvdW50KQogICAgICAvLyB0aGlzLnNlbGVjdERpc2NvdW50ID0gdGhpcy5zZWxlY3REaXNjb3VudC5maWx0ZXIoaXRlbSA9PiAgaXRlbS5pZCAhPSB2YWwuaWQpOwogICAgfSwKICAgIG9uT3RoZXJDaGFyZ2VDaGFuZ2UoKSB7CiAgICAgIGxldCBvdGhlckNoYXJnZSA9IDA7CiAgICAgIHRoaXMubU90aGVyQ2hhcmdlLmZvckVhY2goKG0pID0+IHsKICAgICAgICBvdGhlckNoYXJnZSArPSB0aGlzLmF1dG9DYWxjdWxhdGVEaXNjb3VudChtLCB0aGlzLnB1cmNoYXNlLnN1YlRvdGFsKTsKICAgICAgfSk7CiAgICAgIHRoaXMucHVyY2hhc2Uub3RoZXJDaGFyZ2VBbW91bnQgPSBvdGhlckNoYXJnZTsKICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlKCk7CiAgICB9LAogICAgb25PdGhlckFtb3VudCh2YWx1ZSkgewogICAgICByZXR1cm4gdGhpcy5hdXRvQ2FsY3VsYXRlRGlzY291bnQodmFsdWUsIHRoaXMucHVyY2hhc2Uuc3ViVG90YWwpOwogICAgfSwKICAgIG9uU3BlY2lmaWNEaXNjb3VudENoYW5nZWQoKSB7CiAgICAgIHRoaXMucHVyY2hhc2Uuc3BlY2lmaWNEaXNjb3VudFRvdGFsID0gMDsKICAgICAgaWYgKHRoaXMucHVyY2hhc2Uuc3BlY2lmaWNEaXNjb3VudEl0ZW0pIHsKICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coJy1jaGFuZ2VkJywgdGhpcy5wdXJjaGFzZS5zcGVjaWZpY0Rpc2NvdW50SXRlbSkKICAgICAgICB0aGlzLnB1cmNoYXNlLnNwZWNpZmljRGlzY291bnRUb3RhbCA9CiAgICAgICAgICB0aGlzLmF1dG9DYWxjdWxhdGVEaXNjb3VudCgKICAgICAgICAgICAgdGhpcy5wdXJjaGFzZS5zcGVjaWZpY0Rpc2NvdW50SXRlbSwKICAgICAgICAgICAgdGhpcy5wdXJjaGFzZS5zdWJUb3RhbAogICAgICAgICAgKSB8fCAwOwogICAgICAgIHRoaXMucHVyY2hhc2UudG90YWwgPQogICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh0aGlzLnB1cmNoYXNlLnN1YlRvdGFsKSAtCiAgICAgICAgICAoa2VuZG8ucGFyc2VGbG9hdCh0aGlzLnB1cmNoYXNlLmRpc2NvdW50VG90YWwpICsKICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh0aGlzLnB1cmNoYXNlLnRvdGFsVGF4QW1vdW50KSkgLQogICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlRGlzY291bnQoCiAgICAgICAgICAgIHRoaXMucHVyY2hhc2Uuc3BlY2lmaWNEaXNjb3VudEl0ZW0sCiAgICAgICAgICAgIHRoaXMucHVyY2hhc2Uuc3ViVG90YWwKICAgICAgICAgICk7CiAgICAgIH0KICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlKCk7CiAgICB9LAogICAgZW1wSW1wbChkYXRhSXRlbSkgewogICAgICBsZXQgZW1wSWRzID0gW107CiAgICAgIGRhdGFJdGVtLmVtcGxveWVlLmZvckVhY2goKG0pID0+IHsKICAgICAgICBlbXBJZHMucHVzaChtLmZpcnN0TmFtZSArICIgLSAiICsgbS5sYXN0TmFtZSk7CiAgICAgIH0pOwogICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coZW1wSWRzLmpvaW4oJywgJykpCiAgICAgIHJldHVybiBgPHNwYW4+JHtlbXBJZHMuam9pbigiLCAiKX08L3NwYW4+YDsKICAgIH0sCiAgICB1b21UbXAoZGF0YUl0ZW0pIHsKICAgICAgd2luZG93LmNvbnNvbGUubG9nKGRhdGFJdGVtKTsKICAgICAgcmV0dXJuIGRhdGFJdGVtOwogICAgfSwKICAgIG9uSW52b2ljZVR5cGVDaGFuZ2VkKCkgewogICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkID09PSBudWxsIHx8IHRoaXMuJHJvdXRlLnBhcmFtcy5pZCA9PT0gIiIpIHsKICAgICAgICB0aGlzLmdlbmVyYXRlTnVtYmVyKCk7CiAgICAgIH0KICAgIH0sCiAgICBhdXRvQ2FsY3VsYXRlVGF4QnlUeXBlKHRheCkgewogICAgICAvLyByZXR1cm4gYnkgYSBrZXkKICAgICAgY29uc3QgZ3JvdXBBbGwgPSAobGlzdCkgPT4KICAgICAgICBsaXN0LnJlZHVjZSgodGF4LCBpdGVtKSA9PiB7CiAgICAgICAgICBjb25zdCB0YXhBbW91bnQgPSB0YXhbaXRlbS5uYW1lXSB8fCAwOwogICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIHRheCwgewogICAgICAgICAgICBbaXRlbS5uYW1lXTogdGF4QW1vdW50ICsgcGFyc2VGbG9hdChpdGVtLmFtb3VudCksCiAgICAgICAgICB9KTsKICAgICAgICB9LCB7fSk7CiAgICAgIHRoaXMudGF4TGlzdFRvdGFsID0gZ3JvdXBBbGwodGF4KTsKICAgICAgd2luZG93LmNvbnNvbGUubG9nKCJuaW1vbCIsIGdyb3VwQWxsKHRheCkpOwogICAgfSwKICAgIG9uRGVwb3NpdERlZHVjdGlvbkNoYW5nZSgpIHsKICAgICAgY29uc3QgZGVkdWN0ID0gcGFyc2VGbG9hdCh0aGlzLnB1cmNoYXNlLmRlcG9zaXREZWR1Y3Rpb24gfHwgMCk7CiAgICAgIGlmIChkZWR1Y3QgPCAwKSB7CiAgICAgICAgdGhpcy5wdXJjaGFzZS5kZXBvc2l0RGVkdWN0aW9uID0gMDsKICAgICAgfQogICAgICBpZiAoCiAgICAgICAgdGhpcy5wdXJjaGFzZS5kZXBvc2l0RGVkdWN0aW9uID09PSAiIiB8fAogICAgICAgIHRoaXMucHVyY2hhc2UuZGVwb3NpdERlZHVjdGlvbiA9PT0gdW5kZWZpbmVkCiAgICAgICkgewogICAgICAgIHRoaXMucHVyY2hhc2UuZGVwb3NpdERlZHVjdGlvbiA9IDA7CiAgICAgIH0KICAgICAgY29uc3QgZGVkdWN0aW9uID0gcGFyc2VGbG9hdCh0aGlzLnB1cmNoYXNlLmRlcG9zaXREZWR1Y3Rpb24pIHx8IDA7CiAgICAgIGlmIChkZWR1Y3Rpb24gPiB0aGlzLnB1cmNoYXNlLmRlcG9zaXRBbW91bnQpIHsKICAgICAgICB0aGlzLnB1cmNoYXNlLmRlcG9zaXREZWR1Y3Rpb24gPSB0aGlzLnB1cmNoYXNlLmRlcG9zaXRBbW91bnQ7CiAgICAgIH0KCiAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpOwogICAgfSwKICAgIGFzeW5jIGF1dG9DYWxjdWxhdGUoKSB7CiAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuaXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpLAogICAgICAgIHN1YlRvdGFsID0gMCwKICAgICAgICB0b3RhbFRheCA9IDAsCiAgICAgICAgZGlzY291bnRUb3RhbCA9IDAsCiAgICAgICAgc3BUYXggPSAwLAogICAgICAgIHBsdGF4ID0gMCwKICAgICAgICBvdGhlclRheCA9IDAsCiAgICAgICAgdmF0VGF4ID0gMCwKICAgICAgICBkaXNjb3VudEludm9pY2UgPSAwLAogICAgICAgIHRheExpc3QgPSBbXSwKICAgICAgICB0YXhMaXN0RGV0YWlsID0gW10sCiAgICAgICAgZGlzY291bnRJdGVtID0gW10sCiAgICAgICAgZGlzY291bnRMaW5lID0gW10sCiAgICAgICAgaW5jbHVzaXZlVGF4ID0gMCwKICAgICAgICB0YXhUeXBlSWQgPSAwLAogICAgICAgIHdpdGhob2xkaW5nVGF4QW1vdW50ID0gMCwKICAgICAgICB3aFRheEFtb3VudCA9IDAsCiAgICAgICAgaXRlbVN1YnRvdGFsID0gMCwKICAgICAgICB0eG5JdG1TdWJ0b3RhbCA9IDAsCiAgICAgICAgc2VydmljZVN1YnRvdGFsID0gMCwKICAgICAgICBpdGVtRGlzY291bnQgPSAwLAogICAgICAgIHNlcnZpY2VEaXNjb3VudCA9IDAsCiAgICAgICAgdHhuRGlzY291bnQgPSAwOwogICAgICBsZXQgbmF0dXJlID0gIiI7CiAgICAgIHRoaXMualJhdyA9IFtdOwogICAgICBjb25zdCByb3dzID0gZHMuZGF0YSgpLmZpbHRlcigobSkgPT4gcGFyc2VGbG9hdChtLmFtb3VudCkgPiAwKTsKICAgICAgcm93cy5mb3JFYWNoKCh2YWx1ZSkgPT4gewogICAgICAgIGxldCBtb2RpZmllclByaWNlID0gMCwKICAgICAgICAgIGluY1RheCA9IDA7CiAgICAgICAgaWYgKHZhbHVlLm1vZGlmaWVyKSB7CiAgICAgICAgICBtb2RpZmllclByaWNlID0ga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5tb2RpZmllci5wcmljZSk7CiAgICAgICAgfQoKICAgICAgICBsZXQgZGlzY291bnQgPSAwOwogICAgICAgIGlmICh2YWx1ZS5kaXNjb3VudEl0ZW0pIHsKICAgICAgICAgIGNvbnN0IGRpc0l0ZW1GaWVsZCA9IHZhbHVlLmRpc2NvdW50SXRlbTsKICAgICAgICAgIGxldCBzdWJUbyA9CiAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuY29zdCkgKiBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnF0eSk7CiAgICAgICAgICBkaXNjb3VudCA9IHRoaXMuYXV0b0NhbGN1bGF0ZURpc2NvdW50KHZhbHVlLmRpc2NvdW50SXRlbSwgc3ViVG8pOwogICAgICAgICAgdmFsdWVbImRpc2NvdW50QW1vdW50Il0gPSBkaXNjb3VudDsKICAgICAgICAgIHZhbHVlWyJkaXNjb3VudEV4Y2hhbmdlQW1vdW50Il0gPQogICAgICAgICAgICBkaXNjb3VudCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5wdXJjaGFzZS50eG5SYXRlKTsKICAgICAgICAgIGlmICh2YWx1ZS5kaXNjb3VudEl0ZW0uaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgZGlzY291bnRJdGVtLnB1c2godmFsdWUuZGlzY291bnRJdGVtKTsKICAgICAgICAgIH0KICAgICAgICAgIGRpc2NvdW50VG90YWwgKz0gZGlzY291bnQgPyBkaXNjb3VudCA6IDA7CiAgICAgICAgICBpZiAoZGlzY291bnQgKiAtMSA+IDApIHsKICAgICAgICAgICAgbmF0dXJlID0gImRyIjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5hdHVyZSA9ICJjciI7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZGlzSXRlbUZpZWxkLmFjY291bnQpIHsKICAgICAgICAgICAgaWYgKGRpc0l0ZW1GaWVsZC5hY2NvdW50Lmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgdGhpcy5qUmF3LnB1c2goewogICAgICAgICAgICAgICAgaWQ6IGRpc0l0ZW1GaWVsZC5hY2NvdW50LmlkICsgIi0iICsgbmF0dXJlLAogICAgICAgICAgICAgICAgbGluZTogbmV3IEl0ZW1MaW5lTW9kZWwodmFsdWUpLAogICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICJQdXJjaGFzZSBEaXNjb3VudCIsCiAgICAgICAgICAgICAgICBhY2NvdW50OiBkaXNJdGVtRmllbGQuYWNjb3VudCwKICAgICAgICAgICAgICAgIGFjY291bnRJZDogZGlzSXRlbUZpZWxkLmFjY291bnQuaWQsCiAgICAgICAgICAgICAgICBhbW91bnQ6IGRpc2NvdW50ICogLTEsCiAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDoKICAgICAgICAgICAgICAgICAgZGlzY291bnQgKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMucHVyY2hhc2UudHhuUmF0ZSkgKiAtMSwKICAgICAgICAgICAgICAgIHR5cGU6IG5hdHVyZSwKICAgICAgICAgICAgICAgIHR5cGVBczogImRpc2NvdW50IiwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAodmFsdWUudmF0VGF4KSB7CiAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coJ1ZhdCBUYXgnLCB2YWx1ZS50YXgpCiAgICAgICAgICBsZXQgYW10ID0KICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdChzcFRheCA/IHNwVGF4IDogMCkgKwogICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHBsdGF4ID8gcGx0YXggOiAwKSArCiAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQob3RoZXJUYXggPyBvdGhlclRheCA6IDApICsKICAgICAgICAgICAgKGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuYW1vdW50ID8gdmFsdWUuYW1vdW50IDogMCkgLQogICAgICAgICAgICAgIChkaXNjb3VudCA/IGRpc2NvdW50IDogMCkpOwogICAgICAgICAgdmF0VGF4ID0gdGhpcy5hdXRvQ2FsY3VsYXRlVGF4KHZhbHVlLnZhdFRheCwgYW10KTsKICAgICAgICAgIHZhdFRheCA9IGtlbmRvLnBhcnNlRmxvYXQodmF0VGF4KSA/IGtlbmRvLnBhcnNlRmxvYXQodmF0VGF4KSA6IDA7CiAgICAgICAgICB2YWx1ZVsidmF0VGF4QW1vdW50Il0gPSB2YXRUYXg7CiAgICAgICAgICB2YWx1ZVsidmF0VGF4RXhjaGFuZ2VBbW91bnQiXSA9CiAgICAgICAgICAgIHZhdFRheCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5wdXJjaGFzZS50eG5SYXRlKTsKICAgICAgICAgIGNvbnN0IHRheCA9IHZhbHVlLnZhdFRheCB8fCB7fTsKICAgICAgICAgIGNvbnN0IGJhc2VBbW91bnQgPSB0YXguYmFzZUFtb3VudCB8fCAiIjsKICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0YXgsICJpbSB0YXgiKTsKICAgICAgICAgIGlmIChiYXNlQW1vdW50KSB7CiAgICAgICAgICAgIGlmIChiYXNlQW1vdW50LnRvTG93ZXJDYXNlKCkgPT09ICJpbmNsdXNpdmUiKSB7CiAgICAgICAgICAgICAgaW5jVGF4ID0gdmF0VGF4OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGluY2x1c2l2ZVRheCArPSB2YXRUYXg7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmICh2YWx1ZS52YXRUYXguaGFzT3duUHJvcGVydHkoInRheFR5cGUiKSkgewogICAgICAgICAgICB0YXhMaXN0LnB1c2goewogICAgICAgICAgICAgIG5hbWU6IHZhbHVlLnZhdFRheC50YXhUeXBlLm5hbWUsCiAgICAgICAgICAgICAgYW1vdW50OiB2YXRUYXgsCiAgICAgICAgICAgICAgaWQ6IHZhbHVlLnZhdFRheC50YXhUeXBlLmlkLAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc3QgdmF0VGF4XyA9IHZhbHVlLnZhdFRheCB8fCB7fTsKICAgICAgICAgICAgdmF0VGF4X1sidGF4QW1vdW50XyJdID0gdmF0VGF4OwogICAgICAgICAgICB2YXRUYXhfWyJhbW91bnQiXSA9IHZhbHVlLmFtb3VudCB8fCAwOwogICAgICAgICAgICB2YXRUYXhfWyJkaXNjb3VudCJdID0gZGlzY291bnQgfHwgMDsKICAgICAgICAgICAgdmF0VGF4X1sidHhuUmF0ZSJdID0gdGhpcy5wdXJjaGFzZS50eG5SYXRlIHx8IDE7CiAgICAgICAgICAgIHZhdFRheF9bImlzVmF0Il0gPSAxOwogICAgICAgICAgICB2YXRUYXhfLmRldGFpbCA9IHsKICAgICAgICAgICAgICBzcGVjaWZpY1RheDoge30sCiAgICAgICAgICAgICAgcHVibGljTGlnaHRpbmdUYXg6IHt9LAogICAgICAgICAgICAgIG90aGVyVGF4OiB7fSwKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGF4TGlzdERldGFpbC5wdXNoKHZhdFRheF8pOwogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coInZhdF8iLCB2YXRUYXhfKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh2YWx1ZS52YXRUYXguaGFzT3duUHJvcGVydHkoInRheFR5cGUiKSkgewogICAgICAgICAgICBjb25zdCB0YXhUeXBlID0gdmFsdWUudmF0VGF4LnRheFR5cGUgfHwge307CiAgICAgICAgICAgIHRheFR5cGVJZCA9IHRheFR5cGUudHlwZUlkIHx8IDA7CiAgICAgICAgICB9CiAgICAgICAgICBsZXQgdGF4QW1vdW50ID0gdmF0VGF4OwogICAgICAgICAgbGV0IHRheERlc2NyaXB0aW9uID0gIiI7CiAgICAgICAgICBpZiAodGF4VHlwZUlkID09PSAxKSB7CiAgICAgICAgICAgIG5hdHVyZSA9ICJkciI7CiAgICAgICAgICAgIHRheEFtb3VudCA9IHZhdFRheDsKICAgICAgICAgICAgdGF4RGVzY3JpcHRpb24gPSAiUHVyY2hhc2UgVGF4IjsKICAgICAgICAgIH0gZWxzZSBpZiAodGF4VHlwZUlkID09PSAyKSB7CiAgICAgICAgICAgIHdpdGhob2xkaW5nVGF4QW1vdW50ICs9IHZhdFRheDsKICAgICAgICAgICAgaWYgKHRheFR5cGVJZCA9PT0gMiAmJiBiYXNlQW1vdW50LnRvTG93ZXJDYXNlKCkgPT09ICJuZXQiKSB7CiAgICAgICAgICAgICAgd2hUYXhBbW91bnQgKz0gdmF0VGF4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIG5hdHVyZSA9ICJjciI7CiAgICAgICAgICAgIHRheEFtb3VudCA9IHZhdFRheCAqIC0xOwogICAgICAgICAgICB0YXhEZXNjcmlwdGlvbiA9ICJXaXRoaG9sZGluZyBUYXgiOwogICAgICAgICAgfSBlbHNlIGlmICh0YXhUeXBlSWQgPT09IDEwKSB7CiAgICAgICAgICAgIG5hdHVyZSA9ICJjciI7CiAgICAgICAgICAgIHRheEFtb3VudCA9IDA7CiAgICAgICAgICAgIHRheERlc2NyaXB0aW9uID0gIk5vIFRheCI7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGF4QW1vdW50ID4gMCkgewogICAgICAgICAgICBuYXR1cmUgPSAiZHIiOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmF0dXJlID0gImNyIjsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHZhdFRheEZpZWxkID0gdmFsdWUudmF0VGF4IHx8IHt9OwogICAgICAgICAgaWYgKHRheEFtb3VudCAhPT0gMCkgewogICAgICAgICAgICBpZiAodmF0VGF4RmllbGQpIHsKICAgICAgICAgICAgICBpZiAodmF0VGF4RmllbGQuYWNjb3VudCkgewogICAgICAgICAgICAgICAgaWYgKHZhdFRheEZpZWxkLmFjY291bnQuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5qUmF3LnB1c2goewogICAgICAgICAgICAgICAgICAgIGlkOiB2YXRUYXhGaWVsZC5hY2NvdW50LmlkICsgIi0iICsgbmF0dXJlLAogICAgICAgICAgICAgICAgICAgIGxpbmU6IG5ldyBJdGVtTGluZU1vZGVsKHZhbHVlKSwKICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGF4RGVzY3JpcHRpb24sCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogdmF0VGF4RmllbGQuYWNjb3VudCwKICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IHZhdFRheEZpZWxkLmFjY291bnQuaWQsCiAgICAgICAgICAgICAgICAgICAgYW1vdW50OiB0YXhBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQ6CiAgICAgICAgICAgICAgICAgICAgICB0YXhBbW91bnQgKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMucHVyY2hhc2UudHhuUmF0ZSksCiAgICAgICAgICAgICAgICAgICAgdHlwZTogbmF0dXJlLAogICAgICAgICAgICAgICAgICAgIHR5cGVBczogInRheCIsCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0b3RhbFRheCArPQogICAgICAgICAga2VuZG8ucGFyc2VGbG9hdChzcFRheCA/IHNwVGF4IDogMCkgKwogICAgICAgICAga2VuZG8ucGFyc2VGbG9hdChwbHRheCA/IHBsdGF4IDogMCkgKwogICAgICAgICAga2VuZG8ucGFyc2VGbG9hdChvdGhlclRheCA/IG90aGVyVGF4IDogMCkgKwogICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YXRUYXggPyB2YXRUYXggOiAwKTsKICAgICAgICBzdWJUb3RhbCArPSBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmFtb3VudCkgKyBtb2RpZmllclByaWNlIC0gaW5jVGF4OwogICAgICAgIGNvbnN0IGFtb3VudCA9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuYW1vdW50KSArIG1vZGlmaWVyUHJpY2U7CiAgICAgICAgY29uc3QgYW10ID0gdGhpcy5leGNsdWRlVkFUVGF4SW5jbHVzaXZlKHZhbHVlLnZhdFRheCwgYW1vdW50LCBpbmNUYXgpOwogICAgICAgIC8vIGNvbnN0IHhBbW91bnQgPSAoa2VuZG8ucGFyc2VGbG9hdChhbXQpICoga2VuZG8ucGFyc2VGbG9hdCh0aGlzLnB1cmNoYXNlLnR4blJhdGUpKQogICAgICAgIGNvbnN0IGFkZGl0YyA9IHZhbHVlLmFkZGl0aW9uYWxDb3N0IHx8IDA7CiAgICAgICAgY29uc3QgaXRlbUFtb3VudCA9IGFtdDsKICAgICAgICBjb25zdCBpdGVtWEFtb3VudCA9CiAgICAgICAgICBpdGVtQW1vdW50ICoga2VuZG8ucGFyc2VGbG9hdCh0aGlzLnB1cmNoYXNlLnR4blJhdGUpOwoKICAgICAgICBjb25zdCBpdGVtID0gdmFsdWUuaXRlbTsKICAgICAgICBjb25zdCBpdG1UeXBlID0gaXRlbS50eXBlIHx8ICIiOwogICAgICAgIGlmIChpdG1UeXBlID09PSAiVmFyaWFudCIpIHsKICAgICAgICAgIGl0ZW1TdWJ0b3RhbCArPQogICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmNvc3QpICoga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5xdHkpOwogICAgICAgICAgaXRlbURpc2NvdW50ICs9IGtlbmRvLnBhcnNlRmxvYXQoZGlzY291bnQpOwogICAgICAgIH0gZWxzZSBpZiAoaXRtVHlwZSA9PT0gIlNlcnZpY2UiKSB7CiAgICAgICAgICBzZXJ2aWNlU3VidG90YWwgKz0KICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5jb3N0KSAqIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucXR5KTsKICAgICAgICAgIHNlcnZpY2VEaXNjb3VudCArPSBrZW5kby5wYXJzZUZsb2F0KGRpc2NvdW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdHhuSXRtU3VidG90YWwgKz0KICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5jb3N0KSAqIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucXR5KTsKICAgICAgICAgIHR4bkRpc2NvdW50ICs9IGtlbmRvLnBhcnNlRmxvYXQoZGlzY291bnQpOwogICAgICAgIH0KICAgICAgICBpZiAoYW10ID4gMCkgewogICAgICAgICAgbmF0dXJlID0gImRyIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbmF0dXJlID0gImNyIjsKICAgICAgICB9CiAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgIGlmIChpdGVtLnR5cGUgPT09ICJTZXJ2aWNlIikgewogICAgICAgICAgICBjb25zdCBwbGFuID0gaXRlbS5pc1BhbiB8fCBmYWxzZTsKICAgICAgICAgICAgaWYgKHBsYW4pIHsKICAgICAgICAgICAgICBpZiAoaXRlbS5oYXNPd25Qcm9wZXJ0eSgiZGVmZXJyZWRJbmNvbWVBY2MiKSkgewogICAgICAgICAgICAgICAgaWYgKGl0ZW0uZGVmZXJyZWRJbmNvbWVBY2MuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgbGV0IGRlZmVycmVkSW5BY2MgPSBpdGVtLmRlZmVycmVkSW5jb21lQWNjOwogICAgICAgICAgICAgICAgICB0aGlzLmpSYXcucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgaWQ6IGRlZmVycmVkSW5BY2MuaWQgKyAiLSIgKyBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgbGluZTogbmV3IEl0ZW1MaW5lTW9kZWwodmFsdWUpLAogICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLnB1cmNoYXNlLmpvdXJuYWxOb3RlLAogICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IGRlZmVycmVkSW5BY2MsCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudElkOiBkZWZlcnJlZEluQWNjLmlkLAogICAgICAgICAgICAgICAgICAgIGFtb3VudDogaXRlbUFtb3VudCAqIC0xLCAvLyBxdHkqYXZnX2Nvc3QgLAogICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OiBpdGVtWEFtb3VudCwgLy8sCiAgICAgICAgICAgICAgICAgICAgdHlwZTogbmF0dXJlLAogICAgICAgICAgICAgICAgICAgIHR5cGVBczogIml0ZW0iLAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaWYgKGl0ZW0uaGFzT3duUHJvcGVydHkoImNvc3RPZkdvb2RzU29sZEFjYyIpKSB7CiAgICAgICAgICAgICAgICBpZiAoaXRlbS5jb3N0T2ZHb29kc1NvbGRBY2MuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgbGV0IGNvc3RPZkdvb2RzU29sZEFjYyA9IGl0ZW0uY29zdE9mR29vZHNTb2xkQWNjOwogICAgICAgICAgICAgICAgICB0aGlzLmpSYXcucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgaWQ6IGNvc3RPZkdvb2RzU29sZEFjYy5pZCArICItIiArIG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICBsaW5lOiBuZXcgSXRlbUxpbmVNb2RlbCh2YWx1ZSksCiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoaXMucHVyY2hhc2Uuam91cm5hbE5vdGUsCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogaXRlbS5jb3N0T2ZHb29kc1NvbGRBY2MsCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudElkOiBpdGVtLmNvc3RPZkdvb2RzU29sZEFjYy5pZCwKICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IGl0ZW1BbW91bnQsIC8vIHF0eSphdmdfY29zdCAsCiAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQ6IGl0ZW1YQW1vdW50LCAvL3hBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogbmF0dXJlLAogICAgICAgICAgICAgICAgICAgIHR5cGVBczogIml0ZW0iLAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS50eXBlID09PSAiVmFyaWFudCIpIHsKICAgICAgICAgICAgY29uc3QgYW1vdW50V2l0aEFkZGljdCA9IGl0ZW1BbW91bnQgKyAodmFsdWUuYW1vdW50QXBwbGllZCB8fCAwKTsKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCJhZGRpdGMiLCBhZGRpdGMsICItIiwgaXRlbUFtb3VudCk7CiAgICAgICAgICAgIGlmIChpdGVtLmhhc093blByb3BlcnR5KCJpbnZlbnRvcnlBY2MiKSkgewogICAgICAgICAgICAgIGlmIChpdGVtLmludmVudG9yeUFjYy5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgbGV0IGludmVudG9yeUFjYyA9IGl0ZW0uaW52ZW50b3J5QWNjOwogICAgICAgICAgICAgICAgdGhpcy5qUmF3LnB1c2goewogICAgICAgICAgICAgICAgICBpZDogaW52ZW50b3J5QWNjLmlkICsgIi0iICsgbmF0dXJlLAogICAgICAgICAgICAgICAgICBsaW5lOiBuZXcgSXRlbUxpbmVNb2RlbCh2YWx1ZSksCiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLnB1cmNoYXNlLmpvdXJuYWxOb3RlLAogICAgICAgICAgICAgICAgICBhY2NvdW50OiBpdGVtLmludmVudG9yeUFjYywKICAgICAgICAgICAgICAgICAgYWNjb3VudElkOiBpdGVtLmludmVudG9yeUFjYy5pZCwKICAgICAgICAgICAgICAgICAgYW1vdW50OiBhbW91bnRXaXRoQWRkaWN0LCAvLyBxdHkqYXZnX2Nvc3QgLAogICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDoKICAgICAgICAgICAgICAgICAgICBhbW91bnRXaXRoQWRkaWN0ICogKHRoaXMucHVyY2hhc2UudHhuUmF0ZSB8fCAxKSwgLy94QW1vdW50LAogICAgICAgICAgICAgICAgICB0eXBlOiBuYXR1cmUsCiAgICAgICAgICAgICAgICAgIHR5cGVBczogIml0ZW0iLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0udHlwZSA9PT0gIkZpeGVkIEFzc2V0IikgewogICAgICAgICAgICBpZiAoaXRlbS5oYXNPd25Qcm9wZXJ0eSgiYXNzZXRBY2MiKSkgewogICAgICAgICAgICAgIGlmIChpdGVtLmFzc2V0QWNjLmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICBsZXQgYXNzZXRBY2MgPSBpdGVtLmFzc2V0QWNjOwogICAgICAgICAgICAgICAgdGhpcy5qUmF3LnB1c2goewogICAgICAgICAgICAgICAgICBpZDogYXNzZXRBY2MuaWQgKyAiLSIgKyBuYXR1cmUsCiAgICAgICAgICAgICAgICAgIGxpbmU6IG5ldyBJdGVtTGluZU1vZGVsKHZhbHVlKSwKICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoaXMucHVyY2hhc2Uuam91cm5hbE5vdGUsCiAgICAgICAgICAgICAgICAgIGFjY291bnQ6IGl0ZW0uYXNzZXRBY2MsCiAgICAgICAgICAgICAgICAgIGFjY291bnRJZDogaXRlbS5hc3NldEFjYy5pZCwKICAgICAgICAgICAgICAgICAgYW1vdW50OiBpdGVtQW1vdW50LCAvLyBxdHkqYXZnX2Nvc3QgLAogICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogaXRlbVhBbW91bnQsIC8veEFtb3VudCwKICAgICAgICAgICAgICAgICAgdHlwZTogbmF0dXJlLAogICAgICAgICAgICAgICAgICB0eXBlQXM6ICJpdGVtIiwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmIChpdGVtLnR5cGUgPT09ICJUcmFuc2FjdGlvbiBJdGVtIikgewogICAgICAgICAgICBpZiAoaXRlbS5oYXNPd25Qcm9wZXJ0eSgiYWNjb3VudCIpKSB7CiAgICAgICAgICAgICAgaWYgKGl0ZW0uYWNjb3VudC5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgdGhpcy5qUmF3LnB1c2goewogICAgICAgICAgICAgICAgICBpZDogaXRlbS5hY2NvdW50LmlkICsgIi0iICsgbmF0dXJlLAogICAgICAgICAgICAgICAgICBsaW5lOiBuZXcgSXRlbUxpbmVNb2RlbCh2YWx1ZSksCiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLnB1cmNoYXNlLmpvdXJuYWxOb3RlLAogICAgICAgICAgICAgICAgICBhY2NvdW50OiBpdGVtLmFjY291bnQsCiAgICAgICAgICAgICAgICAgIGFjY291bnRJZDogaXRlbS5hY2NvdW50LmlkLAogICAgICAgICAgICAgICAgICBhbW91bnQ6IGl0ZW1BbW91bnQsIC8vIHF0eSphdmdfY29zdCAsCiAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OiBpdGVtWEFtb3VudCwgLy94QW1vdW50LAogICAgICAgICAgICAgICAgICB0eXBlOiBuYXR1cmUsCiAgICAgICAgICAgICAgICAgIHR5cGVBczogIml0ZW0iLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vaW5jbHVkZSBUYXggQW1vdW50CiAgICAgICAgY29uc3QgYW1vdW50Tm9kaXNjb3VudCA9CiAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmNvc3QpICoga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5xdHkpIC0gZGlzY291bnQ7CiAgICAgICAgY29uc3QgaW5jbHVkZVRheEFtb3VudCA9CiAgICAgICAgICBhbW91bnROb2Rpc2NvdW50ICsgdmF0VGF4ICsgcGx0YXggKyBzcFRheCArIG90aGVyVGF4OwogICAgICAgIHZhbHVlWyJpbmNsdWRlVGF4QW1vdW50Il0gPSBpbmNsdWRlVGF4QW1vdW50OwogICAgICAgIHZhbHVlWyJpbmNsdWRlVGF4RXhjaGFuZ2VBbW91bnQiXSA9CiAgICAgICAgICBpbmNsdWRlVGF4QW1vdW50ICoga2VuZG8ucGFyc2VGbG9hdCh0aGlzLnB1cmNoYXNlLnR4blJhdGUpOwogICAgICB9KTsKICAgICAgLy90b2RvOiBXaXRoaG9sZGluZ1RheCBleHBlbnNlCiAgICAgIHRoaXMud2l0aGhvbGRpbmdFeHBlbnNlKHdoVGF4QW1vdW50LCB0aGlzLnB1cmNoYXNlLnR4blJhdGUgfHwgMSk7CgogICAgICB0aGlzLnB1cmNoYXNlLml0ZW1TdWJ0b3RhbCA9IGl0ZW1TdWJ0b3RhbDsKICAgICAgdGhpcy5wdXJjaGFzZS5pbmNsdXNpdmVUYXhBbW91bnQgPSBpbmNsdXNpdmVUYXg7CiAgICAgIHRoaXMucHVyY2hhc2UuZXhjaGFuZ2VJdGVtU3VidG90YWwgPQogICAgICAgIGl0ZW1TdWJ0b3RhbCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5wdXJjaGFzZS50eG5SYXRlKTsKCiAgICAgIHRoaXMucHVyY2hhc2Uuc2VydmljZVN1YnRvdGFsID0gc2VydmljZVN1YnRvdGFsOwogICAgICB0aGlzLnB1cmNoYXNlLmV4Y2hhbmdlU2VydmljZVN1YnRvdGFsID0KICAgICAgICBzZXJ2aWNlU3VidG90YWwgKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMucHVyY2hhc2UudHhuUmF0ZSk7CiAgICAgIHRoaXMucHVyY2hhc2UudHhuSXRtU3VidG90YWwgPSB0eG5JdG1TdWJ0b3RhbDsKICAgICAgdGhpcy5wdXJjaGFzZS5leGNoYW5nZVR4bkl0bVN1YnRvdGFsID0KICAgICAgICB0eG5JdG1TdWJ0b3RhbCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5wdXJjaGFzZS50eG5SYXRlKTsKCiAgICAgIHRoaXMucHVyY2hhc2UuaXRlbURpc2NvdW50ID0gaXRlbURpc2NvdW50OwogICAgICB0aGlzLnB1cmNoYXNlLmV4Y2hhbmdlSXRlbURpc2NvdW50ID0KICAgICAgICBpdGVtRGlzY291bnQgKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMucHVyY2hhc2UudHhuUmF0ZSk7CiAgICAgIHRoaXMucHVyY2hhc2Uuc2VydmljZURpc2NvdW50ID0gc2VydmljZURpc2NvdW50OwogICAgICB0aGlzLnB1cmNoYXNlLmV4Y2hhbmdlU2VydmljZURpc2NvdW50ID0KICAgICAgICBzZXJ2aWNlRGlzY291bnQgKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMucHVyY2hhc2UudHhuUmF0ZSk7CiAgICAgIHRoaXMucHVyY2hhc2UudHhuSXRtRGlzY291bnQgPSB0eG5EaXNjb3VudDsKICAgICAgdGhpcy5wdXJjaGFzZS5leGNoYW5nZVR4bkl0bURpc2NvdW50ID0KICAgICAgICB0eG5EaXNjb3VudCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5wdXJjaGFzZS50eG5SYXRlKTsKCiAgICAgIGxldCB0b3RhbCA9CiAgICAgICAga2VuZG8ucGFyc2VGbG9hdChzdWJUb3RhbCkgLQogICAgICAgIGtlbmRvLnBhcnNlRmxvYXQoZGlzY291bnRUb3RhbCkgKwogICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodG90YWxUYXgpOwogICAgICB0aGlzLnB1cmNoYXNlLnN1YlRvdGFsID0gc3ViVG90YWw7CiAgICAgIHRoaXMucHVyY2hhc2UudG90YWxUYXhBbW91bnQgPSBrZW5kby5wYXJzZUZsb2F0KHRvdGFsVGF4KTsKICAgICAgdGhpcy5wdXJjaGFzZS5kaXNjb3VudFRvdGFsID0ga2VuZG8ucGFyc2VGbG9hdChkaXNjb3VudFRvdGFsKTsKICAgICAgaWYgKHRoaXMucHVyY2hhc2Uuc3BlY2lmaWNEaXNjb3VudEl0ZW0pIHsKICAgICAgICBkaXNjb3VudEludm9pY2UgPSB0aGlzLmF1dG9DYWxjdWxhdGVEaXNjb3VudCgKICAgICAgICAgIHRoaXMucHVyY2hhc2Uuc3BlY2lmaWNEaXNjb3VudEl0ZW0sCiAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHN1YlRvdGFsKQogICAgICAgICk7CiAgICAgICAgZGlzY291bnRJbnZvaWNlID0gZGlzY291bnRJbnZvaWNlID8gZGlzY291bnRJbnZvaWNlIDogMDsKICAgICAgfQogICAgICAvLyB0aGlzLm9uT3RoZXJDaGFyZ2VDaGFuZ2UoKQogICAgICB0aGlzLnB1cmNoYXNlLnRvdGFsID0KICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHRvdGFsKSAtCiAgICAgICAgZGlzY291bnRJbnZvaWNlICsKICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHRoaXMucHVyY2hhc2Uub3RoZXJDaGFyZ2VBbW91bnQpOyAvLy0gcGFyc2VGbG9hdCh3aXRoaG9sZGluZ1RheEFtb3VudCk7CiAgICAgIHRoaXMucHVyY2hhc2Uud2l0aGhvbGRpbmdUYXhBbW91bnQgPSB3aXRoaG9sZGluZ1RheEFtb3VudDsKICAgICAgLy8gdGhpcy5wdXJjaGFzZS50b3RhbEFmdGVyV2l0aGhvbGRpbmdUYXggPSBrZW5kby5wYXJzZUZsb2F0KHRoaXMucHVyY2hhc2UudG90YWwpIC0gcGFyc2VGbG9hdCh3aXRoaG9sZGluZ1RheEFtb3VudCk7CiAgICAgIHRoaXMucHVyY2hhc2UucmVtYWluaW5nQW1vdW50ID0KICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHRoaXMucHVyY2hhc2UudG90YWwpIC0KICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHRoaXMucHVyY2hhc2UuZGVwb3NpdERlZHVjdGlvbikgLQogICAgICAgIHBhcnNlRmxvYXQod2l0aGhvbGRpbmdUYXhBbW91bnQpOwogICAgICB0aGlzLnB1cmNoYXNlLmFtb3VudER1ZSA9CiAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh0aGlzLnB1cmNoYXNlLnRvdGFsKSAtCiAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh0aGlzLnB1cmNoYXNlLmRlcG9zaXREZWR1Y3Rpb24pIC0KICAgICAgICBwYXJzZUZsb2F0KHdpdGhob2xkaW5nVGF4QW1vdW50KTsKICAgICAgdGhpcy5wdXJjaGFzZS5leGNoYW5nZUFtb3VudCA9CiAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh0aGlzLnB1cmNoYXNlLmFtb3VudER1ZSkgKgogICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5wdXJjaGFzZS50eG5SYXRlKTsKICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKCdFeGNoYW5nZSBBbW91bnQnLCB0aGlzLnB1cmNoYXNlLmV4Y2hhbmdlQW1vdW50LCB0aGlzLnB1cmNoYXNlLmFtb3VudER1ZSkKICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlVGF4QnlUeXBlKHRheExpc3QpOwogICAgICBpZiAodGhpcy5wdXJjaGFzZS5zcGVjaWZpY0Rpc2NvdW50SXRlbSkgewogICAgICAgIGNvbnN0IHNwZWNpZmljRGlzY291bnQgPSB0aGlzLnB1cmNoYXNlLnNwZWNpZmljRGlzY291bnRJdGVtIHx8IHt9OwogICAgICAgIGlmIChzcGVjaWZpY0Rpc2NvdW50LmlkKSB7CiAgICAgICAgICBkaXNjb3VudEl0ZW0ucHVzaChzcGVjaWZpY0Rpc2NvdW50KTsKICAgICAgICAgIGRpc2NvdW50TGluZS5wdXNoKHsKICAgICAgICAgICAgaWQ6IHNwZWNpZmljRGlzY291bnQuaWQsCiAgICAgICAgICAgIG5hbWU6IHNwZWNpZmljRGlzY291bnQubmFtZSwKICAgICAgICAgICAgYW1vdW50OiB0aGlzLnB1cmNoYXNlLnNwZWNpZmljRGlzY291bnRUb3RhbCwKICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQ6CiAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZS5zcGVjaWZpY0Rpc2NvdW50VG90YWwgKiB0aGlzLnB1cmNoYXNlLnR4blJhdGUsCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgdW5pcXVlRGlzY291bnRJdGVtID0gdGhpcy5yZW1vdmVEdXBsaWNhdGUoZGlzY291bnRJdGVtKTsKICAgICAgdGhpcy5zaHJpbmtEaXNjb3VudEl0ZW0odW5pcXVlRGlzY291bnRJdGVtLCBkaXNjb3VudExpbmUpOwogICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coJ2Rpc2NvdW50ICcsIHRoaXMuY3VzdG9tZXJEaXNjb3VudEl0ZW0pCiAgICAgIC8vIHRvZG86IHJhdyBKb3VybmFsCiAgICAgIGNvbnN0IGFwQWNjID0gdGhpcy5wdXJjaGFzZS5hcEFjYyB8fCB7fTsKICAgICAgaWYgKHRoaXMucHVyY2hhc2UuYW1vdW50RHVlICogLTEgPiAwKSB7CiAgICAgICAgbmF0dXJlID0gImRyIjsKICAgICAgfSBlbHNlIHsKICAgICAgICBuYXR1cmUgPSAiY3IiOwogICAgICB9CiAgICAgIGlmIChhcEFjYykgewogICAgICAgIGlmIChhcEFjYy5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgdGhpcy5qUmF3LnB1c2goewogICAgICAgICAgICBpZDogYXBBY2MuaWQgKyAiLSIgKyBuYXR1cmUsCiAgICAgICAgICAgIGxpbmU6IG5ldyBJdGVtTGluZU1vZGVsKHt9KSwKICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoaXMucHVyY2hhc2Uuam91cm5hbE5vdGUsCiAgICAgICAgICAgIGFjY291bnQ6IGFwQWNjLAogICAgICAgICAgICBhY2NvdW50SWQ6IGFwQWNjLmlkLAogICAgICAgICAgICBleGNoYW5nZUFtb3VudDogdGhpcy5wdXJjaGFzZS5leGNoYW5nZUFtb3VudCAqIC0xLAogICAgICAgICAgICBhbW91bnQ6IHRoaXMucHVyY2hhc2UuYW1vdW50RHVlICogLTEsCiAgICAgICAgICAgIHR5cGU6IG5hdHVyZSwKICAgICAgICAgICAgdHlwZUFzOiAiYXAiLAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IHNwZWNpZmljRGlzYyA9IHRoaXMucHVyY2hhc2Uuc3BlY2lmaWNEaXNjb3VudEl0ZW07CiAgICAgIGlmICh0aGlzLnB1cmNoYXNlLnNwZWNpZmljRGlzY291bnRUb3RhbCAqIC0xID4gMCkgewogICAgICAgIG5hdHVyZSA9ICJkciI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbmF0dXJlID0gImNyIjsKICAgICAgfQogICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coc3BlY2lmaWNEaXNjLCAnc3BlY2lmaWNEaXNjJywgdGhpcy5wdXJjaGFzZS5zcGVjaWZpY0Rpc2NvdW50VG90YWwpCiAgICAgIGlmIChzcGVjaWZpY0Rpc2MpIHsKICAgICAgICBpZiAoc3BlY2lmaWNEaXNjLmhhc093blByb3BlcnR5KCJhY2NvdW50IikpIHsKICAgICAgICAgIGlmIChzcGVjaWZpY0Rpc2MuYWNjb3VudCkgewogICAgICAgICAgICBpZiAoc3BlY2lmaWNEaXNjLmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgdGhpcy5qUmF3LnB1c2goewogICAgICAgICAgICAgICAgaWQ6IHNwZWNpZmljRGlzYy5hY2NvdW50LmlkICsgIi0iICsgbmF0dXJlLAogICAgICAgICAgICAgICAgbGluZTogbmV3IEl0ZW1MaW5lTW9kZWwoe30pLAogICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICJQdXJjaGFzZSBEaXNjb3VudCIsCiAgICAgICAgICAgICAgICBhY2NvdW50OiBzcGVjaWZpY0Rpc2MuYWNjb3VudCwKICAgICAgICAgICAgICAgIGFjY291bnRJZDogc3BlY2lmaWNEaXNjLmFjY291bnQuaWQsCiAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDoKICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh0aGlzLnB1cmNoYXNlLnNwZWNpZmljRGlzY291bnRUb3RhbCkgKgogICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHRoaXMucHVyY2hhc2UudHhuUmF0ZSkgKgogICAgICAgICAgICAgICAgICAtMSwKICAgICAgICAgICAgICAgIGFtb3VudDogdGhpcy5wdXJjaGFzZS5zcGVjaWZpY0Rpc2NvdW50VG90YWwgKiAtMSwKICAgICAgICAgICAgICAgIHR5cGU6IG5hdHVyZSwKICAgICAgICAgICAgICAgIHR5cGVBczogImRpc2NvdW50IiwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMucHVyY2hhc2UuZGVwb3NpdERlZHVjdGlvbiAqIC0xID4gMCkgewogICAgICAgIG5hdHVyZSA9ICJkciI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbmF0dXJlID0gImNyIjsKICAgICAgfQogICAgICBpZiAodGhpcy5wdXJjaGFzZS5kZXBvc2l0RGVkdWN0aW9uKSB7CiAgICAgICAgaWYgKHRoaXMucHVyY2hhc2UuZGVwb3NpdERlZHVjdGlvbiA+IDApIHsKICAgICAgICAgIGNvbnN0IHB1cmNoYXNlRGVwb3NpdEFjYyA9IHRoaXMudmVuZG9yLnB1cmNoYXNlRGVwb3NpdEFjYyB8fCB7fTsKICAgICAgICAgIGlmIChwdXJjaGFzZURlcG9zaXRBY2MpIHsKICAgICAgICAgICAgaWYgKHB1cmNoYXNlRGVwb3NpdEFjYy5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgIHRoaXMualJhdy5wdXNoKHsKICAgICAgICAgICAgICAgIGlkOiBwdXJjaGFzZURlcG9zaXRBY2MuaWQgKyAiLSIgKyBuYXR1cmUsCiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogIlB1cmNoYXNlIERlcG9zaXQiLAogICAgICAgICAgICAgICAgbGluZTogbmV3IEl0ZW1MaW5lTW9kZWwoe30pLAogICAgICAgICAgICAgICAgYWNjb3VudDogcHVyY2hhc2VEZXBvc2l0QWNjLAogICAgICAgICAgICAgICAgYWNjb3VudElkOiBwdXJjaGFzZURlcG9zaXRBY2MuaWQsCiAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogdGhpcy5wdXJjaGFzZS5leGNoYW5nZURlcG9zaXREZWR1Y3Rpb24gKiAtMSwKICAgICAgICAgICAgICAgIGFtb3VudDogdGhpcy5wdXJjaGFzZS5kZXBvc2l0RGVkdWN0aW9uICogLTEsCiAgICAgICAgICAgICAgICB0eXBlOiBuYXR1cmUsCiAgICAgICAgICAgICAgICB0eXBlQXM6ICJkZXBvc2l0IiwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBpZiAodGhpcy5tT3RoZXJDaGFyZ2UubGVuZ3RoID4gMCkgewogICAgICAgIGxldCBvdGhlckNoYXJnZSA9IDA7CiAgICAgICAgdGhpcy5tT3RoZXJDaGFyZ2UuZm9yRWFjaCgobSkgPT4gewogICAgICAgICAgb3RoZXJDaGFyZ2UgPSB0aGlzLmF1dG9DYWxjdWxhdGVEaXNjb3VudChtLCB0aGlzLnB1cmNoYXNlLnN1YlRvdGFsKTsKICAgICAgICAgIGlmIChvdGhlckNoYXJnZSA+IDApIHsKICAgICAgICAgICAgbmF0dXJlID0gImRyIjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5hdHVyZSA9ICJjciI7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobSkgewogICAgICAgICAgICBpZiAobS5oYXNPd25Qcm9wZXJ0eSgiYWNjb3VudCIpKSB7CiAgICAgICAgICAgICAgaWYgKG0uYWNjb3VudC5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgY29uc3QgYWNjb3VudCA9IG0uYWNjb3VudDsKICAgICAgICAgICAgICAgIGlmIChhY2NvdW50KSB7CiAgICAgICAgICAgICAgICAgIGlmIChhY2NvdW50Lmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5qUmF3LnB1c2goewogICAgICAgICAgICAgICAgICAgICAgaWQ6IGFjY291bnQuaWQgKyAiLSIgKyBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBuZXcgSXRlbUxpbmVNb2RlbCh7fSksCiAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogIk90aGVyIENoYXJnZSIsCiAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiBhY2NvdW50LAogICAgICAgICAgICAgICAgICAgICAgYWNjb3VudElkOiBhY2NvdW50LmlkLAogICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQ6CiAgICAgICAgICAgICAgICAgICAgICAgIG90aGVyQ2hhcmdlICoga2VuZG8ucGFyc2VGbG9hdCh0aGlzLnB1cmNoYXNlLnR4blJhdGUpLAogICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBvdGhlckNoYXJnZSwKICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgIHR5cGVBczogIm90aGVyQ2hhcmdlIiwKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIC8vIHRoaXMucHVyY2hhc2Uub3RoZXJDaGFyZ2VBbW91bnQgPSBvdGhlckNoYXJnZQogICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLm1PdGhlckNoYXJnZSk7CiAgICAgIH0KICAgICAgdGhpcy50YXhMaXN0RGV0YWlsID0gdGF4TGlzdERldGFpbDsKICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlVGF4RGV0YWlsKCk7CiAgICAgIC8vIHRvZG86IGVuZCByYXcgSm91cm5hbAogICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkodGhpcy5wdXJjaGFzZSksICdwdXJjaGFzZScpCgogICAgICBhd2FpdCB0aGlzLmNhbGN1bGF0ZUFkZGl0aW9uYWxDb3N0KCk7CiAgICAgIC8vIHRvZG86IGNvb2sgam91cm5hbAogICAgICB0aGlzLnNocmlua0RhdGEodGhpcy5qUmF3KTsKICAgICAgLy8gY29uc3QgdW5pcXVlID0gdGhpcy5yZW1vdmVEdXBsaWNhdGUodGhpcy5hY2NvdW50cykKICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKHVuaXF1ZSwgJ3VuaXF1ZScpCiAgICB9LAogICAgd2l0aGhvbGRpbmdFeHBlbnNlKGFtb3VudCwgdHhuUmF0ZSkgewogICAgICAvLyBpZiAodGhpcy5pc0l0ZW0oKSkgewogICAgICBpZiAoYW1vdW50ID4gMCkgewogICAgICAgIGNvbnN0IG5hdHVyZSA9ICJkciI7CiAgICAgICAgY29uc3QgYWNjb3VudCA9IHRoaXMuYWNjV2l0aGhvbGRpbmdFeHBlbnNlIHx8IFtdOwogICAgICAgIGlmIChhY2NvdW50Lmxlbmd0aCA+IDApIHsKICAgICAgICAgIGNvbnN0IGlhY2MgPSBhY2NvdW50WzBdOwogICAgICAgICAgdGhpcy5qUmF3LnB1c2goewogICAgICAgICAgICBpZDogaWFjYy5pZCArICItIiArIG5hdHVyZSwKICAgICAgICAgICAgbGluZTogbmV3IEl0ZW1MaW5lTW9kZWwoe30pLAogICAgICAgICAgICBkZXNjcmlwdGlvbjogIldpdGhob2xkaW5nIFRheCBFeHBlbnNlIiwKICAgICAgICAgICAgYWNjb3VudDogaWFjYywKICAgICAgICAgICAgYWNjb3VudElkOiBpYWNjLmlkLAogICAgICAgICAgICBleGNoYW5nZUFtb3VudDogYW1vdW50ICogdHhuUmF0ZSwKICAgICAgICAgICAgYW1vdW50OiBhbW91bnQsCiAgICAgICAgICAgIHR5cGU6IG5hdHVyZSwKICAgICAgICAgICAgdHlwZUFzOiAiV2l0aGhvbGRpbmciLAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIC8vIH0KICAgIH0sCiAgICBzaHJpbmtEYXRhKG9iaikgewogICAgICBjb25zdCB1bmlxdWVzID0KICAgICAgICB0aGlzLnJlbW92ZUR1cGxpY2F0ZShvYmopOyAvKlsuLi5uZXcgU2V0KGFjY291bnRJZC5tYXAoaSA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIGlkXzogaS5pZF8sCiAgICAgICAgICAgICAgICAgICAgaWQ6IGkuaWQsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogaS50eXBlCiAgICAgICAgICAgIH0pKV0qLwogICAgICB1bmlxdWVzLmZvckVhY2goKG4pID0+IHsKICAgICAgICBjb25zdCBmb3VuZCA9IG9iai5maWx0ZXIoKG0pID0+IG0uaWQgPT09IG4uaWQpOwogICAgICAgIGxldCBhbW91bnQgPSAwOwogICAgICAgIGZvdW5kLmZvckVhY2goKHopID0+IHsKICAgICAgICAgIGFtb3VudCArPSBwYXJzZUZsb2F0KHouYW1vdW50IHx8IDApOwogICAgICAgIH0pOwogICAgICAgIG4uYW1vdW50ID0gcGFyc2VGbG9hdChhbW91bnQpOyAvL3RoaXMubnVtYmVyRm9ybWF0KGFtb3VudCkKICAgICAgICBuLmV4Y2hhbmdlQW1vdW50ID0gcGFyc2VGbG9hdCgKICAgICAgICAgIHBhcnNlRmxvYXQoYW1vdW50ICogcGFyc2VGbG9hdCh0aGlzLnB1cmNoYXNlLnR4blJhdGUpKQogICAgICAgICk7IC8vdGhpcy5udW1iZXJGb3JtYXQoYW1vdW50ICogcGFyc2VGbG9hdCh0aGlzLnB1cmNoYXNlLnR4blJhdGUpKSAvLy50b0ZpeGVkKHRoaXMuc2FsZUZvcm1Db250ZW50LmRlY2ltYWwpCiAgICAgIH0pOwogICAgICB0aGlzLmpSYXcgPSB1bmlxdWVzOwogICAgICBsZXQgZHIgPSAwLAogICAgICAgIGNyID0gMDsKICAgICAgdGhpcy5qUmF3LmZvckVhY2goKGopID0+IHsKICAgICAgICBzd2l0Y2ggKGoudHlwZSkgewogICAgICAgICAgY2FzZSAiY3IiOgogICAgICAgICAgICBjciArPSBwYXJzZUZsb2F0KGouZXhjaGFuZ2VBbW91bnQpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgImRyIjoKICAgICAgICAgICAgZHIgKz0gcGFyc2VGbG9hdChqLmV4Y2hhbmdlQW1vdW50KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLnB1cmNoYXNlLmRyID0gZHI7CiAgICAgIHRoaXMucHVyY2hhc2UuY3IgPSBjcjsKICAgICAgd2luZG93LmNvbnNvbGUubG9nKCJkcj0iLCBkciwgImNyPSIsIGNyLCAiZHIrY3IgPSAiLCBkciArIGNyKTsKICAgICAgd2luZG93LmNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHVuaXF1ZXMpLCAidW5pcXVlcyIpOwogICAgfSwKICAgIHNocmlua0Rpc2NvdW50SXRlbShkaXNjb3VudEl0ZW0sIGRpc2NvdW50TGluZSkgewogICAgICBsZXQgdW5pcXVlRGlzY291bnRJdGVtcyA9IFtdOwogICAgICBjb25zdCB1bmlxdWUgPSB0aGlzLnJlbW92ZUR1cGxpY2F0ZShkaXNjb3VudEl0ZW0pOwogICAgICB1bmlxdWUuZm9yRWFjaCgobSkgPT4gewogICAgICAgIGNvbnN0IGZvdW5kID0gZGlzY291bnRMaW5lLmZpbHRlcigobikgPT4gbi5pZCA9PT0gbS5pZCk7CiAgICAgICAgbGV0IGFtb3VudCA9IDAsCiAgICAgICAgICBleGNoYW5nZUFtb3VudCA9IDA7CiAgICAgICAgZm91bmQubWFwKChvKSA9PiB7CiAgICAgICAgICBhbW91bnQgKz0gby5hbW91bnQ7CiAgICAgICAgfSk7CiAgICAgICAgZm91bmQubWFwKChvKSA9PiB7CiAgICAgICAgICBleGNoYW5nZUFtb3VudCArPSBvLmV4Y2hhbmdlQW1vdW50OwogICAgICAgIH0pOwogICAgICAgIHVuaXF1ZURpc2NvdW50SXRlbXMucHVzaCh7CiAgICAgICAgICBpZDogbS5pZCwKICAgICAgICAgIG5hbWU6IG0ubmFtZSwKICAgICAgICAgIGFtb3VudDogYW1vdW50LAogICAgICAgICAgZXhjaGFuZ2VBbW91bnQ6IGV4Y2hhbmdlQW1vdW50LAogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgdGhpcy5zdXBwbGllckRpc2NvdW50SXRlbSA9IHVuaXF1ZURpc2NvdW50SXRlbXM7CiAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh1bmlxdWVEaXNjb3VudEl0ZW1zLCAidW5pcXVlRGlzY291bnRJdGVtcyIpOwogICAgfSwKICAgIHJlbW92ZUR1cGxpY2F0ZShhcnJheSkgewogICAgICBjb25zdCByZXN1bHQgPSBbXTsKICAgICAgY29uc3QgbWFwID0gbmV3IE1hcCgpOwogICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgYXJyYXkpIHsKICAgICAgICBpZiAoIW1hcC5oYXMoaXRlbS5pZCkpIHsKICAgICAgICAgIG1hcC5zZXQoaXRlbS5pZCwgdHJ1ZSk7IC8vIHNldCBhbnkgdmFsdWUgdG8gTWFwCiAgICAgICAgICByZXN1bHQucHVzaChpdGVtKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0sCiAgICBudW1iZXJGb3JtYXQodmFsdWUpIHsKICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKHRoaXMuc2FsZUZvcm1Db250ZW50LmRlY2ltYWwsJ25pbW9sJykKICAgICAgcmV0dXJuIGtlbmRvLnRvU3RyaW5nKHZhbHVlLCBgbiR7dGhpcy5wdXJjaGFzZUZvcm1Db250ZW50LmRlY2ltYWx9YCk7CiAgICB9LAogICAgYXV0b0NhbGN1bGF0ZURpc2NvdW50KGRpc2NvdW50SXRlbSwgc3ViVG90YWwpIHsKICAgICAgaWYgKGRpc2NvdW50SXRlbSkgewogICAgICAgIGNvbnN0IG5hdHVyZSA9IGRpc2NvdW50SXRlbS5uYXR1cmUgfHwgIiI7CiAgICAgICAgY29uc3QgYW1vdW50ID0gZGlzY291bnRJdGVtLmFtb3VudCB8fCAwOwogICAgICAgIGlmIChuYXR1cmUgPT09ICJBbW91bnQiKSB7CiAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChhbW91bnQpOwogICAgICAgIH0gZWxzZSBpZiAobmF0dXJlID09PSAiUGVyY2VudGFnZSIpIHsKICAgICAgICAgIHJldHVybiBzdWJUb3RhbCAqIChwYXJzZUZsb2F0KGFtb3VudCkgLyAxMDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KICAgIH0sCiAgICBhdXRvQ2FsY3VsYXRlVGF4KHRheCwgYW1vdW50KSB7CiAgICAgIGlmICh0YXgpIHsKICAgICAgICB2YXIgZm9ybXVsYSA9IHRheC5mb3JtdWxhOwogICAgICAgIHZhciBpbkFtdCA9IGtlbmRvLnBhcnNlRmxvYXQoYW1vdW50KTsKICAgICAgICB2YXIgbkFtdCA9IGtlbmRvLnBhcnNlRmxvYXQoYW1vdW50KTsKICAgICAgICB2YXIgdGF4QmFzZSA9IGtlbmRvLnBhcnNlRmxvYXQodGF4LnRheEJhc2UpIC8gMTAwOwogICAgICAgIHZhciByYXRlID0ga2VuZG8ucGFyc2VGbG9hdCh0YXgucmF0ZSkgLyAxMDA7CiAgICAgICAgdmFyIHRvdGFsID0gZXZhbChmb3JtdWxhKTsKICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coaW5BbXQsIG5BbXQsIHRheEJhc2UsIHJhdGUsIGZvcm11bGEsIHRvdGFsKTsKICAgICAgICByZXR1cm4gdG90YWw7CiAgICAgIH0KICAgICAgLy8gcmV0dXJuIDAKICAgIH0sCiAgICB0YXhNYXBwaW5nKG9ialRheCwgdGF4KSB7CiAgICAgIGNvbnN0IHRheElkID0gdGF4LmlkIHx8ICIiOwogICAgICBjb25zdCB0YXhfID0gb2JqVGF4LmZpbHRlcigodCkgPT4gdC5pZCA9PT0gdGF4SWQpWzBdOwogICAgICByZXR1cm4gKAogICAgICAgIHRheF8gfHwgewogICAgICAgICAgaWQ6ICIiLAogICAgICAgICAgZGVmYXVsdFRheDogIiIsCiAgICAgICAgfQogICAgICApOwogICAgfSwKICAgIGRhdGFTb3VyY2VDaGFuZ2VkKGUpIHsKICAgICAgaWYgKGUuZmllbGQpIHsKICAgICAgICBsZXQgZGF0YVJvdyA9IGUuaXRlbXNbMF0sCiAgICAgICAgICBidW9tID0ge30sCiAgICAgICAgICB2VGF4ID0ge30sCiAgICAgICAgICBjb252ZXJzaW9uUmF0ZSA9IDEsCiAgICAgICAgICB3YWMgPSAwLAogICAgICAgICAgcW9oID0gMCwKICAgICAgICAgIGFtb3VudCA9IDAsCiAgICAgICAgICB4QW1vdW50ID0gMDsKICAgICAgICBzd2l0Y2ggKGUuZmllbGQpIHsKICAgICAgICAgIGNhc2UgIml0ZW0iOgogICAgICAgICAgICAvLyB0aGlzLmF0dHJpYnV0ZV8gPSB0aGlzLmF0dHJpYnV0ZXMuZmlsdGVyKG0gPT4gbS50eXBlLmlkID09PSBkYXRhUm93LnZhcmlhbnQuaWQpCiAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJkZXNjcmlwdGlvbiIsIGRhdGFSb3cuaXRlbS5kZXNjcmlwdGlvbik7CiAgICAgICAgICAgIGJ1b20gPSBkYXRhUm93Lml0ZW0udW9tIHx8IHt9OwogICAgICAgICAgICBkYXRhUm93LnNldCgiYnVvbSIsIGJ1b20pOwogICAgICAgICAgICAvLyBkYXRhUm93LnNldCgndW9tJywgYnVvbSkKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKGRhdGFSb3cuaXRlbSwncm93JykKICAgICAgICAgICAgLy8gYXdhaXQgdGhpcy5pbnZlbnRvcnlCYWxhbmNlKGRhdGFSb3csIGRhdGFSb3cuaXRlbS5pZCkKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJjb3N0IjoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBhbW91bnQgPSBwYXJzZUZsb2F0KGRhdGFSb3cuY29zdCkgKiBwYXJzZUZsb2F0KGRhdGFSb3cucXR5KTsKICAgICAgICAgICAgICB4QW1vdW50ID0gYW1vdW50ICogcGFyc2VGbG9hdCh0aGlzLnB1cmNoYXNlLnR4blJhdGUpOwoKICAgICAgICAgICAgICBkYXRhUm93LnNldCgiY29zdCIsIHBhcnNlRmxvYXQoZGF0YVJvdy5jb3N0KSk7CiAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImFtb3VudCIsIGFtb3VudCk7CiAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImV4Y2hhbmdlQW1vdW50IiwgeEFtb3VudCk7CiAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKCdwcmljZScsZGF0YVJvdy5wcmljZSkKICAgICAgICAgICAgfSBjYXRjaCB7CiAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNvc3QiLCAwKTsKICAgICAgICAgICAgICBkYXRhUm93LnNldCgiYW1vdW50IiwgMCk7CiAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImV4Y2hhbmdlQW1vdW50IiwgMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJ1b20iOgogICAgICAgICAgICBpZiAodGhpcy5pc1ByaWNlTGV2ZWxDaGFuZ2VkID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YVJvdy51b20pIHsKICAgICAgICAgICAgICAgICAgYnVvbSA9IGRhdGFSb3cudW9tLmJ1b20gfHwge307CiAgICAgICAgICAgICAgICAgIHFvaCA9IGRhdGFSb3cudW9tLnFvaCB8fCAwOwogICAgICAgICAgICAgICAgICBjb252ZXJzaW9uUmF0ZSA9IGRhdGFSb3cudW9tLmNvbnZlcnNpb25SYXRlIHx8IDE7CiAgICAgICAgICAgICAgICAgIHdhYyA9IGRhdGFSb3cudW9tLndhYyB8fCAwOwogICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiYnVvbSIsIGJ1b20pOwogICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgid2FjIiwgd2FjKTsKICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoInFvaCIsIHFvaCk7CiAgICAgICAgICAgICAgICAgIC8qIHRvZG86IG1hcHBpbmcgdGF4IG9iamVjdCAqLwogICAgICAgICAgICAgICAgICB2VGF4ID0gdGhpcy50YXhNYXBwaW5nKAogICAgICAgICAgICAgICAgICAgIHRoaXMudGF4LAogICAgICAgICAgICAgICAgICAgIGRhdGFSb3cudW9tLnB1cmNoYXNlVGF4IHx8IHt9CiAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgidmF0VGF4IiwgdlRheCk7CiAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjb252ZXJzaW9uUmF0ZSIsIHBhcnNlRmxvYXQoY29udmVyc2lvblJhdGUpKTsKICAgICAgICAgICAgICAgICAgaWYgKGRhdGFSb3cudW9tKSB7CiAgICAgICAgICAgICAgICAgICAgYW1vdW50ID0KICAgICAgICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQoZGF0YVJvdy51b20uY29zdCkgKiBwYXJzZUZsb2F0KGRhdGFSb3cucXR5KTsKICAgICAgICAgICAgICAgICAgICB4QW1vdW50ID0gYW1vdW50ICogcGFyc2VGbG9hdCh0aGlzLnB1cmNoYXNlLnR4blJhdGUpOwoKICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiY29zdCIsIHBhcnNlRmxvYXQoZGF0YVJvdy51b20uY29zdCkpOwogICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJhbW91bnQiLCBhbW91bnQpOwogICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJleGNoYW5nZUFtb3VudCIsIHhBbW91bnQpOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGFtb3VudCA9IHBhcnNlRmxvYXQoZGF0YVJvdy5jb3N0KSAqIHBhcnNlRmxvYXQoZGF0YVJvdy5xdHkpOwogICAgICAgICAgICAgICAgICAgIHhBbW91bnQgPSBhbW91bnQgKiBwYXJzZUZsb2F0KHRoaXMucHVyY2hhc2UudHhuUmF0ZSk7CgogICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjb3N0IiwgcGFyc2VGbG9hdChkYXRhUm93LmNvc3QpKTsKICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiYW1vdW50IiwgYW1vdW50KTsKICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiZXhjaGFuZ2VBbW91bnQiLCB4QW1vdW50KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCJlcnJvciIsIGVycik7CiAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiYnVvbSIsIHt9KTsKICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjb252ZXJzaW9uUmF0ZSIsIDEpOwogICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNvc3QiLCAwKTsKICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJxb2giLCAwKTsKICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJ3YWMiLCAwKTsKICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJhbW91bnQiLCAwKTsKICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJleGNoYW5nZUFtb3VudCIsIDApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgInF0eSI6CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgYW1vdW50ID0gcGFyc2VGbG9hdChkYXRhUm93LmNvc3QpICogcGFyc2VGbG9hdChkYXRhUm93LnF0eSk7CiAgICAgICAgICAgICAgeEFtb3VudCA9IGFtb3VudCAqIHBhcnNlRmxvYXQodGhpcy5wdXJjaGFzZS50eG5SYXRlKTsKCiAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNvc3QiLCBwYXJzZUZsb2F0KGRhdGFSb3cuY29zdCkpOwogICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJhbW91bnQiLCBhbW91bnQpOwogICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJleGNoYW5nZUFtb3VudCIsIHhBbW91bnQpOwogICAgICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgICAgICBkYXRhUm93LnNldCgiY29zdCIsIDApOwogICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJhbW91bnQiLCAwKTsKICAgICAgICAgICAgICBkYXRhUm93LnNldCgiZXhjaGFuZ2VBbW91bnQiLCAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgIm90aGVyVGF4IjoKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKCItLSIsIGRhdGFSb3cpCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGlmIChlLmZpZWxkKSB7CiAgICAgICAgICB0aGlzLmF1dG9DYWxjdWxhdGUoKTsKICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygiZGF0YVJvdyIsIGRhdGFSb3cpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIFNlcnZpY2VEYXRlRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICBrZW5kbwogICAgICAgIC5qUXVlcnkoJzxpbnB1dCByZXF1aXJlZCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgLmtlbmRvRGF0ZVBpY2tlcigpOwoKICAgICAgLy8gbGV0IGRzID0gdGhpcy4kcmVmcy5pdGVtTGluZURTLmtlbmRvV2lkZ2V0KCkKICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKGRzLmRhdGEoKSkKICAgICAgLy8gLy8gY29uc3QgZGF0ZVN0cmluZyA9IGtlbmRvLnRvU3RyaW5nKChuZXcgRGF0ZShvcHRpb25zLm1vZGVsLml0ZW1zLnNlcnZpY2VEYXRlKSksIHRoaXMuaXRlbUxpbmUuZGF0ZUZvcm1hdCkKICAgICAgLy8gLy8gY29uc3QgZGF0ZVN0cmluZyA9IGtlbmRvLnRvU3RyaW5nKG9wdGlvbnMubW9kZWwuaXRlbXMuc2VydmljZURhdGUpCiAgICAgIC8vIGNvbnN0ICRpbnB1dCA9ICQoIjxpbnB1dCB2YWx1ZT0iICsgb3B0aW9ucy5tb2RlbC5zZXJ2aWNlRGF0ZSArICIgLz4iKS5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgIC8vICRpbnB1dC5rZW5kb0RhdGVQaWNrZXIoKQogICAgICAvLyAvLyAkaW5wdXQuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAvLyAvLyBvcHRpb25zLm1vZGVsLml0ZW1zLnNlcnZpY2VEYXRlID0gZGF0ZVN0cmluZwogICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coJGlucHV0KQogICAgfSwKICAgIFNlcnZpY2VEYXRlVG9FZGl0b3IoY29udGFpbmVyLCBvcHRpb25zKSB7CiAgICAgIGtlbmRvCiAgICAgICAgLmpRdWVyeSgnPGlucHV0IHJlcXVpcmVkIG5hbWU9IicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAua2VuZG9EYXRlUGlja2VyKCk7CiAgICB9LAogICAgSXRlbURyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICBrZW5kbwogICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgIGF1dG9CaW5kOiB0cnVlLAogICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICBmaWx0ZXI6ICJjb250YWlucyIsCiAgICAgICAgICBkYXRhVGV4dEZpZWxkOiAibmFtZSIsCiAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogImlkIiwKICAgICAgICAgIGhlYWRlclRlbXBsYXRlOgogICAgICAgICAgICAnPGRpdiBjbGFzcz0iZHJvcGRvd24taGVhZGVyIGstd2lkZ2V0IGstaGVhZGVyIj4nICsKICAgICAgICAgICAgIjxzcGFuPkl0ZW1zIDwvc3Bhbj4iICsKICAgICAgICAgICAgIjxzcGFuPjwvc3Bhbj4iICsKICAgICAgICAgICAgIjwvZGl2PiIsCiAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9bmFtZSM8L3NwYW4+IiwKICAgICAgICAgIG9wdGlvbkxhYmVsOiAiLS0tIFNlbGVjdCAtLS0iLAogICAgICAgICAgZGF0YVNvdXJjZTogbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7CiAgICAgICAgICAgIHNlcnZlckZpbHRlcmluZzogdHJ1ZSwKICAgICAgICAgICAgdHJhbnNwb3J0OiB7CiAgICAgICAgICAgICAgcmVhZDogewogICAgICAgICAgICAgICAgdXJsOiBwcm9kdWN0VmFyaWFudEhhbmRsZXIuaXRlbVNlYXJjaFVSTCgpLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2NoZW1hOiB7CiAgICAgICAgICAgICAgbW9kZWw6IHsKICAgICAgICAgICAgICAgIGlkOiAiaWQiLAogICAgICAgICAgICAgICAgZmllbGRzOiB7CiAgICAgICAgICAgICAgICAgIGlkOiB7IHR5cGU6ICJzdHJpbmciIH0sCiAgICAgICAgICAgICAgICAgIG5hbWU6IHsgdHlwZTogInN0cmluZyIgfSwKICAgICAgICAgICAgICAgICAgc2t1OiB7IHR5cGU6ICJzdHJpbmciIH0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZGF0YTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHRvdGFsOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhLmNvdW50OwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8vIGRhdGE6IHRoaXMudmFyaWFudHMKICAgICAgICAgIH0pLAogICAgICAgIH0pOwogICAgfSwKICAgIFVPTURyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICBrZW5kbwogICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgIGF1dG9CaW5kOiB0cnVlLAogICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICBmaWx0ZXI6ICJzdGFydHN3aXRoIiwKICAgICAgICAgIGRhdGFUZXh0RmllbGQ6ICJjb2RlIiwKICAgICAgICAgIGRhdGFWYWx1ZUZpZWxkOiAidW9tQ29udmVydElkIiwKICAgICAgICAgIGNhc2NhZGVGcm9tOiAiaXRlbSIsCiAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9Y29kZSB8fCBgYCM8L3NwYW4+IiwKICAgICAgICAgIG9wdGlvbkxhYmVsOiAiLS0tIFNlbGVjdCAtLS0iLAogICAgICAgICAgZGF0YVNvdXJjZTogbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7CiAgICAgICAgICAgIHNlcnZlckZpbHRlcmluZzogdHJ1ZSwKICAgICAgICAgICAgdHJhbnNwb3J0OiB7CiAgICAgICAgICAgICAgcmVhZDogewogICAgICAgICAgICAgICAgdXJsOiB1b21QcmljZUhhbmRsZXIudW9tUHJpY2VCeVByaWNlTGV2ZWxVUkwoCiAgICAgICAgICAgICAgICAgICJpZD0iICsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm1vZGVsLml0ZW0uaWQgKwogICAgICAgICAgICAgICAgICAgICImcGxJZD0iICsKICAgICAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlLnByaWNlTGV2ZWwuaWQgKwogICAgICAgICAgICAgICAgICAgICImZGF0ZT0iICsKICAgICAgICAgICAgICAgICAgICB0aGlzLnR4bkRhdGUgKwogICAgICAgICAgICAgICAgICAgICImbmF0dXJlPXB1cmNoYXNlIgogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGRhdGFUeXBlOiAianNvbiIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNjaGVtYTogewogICAgICAgICAgICAgIG1vZGVsOiB7CiAgICAgICAgICAgICAgICBpZDogImlkIiwKICAgICAgICAgICAgICAgIGZpZWxkczogewogICAgICAgICAgICAgICAgICBpZDogeyB0eXBlOiAic3RyaW5nIiB9LAogICAgICAgICAgICAgICAgICAvLyBuYW1lOiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAvLyBza3U6IHt0eXBlOiAic3RyaW5nIn0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZGF0YTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHRvdGFsOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhLmNvdW50OwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8vIGRhdGE6IHRoaXMudmFyaWFudHMKICAgICAgICAgIH0pLAogICAgICAgIH0pOwogICAgfSwKICAgIERpc2NvdW50SXRlbURyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICBrZW5kbwogICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgIGF1dG9CaW5kOiB0cnVlLAogICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICBmaWx0ZXI6ICJzdGFydHN3aXRoIiwKICAgICAgICAgIGRhdGFUZXh0RmllbGQ6ICJuYW1lIiwKICAgICAgICAgIGRhdGFWYWx1ZUZpZWxkOiAiaWQiLAogICAgICAgICAgY2FzY2FkZUZyb206ICJpdGVtIiwKICAgICAgICAgIHRlbXBsYXRlOiAiPHNwYW4+Iz1jb2RlIyAtICM9bmFtZSM8L3NwYW4+IiwKICAgICAgICAgIG9wdGlvbkxhYmVsOiAiLS0tIFNlbGVjdCAtLS0iLAogICAgICAgICAgZGF0YVNvdXJjZTogbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7CiAgICAgICAgICAgIHNlcnZlckZpbHRlcmluZzogdHJ1ZSwKICAgICAgICAgICAgdHJhbnNwb3J0OiB7CiAgICAgICAgICAgICAgcmVhZDogewogICAgICAgICAgICAgICAgdXJsOiBkaXNjb3VudEl0ZW1IYW5kbGVyLmdldFVSTChESVNDT1VOVF9UWVBFKSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGRhdGFUeXBlOiAianNvbiIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNjaGVtYTogewogICAgICAgICAgICAgIG1vZGVsOiB7CiAgICAgICAgICAgICAgICBpZDogImlkIiwKICAgICAgICAgICAgICAgIGZpZWxkczogewogICAgICAgICAgICAgICAgICBpZDogeyB0eXBlOiAic3RyaW5nIiB9LAogICAgICAgICAgICAgICAgICAvLyBuYW1lOiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAvLyBza3U6IHt0eXBlOiAic3RyaW5nIn0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZGF0YTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHRvdGFsOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhLmNvdW50OwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9KSwKICAgICAgICB9KTsKICAgIH0sCiAgICBWYXRUYXhEcm9wRG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAga2VuZG8KICAgICAgICAualF1ZXJ5KCc8aW5wdXQgbmFtZT0iJyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgICBhdXRvQmluZDogdHJ1ZSwKICAgICAgICAgIGF1dG9XaWR0aDogdHJ1ZSwKICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgZmlsdGVyOiAic3RhcnRzd2l0aCIsCiAgICAgICAgICBkYXRhVGV4dEZpZWxkOiAiZGVmYXVsdFRheCIsCiAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogImlkIiwKICAgICAgICAgIHRlbXBsYXRlOiAiPHNwYW4+Iz1kZWZhdWx0VGF4Izwvc3Bhbj4iLAogICAgICAgICAgb3B0aW9uTGFiZWw6ICItLVNlbGVjdC0tIiwKICAgICAgICAgIGRhdGFTb3VyY2U6IG5ldyBrZW5kby5kYXRhLkRhdGFTb3VyY2UoewogICAgICAgICAgICBkYXRhOiB0aGlzLnRheCwKICAgICAgICAgIH0pLAogICAgICAgIH0pOwogICAgfSwKICAgIEVtcGxveWVlRHJvcERvd25FZGl0b3IoY29udGFpbmVyLCBvcHRpb25zKSB7CiAgICAgIGtlbmRvCiAgICAgICAgLmpRdWVyeSgnPGlucHV0IGRhdGEtYmluZD0idmFsdWU6JyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgIC5rZW5kb011bHRpU2VsZWN0KHsKICAgICAgICAgIGF1dG9CaW5kOiB0cnVlLAogICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICBzdWdnZXN0OiB0cnVlLAogICAgICAgICAgZmlsdGVyOiAiY29udGFpbnMiLAogICAgICAgICAgZGF0YVRleHRGaWVsZDogIm5hbWUiLAogICAgICAgICAgZGF0YVZhbHVlRmllbGQ6ICJpZCIsCiAgICAgICAgICBoZWFkZXJUZW1wbGF0ZToKICAgICAgICAgICAgJzxkaXYgY2xhc3M9ImRyb3Bkb3duLWhlYWRlciBrLXdpZGdldCBrLWhlYWRlciI+JyArCiAgICAgICAgICAgICI8c3Bhbj5FbXBsb3llZSA8L3NwYW4+IiArCiAgICAgICAgICAgICI8c3Bhbj48L3NwYW4+IiArCiAgICAgICAgICAgICI8L2Rpdj4iLAogICAgICAgICAgdGVtcGxhdGU6ICI8c3Bhbj4jPW5hbWUjPC9zcGFuPiIsCiAgICAgICAgICBvcHRpb25MYWJlbDogIi0tLSBTZWxlY3QgLS0tIiwKICAgICAgICAgIGRhdGFTb3VyY2U6IG5ldyBrZW5kby5kYXRhLkRhdGFTb3VyY2UoewogICAgICAgICAgICBzZXJ2ZXJGaWx0ZXJpbmc6IHRydWUsCiAgICAgICAgICAgIHRyYW5zcG9ydDogewogICAgICAgICAgICAgIHJlYWQ6IHsKICAgICAgICAgICAgICAgIHVybDogZW1wbG95ZWVIYW5kbGVyLnNlYXJjaFVSTCgpLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2NoZW1hOiB7CiAgICAgICAgICAgICAgbW9kZWw6IHsKICAgICAgICAgICAgICAgIGlkOiAiaWQiLAogICAgICAgICAgICAgICAgZmllbGRzOiB7CiAgICAgICAgICAgICAgICAgIGlkOiB7IHR5cGU6ICJzdHJpbmciIH0sCiAgICAgICAgICAgICAgICAgIG5hbWU6IHsgdHlwZTogInN0cmluZyIgfSwKICAgICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB7IHR5cGU6ICJzdHJpbmciIH0sCiAgICAgICAgICAgICAgICAgIGxhc3ROYW1lOiB7IHR5cGU6ICJzdHJpbmciIH0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZGF0YTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHRvdGFsOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhLmNvdW50OwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9KSwKICAgICAgICB9KTsKICAgIH0sCiAgICByb3dOdW1iZXJUbXBsKGRhdGFJdGVtKSB7CiAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuaXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpLAogICAgICAgIGluZGV4ID0gZHMuaW5kZXhPZihkYXRhSXRlbSk7CiAgICAgIHJldHVybiBpbmRleCArIDE7CiAgICB9LAogICAgYWRkUm93KCkgewogICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLml0ZW1MaW5lRFMua2VuZG9XaWRnZXQoKSwKICAgICAgICB0b3RhbCA9IGRzLnRvdGFsKCk7CiAgICAgIHRoaXMuaXRlbUxpbmUuaWQgPSBpdGVtTGluZVByZWZpeCArIHV1aWQudjEoKTsKICAgICAgdGhpcy5pdGVtTGluZS5kZWNpbWFsRm9ybWF0ID0gIm4iICsgdGhpcy5wdXJjaGFzZUZvcm1Db250ZW50LmRlY2ltYWw7CiAgICAgIHRoaXMuaXRlbUxpbmUuaXNFZGl0YWJsZSA9IHRydWU7CiAgICAgIGRzLmluc2VydCh0b3RhbCwgdGhpcy5pdGVtTGluZSk7CgogICAgICAvLyBrZW5kby5qUXVlcnkoKS5hZGRDbGFzcygnZWRpdCcpCiAgICAgIC8vIHRoaXMuaXRlbUxpbmVzLnB1c2godGhpcy5pdGVtTGluZSkKICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKCdpdGVtIExpbmUnLCB0aGlzLml0ZW1MaW5lKQogICAgfSwKICAgIG9uUGF5bWVudFRlcm1DaGFuZ2VkKCkgewogICAgICAvLyB0aGlzLm9uSW52b2ljZURhdGVDaGFuZ2VkKCk7CiAgICAgIGlmICh0aGlzLnZlbmRvcikgewogICAgICAgIGNvbnN0IHBheW1lbnRUZXJtID0gdGhpcy5wdXJjaGFzZS5wYXltZW50VGVybSB8fCB7fTsKICAgICAgICBjb25zdCBuZXREdWUgPSBwYXltZW50VGVybS5uZXREdWUgfHwgMDsKICAgICAgICBjb25zdCBzb21lRGF0ZSA9IG5ldyBEYXRlKHRoaXMucHVyY2hhc2UudHJhbnNhY3Rpb25EYXRlKTsKICAgICAgICBzb21lRGF0ZS5zZXREYXRlKHNvbWVEYXRlLmdldERhdGUoKSArIHBhcnNlSW50KG5ldER1ZSkpOyAvL251bWJlciAgb2YgZGF5cyB0byBhZGQsIGUueC4gMTUgZGF5cwogICAgICAgIHRoaXMucHVyY2hhc2UuZHVlRGF0ZSA9IHNvbWVEYXRlOwogICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZygiaW0iLCBzb21lRGF0ZSwgbmV0RHVlKTsKICAgICAgfQogICAgfSwKICAgIGFzeW5jIG9uSW52b2ljZURhdGVDaGFuZ2VkKCkgewogICAgICBhd2FpdCB0aGlzLmxvYWRQYXltZW50VGVybUxpc3QoKTsKICAgICAgYXdhaXQgdGhpcy5sb2FkQ3JlZGl0TGltaXQoKTsKICAgICAgYXdhaXQgdGhpcy5sb2FkQ3VzdG9tZXJCYWxhbmNlKHRoaXMudmVuZG9yLmlkKTsKICAgICAgYXdhaXQgdGhpcy5vblByaWNlTGV2ZWxDaGFuZ2UoKTsKCiAgICAgIHRoaXMubW9udGhPZiA9IGtlbmRvLnRvU3RyaW5nKG5ldyBEYXRlKHRoaXMudHhuRGF0ZSksICJ5eXl5LU1NIik7CiAgICAgIC8vIGlmICh0aGlzLnZlbmRvcikgewogICAgICAvLyAgICAgaWYgKHRoaXMucHVyY2hhc2UuaGFzT3duUHJvcGVydHkoInBheW1lbnRUZXJtIikpIHsKICAgICAgLy8gICAgICAgICBpZiAodGhpcy5wdXJjaGFzZS5wYXltZW50VGVybS5oYXNPd25Qcm9wZXJ0eSgibmV0RHVlIikpIHsKICAgICAgLy8gICAgICAgICAgICAgY29uc3QgbmV0RHVlID0gdGhpcy5wdXJjaGFzZS5wYXltZW50VGVybS5uZXREdWU7CiAgICAgIC8vICAgICAgICAgICAgIGNvbnN0IHNvbWVEYXRlID0gbmV3IERhdGUodGhpcy50eG5EYXRlKTsKICAgICAgLy8gICAgICAgICAgICAgc29tZURhdGUuc2V0RGF0ZShzb21lRGF0ZS5nZXREYXRlKCkgKyBwYXJzZUludChuZXREdWUpKTsgLy9udW1iZXIgIG9mIGRheXMgdG8gYWRkLCBlLnguIDE1IGRheXMKICAgICAgLy8gICAgICAgICAgICAgdGhpcy5wdXJjaGFzZS5kdWVEYXRlID0gc29tZURhdGUudG9JU09TdHJpbmcoKS5zdWJzdHIoMCwgMTApOwogICAgICAvLyAgICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coJ2ltJywgc29tZURhdGUsIG5ldER1ZSkKICAgICAgLy8gICAgICAgICB9CiAgICAgIC8vICAgICB9CiAgICAgIC8vIH0KICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5nZW5lcmF0ZU51bWJlcigpOwogICAgICB9CiAgICAgIHRoaXMubG9hZFRyYW5zYWN0aW9uUmF0ZSgpOwogICAgfSwKICAgIGFzeW5jIGxvYWRQcmVmaXgoKSB7CiAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgcHJlZml4SGFuZGxlci5nZXQoInB1cmNoYXNlIikudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZVR5cGVzID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICBpZiAodGhpcy5wdXJjaGFzZVR5cGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2UudHJhbnNhY3Rpb25UeXBlID0gdGhpcy5wdXJjaGFzZVR5cGVzWzBdOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVOdW1iZXIoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0sIDEwKTsKICAgICAgfSk7CiAgICB9LAogICAgYXN5bmMgbG9hZFByaWNlTGV2ZWwoKSB7CiAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgY29uc3Qgc3RyRmlsdGVyID0gIj8mbmF0dXJlPSIgKyBOQVRVUkU7CiAgICAgICAgICBwcmljZUxldmVsSGFuZGxlci5nZXQoc3RyRmlsdGVyKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgdGhpcy5wcmljZUxldmVsID0gcmVzOwogICAgICAgICAgICBpZiAodGhpcy5wcmljZUxldmVsLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlLnByaWNlTGV2ZWwgPSB0aGlzLnByaWNlTGV2ZWxbMF07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0sIDEwKTsKICAgICAgfSk7CiAgICB9LAogICAgYXN5bmMgbG9hZERpc2NvdW50SXRlbSgpIHsKICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICBkaXNjb3VudEl0ZW1IYW5kbGVyLmxpc3QoRElTQ09VTlRfVFlQRSkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICB0aGlzLnNwZWNpZmljRGlzY291bnRJdGVtID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSwgMTApOwogICAgICB9KTsKICAgIH0sCiAgICBhc3luYyBsb2FkT3RoZXJDaGFyZ2UoKSB7CiAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgb3RoZXJDaGFyZ2VIYW5kbGVyLmxpc3QoKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgIHRoaXMub3RoZXJDaGFyZ2VMaXN0ID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSwgMTApOwogICAgICB9KTsKICAgIH0sCiAgICBhc3luYyBsb2FkQWNjb3VudCgpIHsKICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICBhY2NvdW50SGFuZGxlci5nZXRBbGwoKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAvL1JlY2VpdmFibGUgQWNjb3VudAogICAgICAgICAgICB0aGlzLmFjY1BheWFibGUgPSByZXMuZGF0YQogICAgICAgICAgICAgIC5maWx0ZXIoKG0pID0+IG0uYWNjb3VudF90eXBlLm51bWJlciA9PT0gMTgpCiAgICAgICAgICAgICAgLm1hcCgoaXRtKSA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBpZDogaXRtLnV1aWQsCiAgICAgICAgICAgICAgICAgIHV1aWQ6IGl0bS51dWlkLAogICAgICAgICAgICAgICAgICBuYW1lOiBpdG0ubmFtZSwKICAgICAgICAgICAgICAgICAgbG9jYWxfbmFtZTogaXRtLmxvY2FsX25hbWUsCiAgICAgICAgICAgICAgICAgIG51bWJlcjogaXRtLm51bWJlciwKICAgICAgICAgICAgICAgICAgaXNfdGF4YWJsZTogaXRtLmlzX3RheGFibGUsCiAgICAgICAgICAgICAgICAgIGJhbmhqaUFjY0NvZGU6IGl0bS5iYW5oamlBY2NDb2RlLAogICAgICAgICAgICAgICAgICBncm91cF9jb2RlOiBpdG0uZ3JvdXBfY29kZSwKICAgICAgICAgICAgICAgICAgcGFyZW50X2FjY291bnQ6IGl0bS5wYXJlbnRfYWNjb3VudCwKICAgICAgICAgICAgICAgICAgdHlwZV9jb2RlOiBpdG0udHlwZV9jb2RlLAogICAgICAgICAgICAgICAgICBhY2NvdW50X3R5cGU6IGl0bS5hY2NvdW50X3R5cGUsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAodGhpcy5hY2NQYXlhYmxlLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlLmFwQWNjID0gdGhpcy5hY2NQYXlhYmxlWzBdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuYWNjV2l0aGhvbGRpbmdFeHBlbnNlID0gcmVzLmRhdGEKICAgICAgICAgICAgICAuZmlsdGVyKChtKSA9PiBwYXJzZUludChtLmJhbmhqaUFjY0NvZGUpID09PSA4NDMwMDApCiAgICAgICAgICAgICAgLm1hcCgoaXRtKSA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBpZDogaXRtLnV1aWQsCiAgICAgICAgICAgICAgICAgIHV1aWQ6IGl0bS51dWlkLAogICAgICAgICAgICAgICAgICBuYW1lOiBpdG0ubmFtZSwKICAgICAgICAgICAgICAgICAgbG9jYWxfbmFtZTogaXRtLmxvY2FsX25hbWUsCiAgICAgICAgICAgICAgICAgIG51bWJlcjogaXRtLm51bWJlciwKICAgICAgICAgICAgICAgICAgaXNfdGF4YWJsZTogaXRtLmlzX3RheGFibGUsCiAgICAgICAgICAgICAgICAgIGJhbmhqaUFjY0NvZGU6IGl0bS5iYW5oamlBY2NDb2RlLAogICAgICAgICAgICAgICAgICBncm91cF9jb2RlOiBpdG0uZ3JvdXBfY29kZSwKICAgICAgICAgICAgICAgICAgcGFyZW50X2FjY291bnQ6IGl0bS5wYXJlbnRfYWNjb3VudCwKICAgICAgICAgICAgICAgICAgdHlwZV9jb2RlOiBpdG0udHlwZV9jb2RlLAogICAgICAgICAgICAgICAgICBhY2NvdW50X3R5cGU6IGl0bS5hY2NvdW50X3R5cGUsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSwgMTApOwogICAgICB9KTsKICAgIH0sCiAgICBhc3luYyBsb2FkUGF5bWVudFRlcm0oKSB7CiAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgY29uc3Qgc3RyRmlsdGVyID0gIj90eXBlPXBtdC1zdXBwbGllciI7CiAgICAgICAgICB0aGlzLnBheW1lbnRUZXJtcyA9IFtdOwogICAgICAgICAgc2V0dGluZ3NIYW5kbGVyLmdldFBheW1lbnRUZXJtKHN0ckZpbHRlcikudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5wYXltZW50VGVybXMgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICBpZiAodGhpcy5wYXltZW50VGVybXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIHRoaXMucHVyY2hhc2UucGF5bWVudFRlcm0gPSB0aGlzLnBheW1lbnRUZXJtc1swXTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSwgMTApOwogICAgICB9KTsKICAgIH0sCiAgICBhc3luYyBsb2FkTG9jYXRpb24oKSB7CiAgICAgIHRoaXMubG9jYXRpb25zID0gW107CiAgICAgIGNvbnN0IHJvbGVUeXBlID0gZGF0YVN0b3JlLnJvbGVUeXBlIHx8IDA7CiAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygKICAgICAgICAiIGNvbnN0IHJvbGVUeXBlID0gZGF0YVN0b3JlLnJvbGVUeXBlIHx8IDAiLAogICAgICAgIGRhdGFTdG9yZQogICAgICApOwogICAgICBpZiAocm9sZVR5cGUgPT09IDApIHsKICAgICAgICBpZiAoZGF0YVN0b3JlLnJvbGVEYXRhKSB7CiAgICAgICAgICBjb25zdCByb2xlRGF0YSA9IGRhdGFTdG9yZS5yb2xlRGF0YSB8fCBbXTsKICAgICAgICAgIGNvbnN0IGxvY2F0aW9uID0gcm9sZURhdGEuZmlsdGVyKChpdG0pID0+IGl0bS50eXBlID09PSAibG9jYXRpb24iKTsKICAgICAgICAgIGNvbnN0IGxvY2F0aW9uRGVmYXVsdCA9IGxvY2F0aW9uLmZpbHRlcigobSkgPT4gbS5pc0RlZmF1bHQgPT09IDEpOwogICAgICAgICAgdGhpcy5sb2NhdGlvbnMgPSBsb2NhdGlvbjsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgdGhpcy4kcm91dGUucGFyYW1zLmlkID09PSB1bmRlZmluZWQgfHwKICAgICAgICAgICAgdGhpcy4kcm91dGUucGFyYW1zLmlkID09PSAiIgogICAgICAgICAgKSB7CiAgICAgICAgICAgIGlmIChsb2NhdGlvbkRlZmF1bHQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIHRoaXMucHVyY2hhc2UubG9jYXRpb24gPSBsb2NhdGlvbkRlZmF1bHRbMF07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocm9sZVR5cGUgPT09IDEpIHsKICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgIHRoaXMubG9jYXRpb25zID0gW107CiAgICAgICAgICAgIGxvY2F0aW9uSGFuZGxlci5saXN0KCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgdGhpcy5sb2NhdGlvbnMgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgaWYgKHRoaXMubG9jYXRpb25zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZS5sb2NhdGlvbiA9IHRoaXMubG9jYXRpb25zWzBdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sIDEwKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGFzeW5jIGxvYWRQcm9qZWN0QnlDdXN0b21lcigpIHsKICAgICAgdGhpcy5jdXN0b21lclByb2plY3RzID0gW107CiAgICAgIGNvbnN0IHJvbGVUeXBlID0gZGF0YVN0b3JlLnJvbGVUeXBlIHx8IDA7CiAgICAgIGlmIChyb2xlVHlwZSA9PT0gMCkgewogICAgICAgIGlmIChkYXRhU3RvcmUucm9sZURhdGEpIHsKICAgICAgICAgIGNvbnN0IHJvbGVEYXRhID0gZGF0YVN0b3JlLnJvbGVEYXRhIHx8IFtdOwogICAgICAgICAgY29uc3QgcHJvamVjdCA9IHJvbGVEYXRhLmZpbHRlcigoaXRtKSA9PiBpdG0udHlwZSA9PT0gInByb2plY3QiKTsKICAgICAgICAgIHRoaXMuY3VzdG9tZXJQcm9qZWN0cyA9IHByb2plY3Q7CiAgICAgICAgICAvLyBwcm9qZWN0LmZvckVhY2goayA9PiB7CiAgICAgICAgICAvLyAgICAgY29uc3QgY3VzdG9tZXJzID0gay5jdXN0b21lcnMgfHwgW10KICAgICAgICAgIC8vICAgICBjb25zdCBwcm9DdXN0b21lciA9IGN1c3RvbWVycy5maWx0ZXIobiA9PiBuLmN1c3RvbWVyLmlkID09PSB0aGlzLmN1c3RvbWVyLmlkKQogICAgICAgICAgLy8gICAgIGlmIChwcm9DdXN0b21lci5sZW5ndGggPiAwKSB7CiAgICAgICAgICAvLyAgICAgICAgIHRoaXMuY3VzdG9tZXJQcm9qZWN0cy5wdXNoKGspCiAgICAgICAgICAvLyAgICAgfQogICAgICAgICAgLy8gfSkKICAgICAgICAgIGlmICgKICAgICAgICAgICAgdGhpcy4kcm91dGUucGFyYW1zLmlkID09PSB1bmRlZmluZWQgfHwKICAgICAgICAgICAgdGhpcy4kcm91dGUucGFyYW1zLmlkID09PSAiIgogICAgICAgICAgKSB7CiAgICAgICAgICAgIGNvbnN0IHByb2plY3REZWZhdWx0ID0gdGhpcy5jdXN0b21lclByb2plY3RzLmZpbHRlcigKICAgICAgICAgICAgICAobSkgPT4gbS5pc0RlZmF1bHQgPT09IDEKICAgICAgICAgICAgKTsKICAgICAgICAgICAgaWYgKHByb2plY3REZWZhdWx0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlLnByb2plY3QgPSBwcm9qZWN0RGVmYXVsdFswXTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChyb2xlVHlwZSA9PT0gMSkgewogICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgaWYgKHRoaXMudmVuZG9yKSB7CiAgICAgICAgICAgICAgLy8gcHJvamVjdEhhbmRsZXIuZ2V0QnlTdXBwbGllcih0aGlzLnZlbmRvci5pZCkudGhlbihyZXMgPT4gewogICAgICAgICAgICAgIHByb2plY3RIYW5kbGVyLmxpc3QoKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICB0aGlzLmN1c3RvbWVyUHJvamVjdHMgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAvLyBpZiAodGhpcy5jdXN0b21lclByb2plY3RzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgLy8gICAgIHRoaXMucHVyY2hhc2UucHJvamVjdCA9IHRoaXMuY3VzdG9tZXJQcm9qZWN0c1swXTsKICAgICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCAxMCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBhc3luYyBsb2FkQ3VzdG9tZXJCYWxhbmNlKGlkKSB7CiAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgY29uc3Qgc3RyRmlsdGVyID0gaWQgKyAiP3R5cGU9YmFsIjsKICAgICAgICAgIHRoaXMucHVyY2hhc2UuY3VycmVudEJhbGFuY2UgPSAwOwogICAgICAgICAgYmlsbGluZ0hhbmRsZXIKICAgICAgICAgICAgLmJhbGFuY2Uoc3RyRmlsdGVyKQogICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2UuY3VycmVudEJhbGFuY2UgPSBkYXRhWzBdLmJhbGFuY2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKTsKICAgICAgICAgIHsKICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0sIDEwKTsKICAgICAgfSk7CiAgICB9LAogICAgYXN5bmMgbG9hZEN1c3RvbWVyRGVwb3NpdEJhbGFuY2UoaWQpIHsKICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICBjb25zdCBzdHJGaWx0ZXIgPSBpZCArICI/dHlwZT1kZXAiOwogICAgICAgICAgdGhpcy5wdXJjaGFzZS5kZXBvc2l0QW1vdW50ID0gMDsKICAgICAgICAgIHRoaXMucHVyY2hhc2UuZGVwb3NpdERlZHVjdGlvbiA9IDA7CiAgICAgICAgICBiaWxsaW5nSGFuZGxlcgogICAgICAgICAgICAuYmFsYW5jZShzdHJGaWx0ZXIpCiAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgIGlmIChkYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgY29uc3QgYW1vdW50RGVwb3NpdCA9IGRhdGFbMF0uYmFsYW5jZTsKICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKGFtb3VudERlcG9zaXQsICJiYWxhIik7CiAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2UuZGVwb3NpdEFtb3VudCA9CiAgICAgICAgICAgICAgICAgICAgYW1vdW50RGVwb3NpdCAvIHRoaXMucHVyY2hhc2UudHhuUmF0ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgpOwogICAgICAgICAgewogICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfSwgMTApOwogICAgICB9KTsKICAgIH0sCiAgICBjcmVkaXRMaW1pdFVzYWdlKGJhbGFuY2UsIGNyZWRpdExpbWl0KSB7CiAgICAgIHJldHVybiAoCiAgICAgICAga2VuZG8udG9TdHJpbmcoCiAgICAgICAgICAoYmFsYW5jZSAvIGNyZWRpdExpbWl0KSAqIDEwMCwKICAgICAgICAgIGBuJHt0aGlzLnB1cmNoYXNlRm9ybUNvbnRlbnQuZGVjaW1hbH1gCiAgICAgICAgKSArICIgJSIKICAgICAgKTsKICAgIH0sCiAgICBhc3luYyBsb2FkRW1wbG95ZWVDZW50ZXIoKSB7CiAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgdGhpcy5lbXBsb3llZXMgPSBbXTsKICAgICAgICAgIGVtcGxveWVlSGFuZGxlcgogICAgICAgICAgICAuY2VudGVyKHVuZGVmaW5lZCkKICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuZW1wbG95ZWVzID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmVtcGxveWVlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2UuZW1wbG95ZWUgPSB0aGlzLmVtcGxveWVlc1swXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgpOwogICAgICAgICAgewogICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfSwgMTApOwogICAgICB9KTsKICAgIH0sCiAgICBhc3luYyBsb2FkU2VnbWVudCgpIHsKICAgICAgdGhpcy5zZWdtZW50cyA9IFtdOwogICAgICBjb25zdCByb2xlVHlwZSA9IGRhdGFTdG9yZS5yb2xlVHlwZSB8fCAwOwogICAgICBpZiAocm9sZVR5cGUgPT09IDApIHsKICAgICAgICBpZiAoZGF0YVN0b3JlLnJvbGVEYXRhKSB7CiAgICAgICAgICBjb25zdCByb2xlRGF0YSA9IGRhdGFTdG9yZS5yb2xlRGF0YSB8fCBbXTsKICAgICAgICAgIGNvbnN0IHNlZ21lbnQgPSByb2xlRGF0YS5maWx0ZXIoKGl0bSkgPT4gaXRtLnR5cGUgPT09ICJzZWdtZW50Iik7CiAgICAgICAgICBjb25zdCBzZWdtZW50RGVmYXVsdCA9IHNlZ21lbnQuZmlsdGVyKChtKSA9PiBtLmlzRGVmYXVsdCA9PT0gMSk7CiAgICAgICAgICB0aGlzLnNlZ21lbnRzID0gc2VnbWVudDsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgdGhpcy4kcm91dGUucGFyYW1zLmlkID09PSB1bmRlZmluZWQgfHwKICAgICAgICAgICAgdGhpcy4kcm91dGUucGFyYW1zLmlkID09PSAiIgogICAgICAgICAgKSB7CiAgICAgICAgICAgIGlmIChzZWdtZW50RGVmYXVsdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZS5zZWdtZW50ID0gc2VnbWVudERlZmF1bHRbMF07CiAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCJkYXRhU3RvcmUtLXNlZ21lbnREZWZhdWx0Iiwgc2VnbWVudERlZmF1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHJvbGVUeXBlID09PSAxKSB7CiAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICB0aGlzLnNlZ21lbnRzID0gW107CiAgICAgICAgICAgIHNldHRpbmdzSGFuZGxlci5nZXRTZWcoKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNlZ21lbnRzID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlZ21lbnRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZS5zZWdtZW50ID0gdGhpcy5zZWdtZW50c1swXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwgMTApOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgYXN5bmMgbG9hZFRheCgpIHsKICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICBzZXR0aW5nSGFuZGxlci5nZXQoKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgY29uc3QgdGF4ZXMgPSByZXM7CiAgICAgICAgICAgIHRoaXMudGF4ID0gdGF4ZXMuZmlsdGVyKAogICAgICAgICAgICAgIChtKSA9PgogICAgICAgICAgICAgICAgKG0udGF4VHlwZS50eXBlSWQgPT09IDEgfHwKICAgICAgICAgICAgICAgICAgbS50YXhUeXBlLnR5cGVJZCA9PT0gMTAgfHwKICAgICAgICAgICAgICAgICAgbS50YXhUeXBlLnR5cGVJZCA9PT0gMikgJiYKICAgICAgICAgICAgICAgIG0udHJhbnNhY3Rpb25UeXBlID09PSAiUHVyY2hhc2UiCiAgICAgICAgICAgICk7IC8vIHZhbHVhYmxlIHRheAogICAgICAgICAgfSk7CiAgICAgICAgfSwgMTApOwogICAgICB9KTsKICAgIH0sCiAgICBhc3luYyBvblNhdmVDbG9zZShzYXZlU2VuZCkgewogICAgICBpZiAoIXRoaXMuJHJlZnMuZm9ybS52YWxpZGF0ZSgpKSB7CiAgICAgICAgdGhpcy4kcmVmcy5mb3JtLnZhbGlkYXRlKCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh0aGlzLnRyYW5zYWN0aW9uUmF0ZSA9PT0gMCkgewogICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoaTE4bi50KCJzZXRfZXhjaGFuZ2VfcmF0ZSIpKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGxldCBpZCA9ICIiOwogICAgICBpZiAodGhpcy52ZW5kb3IuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICBpZCA9IHRoaXMudmVuZG9yLmlkIHx8ICIiOwogICAgICB9CiAgICAgIGlmIChpZCA9PT0gIiIpIHsKICAgICAgICB0aGlzLiRzbm90aWZ5LmVycm9yKCJ2ZW5kb3IgaXMgcmVxdWlyZWQiKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHRoaXMucHVyY2hhc2UuYmlsbE5vID09ICIiKSB7CiAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcigiVmVuZG9yIEludm9pY2UgTm8gaXMgcmVxdWlyZWQiKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLiRyZWZzLmZvcm0udmFsaWRhdGUoKSkgewogICAgICAgIHRoaXMuJHJlZnMuZm9ybS52YWxpZGF0ZSgpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLml0ZW1MaW5lRFMua2VuZG9XaWRnZXQoKTsKICAgICAgbGV0IGQxID0gZHMuZGF0YSgpOwogICAgICBsZXQgZGF0YVZhbGlkYXRlID0gMDsKICAgICAgYXdhaXQgdGhpcy5hdXRvQ2FsY3VsYXRlKCk7CiAgICAgIGQxLmZvckVhY2goKHZhbHVlLCBpbmRleCkgPT4gewogICAgICAgIGlmICgKICAgICAgICAgIHZhbHVlLml0ZW0gPT0gdW5kZWZpbmVkIHx8CiAgICAgICAgICB2YWx1ZS5pdGVtLmlkID09IHVuZGVmaW5lZCB8fAogICAgICAgICAgdmFsdWUuaXRlbS5pZCA9PSBudWxsIHx8CiAgICAgICAgICB2YWx1ZS51b20gPT0gdW5kZWZpbmVkIHx8CiAgICAgICAgICB2YWx1ZS51b20udW9tLmlkID09IHVuZGVmaW5lZCB8fAogICAgICAgICAgdmFsdWUudW9tLnVvbS5pZCA9PSBudWxsCiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLiRzbm90aWZ5LmVycm9yKAogICAgICAgICAgICAiUGxlYXNlIGNoZWNrIEl0ZW0gb3IgVU9NICBvbiByb3cgIiArIChpbmRleCArIDEpCiAgICAgICAgICApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkYXRhVmFsaWRhdGUgKz0gMTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBpZiAoZDEubGVuZ3RoID09IGRhdGFWYWxpZGF0ZSkgewogICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgbGV0IGlzQXV0b0dlbmVyYXRlID0gMTsKICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCkgewogICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlID0gbmV3IERhdGUodGhpcy50eG5EYXRlKTsKICAgICAgICAgICAgICBjb25zdCB0cmFuRGF0ZUludm9pY2UgPSBuZXcgRGF0ZSh0aGlzLnB1cmNoYXNlLnRyYW5zYWN0aW9uRGF0ZSk7CiAgICAgICAgICAgICAgY29uc3QgdHJhbkRhdGVNID0gdHJhbkRhdGUuZ2V0RnVsbFllYXIoKSArIHRyYW5EYXRlLmdldE1vbnRoKCk7CiAgICAgICAgICAgICAgY29uc3QgdHJhbkRhdGVJbnZvaWNlTSA9CiAgICAgICAgICAgICAgICB0cmFuRGF0ZUludm9pY2UuZ2V0RnVsbFllYXIoKSArIHRyYW5EYXRlSW52b2ljZS5nZXRNb250aCgpOwogICAgICAgICAgICAgIGlmICh0cmFuRGF0ZU0gPT09IHRyYW5EYXRlSW52b2ljZU0pIHsKICAgICAgICAgICAgICAgIGlzQXV0b0dlbmVyYXRlID0gMDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCBpdGVtTGluZURTID0gdGhpcy4kcmVmcy5pdGVtTGluZURTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgIGNvbnN0IGRhdGFSb3cgPSBpdGVtTGluZURTCiAgICAgICAgICAgICAgLmRhdGEoKQogICAgICAgICAgICAgIC5maWx0ZXIoKG8pID0+IG8uYW1vdW50ID4gMCkKICAgICAgICAgICAgICAubWFwKChuKSA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEl0ZW1MaW5lTW9kZWwobik7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGlmIChkYXRhUm93Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBsZXQgZGF0YSA9IHsKICAgICAgICAgICAgICAgIGlkOiB0aGlzLnB1cmNoYXNlLmlkID8gdGhpcy5wdXJjaGFzZS5pZCA6ICIiLAogICAgICAgICAgICAgICAgdXVpZDogdGhpcy5wdXJjaGFzZS51dWlkID8gdGhpcy5wdXJjaGFzZS51dWlkIDogIiIsCiAgICAgICAgICAgICAgICBqb3VybmFsX3V1aWQ6IHRoaXMucHVyY2hhc2Uuam91cm5hbF91dWlkCiAgICAgICAgICAgICAgICAgID8gdGhpcy5wdXJjaGFzZS5qb3VybmFsX3V1aWQKICAgICAgICAgICAgICAgICAgOiAiIiwKICAgICAgICAgICAgICAgIGpSYXc6IHRoaXMualJhdywKICAgICAgICAgICAgICAgIHR5cGU6IFRSQU5TQUNUSU9OX1RZUEUsCiAgICAgICAgICAgICAgICBudW1iZXI6IHRoaXMucHVyY2hhc2UubnVtYmVyLAogICAgICAgICAgICAgICAgYWJicjogdGhpcy5wdXJjaGFzZS50cmFuc2FjdGlvblR5cGUuYWJiciwKICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogdGhpcy50eG5EYXRlLAogICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25EYXRlVFo6IEhlbHBlci50b0lTT0RhdGUodGhpcy50eG5EYXRlKSwKICAgICAgICAgICAgICAgIGR1ZURhdGU6IHRoaXMucHVyY2hhc2UuZHVlRGF0ZSwKICAgICAgICAgICAgICAgIG1vbnRoT2Y6IHRoaXMubW9udGhPZiwKICAgICAgICAgICAgICAgIHBheW1lbnRDb2RlOiB0aGlzLnB1cmNoYXNlLnBheW1lbnRDb2RlLAogICAgICAgICAgICAgICAgYmlsbE5vOiB0aGlzLnB1cmNoYXNlLmJpbGxObywKICAgICAgICAgICAgICAgIGJpbGxEYXRlOiB0aGlzLmJpbGxEYXRlLAogICAgICAgICAgICAgICAgc3VwcGxpZXI6IHRoaXMucHVyY2hhc2Uuc3VwcGxpZXIsCiAgICAgICAgICAgICAgICB0cmFuc2FjdGlvblR5cGU6IHRoaXMucHVyY2hhc2UudHJhbnNhY3Rpb25UeXBlLAogICAgICAgICAgICAgICAgcGF5bWVudFRlcm06IHRoaXMucHVyY2hhc2UucGF5bWVudFRlcm0sCiAgICAgICAgICAgICAgICBkaXNjb3VudFByb21vdGlvbjoge30sCiAgICAgICAgICAgICAgICBhcEFjYzogdGhpcy5wdXJjaGFzZS5hcEFjYywKICAgICAgICAgICAgICAgIGN1cnJlbmN5OiB0aGlzLnB1cmNoYXNlLmN1cnJlbmN5LAogICAgICAgICAgICAgICAgdHhuUmF0ZTogdGhpcy5wdXJjaGFzZS50eG5SYXRlLAogICAgICAgICAgICAgICAgcmF0ZTogMSwKICAgICAgICAgICAgICAgIGV4Y2hhbmdlUmF0ZTogdGhpcy5wdXJjaGFzZS5leGNoYW5nZVJhdGUsCiAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogdGhpcy5wdXJjaGFzZS5leGNoYW5nZUFtb3VudCwKICAgICAgICAgICAgICAgIHByaWNlTGV2ZWw6IHRoaXMucHVyY2hhc2UucHJpY2VMZXZlbCwKICAgICAgICAgICAgICAgIGl0ZW1MaW5lczogZGF0YVJvdywKICAgICAgICAgICAgICAgIHNlZ21lbnQ6IHRoaXMucHVyY2hhc2Uuc2VnbWVudCwKICAgICAgICAgICAgICAgIGxvY2F0aW9uOiB0aGlzLnB1cmNoYXNlLmxvY2F0aW9uLAogICAgICAgICAgICAgICAgcHJvamVjdDogdGhpcy5wdXJjaGFzZS5wcm9qZWN0LAogICAgICAgICAgICAgICAgZW1wbG95ZWU6IHRoaXMucHVyY2hhc2UuZW1wbG95ZWUsCiAgICAgICAgICAgICAgICBiaWxsaW5nQWRkcmVzczogdGhpcy5wdXJjaGFzZS5iaWxsaW5nQWRkcmVzcywKICAgICAgICAgICAgICAgIGRlbGl2ZXJ5QWRkcmVzczogdGhpcy5wdXJjaGFzZS5kZWxpdmVyeUFkZHJlc3MsCiAgICAgICAgICAgICAgICBkZWxpdmVyeURhdGVUaW1lOiB0aGlzLnB1cmNoYXNlLmRlbGl2ZXJ5RGF0ZVRpbWUsCiAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbk5vdGU6IHRoaXMucHVyY2hhc2UudHJhbnNhY3Rpb25Ob3RlLAogICAgICAgICAgICAgICAgam91cm5hbE5vdGU6IHRoaXMucHVyY2hhc2Uuam91cm5hbE5vdGUsCiAgICAgICAgICAgICAgICBzdWJUb3RhbDogdGhpcy5wdXJjaGFzZS5zdWJUb3RhbCwKICAgICAgICAgICAgICAgIHRvdGFsOiB0aGlzLnB1cmNoYXNlLnRvdGFsLAogICAgICAgICAgICAgICAgZGlzY291bnRUb3RhbDogdGhpcy5wdXJjaGFzZS5kaXNjb3VudFRvdGFsLAogICAgICAgICAgICAgICAgZXhjaGFuZ2VEaXNjb3VudFRvdGFsOgogICAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlLmRpc2NvdW50VG90YWwgKiAodGhpcy5wdXJjaGFzZS50eG5SYXRlIHx8IDEpLAogICAgICAgICAgICAgICAgc3BlY2lmaWNEaXNjb3VudFRvdGFsOiB0aGlzLnB1cmNoYXNlLnNwZWNpZmljRGlzY291bnRUb3RhbCwKICAgICAgICAgICAgICAgIGRlbGl2ZXJ5RmVlOiB0aGlzLnB1cmNoYXNlLmRlbGl2ZXJ5RmVlLAogICAgICAgICAgICAgICAgdG90YWxUYXhBbW91bnQ6IHRoaXMucHVyY2hhc2UudG90YWxUYXhBbW91bnQsCiAgICAgICAgICAgICAgICBkZXBvc2l0QW1vdW50OiB0aGlzLnB1cmNoYXNlLmRlcG9zaXRBbW91bnQsCiAgICAgICAgICAgICAgICBkZXBvc2l0RGVkdWN0aW9uOiB0aGlzLnB1cmNoYXNlLmRlcG9zaXREZWR1Y3Rpb24sCiAgICAgICAgICAgICAgICByZW1haW5pbmdBbW91bnQ6IHRoaXMucHVyY2hhc2UucmVtYWluaW5nQW1vdW50LAogICAgICAgICAgICAgICAgYW1vdW50RHVlOiB0aGlzLnB1cmNoYXNlLmFtb3VudER1ZSwKICAgICAgICAgICAgICAgIGN1cnJlbnRCYWxhbmNlOiB0aGlzLnB1cmNoYXNlLmN1cnJlbnRCYWxhbmNlLAogICAgICAgICAgICAgICAgYmFsYW5jZTogdGhpcy5wdXJjaGFzZS5iYWxhbmNlLAogICAgICAgICAgICAgICAgY3JlZGl0TGltaXQ6IHRoaXMucHVyY2hhc2UuY3JlZGl0TGltaXQsCiAgICAgICAgICAgICAgICBzYXZlT3B0aW9uOiB0aGlzLnB1cmNoYXNlLnNhdmVPcHRpb24sCiAgICAgICAgICAgICAgICBzdGF0dXM6IDEsCiAgICAgICAgICAgICAgICBhcHByb3ZlZEJ5OiB0aGlzLnB1cmNoYXNlLmFwcHJvdmVkQnksCiAgICAgICAgICAgICAgICBmb3JtVGVtcGxhdGU6IHt9LAogICAgICAgICAgICAgICAgc3BlY2lmaWNEaXNjb3VudEl0ZW06IHRoaXMucHVyY2hhc2Uuc3BlY2lmaWNEaXNjb3VudEl0ZW0sCiAgICAgICAgICAgICAgICBvdGhlckNoYXJnZTogdGhpcy5tT3RoZXJDaGFyZ2UsCiAgICAgICAgICAgICAgICBvdGhlckNoYXJnZUFtb3VudDogdGhpcy5wdXJjaGFzZS5vdGhlckNoYXJnZUFtb3VudCwKICAgICAgICAgICAgICAgIHRheExpc3RUb3RhbDogdGhpcy50YXhMaXN0VG90YWwsCiAgICAgICAgICAgICAgICBzdXBwbGllckRpc2NvdW50SXRlbTogdGhpcy5zdXBwbGllckRpc2NvdW50SXRlbSwKICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogdGhpcy5wdXJjaGFzZS5jcmVhdGVkQXQsCiAgICAgICAgICAgICAgICBpdGVtU3VidG90YWw6IHRoaXMucHVyY2hhc2UuaXRlbVN1YnRvdGFsLAogICAgICAgICAgICAgICAgZXhjaGFuZ2VJdGVtU3VidG90YWw6IHRoaXMucHVyY2hhc2UuZXhjaGFuZ2VJdGVtU3VidG90YWwsCiAgICAgICAgICAgICAgICBzZXJ2aWNlU3VidG90YWw6IHRoaXMucHVyY2hhc2Uuc2VydmljZVN1YnRvdGFsLAogICAgICAgICAgICAgICAgZXhjaGFuZ2VTZXJ2aWNlU3VidG90YWw6IHRoaXMucHVyY2hhc2UuZXhjaGFuZ2VTZXJ2aWNlU3VidG90YWwsCiAgICAgICAgICAgICAgICB0eG5JdG1TdWJ0b3RhbDogdGhpcy5wdXJjaGFzZS50eG5JdG1TdWJ0b3RhbCwKICAgICAgICAgICAgICAgIGV4Y2hhbmdlVHhuSXRtU3VidG90YWw6IHRoaXMucHVyY2hhc2UuZXhjaGFuZ2VUeG5JdG1TdWJ0b3RhbCwKICAgICAgICAgICAgICAgIGl0ZW1EaXNjb3VudDogdGhpcy5wdXJjaGFzZS5pdGVtRGlzY291bnQsCiAgICAgICAgICAgICAgICBleGNoYW5nZUl0ZW1EaXNjb3VudDogdGhpcy5wdXJjaGFzZS5leGNoYW5nZUl0ZW1EaXNjb3VudCwKICAgICAgICAgICAgICAgIHNlcnZpY2VEaXNjb3VudDogdGhpcy5wdXJjaGFzZS5zZXJ2aWNlRGlzY291bnQsCiAgICAgICAgICAgICAgICBleGNoYW5nZVNlcnZpY2VEaXNjb3VudDogdGhpcy5wdXJjaGFzZS5leGNoYW5nZVNlcnZpY2VEaXNjb3VudCwKICAgICAgICAgICAgICAgIHR4bkl0bURpc2NvdW50OiB0aGlzLnB1cmNoYXNlLnR4bkl0bURpc2NvdW50LAogICAgICAgICAgICAgICAgZXhjaGFuZ2VUeG5JdG1EaXNjb3VudDogdGhpcy5wdXJjaGFzZS5leGNoYW5nZVR4bkl0bURpc2NvdW50LAogICAgICAgICAgICAgICAgd2l0aGhvbGRpbmdUYXhBbW91bnQ6IHRoaXMucHVyY2hhc2Uud2l0aGhvbGRpbmdUYXhBbW91bnQgfHwgMCwKICAgICAgICAgICAgICAgIGluY2x1c2l2ZVRheEFtb3VudDogdGhpcy5wdXJjaGFzZS5pbmNsdXNpdmVUYXhBbW91bnQgfHwgMCwKICAgICAgICAgICAgICAgIGxvZ2dlZFVzZXI6IHRoaXMubG9nZ2VkVXNlciwKICAgICAgICAgICAgICAgIHNhdmVTZW5kOiBzYXZlU2VuZCwKICAgICAgICAgICAgICAgIHJlZkZyb206IHRoaXMucHVyY2hhc2UucmVmRnJvbSB8fCBbXSwKICAgICAgICAgICAgICAgIHJlZlRvOiB0aGlzLnB1cmNoYXNlLnJlZlRvIHx8IFtdLAogICAgICAgICAgICAgICAgc2FsZVRheERldGFpbDogdGhpcy5wdXJjaGFzZS5zYWxlVGF4RGV0YWlsIHx8IFtdLAogICAgICAgICAgICAgICAgaGFzQWRkaXRpb25hbENvc3Q6IHRoaXMucHVyY2hhc2UuYWRkaXRpb25hbENvc3QubGVuZ3RoID4gMCwKICAgICAgICAgICAgICAgIGFkZGl0aW9uYWxDb3N0OiB0aGlzLnB1cmNoYXNlLmFkZGl0aW9uYWxDb3N0IHx8IFtdLAogICAgICAgICAgICAgICAgYWRkaXRpb25hbENvc3RNZXRob2Q6IHRoaXMucHVyY2hhc2UuYWRkaXRpb25hbENvc3RNZXRob2QgfHwgIiIsCiAgICAgICAgICAgICAgICBhZGRpdGlvbmFsQ29zdFRvdGFsOiB0aGlzLmFkZGl0aW9uYWxDb3N0VG90YWwgfHwgMCwKICAgICAgICAgICAgICAgIGlzQXV0b0dlbmVyYXRlOiBpc0F1dG9HZW5lcmF0ZSwKICAgICAgICAgICAgICAgIGFjdGlvblR5cGU6IHRoaXMuJHJvdXRlLnBhcmFtcy5pZAogICAgICAgICAgICAgICAgICA/IHRoaXMuJHJvdXRlLnF1ZXJ5LnR5cGUKICAgICAgICAgICAgICAgICAgOiAibmV3IiwKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5xdWVyeS50eXBlID09PSAicmVjdXJyaW5nIikgewogICAgICAgICAgICAgICAgZGF0YS5pZCA9ICIiOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICBiaWxsaW5nSGFuZGxlcgogICAgICAgICAgICAgICAgLmNyZWF0ZVB1cmNoYXNlKGRhdGEpCiAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAxKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5jbG9zZShyZXNwb25zZS5kYXRhLmRhdGEpCiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy4kcmVmcy5mb3JtLnJlc2V0KCkKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5zdWNjZXNzKCJTdWNjZXNzZnVsbHkiKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc2F2ZVNlbmQgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZShyZXNwb25zZS5kYXRhLmRhdGEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoIlNvbWV0aGluZyB3ZW50IHdyb25nIik7CiAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JzLnB1c2goZSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgNTApOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgYXN5bmMgbG9hZFB1cmNoYXNlRm9ybUNvbnRlbnQoKSB7CiAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgcHVyY2hhc2VGb3JtQ29udGVudEhhbmRsZXIubGlzdCgpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZUZvcm1Db250ZW50ID0gZGF0YVswXTsKICAgICAgICAgICAgICAgIHRoaXMuZGVjaW1hbEZvcm1hdCA9ICJuIiArIHRoaXMucHVyY2hhc2VGb3JtQ29udGVudC5kZWNpbWFsOwogICAgICAgICAgICAgICAgdGhpcy5pbml0RGF0YSgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSwgNTApOwogICAgICB9KTsKICAgIH0sCiAgICBjbG9zZShkYXRhKSB7CiAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgIG5hbWU6ICJWZW5kb3JzIiwKICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgICAgfSwKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB3aW5kb3cuaGlzdG9yeS5nbygtMSk7CiAgICAgICAgLy8gdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgIC8vICAgICBwYXRoOiAiaW52b2ljZV92aWV3IiwKICAgICAgICAvLyAgICAgbmFtZTogIkludm9pY2UgVmlldyIsCiAgICAgICAgLy8gICAgIHBhcmFtczogewogICAgICAgIC8vICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAvLyAgICAgfQogICAgICAgIC8vIH0pCiAgICAgIH0KICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKGRhdGEsICdkYXRhJykKICAgIH0sCiAgICBzYXZlTmV3KCkge30sCiAgICByZW1vdmVSb3coZSkgewogICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGNvbnN0IGdyaWQgPSBrZW5kby5qUXVlcnkoIiNncmlkSXRlbUxpbmUiKS5kYXRhKCJrZW5kb0dyaWQiKSwKICAgICAgICBkYXRhU291cmNlID0gZ3JpZC5kYXRhU291cmNlLAogICAgICAgIGRhdGFJdGVtID0gZ3JpZC5kYXRhSXRlbSgkKGUuY3VycmVudFRhcmdldCkuY2xvc2VzdCgidHIiKSk7CgogICAgICBpZiAoZGF0YVNvdXJjZS50b3RhbCgpID4gMSkgewogICAgICAgIGRhdGFTb3VyY2UucmVtb3ZlKGRhdGFJdGVtKTsKICAgICAgICB0aGlzLmF1dG9DYWxjdWxhdGUoKTsKICAgICAgfQogICAgfSwKICAgIGdlbmVyYXRlTnVtYmVyKCkgewogICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkKSB7CiAgICAgICAgY29uc3QgdHJhbkRhdGUgPSBuZXcgRGF0ZSh0aGlzLnR4bkRhdGUpOwogICAgICAgIGNvbnN0IHRyYW5EYXRlSW52b2ljZSA9IG5ldyBEYXRlKHRoaXMucHVyY2hhc2UudHJhbnNhY3Rpb25EYXRlKTsKICAgICAgICBjb25zdCB0cmFuRGF0ZU0gPSB0cmFuRGF0ZS5nZXRGdWxsWWVhcigpICsgdHJhbkRhdGUuZ2V0TW9udGgoKTsKICAgICAgICBjb25zdCB0cmFuRGF0ZUludm9pY2VNID0KICAgICAgICAgIHRyYW5EYXRlSW52b2ljZS5nZXRGdWxsWWVhcigpICsgdHJhbkRhdGVJbnZvaWNlLmdldE1vbnRoKCk7CiAgICAgICAgaWYgKHRyYW5EYXRlTSA9PT0gdHJhbkRhdGVJbnZvaWNlTSkgewogICAgICAgICAgdGhpcy5wdXJjaGFzZS5yZWZlcmVuY2VObyA9IHRoaXMucmVmZXJlbmNlTm87CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodGhpcy50eG5EYXRlICE9PSAiIiAmJiB0aGlzLnB1cmNoYXNlVHlwZXMubGVuZ3RoID4gMCkgewogICAgICAgIGxldCBkYXRhID0gewogICAgICAgICAgYWJicjogdGhpcy5wdXJjaGFzZS50cmFuc2FjdGlvblR5cGUuYWJiciwKICAgICAgICAgIHN0cnVjdHVyZTogdGhpcy5wdXJjaGFzZS50cmFuc2FjdGlvblR5cGUuc3RydWN0dXJlLAogICAgICAgICAgdHJhbnNhY3Rpb25EYXRlOiB0aGlzLnR4bkRhdGUsCiAgICAgICAgICBzZXF1Y2VuY2luZzogdGhpcy5wdXJjaGFzZS50cmFuc2FjdGlvblR5cGUuc2VxdWNlbmNpbmcsCiAgICAgICAgICB0eXBlOiAiUHVyY2hhc2UiLAogICAgICAgICAgZW50aXR5OiAxLAogICAgICAgIH07CiAgICAgICAgYmlsbGluZ0hhbmRsZXIKICAgICAgICAgIC5sYXN0TnVtYmVyKGRhdGEpCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgY29uc3QgcmVzID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgICAgICAgIGNvbnN0IGxhc3ROdW1iZXIgPSB0aGlzLnplcm9QYWQoCiAgICAgICAgICAgICAgICBwYXJzZUludChyZXMubGFzdE51bWJlciksCiAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlLnRyYW5zYWN0aW9uVHlwZS5mb3JtYXQKICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIGNvbnN0IG51bWJlciA9CiAgICAgICAgICAgICAgICByZXMuc3VmZml4ICsKICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2UudHJhbnNhY3Rpb25UeXBlLm51bWJlclNlcGFyYXRvciArCiAgICAgICAgICAgICAgICBsYXN0TnVtYmVyOwogICAgICAgICAgICAgIHRoaXMucHVyY2hhc2UubnVtYmVyID0gbnVtYmVyOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuZXJyb3JzLnB1c2goZSk7CiAgICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHplcm9QYWQobnVtLCBwbGFjZXMpIHsKICAgICAgcmV0dXJuIFN0cmluZyhudW0pLnBhZFN0YXJ0KHBsYWNlcywgIjAiKTsKICAgIH0sCiAgICBzdWZmaXgodHJhbnNhY3Rpb25EYXRlKSB7CiAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyhuZXcgRGF0ZSh0cmFuc2FjdGlvbkRhdGUpLCBgeXltbWApOwogICAgfSwKICAgIGVycm9yTWVzc2FnZSgpIHt9LAogICAgYWNjb3VudERyb3BEb3duRWRpdG9yKCkge30sCiAgICBjYW5jZWwoKSB7CiAgICAgIHRoaXMuJHN3YWwoewogICAgICAgIHRpdGxlOiBpMThuLnQoIm1zZ190aXRsZV93YXJuaW5nIiksCiAgICAgICAgdGV4dDogaTE4bi50KCJtc2dfZGlzY2FyZCIpLAogICAgICAgIGljb246ICJ3YXJuaW5nIiwKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IGkxOG4udCgiY2FuY2VsIiksCiAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzRkNDg0OCIsCiAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjRUQxQTNBIiwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogaTE4bi50KCJkaXNjYXJkIiksCiAgICAgIH0pLnRoZW4oKHJlc3VsdENlbikgPT4gewogICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhyZXN1bHRDZW4pOwogICAgICAgIGlmIChyZXN1bHRDZW4udmFsdWUpIHsKICAgICAgICAgIHRoaXMuJGRlc3Ryb3koKTsKICAgICAgICAgIHRoaXMuJHJvdXRlci5nbygtMSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBoaWRlU21hbGxTaWRlYmFyKCkgewogICAgICB0aGlzLmlzSGlkZUJhciA9ICF0aGlzLmlzSGlkZUJhcjsKICAgIH0sCiAgICByZXF1ZXN0RGF0YShza2lwLCBmaWx0ZXIsIGJhc2VVcmwpIHsKICAgICAgY29uc3QgdXJsID0gYmFzZVVybCArIGA/ZmlsdGVyPSR7ZmlsdGVyfWA7CiAgICAgIHRoaXMucmVxdWVzdFN0YXJ0ZWQgPSB0cnVlOwogICAgICBmZXRjaCh1cmwpCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpOwogICAgICAgIH0pCiAgICAgICAgLnRoZW4odGhpcy5hZnRlckZldGNoKTsKICAgIH0sCiAgICByZXF1ZXN0RGF0YV8oc2tpcCwgZmlsdGVyLCBiYXNlVXJsKSB7CiAgICAgIGNvbnN0IHVybCA9IGJhc2VVcmwgKyBgLyR7ZmlsdGVyfWA7CiAgICAgIHRoaXMucmVxdWVzdFN0YXJ0ZWQgPSB0cnVlOwogICAgICBmZXRjaCh1cmwpCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpOwogICAgICAgIH0pCiAgICAgICAgLnRoZW4odGhpcy5hZnRlckZldGNoXyk7CiAgICB9LAogICAgb25DaGFuZ2UoZXZlbnQpIHsKICAgICAgY29uc3QgdmFsdWUgPSBldmVudC52YWx1ZTsKICAgICAgaWYgKHZhbHVlICYmIHZhbHVlW3RleHRGaWVsZF0gPT09IGVtcHR5SXRlbVt0ZXh0RmllbGRdKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMudmVuZG9yID0gdmFsdWU7CiAgICAgIHRoaXMucHVyY2hhc2Uuc3VwcGxpZXIgPSB2YWx1ZTsKICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKHRoaXMucHVyY2hhc2UuY3VzdG9tZXIsICdDaGFuZ2VkJykKICAgICAgLy8gdGhpcy5pbnZvaWNlID0gdmFsdWUKICAgICAgdGhpcy5wdXJjaGFzZS5hcEFjYyA9IHZhbHVlLmhhc093blByb3BlcnR5KCJhcEFjYyIpID8gdmFsdWUuYXBBY2MgOiB7fTsKICAgICAgdGhpcy5wdXJjaGFzZS5wYXltZW50VGVybSA9IHZhbHVlLnBheW1lbnRUZXJtIHx8IHt9OwogICAgICB0aGlzLnB1cmNoYXNlLnByaWNlTGV2ZWwgPSB2YWx1ZS5wcmljZUxldmVsIHx8IHt9OwogICAgICBjb25zdCBiYXNlQ3VycmVuY3kgPSB2YWx1ZS5iYXNlQ3VycmVuY3kgfHwge307CiAgICAgIGlmIChiYXNlQ3VycmVuY3kuaGFzT3duUHJvcGVydHkoImNvZGUiKSkgewogICAgICAgIHRoaXMuYmFzZUN1cnJlbmN5Q29kZSA9ICIgIiArIGJhc2VDdXJyZW5jeS5jb2RlOwogICAgICB9CiAgICAgIC8vIHRoaXMubG9hZFRyYW5zYWN0aW9uUmF0ZSgpOwogICAgICB0aGlzLmJpbGxpbmdBZGRyZXNzID0gdmFsdWUuaGFzT3duUHJvcGVydHkoImJpbGxpbmdBZGRyZXNzIikKICAgICAgICA/IHZhbHVlLmJpbGxpbmdBZGRyZXNzCiAgICAgICAgOiBbXTsKICAgICAgdGhpcy5kZWxpdmVyeUFkZHJlc3MgPSB2YWx1ZS5oYXNPd25Qcm9wZXJ0eSgiZGVsaXZlcnlBZGRyZXNzIikKICAgICAgICA/IHZhbHVlLmRlbGl2ZXJ5QWRkcmVzcwogICAgICAgIDogW107CiAgICAgIGlmICh0aGlzLmJpbGxpbmdBZGRyZXNzLmxlbmd0aCA+IDApIHsKICAgICAgICB0aGlzLnB1cmNoYXNlLmJpbGxpbmdBZGRyZXNzID0gdGhpcy5iaWxsaW5nQWRkcmVzc1swXTsKICAgICAgfQogICAgICBpZiAodGhpcy5kZWxpdmVyeUFkZHJlc3MubGVuZ3RoID4gMCkgewogICAgICAgIHRoaXMucHVyY2hhc2UuZGVsaXZlcnlBZGRyZXNzID0gdGhpcy5kZWxpdmVyeUFkZHJlc3NbMF07CiAgICAgIH0KICAgICAgdGhpcy5leHBlbnNlcyA9IFtdOwogICAgICB0aGlzLm9uSW52b2ljZURhdGVDaGFuZ2VkKCk7CiAgICAgIHRoaXMubG9hZFByb2plY3RCeUN1c3RvbWVyKCk7CiAgICAgIC8vIHRoaXMubG9hZEN1c3RvbWVyQmFsYW5jZSh0aGlzLnZlbmRvci5pZCk7CiAgICAgIC8vIGNvbnN0IGNyZWRpdExpbWl0ID0gdmFsdWUuaGFzT3duUHJvcGVydHkoImNyZWRpdExpbWl0IikKICAgICAgLy8gICAgID8gdmFsdWUuY3JlZGl0TGltaXQKICAgICAgLy8gICAgIDogMDsKICAgICAgLy8gdGhpcy5wdXJjaGFzZS5jcmVkaXRMaW1pdCA9IGtlbmRvLnBhcnNlRmxvYXQoY3JlZGl0TGltaXQpOwogICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2codmFsdWUsICd2YWx1ZScpCiAgICB9LAogICAgb25FbXBsb3llZUNoYW5nZWQoZXZlbnQpIHsKICAgICAgY29uc3QgdmFsdWUgPSBldmVudC52YWx1ZTsKICAgICAgaWYgKHZhbHVlICYmIHZhbHVlW3RleHRGaWVsZF0gPT09IGVtcHR5SXRlbVt0ZXh0RmllbGRdKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMubUVtcGxveWVlID0gdmFsdWU7CiAgICAgIHRoaXMucHVyY2hhc2UuZW1wbG95ZWUgPSB2YWx1ZTsKICAgIH0sCiAgICBhZnRlckZldGNoKGpzb24pIHsKICAgICAgdGhpcy52ZW5kb3JMaXN0ID0ganNvbi5kYXRhOwogICAgfSwKICAgIGFmdGVyRmV0Y2hfKGpzb24pIHsKICAgICAgdGhpcy5lbXBsb3llZXMgPSBqc29uLmRhdGE7CiAgICB9LAogICAgb25GaWx0ZXJDaGFuZ2UoZXZlbnQpIHsKICAgICAgY29uc3QgZmlsdGVyID0gZXZlbnQuZmlsdGVyLnZhbHVlOwogICAgICB0aGlzLnJlcXVlc3REYXRhKDAsIGZpbHRlciwgdGhpcy5jdXNCYXNlVXJsKTsKICAgICAgdGhpcy5maWx0ZXIgPSBmaWx0ZXI7CiAgICB9LAogICAgb25FbXBsb3llZUZpbHRlckNoYW5nZWQoZXZlbnQpIHsKICAgICAgY29uc3QgZmlsdGVyID0gZXZlbnQuZmlsdGVyLnZhbHVlOwogICAgICB0aGlzLnJlcXVlc3REYXRhXygwLCBmaWx0ZXIsIHRoaXMuZW1wQmFzZVVybCk7CiAgICAgIHRoaXMuZmlsdGVyXyA9IGZpbHRlcjsKICAgIH0sCiAgICBhc3luYyBpbml0RGF0YSgpIHsKICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgYXdhaXQgdGhpcy5sb2FkVmlld0NyZWRpdFB1cmNoYXNlKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jbGVhcigpOwogICAgICAgIC8vIHRoaXMuYWRkUm93KCk7CiAgICAgIH0KICAgIH0sCiAgICBhc3luYyBsb2FkVmlld0NyZWRpdFB1cmNoYXNlKCkgewogICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCkgewogICAgICAgICAgICBiaWxsaW5nSGFuZGxlcgogICAgICAgICAgICAgIC52aWV3UHVyY2hhc2UodGhpcy4kcm91dGUucGFyYW1zLmlkKQogICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlID0gcmVzLmRhdGEuZGF0YVswXTsKICAgICAgICAgICAgICAgICAgdGhpcy5yZWZlcmVuY2VObyA9IHRoaXMucHVyY2hhc2UucmVmZXJlbmNlTm87CiAgICAgICAgICAgICAgICAgIHRoaXMudHhuRGF0ZSA9IG5ldyBEYXRlKHRoaXMucHVyY2hhc2UudHJhbnNhY3Rpb25EYXRlKTsKICAgICAgICAgICAgICAgICAgdGhpcy52ZW5kb3IgPSB0aGlzLnB1cmNoYXNlLnN1cHBsaWVyOwogICAgICAgICAgICAgICAgICB0aGlzLm1FbXBsb3llZSA9IHRoaXMucHVyY2hhc2UuZW1wbG95ZWU7CiAgICAgICAgICAgICAgICAgIHRoaXMudGF4TGlzdFRvdGFsID0gdGhpcy5wdXJjaGFzZS50YXhMaXN0VG90YWw7CiAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbUxpbmVzID0gdGhpcy5wdXJjaGFzZS5pdGVtTGluZXM7CiAgICAgICAgICAgICAgICAgIHRoaXMubU90aGVyQ2hhcmdlID0gdGhpcy5wdXJjaGFzZS5vdGhlckNoYXJnZTsKICAgICAgICAgICAgICAgICAgdGhpcy5zdXBwbGllckRpc2NvdW50SXRlbSA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZS5zdXBwbGllckRpc2NvdW50SXRlbSB8fCBbXTsKICAgICAgICAgICAgICAgICAgdGhpcy5qUmF3ID0gdGhpcy5wdXJjaGFzZS5qUmF3IHx8IFtdOwogICAgICAgICAgICAgICAgICB0aGlzLmV4cGVuc2VzID0gdGhpcy5wdXJjaGFzZS5hZGRpdGlvbmFsQ29zdCB8fCBbXTsKICAgICAgICAgICAgICAgICAgdGhpcy5hZGRpdGlvbmFsQ29zdFRvdGFsID0KICAgICAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlLmFkZGl0aW9uYWxDb3N0VG90YWwgfHwgMDsKICAgICAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZU9yZGVycyA9IHRoaXMucHVyY2hhc2UucmVmRnJvbSB8fCBbXTsKICAgICAgICAgICAgICAgICAgdGhpcy5tb250aE9mID0ga2VuZG8udG9TdHJpbmcoCiAgICAgICAgICAgICAgICAgICAgbmV3IERhdGUodGhpcy5wdXJjaGFzZS5tb250aE9mKSwKICAgICAgICAgICAgICAgICAgICAieXl5eS1NTSIKICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm1PdGhlckNoYXJnZS5sZW5ndGggLSAxOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZFNlbGVjdCgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGNvbnN0IHByaWNlTGV2ZWwgPSB0aGlzLnB1cmNoYXNlLnByaWNlTGV2ZWwgfHwge307CiAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbmN5ID0gcHJpY2VMZXZlbC5jdXJyZW5jeSB8fCB7fTsKICAgICAgICAgICAgICAgICAgY29uc3QgY3VyQ29kZSA9IGN1cnJlbmN5LmNvZGUgfHwgIiI7CiAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVuY3lDb2RlID0gY3VyQ29kZTsKICAgICAgICAgICAgICAgICAgLy8gdGhpcy5sb2FkUHJvamVjdEJ5Q3VzdG9tZXIoKQogICAgICAgICAgICAgICAgICBpZiAodGhpcy52ZW5kb3IpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy52ZW5kb3IuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZEN1c3RvbWVyQmFsYW5jZSh0aGlzLnZlbmRvci5pZCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5xdWVyeS50eXBlID09PSAicmVjdXJyaW5nIikgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaGFzT3duUHJvcGVydHkoInRyYW5zYWN0aW9uRGF0ZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coInR5cGUiLCB0aGlzLiRyb3V0ZS5wYXJhbXMpOwogICAgICAgICAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZS50cmFuc2FjdGlvbkRhdGUgPSBuZXcgRGF0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGUucGFyYW1zLnRyYW5zYWN0aW9uRGF0ZQogICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHhuRGF0ZSA9IG5ldyBEYXRlKAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZS5wYXJhbXMudHJhbnNhY3Rpb25EYXRlCiAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkludm9pY2VEYXRlQ2hhbmdlZCgpOwogICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZU51bWJlcigpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgLmNhdGNoKCk7CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCAxMCk7CiAgICAgIH0pOwogICAgfSwKICAgIGNsZWFyKCkgewogICAgICAvLyB0aGlzLmxvYWRBY2NvdW50KCkKICAgICAgdGhpcy5sb2FkUHJpY2VMZXZlbCgpOwogICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLml0ZW1MaW5lRFMua2VuZG9XaWRnZXQoKTsKICAgICAgZHMuZGF0YShbXSk7CiAgICAgIHRoaXMuaWQgPSB1bmRlZmluZWQ7CiAgICAgIHRoaXMudmVuZG9yID0ge307CiAgICAgIHRoaXMubUVtcGxveWVlID0ge307CiAgICAgIHRoaXMubU90aGVyQ2hhcmdlID0ge307CiAgICAgIHRoaXMucHVyY2hhc2VPcmRlcnMgPSBbXTsKICAgICAgdGhpcy5wdXJjaGFzZSA9IG5ldyBQdXJjaGFzZU1vZGVsKHt9KTsKICAgICAgdGhpcy5wdXJjaGFzZS50cmFuc2FjdGlvblR5cGUgPSB0aGlzLnB1cmNoYXNlVHlwZXNbMF07CiAgICAgIHRoaXMubW9udGhPZiA9IGtlbmRvLnRvU3RyaW5nKAogICAgICAgIG5ldyBEYXRlKHRoaXMucHVyY2hhc2UudHJhbnNhY3Rpb25EYXRlKSwKICAgICAgICAieXl5eS1NTSIKICAgICAgKTsKICAgICAgdGhpcy5hZGRSb3coKTsKICAgICAgdGhpcy5nZW5lcmF0ZU51bWJlcigpOwogICAgICB0aGlzLmxvYWRTZWdtZW50KCk7CiAgICAgIHRoaXMubG9hZExvY2F0aW9uKCk7CiAgICB9LAogICAgYXN5bmMgbG9hZFRyYW5zYWN0aW9uUmF0ZSgpIHsKICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUodGhpcy50eG5EYXRlKS50b0lTT1N0cmluZygpLnN1YnN0cigwLCAxMCk7CiAgICAgICAgICBjb25zdCBwcmljZUxldmVsID0gdGhpcy5wdXJjaGFzZS5wcmljZUxldmVsOwogICAgICAgICAgbGV0IGNvZGUgPSAiIjsKICAgICAgICAgIGlmIChwcmljZUxldmVsLmhhc093blByb3BlcnR5KCJjdXJyZW5jeSIpKSB7CiAgICAgICAgICAgIGlmIChwcmljZUxldmVsLmN1cnJlbmN5Lmhhc093blByb3BlcnR5KCJjb2RlIikpIHsKICAgICAgICAgICAgICBjb2RlID0gcHJpY2VMZXZlbC5jdXJyZW5jeS5jb2RlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoY29kZSAhPT0gdW5kZWZpbmVkIHx8IGNvZGUgIT09ICIiKSB7CiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICBjdXJyZW5jeUhhbmRsZXIKICAgICAgICAgICAgICAuZ2V0TGFzdEV4Y2hhbmdlUmF0ZUJ5RGF0ZShkYXRlLCBjb2RlKQogICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICB0aGlzLmV4Y2hhbmdlUmF0ZSA9IHJlcy5kYXRhLmRhdGFbMF07CiAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVuY3lDb2RlID0gdGhpcy5leGNoYW5nZVJhdGUuY29kZSB8fCAiIjsKICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvblJhdGUgPSB0aGlzLmV4Y2hhbmdlUmF0ZS5yYXRlIHx8IDA7CiAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2UudHhuUmF0ZSA9IHRoaXMuZXhjaGFuZ2VSYXRlLnJhdGUgfHwgMDsKICAgICAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZS5leGNoYW5nZVJhdGUgPSB0aGlzLmV4Y2hhbmdlUmF0ZSB8fCB7fTsKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudHJhbnNhY3Rpb25SYXRlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcihpMThuLnQoInNldF9leGNoYW5nZV9yYXRlIikpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIHRoaXMubG9hZEN1c3RvbWVyRGVwb3NpdEJhbGFuY2UodGhpcy52ZW5kb3IuaWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5sb2FkUHVyY2hhc2VPcmRlcigpOwogICAgICAgIH0sIDEwKTsKICAgICAgfSk7CiAgICB9LAogICAgcmVsb2FkKCkgewogICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLmxvYWRWaWV3Q3JlZGl0UHVyY2hhc2UoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNsZWFyKCk7CiAgICAgIH0KICAgIH0sCiAgICBhc3luYyBsb2FkUHVyY2hhc2VPcmRlcigpIHsKICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICBsZXQgc2VnbWVudElkID0gIiIsCiAgICAgICAgICAgIGxvY2F0aW9uSWQgPSAiIiwKICAgICAgICAgICAgcHJpY2VMZXZlbElkID0gIiIsCiAgICAgICAgICAgIGN1c3RvbWVySWQgPSAiIiwKICAgICAgICAgICAgdHhuRGF0ZSA9ICIiOwogICAgICAgICAgaWYgKHRoaXMucHVyY2hhc2Uuc2VnbWVudCkgewogICAgICAgICAgICBzZWdtZW50SWQgPSB0aGlzLnB1cmNoYXNlLnNlZ21lbnQuaWQ7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5wdXJjaGFzZS5sb2NhdGlvbikgewogICAgICAgICAgICBsb2NhdGlvbklkID0gdGhpcy5wdXJjaGFzZS5sb2NhdGlvbi5pZDsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLnB1cmNoYXNlLnN1cHBsaWVyKSB7CiAgICAgICAgICAgIGN1c3RvbWVySWQgPSB0aGlzLnB1cmNoYXNlLnN1cHBsaWVyLmlkOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMucHVyY2hhc2UucHJpY2VMZXZlbCkgewogICAgICAgICAgICBwcmljZUxldmVsSWQgPSB0aGlzLnB1cmNoYXNlLnByaWNlTGV2ZWwuaWQ7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5wdXJjaGFzZS50cmFuc2FjdGlvbkRhdGUpIHsKICAgICAgICAgICAgdHhuRGF0ZSA9IHRoaXMucHVyY2hhc2UudHJhbnNhY3Rpb25EYXRlOwogICAgICAgICAgfQogICAgICAgICAgbGV0IHN0ckZpbHRlciA9ICIiOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBzZWdtZW50SWQgIT09ICIiICYmCiAgICAgICAgICAgIGN1c3RvbWVySWQgIT09ICIiICYmCiAgICAgICAgICAgIGxvY2F0aW9uSWQgIT09ICIiICYmCiAgICAgICAgICAgIHByaWNlTGV2ZWxJZCAhPT0gIiIgJiYKICAgICAgICAgICAgdHhuRGF0ZSAhPT0gIiIKICAgICAgICAgICkgewogICAgICAgICAgICBzdHJGaWx0ZXIgPQogICAgICAgICAgICAgICI/aWQ9IiArCiAgICAgICAgICAgICAgY3VzdG9tZXJJZCArCiAgICAgICAgICAgICAgIiZzZWdJZD0iICsKICAgICAgICAgICAgICBzZWdtZW50SWQgKwogICAgICAgICAgICAgICImbG9jSWQ9IiArCiAgICAgICAgICAgICAgbG9jYXRpb25JZCArCiAgICAgICAgICAgICAgIiZwbElkPSIgKwogICAgICAgICAgICAgIHByaWNlTGV2ZWxJZCArCiAgICAgICAgICAgICAgIiZkYXRlPSIgKwogICAgICAgICAgICAgIHR4bkRhdGUgKwogICAgICAgICAgICAgICImdHlwZT1QdXJjaGFzZSBPcmRlciI7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc3RyRmlsdGVyICE9PSAiIikgewogICAgICAgICAgICB0aGlzLnB1cmNoYXNlLnJlZkZyb20gPSBbXTsKICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZ1R4biA9IHRydWU7CiAgICAgICAgICAgIHNhbGVPcmRlckhhbmRsZXIudHJhbnNhY3Rpb25GaWx0ZXIoc3RyRmlsdGVyKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nVHhuID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlT3JkZXJzID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZ1R4biA9IGZhbHNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgMTApOwogICAgICB9KTsKICAgICAgYXdhaXQgdGhpcy5nZXRFeHBlbnNlQnlTdXBwbGllcigpOwogICAgfSwKICAgIGFkZFB1cmNoYXNlT3JkZXIoaXRlbSkgewogICAgICBpZiAoaXRlbSkgewogICAgICAgIGNvbnN0IGl0ZW1MaW5lID0gaXRlbS5pdGVtTGluZXMgfHwgW107CiAgICAgICAgdGhpcy5yZWZGcm9tLnB1c2goewogICAgICAgICAgaWQ6IGl0ZW0uaWQgfHwgIiIsCiAgICAgICAgICByZWZlcmVuY2U6IGl0ZW0ucmVmZXJlbmNlTm8gfHwgIiIsCiAgICAgICAgfSk7CiAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5pdGVtTGluZURTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICB0b3RhbCA9IGRzLnRvdGFsKCk7CiAgICAgICAgaXRlbUxpbmUuZm9yRWFjaCgobykgPT4gewogICAgICAgICAgdGhpcy5pdGVtTGluZSA9IG5ldyBJdGVtTGluZU1vZGVsKG8pOwogICAgICAgICAgdGhpcy5pdGVtTGluZS5pZCA9IGl0ZW1MaW5lUHJlZml4ICsgdXVpZC52MSgpOwogICAgICAgICAgdGhpcy5pdGVtTGluZS5kZWNpbWFsRm9ybWF0ID0gIm4iICsgdGhpcy5wdXJjaGFzZUZvcm1Db250ZW50LmRlY2ltYWw7CiAgICAgICAgICB0aGlzLml0ZW1MaW5lLnNvdXJjZVRyYW5zYWN0aW9uID0gewogICAgICAgICAgICBpZDogaXRlbS5pZCwKICAgICAgICAgICAgcmVmZXJlbmNlTm86IGl0ZW0ucmVmZXJlbmNlTm8sCiAgICAgICAgICB9OwogICAgICAgICAgdGhpcy5pdGVtTGluZS5zb3VyY2VUcmFuc2FjdGlvblJlZiA9IGl0ZW0ucmVmZXJlbmNlTm87CiAgICAgICAgICBkcy5pbnNlcnQodG90YWwsIHRoaXMuaXRlbUxpbmUpOwogICAgICAgIH0pOwogICAgICAgIHRoaXMuaXRlbUxpbmUgPSBuZXcgSXRlbUxpbmVNb2RlbCh7fSk7CiAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlKCk7CiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnB1cmNoYXNlT3JkZXJzLmZpbmRJbmRleCgoaXRtKSA9PiB7CiAgICAgICAgICByZXR1cm4gaXRlbS5pZCA9PT0gaXRtLmlkOwogICAgICAgIH0pOwogICAgICAgIHRoaXMucHVyY2hhc2VPcmRlcnMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICB0aGlzLnB1cmNoYXNlLnJlZkZyb20gPSB0aGlzLnJlbW92ZUR1cGxpY2F0ZSh0aGlzLnJlZkZyb20pOwogICAgICB9CiAgICB9LAogICAgdG90YWxRdHkoKSB7CiAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuaXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpOwogICAgICBsZXQgcXR5ID0gMDsKICAgICAgZHMuZGF0YSgpCiAgICAgICAgLmZpbHRlcigobikgPT4gbi5hbW91bnQgPiAwKQogICAgICAgIC5mb3JFYWNoKChtKSA9PiB7CiAgICAgICAgICBjb25zdCBpdG0gPSBtLml0ZW0gfHwge307CiAgICAgICAgICBjb25zdCB1b20gPSBtLnVvbSB8fCB7fTsKICAgICAgICAgIGlmIChpdG0uaWQgJiYgdW9tLnVvbSAmJiBpdG0udHlwZSA9PT0gIlZhcmlhbnQiKSB7CiAgICAgICAgICAgIHF0eSArPSAobS5xdHkgfHwgMCkgKiAobS5jb252ZXJzaW9uUmF0ZSB8fCAxKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgd2luZG93LmNvbnNvbGUubG9nKCJxdHkiLCBxdHkpOwogICAgICByZXR1cm4gcXR5OwogICAgfSwKICAgIGV4Y2x1ZGVWQVRUYXhJbmNsdXNpdmUodGF4LCBhbW91bnQsIGluY1RheCkgewogICAgICBpZiAodGF4KSB7CiAgICAgICAgY29uc3QgYmFzZUFtb3VudCA9IHRheC5iYXNlQW1vdW50IHx8ICIiOwogICAgICAgIGNvbnN0IHRheFR5cGUgPSB0YXgudGF4VHlwZSB8fCB7fTsKICAgICAgICBjb25zdCB0YXhUeXBlSWQgPSB0YXhUeXBlLnR5cGVJZCB8fCAwOwogICAgICAgIGlmIChiYXNlQW1vdW50KSB7CiAgICAgICAgICBpZiAoYmFzZUFtb3VudC50b0xvd2VyQ2FzZSgpID09PSAiaW5jbHVzaXZlIiAmJiB0YXhUeXBlSWQgPT09IDEpIHsKICAgICAgICAgICAgcmV0dXJuIGFtb3VudCAtIGluY1RheDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGFtb3VudDsKICAgIH0sCiAgICB0b3RhbEFtb3VudCgpIHsKICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5pdGVtTGluZURTLmtlbmRvV2lkZ2V0KCk7CiAgICAgIGxldCBhbW91bnQgPSAwOwogICAgICBkcy5kYXRhKCkKICAgICAgICAuZmlsdGVyKChuKSA9PiBuLmFtb3VudCA+IDApCiAgICAgICAgLmZvckVhY2goKG0pID0+IHsKICAgICAgICAgIGNvbnN0IGl0bSA9IG0uaXRlbSB8fCB7fTsKICAgICAgICAgIGNvbnN0IHVvbSA9IG0udW9tIHx8IHt9OwogICAgICAgICAgbGV0IGluY2x1VGF4ID0gMDsKICAgICAgICAgIGlmIChpdG0uaWQgJiYgdW9tLnVvbSAmJiBpdG0udHlwZSA9PT0gIlZhcmlhbnQiKSB7CiAgICAgICAgICAgIGNvbnN0IHRheCA9IG0udmF0VGF4IHx8IHt9OwogICAgICAgICAgICBjb25zdCBhbW91bnRfID0gbS5hbW91bnQgfHwgMDsKICAgICAgICAgICAgY29uc3QgYmFzZUFtb3VudCA9IHRheC5iYXNlQW1vdW50IHx8ICIiOwogICAgICAgICAgICBpZiAoYmFzZUFtb3VudCkgewogICAgICAgICAgICAgIGlmIChiYXNlQW1vdW50LnRvTG93ZXJDYXNlKCkgPT09ICJpbmNsdXNpdmUiKSB7CiAgICAgICAgICAgICAgICBpbmNsdVRheCA9IHRoaXMuYXV0b0NhbGN1bGF0ZVRheCh0YXgsIGFtb3VudF8pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBhbW91bnQgKz0gYW1vdW50XyAtIChpbmNsdVRheCB8fCAwKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgd2luZG93LmNvbnNvbGUubG9nKCJhbW91bnQgeC0iLCBhbW91bnQpOwogICAgICByZXR1cm4gYW1vdW50OwogICAgfSwKICAgIHBlcmNlbnRhZ2VBcHBsaWVkKCkgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHRBbW91bnQgPSB0aGlzLnRvdGFsQW1vdW50KCk7CiAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5pdGVtTGluZURTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgZHMuZGF0YSgpCiAgICAgICAgICAuZmlsdGVyKChuKSA9PiBuLmFtb3VudCA+IDApCiAgICAgICAgICAuZm9yRWFjaCgobSkgPT4gewogICAgICAgICAgICBjb25zdCBpdG0gPSBtLml0ZW0gfHwge307CiAgICAgICAgICAgIGNvbnN0IHVvbSA9IG0udW9tIHx8IHt9OwogICAgICAgICAgICBsZXQgaW5jbHVUYXggPSAwOwogICAgICAgICAgICBpZiAoaXRtLmlkICYmIHVvbS51b20gJiYgaXRtLnR5cGUgPT09ICJWYXJpYW50IikgewogICAgICAgICAgICAgIGNvbnN0IHRheCA9IG0udmF0VGF4IHx8IHt9OwogICAgICAgICAgICAgIGNvbnN0IGFtb3VudCA9IG0uYW1vdW50IHx8IDA7CiAgICAgICAgICAgICAgY29uc3QgYmFzZUFtb3VudCA9IHRheC5iYXNlQW1vdW50IHx8ICIiOwogICAgICAgICAgICAgIGlmIChiYXNlQW1vdW50KSB7CiAgICAgICAgICAgICAgICBpZiAoYmFzZUFtb3VudC50b0xvd2VyQ2FzZSgpID09PSAiaW5jbHVzaXZlIikgewogICAgICAgICAgICAgICAgICBpbmNsdVRheCA9IHRoaXMuYXV0b0NhbGN1bGF0ZVRheCh0YXgsIGFtb3VudCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGFtb3VudEFmdGVyVGF4ID0gYW1vdW50IC0gKGluY2x1VGF4IHx8IDApOwogICAgICAgICAgICAgIGNvbnN0IHBBbW91bnQgPSBhbW91bnRBZnRlclRheCAvIHRBbW91bnQ7CiAgICAgICAgICAgICAgbVsicGVyY2VudGFnZUFwcGxpZWQiXSA9IHBBbW91bnQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygiUXR5IEJhc2VkLS0iLCBkcy5kYXRhKCkpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCJlcnJvciIsIGUpOwogICAgICB9CiAgICB9LAogICAgYW1vdW50QXBwbGllZCgpIHsKICAgICAgdHJ5IHsKICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLml0ZW1MaW5lRFMua2VuZG9XaWRnZXQoKTsKICAgICAgICBjb25zdCBhZGMgPSB0aGlzLmFkZGl0aW9uYWxDb3N0VG90YWwgfHwgMDsKICAgICAgICBkcy5kYXRhKCkKICAgICAgICAgIC5maWx0ZXIoKG4pID0+IG4uYW1vdW50ID4gMCkKICAgICAgICAgIC5mb3JFYWNoKChtKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGl0bSA9IG0uaXRlbSB8fCB7fTsKICAgICAgICAgICAgY29uc3QgdW9tID0gbS51b20gfHwge307CiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygiYW1vdW50QXBwbGllZD09IiwgdW9tLnVvbSwgIi0tLSIsIGl0bS50eXBlKTsKICAgICAgICAgICAgaWYgKGl0bS5pZCAmJiB1b20udW9tICYmIGl0bS50eXBlID09PSAiVmFyaWFudCIpIHsKICAgICAgICAgICAgICBjb25zdCBwZXJjZW50YWdlQXBwbGllZCA9IG0ucGVyY2VudGFnZUFwcGxpZWQgfHwgMDsKICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coCiAgICAgICAgICAgICAgICAicGVyY2VudGFnZUFwcGxpZWQtLSIsCiAgICAgICAgICAgICAgICBhZGMsCiAgICAgICAgICAgICAgICAiLS0tIiwKICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2VBcHBsaWVkICogYWRjCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICBtWyJhbW91bnRBcHBsaWVkIl0gPSBwZXJjZW50YWdlQXBwbGllZCAqIGFkYzsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCJBTW91bnQgQmFzZWQtLSIsIGRzLmRhdGEoKSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coImVycm9yIiwgZSk7CiAgICAgIH0KICAgIH0sCiAgICBhbW91bnRBcHBsaWVkUXR5QmFzZWQoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5pdGVtTGluZURTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgZHMuZGF0YSgpCiAgICAgICAgICAuZmlsdGVyKChuKSA9PiBuLmFtb3VudCA+IDApCiAgICAgICAgICAuZm9yRWFjaCgobSkgPT4gewogICAgICAgICAgICBjb25zdCBpdG0gPSBtLml0ZW0gfHwge307CiAgICAgICAgICAgIGNvbnN0IHVvbSA9IG0udW9tIHx8IHt9OwogICAgICAgICAgICBpZiAoaXRtLmlkICYmIHVvbS51b20gJiYgaXRtLnR5cGUgPT09ICJWYXJpYW50IikgewogICAgICAgICAgICAgIGNvbnN0IGFkZGMgPSBtLmFkZGl0aW9uYWxDb3N0IHx8IDA7CiAgICAgICAgICAgICAgY29uc3QgcXR5ID0gKG0ucXR5IHx8IDEpICogKG0uY29udmVyc2lvblJhdGUgfHwgMSk7CiAgICAgICAgICAgICAgbVsiYW1vdW50QXBwbGllZCJdID0gYWRkYyAqIHF0eTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCJhbW91bnRBcHBsaWVkUXR5QmFzZWQgQmFzZWQtLSIsIGRzLmRhdGEoKSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coImVycm9yIiwgZSk7CiAgICAgIH0KICAgIH0sCiAgICBhc3luYyBjYWxjdWxhdGVBZGRpdGlvbmFsQ29zdCgpIHsKICAgICAgdHJ5IHsKICAgICAgICAvLyB0b2RvOiBhZGRpdGlvbmFsIENvc3QKICAgICAgICBpZiAodGhpcy5wdXJjaGFzZS5hZGRpdGlvbmFsQ29zdE1ldGhvZCA9PT0gIlF0eSBCYXNlZCIpIHsKICAgICAgICAgIHRoaXMucGVyY2VudGFnZUFwcGxpZWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5wZXJjZW50YWdlQXBwbGllZCgpOwogICAgICAgICAgdGhpcy5hbW91bnRBcHBsaWVkKCk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnB1cmNoYXNlLmFkZGl0aW9uYWxDb3N0TWV0aG9kID09PSAiUXR5IEJhc2VkIikgewogICAgICAgICAgY29uc3QgdFF0eSA9IHRoaXMudG90YWxRdHkoKTsKICAgICAgICAgIGNvbnN0IGFkZGMgPSB0aGlzLmFkZGl0aW9uYWxDb3N0VG90YWwgfHwgMDsKICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuaXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpOwogICAgICAgICAgZHMuZGF0YSgpCiAgICAgICAgICAgIC5maWx0ZXIoKG4pID0+IG4uYW1vdW50ID4gMCkKICAgICAgICAgICAgLmZvckVhY2goKG0pID0+IHsKICAgICAgICAgICAgICBjb25zdCBpdG0gPSBtLml0ZW0gfHwge307CiAgICAgICAgICAgICAgY29uc3QgdW9tID0gbS51b20gfHwge307CiAgICAgICAgICAgICAgaWYgKGl0bS5pZCAmJiB1b20udW9tICYmIGl0bS50eXBlID09PSAiVmFyaWFudCIpIHsKICAgICAgICAgICAgICAgIG1bImFkZGl0aW9uYWxDb3N0Il0gPSBhZGRjIC8gdFF0eTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCJxdHkgYmFzZWQiLCBkcy5kYXRhKCkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLml0ZW1MaW5lRFMua2VuZG9XaWRnZXQoKTsKICAgICAgICAgIGRzLmRhdGEoKQogICAgICAgICAgICAuZmlsdGVyKChuKSA9PiBuLmFtb3VudCA+IDApCiAgICAgICAgICAgIC5mb3JFYWNoKChtKSA9PiB7CiAgICAgICAgICAgICAgY29uc3QgaXRtID0gbS5pdGVtIHx8IHt9OwogICAgICAgICAgICAgIGNvbnN0IHVvbSA9IG0udW9tIHx8IHt9OwogICAgICAgICAgICAgIGlmIChpdG0uaWQgJiYgdW9tLnVvbSAmJiBpdG0udHlwZSA9PT0gIlZhcmlhbnQiKSB7CiAgICAgICAgICAgICAgICBjb25zdCBhbW91bnRBcHBsaWVkID0gbS5hbW91bnRBcHBsaWVkIHx8IDA7CiAgICAgICAgICAgICAgICBjb25zdCBxdHkgPSAobS5xdHkgfHwgMCkgKiAobS5jb252ZXJzaW9uUmF0ZSB8fCAxKTsKICAgICAgICAgICAgICAgIG1bImFkZGl0aW9uYWxDb3N0Il0gPSBhbW91bnRBcHBsaWVkIC8gcXR5OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnB1cmNoYXNlLmFkZGl0aW9uYWxDb3N0TWV0aG9kID09PSAiUXR5IEJhc2VkIikgewogICAgICAgICAgdGhpcy5hbW91bnRBcHBsaWVkUXR5QmFzZWQoKTsKICAgICAgICB9CiAgICAgICAgYXdhaXQgdGhpcy5jbGVhcmluZ0FjY291bnQoKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygiZXJyb3IiLCBlKTsKICAgICAgfQogICAgfSwKICAgIGF1dG9DYWxjdWxhdGVUYXhEZXRhaWwoKSB7CiAgICAgIGxldCBpZHMgPSBbXTsKICAgICAgdGhpcy50YXhMaXN0RGV0YWlsLmZvckVhY2goKG4pID0+IHsKICAgICAgICBpZHMucHVzaChuLmlkIHx8ICIiKTsKICAgICAgfSk7CiAgICAgIGNvbnN0IHVuaXF1ZSA9IFsuLi5uZXcgU2V0KGlkcyldOwogICAgICBsZXQgcmVzdWx0ID0gW107CiAgICAgIHVuaXF1ZS5mb3JFYWNoKChtKSA9PiB7CiAgICAgICAgbGV0IGFtb3VudCA9IDAsCiAgICAgICAgICByb3cgPSB7fSwKICAgICAgICAgIGRpc2NvdW50ID0gMCwKICAgICAgICAgIHhEaXNjb3VudCA9IDAsCiAgICAgICAgICB4QW1vdW50ID0gMCwKICAgICAgICAgIHRheEFtb3VudCA9IDAsCiAgICAgICAgICB4VGF4QW1vdW50ID0gMDsKICAgICAgICBsZXQgdGF4RGV0YWlsID0gW10sCiAgICAgICAgICBpc1ZhdCA9IDA7CiAgICAgICAgY29uc3QgZm91bmQgPSB0aGlzLnRheExpc3REZXRhaWwuZmlsdGVyKChuKSA9PiBuLmlkID09PSBtKTsKICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coJ3RheExpc3REZXRhaWxpZHMnLCBmb3VuZCkKICAgICAgICBmb3VuZC5mb3JFYWNoKChrKSA9PiB7CiAgICAgICAgICByb3cgPSBrOwogICAgICAgICAgaWYgKGsuaXNWYXQgPT09IDEpIHsKICAgICAgICAgICAgaXNWYXQgPSAxOwogICAgICAgICAgICBjb25zdCBkZXRhaWxfID0gay5kZXRhaWwgfHwge307CiAgICAgICAgICAgIHRheERldGFpbC5wdXNoKGRldGFpbF8pOwogICAgICAgICAgfQogICAgICAgICAgdGF4QW1vdW50ICs9IGsudGF4QW1vdW50XyB8fCAwOwogICAgICAgICAgeFRheEFtb3VudCArPSAoay50YXhBbW91bnRfIHx8IDApICogKGsudHhuUmF0ZSB8fCAxKTsKICAgICAgICAgIGFtb3VudCArPSBrLmFtb3VudCB8fCAwOwogICAgICAgICAgeEFtb3VudCArPSAoay5hbW91bnQgfHwgMCkgKiAoay50eG5SYXRlIHx8IDEpOwogICAgICAgICAgZGlzY291bnQgKz0gay5kaXNjb3VudCB8fCAwOwogICAgICAgICAgeERpc2NvdW50ICs9IChrLmRpc2NvdW50IHx8IDApICogKGsudHhuUmF0ZSB8fCAxKTsKICAgICAgICB9KTsKICAgICAgICBsZXQgc3BUYXhBbXQgPSAwLAogICAgICAgICAgc3BYVGF4QW10ID0gMCwKICAgICAgICAgIHBsVGF4QW10ID0gMCwKICAgICAgICAgIHBsWFRheEFtdCA9IDAsCiAgICAgICAgICBvdFRheEFtdCA9IDAsCiAgICAgICAgICBvdFhUYXhBbXQgPSAwLAogICAgICAgICAgc3BUYXhOYW1lID0gIiIsCiAgICAgICAgICBwbFRheE5hbWUgPSAiIiwKICAgICAgICAgIG90VGF4TmFtZSA9ICIiLAogICAgICAgICAgc3BUYXhOYW1lTG9jYWxlID0gIiIsCiAgICAgICAgICBwbFRheE5hbWVMb2NhbGUgPSAiIiwKICAgICAgICAgIG90VGF4TmFtZUxvY2FsZSA9ICIiLAogICAgICAgICAgc3BBY2NJZCA9ICIiLAogICAgICAgICAgcGxBY2NJZCA9ICIiLAogICAgICAgICAgb3RBY2NJZCA9ICIiLAogICAgICAgICAgc3BSYXRlID0gIiIsCiAgICAgICAgICBwbFJhdGUgPSAiIiwKICAgICAgICAgIG90UmF0ZSA9ICIiOwogICAgICAgIHRheERldGFpbC5mb3JFYWNoKChuKSA9PiB7CiAgICAgICAgICBjb25zdCBzcFRheCA9IG4uc3BlY2lmaWNUYXggfHwge307CiAgICAgICAgICBjb25zdCBwbFRheCA9IG4ucHVibGljTGlnaHRpbmdUYXggfHwge307CiAgICAgICAgICBjb25zdCBvdGhlclRheCA9IG4ub3RoZXJUYXggfHwge307CiAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoc3BUYXgpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgc3BUYXhBbXQgKz0gc3BUYXgudGF4QW1vdW50XyB8fCAwOwogICAgICAgICAgICBzcFhUYXhBbXQgKz0gKHNwVGF4LnRheEFtb3VudF8gfHwgMCkgKiAoc3BUYXgudGF4UmF0ZSB8fCAxKTsKICAgICAgICAgICAgc3BUYXhOYW1lID0gc3BUYXguZGVmYXVsdFRheCB8fCAiIjsKICAgICAgICAgICAgc3BUYXhOYW1lTG9jYWxlID0gc3BUYXguZGVmYXVsdFRheExvY2FsZSB8fCAiIjsKICAgICAgICAgICAgc3BBY2NJZCA9IHNwVGF4LmFjY291bnQgPyBzcFRheC5hY2NvdW50LmlkIDogIiI7CiAgICAgICAgICAgIHNwUmF0ZSA9IHNwVGF4LnJhdGUgfHwgMTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhwbFRheCkubGVuZ3RoID4gMCkgewogICAgICAgICAgICBwbFRheEFtdCArPSBwbFRheC50YXhBbW91bnRfIHx8IDA7CiAgICAgICAgICAgIHBsWFRheEFtdCArPSAocGxUYXgudGF4QW1vdW50XyB8fCAwKSAqIChwbFRheC50YXhSYXRlIHx8IDEpOwogICAgICAgICAgICBwbFRheE5hbWUgPSBwbFRheC5kZWZhdWx0VGF4IHx8ICIiOwogICAgICAgICAgICBwbFRheE5hbWVMb2NhbGUgPSBwbFRheC5kZWZhdWx0VGF4TG9jYWxlIHx8ICIiOwogICAgICAgICAgICBwbEFjY0lkID0gcGxUYXguYWNjb3VudCA/IHBsVGF4LmFjY291bnQuaWQgOiAiIjsKICAgICAgICAgICAgcGxSYXRlID0gcGxUYXgucmF0ZSB8fCAxOwogICAgICAgICAgfQogICAgICAgICAgaWYgKE9iamVjdC5rZXlzKG90aGVyVGF4KS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIG90VGF4QW10ICs9IG90aGVyVGF4LnRheEFtb3VudF8gfHwgMDsKICAgICAgICAgICAgb3RYVGF4QW10ICs9IChvdGhlclRheC50YXhBbW91bnRfIHx8IDApICogKHBsVGF4LnRheFJhdGUgfHwgMSk7CiAgICAgICAgICAgIG90VGF4TmFtZSA9IG90aGVyVGF4LmRlZmF1bHRUYXggfHwgIiI7CiAgICAgICAgICAgIG90VGF4TmFtZUxvY2FsZSA9IG90aGVyVGF4LmRlZmF1bHRUYXhMb2NhbGUgfHwgIiI7CiAgICAgICAgICAgIG90QWNjSWQgPSBvdGhlclRheC5hY2NvdW50ID8gb3RoZXJUYXguYWNjb3VudC5pZCA6ICIiOwogICAgICAgICAgICBvdFJhdGUgPSBvdGhlclRheC5yYXRlIHx8IDE7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgaWYgKGlzVmF0ID09PSAxKSB7CiAgICAgICAgICByb3cuZGV0YWlsID0gewogICAgICAgICAgICBzcGVjaWZpY1RheDogewogICAgICAgICAgICAgIG5hbWU6IHNwVGF4TmFtZSwKICAgICAgICAgICAgICBuYW1lTG9jYWxlOiBzcFRheE5hbWVMb2NhbGUsCiAgICAgICAgICAgICAgYW1vdW50OiBzcFRheEFtdCwKICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogc3BYVGF4QW10LAogICAgICAgICAgICAgIGFjY291bnRJZDogc3BBY2NJZCwKICAgICAgICAgICAgICByYXRlOiBzcFJhdGUsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHB1YmxpY0xpZ2h0aW5nVGF4OiB7CiAgICAgICAgICAgICAgbmFtZTogcGxUYXhOYW1lLAogICAgICAgICAgICAgIG5hbWVMb2NhbGU6IHBsVGF4TmFtZUxvY2FsZSwKICAgICAgICAgICAgICBhbW91bnQ6IHBsVGF4QW10LAogICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OiBwbFhUYXhBbXQsCiAgICAgICAgICAgICAgYWNjb3VudElkOiBwbEFjY0lkLAogICAgICAgICAgICAgIHJhdGU6IHBsUmF0ZSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb3RoZXJUYXg6IHsKICAgICAgICAgICAgICBuYW1lOiBvdFRheE5hbWUsCiAgICAgICAgICAgICAgbmFtZUxvY2FsZTogb3RUYXhOYW1lTG9jYWxlLAogICAgICAgICAgICAgIGFtb3VudDogb3RUYXhBbXQsCiAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQ6IG90WFRheEFtdCwKICAgICAgICAgICAgICBhY2NvdW50SWQ6IG90QWNjSWQsCiAgICAgICAgICAgICAgcmF0ZTogb3RSYXRlLAogICAgICAgICAgICB9LAogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcm93LmRldGFpbCA9IHt9OwogICAgICAgIH0KCiAgICAgICAgcm93WyJhbW91bnQiXSA9IGFtb3VudDsKICAgICAgICByb3dbImV4Y2hhbmdlQW1vdW50Il0gPSB4QW1vdW50OwogICAgICAgIHJvd1sidGF4QW1vdW50Il0gPSB0YXhBbW91bnQ7CiAgICAgICAgcm93WyJleGNoYW5nZVRheEFtb3VudCJdID0geFRheEFtb3VudDsKICAgICAgICByb3dbImRpc2NvdW50Il0gPSBkaXNjb3VudDsKICAgICAgICByb3dbImV4Y2hhbmdlRGlzY291bnQiXSA9IHhEaXNjb3VudDsKICAgICAgICByb3dbImN1cnJlbmN5Il0gPSB0aGlzLnB1cmNoYXNlLmV4Y2hhbmdlUmF0ZSB8fCB7fTsKICAgICAgICByZXN1bHQucHVzaChyb3cpOwogICAgICAgIHRheERldGFpbCA9IFtdOwogICAgICB9KTsKICAgICAgdGhpcy5wdXJjaGFzZS5zYWxlVGF4RGV0YWlsID0gcmVzdWx0OwogICAgICB3aW5kb3cuY29uc29sZS5sb2coInNhbGVUYXhEZXRhaWwiLCByZXN1bHQpOwogICAgfSwKICAgIGFzeW5jIGdldEV4cGVuc2VCeVN1cHBsaWVyKCkgewogICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgIGNvbnN0IHNlZ21lbnQgPSB0aGlzLnB1cmNoYXNlLnNlZ21lbnQgfHwge307CiAgICAgICAgICBjb25zdCBzZWdtZW50SWQgPSBzZWdtZW50LmlkIHx8ICIiOwogICAgICAgICAgY29uc3QgbG9jYXRpb24gPSB0aGlzLnB1cmNoYXNlLmxvY2F0aW9uIHx8IHt9OwogICAgICAgICAgY29uc3QgbG9jYXRpb25JZCA9IGxvY2F0aW9uLmlkIHx8ICIiOwogICAgICAgICAgY29uc3Qgc3VwcGxpZXIgPSB0aGlzLnB1cmNoYXNlLnN1cHBsaWVyIHx8IHt9OwogICAgICAgICAgY29uc3Qgc3VwcGxpZXJJZCA9IHN1cHBsaWVyLmlkIHx8ICIiOwogICAgICAgICAgY29uc3Qgc3RyRmlsdGVyID0KICAgICAgICAgICAgIj9pZD0iICsKICAgICAgICAgICAgc3VwcGxpZXJJZCArCiAgICAgICAgICAgICImc2VnSWQ9IiArCiAgICAgICAgICAgIHNlZ21lbnRJZCArCiAgICAgICAgICAgICImbG9jSWQ9IiArCiAgICAgICAgICAgIGxvY2F0aW9uSWQ7CiAgICAgICAgICB0aGlzLmV4cGVuc2VzID0gW107CiAgICAgICAgICB0aGlzLnB1cmNoYXNlLmFkZGl0aW9uYWxDb3N0VG90YWwgPSAwOwogICAgICAgICAgdGhpcy5zaG93TG9hZGluZ1R4bkFkZGl0aW9uYWxDb3N0ID0gZmFsc2U7CiAgICAgICAgICB0aGlzLnB1cmNoYXNlLmFkZGl0aW9uYWxDb3N0ID0gW107CiAgICAgICAgICBiaWxsaW5nSGFuZGxlci5saXN0UHVyY2hhc2Uoc3RyRmlsdGVyKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmdUeG5BZGRpdGlvbmFsQ29zdCA9IHRydWU7CiAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZ1R4bkFkZGl0aW9uYWxDb3N0ID0gZmFsc2U7CiAgICAgICAgICAgICAgdGhpcy5leHBlbnNlcyA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgdGhpcy5vbk1ldGhvZENoYW5nZWQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nVHhuQWRkaXRpb25hbENvc3QgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSwgMTApOwogICAgICB9KTsKICAgIH0sCiAgICBhc3luYyBjbGVhcmluZ0FjY291bnQoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKHRoaXMuaXNJdGVtKCkpIHsKICAgICAgICAgIC8qIHRvZG86IGNsZWFyaW5nIGFjY291bnQgZm9yIGFkZGl0aW9uYWwgY29zdCAqLwogICAgICAgICAgY29uc3QgYW1vdW50ID0gKHRoaXMucHVyY2hhc2UuYWRkaXRpb25hbENvc3RUb3RhbCB8fCAwKSAqIC0xOwogICAgICAgICAgY29uc3QgeEFtb3VudCA9IGFtb3VudCAqIHRoaXMucHVyY2hhc2UudHhuUmF0ZSB8fCAxOwogICAgICAgICAgY29uc3QgYWRkaWN0ID0gdGhpcy5wdXJjaGFzZS5hZGRpdGlvbmFsQ29zdCB8fCBbXTsKCiAgICAgICAgICBpZiAoYWRkaWN0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgaWYgKGFkZGljdFswXSkgewogICAgICAgICAgICAgIGNvbnN0IGFjY291bnQgPSBhZGRpY3RbMF0uYWNjb3VudCB8fCB7fTsKICAgICAgICAgICAgICBjb25zdCBuYXR1cmUgPSAiY3IiOwogICAgICAgICAgICAgIHRoaXMualJhdy5wdXNoKHsKICAgICAgICAgICAgICAgIGlkOiBhY2NvdW50LmlkICsgIi0iICsgbmF0dXJlLAogICAgICAgICAgICAgICAgbGluZTogbmV3IEl0ZW1MaW5lTW9kZWwoKSwKICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAiQWRkaXRpb25hbCBDb3N0IiwKICAgICAgICAgICAgICAgIGFjY291bnQ6IGFjY291bnQsCiAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IGFjY291bnQuaWQsCiAgICAgICAgICAgICAgICBhbW91bnQ6IGFtb3VudCwKICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OiB4QW1vdW50LAogICAgICAgICAgICAgICAgdHlwZTogbmF0dXJlLAogICAgICAgICAgICAgICAgdHlwZUFzOiAiY2xlYXJpbmciLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCJlcnJvciIsIGUpOwogICAgICB9CiAgICB9LAogICAgaXNJdGVtKCkgewogICAgICBjb25zdCBkcyA9IHRoaXMuJHJlZnMuaXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpOwogICAgICBjb25zdCByb3cgPSBkcy5kYXRhKCkuZmlsdGVyKChuKSA9PiBuLmFtb3VudCA+IDApOwogICAgICBjb25zdCBmb3VuZCA9IHJvdy5maWx0ZXIoKG4pID0+IG4uaXRlbS50eXBlID09PSAiVmFyaWFudCIpOwogICAgICBpZiAoZm91bmQpIHsKICAgICAgICByZXR1cm4gZm91bmQubGVuZ3RoID4gMDsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGFiYnIoKSB7CiAgICAgIGlmICh0aGlzLnB1cmNoYXNlKSB7CiAgICAgICAgY29uc3QgdHhuVHlwZSA9IHRoaXMucHVyY2hhc2UudHJhbnNhY3Rpb25UeXBlIHx8IHt9OwogICAgICAgIGNvbnN0IGFiYnIgPSB0eG5UeXBlLmFiYnIgfHwgIiI7CiAgICAgICAgcmV0dXJuIGFiYnI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICIiOwogICAgICB9CiAgICB9LAogICAgdmFsaWRWZW5kb3IoKSB7CiAgICAgIGxldCB2ZW5kb3IgPSB0aGlzLnZlbmRvcjsKICAgICAgcmV0dXJuIHZlbmRvci5pZCAhPT0gdW5kZWZpbmVkICYmIHZlbmRvci5pZCAhPT0gbnVsbDsKICAgIH0sCiAgICBkaXNhYmxlTWUoKSB7CiAgICAgIHJldHVybiAhIXRoaXMuJHJvdXRlLnBhcmFtcy5pZDsKICAgIH0sCiAgICBoaWRkZW5CdXR0b24oKSB7CiAgICAgIHJldHVybiAhIXRoaXMuJHJvdXRlLnBhcmFtcy5pZDsKICAgIH0sCiAgICBkaXNhYmxlZFNMUCgpIHsKICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCkgewogICAgICAgIGNvbnN0IHJlZkYgPSB0aGlzLnB1cmNoYXNlLnJlZkZyb20gfHwgW107CiAgICAgICAgaWYgKHJlZkYubGVuZ3RoID4gMCkgewogICAgICAgICAgcmV0dXJuICEhcmVmRi5sZW5ndGggPiAwOwogICAgICAgIH0KICAgICAgICBjb25zdCBhZGMgPSB0aGlzLnB1cmNoYXNlLmFkZGl0aW9uYWxDb3N0IHx8IFtdOwogICAgICAgIGlmIChhZGMubGVuZ3RoID4gMCkgewogICAgICAgICAgcmV0dXJuICEhYWRjLmxlbmd0aCA+IDA7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgfSwKICB3YXRjaDogewogICAgLy8gaWQoKSB7CiAgICAvLyAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09IHVuZGVmaW5lZCkgewogICAgLy8gICAgIHRoaXMuY2xlYXIoKTsKICAgIC8vICAgfSBlbHNlIHsKICAgIC8vICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgIC8vICAgICB0aGlzLmxvYWRWaWV3Q3JlZGl0UHVyY2hhc2UoKTsKICAgIC8vICAgfQogICAgLy8gfSwKICAgICRyb3V0ZTogInJlbG9hZCIsCiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5sb2FkVGF4KCk7CiAgICB0aGlzLmxvYWRQcmVmaXgoKTsKICAgIHRoaXMubG9hZFByb2plY3RCeUN1c3RvbWVyKCk7CiAgfSwKICBtb3VudGVkOiBhc3luYyBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLnJlcXVlc3REYXRhKDAsIHRoaXMuZmlsdGVyLCB0aGlzLmN1c0Jhc2VVcmwpOwogICAgYXdhaXQgdGhpcy5sb2FkU2VnbWVudCgpOwogICAgYXdhaXQgdGhpcy5sb2FkTG9jYXRpb24oKTsKICAgIGF3YWl0IHRoaXMubG9hZERpc2NvdW50SXRlbSgpOwogICAgYXdhaXQgdGhpcy5sb2FkRW1wbG95ZWVDZW50ZXIoKTsKICAgIGF3YWl0IHRoaXMubG9hZFBheW1lbnRUZXJtKCk7CiAgICBhd2FpdCB0aGlzLmxvYWRBY2NvdW50KCk7CiAgICBhd2FpdCB0aGlzLmxvYWRQcmljZUxldmVsKCk7CiAgICBhd2FpdCB0aGlzLmxvYWRPdGhlckNoYXJnZSgpOwogICAgYXdhaXQgdGhpcy5sb2FkUHVyY2hhc2VGb3JtQ29udGVudCgpOwogICAgYXdhaXQgdGhpcy5pbml0RGF0YSgpOwogIH0sCn07Cg=="},{"version":3,"sources":["CreditPurchase.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0qBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CreditPurchase.vue","sourceRoot":"src/views/micro_edition/purchases","sourcesContent":["<template>\n  <v-app>\n    <v-container>\n      <v-row>\n        <v-col sm=\"12\" cols=\"12\">\n          <v-card\n            outlined\n            dense\n            class=\"pa-4 no_border rounded-sm\"\n            color=\"white\"\n          >\n            <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n              <v-row>\n                <v-col\n                  class=\"bigSide pr-2 py-0\"\n                  sm=\"12\"\n                  cols=\"12\"\n                  style=\"transition: 0.3s ease-in\"\n                  :class=\"{ hide_big_bar_class: isHideBar }\"\n                >\n                  <v-card outlined dense class=\"no_border\">\n                    <h2 class=\"mb-0\">{{ $t(\"purchase\") }}</h2>\n\n                    <v-icon\n                      @click=\"cancel()\"\n                      style=\"cursor: pointer; font-size: 40px\"\n                      color=\"grey\"\n                      class=\"float-right\"\n                      >close\n                    </v-icon>\n                    <span\n                      class=\"pointer float-right help\"\n                      @click=\"Help('purchase')\"\n                    >\n                      {{ $t(\"help\") }}\n                    </span>\n                  </v-card>\n                  <v-card\n                    outlined\n                    dense\n                    class=\"px-4 rounded-4 no_border\"\n                    color=\"grayBg\"\n                  >\n                    <v-row>\n                      <v-col class=\"pb-0 pt-3\" sm=\"4\" cols=\"12\">\n                        <label class=\"label mb-0\">{{ $t(\"supplier\") }}</label>\n                        <v-col\n                          sm=\"12\"\n                          cols=\"12\"\n                          class=\"kendo_dropdown_custom px-0 pb-4 pt-0\"\n                        >\n                          <dropdownlist\n                            :data-items=\"vendorList\"\n                            @change=\"onChange\"\n                            :value=\"vendor\"\n                            :data-item-key=\"dataItemKey\"\n                            :text-field=\"textField\"\n                            :default-item=\"defaultItem\"\n                            :filterable=\"true\"\n                            :required=\"true\"\n                            :disabled=\"disableMe\"\n                            :valid=\"validVendor\"\n                            @filterchange=\"onFilterChange\"\n                          >\n                          </dropdownlist>\n                        </v-col>\n                        <div hidden>\n                          <label class=\"label mb-0\">{{\n                            $t(\"purchase_type\")\n                          }}</label>\n                          <v-select\n                            class=\"mt-1\"\n                            :items=\"purchaseTypes\"\n                            item-value=\"id\"\n                            item-text=\"name\"\n                            v-model=\"purchase.transactionType\"\n                            @change=\"onInvoiceTypeChanged\"\n                            :rules=\"[\n                              (v) => !!v || 'Transaction Currency is required',\n                            ]\"\n                            return-object\n                            outlined\n                          />\n                        </div>\n\n                        <label class=\"label mb-0\">{{\n                          $t(\"transaction_date\")\n                        }}</label>\n                        <app-datepicker\n                          :initialDate=\"purchase.transactionDate\"\n                          :disabled=\"disableMe\"\n                          @onChanged=\"onInvoiceDateChanged\"\n                          @emitDate=\"txnDate = $event\"\n                        />\n                        <label class=\"label mb-0\">{{\n                          $t(\"transaction_number\")\n                        }}</label>\n                        <v-row class=\"mt-1 mr-0\">\n                          <v-col sm=\"3\" cols=\"3\" class=\"pt-0 pr-0 pb-0\">\n                            <div class=\"code_text text-bold\">\n                              {{ abbr }}\n                            </div>\n                          </v-col>\n                          <v-col sm=\"7\" cols=\"7\" class=\"pt-0 pl-0 pr-1 pb-0\">\n                            <v-text-field\n                              class=\"custom-border\"\n                              v-model=\"purchase.number\"\n                              outlined\n                              readonly\n                              :rules=\"[(v) => !!v || 'Number is required']\"\n                              required\n                            />\n                          </v-col>\n                          <v-col sm=\"2\" cols=\"2\" class=\"pt-0 px-0 pb-0\">\n                            <v-icon\n                              color=\"black\"\n                              size=\"30\"\n                              class=\"border_qrcode\"\n                              :disabled=\"disableMe\"\n                              @click=\"generateNumber\"\n                              >mdi-qrcode\n                            </v-icon>\n                          </v-col>\n                        </v-row>\n                      </v-col>\n                      <v-col class=\"pb-0 pt-3\" sm=\"4\" cols=\"12\">\n                        <label class=\"label mb-0\">{{\n                          $t(\"suppliers_invoice_no\")\n                        }}</label>\n                        <v-text-field\n                          class=\"mt-1 mr-0\"\n                          outlined\n                          v-model=\"purchase.billNo\"\n                          tage=\"Vendor Invoice Number.\"\n                          :rules=\"[(v) => !!v || 'required']\"\n                          required\n                        />\n                        <label class=\"label mb-0\">{{ $t(\"term\") }}</label>\n                        <v-select\n                          class=\"mt-1\"\n                          v-model=\"purchase.paymentTerm\"\n                          :items=\"paymentTerms\"\n                          :rules=\"[(v) => !!v['id'] || 'required']\"\n                          @change=\"onPaymentTermChanged\"\n                          placeholder=\"Term\"\n                          item-text=\"name\"\n                          item-value=\"id\"\n                          return-object\n                          outlined\n                        />\n                      </v-col>\n                      <v-col class=\"pb-0 pt-3\" sm=\"4\" cols=\"12\">\n                        <label class=\"label mb-0\">{{ $t(\"due_date\") }}</label>\n                        <app-datepicker\n                          :initialDate=\"purchase.dueDate\"\n                          @emitDate=\"dueDate = $event\"\n                        />\n                        <label class=\"label mb-0\">{{\n                          $t(\"vendor_invoice_date\")\n                        }}</label>\n                        <app-datepicker\n                          :initialDate=\"purchase.billDate\"\n                          @emitDate=\"billDate = $event\"\n                        />\n                        <!-- <label class=\"label mb-0\">{{\n                                                        $t(\"price_level\")\n                                                    }}</label>\n                                                <v-select\n                                                    class=\"mt-1\"\n                                                    v-model=\"purchase.priceLevel\"\n                                                    :items=\"priceLevel\"\n                                                    item-value=\"id\"\n                                                    @change=\"onPriceLevelChange\"\n                                                    :disabled=\"disabledSLP\"\n                                                    :rules=\"[(v) => !!v['id'] || 'required']\"\n                                                    item-text=\"name\"\n                                                    return-object\n                                                    placeholder=\"Price Level\"\n                                                    tage=\"Default Price Level\"\n                                                    outlined\n                                                /> -->\n\n                        <!-- <v-col\n                                                    sm=\"12\"\n                                                    col=\"12\"\n                                                    class=\"d-flex justify-space-between pt-0\"\n                                                >\n                                                    <div>\n                                                        <p class=\"label mb-0\">{{ $t(\"currency\") }}</p>\n                                                        <p class=\"label mb-0 mt-4\">\n                                                            {{ currencyCode }}\n                                                        </p>\n                                                    </div>\n                                                    <div>\n                                                        <p class=\"label mb-0\">{{ $t(\"rate\") }}</p>\n                                                        <p class=\"label mb-0 mt-4\">\n                                                            {{ transactionRate }}\n                                                        </p>\n                                                    </div>\n                                                </v-col> -->\n                      </v-col>\n                    </v-row>\n                  </v-card>\n                  <v-row style=\"background-color: #fff\">\n                    <v-col sm=\"12\" cols=\"12\" class=\"pb-0 px-4\">\n                      <kendo-datasource\n                        ref=\"itemLineDS\"\n                        :data=\"itemLines\"\n                        :change=\"dataSourceChanged\"\n                      />\n                      <kendo-grid\n                        id=\"gridItemLine\"\n                        class=\"grid-function\"\n                        :data-source-ref=\"'itemLineDS'\"\n                        :sortable=\"false\"\n                        :column-menu=\"true\"\n                        :editable=\"true\"\n                        v-on:databound=\"dataBound\"\n                        :scrollable-virtual=\"true\"\n                      >\n                        <kendo-grid-column\n                          :command=\"{\n                            iconClass: 'k-icon k-i-trash',\n                            text: ' ',\n                            click: removeRow,\n                            className: 'isEditable',\n                          }\"\n                          :title=\"' '\"\n                          :width=\"70\"\n                          :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                        />\n                        <kendo-grid-column\n                          :title=\"$t('no.')\"\n                          :width=\"55\"\n                          :column-menu=\"false\"\n                          :template=\"rowNumberTmpl\"\n                          :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5;',\n                            class: 'text-products',\n                          }\"\n                          :attributes=\"{ style: 'text-align: products' }\"\n                        />\n\n                        <kendo-grid-column\n                          :field=\"'item'\"\n                          :title=\"$t('item')\"\n                          :template=\"itemTemplate\"\n                          :editor=\"ItemDropDownEditor\"\n                          :attributes=\"{ class: 'isEditable' }\"\n                          :width=\"200\"\n                          :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'description'\"\n                          :title=\"$t('description')\"\n                          :template=\"'<span>#=description#</span>'\"\n                          :width=\"200\"\n                          :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'qty'\"\n                          :title=\"$t('qty')\"\n                          :format=\"'{0:n}'\"\n                          :template=\"'<span>#=qty#</span>'\"\n                          :width=\"80\"\n                          :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                          :attributes=\"{ style: 'text-align: right; ' }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'uom'\"\n                          :title=\"$t('uom')\"\n                          :width=\"100\"\n                          :template=\"UOMTemplate\"\n                          :editor=\"UOMDropDownEditor\"\n                          :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                          :attributes=\"{ style: 'text-align: left' }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'cost'\"\n                          :title=\"$t('cost')\"\n                          :width=\"200\"\n                          :template=\"'<span>#=kendo.toString(cost || 0, decimalFormat)#</span>'\"\n                          :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                          :attributes=\"{ style: 'text-align: right' }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'amount'\"\n                          :title=\"$t('amount')\"\n                          :width=\"200\"\n                          :editable=\"\n                            () => {\n                              return false;\n                            }\n                          \"\n                          :template=\"'<span>#=kendo.toString(amount || 0, decimalFormat)#</span>'\"\n                          :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                          :attributes=\"{ style: 'text-align: right' }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'vatTax'\"\n                          :title=\"$t('tax')\"\n                          :width=\"200\"\n                          :hidden=\"true\"\n                          :template=\"vatTemplate\"\n                          :editor=\"VatTaxDropDownEditor\"\n                          :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                          :attributes=\"{ style: 'text-align: left' }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'serviceDate'\"\n                          :title=\"$t('date_from')\"\n                          :width=\"200\"\n                          :hidden=\"!purchaseFormContent.serviceDate\"\n                          :template=\"'<span>#= kendo.toString(new Date(serviceDate), dateFormat)#</span>'\"\n                          :editor=\"ServiceDateEditor\"\n                          :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'serviceDateTo'\"\n                          :title=\"$t('date_to')\"\n                          :width=\"200\"\n                          :hidden=\"!purchaseFormContent.serviceDateTo\"\n                          :template=\"'<span>#= kendo.toString(new Date(serviceDateTo), dateFormat)#</span>'\"\n                          :editor=\"ServiceDateToEditor\"\n                          :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'discountItem'\"\n                          :title=\"$t('discount_item')\"\n                          :width=\"200\"\n                          :hidden=\"!purchaseFormContent.discountItem\"\n                          :template=\"discountItemTemplate\"\n                          :editor=\"DiscountItemDropDownEditor\"\n                          :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                          :attributes=\"{ style: 'text-align: left' }\"\n                        />\n\n                        <kendo-grid-column\n                          :field=\"'class1'\"\n                          :title=\"$t('class_1')\"\n                          :hidden=\"!purchaseFormContent.class1\"\n                          :template=\"'<span>#=class1.name || ``#</span>'\"\n                          :width=\"200\"\n                          :editor=\"ClassEditor.class1\"\n                          :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                          :attributes=\"{ style: 'text-align: left' }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'class2'\"\n                          :title=\"$t('class_2')\"\n                          :hidden=\"!purchaseFormContent.class2\"\n                          :template=\"'<span>#=class2.name || ``#</span>'\"\n                          :width=\"200\"\n                          :editor=\"ClassEditor.class2\"\n                          :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                          :attributes=\"{ style: 'text-align: left' }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'class3'\"\n                          :title=\"$t('class_3')\"\n                          :hidden=\"!purchaseFormContent.class3\"\n                          :template=\"'<span>#=class3.name || ``#</span>'\"\n                          :width=\"200\"\n                          :editor=\"ClassEditor.class3\"\n                          :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                          :attributes=\"{ style: 'text-align: left' }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'class4'\"\n                          :title=\"$t('class_4')\"\n                          :hidden=\"!purchaseFormContent.class4\"\n                          :template=\"'<span>#=class4.name || ``#</span>'\"\n                          :width=\"200\"\n                          :editor=\"ClassEditor.class4\"\n                          :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                          :attributes=\"{ style: 'text-align: left' }\"\n                        />\n                        <kendo-grid-column\n                          :field=\"'class5'\"\n                          :title=\"$t('class_5')\"\n                          :hidden=\"!purchaseFormContent.class5\"\n                          :template=\"'<span>#=class5.name || ``#</span>'\"\n                          :width=\"200\"\n                          :editor=\"ClassEditor.class5\"\n                          :headerAttributes=\"{\n                            style:\n                              'text-align: left; background-color: #EDF1F5',\n                          }\"\n                          :attributes=\"{ style: 'text-align: left' }\"\n                        />\n                      </kendo-grid>\n                    </v-col>\n                    <v-col sm=\"12\" cols=\"12\" class=\"pt-1\">\n                      <v-btn class=\"float-left btn_plus mr-2\" @click=\"addRow\">\n                        <v-icon size=\"\" class=\"ma-1\">mdi-plus</v-icon>\n                      </v-btn>\n                    </v-col>\n                    <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                      <v-row>\n                        <v-col class=\"pt-0\" sm=\"5\" cols=\"6\">\n                          <v-card\n                            class=\"no-boxshadow pa-3 rounded-4\"\n                            color=\"grayBg\"\n                          >\n                            <v-row>\n                              <v-col class=\"py-0 pa-4\" sm=\"12\" cols=\"12\">\n                                <label class=\"label mb-0\">{{\n                                  $t(\"billing_address\")\n                                }}</label>\n                                <v-select\n                                  class=\"mt-1\"\n                                  v-model=\"purchase.billingAddress\"\n                                  :items=\"billingAddress\"\n                                  item-value=\"id\"\n                                  item-text=\"name\"\n                                  tage=\"Billing Address\"\n                                  placeholder=\"Address\"\n                                  outlined\n                                />\n                                <label class=\"label mb-0\">{{\n                                  $t(\"pickup_delivery_address\")\n                                }}</label>\n                                <v-select\n                                  class=\"mt-1\"\n                                  v-model=\"purchase.deliveryAddress\"\n                                  :items=\"deliveryAddress\"\n                                  item-value=\"id\"\n                                  item-text=\"name\"\n                                  tage=\"Pickup/ Delivery Address\"\n                                  placeholder=\"Address\"\n                                  outlined\n                                />\n                                <label class=\"label mb-0\">{{\n                                  $t(\"pickup_delivery_date_time\")\n                                }}</label>\n                                <app-datepicker\n                                  :initialDate=\"purchase.deliveryDateTime\"\n                                  @emitDate=\"deliveryDateTime = $event\"\n                                />\n                                <!-- \n                                                                <label>{{ $t(\"message_on_invoice\") }}</label>\n                                                                <v-textarea\n                                                                    class=\"mt-1\"\n                                                                    v-model=\"purchase.transactionNote\"\n                                                                    outlined\n                                                                    no-resize\n                                                                    height=\"70px\"\n                                                                    tage=\"Message on Purchase\"\n                                                                    placeholder=\"This will appear on the Purchase\"\n                                                                />\n                                                                <label>{{ $t(\"message_on_journal\") }}</label>\n                                                                <v-textarea\n                                                                    class=\"mt-1\"\n                                                                    v-model=\"purchase.journalNote\"\n                                                                    outlined\n                                                                    no-resize\n                                                                    height=\"70px\"\n                                                                    tage=\"Message on Order\"\n                                                                    placeholder=\"This will appear on the journal\"\n                                                                /> -->\n                              </v-col>\n                            </v-row>\n                          </v-card>\n                        </v-col>\n                        <v-col class=\"pt-0\" sm=\"7\" cols=\"6\">\n                          <v-simple-table>\n                            <template v-slot:default>\n                              <tbody>\n                                <tr>\n                                  <td class=\"text-left pr-0\">\n                                    {{ $t(\"subtotal\") }}\n                                  </td>\n                                  <td class=\"text-center\">:</td>\n                                  <td class=\"text-right\">\n                                    {{ numberFormat(purchase.subTotal) }}\n                                  </td>\n                                </tr>\n                                <tr>\n                                  <td class=\"text-left pr-0\">\n                                    {{ $t(\"general_discount\") }}\n                                  </td>\n                                  <td class=\"text-center\">:</td>\n                                  <td class=\"text-right\">\n                                    ({{ numberFormat(purchase.discountTotal) }})\n                                  </td>\n                                </tr>\n                                <tr>\n                                  <td class=\"text-left text-uppercase pr-0\">\n                                    {{ $t(\"total\") }}\n                                  </td>\n                                  <td class=\"text-center\">:</td>\n                                  <td\n                                    class=\"text-right primary--text text-bold\"\n                                    id=\"total\"\n                                  >\n                                    {{ numberFormat(purchase.total) }}\n                                  </td>\n                                </tr>\n                                <tr>\n                                  <td class=\"text-left pr-0\">\n                                    {{ $t(\"deposit\") }}\n                                    <span class=\"float-right primary--text\">{{\n                                      numberFormat(purchase.depositAmount)\n                                    }}</span>\n                                  </td>\n                                  <td class=\"text-center\">:</td>\n                                  <td class=\"text-right hide_form_alert\">\n                                    <v-text-field\n                                      class=\"\n                                        text-right\n                                        float-right\n                                        deposite_input\n                                      \"\n                                      v-model=\"purchase.depositDeduction\"\n                                      @change=\"onDepositDeductionChange\"\n                                      min=\"0\"\n                                      type=\"number\"\n                                      tage=\"Deposit\"\n                                      width=\"80\"\n                                      outlined\n                                    />\n                                  </td>\n                                </tr>\n                                <tr>\n                                  <td class=\"text-left\">\n                                    {{ $t(\"amount_due\") }}\n                                  </td>\n                                  <td class=\"text-center\">:</td>\n                                  <td\n                                    class=\"text-right primary--text text-bold\"\n                                  >\n                                    {{ numberFormat(purchase.remainingAmount) }}\n                                  </td>\n                                </tr>\n                              </tbody>\n                            </template>\n                          </v-simple-table>\n                        </v-col>\n                      </v-row>\n                    </v-col>\n                  </v-row>\n                  <v-divider />\n                  <v-card outlined dense class=\"no_border function_footer\">\n                    <v-alert type=\"warning\" v-model=\"alert\" dismissible>\n                      <span v-html=\"errorMessage\" />\n                    </v-alert>\n                    <v-menu>\n                      <template v-slot:activator=\"{ on }\">\n                        <v-btn\n                          class=\"mr-2 float-left select_template\"\n                          v-on=\"on\"\n                        >\n                          {{ $t(\"select_template\") }}\n                          <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>\n                        </v-btn>\n                      </template>\n                      <v-list>\n                        <v-list-item\n                          v-for=\"(item, index) in templates\"\n                          :key=\"index\"\n                        >\n                          <v-list-item-title\n                            >{{ item.title }}\n                          </v-list-item-title>\n                        </v-list-item>\n                      </v-list>\n                    </v-menu>\n                    <v-btn\n                      outlined\n                      class=\"text-capitalize black--text float-left\"\n                      color=\"primary\"\n                      @click=\"cancel\"\n                      >{{ $t(\"cancel\") }}\n                    </v-btn>\n                    <v-btn\n                      class=\"float-right text-capitalize white--text\"\n                      @click=\"onSaveClose(false)\"\n                      color=\"primary\"\n                    >\n                      {{ $t(\"save_close\") }}\n                    </v-btn>\n                    <v-btn\n                      color=\"secondary\"\n                      style=\"margin-right: 10px !important\"\n                      class=\"white--text float-right text-capitalize\"\n                      @click=\"onSaveClose(true)\"\n                      :hidden=\"hiddenButton\"\n                      >{{ $t(\"save_new\") }}\n                    </v-btn>\n                  </v-card>\n                </v-col>\n              </v-row>\n            </v-form>\n          </v-card>\n        </v-col>\n      </v-row>\n      <LoadingMe :isLoading=\"showLoading\" :fullPage=\"false\" :myLoading=\"true\" />\n      <v-dialog v-model=\"dialogTax\" max-width=\"450px\">\n        <v-card>\n          <div class=\"modal_header\">\n            <v-card-title>{{ $t(\"tax_list\") }}</v-card-title>\n            <v-icon @click=\"dialogTax = false\">close</v-icon>\n          </div>\n          <v-card-text class=\"modal_text_content\">\n            <v-row>\n              <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                <v-simple-table>\n                  <template v-slot:default>\n                    <tbody>\n                      <tr\n                        v-for=\"(value, name) in taxListTotal\"\n                        v-bind:key=\"name\"\n                      >\n                        <td class=\"text-left\" width=\"180px\">{{ name }}</td>\n                        <td class=\"text-center\">:</td>\n                        <td class=\"text-right\">\n                          {{ numberFormat(value) }}\n                        </td>\n                      </tr>\n                      <tr>\n                        <td class=\"text-left\" width=\"180px\">\n                          {{ $t(\"total\") }}\n                        </td>\n                        <td class=\"text-center\">:</td>\n                        <td class=\"text-right\">\n                          {{ numberFormat(purchase.totalTaxAmount) }}\n                        </td>\n                      </tr>\n                    </tbody>\n                  </template>\n                </v-simple-table>\n              </v-col>\n            </v-row>\n          </v-card-text>\n          <v-divider />\n        </v-card>\n      </v-dialog>\n    </v-container>\n  </v-app>\n</template>\n<script>\n// import kendo from \"@progress/kendo-ui\"\nimport { i18n } from \"@/i18n\";\nimport PurchaseModel from \"@/scripts/purchase/model/Purchase\";\nimport ItemLineModel from \"@/scripts/purchase/model/ItemLine\";\nimport { uuid } from \"vue-uuid\";\nimport { DropDownList } from \"@progress/kendo-vue-dropdowns\";\nimport kendo from \"@progress/kendo-ui\";\nimport PurchaseFormContentModel from \"@/scripts/model/PurchaseFormContent\";\nimport { dataStore, ShowResource } from \"@/observable/store\";\nimport paymentTermHandler_ from \"@/scripts/paymentterm/handler/paymentTermHandler\";\nimport creditLimitHandler from \"@/scripts/creditLimit/handler/creditLimitHandler\";\nimport saleOrderHandler from \"@/scripts/transactionHandler\";\nimport Helper from \"@/helper\";\nimport settingsHandler from \"@/scripts/settingsHandler\";\n\nconst supplierHandler = require(\"@/scripts/supplierHandler\");\n// import kendo from \"@progress/kendo-ui\";\n\nconst projectHandler = require(\"@/scripts/projectHandler\");\nconst priceLevelHandler = require(\"@/scripts/priceLevelHandler\");\nconst currencyHandler = require(\"@/scripts/currency/handler/currencyHandler\");\n\n// const settingsHandler = require(\"@/scripts/settingsHandler\");\nconst employeeHandler = require(\"@/scripts/employeeHandler\");\nconst locationHandler = require(\"@/scripts/locationHandler\");\n// const paymentTermHandler = require(\"@/scripts/paymentTermHandler\");\nconst accountHandler = require(\"@/scripts/handler/accounting/account\");\nconst productVariantHandler = require(\"@/scripts/productVariantHandler\");\nconst uomPriceHandler = require(\"@/scripts/uomPriceHandler\");\nconst discountItemHandler = require(\"@/scripts/discountItemHandler\");\nconst settingHandler = require(\"@/scripts/settingHandler\");\nconst otherChargeHandler = require(\"@/scripts/otherChargeHandler\");\nconst purchaseFormContentHandler = require(\"@/scripts/purchaseFormContentHandler\");\nconst prefixHandler = require(\"@/scripts/prefixHandler\");\nconst billingHandler = require(\"@/scripts/invoice/handler/billingHandler\");\n\nconst purchaseModel = new PurchaseModel({});\nconst itemLineModel = new ItemLineModel({});\nconst purchaseFormContentModel = new PurchaseFormContentModel({});\nconst $ = kendo.jQuery;\n\nconst textField = \"numberName\";\nconst keyField = \"id\";\nconst defaultItem = { [textField]: \"Select vendor...\", [keyField]: null };\nconst emptyItem = { [textField]: \"loading ...\" };\nconst pageSize = 10;\nconst itemLinePrefix = \"lin-\";\nconst loadingData = [];\nwhile (loadingData.length < pageSize) {\n  loadingData.push({ ...emptyItem });\n}\nconst { ClassEditor } = require(\"@/scripts/kendo_editor/Collections\");\nconst DISCOUNT_TYPE = \"?type=Purchase\";\nconst TRANSACTION_TYPE = \"Purchase\";\nconst cookieJS = require(\"@/cookie.js\");\nconst cookie = cookieJS.getCookie();\nconst NATURE = \"purchase\";\nexport default {\n  name: \"CreditPurchase\",\n  props: [\"id\", \"transactionDate\"],\n  components: {\n    LoadingMe: () => import(`@/components/Loading`),\n    \"app-datepicker\": () =>\n      import(\"@/components/custom_templates/DatePickerComponent\"),\n    // \"month-picker\": () => import(\"@/components/custom_templates/MonthPicker\"),\n    dropdownlist: DropDownList,\n  },\n  data: () => ({\n    isEdit: false,\n    showLoadingTxn: false,\n    showLoadingTxnAdditionalCost: false,\n    mOtherCharge: [],\n    mOtherChargeAmount: [],\n    purchaseOrders: [],\n    numSelect: [1],\n    dialogTax: false,\n    vendorList: [],\n    showLoading: false,\n    bill_date: \"\",\n    alert: false,\n    files: [],\n    // Form validation\n    valid: true,\n    itemLines: [],\n    txnDate: new Date().toISOString().substr(0, 10),\n    billDate: new Date().toISOString().substr(0, 10),\n    invoiceDate: new Date().toISOString().substr(0, 10),\n    monthOf: \"\",\n    templates: [{ title: \"Purchase\", value: \"Purchase\" }],\n    isHideBar: false,\n    vendor: {},\n    defaultItem: defaultItem,\n    purchase: purchaseModel,\n    transactionType: [\"Invoice\", \"Commercial Invoice\", \"Tax Invoice\"],\n    cusBaseUrl: supplierHandler.search(),\n    empBaseUrl: employeeHandler.search(),\n    init: { method: \"GET\", accept: \"application/json\", headers: [] },\n    pendingRequest: undefined,\n    requestStarted: false,\n    skip: 0,\n    tempSkip: null,\n    total: 0,\n    filter: \"\",\n    referenceNo: \"\",\n    filter_: \"\",\n    textField: \"numberName\",\n    dataItemKey: \"id\",\n    segments: [],\n    employees: [],\n    methods: [\"Qty Based\", \"Amount Based\"],\n    mEmployee: {},\n    customerProjects: [],\n    billingAddress: [],\n    deliveryAddress: [],\n    deliveryDateTime: new Date().toISOString().substr(0, 10),\n    priceLevel: [],\n    locations: [],\n    paymentTerms: [],\n    accPayable: [],\n    currencies: [],\n    itemLine: itemLineModel,\n    uoms: [],\n    tax: [],\n    specificDiscountItem: [],\n    otherChargeList: [],\n    depositBalance: 0,\n    schemaDefinition: {\n      model: {\n        id: \"id\",\n      },\n    },\n    purchaseFormContent: purchaseFormContentModel,\n    ClassEditor: ClassEditor,\n    taxListTotal: {},\n    purchaseTypes: [],\n    taxListDetail: [],\n    supplierDiscountItem: [],\n    lateFeeList: [],\n    loggedUser: {\n      id: cookie.creator,\n      name: cookie.email,\n    },\n    exchangeRate: {},\n    baseCurrencyCode: \"\",\n    currencyCode: \"\",\n    transactionRate: 1,\n    jRaw: [],\n    refFrom: [],\n    isPriceLevelChanged: false,\n    expenses: [],\n    additionalCostTotal: 0,\n    chkChecked: [],\n    accWithholdingExpense: [],\n  }),\n  methods: {\n    dataBound: function (e) {\n      const grid = kendo.jQuery(\"#gridItemLine\").data(\"kendoGrid\");\n      const items = e.sender.items();\n      if (grid) {\n        items.each(function () {\n          let dataItem = grid.dataItem(this);\n          $(\"tr[data-uid='\" + dataItem.uid + \"']\")\n            .find(\".isEditable\")\n            .each(function () {\n              if (dataItem.isEditable === false) {\n                $(this).addClass(\"k-state-disabled\");\n              }\n            });\n        });\n      }\n    },\n    onMethodChanged() {\n      if (this.isItem()) {\n        this.calculateAdditionalCost();\n        this.autoCalculate();\n      }\n    },\n    onCheckChanged() {\n      if (this.isItem()) {\n        this.additionalCostTotal = 0;\n        this.jRaw = [];\n        if (this.chkChecked) {\n          this.chkChecked.forEach((m) => {\n            if (m) {\n              const xAmount = m.exchangeAmount || 0;\n              this.additionalCostTotal += parseFloat(xAmount);\n            }\n          });\n          this.purchase.additionalCost = this.chkChecked;\n          this.purchase.additionalCostTotal = this.additionalCostTotal;\n          // if (this.purchase.additionalCostMethod === 'Qty Based') {\n          //     this.percentageApplied()\n          // } else {\n          //     this.amountApplied()\n          // }\n          this.calculateAdditionalCost();\n          this.autoCalculate();\n        }\n      }\n    },\n    onPriceLevelChange() {\n      this.isPriceLevelChanged = true;\n      this.loadTransactionRate();\n      this.clearUOMItem();\n    },\n    async clearUOMItem() {\n      let ds = this.$refs.itemLineDS.kendoWidget();\n      ds.data().map((n) => {\n        n.set(\"uom\", {});\n      });\n      this.isPriceLevelChanged = false;\n    },\n    async loadPaymentTermList() {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          if (this.vendor) {\n            const strFilter =\n              \"?id=\" +\n              this.vendor.id +\n              \"&transactionDate=\" +\n              this.purchase.transactionDate +\n              \"&type=Vendor\";\n            this.purchase.paymentTerm = {};\n            paymentTermHandler_.get(strFilter).then((res) => {\n              if (res.data.statusCode === 200) {\n                const terms = res.data.data;\n                this.purchase.paymentTerm = terms.term;\n                this.onPaymentTermChanged();\n              }\n            });\n          }\n        }, 10);\n      });\n    },\n    async loadCreditLimit() {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          if (this.vendor) {\n            const strFilter =\n              \"?id=\" +\n              this.vendor.id +\n              \"&transactionDate=\" +\n              this.purchase.transactionDate +\n              \"&type=Vendor\";\n            this.purchase.creditLimit = 0;\n            creditLimitHandler.get(strFilter).then((res) => {\n              if (res.data.statusCode === 200) {\n                const credit = res.data.data;\n                this.purchase.creditLimit = kendo.parseFloat(\n                  credit.amount || 0\n                );\n              }\n            });\n          }\n        }, 10);\n      });\n    },\n    async observerClean(obj) {\n      return Object.keys(obj).reduce(\n        (res, e) => Object.assign(res, { [e]: obj[e] }),\n        {}\n      );\n    },\n    Help(key_search) {\n      ShowResource(key_search);\n    },\n    AmountEditor(container, options) {\n      kendo\n        .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n        .appendTo(container)\n        .kendoNumericTextBox({\n          decimals: 30,\n          format: `${this.purchaseFormContent.decimal}`,\n        });\n    },\n    vatTemplate(dataItem) {\n      const vat = dataItem.vatTax || {};\n      if (vat) {\n        return `<span>${vat.defaultTax ? vat.defaultTax : ``}</span>`;\n      } else {\n        return ``;\n      }\n    },\n    itemTemplate(dataItem) {\n      const item = dataItem.item;\n      if (item) {\n        return `<span>${item.name ? item.name : ``}</span>`;\n      } else {\n        return ``;\n      }\n    },\n    UOMTemplate(dataItem) {\n      const uom = dataItem.uom || {};\n      const code = uom.code || \"\";\n      if (uom) {\n        return `<span>${uom.uom ? code : ``}</span>`;\n      } else {\n        return ``;\n      }\n    },\n    discountItemTemplate(dataItem) {\n      const discountItem = dataItem.discountItem;\n      if (discountItem) {\n        return `<span>${discountItem.code ? discountItem.code : ``} - ${\n          discountItem.name ? discountItem.name : ``\n        }</span>`;\n      } else {\n        return ``;\n      }\n    },\n    addSelect() {\n      let amount_num = this.numSelect.length;\n      let num = this.numSelect[amount_num - 1];\n      let new_num = num + 1;\n      let lenghtItem = this.specificDiscountItem.length;\n      if (new_num <= lenghtItem) {\n        this.numSelect.push(new_num);\n      }\n    },\n    removeSelect(index) {\n      this.numSelect.splice(index, 1);\n      // window.console.log(index, this.numSelect)\n      // this.selectDiscount.splice(index,1)\n      // window.console.log(\"remove\",this.selectDiscount)\n      // this.selectDiscount = this.selectDiscount.filter(item =>  item.id != val.id);\n    },\n    onOtherChargeChange() {\n      let otherCharge = 0;\n      this.mOtherCharge.forEach((m) => {\n        otherCharge += this.autoCalculateDiscount(m, this.purchase.subTotal);\n      });\n      this.purchase.otherChargeAmount = otherCharge;\n      this.autoCalculate();\n    },\n    onOtherAmount(value) {\n      return this.autoCalculateDiscount(value, this.purchase.subTotal);\n    },\n    onSpecificDiscountChanged() {\n      this.purchase.specificDiscountTotal = 0;\n      if (this.purchase.specificDiscountItem) {\n        // window.console.log('-changed', this.purchase.specificDiscountItem)\n        this.purchase.specificDiscountTotal =\n          this.autoCalculateDiscount(\n            this.purchase.specificDiscountItem,\n            this.purchase.subTotal\n          ) || 0;\n        this.purchase.total =\n          kendo.parseFloat(this.purchase.subTotal) -\n          (kendo.parseFloat(this.purchase.discountTotal) +\n            kendo.parseFloat(this.purchase.totalTaxAmount)) -\n          this.autoCalculateDiscount(\n            this.purchase.specificDiscountItem,\n            this.purchase.subTotal\n          );\n      }\n      this.autoCalculate();\n    },\n    empImpl(dataItem) {\n      let empIds = [];\n      dataItem.employee.forEach((m) => {\n        empIds.push(m.firstName + \" - \" + m.lastName);\n      });\n      // window.console.log(empIds.join(', '))\n      return `<span>${empIds.join(\", \")}</span>`;\n    },\n    uomTmp(dataItem) {\n      window.console.log(dataItem);\n      return dataItem;\n    },\n    onInvoiceTypeChanged() {\n      if (this.$route.params.id === null || this.$route.params.id === \"\") {\n        this.generateNumber();\n      }\n    },\n    autoCalculateTaxByType(tax) {\n      // return by a key\n      const groupAll = (list) =>\n        list.reduce((tax, item) => {\n          const taxAmount = tax[item.name] || 0;\n          return Object.assign({}, tax, {\n            [item.name]: taxAmount + parseFloat(item.amount),\n          });\n        }, {});\n      this.taxListTotal = groupAll(tax);\n      window.console.log(\"nimol\", groupAll(tax));\n    },\n    onDepositDeductionChange() {\n      const deduct = parseFloat(this.purchase.depositDeduction || 0);\n      if (deduct < 0) {\n        this.purchase.depositDeduction = 0;\n      }\n      if (\n        this.purchase.depositDeduction === \"\" ||\n        this.purchase.depositDeduction === undefined\n      ) {\n        this.purchase.depositDeduction = 0;\n      }\n      const deduction = parseFloat(this.purchase.depositDeduction) || 0;\n      if (deduction > this.purchase.depositAmount) {\n        this.purchase.depositDeduction = this.purchase.depositAmount;\n      }\n\n      this.autoCalculate();\n    },\n    async autoCalculate() {\n      let ds = this.$refs.itemLineDS.kendoWidget(),\n        subTotal = 0,\n        totalTax = 0,\n        discountTotal = 0,\n        spTax = 0,\n        pltax = 0,\n        otherTax = 0,\n        vatTax = 0,\n        discountInvoice = 0,\n        taxList = [],\n        taxListDetail = [],\n        discountItem = [],\n        discountLine = [],\n        inclusiveTax = 0,\n        taxTypeId = 0,\n        withholdingTaxAmount = 0,\n        whTaxAmount = 0,\n        itemSubtotal = 0,\n        txnItmSubtotal = 0,\n        serviceSubtotal = 0,\n        itemDiscount = 0,\n        serviceDiscount = 0,\n        txnDiscount = 0;\n      let nature = \"\";\n      this.jRaw = [];\n      const rows = ds.data().filter((m) => parseFloat(m.amount) > 0);\n      rows.forEach((value) => {\n        let modifierPrice = 0,\n          incTax = 0;\n        if (value.modifier) {\n          modifierPrice = kendo.parseFloat(value.modifier.price);\n        }\n\n        let discount = 0;\n        if (value.discountItem) {\n          const disItemField = value.discountItem;\n          let subTo =\n            kendo.parseFloat(value.cost) * kendo.parseFloat(value.qty);\n          discount = this.autoCalculateDiscount(value.discountItem, subTo);\n          value[\"discountAmount\"] = discount;\n          value[\"discountExchangeAmount\"] =\n            discount * kendo.parseFloat(this.purchase.txnRate);\n          if (value.discountItem.hasOwnProperty(\"id\")) {\n            discountItem.push(value.discountItem);\n          }\n          discountTotal += discount ? discount : 0;\n          if (discount * -1 > 0) {\n            nature = \"dr\";\n          } else {\n            nature = \"cr\";\n          }\n          if (disItemField.account) {\n            if (disItemField.account.hasOwnProperty(\"id\")) {\n              this.jRaw.push({\n                id: disItemField.account.id + \"-\" + nature,\n                line: new ItemLineModel(value),\n                description: \"Purchase Discount\",\n                account: disItemField.account,\n                accountId: disItemField.account.id,\n                amount: discount * -1,\n                exchangeAmount:\n                  discount * kendo.parseFloat(this.purchase.txnRate) * -1,\n                type: nature,\n                typeAs: \"discount\",\n              });\n            }\n          }\n        }\n        if (value.vatTax) {\n          // window.console.log('Vat Tax', value.tax)\n          let amt =\n            kendo.parseFloat(spTax ? spTax : 0) +\n            kendo.parseFloat(pltax ? pltax : 0) +\n            kendo.parseFloat(otherTax ? otherTax : 0) +\n            (kendo.parseFloat(value.amount ? value.amount : 0) -\n              (discount ? discount : 0));\n          vatTax = this.autoCalculateTax(value.vatTax, amt);\n          vatTax = kendo.parseFloat(vatTax) ? kendo.parseFloat(vatTax) : 0;\n          value[\"vatTaxAmount\"] = vatTax;\n          value[\"vatTaxExchangeAmount\"] =\n            vatTax * kendo.parseFloat(this.purchase.txnRate);\n          const tax = value.vatTax || {};\n          const baseAmount = tax.baseAmount || \"\";\n          window.console.log(tax, \"im tax\");\n          if (baseAmount) {\n            if (baseAmount.toLowerCase() === \"inclusive\") {\n              incTax = vatTax;\n            } else {\n              inclusiveTax += vatTax;\n            }\n          }\n          if (value.vatTax.hasOwnProperty(\"taxType\")) {\n            taxList.push({\n              name: value.vatTax.taxType.name,\n              amount: vatTax,\n              id: value.vatTax.taxType.id,\n            });\n            const vatTax_ = value.vatTax || {};\n            vatTax_[\"taxAmount_\"] = vatTax;\n            vatTax_[\"amount\"] = value.amount || 0;\n            vatTax_[\"discount\"] = discount || 0;\n            vatTax_[\"txnRate\"] = this.purchase.txnRate || 1;\n            vatTax_[\"isVat\"] = 1;\n            vatTax_.detail = {\n              specificTax: {},\n              publicLightingTax: {},\n              otherTax: {},\n            };\n            taxListDetail.push(vatTax_);\n            window.console.log(\"vat_\", vatTax_);\n          }\n          if (value.vatTax.hasOwnProperty(\"taxType\")) {\n            const taxType = value.vatTax.taxType || {};\n            taxTypeId = taxType.typeId || 0;\n          }\n          let taxAmount = vatTax;\n          let taxDescription = \"\";\n          if (taxTypeId === 1) {\n            nature = \"dr\";\n            taxAmount = vatTax;\n            taxDescription = \"Purchase Tax\";\n          } else if (taxTypeId === 2) {\n            withholdingTaxAmount += vatTax;\n            if (taxTypeId === 2 && baseAmount.toLowerCase() === \"net\") {\n              whTaxAmount += vatTax;\n            }\n            nature = \"cr\";\n            taxAmount = vatTax * -1;\n            taxDescription = \"Withholding Tax\";\n          } else if (taxTypeId === 10) {\n            nature = \"cr\";\n            taxAmount = 0;\n            taxDescription = \"No Tax\";\n          }\n          if (taxAmount > 0) {\n            nature = \"dr\";\n          } else {\n            nature = \"cr\";\n          }\n          const vatTaxField = value.vatTax || {};\n          if (taxAmount !== 0) {\n            if (vatTaxField) {\n              if (vatTaxField.account) {\n                if (vatTaxField.account.hasOwnProperty(\"id\")) {\n                  this.jRaw.push({\n                    id: vatTaxField.account.id + \"-\" + nature,\n                    line: new ItemLineModel(value),\n                    description: taxDescription,\n                    account: vatTaxField.account,\n                    accountId: vatTaxField.account.id,\n                    amount: taxAmount,\n                    exchangeAmount:\n                      taxAmount * kendo.parseFloat(this.purchase.txnRate),\n                    type: nature,\n                    typeAs: \"tax\",\n                  });\n                }\n              }\n            }\n          }\n        }\n        totalTax +=\n          kendo.parseFloat(spTax ? spTax : 0) +\n          kendo.parseFloat(pltax ? pltax : 0) +\n          kendo.parseFloat(otherTax ? otherTax : 0) +\n          kendo.parseFloat(vatTax ? vatTax : 0);\n        subTotal += kendo.parseFloat(value.amount) + modifierPrice - incTax;\n        const amount = kendo.parseFloat(value.amount) + modifierPrice;\n        const amt = this.excludeVATTaxInclusive(value.vatTax, amount, incTax);\n        // const xAmount = (kendo.parseFloat(amt) * kendo.parseFloat(this.purchase.txnRate))\n        const additc = value.additionalCost || 0;\n        const itemAmount = amt;\n        const itemXAmount =\n          itemAmount * kendo.parseFloat(this.purchase.txnRate);\n\n        const item = value.item;\n        const itmType = item.type || \"\";\n        if (itmType === \"Variant\") {\n          itemSubtotal +=\n            kendo.parseFloat(value.cost) * kendo.parseFloat(value.qty);\n          itemDiscount += kendo.parseFloat(discount);\n        } else if (itmType === \"Service\") {\n          serviceSubtotal +=\n            kendo.parseFloat(value.cost) * kendo.parseFloat(value.qty);\n          serviceDiscount += kendo.parseFloat(discount);\n        } else {\n          txnItmSubtotal +=\n            kendo.parseFloat(value.cost) * kendo.parseFloat(value.qty);\n          txnDiscount += kendo.parseFloat(discount);\n        }\n        if (amt > 0) {\n          nature = \"dr\";\n        } else {\n          nature = \"cr\";\n        }\n        if (item) {\n          if (item.type === \"Service\") {\n            const plan = item.isPan || false;\n            if (plan) {\n              if (item.hasOwnProperty(\"deferredIncomeAcc\")) {\n                if (item.deferredIncomeAcc.hasOwnProperty(\"id\")) {\n                  let deferredInAcc = item.deferredIncomeAcc;\n                  this.jRaw.push({\n                    id: deferredInAcc.id + \"-\" + nature,\n                    line: new ItemLineModel(value),\n                    description: this.purchase.journalNote,\n                    account: deferredInAcc,\n                    accountId: deferredInAcc.id,\n                    amount: itemAmount * -1, // qty*avg_cost ,\n                    exchangeAmount: itemXAmount, //,\n                    type: nature,\n                    typeAs: \"item\",\n                  });\n                }\n              }\n            } else {\n              if (item.hasOwnProperty(\"costOfGoodsSoldAcc\")) {\n                if (item.costOfGoodsSoldAcc.hasOwnProperty(\"id\")) {\n                  let costOfGoodsSoldAcc = item.costOfGoodsSoldAcc;\n                  this.jRaw.push({\n                    id: costOfGoodsSoldAcc.id + \"-\" + nature,\n                    line: new ItemLineModel(value),\n                    description: this.purchase.journalNote,\n                    account: item.costOfGoodsSoldAcc,\n                    accountId: item.costOfGoodsSoldAcc.id,\n                    amount: itemAmount, // qty*avg_cost ,\n                    exchangeAmount: itemXAmount, //xAmount,\n                    type: nature,\n                    typeAs: \"item\",\n                  });\n                }\n              }\n            }\n          } else if (item.type === \"Variant\") {\n            const amountWithAddict = itemAmount + (value.amountApplied || 0);\n            window.console.log(\"additc\", additc, \"-\", itemAmount);\n            if (item.hasOwnProperty(\"inventoryAcc\")) {\n              if (item.inventoryAcc.hasOwnProperty(\"id\")) {\n                let inventoryAcc = item.inventoryAcc;\n                this.jRaw.push({\n                  id: inventoryAcc.id + \"-\" + nature,\n                  line: new ItemLineModel(value),\n                  description: this.purchase.journalNote,\n                  account: item.inventoryAcc,\n                  accountId: item.inventoryAcc.id,\n                  amount: amountWithAddict, // qty*avg_cost ,\n                  exchangeAmount:\n                    amountWithAddict * (this.purchase.txnRate || 1), //xAmount,\n                  type: nature,\n                  typeAs: \"item\",\n                });\n              }\n            }\n          } else if (item.type === \"Fixed Asset\") {\n            if (item.hasOwnProperty(\"assetAcc\")) {\n              if (item.assetAcc.hasOwnProperty(\"id\")) {\n                let assetAcc = item.assetAcc;\n                this.jRaw.push({\n                  id: assetAcc.id + \"-\" + nature,\n                  line: new ItemLineModel(value),\n                  description: this.purchase.journalNote,\n                  account: item.assetAcc,\n                  accountId: item.assetAcc.id,\n                  amount: itemAmount, // qty*avg_cost ,\n                  exchangeAmount: itemXAmount, //xAmount,\n                  type: nature,\n                  typeAs: \"item\",\n                });\n              }\n            }\n          } else if (item.type === \"Transaction Item\") {\n            if (item.hasOwnProperty(\"account\")) {\n              if (item.account.hasOwnProperty(\"id\")) {\n                this.jRaw.push({\n                  id: item.account.id + \"-\" + nature,\n                  line: new ItemLineModel(value),\n                  description: this.purchase.journalNote,\n                  account: item.account,\n                  accountId: item.account.id,\n                  amount: itemAmount, // qty*avg_cost ,\n                  exchangeAmount: itemXAmount, //xAmount,\n                  type: nature,\n                  typeAs: \"item\",\n                });\n              }\n            }\n          }\n        }\n        //include Tax Amount\n        const amountNodiscount =\n          kendo.parseFloat(value.cost) * kendo.parseFloat(value.qty) - discount;\n        const includeTaxAmount =\n          amountNodiscount + vatTax + pltax + spTax + otherTax;\n        value[\"includeTaxAmount\"] = includeTaxAmount;\n        value[\"includeTaxExchangeAmount\"] =\n          includeTaxAmount * kendo.parseFloat(this.purchase.txnRate);\n      });\n      //todo: WithholdingTax expense\n      this.withholdingExpense(whTaxAmount, this.purchase.txnRate || 1);\n\n      this.purchase.itemSubtotal = itemSubtotal;\n      this.purchase.inclusiveTaxAmount = inclusiveTax;\n      this.purchase.exchangeItemSubtotal =\n        itemSubtotal * kendo.parseFloat(this.purchase.txnRate);\n\n      this.purchase.serviceSubtotal = serviceSubtotal;\n      this.purchase.exchangeServiceSubtotal =\n        serviceSubtotal * kendo.parseFloat(this.purchase.txnRate);\n      this.purchase.txnItmSubtotal = txnItmSubtotal;\n      this.purchase.exchangeTxnItmSubtotal =\n        txnItmSubtotal * kendo.parseFloat(this.purchase.txnRate);\n\n      this.purchase.itemDiscount = itemDiscount;\n      this.purchase.exchangeItemDiscount =\n        itemDiscount * kendo.parseFloat(this.purchase.txnRate);\n      this.purchase.serviceDiscount = serviceDiscount;\n      this.purchase.exchangeServiceDiscount =\n        serviceDiscount * kendo.parseFloat(this.purchase.txnRate);\n      this.purchase.txnItmDiscount = txnDiscount;\n      this.purchase.exchangeTxnItmDiscount =\n        txnDiscount * kendo.parseFloat(this.purchase.txnRate);\n\n      let total =\n        kendo.parseFloat(subTotal) -\n        kendo.parseFloat(discountTotal) +\n        kendo.parseFloat(totalTax);\n      this.purchase.subTotal = subTotal;\n      this.purchase.totalTaxAmount = kendo.parseFloat(totalTax);\n      this.purchase.discountTotal = kendo.parseFloat(discountTotal);\n      if (this.purchase.specificDiscountItem) {\n        discountInvoice = this.autoCalculateDiscount(\n          this.purchase.specificDiscountItem,\n          kendo.parseFloat(subTotal)\n        );\n        discountInvoice = discountInvoice ? discountInvoice : 0;\n      }\n      // this.onOtherChargeChange()\n      this.purchase.total =\n        kendo.parseFloat(total) -\n        discountInvoice +\n        kendo.parseFloat(this.purchase.otherChargeAmount); //- parseFloat(withholdingTaxAmount);\n      this.purchase.withholdingTaxAmount = withholdingTaxAmount;\n      // this.purchase.totalAfterWithholdingTax = kendo.parseFloat(this.purchase.total) - parseFloat(withholdingTaxAmount);\n      this.purchase.remainingAmount =\n        kendo.parseFloat(this.purchase.total) -\n        kendo.parseFloat(this.purchase.depositDeduction) -\n        parseFloat(withholdingTaxAmount);\n      this.purchase.amountDue =\n        kendo.parseFloat(this.purchase.total) -\n        kendo.parseFloat(this.purchase.depositDeduction) -\n        parseFloat(withholdingTaxAmount);\n      this.purchase.exchangeAmount =\n        kendo.parseFloat(this.purchase.amountDue) *\n        kendo.parseFloat(this.purchase.txnRate);\n      // window.console.log('Exchange Amount', this.purchase.exchangeAmount, this.purchase.amountDue)\n      this.autoCalculateTaxByType(taxList);\n      if (this.purchase.specificDiscountItem) {\n        const specificDiscount = this.purchase.specificDiscountItem || {};\n        if (specificDiscount.id) {\n          discountItem.push(specificDiscount);\n          discountLine.push({\n            id: specificDiscount.id,\n            name: specificDiscount.name,\n            amount: this.purchase.specificDiscountTotal,\n            exchangeAmount:\n              this.purchase.specificDiscountTotal * this.purchase.txnRate,\n          });\n        }\n      }\n      const uniqueDiscountItem = this.removeDuplicate(discountItem);\n      this.shrinkDiscountItem(uniqueDiscountItem, discountLine);\n      // window.console.log('discount ', this.customerDiscountItem)\n      // todo: raw Journal\n      const apAcc = this.purchase.apAcc || {};\n      if (this.purchase.amountDue * -1 > 0) {\n        nature = \"dr\";\n      } else {\n        nature = \"cr\";\n      }\n      if (apAcc) {\n        if (apAcc.hasOwnProperty(\"id\")) {\n          this.jRaw.push({\n            id: apAcc.id + \"-\" + nature,\n            line: new ItemLineModel({}),\n            description: this.purchase.journalNote,\n            account: apAcc,\n            accountId: apAcc.id,\n            exchangeAmount: this.purchase.exchangeAmount * -1,\n            amount: this.purchase.amountDue * -1,\n            type: nature,\n            typeAs: \"ap\",\n          });\n        }\n      }\n      const specificDisc = this.purchase.specificDiscountItem;\n      if (this.purchase.specificDiscountTotal * -1 > 0) {\n        nature = \"dr\";\n      } else {\n        nature = \"cr\";\n      }\n      // window.console.log(specificDisc, 'specificDisc', this.purchase.specificDiscountTotal)\n      if (specificDisc) {\n        if (specificDisc.hasOwnProperty(\"account\")) {\n          if (specificDisc.account) {\n            if (specificDisc.hasOwnProperty(\"id\")) {\n              this.jRaw.push({\n                id: specificDisc.account.id + \"-\" + nature,\n                line: new ItemLineModel({}),\n                description: \"Purchase Discount\",\n                account: specificDisc.account,\n                accountId: specificDisc.account.id,\n                exchangeAmount:\n                  kendo.parseFloat(this.purchase.specificDiscountTotal) *\n                  kendo.parseFloat(this.purchase.txnRate) *\n                  -1,\n                amount: this.purchase.specificDiscountTotal * -1,\n                type: nature,\n                typeAs: \"discount\",\n              });\n            }\n          }\n        }\n      }\n\n      if (this.purchase.depositDeduction * -1 > 0) {\n        nature = \"dr\";\n      } else {\n        nature = \"cr\";\n      }\n      if (this.purchase.depositDeduction) {\n        if (this.purchase.depositDeduction > 0) {\n          const purchaseDepositAcc = this.vendor.purchaseDepositAcc || {};\n          if (purchaseDepositAcc) {\n            if (purchaseDepositAcc.hasOwnProperty(\"id\")) {\n              this.jRaw.push({\n                id: purchaseDepositAcc.id + \"-\" + nature,\n                description: \"Purchase Deposit\",\n                line: new ItemLineModel({}),\n                account: purchaseDepositAcc,\n                accountId: purchaseDepositAcc.id,\n                exchangeAmount: this.purchase.exchangeDepositDeduction * -1,\n                amount: this.purchase.depositDeduction * -1,\n                type: nature,\n                typeAs: \"deposit\",\n              });\n            }\n          }\n        }\n      }\n      if (this.mOtherCharge.length > 0) {\n        let otherCharge = 0;\n        this.mOtherCharge.forEach((m) => {\n          otherCharge = this.autoCalculateDiscount(m, this.purchase.subTotal);\n          if (otherCharge > 0) {\n            nature = \"dr\";\n          } else {\n            nature = \"cr\";\n          }\n          if (m) {\n            if (m.hasOwnProperty(\"account\")) {\n              if (m.account.hasOwnProperty(\"id\")) {\n                const account = m.account;\n                if (account) {\n                  if (account.hasOwnProperty(\"id\")) {\n                    this.jRaw.push({\n                      id: account.id + \"-\" + nature,\n                      line: new ItemLineModel({}),\n                      description: \"Other Charge\",\n                      account: account,\n                      accountId: account.id,\n                      exchangeAmount:\n                        otherCharge * kendo.parseFloat(this.purchase.txnRate),\n                      amount: otherCharge,\n                      type: nature,\n                      typeAs: \"otherCharge\",\n                    });\n                  }\n                }\n              }\n            }\n          }\n        });\n        // this.purchase.otherChargeAmount = otherCharge\n        window.console.log(this.mOtherCharge);\n      }\n      this.taxListDetail = taxListDetail;\n      this.autoCalculateTaxDetail();\n      // todo: end raw Journal\n      // window.console.log(JSON.stringify(this.purchase), 'purchase')\n\n      await this.calculateAdditionalCost();\n      // todo: cook journal\n      this.shrinkData(this.jRaw);\n      // const unique = this.removeDuplicate(this.accounts)\n      // window.console.log(unique, 'unique')\n    },\n    withholdingExpense(amount, txnRate) {\n      // if (this.isItem()) {\n      if (amount > 0) {\n        const nature = \"dr\";\n        const account = this.accWithholdingExpense || [];\n        if (account.length > 0) {\n          const iacc = account[0];\n          this.jRaw.push({\n            id: iacc.id + \"-\" + nature,\n            line: new ItemLineModel({}),\n            description: \"Withholding Tax Expense\",\n            account: iacc,\n            accountId: iacc.id,\n            exchangeAmount: amount * txnRate,\n            amount: amount,\n            type: nature,\n            typeAs: \"Withholding\",\n          });\n        }\n      }\n      // }\n    },\n    shrinkData(obj) {\n      const uniques =\n        this.removeDuplicate(obj); /*[...new Set(accountId.map(i => {\n                return {\n                    id_: i.id_,\n                    id: i.id,\n                    type: i.type\n            }))]*/\n      uniques.forEach((n) => {\n        const found = obj.filter((m) => m.id === n.id);\n        let amount = 0;\n        found.forEach((z) => {\n          amount += parseFloat(z.amount || 0);\n        });\n        n.amount = parseFloat(amount); //this.numberFormat(amount)\n        n.exchangeAmount = parseFloat(\n          parseFloat(amount * parseFloat(this.purchase.txnRate))\n        ); //this.numberFormat(amount * parseFloat(this.purchase.txnRate)) //.toFixed(this.saleFormContent.decimal)\n      });\n      this.jRaw = uniques;\n      let dr = 0,\n        cr = 0;\n      this.jRaw.forEach((j) => {\n        switch (j.type) {\n          case \"cr\":\n            cr += parseFloat(j.exchangeAmount);\n            break;\n          case \"dr\":\n            dr += parseFloat(j.exchangeAmount);\n            break;\n          default:\n            break;\n        }\n      });\n      this.purchase.dr = dr;\n      this.purchase.cr = cr;\n      window.console.log(\"dr=\", dr, \"cr=\", cr, \"dr+cr = \", dr + cr);\n      window.console.log(JSON.stringify(uniques), \"uniques\");\n    },\n    shrinkDiscountItem(discountItem, discountLine) {\n      let uniqueDiscountItems = [];\n      const unique = this.removeDuplicate(discountItem);\n      unique.forEach((m) => {\n        const found = discountLine.filter((n) => n.id === m.id);\n        let amount = 0,\n          exchangeAmount = 0;\n        found.map((o) => {\n          amount += o.amount;\n        });\n        found.map((o) => {\n          exchangeAmount += o.exchangeAmount;\n        });\n        uniqueDiscountItems.push({\n          id: m.id,\n          name: m.name,\n          amount: amount,\n          exchangeAmount: exchangeAmount,\n        });\n      });\n      this.supplierDiscountItem = uniqueDiscountItems;\n      window.console.log(uniqueDiscountItems, \"uniqueDiscountItems\");\n    },\n    removeDuplicate(array) {\n      const result = [];\n      const map = new Map();\n      for (const item of array) {\n        if (!map.has(item.id)) {\n          map.set(item.id, true); // set any value to Map\n          result.push(item);\n        }\n      }\n      return result;\n    },\n    numberFormat(value) {\n      // window.console.log(this.saleFormContent.decimal,'nimol')\n      return kendo.toString(value, `n${this.purchaseFormContent.decimal}`);\n    },\n    autoCalculateDiscount(discountItem, subTotal) {\n      if (discountItem) {\n        const nature = discountItem.nature || \"\";\n        const amount = discountItem.amount || 0;\n        if (nature === \"Amount\") {\n          return parseFloat(amount);\n        } else if (nature === \"Percentage\") {\n          return subTotal * (parseFloat(amount) / 100);\n        } else {\n          return 0;\n        }\n      } else {\n        return 0;\n      }\n    },\n    autoCalculateTax(tax, amount) {\n      if (tax) {\n        var formula = tax.formula;\n        var inAmt = kendo.parseFloat(amount);\n        var nAmt = kendo.parseFloat(amount);\n        var taxBase = kendo.parseFloat(tax.taxBase) / 100;\n        var rate = kendo.parseFloat(tax.rate) / 100;\n        var total = eval(formula);\n        window.console.log(inAmt, nAmt, taxBase, rate, formula, total);\n        return total;\n      }\n      // return 0\n    },\n    taxMapping(objTax, tax) {\n      const taxId = tax.id || \"\";\n      const tax_ = objTax.filter((t) => t.id === taxId)[0];\n      return (\n        tax_ || {\n          id: \"\",\n          defaultTax: \"\",\n        }\n      );\n    },\n    dataSourceChanged(e) {\n      if (e.field) {\n        let dataRow = e.items[0],\n          buom = {},\n          vTax = {},\n          conversionRate = 1,\n          wac = 0,\n          qoh = 0,\n          amount = 0,\n          xAmount = 0;\n        switch (e.field) {\n          case \"item\":\n            // this.attribute_ = this.attributes.filter(m => m.type.id === dataRow.variant.id)\n            dataRow.set(\"description\", dataRow.item.description);\n            buom = dataRow.item.uom || {};\n            dataRow.set(\"buom\", buom);\n            // dataRow.set('uom', buom)\n            // window.console.log(dataRow.item,'row')\n            // await this.inventoryBalance(dataRow, dataRow.item.id)\n            break;\n          case \"cost\":\n            try {\n              amount = parseFloat(dataRow.cost) * parseFloat(dataRow.qty);\n              xAmount = amount * parseFloat(this.purchase.txnRate);\n\n              dataRow.set(\"cost\", parseFloat(dataRow.cost));\n              dataRow.set(\"amount\", amount);\n              dataRow.set(\"exchangeAmount\", xAmount);\n              // window.console.log('price',dataRow.price)\n            } catch {\n              dataRow.set(\"cost\", 0);\n              dataRow.set(\"amount\", 0);\n              dataRow.set(\"exchangeAmount\", 0);\n            }\n            break;\n          case \"uom\":\n            if (this.isPriceLevelChanged === false) {\n              try {\n                if (dataRow.uom) {\n                  buom = dataRow.uom.buom || {};\n                  qoh = dataRow.uom.qoh || 0;\n                  conversionRate = dataRow.uom.conversionRate || 1;\n                  wac = dataRow.uom.wac || 0;\n                  dataRow.set(\"buom\", buom);\n                  dataRow.set(\"wac\", wac);\n                  dataRow.set(\"qoh\", qoh);\n                  /* todo: mapping tax object */\n                  vTax = this.taxMapping(\n                    this.tax,\n                    dataRow.uom.purchaseTax || {}\n                  );\n\n                  dataRow.set(\"vatTax\", vTax);\n                  dataRow.set(\"conversionRate\", parseFloat(conversionRate));\n                  if (dataRow.uom) {\n                    amount =\n                      parseFloat(dataRow.uom.cost) * parseFloat(dataRow.qty);\n                    xAmount = amount * parseFloat(this.purchase.txnRate);\n\n                    dataRow.set(\"cost\", parseFloat(dataRow.uom.cost));\n                    dataRow.set(\"amount\", amount);\n                    dataRow.set(\"exchangeAmount\", xAmount);\n                  } else {\n                    amount = parseFloat(dataRow.cost) * parseFloat(dataRow.qty);\n                    xAmount = amount * parseFloat(this.purchase.txnRate);\n\n                    dataRow.set(\"cost\", parseFloat(dataRow.cost));\n                    dataRow.set(\"amount\", amount);\n                    dataRow.set(\"exchangeAmount\", xAmount);\n                  }\n                }\n              } catch (err) {\n                window.console.log(\"error\", err);\n                dataRow.set(\"buom\", {});\n                dataRow.set(\"conversionRate\", 1);\n                dataRow.set(\"cost\", 0);\n                dataRow.set(\"qoh\", 0);\n                dataRow.set(\"wac\", 0);\n                dataRow.set(\"amount\", 0);\n                dataRow.set(\"exchangeAmount\", 0);\n              }\n            }\n            break;\n          case \"qty\":\n            try {\n              amount = parseFloat(dataRow.cost) * parseFloat(dataRow.qty);\n              xAmount = amount * parseFloat(this.purchase.txnRate);\n\n              dataRow.set(\"cost\", parseFloat(dataRow.cost));\n              dataRow.set(\"amount\", amount);\n              dataRow.set(\"exchangeAmount\", xAmount);\n            } catch {\n              dataRow.set(\"cost\", 0);\n              dataRow.set(\"amount\", 0);\n              dataRow.set(\"exchangeAmount\", 0);\n            }\n            break;\n          case \"otherTax\":\n            // window.console.log(\"--\", dataRow)\n            break;\n          default:\n            break;\n        }\n        if (e.field) {\n          this.autoCalculate();\n          window.console.log(\"dataRow\", dataRow);\n        }\n      }\n    },\n    ServiceDateEditor(container, options) {\n      kendo\n        .jQuery('<input required name=\"' + options.field + '\"/>')\n        .appendTo(container)\n        .kendoDatePicker();\n\n      // let ds = this.$refs.itemLineDS.kendoWidget()\n      // window.console.log(ds.data())\n      // // const dateString = kendo.toString((new Date(options.model.items.serviceDate)), this.itemLine.dateFormat)\n      // // const dateString = kendo.toString(options.model.items.serviceDate)\n      // const $input = $(\"<input value=\" + options.model.serviceDate + \" />\").appendTo(container)\n      // $input.kendoDatePicker()\n      // // $input.appendTo(container)\n      // // options.model.items.serviceDate = dateString\n      // window.console.log($input)\n    },\n    ServiceDateToEditor(container, options) {\n      kendo\n        .jQuery('<input required name=\"' + options.field + '\"/>')\n        .appendTo(container)\n        .kendoDatePicker();\n    },\n    ItemDropDownEditor(container, options) {\n      kendo\n        .jQuery('<input name=\"' + options.field + '\"/>')\n        .appendTo(container)\n        .kendoDropDownList({\n          autoBind: true,\n          autoWidth: true,\n          height: 400,\n          filter: \"contains\",\n          dataTextField: \"name\",\n          dataValueField: \"id\",\n          headerTemplate:\n            '<div class=\"dropdown-header k-widget k-header\">' +\n            \"<span>Items </span>\" +\n            \"<span></span>\" +\n            \"</div>\",\n          template: \"<span>#=name#</span>\",\n          optionLabel: \"--- Select ---\",\n          dataSource: new kendo.data.DataSource({\n            serverFiltering: true,\n            transport: {\n              read: {\n                url: productVariantHandler.itemSearchURL(),\n              },\n              dataType: \"json\",\n            },\n            schema: {\n              model: {\n                id: \"id\",\n                fields: {\n                  id: { type: \"string\" },\n                  name: { type: \"string\" },\n                  sku: { type: \"string\" },\n                },\n              },\n              data: function (response) {\n                return response.data;\n              },\n              total: function (response) {\n                return response.data.count;\n              },\n            },\n            // data: this.variants\n          }),\n        });\n    },\n    UOMDropDownEditor(container, options) {\n      kendo\n        .jQuery('<input name=\"' + options.field + '\"/>')\n        .appendTo(container)\n        .kendoDropDownList({\n          autoBind: true,\n          autoWidth: true,\n          height: 400,\n          filter: \"startswith\",\n          dataTextField: \"code\",\n          dataValueField: \"uomConvertId\",\n          cascadeFrom: \"item\",\n          template: \"<span>#=code || ``#</span>\",\n          optionLabel: \"--- Select ---\",\n          dataSource: new kendo.data.DataSource({\n            serverFiltering: true,\n            transport: {\n              read: {\n                url: uomPriceHandler.uomPriceByPriceLevelURL(\n                  \"id=\" +\n                    options.model.item.id +\n                    \"&plId=\" +\n                    this.purchase.priceLevel.id +\n                    \"&date=\" +\n                    this.txnDate +\n                    \"&nature=purchase\"\n                ),\n              },\n              dataType: \"json\",\n            },\n            schema: {\n              model: {\n                id: \"id\",\n                fields: {\n                  id: { type: \"string\" },\n                  // name: {type: \"string\"},\n                  // sku: {type: \"string\"},\n                },\n              },\n              data: function (response) {\n                return response.data;\n              },\n              total: function (response) {\n                return response.data.count;\n              },\n            },\n            // data: this.variants\n          }),\n        });\n    },\n    DiscountItemDropDownEditor(container, options) {\n      kendo\n        .jQuery('<input name=\"' + options.field + '\"/>')\n        .appendTo(container)\n        .kendoDropDownList({\n          autoBind: true,\n          autoWidth: true,\n          height: 400,\n          filter: \"startswith\",\n          dataTextField: \"name\",\n          dataValueField: \"id\",\n          cascadeFrom: \"item\",\n          template: \"<span>#=code# - #=name#</span>\",\n          optionLabel: \"--- Select ---\",\n          dataSource: new kendo.data.DataSource({\n            serverFiltering: true,\n            transport: {\n              read: {\n                url: discountItemHandler.getURL(DISCOUNT_TYPE),\n              },\n              dataType: \"json\",\n            },\n            schema: {\n              model: {\n                id: \"id\",\n                fields: {\n                  id: { type: \"string\" },\n                  // name: {type: \"string\"},\n                  // sku: {type: \"string\"},\n                },\n              },\n              data: function (response) {\n                return response.data;\n              },\n              total: function (response) {\n                return response.data.count;\n              },\n            },\n          }),\n        });\n    },\n    VatTaxDropDownEditor(container, options) {\n      kendo\n        .jQuery('<input name=\"' + options.field + '\"/>')\n        .appendTo(container)\n        .kendoDropDownList({\n          autoBind: true,\n          autoWidth: true,\n          height: 400,\n          filter: \"startswith\",\n          dataTextField: \"defaultTax\",\n          dataValueField: \"id\",\n          template: \"<span>#=defaultTax#</span>\",\n          optionLabel: \"--Select--\",\n          dataSource: new kendo.data.DataSource({\n            data: this.tax,\n          }),\n        });\n    },\n    EmployeeDropDownEditor(container, options) {\n      kendo\n        .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n        .appendTo(container)\n        .kendoMultiSelect({\n          autoBind: true,\n          autoWidth: true,\n          height: 400,\n          suggest: true,\n          filter: \"contains\",\n          dataTextField: \"name\",\n          dataValueField: \"id\",\n          headerTemplate:\n            '<div class=\"dropdown-header k-widget k-header\">' +\n            \"<span>Employee </span>\" +\n            \"<span></span>\" +\n            \"</div>\",\n          template: \"<span>#=name#</span>\",\n          optionLabel: \"--- Select ---\",\n          dataSource: new kendo.data.DataSource({\n            serverFiltering: true,\n            transport: {\n              read: {\n                url: employeeHandler.searchURL(),\n              },\n              dataType: \"json\",\n            },\n            schema: {\n              model: {\n                id: \"id\",\n                fields: {\n                  id: { type: \"string\" },\n                  name: { type: \"string\" },\n                  firstName: { type: \"string\" },\n                  lastName: { type: \"string\" },\n                },\n              },\n              data: function (response) {\n                return response.data;\n              },\n              total: function (response) {\n                return response.data.count;\n              },\n            },\n          }),\n        });\n    },\n    rowNumberTmpl(dataItem) {\n      let ds = this.$refs.itemLineDS.kendoWidget(),\n        index = ds.indexOf(dataItem);\n      return index + 1;\n    },\n    addRow() {\n      let ds = this.$refs.itemLineDS.kendoWidget(),\n        total = ds.total();\n      this.itemLine.id = itemLinePrefix + uuid.v1();\n      this.itemLine.decimalFormat = \"n\" + this.purchaseFormContent.decimal;\n      this.itemLine.isEditable = true;\n      ds.insert(total, this.itemLine);\n\n      // kendo.jQuery().addClass('edit')\n      // this.itemLines.push(this.itemLine)\n      // window.console.log('item Line', this.itemLine)\n    },\n    onPaymentTermChanged() {\n      // this.onInvoiceDateChanged();\n      if (this.vendor) {\n        const paymentTerm = this.purchase.paymentTerm || {};\n        const netDue = paymentTerm.netDue || 0;\n        const someDate = new Date(this.purchase.transactionDate);\n        someDate.setDate(someDate.getDate() + parseInt(netDue)); //number  of days to add, e.x. 15 days\n        this.purchase.dueDate = someDate;\n        // window.console.log(\"im\", someDate, netDue);\n      }\n    },\n    async onInvoiceDateChanged() {\n      await this.loadPaymentTermList();\n      await this.loadCreditLimit();\n      await this.loadCustomerBalance(this.vendor.id);\n      await this.onPriceLevelChange();\n\n      this.monthOf = kendo.toString(new Date(this.txnDate), \"yyyy-MM\");\n      // if (this.vendor) {\n      //     if (this.purchase.hasOwnProperty(\"paymentTerm\")) {\n      //         if (this.purchase.paymentTerm.hasOwnProperty(\"netDue\")) {\n      //             const netDue = this.purchase.paymentTerm.netDue;\n      //             const someDate = new Date(this.txnDate);\n      //             someDate.setDate(someDate.getDate() + parseInt(netDue)); //number  of days to add, e.x. 15 days\n      //             this.purchase.dueDate = someDate.toISOString().substr(0, 10);\n      //             // window.console.log('im', someDate, netDue)\n      //         }\n      //     }\n      // }\n      if (this.$route.params.id === undefined) {\n        this.generateNumber();\n      }\n      this.loadTransactionRate();\n    },\n    async loadPrefix() {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          prefixHandler.get(\"purchase\").then((res) => {\n            if (res.data.statusCode === 200) {\n              this.showLoading = false;\n              this.purchaseTypes = res.data.data;\n              if (this.purchaseTypes.length > 0) {\n                this.purchase.transactionType = this.purchaseTypes[0];\n                if (this.$route.params.id === undefined) {\n                  this.generateNumber();\n                }\n              }\n            }\n          });\n        }, 10);\n      });\n    },\n    async loadPriceLevel() {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          const strFilter = \"?&nature=\" + NATURE;\n          priceLevelHandler.get(strFilter).then((res) => {\n            this.priceLevel = res;\n            if (this.priceLevel.length > 0) {\n              this.purchase.priceLevel = this.priceLevel[0];\n            }\n          });\n        }, 10);\n      });\n    },\n    async loadDiscountItem() {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          discountItemHandler.list(DISCOUNT_TYPE).then((res) => {\n            if (res.data.statusCode === 200) {\n              this.specificDiscountItem = res.data.data;\n            }\n          });\n        }, 10);\n      });\n    },\n    async loadOtherCharge() {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          otherChargeHandler.list().then((res) => {\n            if (res.data.statusCode === 200) {\n              this.otherChargeList = res.data.data;\n            }\n          });\n        }, 10);\n      });\n    },\n    async loadAccount() {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          accountHandler.getAll().then((res) => {\n            this.showLoading = false;\n            //Receivable Account\n            this.accPayable = res.data\n              .filter((m) => m.account_type.number === 18)\n              .map((itm) => {\n                return {\n                  id: itm.uuid,\n                  uuid: itm.uuid,\n                  name: itm.name,\n                  local_name: itm.local_name,\n                  number: itm.number,\n                  is_taxable: itm.is_taxable,\n                  banhjiAccCode: itm.banhjiAccCode,\n                  group_code: itm.group_code,\n                  parent_account: itm.parent_account,\n                  type_code: itm.type_code,\n                  account_type: itm.account_type,\n                };\n              });\n            if (this.accPayable.length > 0) {\n              this.purchase.apAcc = this.accPayable[0];\n            }\n            this.accWithholdingExpense = res.data\n              .filter((m) => parseInt(m.banhjiAccCode) === 843000)\n              .map((itm) => {\n                return {\n                  id: itm.uuid,\n                  uuid: itm.uuid,\n                  name: itm.name,\n                  local_name: itm.local_name,\n                  number: itm.number,\n                  is_taxable: itm.is_taxable,\n                  banhjiAccCode: itm.banhjiAccCode,\n                  group_code: itm.group_code,\n                  parent_account: itm.parent_account,\n                  type_code: itm.type_code,\n                  account_type: itm.account_type,\n                };\n              });\n          });\n        }, 10);\n      });\n    },\n    async loadPaymentTerm() {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          const strFilter = \"?type=pmt-supplier\";\n          this.paymentTerms = [];\n          settingsHandler.getPaymentTerm(strFilter).then((res) => {\n            this.showLoading = false;\n            this.paymentTerms = res.data.data;\n            if (this.paymentTerms.length > 0) {\n              this.purchase.paymentTerm = this.paymentTerms[0];\n            }\n          });\n        }, 10);\n      });\n    },\n    async loadLocation() {\n      this.locations = [];\n      const roleType = dataStore.roleType || 0;\n      window.console.log(\n        \" const roleType = dataStore.roleType || 0\",\n        dataStore\n      );\n      if (roleType === 0) {\n        if (dataStore.roleData) {\n          const roleData = dataStore.roleData || [];\n          const location = roleData.filter((itm) => itm.type === \"location\");\n          const locationDefault = location.filter((m) => m.isDefault === 1);\n          this.locations = location;\n          if (\n            this.$route.params.id === undefined ||\n            this.$route.params.id === \"\"\n          ) {\n            if (locationDefault.length > 0) {\n              this.purchase.location = locationDefault[0];\n            }\n          }\n        }\n      } else if (roleType === 1) {\n        new Promise((resolve) => {\n          setTimeout(() => {\n            resolve(\"resolved\");\n            this.locations = [];\n            locationHandler.list().then((res) => {\n              if (res.data.statusCode === 200) {\n                this.locations = res.data.data;\n                if (this.locations.length > 0) {\n                  this.purchase.location = this.locations[0];\n                }\n              } else {\n                this.showLoading = false;\n              }\n            });\n          }, 10);\n        });\n      }\n    },\n    async loadProjectByCustomer() {\n      this.customerProjects = [];\n      const roleType = dataStore.roleType || 0;\n      if (roleType === 0) {\n        if (dataStore.roleData) {\n          const roleData = dataStore.roleData || [];\n          const project = roleData.filter((itm) => itm.type === \"project\");\n          this.customerProjects = project;\n          // project.forEach(k => {\n          //     const customers = k.customers || []\n          //     const proCustomer = customers.filter(n => n.customer.id === this.customer.id)\n          //     if (proCustomer.length > 0) {\n          //         this.customerProjects.push(k)\n          //     }\n          // })\n          if (\n            this.$route.params.id === undefined ||\n            this.$route.params.id === \"\"\n          ) {\n            const projectDefault = this.customerProjects.filter(\n              (m) => m.isDefault === 1\n            );\n            if (projectDefault.length > 0) {\n              this.purchase.project = projectDefault[0];\n            }\n          }\n        }\n      } else if (roleType === 1) {\n        new Promise((resolve) => {\n          setTimeout(() => {\n            resolve(\"resolved\");\n            if (this.vendor) {\n              // projectHandler.getBySupplier(this.vendor.id).then(res => {\n              projectHandler.list().then((res) => {\n                if (res.data.statusCode === 200) {\n                  this.showLoading = false;\n                  this.customerProjects = res.data.data;\n                  // if (this.customerProjects.length > 0) {\n                  //     this.purchase.project = this.customerProjects[0];\n                  // }\n                } else {\n                  this.showLoading = false;\n                }\n              });\n            }\n          }, 10);\n        });\n      }\n    },\n    async loadCustomerBalance(id) {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          const strFilter = id + \"?type=bal\";\n          this.purchase.currentBalance = 0;\n          billingHandler\n            .balance(strFilter)\n            .then((res) => {\n              if (res.data.statusCode === 200) {\n                const data = res.data.data;\n                if (data.length > 0) {\n                  this.purchase.currentBalance = data[0].balance;\n                }\n              }\n            })\n            .catch();\n          {\n            this.showLoading = false;\n          }\n        }, 10);\n      });\n    },\n    async loadCustomerDepositBalance(id) {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          const strFilter = id + \"?type=dep\";\n          this.purchase.depositAmount = 0;\n          this.purchase.depositDeduction = 0;\n          billingHandler\n            .balance(strFilter)\n            .then((res) => {\n              if (res.data.statusCode === 200) {\n                const data = res.data.data;\n                if (data.length > 0) {\n                  const amountDeposit = data[0].balance;\n                  window.console.log(amountDeposit, \"bala\");\n                  this.purchase.depositAmount =\n                    amountDeposit / this.purchase.txnRate;\n                }\n              }\n            })\n            .catch();\n          {\n            this.showLoading = false;\n          }\n        }, 10);\n      });\n    },\n    creditLimitUsage(balance, creditLimit) {\n      return (\n        kendo.toString(\n          (balance / creditLimit) * 100,\n          `n${this.purchaseFormContent.decimal}`\n        ) + \" %\"\n      );\n    },\n    async loadEmployeeCenter() {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          this.employees = [];\n          employeeHandler\n            .center(undefined)\n            .then((res) => {\n              this.showLoading = true;\n              if (res.data.statusCode === 200) {\n                this.showLoading = false;\n                this.employees = res.data.data;\n                if (this.employees.length > 0) {\n                  this.purchase.employee = this.employees[0];\n                }\n              }\n            })\n            .catch();\n          {\n            this.showLoading = false;\n          }\n        }, 10);\n      });\n    },\n    async loadSegment() {\n      this.segments = [];\n      const roleType = dataStore.roleType || 0;\n      if (roleType === 0) {\n        if (dataStore.roleData) {\n          const roleData = dataStore.roleData || [];\n          const segment = roleData.filter((itm) => itm.type === \"segment\");\n          const segmentDefault = segment.filter((m) => m.isDefault === 1);\n          this.segments = segment;\n          if (\n            this.$route.params.id === undefined ||\n            this.$route.params.id === \"\"\n          ) {\n            if (segmentDefault.length > 0) {\n              this.purchase.segment = segmentDefault[0];\n              window.console.log(\"dataStore--segmentDefault\", segmentDefault);\n            }\n          }\n        }\n      } else if (roleType === 1) {\n        new Promise((resolve) => {\n          setTimeout(() => {\n            resolve(\"resolved\");\n            this.segments = [];\n            settingsHandler.getSeg().then((res) => {\n              if (res.data.statusCode === 200) {\n                this.segments = res.data.data;\n                if (this.segments.length > 0) {\n                  this.purchase.segment = this.segments[0];\n                }\n              }\n            });\n          }, 10);\n        });\n      }\n    },\n    async loadTax() {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          settingHandler.get().then((res) => {\n            const taxes = res;\n            this.tax = taxes.filter(\n              (m) =>\n                (m.taxType.typeId === 1 ||\n                  m.taxType.typeId === 10 ||\n                  m.taxType.typeId === 2) &&\n                m.transactionType === \"Purchase\"\n            ); // valuable tax\n          });\n        }, 10);\n      });\n    },\n    async onSaveClose(saveSend) {\n      if (!this.$refs.form.validate()) {\n        this.$refs.form.validate();\n        return;\n      }\n      if (this.transactionRate === 0) {\n        this.$snotify.error(i18n.t(\"set_exchange_rate\"));\n        return;\n      }\n\n      let id = \"\";\n      if (this.vendor.hasOwnProperty(\"id\")) {\n        id = this.vendor.id || \"\";\n      }\n      if (id === \"\") {\n        this.$snotify.error(\"vendor is required\");\n        return;\n      }\n      if (this.purchase.billNo == \"\") {\n        this.$snotify.error(\"Vendor Invoice No is required\");\n        return;\n      }\n      if (!this.$refs.form.validate()) {\n        this.$refs.form.validate();\n        return;\n      }\n      let ds = this.$refs.itemLineDS.kendoWidget();\n      let d1 = ds.data();\n      let dataValidate = 0;\n      await this.autoCalculate();\n      d1.forEach((value, index) => {\n        if (\n          value.item == undefined ||\n          value.item.id == undefined ||\n          value.item.id == null ||\n          value.uom == undefined ||\n          value.uom.uom.id == undefined ||\n          value.uom.uom.id == null\n        ) {\n          this.$snotify.error(\n            \"Please check Item or UOM  on row \" + (index + 1)\n          );\n        } else {\n          dataValidate += 1;\n        }\n      });\n      if (d1.length == dataValidate) {\n        new Promise((resolve) => {\n          setTimeout(() => {\n            resolve(\"resolved\");\n            let isAutoGenerate = 1;\n            if (this.$route.params.id) {\n              const tranDate = new Date(this.txnDate);\n              const tranDateInvoice = new Date(this.purchase.transactionDate);\n              const tranDateM = tranDate.getFullYear() + tranDate.getMonth();\n              const tranDateInvoiceM =\n                tranDateInvoice.getFullYear() + tranDateInvoice.getMonth();\n              if (tranDateM === tranDateInvoiceM) {\n                isAutoGenerate = 0;\n              }\n            }\n\n            let itemLineDS = this.$refs.itemLineDS.kendoWidget();\n            const dataRow = itemLineDS\n              .data()\n              .filter((o) => o.amount > 0)\n              .map((n) => {\n                return new ItemLineModel(n);\n              });\n            if (dataRow.length > 0) {\n              let data = {\n                id: this.purchase.id ? this.purchase.id : \"\",\n                uuid: this.purchase.uuid ? this.purchase.uuid : \"\",\n                journal_uuid: this.purchase.journal_uuid\n                  ? this.purchase.journal_uuid\n                  : \"\",\n                jRaw: this.jRaw,\n                type: TRANSACTION_TYPE,\n                number: this.purchase.number,\n                abbr: this.purchase.transactionType.abbr,\n                transactionDate: this.txnDate,\n                transactionDateTZ: Helper.toISODate(this.txnDate),\n                dueDate: this.purchase.dueDate,\n                monthOf: this.monthOf,\n                paymentCode: this.purchase.paymentCode,\n                billNo: this.purchase.billNo,\n                billDate: this.billDate,\n                supplier: this.purchase.supplier,\n                transactionType: this.purchase.transactionType,\n                paymentTerm: this.purchase.paymentTerm,\n                discountPromotion: {},\n                apAcc: this.purchase.apAcc,\n                currency: this.purchase.currency,\n                txnRate: this.purchase.txnRate,\n                rate: 1,\n                exchangeRate: this.purchase.exchangeRate,\n                exchangeAmount: this.purchase.exchangeAmount,\n                priceLevel: this.purchase.priceLevel,\n                itemLines: dataRow,\n                segment: this.purchase.segment,\n                location: this.purchase.location,\n                project: this.purchase.project,\n                employee: this.purchase.employee,\n                billingAddress: this.purchase.billingAddress,\n                deliveryAddress: this.purchase.deliveryAddress,\n                deliveryDateTime: this.purchase.deliveryDateTime,\n                transactionNote: this.purchase.transactionNote,\n                journalNote: this.purchase.journalNote,\n                subTotal: this.purchase.subTotal,\n                total: this.purchase.total,\n                discountTotal: this.purchase.discountTotal,\n                exchangeDiscountTotal:\n                  this.purchase.discountTotal * (this.purchase.txnRate || 1),\n                specificDiscountTotal: this.purchase.specificDiscountTotal,\n                deliveryFee: this.purchase.deliveryFee,\n                totalTaxAmount: this.purchase.totalTaxAmount,\n                depositAmount: this.purchase.depositAmount,\n                depositDeduction: this.purchase.depositDeduction,\n                remainingAmount: this.purchase.remainingAmount,\n                amountDue: this.purchase.amountDue,\n                currentBalance: this.purchase.currentBalance,\n                balance: this.purchase.balance,\n                creditLimit: this.purchase.creditLimit,\n                saveOption: this.purchase.saveOption,\n                status: 1,\n                approvedBy: this.purchase.approvedBy,\n                formTemplate: {},\n                specificDiscountItem: this.purchase.specificDiscountItem,\n                otherCharge: this.mOtherCharge,\n                otherChargeAmount: this.purchase.otherChargeAmount,\n                taxListTotal: this.taxListTotal,\n                supplierDiscountItem: this.supplierDiscountItem,\n                createdAt: this.purchase.createdAt,\n                itemSubtotal: this.purchase.itemSubtotal,\n                exchangeItemSubtotal: this.purchase.exchangeItemSubtotal,\n                serviceSubtotal: this.purchase.serviceSubtotal,\n                exchangeServiceSubtotal: this.purchase.exchangeServiceSubtotal,\n                txnItmSubtotal: this.purchase.txnItmSubtotal,\n                exchangeTxnItmSubtotal: this.purchase.exchangeTxnItmSubtotal,\n                itemDiscount: this.purchase.itemDiscount,\n                exchangeItemDiscount: this.purchase.exchangeItemDiscount,\n                serviceDiscount: this.purchase.serviceDiscount,\n                exchangeServiceDiscount: this.purchase.exchangeServiceDiscount,\n                txnItmDiscount: this.purchase.txnItmDiscount,\n                exchangeTxnItmDiscount: this.purchase.exchangeTxnItmDiscount,\n                withholdingTaxAmount: this.purchase.withholdingTaxAmount || 0,\n                inclusiveTaxAmount: this.purchase.inclusiveTaxAmount || 0,\n                loggedUser: this.loggedUser,\n                saveSend: saveSend,\n                refFrom: this.purchase.refFrom || [],\n                refTo: this.purchase.refTo || [],\n                saleTaxDetail: this.purchase.saleTaxDetail || [],\n                hasAdditionalCost: this.purchase.additionalCost.length > 0,\n                additionalCost: this.purchase.additionalCost || [],\n                additionalCostMethod: this.purchase.additionalCostMethod || \"\",\n                additionalCostTotal: this.additionalCostTotal || 0,\n                isAutoGenerate: isAutoGenerate,\n                actionType: this.$route.params.id\n                  ? this.$route.query.type\n                  : \"new\",\n              };\n              if (this.$route.query.type === \"recurring\") {\n                data.id = \"\";\n              }\n              this.showLoading = true;\n              billingHandler\n                .createPurchase(data)\n                .then((response) => {\n                  if (response.data.statusCode === 201) {\n                    // this.close(response.data.data)\n                    // this.$refs.form.reset()\n                    this.showLoading = false;\n                    this.$snotify.success(\"Successfully\");\n                    if (saveSend === true) {\n                      this.clear();\n                    } else {\n                      this.close(response.data.data);\n                    }\n                  }\n                })\n                .catch((e) => {\n                  this.showLoading = false;\n                  this.$snotify.error(\"Something went wrong\");\n                  this.errors.push(e);\n                });\n            }\n          }, 50);\n        });\n      }\n    },\n    async loadPurchaseFormContent() {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          purchaseFormContentHandler.list().then((res) => {\n            if (res.data.statusCode === 200) {\n              const data = res.data.data;\n              if (data.length > 0) {\n                this.purchaseFormContent = data[0];\n                this.decimalFormat = \"n\" + this.purchaseFormContent.decimal;\n                this.initData();\n              }\n            }\n          });\n        }, 50);\n      });\n    },\n    close(data) {\n      if (this.$route.params.id === undefined) {\n        this.$router.push({\n          name: \"Vendors\",\n          params: {\n            data: data,\n          },\n        });\n      } else {\n        window.history.go(-1);\n        // this.$router.push({\n        //     path: \"invoice_view\",\n        //     name: \"Invoice View\",\n        //     params: {\n        //         data: data,\n        //     }\n        // })\n      }\n      // window.console.log(data, 'data')\n    },\n    saveNew() {},\n    removeRow(e) {\n      e.preventDefault();\n      const grid = kendo.jQuery(\"#gridItemLine\").data(\"kendoGrid\"),\n        dataSource = grid.dataSource,\n        dataItem = grid.dataItem($(e.currentTarget).closest(\"tr\"));\n\n      if (dataSource.total() > 1) {\n        dataSource.remove(dataItem);\n        this.autoCalculate();\n      }\n    },\n    generateNumber() {\n      if (this.$route.params.id) {\n        const tranDate = new Date(this.txnDate);\n        const tranDateInvoice = new Date(this.purchase.transactionDate);\n        const tranDateM = tranDate.getFullYear() + tranDate.getMonth();\n        const tranDateInvoiceM =\n          tranDateInvoice.getFullYear() + tranDateInvoice.getMonth();\n        if (tranDateM === tranDateInvoiceM) {\n          this.purchase.referenceNo = this.referenceNo;\n          return;\n        }\n      }\n\n      if (this.txnDate !== \"\" && this.purchaseTypes.length > 0) {\n        let data = {\n          abbr: this.purchase.transactionType.abbr,\n          structure: this.purchase.transactionType.structure,\n          transactionDate: this.txnDate,\n          sequcencing: this.purchase.transactionType.sequcencing,\n          type: \"Purchase\",\n          entity: 1,\n        };\n        billingHandler\n          .lastNumber(data)\n          .then((response) => {\n            if (response.data.statusCode === 200) {\n              const res = response.data.data;\n              const lastNumber = this.zeroPad(\n                parseInt(res.lastNumber),\n                this.purchase.transactionType.format\n              );\n              const number =\n                res.suffix +\n                this.purchase.transactionType.numberSeparator +\n                lastNumber;\n              this.purchase.number = number;\n            }\n          })\n          .catch((e) => {\n            this.errors.push(e);\n          });\n      }\n    },\n    zeroPad(num, places) {\n      return String(num).padStart(places, \"0\");\n    },\n    suffix(transactionDate) {\n      return kendo.toString(new Date(transactionDate), `yymm`);\n    },\n    errorMessage() {},\n    accountDropDownEditor() {},\n    cancel() {\n      this.$swal({\n        title: i18n.t(\"msg_title_warning\"),\n        text: i18n.t(\"msg_discard\"),\n        icon: \"warning\",\n        showCancelButton: true,\n        cancelButtonText: i18n.t(\"cancel\"),\n        confirmButtonColor: \"#4d4848\",\n        cancelButtonColor: \"#ED1A3A\",\n        confirmButtonText: i18n.t(\"discard\"),\n      }).then((resultCen) => {\n        window.console.log(resultCen);\n        if (resultCen.value) {\n          this.$destroy();\n          this.$router.go(-1);\n        }\n      });\n    },\n    hideSmallSidebar() {\n      this.isHideBar = !this.isHideBar;\n    },\n    requestData(skip, filter, baseUrl) {\n      const url = baseUrl + `?filter=${filter}`;\n      this.requestStarted = true;\n      fetch(url)\n        .then((response) => {\n          return response.json();\n        })\n        .then(this.afterFetch);\n    },\n    requestData_(skip, filter, baseUrl) {\n      const url = baseUrl + `/${filter}`;\n      this.requestStarted = true;\n      fetch(url)\n        .then((response) => {\n          return response.json();\n        })\n        .then(this.afterFetch_);\n    },\n    onChange(event) {\n      const value = event.value;\n      if (value && value[textField] === emptyItem[textField]) {\n        return;\n      }\n      this.vendor = value;\n      this.purchase.supplier = value;\n      // window.console.log(this.purchase.customer, 'Changed')\n      // this.invoice = value\n      this.purchase.apAcc = value.hasOwnProperty(\"apAcc\") ? value.apAcc : {};\n      this.purchase.paymentTerm = value.paymentTerm || {};\n      this.purchase.priceLevel = value.priceLevel || {};\n      const baseCurrency = value.baseCurrency || {};\n      if (baseCurrency.hasOwnProperty(\"code\")) {\n        this.baseCurrencyCode = \" \" + baseCurrency.code;\n      }\n      // this.loadTransactionRate();\n      this.billingAddress = value.hasOwnProperty(\"billingAddress\")\n        ? value.billingAddress\n        : [];\n      this.deliveryAddress = value.hasOwnProperty(\"deliveryAddress\")\n        ? value.deliveryAddress\n        : [];\n      if (this.billingAddress.length > 0) {\n        this.purchase.billingAddress = this.billingAddress[0];\n      }\n      if (this.deliveryAddress.length > 0) {\n        this.purchase.deliveryAddress = this.deliveryAddress[0];\n      }\n      this.expenses = [];\n      this.onInvoiceDateChanged();\n      this.loadProjectByCustomer();\n      // this.loadCustomerBalance(this.vendor.id);\n      // const creditLimit = value.hasOwnProperty(\"creditLimit\")\n      //     ? value.creditLimit\n      //     : 0;\n      // this.purchase.creditLimit = kendo.parseFloat(creditLimit);\n      // window.console.log(value, 'value')\n    },\n    onEmployeeChanged(event) {\n      const value = event.value;\n      if (value && value[textField] === emptyItem[textField]) {\n        return;\n      }\n      this.mEmployee = value;\n      this.purchase.employee = value;\n    },\n    afterFetch(json) {\n      this.vendorList = json.data;\n    },\n    afterFetch_(json) {\n      this.employees = json.data;\n    },\n    onFilterChange(event) {\n      const filter = event.filter.value;\n      this.requestData(0, filter, this.cusBaseUrl);\n      this.filter = filter;\n    },\n    onEmployeeFilterChanged(event) {\n      const filter = event.filter.value;\n      this.requestData_(0, filter, this.empBaseUrl);\n      this.filter_ = filter;\n    },\n    async initData() {\n      if (this.$route.params.id !== undefined) {\n        await this.loadViewCreditPurchase();\n      } else {\n        this.clear();\n        // this.addRow();\n      }\n    },\n    async loadViewCreditPurchase() {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          this.showLoading = true;\n          if (this.$route.params.id) {\n            billingHandler\n              .viewPurchase(this.$route.params.id)\n              .then((res) => {\n                if (res.data.statusCode === 200) {\n                  this.showLoading = false;\n                  this.purchase = res.data.data[0];\n                  this.referenceNo = this.purchase.referenceNo;\n                  this.txnDate = new Date(this.purchase.transactionDate);\n                  this.vendor = this.purchase.supplier;\n                  this.mEmployee = this.purchase.employee;\n                  this.taxListTotal = this.purchase.taxListTotal;\n                  this.itemLines = this.purchase.itemLines;\n                  this.mOtherCharge = this.purchase.otherCharge;\n                  this.supplierDiscountItem =\n                    this.purchase.supplierDiscountItem || [];\n                  this.jRaw = this.purchase.jRaw || [];\n                  this.expenses = this.purchase.additionalCost || [];\n                  this.additionalCostTotal =\n                    this.purchase.additionalCostTotal || 0;\n                  this.purchaseOrders = this.purchase.refFrom || [];\n                  this.monthOf = kendo.toString(\n                    new Date(this.purchase.monthOf),\n                    \"yyyy-MM\"\n                  );\n                  for (let i = 0; i < this.mOtherCharge.length - 1; i++) {\n                    this.addSelect();\n                  }\n                  const priceLevel = this.purchase.priceLevel || {};\n                  const currency = priceLevel.currency || {};\n                  const curCode = currency.code || \"\";\n                  this.currencyCode = curCode;\n                  // this.loadProjectByCustomer()\n                  if (this.vendor) {\n                    if (this.vendor.hasOwnProperty(\"id\")) {\n                      this.loadCustomerBalance(this.vendor.id);\n                    }\n                  }\n                  if (this.$route.query.type === \"recurring\") {\n                    if (this.$route.params.hasOwnProperty(\"transactionDate\")) {\n                      window.console.log(\"type\", this.$route.params);\n                      this.purchase.transactionDate = new Date(\n                        this.$route.params.transactionDate\n                      );\n                      this.txnDate = new Date(\n                        this.$route.params.transactionDate\n                      );\n                      this.onInvoiceDateChanged();\n                      this.generateNumber();\n                    }\n                  }\n                }\n              })\n              .catch();\n            {\n              this.showLoading = false;\n            }\n          }\n        }, 10);\n      });\n    },\n    clear() {\n      // this.loadAccount()\n      this.loadPriceLevel();\n      let ds = this.$refs.itemLineDS.kendoWidget();\n      ds.data([]);\n      this.id = undefined;\n      this.vendor = {};\n      this.mEmployee = {};\n      this.mOtherCharge = {};\n      this.purchaseOrders = [];\n      this.purchase = new PurchaseModel({});\n      this.purchase.transactionType = this.purchaseTypes[0];\n      this.monthOf = kendo.toString(\n        new Date(this.purchase.transactionDate),\n        \"yyyy-MM\"\n      );\n      this.addRow();\n      this.generateNumber();\n      this.loadSegment();\n      this.loadLocation();\n    },\n    async loadTransactionRate() {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          const date = new Date(this.txnDate).toISOString().substr(0, 10);\n          const priceLevel = this.purchase.priceLevel;\n          let code = \"\";\n          if (priceLevel.hasOwnProperty(\"currency\")) {\n            if (priceLevel.currency.hasOwnProperty(\"code\")) {\n              code = priceLevel.currency.code;\n            }\n          }\n          if (code !== undefined || code !== \"\") {\n            this.showLoading = true;\n            currencyHandler\n              .getLastExchangeRateByDate(date, code)\n              .then((res) => {\n                if (res.data.statusCode === 200) {\n                  this.showLoading = false;\n                  this.exchangeRate = res.data.data[0];\n                  this.currencyCode = this.exchangeRate.code || \"\";\n                  this.transactionRate = this.exchangeRate.rate || 0;\n                  this.purchase.txnRate = this.exchangeRate.rate || 0;\n                  this.purchase.exchangeRate = this.exchangeRate || {};\n                  if (this.transactionRate === 0) {\n                    this.$snotify.error(i18n.t(\"set_exchange_rate\"));\n                    return;\n                  }\n                  this.showLoading = false;\n                  this.loadCustomerDepositBalance(this.vendor.id);\n                }\n              });\n          }\n          this.loadPurchaseOrder();\n        }, 10);\n      });\n    },\n    reload() {\n      if (this.$route.params.id !== undefined) {\n        this.loadViewCreditPurchase();\n      } else {\n        this.clear();\n      }\n    },\n    async loadPurchaseOrder() {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          let segmentId = \"\",\n            locationId = \"\",\n            priceLevelId = \"\",\n            customerId = \"\",\n            txnDate = \"\";\n          if (this.purchase.segment) {\n            segmentId = this.purchase.segment.id;\n          }\n          if (this.purchase.location) {\n            locationId = this.purchase.location.id;\n          }\n          if (this.purchase.supplier) {\n            customerId = this.purchase.supplier.id;\n          }\n          if (this.purchase.priceLevel) {\n            priceLevelId = this.purchase.priceLevel.id;\n          }\n          if (this.purchase.transactionDate) {\n            txnDate = this.purchase.transactionDate;\n          }\n          let strFilter = \"\";\n          if (\n            segmentId !== \"\" &&\n            customerId !== \"\" &&\n            locationId !== \"\" &&\n            priceLevelId !== \"\" &&\n            txnDate !== \"\"\n          ) {\n            strFilter =\n              \"?id=\" +\n              customerId +\n              \"&segId=\" +\n              segmentId +\n              \"&locId=\" +\n              locationId +\n              \"&plId=\" +\n              priceLevelId +\n              \"&date=\" +\n              txnDate +\n              \"&type=Purchase Order\";\n          }\n          if (strFilter !== \"\") {\n            this.purchase.refFrom = [];\n            this.showLoadingTxn = true;\n            saleOrderHandler.transactionFilter(strFilter).then((res) => {\n              if (res.data.statusCode === 200) {\n                this.showLoadingTxn = false;\n                this.purchaseOrders = res.data.data;\n              } else {\n                this.showLoadingTxn = false;\n              }\n            });\n          }\n        }, 10);\n      });\n      await this.getExpenseBySupplier();\n    },\n    addPurchaseOrder(item) {\n      if (item) {\n        const itemLine = item.itemLines || [];\n        this.refFrom.push({\n          id: item.id || \"\",\n          reference: item.referenceNo || \"\",\n        });\n        let ds = this.$refs.itemLineDS.kendoWidget(),\n          total = ds.total();\n        itemLine.forEach((o) => {\n          this.itemLine = new ItemLineModel(o);\n          this.itemLine.id = itemLinePrefix + uuid.v1();\n          this.itemLine.decimalFormat = \"n\" + this.purchaseFormContent.decimal;\n          this.itemLine.sourceTransaction = {\n            id: item.id,\n            referenceNo: item.referenceNo,\n          };\n          this.itemLine.sourceTransactionRef = item.referenceNo;\n          ds.insert(total, this.itemLine);\n        });\n        this.itemLine = new ItemLineModel({});\n        this.autoCalculate();\n        const index = this.purchaseOrders.findIndex((itm) => {\n          return item.id === itm.id;\n        });\n        this.purchaseOrders.splice(index, 1);\n        this.purchase.refFrom = this.removeDuplicate(this.refFrom);\n      }\n    },\n    totalQty() {\n      let ds = this.$refs.itemLineDS.kendoWidget();\n      let qty = 0;\n      ds.data()\n        .filter((n) => n.amount > 0)\n        .forEach((m) => {\n          const itm = m.item || {};\n          const uom = m.uom || {};\n          if (itm.id && uom.uom && itm.type === \"Variant\") {\n            qty += (m.qty || 0) * (m.conversionRate || 1);\n          }\n        });\n      window.console.log(\"qty\", qty);\n      return qty;\n    },\n    excludeVATTaxInclusive(tax, amount, incTax) {\n      if (tax) {\n        const baseAmount = tax.baseAmount || \"\";\n        const taxType = tax.taxType || {};\n        const taxTypeId = taxType.typeId || 0;\n        if (baseAmount) {\n          if (baseAmount.toLowerCase() === \"inclusive\" && taxTypeId === 1) {\n            return amount - incTax;\n          }\n        }\n      }\n      return amount;\n    },\n    totalAmount() {\n      let ds = this.$refs.itemLineDS.kendoWidget();\n      let amount = 0;\n      ds.data()\n        .filter((n) => n.amount > 0)\n        .forEach((m) => {\n          const itm = m.item || {};\n          const uom = m.uom || {};\n          let incluTax = 0;\n          if (itm.id && uom.uom && itm.type === \"Variant\") {\n            const tax = m.vatTax || {};\n            const amount_ = m.amount || 0;\n            const baseAmount = tax.baseAmount || \"\";\n            if (baseAmount) {\n              if (baseAmount.toLowerCase() === \"inclusive\") {\n                incluTax = this.autoCalculateTax(tax, amount_);\n              }\n            }\n            amount += amount_ - (incluTax || 0);\n          }\n        });\n      window.console.log(\"amount x-\", amount);\n      return amount;\n    },\n    percentageApplied() {\n      try {\n        const tAmount = this.totalAmount();\n        let ds = this.$refs.itemLineDS.kendoWidget();\n        ds.data()\n          .filter((n) => n.amount > 0)\n          .forEach((m) => {\n            const itm = m.item || {};\n            const uom = m.uom || {};\n            let incluTax = 0;\n            if (itm.id && uom.uom && itm.type === \"Variant\") {\n              const tax = m.vatTax || {};\n              const amount = m.amount || 0;\n              const baseAmount = tax.baseAmount || \"\";\n              if (baseAmount) {\n                if (baseAmount.toLowerCase() === \"inclusive\") {\n                  incluTax = this.autoCalculateTax(tax, amount);\n                }\n              }\n              const amountAfterTax = amount - (incluTax || 0);\n              const pAmount = amountAfterTax / tAmount;\n              m[\"percentageApplied\"] = pAmount;\n            }\n          });\n        window.console.log(\"Qty Based--\", ds.data());\n      } catch (e) {\n        window.console.log(\"error\", e);\n      }\n    },\n    amountApplied() {\n      try {\n        let ds = this.$refs.itemLineDS.kendoWidget();\n        const adc = this.additionalCostTotal || 0;\n        ds.data()\n          .filter((n) => n.amount > 0)\n          .forEach((m) => {\n            const itm = m.item || {};\n            const uom = m.uom || {};\n            window.console.log(\"amountApplied==\", uom.uom, \"---\", itm.type);\n            if (itm.id && uom.uom && itm.type === \"Variant\") {\n              const percentageApplied = m.percentageApplied || 0;\n              window.console.log(\n                \"percentageApplied--\",\n                adc,\n                \"---\",\n                percentageApplied * adc\n              );\n              m[\"amountApplied\"] = percentageApplied * adc;\n            }\n          });\n        window.console.log(\"AMount Based--\", ds.data());\n      } catch (e) {\n        window.console.log(\"error\", e);\n      }\n    },\n    amountAppliedQtyBased() {\n      try {\n        let ds = this.$refs.itemLineDS.kendoWidget();\n        ds.data()\n          .filter((n) => n.amount > 0)\n          .forEach((m) => {\n            const itm = m.item || {};\n            const uom = m.uom || {};\n            if (itm.id && uom.uom && itm.type === \"Variant\") {\n              const addc = m.additionalCost || 0;\n              const qty = (m.qty || 1) * (m.conversionRate || 1);\n              m[\"amountApplied\"] = addc * qty;\n            }\n          });\n        window.console.log(\"amountAppliedQtyBased Based--\", ds.data());\n      } catch (e) {\n        window.console.log(\"error\", e);\n      }\n    },\n    async calculateAdditionalCost() {\n      try {\n        // todo: additional Cost\n        if (this.purchase.additionalCostMethod === \"Qty Based\") {\n          this.percentageApplied();\n        } else {\n          this.percentageApplied();\n          this.amountApplied();\n        }\n        if (this.purchase.additionalCostMethod === \"Qty Based\") {\n          const tQty = this.totalQty();\n          const addc = this.additionalCostTotal || 0;\n          let ds = this.$refs.itemLineDS.kendoWidget();\n          ds.data()\n            .filter((n) => n.amount > 0)\n            .forEach((m) => {\n              const itm = m.item || {};\n              const uom = m.uom || {};\n              if (itm.id && uom.uom && itm.type === \"Variant\") {\n                m[\"additionalCost\"] = addc / tQty;\n              }\n            });\n          window.console.log(\"qty based\", ds.data());\n        } else {\n          let ds = this.$refs.itemLineDS.kendoWidget();\n          ds.data()\n            .filter((n) => n.amount > 0)\n            .forEach((m) => {\n              const itm = m.item || {};\n              const uom = m.uom || {};\n              if (itm.id && uom.uom && itm.type === \"Variant\") {\n                const amountApplied = m.amountApplied || 0;\n                const qty = (m.qty || 0) * (m.conversionRate || 1);\n                m[\"additionalCost\"] = amountApplied / qty;\n              }\n            });\n        }\n        if (this.purchase.additionalCostMethod === \"Qty Based\") {\n          this.amountAppliedQtyBased();\n        }\n        await this.clearingAccount();\n      } catch (e) {\n        window.console.log(\"error\", e);\n      }\n    },\n    autoCalculateTaxDetail() {\n      let ids = [];\n      this.taxListDetail.forEach((n) => {\n        ids.push(n.id || \"\");\n      });\n      const unique = [...new Set(ids)];\n      let result = [];\n      unique.forEach((m) => {\n        let amount = 0,\n          row = {},\n          discount = 0,\n          xDiscount = 0,\n          xAmount = 0,\n          taxAmount = 0,\n          xTaxAmount = 0;\n        let taxDetail = [],\n          isVat = 0;\n        const found = this.taxListDetail.filter((n) => n.id === m);\n        // window.console.log('taxListDetailids', found)\n        found.forEach((k) => {\n          row = k;\n          if (k.isVat === 1) {\n            isVat = 1;\n            const detail_ = k.detail || {};\n            taxDetail.push(detail_);\n          }\n          taxAmount += k.taxAmount_ || 0;\n          xTaxAmount += (k.taxAmount_ || 0) * (k.txnRate || 1);\n          amount += k.amount || 0;\n          xAmount += (k.amount || 0) * (k.txnRate || 1);\n          discount += k.discount || 0;\n          xDiscount += (k.discount || 0) * (k.txnRate || 1);\n        });\n        let spTaxAmt = 0,\n          spXTaxAmt = 0,\n          plTaxAmt = 0,\n          plXTaxAmt = 0,\n          otTaxAmt = 0,\n          otXTaxAmt = 0,\n          spTaxName = \"\",\n          plTaxName = \"\",\n          otTaxName = \"\",\n          spTaxNameLocale = \"\",\n          plTaxNameLocale = \"\",\n          otTaxNameLocale = \"\",\n          spAccId = \"\",\n          plAccId = \"\",\n          otAccId = \"\",\n          spRate = \"\",\n          plRate = \"\",\n          otRate = \"\";\n        taxDetail.forEach((n) => {\n          const spTax = n.specificTax || {};\n          const plTax = n.publicLightingTax || {};\n          const otherTax = n.otherTax || {};\n          if (Object.keys(spTax).length > 0) {\n            spTaxAmt += spTax.taxAmount_ || 0;\n            spXTaxAmt += (spTax.taxAmount_ || 0) * (spTax.taxRate || 1);\n            spTaxName = spTax.defaultTax || \"\";\n            spTaxNameLocale = spTax.defaultTaxLocale || \"\";\n            spAccId = spTax.account ? spTax.account.id : \"\";\n            spRate = spTax.rate || 1;\n          }\n          if (Object.keys(plTax).length > 0) {\n            plTaxAmt += plTax.taxAmount_ || 0;\n            plXTaxAmt += (plTax.taxAmount_ || 0) * (plTax.taxRate || 1);\n            plTaxName = plTax.defaultTax || \"\";\n            plTaxNameLocale = plTax.defaultTaxLocale || \"\";\n            plAccId = plTax.account ? plTax.account.id : \"\";\n            plRate = plTax.rate || 1;\n          }\n          if (Object.keys(otherTax).length > 0) {\n            otTaxAmt += otherTax.taxAmount_ || 0;\n            otXTaxAmt += (otherTax.taxAmount_ || 0) * (plTax.taxRate || 1);\n            otTaxName = otherTax.defaultTax || \"\";\n            otTaxNameLocale = otherTax.defaultTaxLocale || \"\";\n            otAccId = otherTax.account ? otherTax.account.id : \"\";\n            otRate = otherTax.rate || 1;\n          }\n        });\n        if (isVat === 1) {\n          row.detail = {\n            specificTax: {\n              name: spTaxName,\n              nameLocale: spTaxNameLocale,\n              amount: spTaxAmt,\n              exchangeAmount: spXTaxAmt,\n              accountId: spAccId,\n              rate: spRate,\n            },\n            publicLightingTax: {\n              name: plTaxName,\n              nameLocale: plTaxNameLocale,\n              amount: plTaxAmt,\n              exchangeAmount: plXTaxAmt,\n              accountId: plAccId,\n              rate: plRate,\n            },\n            otherTax: {\n              name: otTaxName,\n              nameLocale: otTaxNameLocale,\n              amount: otTaxAmt,\n              exchangeAmount: otXTaxAmt,\n              accountId: otAccId,\n              rate: otRate,\n            },\n          };\n        } else {\n          row.detail = {};\n        }\n\n        row[\"amount\"] = amount;\n        row[\"exchangeAmount\"] = xAmount;\n        row[\"taxAmount\"] = taxAmount;\n        row[\"exchangeTaxAmount\"] = xTaxAmount;\n        row[\"discount\"] = discount;\n        row[\"exchangeDiscount\"] = xDiscount;\n        row[\"currency\"] = this.purchase.exchangeRate || {};\n        result.push(row);\n        taxDetail = [];\n      });\n      this.purchase.saleTaxDetail = result;\n      window.console.log(\"saleTaxDetail\", result);\n    },\n    async getExpenseBySupplier() {\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(\"resolved\");\n          const segment = this.purchase.segment || {};\n          const segmentId = segment.id || \"\";\n          const location = this.purchase.location || {};\n          const locationId = location.id || \"\";\n          const supplier = this.purchase.supplier || {};\n          const supplierId = supplier.id || \"\";\n          const strFilter =\n            \"?id=\" +\n            supplierId +\n            \"&segId=\" +\n            segmentId +\n            \"&locId=\" +\n            locationId;\n          this.expenses = [];\n          this.purchase.additionalCostTotal = 0;\n          this.showLoadingTxnAdditionalCost = false;\n          this.purchase.additionalCost = [];\n          billingHandler.listPurchase(strFilter).then((res) => {\n            if (res.data.statusCode === 200) {\n              this.showLoadingTxnAdditionalCost = true;\n              this.showLoadingTxnAdditionalCost = false;\n              this.expenses = res.data.data;\n              this.onMethodChanged();\n            } else {\n              this.showLoadingTxnAdditionalCost = false;\n            }\n          });\n        }, 10);\n      });\n    },\n    async clearingAccount() {\n      try {\n        if (this.isItem()) {\n          /* todo: clearing account for additional cost */\n          const amount = (this.purchase.additionalCostTotal || 0) * -1;\n          const xAmount = amount * this.purchase.txnRate || 1;\n          const addict = this.purchase.additionalCost || [];\n\n          if (addict.length > 0) {\n            if (addict[0]) {\n              const account = addict[0].account || {};\n              const nature = \"cr\";\n              this.jRaw.push({\n                id: account.id + \"-\" + nature,\n                line: new ItemLineModel(),\n                description: \"Additional Cost\",\n                account: account,\n                accountId: account.id,\n                amount: amount,\n                exchangeAmount: xAmount,\n                type: nature,\n                typeAs: \"clearing\",\n              });\n            }\n          }\n        }\n      } catch (e) {\n        window.console.log(\"error\", e);\n      }\n    },\n    isItem() {\n      const ds = this.$refs.itemLineDS.kendoWidget();\n      const row = ds.data().filter((n) => n.amount > 0);\n      const found = row.filter((n) => n.item.type === \"Variant\");\n      if (found) {\n        return found.length > 0;\n      }\n      return false;\n    },\n  },\n  computed: {\n    abbr() {\n      if (this.purchase) {\n        const txnType = this.purchase.transactionType || {};\n        const abbr = txnType.abbr || \"\";\n        return abbr;\n      } else {\n        return \"\";\n      }\n    },\n    validVendor() {\n      let vendor = this.vendor;\n      return vendor.id !== undefined && vendor.id !== null;\n    },\n    disableMe() {\n      return !!this.$route.params.id;\n    },\n    hiddenButton() {\n      return !!this.$route.params.id;\n    },\n    disabledSLP() {\n      if (this.$route.params.id) {\n        const refF = this.purchase.refFrom || [];\n        if (refF.length > 0) {\n          return !!refF.length > 0;\n        }\n        const adc = this.purchase.additionalCost || [];\n        if (adc.length > 0) {\n          return !!adc.length > 0;\n        }\n      }\n      return false;\n    },\n  },\n  watch: {\n    // id() {\n    //   if (this.$route.params.id === undefined) {\n    //     this.clear();\n    //   } else {\n    //     this.showLoading = true;\n    //     this.loadViewCreditPurchase();\n    //   }\n    // },\n    $route: \"reload\",\n  },\n  created() {\n    this.loadTax();\n    this.loadPrefix();\n    this.loadProjectByCustomer();\n  },\n  mounted: async function () {\n    this.requestData(0, this.filter, this.cusBaseUrl);\n    await this.loadSegment();\n    await this.loadLocation();\n    await this.loadDiscountItem();\n    await this.loadEmployeeCenter();\n    await this.loadPaymentTerm();\n    await this.loadAccount();\n    await this.loadPriceLevel();\n    await this.loadOtherCharge();\n    await this.loadPurchaseFormContent();\n    await this.initData();\n  },\n};\n</script>\n\n<style scoped>\n.k-dropdown {\n  width: 100%;\n  margin-top: 3px;\n}\n\n.function_wrapper {\n  box-shadow: none !important;\n}\n\n.v-application--is-ltr .v-text-field .v-input__append-inner {\n  margin-top: 0 !important;\n}\n\n.v-input__slot {\n  background-color: #fff !important;\n}\n\n.function_content .label {\n  margin-bottom: 10px;\n  display: inline-block;\n}\n\n.border_radius10 {\n  border-radius: 10px !important;\n  background-color: #f2f2f2;\n}\n\n.pa-3.v-card h4 {\n  font-size: 18px;\n  color: #333;\n}\n\n.pa-3.v-card p {\n  font-size: 12px;\n  color: #b5b5b5;\n}\n\n.attachment_file {\n  background-color: #efeded;\n  border-radius: 0 !important;\n}\n\n.attachment_table.v-data-table table {\n  border: thin solid rgba(0, 0, 0, 0.12);\n}\n\n.attachment_table table tr th {\n  border-left: thin solid rgba(0, 0, 0, 0.12);\n  height: 35px;\n  border-right: thin solid rgba(0, 0, 0, 0.12);\n}\n\n.block_debit,\n.block_credit {\n  border-bottom: 1px solid #fff;\n}\n\n.block_debit p.number,\n.block_credit p.number {\n  font-size: 25px;\n  color: #7f7f7f;\n}\n\n.block_debit h5,\n.block_credit h5,\n.block_difference h5 {\n  text-transform: uppercase;\n  color: #7f7f7f;\n  font-size: 15px;\n  font-weight: normal;\n}\n\n.block_difference h5 {\n  font-size: 18px;\n}\n\n.block_difference h5 span {\n  font-size: 15px;\n}\n\n.custom_grid table th:last-child {\n  text-align: right !important;\n}\n\n@media (min-width: 1264px) {\n  .container {\n    max-width: 1250px;\n  }\n}\n\n@media (max-width: 576px) {\n  .pt-6.col-sm-5.col-12 {\n    padding-top: 0 !important;\n  }\n\n  .code_text {\n    width: 100%;\n  }\n\n  .phone_no_pt {\n    padding-top: 0 !important;\n  }\n\n  .select_template,\n  .save_option {\n    margin-bottom: 10px;\n  }\n}\n\n.hide_small_bar_class {\n  max-width: 0;\n  transition: 0.5s ease-in;\n  flex: 0 0 0;\n}\n\n.hide_big_bar_class {\n  max-width: 100%;\n  transition: 0.5s ease-in;\n  flex: 0 0 100%;\n}\n\n.info_add {\n  background-color: #ffffff;\n}\n\n.small_sidebar {\n  height: 98%;\n  position: relative;\n  padding: 12px;\n  background-color: #edf1f5;\n}\n\n.iconArrow {\n  right: -35px;\n  position: absolute;\n  bottom: -10px;\n}\n\n.iconArrowHide {\n  position: absolute;\n  right: -7px;\n  bottom: -10px;\n}\n\n.color_grey {\n  color: #808080;\n}\n\n.card_green {\n  min-height: 70px;\n  background-color: #00b050 !important;\n  color: #ffffff;\n}\n\n.lb_bold {\n  font-size: 12px;\n}\n\n.detial_smallside_p {\n  position: absolute;\n  bottom: 10px;\n}\n\n.card_background {\n  background-color: #edf1f5;\n  min-height: 120px;\n}\n\n.deposite_input {\n  width: 100px;\n}\n\n.btn_save_draft {\n  color: #ffffff;\n  background-color: #00b0f0 !important;\n  text-transform: capitalize;\n}\n\n.save_option {\n  background-color: #203864 !important;\n}\n\n.btn_add_small {\n  height: 27px !important;\n  min-width: 25px !important;\n  font-size: 10px;\n  padding: 0 22px !important;\n  background-color: #00b050 !important;\n  color: #ffffff;\n  border-radius: 0 !important;\n}\n\n.list_site_inv {\n  background-color: #92d050;\n  color: #ffffff;\n  font-size: 12px;\n}\n\n.list_site_exp {\n  background-color: #c5e0b4;\n  color: #000000;\n  font-size: 12px;\n  line-height: 16px;\n  min-height: 40px;\n}\n\n.checkbox_inv {\n  padding: 2px;\n  margin-top: 3px;\n  margin-right: 2px;\n}\n\n.exp_select {\n  font-size: 12px !important;\n}\n\n.theme--light.v-data-table\n  > .v-data-table__wrapper\n  > table\n  > tbody\n  > tr:hover:not(.v-data-table__expanded__content):not(.v-data-table__empty-wrapper) {\n  background-color: transparent !important;\n}\n</style>\n"]}]}