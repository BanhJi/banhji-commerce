{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/products/warehouses/operations/ReceiptOrder.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/products/warehouses/operations/ReceiptOrder.vue","mtime":1638499443294},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8vIGltcG9ydCBrZW5kbyBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tdWknCmltcG9ydCB7aTE4bn0gZnJvbSAiQC9pMThuIjsKaW1wb3J0IExvYWRpbmdNZSBmcm9tICJAL2NvbXBvbmVudHMvTG9hZGluZyI7CmltcG9ydCBEYXRlUGlja2VyQ29tcG9uZW50IGZyb20gIkAvY29tcG9uZW50cy9jdXN0b21fdGVtcGxhdGVzL0RhdGVQaWNrZXJDb21wb25lbnQiOwppbXBvcnQgUmVjZWlwdE9yZGVyIGZyb20gIkAvc2NyaXB0cy9tb2RlbC9SZWNlaXB0T3JkZXIiOwppbXBvcnQga2VuZG8gZnJvbSAiQHByb2dyZXNzL2tlbmRvLXVpIjsKaW1wb3J0IHtEcm9wRG93bkxpc3R9IGZyb20gIkBwcm9ncmVzcy9rZW5kby12dWUtZHJvcGRvd25zIjsKLy8gaW1wb3J0IE1vbnRoT2ZQaWNrZXIgZnJvbSAiQC9jb21wb25lbnRzL2tlbmRvX3RlbXBsYXRlcy9Nb250aE9mUGlja2VyIjsKaW1wb3J0IHtTaG93UmVzb3VyY2V9IGZyb20gIkAvb2JzZXJ2YWJsZS9zdG9yZSI7CmltcG9ydCB7dXVpZH0gZnJvbSAidnVlLXV1aWQiOwppbXBvcnQgJCBmcm9tICJqcXVlcnkiOwppbXBvcnQgSXRlbUxpbmVNb2RlbCBmcm9tICJAL3NjcmlwdHMvaW52b2ljZS9tb2RlbC9JdGVtTGluZSI7CgovLyBjb25zdCB0cmFuc2FjdGlvbkhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvdHJhbnNhY3Rpb25IYW5kbGVyIik7CgovLyBjb25zdCBiYXRjaEhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvYmF0Y2hIYW5kbGVyIik7CmNvbnN0IHdhcmVob3VzZUhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvd2FyZWhvdXNlSGFuZGxlciIpOwoKY29uc3QgcHVyY2hhc2VIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3B1cmNoYXNlL2hhbmRsZXIvYmlsbGluZ0hhbmRsZXIiKTsKY29uc3QgZGVsaXZlcnlPcmRlckhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvZGVsaXZlcnlPcmRlckhhbmRsZXIiKTsKY29uc3QgcmVjZWlwdE9yZGVySGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9yZWNlaXB0T3JkZXJIYW5kbGVyIik7CmNvbnN0IHByb2R1Y3RWYXJpYW50SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wcm9kdWN0VmFyaWFudEhhbmRsZXIiKTsKY29uc3QgcHJlZml4SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wcmVmaXhIYW5kbGVyIik7CmNvbnN0IGJpbGxpbmdIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2ludm9pY2UvaGFuZGxlci9iaWxsaW5nSGFuZGxlciIpOwpjb25zdCBzdXBwbGllckhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvc3VwcGxpZXJIYW5kbGVyIik7Ci8vIGNvbnN0IHNldHRpbmdzSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9zZXR0aW5nc0hhbmRsZXIiKTsKLy8gY29uc3Qgc2FsZUNoYW5uZWxIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3NhbGVDaGFubmVsSGFuZGxlciIpOwovLyBjb25zdCBsb2NhdGlvbkhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvbG9jYXRpb25IYW5kbGVyIik7Ci8vIGNvbnN0IHByb2plY3RIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3Byb2plY3RIYW5kbGVyIik7CmNvbnN0IHVvbVByaWNlSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy91b21QcmljZUhhbmRsZXIiKTsKY29uc3Qgc2FsZU9yZGVySGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy90cmFuc2FjdGlvbkhhbmRsZXIiKTsKY29uc3QgcmVjZWlwdE9yZGVyID0gbmV3IFJlY2VpcHRPcmRlcih7fSk7CmNvbnN0IGtleUZpZWxkID0gImlkIjsKY29uc3QgdGV4dEZpZWxkID0gIm5hbWUiOwpjb25zdCBlbXB0eUl0ZW0gPSB7W3RleHRGaWVsZF06ICJsb2FkaW5nIC4uLiJ9Owpjb25zdCBpdGVtTGluZVByZWZpeCA9ICJsaW4tIjsKZXhwb3J0IGRlZmF1bHQgewogICAgbmFtZTogIlJlY2VpcHRPcmRlciIsCiAgICBjb21wb25lbnRzOiB7CiAgICAgICAgTG9hZGluZ01lOiBMb2FkaW5nTWUsCiAgICAgICAgImFwcC1kYXRlcGlja2VyIjogRGF0ZVBpY2tlckNvbXBvbmVudCwKICAgICAgICBkcm9wZG93bmxpc3Q6IERyb3BEb3duTGlzdCwKICAgICAgICAvLyAiYXBwLW1vbnRocGlja2VyIjogTW9udGhPZlBpY2tlciwKICAgIH0sCiAgICBkYXRhOiAoKSA9PiAoewogICAgICAgIG1lbnUyOiBmYWxzZSwKICAgICAgICBpc0VkaXQ6IGZhbHNlLAogICAgICAgIGRpYWxvZzogZmFsc2UsCiAgICAgICAgLy8gTG9hZGluZ01lCiAgICAgICAgc2hvd0xvYWRpbmc6IGZhbHNlLAogICAgICAgIGxvYWRpbmdBbGVydDogZmFsc2UsCiAgICAgICAgbG9hZGluZ0NvbG9yQWxlcnQ6ICIiLAogICAgICAgIGxvYWRpbmdUZXh0QWxlcnQ6ICIiLAogICAgICAgIGJpbGxfZGF0ZTogIiIsCiAgICAgICAgYWxlcnQ6IGZhbHNlLAogICAgICAgIGRlcG9zaXRlOiAxMDAwLAogICAgICAgIGZpbGVzOiBbXSwKICAgICAgICAvLyBGb3JtIHZhbGlkYXRpb24KICAgICAgICB2YWxpZDogdHJ1ZSwKCiAgICAgICAgdGVtcGxhdGVzOiBbCiAgICAgICAgICAgIHt0aXRsZTogIkRyYWZ0In0sCiAgICAgICAgICAgIHt0aXRsZTogIk9wZW4ifSwKICAgICAgICAgICAge3RpdGxlOiAiUGFydGlhbGx5IENsb3NlZCJ9LAogICAgICAgICAgICB7dGl0bGU6ICJDbG9zZWQifSwKICAgICAgICBdLAogICAgICAgIGNvbF9leHBhbmQ6IDksCiAgICAgICAgY29sX2hpZGU6IDMsCiAgICAgICAgaXNIaWRlQmFyOiBmYWxzZSwKCiAgICAgICAgc2VyaWFsczogW10sCiAgICAgICAgYmF0Y2hzOiBbXSwKICAgICAgICB3YXJlaG91c2VzOiBbXSwKICAgICAgICByZWNlaXB0T3JkZXI6IHJlY2VpcHRPcmRlciwKICAgICAgICBkZWxpdmVyeUFnZW5jaWVzOiBbXSwKCiAgICAgICAgaXRlbUJhdGNoOiB7fSwKICAgICAgICB1b21CYXRjaDoge30sCiAgICAgICAgYW10QmF0Y2g6IDAsCiAgICAgICAgcXR5UmVjZWl2ZWQ6IDAsCiAgICAgICAgdG90YWxCYXRjaDogMCwKICAgICAgICBzaG93TG9hZGluZ1R4bjogZmFsc2UsCiAgICAgICAgcHVyY2hhc2VPcmRlcnM6IFtdLAogICAgICAgIHB1cmNoYXNlT3JkZXI6IHt9LAogICAgICAgIHBvSXRlbUxpbmU6IFtdLAogICAgICAgIHN1cHBsaWVyTGlzdDogW10sCiAgICAgICAgZGF0YUl0ZW1LZXk6ICJpZCIsCiAgICAgICAgdGV4dEZpZWxkOiAibmFtZSIsCiAgICAgICAgZGVmYXVsdEl0ZW06IHtbdGV4dEZpZWxkXTogIlNlbGVjdCBzdXBwbGllci4uLiIsIFtrZXlGaWVsZF06IG51bGx9LAogICAgICAgIHN1cHBsaWVyQmFzZVVybDogc3VwcGxpZXJIYW5kbGVyLnVybCgpLAogICAgICAgIGZpbHRlcjogIiIsCiAgICAgICAgaXRlbUxpbmVzOiBbXSwKICAgICAgICBpdGVtTGluZXNTOiBbXSwKICAgICAgICBpdGVtTGluZXNCYXRjaDogW10sCiAgICAgICAgaXNDbG9zZTogdHJ1ZSwKICAgICAgICBkaWFsb2dTOiBmYWxzZSwKICAgICAgICBoaWRlUzogdHJ1ZSwKICAgICAgICB0cmFuc2FjdGlvblR5cGVzOiBbXQogICAgfSksCiAgICBjb21wdXRlZDoge30sCiAgICBiZWZvcmVSb3V0ZUxlYXZlKHRvLCBmcm9tLCBuZXh0KSB7CiAgICAgICAgaWYgKHRoaXMuaXNDbG9zZSkgewogICAgICAgICAgICB0aGlzLiRzd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiBpMThuLnQoIm1zZ190aXRsZV93YXJuaW5nIiksCiAgICAgICAgICAgICAgICB0ZXh0OiBpMThuLnQoIm1zZ19kaXNjYXJkIiksCiAgICAgICAgICAgICAgICBpY29uOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogaTE4bi50KCJjYW5jZWwiKSwKICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiM0ZDQ4NDgiLAogICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjRUQxQTNBIiwKICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBpMThuLnQoImRpc2NhcmQiKSwKICAgICAgICAgICAgfSkudGhlbigocmVzdWx0Q2VuKSA9PiB7CiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2cocmVzdWx0Q2VuKTsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHRDZW4udmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlY2VpcHRPcmRlciA9IHJlY2VpcHRPcmRlcjsKICAgICAgICAgICAgICAgICAgICBuZXh0KCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV4dCgpCiAgICAgICAgfQogICAgfSwKICAgIG1ldGhvZHM6IHsKICAgICAgICBkYXRhQm91bmRTOiBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBjb25zdCBncmlkID0ga2VuZG8ualF1ZXJ5KCIjZ3JpZFMiKS5kYXRhKCJrZW5kb0dyaWQiKQogICAgICAgICAgICBjb25zdCBpdGVtcyA9IGUuc2VuZGVyLml0ZW1zKCk7CiAgICAgICAgICAgIGl0ZW1zLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgbGV0IGRhdGFJdGVtID0gZ3JpZC5kYXRhSXRlbSh0aGlzKTsKICAgICAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAgICAgLmpRdWVyeSgidHJbZGF0YS11aWQ9JyIgKyBkYXRhSXRlbS51aWQgKyAiJ10iKQogICAgICAgICAgICAgICAgICAgIC5maW5kKCIuaXNTZXJpYWxOdW1iZXIyIikKICAgICAgICAgICAgICAgICAgICAuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhSXRlbS5pc1NlcmlhbE51bWJlcjEgIT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5qUXVlcnkodGhpcykucmVtb3ZlQ2xhc3MoImstc3RhdGUtZGlzYWJsZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFkZFNlcmlhbCgpIHsKICAgICAgICAgICAgdGhpcy5nZXREYXRhU291cmNlUygpCiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLml0ZW1MaW5lc1MsICdpdGVtbGluZSBzJykKICAgICAgICB9LAogICAgICAgIGFzeW5jIGdldERhdGFTb3VyY2VTKCkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLmRhdGFTb3VyY2UxLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgIGxldCBkYXRhUm93ID0gZHMuZGF0YSgpOwogICAgICAgICAgICBjb25zdCBzID0gZGF0YVJvdy5maWx0ZXIoaSA9PiBpLnNlcmlhbE51bWJlcjEgPT09ICcnKQogICAgICAgICAgICBpZiAocy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LmVycm9yKCdQbGVhc2UgY2hlY2sgeW91ciBzZXJpYWwgbnVtYmVyJykKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChkYXRhUm93Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3RpdHV0ZUlkID0gdGhpcy4kc3RvcmUuc3RhdGUuaW5zdGl0dXRlLmluc3RpdHV0ZS5pZAogICAgICAgICAgICAgICAgcmVjZWlwdE9yZGVySGFuZGxlci5nZXRCYXRjaChkYXRhUm93WzBdLml0ZW0uaWQsIHRoaXMucmVjZWlwdE9yZGVyLndhcmVob3VzZS5pZCwgaW5zdGl0dXRlSWQsICdzZXJpYWwnKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuZm9yRWFjaCgoaSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkuc2VyaWFsTnVtYmVyMSAhPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByID0gcmVzLmZpbHRlcihwID0+IHAuc2VyaWFsTnVtYmVyMSA9PT0gaS5zZXJpYWxOdW1iZXIxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbUxpbmVzUy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHIubGVuZ3RoID4gMCA/IHJbMF0ubGluSWQgOiBpLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtOiBpLml0ZW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoSWQ6IHRoaXMucmVjZWlwdE9yZGVyLndhcmVob3VzZS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWFsTnVtYmVyMTogaS5zZXJpYWxOdW1iZXIxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJpYWxOdW1iZXIyOiBpLnNlcmlhbE51bWJlcjIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzZXJpYWwnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1b206IGkudW9tLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IHIubGVuZ3RoID4gMCA/IHJbMF0uY3JlYXRlZEF0IDogJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogaS5zdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBrOiByLmxlbmd0aCA+IDAgPyByWzBdLmlkIDogJycKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5mb3JFYWNoKChpKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaS5zZXJpYWxOdW1iZXIxICE9PSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbUxpbmVzUy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGkuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW06IGkuaXRlbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW9tOiBpLnVvbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hJZDogdGhpcy5yZWNlaXB0T3JkZXIud2FyZWhvdXNlLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJpYWxOdW1iZXIxOiBpLnNlcmlhbE51bWJlcjEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcmlhbE51bWJlcjI6IGkuc2VyaWFsTnVtYmVyMiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3NlcmlhbCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogaS5zdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBrOiAnJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5vbkNsb3NlUygpCiAgICAgICAgfSwKICAgICAgICBvbkNoYW5nZVBPKGl0ZW0pIHsKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKGl0ZW0sICdvbmNoYW5nZVBPJykKICAgICAgICAgICAgdGhpcy5yZWNlaXB0T3JkZXIuaXRlbUxpbmVzID0gW10KICAgICAgICAgICAgdGhpcy5wdXJjaGFzZU9yZGVyLml0ZW1MaW5lcy5mb3JFYWNoKHAgPT4gewogICAgICAgICAgICAgICAgdGhpcy5yZWNlaXB0T3JkZXIuaXRlbUxpbmVzLnB1c2goewogICAgICAgICAgICAgICAgICAgIC4uLnAsCiAgICAgICAgICAgICAgICAgICAgcXR5UmVjZWl2ZWQ6IHAucXR5IC0gcC50b3RhbFJlY2VpdmVkLAogICAgICAgICAgICAgICAgICAgIHNvdXJjZTogJ3B1cmNoYXNlIG9yZGVyJwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSkKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHRoaXMucmVjZWlwdE9yZGVyLml0ZW1MaW5lcywgJ2l0ZW1saW5lJykKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRQdXJjaGFzZU9yZGVycygpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgbGV0IHN1cHBsaWVySWQgPSAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgd2hJZCA9ICIiLAogICAgICAgICAgICAgICAgICAgICAgICB0eG5EYXRlID0gIiIKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5yZWNlaXB0T3JkZXIuc3VwcGxpZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3VwcGxpZXJJZCA9IHRoaXMucmVjZWlwdE9yZGVyLnN1cHBsaWVyLmlkOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5yZWNlaXB0T3JkZXIud2FyZWhvdXNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoSWQgPSB0aGlzLnJlY2VpcHRPcmRlci53YXJlaG91c2UuaWQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVjZWlwdE9yZGVyLmRhdGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHhuRGF0ZSA9IHRoaXMucmVjZWlwdE9yZGVyLmRhdGU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxldCBzdHJGaWx0ZXIgPSAiIjsKICAgICAgICAgICAgICAgICAgICBpZiAoc3VwcGxpZXJJZCAhPT0gIiIgJiYgdHhuRGF0ZSAhPT0gIiIgJiYgd2hJZCAhPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RyRmlsdGVyID0gIj9pZD0iICsgc3VwcGxpZXJJZCArICImd2hJZD0iICsgd2hJZCArICcmd1R5cGU9Uk8mdHlwZT1QdXJjaGFzZSBPcmRlcicKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0ckZpbHRlciAhPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZ1R4biA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgc2FsZU9yZGVySGFuZGxlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRyYW5zYWN0aW9uRmlsdGVyKHN0ckZpbHRlcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmdUeG4gPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2VPcmRlcnMgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmdUeG4gPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIG9uQ2xvc2VTKCkgewogICAgICAgICAgICB0aGlzLmRpYWxvZ1MgPSBmYWxzZQogICAgICAgICAgICB0aGlzLnNlcmlhbHMgPSBbXQogICAgICAgIH0sCiAgICAgICAgcm93TnVtYmVyUyhkYXRhSXRlbSkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLmRhdGFTb3VyY2UxLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICBpbmRleCA9IGRzLmluZGV4T2YoZGF0YUl0ZW0pOwogICAgICAgICAgICByZXR1cm4gaW5kZXggKyAxOwogICAgICAgIH0sCiAgICAgICAgYWRkUm93U2VyaWFsKGl0ZW0sIHVvbSwgcXR5KSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcXR5OyBpKyspIHsKICAgICAgICAgICAgICAgIGxldCBkYXRhID0gewogICAgICAgICAgICAgICAgICAgIGlkOiBpdGVtTGluZVByZWZpeCArIHV1aWQudjEoKSwKICAgICAgICAgICAgICAgICAgICBpdGVtOiBpdGVtLAogICAgICAgICAgICAgICAgICAgIHVvbTogdW9tLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbE51bWJlcjE6ICcnLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbE51bWJlcjI6ICcnLAogICAgICAgICAgICAgICAgICAgIHdoSWQ6IHRoaXMucmVjZWlwdE9yZGVyLndhcmVob3VzZS5pZCwKICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IDEKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLmRhdGFTb3VyY2UxLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICAgICAgdG90YWwgPSBkcy50b3RhbCgpOwogICAgICAgICAgICAgICAgZHMuaW5zZXJ0KHRvdGFsLCBkYXRhKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZGF0YVNvdXJjZUNoYW5nZWRTKGUpIHsKICAgICAgICAgICAgaWYgKGUuZmllbGQpIHsKICAgICAgICAgICAgICAgIGxldCBkYXRhUm93ID0gZS5pdGVtc1swXTsKICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhlLCAiZGF0YSBzb3VyY2UgY2hhbmdlIik7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKGUuZmllbGQpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICJzZXJpYWxOdW1iZXIxIjoKICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5qUXVlcnkoInRyW2RhdGEtdWlkPSciICsgZGF0YVJvdy51aWQgKyAiJ10iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbmQoIi5pc1NlcmlhbE51bWJlcjIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhUm93Lml0ZW0uaXNTZXJpYWxOdW1iZXIxICE9PSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5qUXVlcnkodGhpcykucmVtb3ZlQ2xhc3MoImstc3RhdGUtZGlzYWJsZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcmVjb3JkU2VyaWFsKGUpIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBsZXQgZ3JpZCA9IGtlbmRvLmpRdWVyeSgiI2dyaWQiKS5kYXRhKCJrZW5kb0dyaWQiKQogICAgICAgICAgICBsZXQgZGF0YUl0ZW0gPSBncmlkLmRhdGFJdGVtKCQoZS5jdXJyZW50VGFyZ2V0KS5jbG9zZXN0KCJ0ciIpKQogICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaXRlbS5pc1NlcmlhbE51bWJlciA9PT0gMiAmJiBkYXRhSXRlbS5xdHlSZWNlaXZlZCA+IDApIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLml0ZW1MaW5lc1MubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHMgPSB0aGlzLml0ZW1MaW5lc1MuZmlsdGVyKHAgPT4gcC5pdGVtLmlkID09PSBkYXRhSXRlbS5pdGVtLmlkKQogICAgICAgICAgICAgICAgICAgIGlmIChzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZFJvd1NlcmlhbChkYXRhSXRlbS5pdGVtLCBkYXRhSXRlbS51b20sIGRhdGFJdGVtLnF0eVJlY2VpdmVkKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocy5sZW5ndGggPCBkYXRhSXRlbS5xdHlSZWNlaXZlZCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlcmlhbHMgPSBzCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkUm93U2VyaWFsKGRhdGFJdGVtLml0ZW0sIGRhdGFJdGVtLnVvbSwgZGF0YUl0ZW0ucXR5UmVjZWl2ZWQgLSBzLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlcmlhbHMgPSBzCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZFJvd1NlcmlhbChkYXRhSXRlbS5pdGVtLCBkYXRhSXRlbS51b20sIGRhdGFJdGVtLnF0eVJlY2VpdmVkKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5kaWFsb2dTID0gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBkYXRhQm91bmRCOiBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBjb25zdCBncmlkID0ga2VuZG8ualF1ZXJ5KCIjZ3JpZEJhdGNoIikuZGF0YSgia2VuZG9HcmlkIikKICAgICAgICAgICAgY29uc3QgaXRlbXMgPSBlLnNlbmRlci5pdGVtcygpOwogICAgICAgICAgICBpdGVtcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGxldCBkYXRhSXRlbSA9IGdyaWQuZGF0YUl0ZW0odGhpcyk7CiAgICAgICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgICAgIC5qUXVlcnkoInRyW2RhdGEtdWlkPSciICsgZGF0YUl0ZW0udWlkICsgIiddIikKICAgICAgICAgICAgICAgICAgICAuZmluZCgiLmV4cGlyYXRpb25EYXRlIikKICAgICAgICAgICAgICAgICAgICAuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhSXRlbS5udW1iZXIgIT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5qUXVlcnkodGhpcykucmVtb3ZlQ2xhc3MoImstc3RhdGUtZGlzYWJsZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIG9uU2F2ZUJhdGNoKCkgewogICAgICAgICAgICBpZiAoKHRoaXMuYW10QmF0Y2ggLSB0aGlzLnF0eVJlY2VpdmVkKSA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoJ1BsZWFzZSBjaGVjayB5b3VyIFF0eScpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmdldERhdGFTb3VyY2VCKCkKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHRoaXMuaXRlbUxpbmVzQmF0Y2gsICdpdGVtbGluZSBiJykKICAgICAgICB9LAogICAgICAgIG9uQ2xvc2VCYXRjaCgpIHsKICAgICAgICAgICAgdGhpcy5kaWFsb2cgPSBmYWxzZQogICAgICAgICAgICB0aGlzLmJhdGNocyA9IFtdCiAgICAgICAgfSwKICAgICAgICBhc3luYyBnZXREYXRhU291cmNlQigpIHsKICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5kYXRhU291cmNlMi5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICBsZXQgZGF0YVJvdyA9IGRzLmRhdGEoKTsKICAgICAgICAgICAgaWYgKGRhdGFSb3cubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgY29uc3QgaW5zdGl0dXRlSWQgPSB0aGlzLiRzdG9yZS5zdGF0ZS5pbnN0aXR1dGUuaW5zdGl0dXRlLmlkCiAgICAgICAgICAgICAgICByZWNlaXB0T3JkZXJIYW5kbGVyLmdldEJhdGNoKGRhdGFSb3dbMF0uaXRlbS5pZCwgdGhpcy5yZWNlaXB0T3JkZXIud2FyZWhvdXNlLmlkLCBpbnN0aXR1dGVJZCwgJ2JhdGNoJykudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChyZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LmZvckVhY2goKGkpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpLnF0eSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByID0gcmVzLmZpbHRlcihwID0+IHAubnVtYmVyID09PSBpLm51bWJlcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1MaW5lc0JhdGNoLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogci5sZW5ndGggPiAwID8gclswXS5saW5JZCA6IGkuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW06IGkuaXRlbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW9tOiBpLnVvbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyOiBpLm51bWJlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hJZDogdGhpcy5yZWNlaXB0T3JkZXIud2FyZWhvdXNlLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBpcmF0aW9uRGF0ZTogaS5leHBpcmF0aW9uRGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXR5OiByLmxlbmd0aCA+IDAgPyByWzBdLnF0eSArIGkucXR5IDogaS5xdHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERRdHk6IHIubGVuZ3RoID4gMCA/IHJbMF0uRFF0eSA6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdiYXRjaCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogaS5zdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogci5sZW5ndGggPiAwID8gclswXS5jcmVhdGVkQXQgOiAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGs6IHIubGVuZ3RoID4gMCA/IHJbMF0uaWQgOiAnJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LmZvckVhY2goKGkpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpLnF0eSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1MaW5lc0JhdGNoLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogaS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbTogaS5pdGVtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1b206IGkudW9tLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IGkubnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aElkOiB0aGlzLnJlY2VpcHRPcmRlci53YXJlaG91c2UuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGlyYXRpb25EYXRlOiBpLmV4cGlyYXRpb25EYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdHk6IGkucXR5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEUXR5OiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnYmF0Y2gnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IGkuc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwazogJycKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMub25DbG9zZUJhdGNoKCkKICAgICAgICB9LAogICAgICAgIHJlbW92ZVJvd0IoZSkgewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGNvbnN0IGdyaWQgPSBrZW5kby5qUXVlcnkoIiNncmlkQmF0Y2giKS5kYXRhKCJrZW5kb0dyaWQiKSwKICAgICAgICAgICAgICAgIGRhdGFTb3VyY2UgPSBncmlkLmRhdGFTb3VyY2UsCiAgICAgICAgICAgICAgICBkYXRhSXRlbSA9IGdyaWQuZGF0YUl0ZW0oa2VuZG8ualF1ZXJ5KGUuY3VycmVudFRhcmdldCkuY2xvc2VzdCgidHIiKSk7CiAgICAgICAgICAgIGlmIChkYXRhU291cmNlLnRvdGFsKCkgPiAxKSB7CiAgICAgICAgICAgICAgICBkYXRhU291cmNlLnJlbW92ZShkYXRhSXRlbSk7CiAgICAgICAgICAgICAgICB0aGlzLmNhbGN1YXRlQmF0Y2goKQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICByb3dOdW1iZXJCKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuZGF0YVNvdXJjZTIua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIGluZGV4ID0gZHMuaW5kZXhPZihkYXRhSXRlbSk7CiAgICAgICAgICAgIHJldHVybiBpbmRleCArIDE7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBjYWxjdWF0ZUJhdGNoKCkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLmRhdGFTb3VyY2UyLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgIGxldCBkYXRhUm93ID0gZHMuZGF0YSgpOwogICAgICAgICAgICBsZXQgYW1vdW50ID0gMAogICAgICAgICAgICBkYXRhUm93LmZvckVhY2goKGkpID0+IHsKICAgICAgICAgICAgICAgIGFtb3VudCArPSBpLnF0eQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5xdHlSZWNlaXZlZCA9IGFtb3VudAogICAgICAgICAgICB0aGlzLnRvdGFsQmF0Y2ggPSB0aGlzLmFtdEJhdGNoIC0gYW1vdW50CiAgICAgICAgfSwKICAgICAgICBudW1iZXJFZGl0b3JCKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IGRhdGEtYmluZD0idmFsdWU6JyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgICAgICAua2VuZG9OdW1lcmljVGV4dEJveCh7CiAgICAgICAgICAgICAgICAgICAgZGVjaW1hbHM6IDMwLAogICAgICAgICAgICAgICAgICAgIG1pbjogMCwKICAgICAgICAgICAgICAgICAgICBtYXg6IHRoaXMudG90YWxCYXRjaAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBkYXRhU291cmNlQ2hhbmdlZEIoZSkgewogICAgICAgICAgICBpZiAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgbGV0IGRhdGFSb3cgPSBlLml0ZW1zWzBdOwogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKGUsICJkYXRhIHNvdXJjZSBjaGFuZ2UiKTsKICAgICAgICAgICAgICAgIHN3aXRjaCAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgIm51bWJlciI6CiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAualF1ZXJ5KCJ0cltkYXRhLXVpZD0nIiArIGRhdGFSb3cudWlkICsgIiddIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maW5kKCIuZXhwaXJhdGlvbkRhdGUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhUm93Lm51bWJlciAhPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ualF1ZXJ5KHRoaXMpLnJlbW92ZUNsYXNzKCJrLXN0YXRlLWRpc2FibGVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhUm93LnF0eSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FsY3VhdGVCYXRjaCgpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZXhwaXJhdGlvbkRhdGUiOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVJvdy5xdHkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbGN1YXRlQmF0Y2goKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAualF1ZXJ5KCJ0cltkYXRhLXVpZD0nIiArIGRhdGFSb3cudWlkICsgIiddIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maW5kKCIuZXhwaXJhdGlvbkRhdGUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhUm93Lm51bWJlciAhPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ualF1ZXJ5KHRoaXMpLnJlbW92ZUNsYXNzKCJrLXN0YXRlLWRpc2FibGVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgInF0eSI6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FsY3VhdGVCYXRjaCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAualF1ZXJ5KCJ0cltkYXRhLXVpZD0nIiArIGRhdGFSb3cudWlkICsgIiddIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maW5kKCIuZXhwaXJhdGlvbkRhdGUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhUm93Lm51bWJlciAhPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ualF1ZXJ5KHRoaXMpLnJlbW92ZUNsYXNzKCJrLXN0YXRlLWRpc2FibGVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYWRkUm93QigpIHsKICAgICAgICAgICAgbGV0IGRhdGEgPSB7CiAgICAgICAgICAgICAgICBpZDogaXRlbUxpbmVQcmVmaXggKyB1dWlkLnYxKCksCiAgICAgICAgICAgICAgICBpdGVtOiB0aGlzLml0ZW1CYXRjaCwKICAgICAgICAgICAgICAgIHVvbTogdGhpcy51b21CYXRjaCwKICAgICAgICAgICAgICAgIG51bWJlcjogJycsCiAgICAgICAgICAgICAgICBleHBpcmF0aW9uRGF0ZTogJycsCiAgICAgICAgICAgICAgICB3aElkOiB0aGlzLnJlY2VpcHRPcmRlci53YXJlaG91c2UuaWQsCiAgICAgICAgICAgICAgICBxdHk6IDAsCiAgICAgICAgICAgICAgICBzdGF0dXM6IDEKICAgICAgICAgICAgfTsKICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5kYXRhU291cmNlMi5rZW5kb1dpZGdldCgpLAogICAgICAgICAgICAgICAgdG90YWwgPSBkcy50b3RhbCgpOwogICAgICAgICAgICBkcy5pbnNlcnQodG90YWwsIGRhdGEpOwogICAgICAgIH0sCiAgICAgICAgcmVjb3JkQmF0Y2goZSkgewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGxldCBncmlkID0ga2VuZG8ualF1ZXJ5KCIjZ3JpZCIpLmRhdGEoImtlbmRvR3JpZCIpCiAgICAgICAgICAgIGxldCBkYXRhSXRlbSA9IGdyaWQuZGF0YUl0ZW0oJChlLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoInRyIikpCiAgICAgICAgICAgIHRoaXMuaXRlbUJhdGNoID0gZGF0YUl0ZW0uaXRlbQogICAgICAgICAgICB0aGlzLnVvbUJhdGNoID0gZGF0YUl0ZW0udW9tCiAgICAgICAgICAgIGlmIChkYXRhSXRlbS5pdGVtLmJhdGNoVHJhY2tlZCA9PT0gMSAmJiBkYXRhSXRlbS5xdHlSZWNlaXZlZCA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuYW10QmF0Y2ggPSBkYXRhSXRlbS5xdHlSZWNlaXZlZDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLml0ZW1MaW5lc0JhdGNoLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBsZXQgYW1vdW50ID0gMAogICAgICAgICAgICAgICAgICAgIHRoaXMuYmF0Y2hzID0gdGhpcy5pdGVtTGluZXNCYXRjaC5maWx0ZXIocCA9PiBwLml0ZW0uaWQgPT09IGRhdGFJdGVtLml0ZW0uaWQpCiAgICAgICAgICAgICAgICAgICAgdGhpcy5iYXRjaHMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50ICs9IHAucXR5CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB0aGlzLnRvdGFsQmF0Y2ggPSB0aGlzLmFtdEJhdGNoIC0gYW1vdW50IHx8IDAKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRSb3dCKCkKICAgICAgICAgICAgICAgICAgICB0aGlzLnRvdGFsQmF0Y2ggPSBkYXRhSXRlbS5xdHlSZWNlaXZlZDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuZGlhbG9nID0gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhc3luYyBvbmxvYWREZWxpdmVyeUFnZW5jeSgpIHsKICAgICAgICAgICAgYXdhaXQgZGVsaXZlcnlPcmRlckhhbmRsZXIuZ2V0QWxsQWdlbmN5KCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmRlbGl2ZXJ5QWdlbmNpZXMgPSByZXM7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgbnVtYmVyRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IGRhdGEtYmluZD0idmFsdWU6JyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgICAgICAua2VuZG9OdW1lcmljVGV4dEJveCh7CiAgICAgICAgICAgICAgICAgICAgZGVjaW1hbHM6IDMwLAogICAgICAgICAgICAgICAgICAgIG1pbjogMCwKICAgICAgICAgICAgICAgICAgICBtYXg6IG9wdGlvbnMubW9kZWwuc291cmNlID09PSAncHVyY2hhc2Ugb3JkZXInID8gKG9wdGlvbnMubW9kZWwucXR5IC0gb3B0aW9ucy5tb2RlbC50b3RhbFJlY2VpdmVkKSA6IDIgXiAxMDAwMDAwMDAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgaGVhZGVyVGVtcGxhdGUoKSB7CiAgICAgICAgICAgIHJldHVybiBgPGlucHV0IHR5cGU9J2NoZWNrYm94JyBpZD0naGVhZGVyLWNoYicgY2xhc3M9J2stY2hlY2tib3ggaGVhZGVyLWNoZWNrYm94Jz5gOwogICAgICAgIH0sCiAgICAgICAgSGVscChrZXkpIHsKICAgICAgICAgICAgU2hvd1Jlc291cmNlKGtleSk7CiAgICAgICAgfSwKICAgICAgICBkYXRhU291cmNlQ2hhbmdlZChlKSB7CiAgICAgICAgICAgIGlmIChlLmZpZWxkKSB7CiAgICAgICAgICAgICAgICBsZXQgZGF0YVJvdyA9IGUuaXRlbXNbMF07CiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coZSwgImRhdGEgc291cmNlIGNoYW5nZSIpOwogICAgICAgICAgICAgICAgc3dpdGNoIChlLmZpZWxkKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiaXRlbSI6CiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAualF1ZXJ5KCJ0cltkYXRhLXVpZD0nIiArIGRhdGFSb3cudWlkICsgIiddIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maW5kKCIuaXNTZXJpYWxOdW1iZXIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhUm93Lml0ZW0uaXNTZXJpYWxOdW1iZXIgPT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5qUXVlcnkodGhpcykucmVtb3ZlQ2xhc3MoImstc3RhdGUtZGlzYWJsZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5qUXVlcnkoInRyW2RhdGEtdWlkPSciICsgZGF0YVJvdy51aWQgKyAiJ10iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbmQoIi5pc0JhdGNoIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVJvdy5pdGVtLmJhdGNoVHJhY2tlZCA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5qUXVlcnkodGhpcykucmVtb3ZlQ2xhc3MoImstc3RhdGUtZGlzYWJsZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5qUXVlcnkoInRyW2RhdGEtdWlkPSciICsgZGF0YVJvdy51aWQgKyAiJ10iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbmQoIi5pc1VPTSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFSb3cuc291cmNlID09PSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5qUXVlcnkodGhpcykucmVtb3ZlQ2xhc3MoImstc3RhdGUtZGlzYWJsZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAicXR5IjoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIEV4cGlyYXRpb25EYXRlVG9UZW1wbGF0ZShkYXRhSXRlbSkgewogICAgICAgICAgICBjb25zdCBleHBpcmF0aW9uRGF0ZSA9IGRhdGFJdGVtLmV4cGlyYXRpb25EYXRlOwogICAgICAgICAgICBpZiAoZXhwaXJhdGlvbkRhdGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBgPHNwYW4+JHsKICAgICAgICAgICAgICAgICAgICBleHBpcmF0aW9uRGF0ZQogICAgICAgICAgICAgICAgICAgICAgICA/IGtlbmRvLnRvU3RyaW5nKG5ldyBEYXRlKGV4cGlyYXRpb25EYXRlKSwgYGRkLU1NLXl5eXlgKQogICAgICAgICAgICAgICAgICAgICAgICA6IGBgCiAgICAgICAgICAgICAgICB9PC9zcGFuPmA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYGA7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGRhdGFCb3VuZDogZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgY29uc3QgZ3JpZCA9IGtlbmRvLmpRdWVyeSgiI2dyaWQiKS5kYXRhKCJrZW5kb0dyaWQiKQogICAgICAgICAgICBjb25zdCBpdGVtcyA9IGUuc2VuZGVyLml0ZW1zKCk7CiAgICAgICAgICAgIGl0ZW1zLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgbGV0IGRhdGFJdGVtID0gZ3JpZC5kYXRhSXRlbSh0aGlzKTsKICAgICAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAgICAgLmpRdWVyeSgidHJbZGF0YS11aWQ9JyIgKyBkYXRhSXRlbS51aWQgKyAiJ10iKQogICAgICAgICAgICAgICAgICAgIC5maW5kKCIuaXNTZXJpYWxOdW1iZXIiKQogICAgICAgICAgICAgICAgICAgIC5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFJdGVtLml0ZW0uaXNTZXJpYWxOdW1iZXIgPT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ualF1ZXJ5KHRoaXMpLnJlbW92ZUNsYXNzKCJrLXN0YXRlLWRpc2FibGVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAgICAgLmpRdWVyeSgidHJbZGF0YS11aWQ9JyIgKyBkYXRhSXRlbS51aWQgKyAiJ10iKQogICAgICAgICAgICAgICAgICAgIC5maW5kKCIuaXNCYXRjaCIpCiAgICAgICAgICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YUl0ZW0uaXRlbS5iYXRjaFRyYWNrZWQgPT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ualF1ZXJ5KHRoaXMpLnJlbW92ZUNsYXNzKCJrLXN0YXRlLWRpc2FibGVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAgICAgLmpRdWVyeSgidHJbZGF0YS11aWQ9JyIgKyBkYXRhSXRlbS51aWQgKyAiJ10iKQogICAgICAgICAgICAgICAgICAgIC5maW5kKCIuaXNVT00iKQogICAgICAgICAgICAgICAgICAgIC5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFJdGVtLnNvdXJjZSA9PT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLmpRdWVyeSh0aGlzKS5yZW1vdmVDbGFzcygiay1zdGF0ZS1kaXNhYmxlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYWRkUm93KCkgewogICAgICAgICAgICBsZXQgZGF0YSA9IHsKICAgICAgICAgICAgICAgIGlkOiBpdGVtTGluZVByZWZpeCArIHV1aWQudjEoKSwKICAgICAgICAgICAgICAgIGl0ZW06IHtuYW1lOiAiIn0sCiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJycsCiAgICAgICAgICAgICAgICBxdHk6IDAsCiAgICAgICAgICAgICAgICB1b206IHt9LAogICAgICAgICAgICAgICAgdG90YWxSZWNlaXZlZDogMCwKICAgICAgICAgICAgICAgIHF0eVJlY2VpdmVkOiAwLAogICAgICAgICAgICAgICAgc291cmNlOiAnJwogICAgICAgICAgICB9OwogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLmRhdGFTb3VyY2Uua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIHRvdGFsID0gZHMudG90YWwoKTsKICAgICAgICAgICAgZHMuaW5zZXJ0KHRvdGFsLCBkYXRhKTsKICAgICAgICAgICAgdGhpcy5xdHlBZGQgPSAwOwogICAgICAgIH0sCiAgICAgICAgRXhwaXJhdGlvbkRhdGVUb0VkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCByZXF1aXJlZCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0RhdGVQaWNrZXIoKTsKICAgICAgICB9LAogICAgICAgIEl0ZW1Ecm9wRG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogImNvbnRhaW5zIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVGV4dEZpZWxkOiAibmFtZSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlRmllbGQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgaGVhZGVyVGVtcGxhdGU6CiAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJkcm9wZG93bi1oZWFkZXIgay13aWRnZXQgay1oZWFkZXIiPicgKwogICAgICAgICAgICAgICAgICAgICAgICAiPHNwYW4+SXRlbXMgPC9zcGFuPiIgKwogICAgICAgICAgICAgICAgICAgICAgICAiPHNwYW4+PC9zcGFuPiIgKwogICAgICAgICAgICAgICAgICAgICAgICAiPC9kaXY+IiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9bmFtZSM8L3NwYW4+IiwKICAgICAgICAgICAgICAgICAgICBvcHRpb25MYWJlbDogIi0tLSBTZWxlY3QgLS0tIiwKICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlOiBuZXcga2VuZG8uZGF0YS5EYXRhU291cmNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyRmlsdGVyaW5nOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc3BvcnQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHByb2R1Y3RWYXJpYW50SGFuZGxlci5pdGVtU2VhcmNoVVJMKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDoge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZToge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2t1OiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGEuZmlsdGVyKHAgPT4gcC50eXBlID09PSAnVmFyaWFudCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhLmZpbHRlcihwID0+IHAudHlwZSA9PT0gJ1ZhcmlhbnQnKS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAvLyBkYXRhOiB0aGlzLnZhcmlhbnRzCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIFVPTURyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucy5tb2RlbC5zb3VyY2UgPT09ICcnKSB7CiAgICAgICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgICAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9XaWR0aDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcjogInN0YXJ0c3dpdGgiLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhVGV4dEZpZWxkOiAidW9tLm5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogInVvbS5pZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2NhZGVGcm9tOiAiaXRlbSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAiPHNwYW4+Iz11b20ubmFtZSM8L3NwYW4+IiwKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6ICItLS0gU2VsZWN0IC0tLSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IG5ldyBrZW5kby5kYXRhLkRhdGFTb3VyY2UoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyRmlsdGVyaW5nOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNwb3J0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHVvbVByaWNlSGFuZGxlci51b21QcmljZUJ5UHJpY2VMZXZlbFVSTCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpZD0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubW9kZWwuaXRlbS5pZCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiJnBsSWQ9IiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlY2VpcHRPcmRlci5wcmljZUxldmVsLmlkICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICImZGF0ZT0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVjZWlwdE9yZGVyLmRhdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAianNvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWw6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHt0eXBlOiAic3RyaW5nIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBuYW1lOiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2t1OiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YS5jb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRhdGE6IHRoaXMudmFyaWFudHMKICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgVU9NVGVtcGxhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3QgdW9tID0gZGF0YUl0ZW0udW9tOwogICAgICAgICAgICBpZiAodW9tKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYDxzcGFuPiR7dW9tLnVvbSA/IHVvbS51b20ubmFtZSA6IGBgfTwvc3Bhbj5gOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGBgOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICByZW1vdmVSb3coZSkgewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGNvbnN0IGdyaWQgPSBrZW5kby5qUXVlcnkoIiNncmlkIikuZGF0YSgia2VuZG9HcmlkIiksCiAgICAgICAgICAgICAgICBkYXRhU291cmNlID0gZ3JpZC5kYXRhU291cmNlLAogICAgICAgICAgICAgICAgZGF0YUl0ZW0gPSBncmlkLmRhdGFJdGVtKGtlbmRvLmpRdWVyeShlLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoInRyIikpOwoKICAgICAgICAgICAgaWYgKGRhdGFTb3VyY2UudG90YWwoKSA+IDEpIHsKICAgICAgICAgICAgICAgIGRhdGFTb3VyY2UucmVtb3ZlKGRhdGFJdGVtKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcm93TnVtYmVyKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuZGF0YVNvdXJjZS5rZW5kb1dpZGdldCgpLAogICAgICAgICAgICAgICAgaW5kZXggPSBkcy5pbmRleE9mKGRhdGFJdGVtKTsKICAgICAgICAgICAgcmV0dXJuIGluZGV4ICsgMTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIG9ubG9hZFdhcmVob3VzZSgpIHsKICAgICAgICAgICAgYXdhaXQgd2FyZWhvdXNlSGFuZGxlci5nZXRXYXJlaG91c2VTZXR0aW5nQWxsKCkudGhlbihhc3luYyAocmVzKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLndhcmVob3VzZXMgPSByZXM7CiAgICAgICAgICAgICAgICBpZiAodGhpcy53YXJlaG91c2VzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlY2VpcHRPcmRlci53YXJlaG91c2UgPSB0aGlzLndhcmVob3VzZXNbMF07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgb25DaGFuZ2VXYXJlaG91c2UoKSB7CiAgICAgICAgICAgIC8vIGF3YWl0IHRoaXMubG9hZFpvbmUocmVjZWlwdE9yZGVyLndhcmVob3VzZS5pZCkKICAgICAgICB9LAogICAgICAgIGFzeW5jIG9uQ2hhbmdlKGV2ZW50KSB7CiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZXZlbnQudmFsdWU7CiAgICAgICAgICAgIGlmICh2YWx1ZSAmJiB2YWx1ZVt0ZXh0RmllbGRdID09PSBlbXB0eUl0ZW1bdGV4dEZpZWxkXSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2codmFsdWUpOwogICAgICAgICAgICB0aGlzLnJlY2VpcHRPcmRlci5zdXBwbGllciA9IHZhbHVlOwogICAgICAgICAgICB0aGlzLnJlY2VpcHRPcmRlci5wcmljZUxldmVsID0gdmFsdWUucHJpY2VMZXZlbDsKICAgICAgICAgICAgYXdhaXQgdGhpcy5sb2FkUHVyY2hhc2VPcmRlcnMoKQogICAgICAgICAgICAvLyBhd2FpdCB0aGlzLm9ubG9hZFB1cmNoYXNlKHZhbHVlLmlkKTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIG9ubG9hZFB1cmNoYXNlKGlkKSB7CiAgICAgICAgICAgIGF3YWl0IHB1cmNoYXNlSGFuZGxlci5ieUN1c3RvbWVyKGlkKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhyZXMsICJsaXN0IHB1cmNoYXNlIGJ5IGN1c3RvbWVyIik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSwKICAgICAgICBvbkZpbHRlckNoYW5nZShldmVudCkgewogICAgICAgICAgICBjb25zdCBmaWx0ZXIgPSBldmVudC5maWx0ZXIudmFsdWU7CiAgICAgICAgICAgIHRoaXMucmVxdWVzdERhdGEoMCwgZmlsdGVyLCB0aGlzLnN1cHBsaWVyQmFzZVVybCk7CiAgICAgICAgICAgIHRoaXMuZmlsdGVyID0gZmlsdGVyOwogICAgICAgIH0sCiAgICAgICAgcmVxdWVzdERhdGEoc2tpcCwgZmlsdGVyLCBiYXNlVXJsKSB7CiAgICAgICAgICAgIGNvbnN0IHVybCA9IGJhc2VVcmwgKyBgLyR7ZmlsdGVyfWA7CiAgICAgICAgICAgIHRoaXMucmVxdWVzdFN0YXJ0ZWQgPSB0cnVlOwogICAgICAgICAgICBmZXRjaCh1cmwpCiAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2cocmVzcG9uc2UuanNvbigpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLnRoZW4odGhpcy5hZnRlckZldGNoKTsKICAgICAgICB9LAogICAgICAgIGFmdGVyRmV0Y2goanNvbikgewogICAgICAgICAgICB0aGlzLnN1cHBsaWVyTGlzdCA9IGpzb24uZGF0YTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRQcmVmaXgoKSB7CiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBwcmVmaXhIYW5kbGVyLmdldCgicmVjZWlwdCBvcmRlciIpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb25UeXBlcyA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50cmFuc2FjdGlvblR5cGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlY2VpcHRPcmRlci50cmFuc2FjdGlvblR5cGUgPSB0aGlzLnRyYW5zYWN0aW9uVHlwZXNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVOdW1iZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sIDMwMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyBhd2FpdCB0aGlzLm9ubG9hZEJhdGNoKCk7CiAgICAgICAgICAgIGF3YWl0IHRoaXMub25sb2FkV2FyZWhvdXNlKCk7CiAgICAgICAgICAgIC8vIGF3YWl0IHRoaXMubG9hZFNhbGVDaGFubmVsKCk7CiAgICAgICAgICAgIC8vIGF3YWl0IHRoaXMubG9hZExvY2F0aW9uKCk7CiAgICAgICAgICAgIGF3YWl0IHRoaXMub25sb2FkRGVsaXZlcnlBZ2VuY3koKTsKICAgICAgICAgICAgLy8gYXdhaXQgdGhpcy5sb2FkUHJvamVjdHMoKQogICAgICAgICAgICAvLyBhd2FpdCB0aGlzLmxvYWRTZWdtZW50KCkKICAgICAgICAgICAgLy8gYXdhaXQgdGhpcy5sb2FkWm9uZSh0aGlzLndhcmVob3VzZXNbMF0uaWQpCiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9LAogICAgICAgIGdlbmVyYXRlTnVtYmVyKCkgewogICAgICAgICAgICBsZXQgZGF0YSA9IHsKICAgICAgICAgICAgICAgIGFiYnI6IHRoaXMucmVjZWlwdE9yZGVyLnRyYW5zYWN0aW9uVHlwZS5hYmJyLAogICAgICAgICAgICAgICAgc3RydWN0dXJlOiB0aGlzLnJlY2VpcHRPcmRlci50cmFuc2FjdGlvblR5cGUuc3RydWN0dXJlLAogICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25EYXRlOiB0aGlzLnJlY2VpcHRPcmRlci5kYXRlLAogICAgICAgICAgICAgICAgc2VxdWNlbmNpbmc6IHRoaXMucmVjZWlwdE9yZGVyLnRyYW5zYWN0aW9uVHlwZS5zZXF1Y2VuY2luZywKICAgICAgICAgICAgICAgIHR5cGU6ICJSZWNlaXB0IE9yZGVyIiwKICAgICAgICAgICAgICAgIGVudGl0eTogMywKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGhpcy5yZWNlaXB0T3JkZXIuYWJiciA9IGRhdGEuYWJicjsKICAgICAgICAgICAgdGhpcy5yZWNlaXB0T3JkZXIuc3RydWN0dXJlID0gZGF0YS5zdHJ1Y3R1cmU7CiAgICAgICAgICAgIHRoaXMucmVjZWlwdE9yZGVyLnNlcXVjZW5jaW5nID0gZGF0YS5zZXF1Y2VuY2luZzsKICAgICAgICAgICAgdGhpcy5yZWNlaXB0T3JkZXIudHlwZSA9IGRhdGEudHlwZTsKICAgICAgICAgICAgdGhpcy5yZWNlaXB0T3JkZXIudHJhbnNhY3Rpb25EYXRlID0gZGF0YS50cmFuc2FjdGlvbkRhdGU7CiAgICAgICAgICAgIGJpbGxpbmdIYW5kbGVyCiAgICAgICAgICAgICAgICAubGFzdE51bWJlcihkYXRhKQogICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGFzdE51bWJlciA9IHRoaXMuemVyb1BhZCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlSW50KHJlcy5sYXN0TnVtYmVyKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVjZWlwdE9yZGVyLnRyYW5zYWN0aW9uVHlwZS5mb3JtYXQKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWNlaXB0T3JkZXIubnVtYmVyID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5zdWZmaXggKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWNlaXB0T3JkZXIudHJhbnNhY3Rpb25UeXBlLm51bWJlclNlcGFyYXRvciArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0TnVtYmVyOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlY2VpcHRPcmRlci5sYXN0TnVtYmVyID0gcmVzLnN1ZmZpeCArIGxhc3ROdW1iZXI7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLnJlY2VpcHRPcmRlci5udW1iZXIsICJib20iKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvcnMucHVzaChlKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgemVyb1BhZChudW0sIHBsYWNlcykgewogICAgICAgICAgICByZXR1cm4gU3RyaW5nKG51bSkucGFkU3RhcnQocGxhY2VzLCAiMCIpOwogICAgICAgIH0sCiAgICAgICAgc3VmZml4KHRyYW5zYWN0aW9uRGF0ZSkgewogICAgICAgICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcobmV3IERhdGUodHJhbnNhY3Rpb25EYXRlKSwgYHl5bW1gKTsKICAgICAgICB9LAogICAgICAgIHNhdmVQcmludCgpIHsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGdldERhdGFTb3VyY2UoKSB7CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuZGF0YVNvdXJjZS5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICBsZXQgZGF0YVJvdyA9IGRzLmRhdGEoKTsKICAgICAgICAgICAgdGhpcy5pdGVtTGluZXMgPSBbXTsKICAgICAgICAgICAgZGF0YVJvdy5mb3JFYWNoKChpKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoaS5xdHlSZWNlaXZlZCA+IDAgJiYgaS5zb3VyY2UgPT09ICdwdXJjaGFzZSBvcmRlcicpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsaW5lID0gaQogICAgICAgICAgICAgICAgICAgIGxpbmUudG90YWxSZWNlaXZlZCA9IGkucXR5UmVjZWl2ZWQKICAgICAgICAgICAgICAgICAgICB0aGlzLnBvSXRlbUxpbmUucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW06IGkuaXRlbSwKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25UeXBlOiB0aGlzLnB1cmNoYXNlT3JkZXIudHJhbnNhY3Rpb25UeXBlLAogICAgICAgICAgICAgICAgICAgICAgICB1b206IGkudW9tLAogICAgICAgICAgICAgICAgICAgICAgICBpZDogaS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyOiB0aGlzLnB1cmNoYXNlT3JkZXIubnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBpLml0ZW0uaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIHF0eTogaS5xdHksCiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IG5ldyBJdGVtTGluZU1vZGVsKGxpbmUpLAogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVkOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBwcmljZTogMCwKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1B1cmNoYXNlIE9yZGVyJywKICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tZXI6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IGkuc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IGkuY3JlYXRlZEF0CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuaXRlbUxpbmVzLnB1c2goewogICAgICAgICAgICAgICAgICAgIGlkOiBpLmlkLAogICAgICAgICAgICAgICAgICAgIGl0ZW06IGkuaXRlbSwKICAgICAgICAgICAgICAgICAgICBxdHk6IGkucXR5LAogICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBpLmRlc2NyaXB0aW9uLAogICAgICAgICAgICAgICAgICAgIHVvbTogaS51b20sCiAgICAgICAgICAgICAgICAgICAgdG90YWxSZWNlaXZlZDogaS50b3RhbFJlY2VpdmVkLAogICAgICAgICAgICAgICAgICAgIHF0eVJlY2VpdmVkOiBpLnF0eVJlY2VpdmVkLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgc2F2ZU5ldygpIHsKICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuZ2V0RGF0YVNvdXJjZSgpOwogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2codGhpcy5wb0l0ZW1MaW5lLCB0aGlzLnB1cmNoYXNlT3JkZXIuaWQsICdwb0l0ZW1MaW5lJykKICAgICAgICAgICAgaWYgKHRoaXMucG9JdGVtTGluZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBhd2FpdCB3YXJlaG91c2VIYW5kbGVyLmFkZEl0ZW1MaW5lKHRoaXMucHVyY2hhc2VPcmRlci5pZCwgdGhpcy5wb0l0ZW1MaW5lKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgIT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LmVycm9yKCdFcnJvciBVcGRhdGUgSXRlbUxpbmUhISEnKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5yZWNlaXB0T3JkZXIucHVyY2hhc2VPcmRlcklkID0gdGhpcy5wdXJjaGFzZU9yZGVyID8gdGhpcy5wdXJjaGFzZU9yZGVyLmlkIDogJycKICAgICAgICAgICAgdGhpcy5yZWNlaXB0T3JkZXIucHVyY2hhc2VPcmRlclJlZiA9IHRoaXMucHVyY2hhc2VPcmRlciA/IHRoaXMucHVyY2hhc2VPcmRlci5yZWZlcmVuY2VObyA6ICcnCiAgICAgICAgICAgIHRoaXMucmVjZWlwdE9yZGVyLml0ZW1MaW5lcyA9IHRoaXMuaXRlbUxpbmVzOwogICAgICAgICAgICB0aGlzLnJlY2VpcHRPcmRlci5pdGVtTGluZXNTZXJpYWwgPSB0aGlzLml0ZW1MaW5lc1MKICAgICAgICAgICAgdGhpcy5yZWNlaXB0T3JkZXIuaXRlbUxpbmVzQmF0Y2ggPSB0aGlzLml0ZW1MaW5lc0JhdGNoCiAgICAgICAgICAgIHRoaXMucmVjZWlwdE9yZGVyLnRyYW5zYWN0aW9uRGF0ZSA9IHRoaXMucmVjZWlwdE9yZGVyLmRhdGU7CiAgICAgICAgICAgIHJlY2VpcHRPcmRlckhhbmRsZXIuc2F2ZSh0aGlzLnJlY2VpcHRPcmRlcikudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2cocmVzKTsKICAgICAgICAgICAgICAgIHRoaXMuaXNDbG9zZSA9IGZhbHNlCiAgICAgICAgICAgICAgICB0aGlzLmNhbmNlbCgpOwogICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIHNhdmVDbG9zZSgpIHsKICAgICAgICB9LAogICAgICAgIGVycm9yTWVzc2FnZSgpIHsKICAgICAgICB9LAogICAgICAgIGFjY291bnREcm9wRG93bkVkaXRvcigpIHsKICAgICAgICB9LAogICAgICAgIGNhbmNlbCgpIHsKICAgICAgICAgICAgdGhpcy5pdGVtTGluZXMgPSBbXQogICAgICAgICAgICB0aGlzLnBvSXRlbUxpbmUgPSBbXQogICAgICAgICAgICB0aGlzLml0ZW1MaW5lc1MgPSBbXQogICAgICAgICAgICB0aGlzLml0ZW1MaW5lc0JhdGNoID0gW10KICAgICAgICAgICAgdGhpcy5iYXRjaHMgPSBbXQogICAgICAgICAgICB0aGlzLnNlcmlhbHMgPSBbXQogICAgICAgICAgICB0aGlzLnB1cmNoYXNlT3JkZXJzID0gW10KICAgICAgICAgICAgdGhpcy5wdXJjaGFzZU9yZGVyID0ge30KICAgICAgICAgICAgdGhpcy5pdGVtQmF0Y2ggPSB7fQogICAgICAgICAgICB0aGlzLnJlY2VpcHRPcmRlciA9IHJlY2VpcHRPcmRlcgogICAgICAgICAgICB0aGlzLiRyb3V0ZXIuZ28oLTEpOwogICAgICAgIH0sCiAgICAgICAgaGlkZV9zbWFsbHNpdGViYXIoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5pc0hpZGVCYXIpIHsKICAgICAgICAgICAgICAgIC8vIHRoaXMuY29sX2V4cGFuZCA9IDEyCiAgICAgICAgICAgICAgICAvLyB0aGlzLmNvbF9oaWRlID0gMAogICAgICAgICAgICAgICAgdGhpcy5pc0hpZGVCYXIgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gdGhpcy5jb2xfZXhwYW5kID0gOQogICAgICAgICAgICAgICAgLy8gdGhpcy5jb2xfaGlkZSA9IDMKICAgICAgICAgICAgICAgIHRoaXMuaXNIaWRlQmFyID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgfSwKICAgIHdhdGNoOiB7CiAgICAgICAgLy8gY2FsbCBhZ2FpbiB0aGUgbWV0aG9kIGlmIHRoZSByb3V0ZSBjaGFuZ2VzCiAgICB9LAogICAgY3JlYXRlZCgpIHsKICAgICAgICAvLyBmZXRjaCB0aGUgZGF0YSB3aGVuIHRoZSB2aWV3IGlzIGNyZWF0ZWQgYW5kIHRoZSBkYXRhIGlzCiAgICAgICAgLy8gYWxyZWFkeSBiZWluZyBvYnNlcnZlZAogICAgICAgIC8vIHRoaXMubG9hZE9iaigpCiAgICB9LAogICAgYXN5bmMgbW91bnRlZCgpIHsKICAgICAgICB0aGlzLnJlcXVlc3REYXRhKDAsICIiLCBzdXBwbGllckhhbmRsZXIudXJsKCkpOwogICAgICAgIHRoaXMuYWRkUm93KCk7CiAgICAgICAgYXdhaXQgdGhpcy5sb2FkUHJlZml4KCk7CiAgICB9LAp9Owo="},{"version":3,"sources":["ReceiptOrder.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmmBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ReceiptOrder.vue","sourceRoot":"src/views/products/warehouses/operations","sourcesContent":["<template>\n    <v-app>\n        <v-container>\n            <v-row>\n                <v-col sm=\"12\" cols=\"12\">\n                    <v-card\n                        outlined\n                        dense\n                        class=\"pa-4 no_border rounded-sm\"\n                        color=\"white\"\n                    >\n                        <v-row>\n                            <v-col\n                                class=\"bigSide py-0\"\n                                sm=\"12\"\n                                cols=\"12\"\n                                style=\"transition: .3s ease-in;\"\n                                :class=\"{ hide_big_bar_class: isHideBar }\"\n                            >\n                                <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                                    <v-card outlined dense class=\"no_border\">\n                                        <h2 class=\"mb-0\">{{ $t(\"receipt_order\") }}</h2>\n                                        <v-icon\n                                            @click=\"cancel\"\n                                            style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                                            class=\"float-right\"\n                                        >close\n                                        </v-icon>\n                                    </v-card>\n\n                                    <v-card\n                                        outlined\n                                        dense\n                                        class=\"px-4 no_border mb-3\"\n                                        color=\"grayBg\"\n                                    >\n                                        <v-row>\n                                            <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                                                <label class=\"label\">{{ $t(\"supplier\") }}</label>\n                                                <v-col\n                                                    sm=\"12\"\n                                                    cols=\"12\"\n                                                    style=\"margin-top:1px;\"\n                                                    class=\"kendo_dropdown_custom pl-0 pb-4 pr-0  pt-0\"\n                                                >\n                                                    <dropdownlist\n                                                        :data-items=\"supplierList\"\n                                                        @change=\"onChange\"\n                                                        v-model=\"receiptOrder.supplier\"\n                                                        :value=\"receiptOrder.supplier\"\n                                                        :data-item-key=\"dataItemKey\"\n                                                        :text-field=\"textField\"\n                                                        :default-item=\"defaultItem\"\n                                                        :filterable=\"true\"\n                                                        @filterchange=\"onFilterChange\"\n                                                    >\n                                                    </dropdownlist>\n                                                </v-col>\n                                                <label class=\"label\">{{ $t(\"number\") }}</label>\n                                                <div class=\"mt-1 d-flex\">\n                                                    <div class=\"code_text flex-1 text-bold\">\n                                                        {{ receiptOrder.abbr }}\n                                                    </div>\n\n                                                    <v-text-field\n                                                        class=\"flex-2 custom-border \"\n                                                        v-model=\"receiptOrder.number\"\n                                                        outlined\n                                                        disabled\n                                                        :rules=\"[(v) => !!v || 'Number is required']\"\n                                                        required\n                                                    />\n                                                    <v-icon\n                                                        color=\"black\"\n                                                        size=\"30\"\n                                                        style=\"height: 40px;\"\n                                                        class=\"border_qrcode ml-2\"\n                                                        @click=\"generateNumber\"\n                                                    >mdi-qrcode\n                                                    </v-icon>\n                                                </div>\n                                            </v-col>\n                                            <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                                                <label class=\"label\">{{ $t(\"date\") }}</label>\n                                                <app-datepicker\n                                                    :initialDate=\"receiptOrder.date\"\n                                                    @onChanged=\"generateNumber\"\n                                                    @emitDate=\"receiptOrder.date = $event\"\n                                                />\n                                                <label class=\"label\">{{ $t(\"reference\") }}</label>\n                                                <v-select :items=\"purchaseOrders\" @change=\"onChangePO\"\n                                                          v-model=\"purchaseOrder\" return-object\n                                                          :loading=\"purchaseOrders.length <= 0 && showLoadingTxn\"\n                                                          item-text=\"referenceNo\" item-value=\"id\" outlined\n                                                          class=\"mt-1\"/>\n                                            </v-col>\n                                            <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                                                <label class=\"label\">{{ $t(\"warehouse\") }}</label>\n                                                <v-select\n                                                    class=\"mt-1\"\n                                                    :items=\"warehouses\"\n                                                    item-text=\"name\"\n                                                    item-value=\"id\"\n                                                    @change=\"onChangeWarehouse\"\n                                                    v-model=\"receiptOrder.warehouse\"\n                                                    :rules=\"[(v) => !!v || 'Warehouse is required']\"\n                                                    return-object\n                                                    tage=\"Warehouse\"\n                                                    outlined\n                                                />\n                                            </v-col>\n                                        </v-row>\n                                    </v-card>\n\n                                    <v-row color=\"white\">\n                                        <v-col sm=\"12\" cols=\"12\" class=\"pt-0\">\n                                            <kendo-datasource\n                                                ref=\"dataSource\"\n                                                @change=\"dataSourceChanged\"\n                                                :data=\"receiptOrder.itemLines\"\n                                            />\n                                            <kendo-grid\n                                                id=\"grid\"\n                                                class=\"grid-function\"\n                                                :data-source-ref=\"'dataSource'\"\n                                                :sortable=\"false\"\n                                                :filterable=\"false\"\n                                                v-on:databound=\"dataBound\"\n                                                :column-menu=\"true\"\n                                                :editable=\"true\"\n                                                :scrollable-virtual=\"true\"\n                                            >\n                                                <kendo-grid-column\n                                                    :command=\"{\n                                                        iconClass: 'k-icon k-i-trash',\n                                                        text: ' ',\n                                                        click: removeRow,\n                                                        class: 'btn-plus',\n                                                      }\"\n                                                    :title=\"'&nbsp;'\"\n                                                    :width=\"60\"\n                                                    :headerAttributes=\"{\n                            style:\n                              'text-align: right; background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :title=\"$t('no.')\"\n                                                    :width=\"55\"\n                                                    :template=\"rowNumber\"\n                                                    :column-menu=\"false\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5;',\n                            class: 'text-variants',\n                          }\"\n                                                    :attributes=\"{ style: 'text-align: variants' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'item'\"\n                                                    :title=\"$t('items')\"\n                                                    :width=\"200\"\n                                                    :template=\"'<span>#=item.name#</span>'\"\n                                                    :editor=\"ItemDropDownEditor\"\n                                                    :headerAttributes=\"{\n                            style: 'background-color: #EDF1F5',\n                          }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'description'\"\n                                                    :title=\"$t('description')\"\n                                                    :width=\"170\"\n                                                    :headerAttributes=\"{style: 'background-color: #EDF1F5'}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'uom'\"\n                                                    :template=\"UOMTemplate\"\n                                                    :editor=\"UOMDropDownEditor\"\n                                                    :title=\"$t('uom')\"\n                                                    :width=\"110\"\n                                                    :attribute=\"{class: 'k-state-disabled'}\"\n                                                    :headerAttributes=\"{\n                                                        style: 'background-color: #EDF1F5',\n                                                      }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'qty'\"\n                                                    :title=\"$t('ordered')\"\n                                                    :format=\"'{0:n0}'\"\n                                                    :attributes=\"{style: 'text-align: right'}\"\n                                                    :width=\"120\"\n                                                    :editable=\"function() {return false}\"\n                                                    :headerAttributes=\"{style: 'background-color: #EDF1F5'}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'totalReceived'\"\n                                                    :title=\"$t('total_received')\"\n                                                    :width=\"180\"\n                                                    :editable=\"function() {return false}\"\n                                                    :headerAttributes=\"{style:'text-align: right; background-color: #EDF1F5', }\"\n                                                    :attributes=\"{style: 'text-align: right'}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'qtyReceived'\"\n                                                    :title=\"$t('qty_received')\"\n                                                    :width=\"160\"\n                                                    :editor=\"numberEditor\"\n                                                    :headerAttributes=\"{style:'text-align: right; background-color: #EDF1F5', }\"\n                                                    :attributes=\"{style: 'text-align: right'}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :command=\"[{\n                                                        iconClass: 'k-icon k-i-plus',\n                                                     text: $t('serial'),\n                                                     click: recordSerial,\n                                                     className: 'k-state-disabled isSerialNumber btn-plus',\n                                                     },{\n                                                    iconClass: 'k-icon k-i-plus',\n                                                     text: $t('batch'),\n                                                     click: recordBatch,\n                                                     className: 'k-state-disabled isBatch btn-plus'\n                                                     }]\"\n                                                    :width=\"190\"\n                                                    :hidden=\"false\"\n                                                    :headerAttributes=\"{style:'text-align: right; background-color: #EDF1F5',}\"\n                                                />\n                                            </kendo-grid>\n                                        </v-col>\n                                        <v-col cols=\"12\" class=\"py-0\">\n                                            <v-btn\n                                                color=\"primary\"\n                                                class=\"float-left btn_plus rounded-4 white--text mr-2\"\n                                                @click=\"addRow\"\n                                            >\n                                                <v-icon size=\"\" class=\"ma-1\">mdi-plus</v-icon>\n                                            </v-btn>\n                                        </v-col>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"pb-0\">\n                                            <v-row>\n                                                <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                                    <v-row>\n                                                        <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                                                            <label class=\"label  mb-0\">{{\n                                                                    $t(\"delivered_by\")\n                                                                }}</label>\n                                                            <v-select\n                                                                class=\"mt-1\"\n                                                                :items=\"deliveryAgencies\"\n                                                                :item-text=\"(item) =>item.cusSup ? `${item.cusSup.number} - ${item.cusSup.name}`: ''\"\n                                                                item-value=\"id\"\n                                                                :rules=\"[(v) => !!v || 'Delivered by is required',]\"\n                                                                v-model=\"receiptOrder.deliveredBy\"\n                                                                tage=\"Delivered by\"\n                                                                return-object\n                                                                outlined\n                                                            />\n\n                                                        </v-col>\n                                                        <v-col sm=\"3\" cols=\"10\" class=\"pb-0\">\n                                                            <label class=\"label mb-0\">{{ $t(\"time\") }}</label>\n                                                            <v-menu\n                                                                v-model=\"menu2\"\n                                                                class=\"mt-1\"\n                                                                :close-on-content-click=\"false\"\n                                                                :nudge-right=\"40\"\n                                                                ref=\"menu\"\n                                                                transition=\"scale-transition\"\n                                                                :return-value.sync=\"receiptOrder.timeOfDischarged\"\n                                                                max-width=\"340\"\n                                                            >\n                                                                <template v-slot:activator=\"{ on, attrs }\">\n                                                                    <v-text-field\n                                                                        class=\"mt-1\"\n                                                                        v-model=\"receiptOrder.timeOfDischarged\"\n                                                                        readonly\n                                                                        outlined\n                                                                        append-icon=\"mdi-clock-time-four-outline\"\n                                                                        v-on=\"on\"\n                                                                        v-bind=\"attrs\"\n                                                                        @click:clear=\"receiptOrder.timeOfDischarged = null\"\n                                                                        @click:append=\"menu2 = true\"\n                                                                        required\n                                                                    />\n                                                                </template>\n                                                                <v-time-picker\n                                                                    v-if=\"menu2\"\n                                                                    v-model=\"receiptOrder.timeOfDischarged\"\n                                                                    full-width\n                                                                    no-title\n                                                                    @click:minute=\"$refs.menu.save(receiptOrder.timeOfDischarged)\"\n                                                                ></v-time-picker>\n                                                            </v-menu>\n                                                        </v-col>\n                                                        <v-col sm=\"2\" cols=\"12\" class=\"pb-0\">\n                                                            <label class=\"label  mb-0\">{{\n                                                                    $t(\"vehicle_number\")\n                                                                }}</label>\n                                                            <v-text-field\n                                                                class=\"mt-1\"\n                                                                v-model=\"receiptOrder.vehicleNumber\"\n                                                                outlined\n                                                                tage=\"Vehicle Number\"\n                                                                required\n                                                            />\n                                                        </v-col>\n                                                        <v-col sm=\"3\" cols=\"12\" class=\"pb-0\">\n                                                            <label class=\"label  mb-0\">{{\n                                                                    $t(\"references\")\n                                                                }}</label>\n                                                            <v-text-field\n                                                                class=\"mt-1\"\n                                                                tage=\"Driver References\"\n                                                                v-model=\"receiptOrder.driverReferences\"\n                                                                return-object\n                                                                outlined\n                                                            />\n                                                        </v-col>\n                                                    </v-row>\n                                                </v-col>\n                                            </v-row>\n                                        </v-col>\n                                    </v-row>\n                                    <v-divider/>\n                                    <v-card outlined dense class=\"no_border function_footer\">\n                                        <v-menu>\n                                            <template v-slot:activator=\"{ on }\">\n                                                <v-btn\n                                                    class=\"mr-2 text-capitalize  black--text float-left\"\n                                                    v-on=\"on\"\n                                                >\n                                                    {{ $t(\"select_template\") }}\n                                                    <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>\n                                                </v-btn>\n                                            </template>\n                                            <v-list>\n                                                <v-list-item\n                                                    v-for=\"(item, index) in templates\"\n                                                    :key=\"index\"\n                                                >\n                                                    <v-list-item-title>{{\n                                                            item.title\n                                                        }}\n                                                    </v-list-item-title>\n                                                </v-list-item>\n                                            </v-list>\n                                        </v-menu>\n                                        <v-btn\n                                            @click=\"cancel\"\n                                            color=\"black\"\n                                            outlined\n                                            class=\"text-capitalize  black--text float-left\"\n                                        >{{ $t(\"cancel\") }}\n                                        </v-btn>\n                                        <!-- <v-menu>\n                                          <template v-slot:activator=\"{ on }\">\n                                            <v-btn\n                                              color=\"primary\"\n                                              class=\"ml-2 float-right text-capitalize  white--text\"\n                                              v-on=\"on\"\n                                            >\n                                              {{ $t(\"save_option\") }}\n                                              <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>\n                                            </v-btn>\n                                          </template>\n                                          <v-list rounded>\n                                            <v-list-item-group>\n                                              <v-list-item>\n                                                <v-list-item-content>\n                                                  <v-list-item-title>\n                                                    {{ $t(\"save_new\") }}\n                                                  </v-list-item-title>\n                                                </v-list-item-content>\n                                              </v-list-item>\n                                              <v-list-item>\n                                                <v-list-item-content>\n                                                  <v-list-item-title\n                                                    >{{ $t(\"save_print\") }}\n                                                  </v-list-item-title>\n                                                </v-list-item-content>\n                                              </v-list-item>\n                                            </v-list-item-group>\n                                          </v-list>\n                                        </v-menu> -->\n                                        <v-btn\n                                            @click=\"saveNew\"\n                                            color=\"primary\"\n                                            class=\"float-right white--text text-capitalize \"\n                                        >\n                                            {{ $t(\"save_new\") }}\n                                        </v-btn>\n                                    </v-card>\n                                </v-form>\n                            </v-col>\n                        </v-row>\n                    </v-card>\n                    <v-dialog v-model=\"dialogS\" max-width=\"700px\" eager persistent>\n                        <v-card>\n                            <div class=\"modal_header\">\n                                <v-card-title>{{ $t(\"Serial\") }}</v-card-title>\n                                <v-icon @click=\"onCloseS\">close</v-icon>\n                            </div>\n                            <v-card-text class=\"modal_text_content\">\n                                <v-row>\n                                    <v-col sm=\"12\" cols=\"12\" class=\"pt-0\">\n                                        <kendo-datasource\n                                            ref=\"dataSource1\"\n                                            @change=\"dataSourceChangedS\"\n                                            :data=\"serials\"\n                                        />\n                                        <kendo-grid\n                                            id=\"gridS\"\n                                            class=\"grid-function\"\n                                            :data-source-ref=\"'dataSource1'\"\n                                            :sortable=\"false\"\n                                            :filterable=\"false\"\n                                            :column-menu=\"true\"\n                                            :editable=\"true\"\n                                            v-on:databound=\"dataBoundS\"\n                                            :scrollable-virtual=\"true\"\n                                        >\n                                            <kendo-grid-column\n                                                :title=\"$t('no.')\"\n                                                :width=\"55\"\n                                                :template=\"rowNumberS\"\n                                                :column-menu=\"false\"\n                                                :headerAttributes=\"{\n                                                    style: 'background-color: #EDF1F5;',\n                                                    class: 'text-variants',\n                                                  }\"\n                                                :attributes=\"{ style: 'text-align: variants' }\"\n                                            />\n                                            <kendo-grid-column\n                                                :field=\"'serialNumber1'\"\n                                                :title=\"$t('serial_number_1')\"\n                                                :width=\"150\"\n                                                :attribute=\"{class: 'k-state-disabled'}\"\n                                                :headerAttributes=\"{style: 'background-color: #EDF1F5', }\"\n                                            />\n                                            <kendo-grid-column\n                                                :field=\"'serialNumber2'\"\n                                                :title=\"$t('serial_number_2')\"\n                                                :width=\"150\"\n                                                :attributes=\"{ class: 'k-state-disabled isSerialNumber2'}\"\n                                                :headerAttributes=\"{style: 'background-color: #EDF1F5'}\"\n                                            />\n                                        </kendo-grid>\n                                    </v-col>\n                                </v-row>\n                            </v-card-text>\n                            <v-card-actions class=\"modal_footer\">\n                                <v-row>\n                                    <v-col sm=\"6\" cols=\"6\" class=\"py-0 text-left\">\n                                        <v-btn\n                                            color=\"black\"\n                                            outlined\n                                            class=\" text-capitalize  black--text float-left\"\n                                            @click=\"onCloseS\"\n                                        >{{ $t(\"cancel\") }}\n                                        </v-btn>\n                                    </v-col>\n                                    <v-col sm=\"6\" cols=\"6\" class=\"py-0 text-right\">\n                                        <v-btn\n                                            @click=\"addSerial\"\n                                            color=\"primary\"\n                                            class=\"px-3  white--text text-capitalize\"\n                                        >{{ $t(\"add\") }}\n                                        </v-btn>\n                                    </v-col>\n                                </v-row>\n                            </v-card-actions>\n                        </v-card>\n                    </v-dialog>\n                    <v-dialog v-model=\"dialog\" max-width=\"700px\" eager persistent>\n                        <v-card>\n                            <div class=\"modal_header\">\n                                <v-card-title>{{ $t(\"batch\") }}</v-card-title>\n                                <v-icon @click=\"onCloseBatch\">close</v-icon>\n                            </div>\n                            <v-card-text class=\"modal_text_content pa-4\">\n                                <v-row>\n                                    <v-col sm=\"12\" cols=\"12\" class=\"pt-0\">\n                                        <v-row>\n                                            <v-col sm=\"4\" cols=\"4\" class=\"py-1\">\n                                                <label class=\"label\">{{ $t(\"on_hand\") }}</label>\n                                                <h3 class=\"text-bold d-block py-1\">{{ amtBatch }}</h3>\n                                            </v-col>\n                                            <v-col sm=\"4\" cols=\"4\" class=\"py-1\">\n                                                <label class=\"label\">{{ $t(\"qty_received\") }}</label>\n                                                <h3 class=\"text-bold d-block py-1\">{{ qtyReceived }}</h3>\n                                            </v-col>\n                                            <v-col sm=\"4\" cols=\"4\" class=\"py-1\">\n                                                <label class=\"label\">{{ $t(\"total\") }}</label>\n                                                <h3 class=\"text-bold d-block py-1\">{{ amtBatch - qtyReceived }}</h3>\n                                            </v-col>\n                                        </v-row>\n                                    </v-col>\n                                    <v-col sm=\"12\" cols=\"12\" class=\"pt-1\">\n                                        <kendo-datasource\n                                            ref=\"dataSource2\"\n                                            @change=\"dataSourceChangedB\"\n                                            :data=\"batchs\"\n                                        />\n                                        <kendo-grid\n                                            id=\"gridBatch\"\n                                            class=\"grid-function\"\n                                            :data-source-ref=\"'dataSource2'\"\n                                            :sortable=\"false\"\n                                            :filterable=\"false\"\n                                            :column-menu=\"true\"\n                                            :editable=\"true\"\n                                            v-on:databound=\"dataBoundB\"\n                                            :scrollable-virtual=\"true\"\n                                        >\n                                            <kendo-grid-column\n                                                :command=\"{\n                                                        iconClass: 'k-icon k-i-trash',\n                                                        text: ' ',\n                                                        click: removeRowB,\n                                                        class: 'btn-plus',\n                                                      }\"\n                                                :title=\"'&nbsp;'\"\n                                                :width=\"50\"\n                                                :headerAttributes=\"{\n                            style:\n                              'text-align: right; background-color: #EDF1F5',\n                          }\"\n                                            />\n                                            <kendo-grid-column\n                                                :title=\"$t('no.')\"\n                                                :width=\"55\"\n                                                :template=\"rowNumberB\"\n                                                :column-menu=\"false\"\n                                                :headerAttributes=\"{\n                                                    style: 'background-color: #EDF1F5;',\n                                                    class: 'text-variants',\n                                                  }\"\n                                                :attributes=\"{ style: 'text-align: variants' }\"\n                                            />\n                                            <kendo-grid-column\n                                                :field=\"'number'\"\n                                                :title=\"$t('number')\"\n                                                :width=\"150\"\n                                                :headerAttributes=\"{style: 'background-color: #EDF1F5', }\"\n                                            />\n                                            <kendo-grid-column\n                                                :field=\"'expirationDate'\"\n                                                :title=\"$t('expiration_date')\"\n                                                :width=\"150\"\n                                                :template=\"ExpirationDateToTemplate\"\n                                                :editor=\"ExpirationDateToEditor\"\n                                                :attributes=\"{ class: 'k-state-disabled expirationDate'}\"\n                                                :headerAttributes=\"{style: 'background-color: #EDF1F5'}\"\n                                            />\n                                            <kendo-grid-column\n                                                :field=\"'qty'\"\n                                                :title=\"$t('qty')\"\n                                                :editor=\"numberEditorB\"\n                                                :width=\"100\"\n                                                :headerAttributes=\"{style: 'background-color: #EDF1F5', }\"\n                                            />\n                                        </kendo-grid>\n                                    </v-col>\n                                    <v-col cols=\"12\" class=\"py-0\">\n                                        <v-btn\n                                            v-if=\"totalBatch > 0\"\n                                            color=\"primary\"\n                                            class=\"float-left btn_plus rounded-4 white--text mr-2\"\n                                            @click=\"addRowB\"\n                                        >\n                                            <v-icon size=\"\" class=\"ma-1\">mdi-plus</v-icon>\n                                        </v-btn>\n                                    </v-col>\n                                </v-row>\n                            </v-card-text>\n                            <v-card-actions class=\"modal_footer\">\n                                <v-row>\n                                    <v-col sm=\"6\" cols=\"6\" class=\"py-0 text-left\">\n                                        <v-btn\n                                            color=\"black\"\n                                            outlined\n                                            class=\" text-capitalize  black--text float-left\"\n                                            @click=\"onCloseBatch\"\n                                        >{{ $t(\"cancel\") }}\n                                        </v-btn>\n                                    </v-col>\n                                    <v-col sm=\"6\" cols=\"6\" class=\"py-0 text-right\">\n                                        <v-btn\n                                            color=\"primary\"\n                                            @click=\"onSaveBatch\"\n                                            class=\"px-3  white--text text-capitalize\"\n                                        >{{ $t(\"add\") }}\n                                        </v-btn>\n                                    </v-col>\n                                </v-row>\n                            </v-card-actions>\n                        </v-card>\n                    </v-dialog>\n                </v-col>\n            </v-row>\n            <LoadingMe\n                :isLoading=\"showLoading\"\n                :fullPage=\"true\"\n                :myLoading=\"true\"\n                :alertMessage=\"loadingAlert\"\n                :color=\"loadingColorAlert\"\n                :alertText=\"loadingTextAlert\"\n            />\n        </v-container>\n    </v-app>\n</template>\n\n<script>\n// import kendo from '@progress/kendo-ui'\nimport {i18n} from \"@/i18n\";\nimport LoadingMe from \"@/components/Loading\";\nimport DatePickerComponent from \"@/components/custom_templates/DatePickerComponent\";\nimport ReceiptOrder from \"@/scripts/model/ReceiptOrder\";\nimport kendo from \"@progress/kendo-ui\";\nimport {DropDownList} from \"@progress/kendo-vue-dropdowns\";\n// import MonthOfPicker from \"@/components/kendo_templates/MonthOfPicker\";\nimport {ShowResource} from \"@/observable/store\";\nimport {uuid} from \"vue-uuid\";\nimport $ from \"jquery\";\nimport ItemLineModel from \"@/scripts/invoice/model/ItemLine\";\n\n// const transactionHandler = require(\"@/scripts/transactionHandler\");\n\n// const batchHandler = require(\"@/scripts/batchHandler\");\nconst warehouseHandler = require(\"@/scripts/warehouseHandler\");\n\nconst purchaseHandler = require(\"@/scripts/purchase/handler/billingHandler\");\nconst deliveryOrderHandler = require(\"@/scripts/deliveryOrderHandler\");\nconst receiptOrderHandler = require(\"@/scripts/receiptOrderHandler\");\nconst productVariantHandler = require(\"@/scripts/productVariantHandler\");\nconst prefixHandler = require(\"@/scripts/prefixHandler\");\nconst billingHandler = require(\"@/scripts/invoice/handler/billingHandler\");\nconst supplierHandler = require(\"@/scripts/supplierHandler\");\n// const settingsHandler = require(\"@/scripts/settingsHandler\");\n// const saleChannelHandler = require(\"@/scripts/saleChannelHandler\");\n// const locationHandler = require(\"@/scripts/locationHandler\");\n// const projectHandler = require(\"@/scripts/projectHandler\");\nconst uomPriceHandler = require(\"@/scripts/uomPriceHandler\");\nconst saleOrderHandler = require(\"@/scripts/transactionHandler\");\nconst receiptOrder = new ReceiptOrder({});\nconst keyField = \"id\";\nconst textField = \"name\";\nconst emptyItem = {[textField]: \"loading ...\"};\nconst itemLinePrefix = \"lin-\";\nexport default {\n    name: \"ReceiptOrder\",\n    components: {\n        LoadingMe: LoadingMe,\n        \"app-datepicker\": DatePickerComponent,\n        dropdownlist: DropDownList,\n        // \"app-monthpicker\": MonthOfPicker,\n    },\n    data: () => ({\n        menu2: false,\n        isEdit: false,\n        dialog: false,\n        // LoadingMe\n        showLoading: false,\n        loadingAlert: false,\n        loadingColorAlert: \"\",\n        loadingTextAlert: \"\",\n        bill_date: \"\",\n        alert: false,\n        deposite: 1000,\n        files: [],\n        // Form validation\n        valid: true,\n\n        templates: [\n            {title: \"Draft\"},\n            {title: \"Open\"},\n            {title: \"Partially Closed\"},\n            {title: \"Closed\"},\n        ],\n        col_expand: 9,\n        col_hide: 3,\n        isHideBar: false,\n\n        serials: [],\n        batchs: [],\n        warehouses: [],\n        receiptOrder: receiptOrder,\n        deliveryAgencies: [],\n\n        itemBatch: {},\n        uomBatch: {},\n        amtBatch: 0,\n        qtyReceived: 0,\n        totalBatch: 0,\n        showLoadingTxn: false,\n        purchaseOrders: [],\n        purchaseOrder: {},\n        poItemLine: [],\n        supplierList: [],\n        dataItemKey: \"id\",\n        textField: \"name\",\n        defaultItem: {[textField]: \"Select supplier...\", [keyField]: null},\n        supplierBaseUrl: supplierHandler.url(),\n        filter: \"\",\n        itemLines: [],\n        itemLinesS: [],\n        itemLinesBatch: [],\n        isClose: true,\n        dialogS: false,\n        hideS: true,\n        transactionTypes: []\n    }),\n    computed: {},\n    beforeRouteLeave(to, from, next) {\n        if (this.isClose) {\n            this.$swal({\n                title: i18n.t(\"msg_title_warning\"),\n                text: i18n.t(\"msg_discard\"),\n                icon: \"warning\",\n                showCancelButton: true,\n                cancelButtonText: i18n.t(\"cancel\"),\n                confirmButtonColor: \"#4d4848\",\n                cancelButtonColor: \"#ED1A3A\",\n                confirmButtonText: i18n.t(\"discard\"),\n            }).then((resultCen) => {\n                window.console.log(resultCen);\n                if (resultCen.value) {\n                    this.receiptOrder = receiptOrder;\n                    next()\n                }\n            });\n        } else {\n            next()\n        }\n    },\n    methods: {\n        dataBoundS: function (e) {\n            const grid = kendo.jQuery(\"#gridS\").data(\"kendoGrid\")\n            const items = e.sender.items();\n            items.each(function () {\n                let dataItem = grid.dataItem(this);\n                kendo\n                    .jQuery(\"tr[data-uid='\" + dataItem.uid + \"']\")\n                    .find(\".isSerialNumber2\")\n                    .each(function () {\n                        if (dataItem.isSerialNumber1 !== '') {\n                            kendo.jQuery(this).removeClass(\"k-state-disabled\");\n                        }\n                    });\n            });\n        },\n        addSerial() {\n            this.getDataSourceS()\n            window.console.log(this.itemLinesS, 'itemline s')\n        },\n        async getDataSourceS() {\n            let ds = this.$refs.dataSource1.kendoWidget();\n            let dataRow = ds.data();\n            const s = dataRow.filter(i => i.serialNumber1 === '')\n            if (s.length > 0) {\n                this.$snotify.error('Please check your serial number')\n                return\n            }\n            if (dataRow.length > 0) {\n                const instituteId = this.$store.state.institute.institute.id\n                receiptOrderHandler.getBatch(dataRow[0].item.id, this.receiptOrder.warehouse.id, instituteId, 'serial').then(res => {\n                    if (res.length > 0) {\n                        dataRow.forEach((i) => {\n                            if (i.serialNumber1 !== '') {\n                                const r = res.filter(p => p.serialNumber1 === i.serialNumber1)\n                                this.itemLinesS.push({\n                                    id: r.length > 0 ? r[0].linId : i.id,\n                                    item: i.item,\n                                    whId: this.receiptOrder.warehouse.id,\n                                    serialNumber1: i.serialNumber1,\n                                    serialNumber2: i.serialNumber2,\n                                    type: 'serial',\n                                    uom: i.uom,\n                                    createdAt: r.length > 0 ? r[0].createdAt : '',\n                                    status: i.status,\n                                    pk: r.length > 0 ? r[0].id : ''\n                                });\n                            }\n                        });\n                    } else {\n                        dataRow.forEach((i) => {\n                            if (i.serialNumber1 !== '') {\n                                this.itemLinesS.push({\n                                    id: i.id,\n                                    item: i.item,\n                                    uom: i.uom,\n                                    whId: this.receiptOrder.warehouse.id,\n                                    serialNumber1: i.serialNumber1,\n                                    serialNumber2: i.serialNumber2,\n                                    type: 'serial',\n                                    createdAt: '',\n                                    status: i.status,\n                                    pk: ''\n                                });\n                            }\n                        })\n                    }\n                })\n            }\n            this.onCloseS()\n        },\n        onChangePO(item) {\n            window.console.log(item, 'onchangePO')\n            this.receiptOrder.itemLines = []\n            this.purchaseOrder.itemLines.forEach(p => {\n                this.receiptOrder.itemLines.push({\n                    ...p,\n                    qtyReceived: p.qty - p.totalReceived,\n                    source: 'purchase order'\n                })\n            })\n            window.console.log(this.receiptOrder.itemLines, 'itemline')\n        },\n        async loadPurchaseOrders() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    let supplierId = \"\",\n                        whId = \"\",\n                        txnDate = \"\"\n                    if (this.receiptOrder.supplier) {\n                        supplierId = this.receiptOrder.supplier.id;\n                    }\n                    if (this.receiptOrder.warehouse) {\n                        whId = this.receiptOrder.warehouse.id\n                    }\n                    if (this.receiptOrder.date) {\n                        txnDate = this.receiptOrder.date;\n                    }\n                    let strFilter = \"\";\n                    if (supplierId !== \"\" && txnDate !== \"\" && whId !== \"\") {\n                        strFilter = \"?id=\" + supplierId + \"&whId=\" + whId + '&wType=RO&type=Purchase Order'\n                    }\n                    if (strFilter !== \"\") {\n                        this.showLoadingTxn = true\n                        saleOrderHandler\n                            .transactionFilter(strFilter)\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.showLoadingTxn = false\n                                    this.showLoading = false;\n                                    this.purchaseOrders = res.data.data;\n                                } else {\n                                    this.showLoadingTxn = false\n                                }\n                            })\n                    }\n                }, 10);\n            });\n        },\n        onCloseS() {\n            this.dialogS = false\n            this.serials = []\n        },\n        rowNumberS(dataItem) {\n            let ds = this.$refs.dataSource1.kendoWidget(),\n                index = ds.indexOf(dataItem);\n            return index + 1;\n        },\n        addRowSerial(item, uom, qty) {\n            for (let i = 0; i < qty; i++) {\n                let data = {\n                    id: itemLinePrefix + uuid.v1(),\n                    item: item,\n                    uom: uom,\n                    serialNumber1: '',\n                    serialNumber2: '',\n                    whId: this.receiptOrder.warehouse.id,\n                    status: 1\n                };\n                let ds = this.$refs.dataSource1.kendoWidget(),\n                    total = ds.total();\n                ds.insert(total, data);\n            }\n        },\n        dataSourceChangedS(e) {\n            if (e.field) {\n                let dataRow = e.items[0];\n                window.console.log(e, \"data source change\");\n                switch (e.field) {\n                    case \"serialNumber1\":\n                        kendo\n                            .jQuery(\"tr[data-uid='\" + dataRow.uid + \"']\")\n                            .find(\".isSerialNumber2\")\n                            .each(function () {\n                                if (dataRow.item.isSerialNumber1 !== '') {\n                                    kendo.jQuery(this).removeClass(\"k-state-disabled\");\n                                }\n                            });\n                }\n            }\n        },\n        recordSerial(e) {\n            e.preventDefault();\n            let grid = kendo.jQuery(\"#grid\").data(\"kendoGrid\")\n            let dataItem = grid.dataItem($(e.currentTarget).closest(\"tr\"))\n            if (dataItem.item.isSerialNumber === 2 && dataItem.qtyReceived > 0) {\n                if (this.itemLinesS.length > 0) {\n                    const s = this.itemLinesS.filter(p => p.item.id === dataItem.item.id)\n                    if (s.length === 0) {\n                        this.addRowSerial(dataItem.item, dataItem.uom, dataItem.qtyReceived)\n                    } else if (s.length < dataItem.qtyReceived) {\n                        this.serials = s\n                        this.addRowSerial(dataItem.item, dataItem.uom, dataItem.qtyReceived - s.length)\n                    } else {\n                        this.serials = s\n                    }\n                } else {\n                    this.addRowSerial(dataItem.item, dataItem.uom, dataItem.qtyReceived)\n                }\n                this.dialogS = true\n            }\n        },\n        dataBoundB: function (e) {\n            const grid = kendo.jQuery(\"#gridBatch\").data(\"kendoGrid\")\n            const items = e.sender.items();\n            items.each(function () {\n                let dataItem = grid.dataItem(this);\n                kendo\n                    .jQuery(\"tr[data-uid='\" + dataItem.uid + \"']\")\n                    .find(\".expirationDate\")\n                    .each(function () {\n                        if (dataItem.number !== '') {\n                            kendo.jQuery(this).removeClass(\"k-state-disabled\");\n                        }\n                    });\n            });\n        },\n        onSaveBatch() {\n            if ((this.amtBatch - this.qtyReceived) > 0) {\n                this.$snotify.error('Please check your Qty')\n                return\n            }\n            this.getDataSourceB()\n            window.console.log(this.itemLinesBatch, 'itemline b')\n        },\n        onCloseBatch() {\n            this.dialog = false\n            this.batchs = []\n        },\n        async getDataSourceB() {\n            let ds = this.$refs.dataSource2.kendoWidget();\n            let dataRow = ds.data();\n            if (dataRow.length > 0) {\n                const instituteId = this.$store.state.institute.institute.id\n                receiptOrderHandler.getBatch(dataRow[0].item.id, this.receiptOrder.warehouse.id, instituteId, 'batch').then(res => {\n                    if (res.length > 0) {\n                        dataRow.forEach((i) => {\n                            if (i.qty > 0) {\n                                const r = res.filter(p => p.number === i.number)\n                                this.itemLinesBatch.push({\n                                    id: r.length > 0 ? r[0].linId : i.id,\n                                    item: i.item,\n                                    uom: i.uom,\n                                    number: i.number,\n                                    whId: this.receiptOrder.warehouse.id,\n                                    expirationDate: i.expirationDate,\n                                    qty: r.length > 0 ? r[0].qty + i.qty : i.qty,\n                                    DQty: r.length > 0 ? r[0].DQty : 0,\n                                    type: 'batch',\n                                    status: i.status,\n                                    createdAt: r.length > 0 ? r[0].createdAt : '',\n                                    pk: r.length > 0 ? r[0].id : ''\n                                });\n                            }\n                        });\n                    } else {\n                        dataRow.forEach((i) => {\n                            if (i.qty > 0) {\n                                this.itemLinesBatch.push({\n                                    id: i.id,\n                                    item: i.item,\n                                    uom: i.uom,\n                                    number: i.number,\n                                    whId: this.receiptOrder.warehouse.id,\n                                    expirationDate: i.expirationDate,\n                                    qty: i.qty,\n                                    DQty: 0,\n                                    type: 'batch',\n                                    status: i.status,\n                                    pk: ''\n                                });\n                            }\n                        })\n                    }\n                })\n            }\n            this.onCloseBatch()\n        },\n        removeRowB(e) {\n            e.preventDefault();\n            const grid = kendo.jQuery(\"#gridBatch\").data(\"kendoGrid\"),\n                dataSource = grid.dataSource,\n                dataItem = grid.dataItem(kendo.jQuery(e.currentTarget).closest(\"tr\"));\n            if (dataSource.total() > 1) {\n                dataSource.remove(dataItem);\n                this.calcuateBatch()\n            }\n        },\n        rowNumberB(dataItem) {\n            let ds = this.$refs.dataSource2.kendoWidget(),\n                index = ds.indexOf(dataItem);\n            return index + 1;\n        },\n        async calcuateBatch() {\n            let ds = this.$refs.dataSource2.kendoWidget();\n            let dataRow = ds.data();\n            let amount = 0\n            dataRow.forEach((i) => {\n                amount += i.qty\n            });\n            this.qtyReceived = amount\n            this.totalBatch = this.amtBatch - amount\n        },\n        numberEditorB(container, options) {\n            kendo\n                .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoNumericTextBox({\n                    decimals: 30,\n                    min: 0,\n                    max: this.totalBatch\n                });\n        },\n        dataSourceChangedB(e) {\n            if (e.field) {\n                let dataRow = e.items[0];\n                window.console.log(e, \"data source change\");\n                switch (e.field) {\n                    case \"number\":\n                        kendo\n                            .jQuery(\"tr[data-uid='\" + dataRow.uid + \"']\")\n                            .find(\".expirationDate\")\n                            .each(function () {\n                                if (dataRow.number !== '') {\n                                    kendo.jQuery(this).removeClass(\"k-state-disabled\");\n                                }\n                            });\n                        if (dataRow.qty > 0) {\n                            this.calcuateBatch()\n                        }\n                        break;\n                    case \"expirationDate\":\n                        if (dataRow.qty > 0) {\n                            this.calcuateBatch()\n                        }\n                        kendo\n                            .jQuery(\"tr[data-uid='\" + dataRow.uid + \"']\")\n                            .find(\".expirationDate\")\n                            .each(function () {\n                                if (dataRow.number !== '') {\n                                    kendo.jQuery(this).removeClass(\"k-state-disabled\");\n                                }\n                            });\n                        break;\n                    case \"qty\":\n                        this.calcuateBatch()\n                        kendo\n                            .jQuery(\"tr[data-uid='\" + dataRow.uid + \"']\")\n                            .find(\".expirationDate\")\n                            .each(function () {\n                                if (dataRow.number !== '') {\n                                    kendo.jQuery(this).removeClass(\"k-state-disabled\");\n                                }\n                            });\n                        break;\n\n                }\n            }\n        },\n        addRowB() {\n            let data = {\n                id: itemLinePrefix + uuid.v1(),\n                item: this.itemBatch,\n                uom: this.uomBatch,\n                number: '',\n                expirationDate: '',\n                whId: this.receiptOrder.warehouse.id,\n                qty: 0,\n                status: 1\n            };\n            let ds = this.$refs.dataSource2.kendoWidget(),\n                total = ds.total();\n            ds.insert(total, data);\n        },\n        recordBatch(e) {\n            e.preventDefault();\n            let grid = kendo.jQuery(\"#grid\").data(\"kendoGrid\")\n            let dataItem = grid.dataItem($(e.currentTarget).closest(\"tr\"))\n            this.itemBatch = dataItem.item\n            this.uomBatch = dataItem.uom\n            if (dataItem.item.batchTracked === 1 && dataItem.qtyReceived > 0) {\n                this.amtBatch = dataItem.qtyReceived;\n                if (this.itemLinesBatch.length > 0) {\n                    let amount = 0\n                    this.batchs = this.itemLinesBatch.filter(p => p.item.id === dataItem.item.id)\n                    this.batchs.forEach(p => {\n                        amount += p.qty\n                    })\n                    this.totalBatch = this.amtBatch - amount || 0\n                } else {\n                    this.addRowB()\n                    this.totalBatch = dataItem.qtyReceived;\n                }\n                this.dialog = true\n            }\n        },\n        async onloadDeliveryAgency() {\n            await deliveryOrderHandler.getAllAgency().then((res) => {\n                this.deliveryAgencies = res;\n            });\n        },\n        numberEditor(container, options) {\n            kendo\n                .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoNumericTextBox({\n                    decimals: 30,\n                    min: 0,\n                    max: options.model.source === 'purchase order' ? (options.model.qty - options.model.totalReceived) : 2 ^ 100000000\n                });\n        },\n        headerTemplate() {\n            return `<input type='checkbox' id='header-chb' class='k-checkbox header-checkbox'>`;\n        },\n        Help(key) {\n            ShowResource(key);\n        },\n        dataSourceChanged(e) {\n            if (e.field) {\n                let dataRow = e.items[0];\n                window.console.log(e, \"data source change\");\n                switch (e.field) {\n                    case \"item\":\n                        kendo\n                            .jQuery(\"tr[data-uid='\" + dataRow.uid + \"']\")\n                            .find(\".isSerialNumber\")\n                            .each(function () {\n                                if (dataRow.item.isSerialNumber == 2) {\n                                    kendo.jQuery(this).removeClass(\"k-state-disabled\");\n                                }\n                            });\n                        kendo\n                            .jQuery(\"tr[data-uid='\" + dataRow.uid + \"']\")\n                            .find(\".isBatch\")\n                            .each(function () {\n                                if (dataRow.item.batchTracked === 1) {\n                                    kendo.jQuery(this).removeClass(\"k-state-disabled\");\n                                }\n                            });\n                        kendo\n                            .jQuery(\"tr[data-uid='\" + dataRow.uid + \"']\")\n                            .find(\".isUOM\")\n                            .each(function () {\n                                if (dataRow.source === '') {\n                                    kendo.jQuery(this).removeClass(\"k-state-disabled\");\n                                }\n                            });\n                        break;\n                    case \"qty\":\n                        break;\n                }\n            }\n        },\n        ExpirationDateToTemplate(dataItem) {\n            const expirationDate = dataItem.expirationDate;\n            if (expirationDate) {\n                return `<span>${\n                    expirationDate\n                        ? kendo.toString(new Date(expirationDate), `dd-MM-yyyy`)\n                        : ``\n                }</span>`;\n            } else {\n                return ``;\n            }\n        },\n        dataBound: function (e) {\n            const grid = kendo.jQuery(\"#grid\").data(\"kendoGrid\")\n            const items = e.sender.items();\n            items.each(function () {\n                let dataItem = grid.dataItem(this);\n                kendo\n                    .jQuery(\"tr[data-uid='\" + dataItem.uid + \"']\")\n                    .find(\".isSerialNumber\")\n                    .each(function () {\n                        if (dataItem.item.isSerialNumber == 2) {\n                            kendo.jQuery(this).removeClass(\"k-state-disabled\");\n                        }\n                    });\n                kendo\n                    .jQuery(\"tr[data-uid='\" + dataItem.uid + \"']\")\n                    .find(\".isBatch\")\n                    .each(function () {\n                        if (dataItem.item.batchTracked == 1) {\n                            kendo.jQuery(this).removeClass(\"k-state-disabled\");\n                        }\n                    });\n                kendo\n                    .jQuery(\"tr[data-uid='\" + dataItem.uid + \"']\")\n                    .find(\".isUOM\")\n                    .each(function () {\n                        if (dataItem.source === '') {\n                            kendo.jQuery(this).removeClass(\"k-state-disabled\");\n                        }\n                    });\n            });\n        },\n        addRow() {\n            let data = {\n                id: itemLinePrefix + uuid.v1(),\n                item: {name: \"\"},\n                description: '',\n                qty: 0,\n                uom: {},\n                totalReceived: 0,\n                qtyReceived: 0,\n                source: ''\n            };\n            let ds = this.$refs.dataSource.kendoWidget(),\n                total = ds.total();\n            ds.insert(total, data);\n            this.qtyAdd = 0;\n        },\n        ExpirationDateToEditor(container, options) {\n            kendo\n                .jQuery('<input required name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDatePicker();\n        },\n        ItemDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"contains\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    headerTemplate:\n                        '<div class=\"dropdown-header k-widget k-header\">' +\n                        \"<span>Items </span>\" +\n                        \"<span></span>\" +\n                        \"</div>\",\n                    template: \"<span>#=name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        serverFiltering: true,\n                        transport: {\n                            read: {\n                                url: productVariantHandler.itemSearchURL(),\n                            },\n                            dataType: \"json\",\n                        },\n                        schema: {\n                            model: {\n                                id: \"id\",\n                                fields: {\n                                    id: {type: \"string\"},\n                                    name: {type: \"string\"},\n                                    sku: {type: \"string\"},\n                                },\n                            },\n                            data: function (response) {\n                                return response.data.filter(p => p.type === 'Variant')\n                            },\n                            total: function (response) {\n                                return response.data.filter(p => p.type === 'Variant').length;\n                            },\n                        },\n                        // data: this.variants\n                    }),\n                });\n        },\n        UOMDropDownEditor(container, options) {\n            if (options.model.source === '') {\n                kendo\n                    .jQuery('<input name=\"' + options.field + '\"/>')\n                    .appendTo(container)\n                    .kendoDropDownList({\n                        autoBind: true,\n                        autoWidth: true,\n                        height: 400,\n                        filter: \"startswith\",\n                        dataTextField: \"uom.name\",\n                        dataValueField: \"uom.id\",\n                        cascadeFrom: \"item\",\n                        template: \"<span>#=uom.name#</span>\",\n                        optionLabel: \"--- Select ---\",\n                        dataSource: new kendo.data.DataSource({\n                            serverFiltering: true,\n                            transport: {\n                                read: {\n                                    url: uomPriceHandler.uomPriceByPriceLevelURL(\n                                        \"id=\" +\n                                        options.model.item.id +\n                                        \"&plId=\" +\n                                        this.receiptOrder.priceLevel.id +\n                                        \"&date=\" +\n                                        this.receiptOrder.date\n                                    ),\n                                },\n                                dataType: \"json\",\n                            },\n                            schema: {\n                                model: {\n                                    id: \"id\",\n                                    fields: {\n                                        id: {type: \"string\"},\n                                        // name: {type: \"string\"},\n                                        // sku: {type: \"string\"},\n                                    },\n                                },\n                                data: function (response) {\n                                    return response.data;\n                                },\n                                total: function (response) {\n                                    return response.data.count;\n                                },\n                            },\n                            // data: this.variants\n                        }),\n                    });\n            } else {\n                return false\n            }\n        },\n        UOMTemplate(dataItem) {\n            const uom = dataItem.uom;\n            if (uom) {\n                return `<span>${uom.uom ? uom.uom.name : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        removeRow(e) {\n            e.preventDefault();\n            const grid = kendo.jQuery(\"#grid\").data(\"kendoGrid\"),\n                dataSource = grid.dataSource,\n                dataItem = grid.dataItem(kendo.jQuery(e.currentTarget).closest(\"tr\"));\n\n            if (dataSource.total() > 1) {\n                dataSource.remove(dataItem);\n            }\n        },\n        rowNumber(dataItem) {\n            let ds = this.$refs.dataSource.kendoWidget(),\n                index = ds.indexOf(dataItem);\n            return index + 1;\n        },\n        async onloadWarehouse() {\n            await warehouseHandler.getWarehouseSettingAll().then(async (res) => {\n                this.warehouses = res;\n                if (this.warehouses.length > 0) {\n                    this.receiptOrder.warehouse = this.warehouses[0];\n                }\n            });\n        },\n        async onChangeWarehouse() {\n            // await this.loadZone(receiptOrder.warehouse.id)\n        },\n        async onChange(event) {\n            const value = event.value;\n            if (value && value[textField] === emptyItem[textField]) {\n                return;\n            }\n            this.showLoading = true;\n            window.console.log(value);\n            this.receiptOrder.supplier = value;\n            this.receiptOrder.priceLevel = value.priceLevel;\n            await this.loadPurchaseOrders()\n            // await this.onloadPurchase(value.id);\n        },\n        async onloadPurchase(id) {\n            await purchaseHandler.byCustomer(id).then((res) => {\n                window.console.log(res, \"list purchase by customer\");\n            });\n            this.showLoading = false;\n        },\n        onFilterChange(event) {\n            const filter = event.filter.value;\n            this.requestData(0, filter, this.supplierBaseUrl);\n            this.filter = filter;\n        },\n        requestData(skip, filter, baseUrl) {\n            const url = baseUrl + `/${filter}`;\n            this.requestStarted = true;\n            fetch(url)\n                .then((response) => {\n                    // window.console.log(response.json())\n                    return response.json();\n                })\n                .then(this.afterFetch);\n        },\n        afterFetch(json) {\n            this.supplierList = json.data;\n        },\n        async loadPrefix() {\n            this.showLoading = true;\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    prefixHandler.get(\"receipt order\").then((res) => {\n                        if (res.data.statusCode === 200) {\n                            // this.showLoading = false\n                            this.transactionTypes = res.data.data;\n                            if (this.transactionTypes.length > 0) {\n                                this.receiptOrder.transactionType = this.transactionTypes[0];\n                                if (this.$route.params.id === undefined) {\n                                    this.generateNumber();\n                                }\n                            }\n                        }\n                    });\n                }, 300);\n            });\n            // await this.onloadBatch();\n            await this.onloadWarehouse();\n            // await this.loadSaleChannel();\n            // await this.loadLocation();\n            await this.onloadDeliveryAgency();\n            // await this.loadProjects()\n            // await this.loadSegment()\n            // await this.loadZone(this.warehouses[0].id)\n            this.showLoading = false;\n        },\n        generateNumber() {\n            let data = {\n                abbr: this.receiptOrder.transactionType.abbr,\n                structure: this.receiptOrder.transactionType.structure,\n                transactionDate: this.receiptOrder.date,\n                sequcencing: this.receiptOrder.transactionType.sequcencing,\n                type: \"Receipt Order\",\n                entity: 3,\n            };\n            this.receiptOrder.abbr = data.abbr;\n            this.receiptOrder.structure = data.structure;\n            this.receiptOrder.sequcencing = data.sequcencing;\n            this.receiptOrder.type = data.type;\n            this.receiptOrder.transactionDate = data.transactionDate;\n            billingHandler\n                .lastNumber(data)\n                .then((response) => {\n                    if (response.data.statusCode === 200) {\n                        const res = response.data.data;\n                        const lastNumber = this.zeroPad(\n                            parseInt(res.lastNumber),\n                            this.receiptOrder.transactionType.format\n                        );\n                        this.receiptOrder.number =\n                            res.suffix +\n                            this.receiptOrder.transactionType.numberSeparator +\n                            lastNumber;\n                        this.receiptOrder.lastNumber = res.suffix + lastNumber;\n                        window.console.log(this.receiptOrder.number, \"bom\");\n                    }\n                })\n                .catch((e) => {\n                    this.errors.push(e);\n                });\n        },\n        zeroPad(num, places) {\n            return String(num).padStart(places, \"0\");\n        },\n        suffix(transactionDate) {\n            return kendo.toString(new Date(transactionDate), `yymm`);\n        },\n        savePrint() {\n        },\n        async getDataSource() {\n            let ds = this.$refs.dataSource.kendoWidget();\n            let dataRow = ds.data();\n            this.itemLines = [];\n            dataRow.forEach((i) => {\n                if (i.qtyReceived > 0 && i.source === 'purchase order') {\n                    const line = i\n                    line.totalReceived = i.qtyReceived\n                    this.poItemLine.push({\n                        item: i.item,\n                        transactionType: this.purchaseOrder.transactionType,\n                        uom: i.uom,\n                        id: i.id,\n                        number: this.purchaseOrder.number,\n                        data: i.item.id,\n                        qty: i.qty,\n                        line: new ItemLineModel(line),\n                        deleted: 0,\n                        price: 0,\n                        type: 'Purchase Order',\n                        customer: {},\n                        status: i.status,\n                        createdAt: i.createdAt\n                    })\n                }\n                this.itemLines.push({\n                    id: i.id,\n                    item: i.item,\n                    qty: i.qty,\n                    description: i.description,\n                    uom: i.uom,\n                    totalReceived: i.totalReceived,\n                    qtyReceived: i.qtyReceived,\n                });\n            });\n        },\n        async saveNew() {\n            this.showLoading = true;\n            await this.getDataSource();\n            window.console.log(this.poItemLine, this.purchaseOrder.id, 'poItemLine')\n            if (this.poItemLine.length > 0) {\n                await warehouseHandler.addItemLine(this.purchaseOrder.id, this.poItemLine).then(res => {\n                    if (res.data.statusCode !== 200) {\n                        this.$snotify.error('Error Update ItemLine!!!')\n                    }\n                })\n            }\n            this.receiptOrder.purchaseOrderId = this.purchaseOrder ? this.purchaseOrder.id : ''\n            this.receiptOrder.purchaseOrderRef = this.purchaseOrder ? this.purchaseOrder.referenceNo : ''\n            this.receiptOrder.itemLines = this.itemLines;\n            this.receiptOrder.itemLinesSerial = this.itemLinesS\n            this.receiptOrder.itemLinesBatch = this.itemLinesBatch\n            this.receiptOrder.transactionDate = this.receiptOrder.date;\n            receiptOrderHandler.save(this.receiptOrder).then((res) => {\n                window.console.log(res);\n                this.isClose = false\n                this.cancel();\n                this.showLoading = false;\n            });\n        },\n        saveClose() {\n        },\n        errorMessage() {\n        },\n        accountDropDownEditor() {\n        },\n        cancel() {\n            this.itemLines = []\n            this.poItemLine = []\n            this.itemLinesS = []\n            this.itemLinesBatch = []\n            this.batchs = []\n            this.serials = []\n            this.purchaseOrders = []\n            this.purchaseOrder = {}\n            this.itemBatch = {}\n            this.receiptOrder = receiptOrder\n            this.$router.go(-1);\n        },\n        hide_smallsitebar() {\n            if (!this.isHideBar) {\n                // this.col_expand = 12\n                // this.col_hide = 0\n                this.isHideBar = true;\n            } else {\n                // this.col_expand = 9\n                // this.col_hide = 3\n                this.isHideBar = false;\n            }\n        },\n    },\n    watch: {\n        // call again the method if the route changes\n    },\n    created() {\n        // fetch the data when the view is created and the data is\n        // already being observed\n        // this.loadObj()\n    },\n    async mounted() {\n        this.requestData(0, \"\", supplierHandler.url());\n        this.addRow();\n        await this.loadPrefix();\n    },\n};\n</script>\n\n<style scoped>\n.k-dropdown {\n    width: 100%;\n    margin-top: 3px;\n}\n\n.function_wrapper {\n    box-shadow: none !important;\n}\n\n.v-application--is-ltr .v-text-field .v-input__append-inner {\n    margin-top: 0 !important;\n}\n\n.v-input__slot {\n    background-color: #fff !important;\n}\n\n.function_content .label {\n    margin-bottom: 10px;\n    display: inline-block;\n}\n\n.border_radius10 {\n    border-radius: 10px !important;\n    background-color: #f2f2f2;\n}\n\n.pa-3.v-card h4 {\n    font-size: 18px;\n    color: #333;\n}\n\n.pa-3.v-card p {\n    font-size: 12px;\n    color: #b5b5b5;\n}\n\n.custom_grid table th:last-child {\n    text-align: right !important;\n}\n\n@media (min-width: 1264px) {\n    .container {\n        max-width: 1080px !important;\n    }\n}\n\n@media (max-width: 576px) {\n    .pt-6.col-sm-5.col-12 {\n        padding-top: 0 !important;\n    }\n\n    .code_text {\n        width: 100%;\n    }\n\n    .phone_no_pt {\n        padding-top: 0 !important;\n    }\n\n    .select_template,\n    .save_option {\n        margin-bottom: 10px;\n    }\n}\n\n.hide_small_bar_class {\n    max-width: 0;\n    transition: 0.5s ease-in;\n    flex: 0 0 0;\n}\n\n.hide_big_bar_class {\n    max-width: 100%;\n    transition: 0.5s ease-in;\n    flex: 0 0 100%;\n}\n\n.info_add {\n    background-color: #ffffff;\n}\n\n.small_sidebar {\n    height: 96%;\n    position: relative;\n    padding: 12px;\n    background-color: #edf1f5;\n}\n\n.iconArrow {\n    right: -35px;\n    position: absolute;\n    bottom: -10px;\n}\n\n.iconArrowHide {\n    position: absolute;\n    right: -7px;\n    bottom: -10px;\n}\n\n.color_grey {\n    color: #808080;\n}\n\n.card_green {\n    min-height: 70px;\n    background-color: #00b050 !important;\n    color: #ffffff;\n}\n\n.lb_bold {\n    font-size: 12px;\n}\n\n.detial_smallside_p {\n    position: absolute;\n    bottom: 10px;\n}\n\n.card_background {\n    background-color: #edf1f5;\n    min-height: 120px;\n}\n\n.deposite_input {\n    width: 100px;\n}\n\n.btn_save_draft {\n    color: #ffffff;\n    background-color: #00b0f0 !important;\n    text-transform: capitalize;\n}\n\n.save_option {\n    background-color: #203864 !important;\n}\n\n.btn_add_small {\n    height: 27px !important;\n    min-width: 25px !important;\n    font-size: 10px;\n    padding: 0 22px !important;\n    background-color: #00b050 !important;\n    color: #ffffff;\n    border-radius: 0 !important;\n}\n\n.list_site_inv {\n    background-color: #92d050;\n    color: #ffffff;\n    font-size: 12px;\n}\n\n.list_site_exp {\n    background-color: #c5e0b4;\n    color: #000000;\n    font-size: 12px;\n    line-height: 16px;\n    min-height: 40px;\n}\n\n.checkbox_inv {\n    padding: 2px;\n    margin-top: 3px;\n    margin-right: 2px;\n}\n\n.exp_select {\n    font-size: 12px !important;\n}\n\n.v-data-table__wrapper td {\n    border-bottom: 1px solid #808080;\n    border-top: 1px solid #808080;\n}\n</style>\n"]}]}