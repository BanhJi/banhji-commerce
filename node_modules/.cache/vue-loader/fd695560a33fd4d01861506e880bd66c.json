{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/suppliers/Expenses.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/suppliers/Expenses.vue","mtime":1642155812728},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7aTE4bn0gZnJvbSAiQC9pMThuIjsKaW1wb3J0IGtlbmRvIGZyb20gIkBwcm9ncmVzcy9rZW5kby11aSI7CmltcG9ydCBIZWxwZXIgZnJvbSAiQC9oZWxwZXIuanMiOwoKaW1wb3J0IHsKICAgIEV4cGVuc2VNb2RlbCwKICAgIEV4cGVuc2VFbnRyeU1vZGVsLAogICAgRXhwZW5zZUVudHJ5RXh0ZW5kZWRNb2RlbCwKICAgIEpvdXJuYWxNb2RlbCwKICAgIEpvdXJuYWxFbnRyeU1vZGVsLAogICAgQWNjb3VudE1vZGVsLAogICAgQ3VycmVuY3lNb2RlbCwKICAgIEV4Y2hhbmdlUmF0ZU1vZGVsLAogICAgUGF5bWVudFRlcm1Nb2RlbCwKICAgIFN1cHBsaWVyTW9kZWwsCiAgICBFbXBsb3llZU1vZGVsLAogICAgQ29udGFjdE1vZGVsLAogICAgQ2xhc3NNb2RlbCwKICAgIFVvbU1vZGVsLAogICAgTG9jYXRpb25Nb2RlbCwKICAgIFNlZ21lbnRNb2RlbCwKICAgIFByb2plY3RNb2RlbCwKICAgIERpc2NvdW50SXRlbU1vZGVsLAogICAgVGF4TW9kZWwsCiAgICBFeHBlbnNlcywKICAgIFB1cmNoYXNlRm9ybUNvbnRlbnQsCn0gZnJvbSAiQC9zY3JpcHRzL21vZGVsL0FwcE1vZGVscyI7CmltcG9ydCBSZXNwb25zZURhdGFNb2RlbCBmcm9tICJAL3NjcmlwdHMvbW9kZWwvUmVzcG9uc2VEYXRhIjsKaW1wb3J0IHtTaG93UmVzb3VyY2V9IGZyb20gIkAvb2JzZXJ2YWJsZS9zdG9yZSI7CgovKiBFZGl0b3JzICovCmltcG9ydCBBY2NvdW50U2Vjb25kYXJ5RWRpdG9yIGZyb20gIkAvc2NyaXB0cy9rZW5kb19lZGl0b3IvQWNjb3VudFNlY29uZGFyeSI7CmltcG9ydCBDbGFzc0VkaXRvciBmcm9tICJAL3NjcmlwdHMva2VuZG9fZWRpdG9yL0NsYXp6IjsKaW1wb3J0IFVvbUVkaXRvciBmcm9tICJAL3NjcmlwdHMva2VuZG9fZWRpdG9yL1VvbSI7CmltcG9ydCBQdXJjaGFzZURpc2NvdW50SXRlbUVkaXRvciBmcm9tICJAL3NjcmlwdHMva2VuZG9fZWRpdG9yL1B1cmNoYXNlRGlzY291bnRJdGVtIjsKaW1wb3J0IFB1cmNoYXNlVGF4RWRpdG9yIGZyb20gIkAvc2NyaXB0cy9rZW5kb19lZGl0b3IvUHVyY2hhc2VUYXgiOwoKLyogU3RvcmUgKi8KaW1wb3J0IHN0b3JlIGZyb20gIkAvc3RvcmUiOwppbXBvcnQgcGF5bWVudFRlcm1IYW5kbGVyXyBmcm9tICJAL3NjcmlwdHMvcGF5bWVudHRlcm0vaGFuZGxlci9wYXltZW50VGVybUhhbmRsZXIiOwppbXBvcnQgQWNjb3VudE1hcHBpbmdNb2RlbCBmcm9tICJAL3NjcmlwdHMvYWNjb3VudC1tYXAvQWNjb3VudCI7CmltcG9ydCB7dXVpZH0gZnJvbSAidnVlLXV1aWQiOwppbXBvcnQgc2FsZU9yZGVySGFuZGxlciBmcm9tICJAL3NjcmlwdHMvdHJhbnNhY3Rpb25IYW5kbGVyIjsKCmNvbnN0IGluc3RpdHV0ZSA9IHN0b3JlLnN0YXRlLmluc3RpdHV0ZS5pbnN0aXR1dGU7CgovKiBIYW5kbGVycyAqLwpjb25zdCB7CiAgICBleHBlbnNlSGFuZGxlciwKICAgIGNhc2hBZHZhbmNlSGFuZGxlciwKICAgIGpvdXJuYWxIYW5kbGVyLAp9ID0gcmVxdWlyZSgiQC9zY3JpcHRzL0FwcEhhbmRsZXJzIik7CmNvbnN0IHB1cmNoYXNlRm9ybUNvbnRlbnRIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3B1cmNoYXNlRm9ybUNvbnRlbnRIYW5kbGVyIik7CmNvbnN0IGJpbGxpbmdIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2ludm9pY2UvaGFuZGxlci9iaWxsaW5nSGFuZGxlciIpOwoKY29uc3QgewogICAgRW50aXR5VHlwZSwKICAgIFNhdmVPcHRpb24sCiAgICBBY2NvdW50VHlwZUNvZGUsCiAgICBUYXhUeXBlLAogICAgU2V0dGluZywKfSA9IHJlcXVpcmUoIkAvc2NyaXB0cy9kZWZhdWx0X3NldHVwL0NvbGxlY3Rpb25zIik7CgpleHBvcnQgZGVmYXVsdCB7CiAgICBuYW1lOiAiRXhwZW5zZSIsCiAgICBjb21wb25lbnRzOiB7CiAgICAgICAgTG9hZGluZ01lOiAoKSA9PiBpbXBvcnQoIkAvY29tcG9uZW50cy9Mb2FkaW5nIiksCiAgICAgICAgImFwcC1kYXRlcGlja2VyIjogKCkgPT4KICAgICAgICAgICAgaW1wb3J0KCJAL2NvbXBvbmVudHMvY3VzdG9tX3RlbXBsYXRlcy9EYXRlUGlja2VyQ29tcG9uZW50IiksCiAgICAgICAgImFwcC1tb250aG9mLXBpY2tlciI6ICgpID0+CiAgICAgICAgICAgIGltcG9ydCgiQC9jb21wb25lbnRzL2tlbmRvX3RlbXBsYXRlcy9Nb250aE9mUGlja2VyIiksCiAgICAgICAgImFwcC1jdXJyZW5jeS1kcm9wZG93bmxpc3QiOiAoKSA9PgogICAgICAgICAgICBpbXBvcnQoIkAvY29tcG9uZW50cy9kcm9wZG93bmxpc3QvQ3VycmVuY3kiKSwKICAgICAgICAiYXBwLXBheW1lbnQtdGVybS1wdXJjaGFzZS1kcm9wZG93bmxpc3QiOiAoKSA9PiBpbXBvcnQoIkAvY29tcG9uZW50cy9kcm9wZG93bmxpc3QvUGF5bWVudFRlcm1QdXJjaGFzZSIpLAogICAgICAgICJhcHAtbG9jYXRpb24tZHJvcGRvd25saXN0IjogKCkgPT4KICAgICAgICAgICAgaW1wb3J0KCJAL2NvbXBvbmVudHMvZHJvcGRvd25saXN0L0xvY2F0aW9uIiksCiAgICAgICAgImFwcC1lbXBsb3llZS1kcm9wZG93bmxpc3QiOiAoKSA9PgogICAgICAgICAgICBpbXBvcnQoIkAvY29tcG9uZW50cy9kcm9wZG93bmxpc3QvRW1wbG95ZWUiKSwKICAgICAgICAiYXBwLXByb2plY3QtZHJvcGRvd25saXN0IjogKCkgPT4KICAgICAgICAgICAgaW1wb3J0KCJAL2NvbXBvbmVudHMvZHJvcGRvd25saXN0L1Byb2plY3QiKSwKICAgICAgICAiYXBwLXNlZ21lbnQtZHJvcGRvd25saXN0IjogKCkgPT4KICAgICAgICAgICAgaW1wb3J0KCJAL2NvbXBvbmVudHMvZHJvcGRvd25saXN0L1NlZ21lbnQiKSwKICAgICAgICAiYXBwLXN1cHBsaWVyLWRyb3Bkb3dubGlzdCI6ICgpID0+CiAgICAgICAgICAgIGltcG9ydCgiQC9jb21wb25lbnRzL2Ryb3Bkb3dubGlzdC9TdXBwbGllciIpLAogICAgICAgICJhcHAtc2Vjb25kYXJ5LWFjY291bnQtZHJvcGRvd25saXN0IjogKCkgPT4gaW1wb3J0KCdAL2NvbXBvbmVudHMvZHJvcGRvd25saXN0L0FjY291bnRTZWNvbmRhcnknKSwKICAgIH0sCiAgICBwcm9wczogewogICAgICAgIGluaXRFeHBlbnNlOiB7CiAgICAgICAgICAgIHR5cGU6IEV4cGVuc2VNb2RlbCwKICAgICAgICB9LAogICAgfSwKICAgIGRhdGE6ICgpID0+ICh7CiAgICAgICAgLy8gT2JqCiAgICAgICAgZXhwZW5zZTogbmV3IEV4cGVuc2VNb2RlbCgpLAogICAgICAgIGpvdXJuYWw6IG5ldyBKb3VybmFsTW9kZWwoKSwKICAgICAgICBqb3VybmFsRW50cmllczogW10sCiAgICAgICAgZW1wbG95ZWU6IG5ldyBFbXBsb3llZU1vZGVsKCksCiAgICAgICAgc3VwcGxpZXI6IG5ldyBTdXBwbGllck1vZGVsKCksCiAgICAgICAgcGF5bWVudFRlcm06IG5ldyBQYXltZW50VGVybU1vZGVsKCksCiAgICAgICAgY3VycmVuY3k6IG5ldyBDdXJyZW5jeU1vZGVsKGluc3RpdHV0ZS5iYXNlQ3VycmVuY3kpLAogICAgICAgIGV4Y2hhbmdlUmF0ZTogbmV3IEV4Y2hhbmdlUmF0ZU1vZGVsKGluc3RpdHV0ZS5iYXNlQ3VycmVuY3kpLAogICAgICAgIGFkdmFuY2VTZXR0bGVtZW50Q2xlYXJpbmdBY2NvdW50OiBuZXcgQWNjb3VudE1vZGVsKCksCiAgICAgICAgb3RoZXJDbGVhcmluZ1N1c3BlbnNlQWNjb3VudDogbmV3IEFjY291bnRNb2RlbCgpLAogICAgICAgIHNlY29uZGFyeUFjY291bnQ6IG5ldyBBY2NvdW50TW9kZWwoKSwKICAgICAgICBsb2NhdGlvbjogbmV3IExvY2F0aW9uTW9kZWwoKSwKICAgICAgICBzZWdtZW50OiBuZXcgU2VnbWVudE1vZGVsKCksCiAgICAgICAgcHJvamVjdDogbmV3IFByb2plY3RNb2RlbCgpLAogICAgICAgIC8vIExpc3QKICAgICAgICBjYXNoQWR2YW5jZXM6IFtdLAogICAgICAgIGFjY291bnRzOiBbXSwKICAgICAgICBleHBlbnNlQWNjb3VudHM6IFtdLAogICAgICAgIHRyYW5zYWN0aW9uQWNjb3VudHM6IFtdLAogICAgICAgIGV4cGVuc2VFbnRyaWVzOiBbXSwKICAgICAgICAvLyBPdGhlcgogICAgICAgIHN1YlRvdGFsOiAwLAogICAgICAgIGRpc2NvdW50QW1vdW50OiAwLAogICAgICAgIHB1cmNoYXNlVGF4OiAwLAogICAgICAgIHdoZFRheDogMCwKICAgICAgICB0b3RhbEFtb3VudDogMCwKICAgICAgICBzdXBwbGllckRlcG9zaXRBbW91bnQ6IDAsCiAgICAgICAgZGVwb3NpdEFtb3VudDogMCwKICAgICAgICBhbW91bnREdWU6IDAsCiAgICAgICAgaGFzQWRkaXRpb25hbENvc3Q6IGZhbHNlLAogICAgICAgIGZpbGVzOiBbXSwKICAgICAgICB1c2VyOiBIZWxwZXIuZ2V0VXNlcigpLAogICAgICAgIHRlbXBsYXRlczogW10sCiAgICAgICAgbWF4RGVjaW1hbDogU2V0dGluZy5NQVhfREVDSU1BTCwKICAgICAgICBkaXNhYmxlUHJvamVjdDogZmFsc2UsCiAgICAgICAgLy8gRm9ybSB2YWxpZGF0aW9uCiAgICAgICAgdmFsaWQ6IHRydWUsCiAgICAgICAgaXNFZGl0OiBmYWxzZSwKICAgICAgICBhbGVydDogZmFsc2UsCiAgICAgICAgZXJyb3JNZXNzYWdlOiAiIiwKICAgICAgICBzYXZlTW9kZTogIiIsCiAgICAgICAgU2F2ZU9wdGlvbjogU2F2ZU9wdGlvbiwKICAgICAgICAvLyBFZGl0b3JzCiAgICAgICAgQWNjb3VudFNlY29uZGFyeUVkaXRvcjogQWNjb3VudFNlY29uZGFyeUVkaXRvciwKICAgICAgICBDbGFzc0VkaXRvcjogQ2xhc3NFZGl0b3IsCiAgICAgICAgVW9tRWRpdG9yOiBVb21FZGl0b3IsCiAgICAgICAgUHVyY2hhc2VEaXNjb3VudEl0ZW1FZGl0b3I6IFB1cmNoYXNlRGlzY291bnRJdGVtRWRpdG9yLAogICAgICAgIFB1cmNoYXNlVGF4RWRpdG9yOiBQdXJjaGFzZVRheEVkaXRvciwKICAgICAgICAvLyBTaWRlYmFyCiAgICAgICAgY29sX2V4cGFuZDogOSwKICAgICAgICBjb2xfaGlkZTogMywKICAgICAgICBpc0hpZGVCYXI6IGZhbHNlLAogICAgICAgIC8vIExvYWRpbmdNZQogICAgICAgIHNob3dMb2FkaW5nOiBmYWxzZSwKICAgICAgICBzaG93Q2FzaEFkdmFuY2VMb2FkaW5nOiBmYWxzZSwKICAgICAgICAvLyBCeSBCIE5pbW9sCiAgICAgICAgZGVjaW1hbEZvcm1hdDogIm4yIiwKICAgICAgICBwdXJjaGFzZUZvcm1Db250ZW50OiBQdXJjaGFzZUZvcm1Db250ZW50LAogICAgICAgIGRlcG9zaXRCYWxhbmNlOiAwLAogICAgICAgIHR4bkV4cGVuc2U6IG5ldyBFeHBlbnNlcyh7fSksCiAgICAgICAgdHJhbnNhY3Rpb25UeXBlOiB7fSwKICAgICAgICBzdXBwbGllckRpc2NvdW50SXRlbTogW10sCiAgICAgICAgdGF4TGlzdERldGFpbDogW10sCiAgICAgICAgcHVyY2hhc2VPcmRlcnM6IFtdLAogICAgICAgIHB1cmNoYXNlT3JkZXI6IHt9LAogICAgICAgIHJlZkZyb206IFtdLAogICAgICAgIHNob3dMb2FkaW5nUE86IGZhbHNlCiAgICB9KSwKICAgIG1ldGhvZHM6IHsKICAgICAgICBvbkRlcG9zaXREZWR1Y3Rpb25DaGFuZ2UoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmRlcG9zaXRBbW91bnQgPT09ICIiIHx8IHRoaXMuZGVwb3NpdEFtb3VudCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRlcG9zaXRBbW91bnQgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGRlZHVjdGlvbiA9IHBhcnNlRmxvYXQodGhpcy5kZXBvc2l0QW1vdW50KSB8fCAwOwogICAgICAgICAgICBpZiAoZGVkdWN0aW9uID4gcGFyc2VGbG9hdCh0aGlzLnN1cHBsaWVyRGVwb3NpdEFtb3VudCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuZGVwb3NpdEFtb3VudCA9IHBhcnNlRmxvYXQodGhpcy5zdXBwbGllckRlcG9zaXRBbW91bnQpOwogICAgICAgICAgICAgICAgLy8gdGhpcy50eG5FeHBlbnNlLmRlcG9zaXREZWR1Y3Rpb24gPSB0aGlzLmRlcG9zaXRBbW91bnQKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmF1dG9DYWxjdWxhdGUoKTsKICAgICAgICB9LAogICAgICAgIHJlbW92ZUVtcHR5VmFsdWVzKG9iaikgewogICAgICAgICAgICBmb3IgKGxldCBwcm9wTmFtZSBpbiBvYmopIHsKICAgICAgICAgICAgICAgIGlmICghb2JqW3Byb3BOYW1lXSB8fCBvYmpbcHJvcE5hbWVdLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBvYmpbcHJvcE5hbWVdOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygb2JqW3Byb3BOYW1lXSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUVtcHR5VmFsdWVzKG9ialtwcm9wTmFtZV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBvYmo7CiAgICAgICAgfSwKICAgICAgICBvbkxvY2F0aW9uQ2hhbmdlKCkgewogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coCiAgICAgICAgICAgICAgICAibG9jYXRpb24iLAogICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVFbXB0eVZhbHVlcyh0aGlzLnNlZ21lbnQpLAogICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVFbXB0eVZhbHVlcyh0aGlzLmxvY2F0aW9uKQogICAgICAgICAgICApOwogICAgICAgIH0sCiAgICAgICAgbWFwcGluZ0V4cGVuc2UoZXhwZW5zZSkgewogICAgICAgICAgICBjb25zdCBkcyA9IHRoaXMuJHJlZnMuZXhwZW5zZUFjY291bnREUy5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICBjb25zdCBhY2NvdW50TGluZSA9IGRzCiAgICAgICAgICAgICAgICAuZGF0YSgpCiAgICAgICAgICAgICAgICAuZmlsdGVyKChuKSA9PiBuLmFtb3VudCA+IDApCiAgICAgICAgICAgICAgICAubWFwKChtKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaWQgPSBtLmlkIHx8ICJsaW4tIiArIHV1aWQudjEoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsaW5lID0gbmV3IEV4cGVuc2VFbnRyeUV4dGVuZGVkTW9kZWwobSk7CiAgICAgICAgICAgICAgICAgICAgbGluZVsiaWQiXSA9IGlkCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxpbmUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coJ2FjY291bnRMaW5lX18nLCBhY2NvdW50TGluZSkKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCdhY2NvdW50TGluZScsIEpTT04uc3RyaW5naWZ5KGFjY291bnRMaW5lKSkKICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLmlkID0gZXhwZW5zZS51dWlkOwogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UuaGFzQWRkaXRpb25hbENvc3QgPSB0aGlzLmhhc0FkZGl0aW9uYWxDb3N0OwogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2Uuam91cm5hbF91dWlkID0gZXhwZW5zZS5qb3VybmFsX3V1aWQ7CiAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS50eXBlID0gIkV4cGVuc2UiOwogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UuYWJiciA9IHRoaXMuYWJicih0aGlzLnRyYW5zYWN0aW9uVHlwZSk7CiAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS50cmFuc2FjdGlvblR5cGUgPSB0aGlzLnRyYW5zYWN0aW9uVHlwZTsKICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLnJlZmVyZW5jZU5vID0gZXhwZW5zZS5udW1iZXI7CiAgICAgICAgICAgIC8vIHRoaXMudHhuRXhwZW5zZS5yZWZlcmVuY2VObyA9IGV4cGVuc2UubnVtYmVyCiAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS50cmFuc2FjdGlvbkRhdGUgPSBleHBlbnNlLmV4cGVuc2VfZGF0ZTsKICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLnRyYW5zYWN0aW9uRGF0ZVRaID0gSGVscGVyLnRvSVNPRGF0ZShleHBlbnNlLmV4cGVuc2VfZGF0ZSk7CiAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS5kdWVEYXRlID0gZXhwZW5zZS5kdWVfZGF0ZTsKICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLmJpbGxEYXRlID0gZXhwZW5zZS5iaWxsX2RhdGU7CiAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS5iaWxsTnVtYmVyID0gZXhwZW5zZS5iaWxsX251bWJlcjsKICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLmN1cnJlbmN5ID0gdGhpcy5yZW1vdmVFbXB0eVZhbHVlcyhleHBlbnNlLmJpbGxfY3VycmVuY3kpOwogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2Uuc3VwcGxpZXIgPSB0aGlzLnN1cHBsaWVyTWFwKGV4cGVuc2Uuc3VwcGxpZXIpOwogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UuZW1wbG95ZWUgPSB0aGlzLnJlbW92ZUVtcHR5VmFsdWVzKGV4cGVuc2UuZW1wbG95ZWUpOwogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UucGF5bWVudFRlcm0gPSB0aGlzLnJlbW92ZUVtcHR5VmFsdWVzKHRoaXMucGF5bWVudFRlcm0pOwogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2Uuc2VnbWVudCA9IHRoaXMucmVtb3ZlRW1wdHlWYWx1ZXModGhpcy5zZWdtZW50KTsKICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLmxvY2F0aW9uID0gdGhpcy5yZW1vdmVFbXB0eVZhbHVlcyh0aGlzLmxvY2F0aW9uKTsKICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLnByb2plY3QgPSB0aGlzLnJlbW92ZUVtcHR5VmFsdWVzKHRoaXMucHJvamVjdCk7CiAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS5tb250aE9mID0gZXhwZW5zZS5tb250aF9vZjsKCiAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS5hZGRpdGlvbmFsQ29zdFN1cHBsaWVyID0gdGhpcy5yZW1vdmVFbXB0eVZhbHVlcygKICAgICAgICAgICAgICAgIGV4cGVuc2UuYWRkaXRpb25hbF9jb3N0X3N1cHBsaWVyCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS51c2VfZm9yX3RyYW5zYWN0aW9uX3V1aWQgPQogICAgICAgICAgICAgICAgZXhwZW5zZS51c2VfZm9yX3RyYW5zYWN0aW9uX3V1aWQ7CiAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS51c2VGb3JPcHRpb24gPSBleHBlbnNlLnVzZV9mb3Jfb3B0aW9uOwogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UudHJhbnNhY3Rpb25Ob3RlID0gZXhwZW5zZS52b3VjaGVyX25vdGU7CiAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS5qb3VybmFsTm90ZSA9IGV4cGVuc2Uuam91cm5hbF9ub3RlOwogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UuaXRlbUxpbmVzID0gYWNjb3VudExpbmU7CiAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS5hY2NvdW50ID0gbmV3IEFjY291bnRNYXBwaW5nTW9kZWwoCiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUVtcHR5VmFsdWVzKHRoaXMuZXhwZW5zZS50cmFuc2FjdGlvbl9hY2NvdW50KQogICAgICAgICAgICApOwogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2Uuc2F2ZU9wdGlvbiA9IGV4cGVuc2UuaXNfZHJhZnQ7CiAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS5zdGF0dXMgPSAxOwogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UuY3JlYXRlZEF0ID0gZXhwZW5zZS5jcmVhdGVkX2RhdGU7CgogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UudG90YWwgPSBwYXJzZUZsb2F0KHRoaXMudG90YWxBbW91bnQpOwogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UuZXhjaGFuZ2VUb3RhbCA9CiAgICAgICAgICAgICAgICBwYXJzZUZsb2F0KHRoaXMudG90YWxBbW91bnQpICogKHRoaXMuZXhjaGFuZ2VSYXRlLnJhdGUgfHwgMSk7CiAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS5hbW91bnREdWUgPSB0aGlzLmFtb3VudER1ZTsKICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLnJlbWFpbmluZ0Ftb3VudCA9IHRoaXMuYW1vdW50RHVlOwogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2Uuc3ViVG90YWwgPSB0aGlzLnN1YlRvdGFsOwogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UucHVyY2hhc2VUYXggPSB0aGlzLnB1cmNoYXNlVGF4OwogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2Uud2hkVGF4ID0gdGhpcy53aGRUYXg7CiAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS5zdXBwbGllckRpc2NvdW50SXRlbSA9IHRoaXMuc3VwcGxpZXJEaXNjb3VudEl0ZW07CiAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS5sb2dnZWRVc2VyID0gdGhpcy5sb2dnZWRVc2VyKHRoaXMuZXhwZW5zZS5jcmVhdGVkX2J5KTsKCiAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS50eG5SYXRlID0gdGhpcy5leGNoYW5nZVJhdGUucmF0ZTsKICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLmRpc2NvdW50VG90YWwgPSBwYXJzZUZsb2F0KHRoaXMuZGlzY291bnRBbW91bnQpOwogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UuZGVwb3NpdEFtb3VudCA9IHBhcnNlRmxvYXQodGhpcy5kZXBvc2l0QmFsYW5jZSk7CiAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS5kZXBvc2l0RGVkdWN0aW9uID0gcGFyc2VGbG9hdCh0aGlzLmRlcG9zaXRBbW91bnQpOwogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UuZXhjaGFuZ2VEZXBvc2l0RGVkdWN0aW9uID0KICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQodGhpcy5kZXBvc2l0QW1vdW50KSAqIHRoaXMuZXhjaGFuZ2VSYXRlLnJhdGUgfHwgMTsKICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlLmV4Y2hhbmdlQW1vdW50ID0KICAgICAgICAgICAgICAgIHRoaXMuYW1vdW50RHVlICogdGhpcy5leGNoYW5nZVJhdGUucmF0ZSB8fCAxOwogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UucHVyY2hhc2VPcmRlciA9IHRoaXMucHVyY2hhc2VPcmRlciB8fCB7fQogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2UucmVmRnJvbSA9IFtdCiAgICAgICAgICAgIGlmICh0aGlzLnB1cmNoYXNlT3JkZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZS5yZWZGcm9tID0gWwogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRoaXMucHVyY2hhc2VPcmRlci5pZCB8fCAnJywKICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlOiB0aGlzLnB1cmNoYXNlT3JkZXIucmVmZXJlbmNlTm8gfHwgJycKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGxvZ2dlZFVzZXIodXNlcikgewogICAgICAgICAgICBpZiAodXNlcikgewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBpZDogdXNlci5pZCwKICAgICAgICAgICAgICAgICAgICBuYW1lOiB1c2VyLnVzZXJfbmFtZSwKICAgICAgICAgICAgICAgICAgICBlbWFpbDogdXNlci5lbWFpbCwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHt9OwogICAgICAgIH0sCiAgICAgICAgc3VwcGxpZXJNYXAoc3VwcGxpZXIpIHsKICAgICAgICAgICAgaWYgKHN1cHBsaWVyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIGlkOiBzdXBwbGllci51dWlkLAogICAgICAgICAgICAgICAgICAgIG5hbWU6IHN1cHBsaWVyLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgZW1haWw6IHN1cHBsaWVyLmVtYWlsLAogICAgICAgICAgICAgICAgICAgIHBob25lOiBzdXBwbGllci5waG9uZSwKICAgICAgICAgICAgICAgICAgICBhZGRyZXNzOiBzdXBwbGllci5hZGRyZXNzLAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4ge307CiAgICAgICAgfSwKICAgICAgICBhc3luYyBzYXZlVHhuRXhwZW5zZShyZXNwb25zZSkgewogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2VbInV1aWQiXSA9IHJlc3BvbnNlLmRhdGEudXVpZCB8fCAnJzsKICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlWyJpZCJdID0gdGhpcy50eG5FeHBlbnNlLmlkID8gdGhpcy50eG5FeHBlbnNlLmlkIDogIiI7CiAgICAgICAgICAgIHRoaXMudHhuRXhwZW5zZVsiam91cm5hbF91dWlkIl0gPSByZXNwb25zZS5kYXRhLmpvdXJuYWxfdXVpZCB8fCAnJzsKICAgICAgICAgICAgdGhpcy50eG5FeHBlbnNlWyJhY3Rpb25UeXBlIl0gPSB0aGlzLmlzRWRpdCA/ICdlZGl0JyA6ICJuZXciOwogICAgICAgICAgICAvLyBsZXQgZGF0YSA9IHRoaXMudHhuRXhwZW5zZTsKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKCdleHBlbnNlPT0nLCBKU09OLnN0cmluZ2lmeSh0aGlzLnR4bkV4cGVuc2UudGF4TGlzdCkpCiAgICAgICAgICAgIGJpbGxpbmdIYW5kbGVyLmNyZWF0ZUV4cGVuc2UodGhpcy50eG5FeHBlbnNlKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDEpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LnN1Y2Nlc3MoIlN1Y2Nlc3NmdWxseSIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMucmVzcG9uc2VTdGF0dXMocmVzcG9uc2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcigiU29tZXRoaW5nIHdlbnQgd3JvbmciKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9ycy5wdXNoKGUpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICByZW1vdmVEdXBsaWNhdGUoYXJyYXkpIHsKICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gW107CiAgICAgICAgICAgIGNvbnN0IG1hcCA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGFycmF5KSB7CiAgICAgICAgICAgICAgICBpZiAoIW1hcC5oYXMoaXRlbS5pZCkpIHsKICAgICAgICAgICAgICAgICAgICBtYXAuc2V0KGl0ZW0uaWQsIHRydWUpOyAvLyBzZXQgYW55IHZhbHVlIHRvIE1hcAogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfSwKICAgICAgICBhY2NvdW50KHR4bkFjY291bnQpIHsKICAgICAgICAgICAgaWYgKHR4bkFjY291bnQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgaWQ6IHR4bkFjY291bnQudXVpZCwKICAgICAgICAgICAgICAgICAgICB1dWlkOiB0eG5BY2NvdW50LnV1aWQsCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudF91dWlkOiB0eG5BY2NvdW50LmFjY291bnRfdXVpZCwKICAgICAgICAgICAgICAgICAgICBuYW1lOiB0eG5BY2NvdW50Lm5hbWUsCiAgICAgICAgICAgICAgICAgICAgbG9jYWxfbmFtZTogdHhuQWNjb3VudC5sb2NhbF9uYW1lLAogICAgICAgICAgICAgICAgICAgIG51bWJlcjogdHhuQWNjb3VudC5udW1iZXIsCiAgICAgICAgICAgICAgICAgICAgaXNfdGF4YWJsZTogdHhuQWNjb3VudC5pc190YXhhYmxlLAogICAgICAgICAgICAgICAgICAgIGJhbmhqaUFjY0NvZGU6IHR4bkFjY291bnQuYmFuaGppQWNjQ29kZSwKICAgICAgICAgICAgICAgICAgICBncm91cF9jb2RlOiB0eG5BY2NvdW50Lmdyb3VwX2NvZGUsCiAgICAgICAgICAgICAgICAgICAgcGFyZW50X2FjY291bnQ6IHR4bkFjY291bnQucGFyZW50X2FjY291bnQsCiAgICAgICAgICAgICAgICAgICAgdHlwZV9jb2RlOiB0eG5BY2NvdW50LnR5cGVfY29kZSwKICAgICAgICAgICAgICAgICAgICBhY2NvdW50X3R5cGU6IHR4bkFjY291bnQuYWNjb3VudF90eXBlLAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4ge307CiAgICAgICAgfSwKICAgICAgICBhYmJyKHRyYW5zYWN0aW9uVHlwZSkgewogICAgICAgICAgICBpZiAodHJhbnNhY3Rpb25UeXBlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnNhY3Rpb25UeXBlLmFiYnI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIH0sCiAgICAgICAgc3VwcGxpZXJEZXBvc2l0QmFsYW5jZSgpIHsKICAgICAgICAgICAgdGhpcy5zdXBwbGllckRlcG9zaXRBbW91bnQgPSAwOwogICAgICAgICAgICBpZiAodGhpcy5kZXBvc2l0QmFsYW5jZSA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuc3VwcGxpZXJEZXBvc2l0QW1vdW50ID0KICAgICAgICAgICAgICAgICAgICB0aGlzLmRlcG9zaXRCYWxhbmNlIC8gdGhpcy5leGNoYW5nZVJhdGUucmF0ZTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZERlcG9zaXRCYWxhbmNlKGlkKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0ckZpbHRlciA9IGlkICsgIj90eXBlPWRlcCI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdXBwbGllckRlcG9zaXRBbW91bnQgPSAwOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZGVwb3NpdEFtb3VudCA9IDA7CiAgICAgICAgICAgICAgICAgICAgYmlsbGluZ0hhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgLmJhbGFuY2Uoc3RyRmlsdGVyKQogICAgICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRlcG9zaXRCYWxhbmNlID0gZGF0YVswXS5iYWxhbmNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN1cHBsaWVyRGVwb3NpdEJhbGFuY2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaCgpOwogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDMwMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFB1cmNoYXNlRm9ybUNvbnRlbnQoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIHB1cmNoYXNlRm9ybUNvbnRlbnRIYW5kbGVyLmxpc3QoKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3VwcGxpZXJTZXR0aW5nID0gZGF0YVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlRm9ybUNvbnRlbnQgPSBzdXBwbGllclNldHRpbmc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1cHBsaWVyU2V0dGluZy5oYXNPd25Qcm9wZXJ0eSgiZGVjaW1hbCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGVjaW1hbEZvcm1hdCA9ICJuIiArIHN1cHBsaWVyU2V0dGluZy5kZWNpbWFsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGQgMiBkZWZhdWx0IGxpbmVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkUm93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkUm93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCAxMDApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIG51bWJlckZvcm1hdCh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcodmFsdWUsIGAke3RoaXMuZGVjaW1hbEZvcm1hdH1gKTsKICAgICAgICB9LAogICAgICAgIG9uRHVlRGF0ZUNoYW5nZWQoKSB7CiAgICAgICAgICAgIHRoaXMuY2FsY3VsYXRlRHVlRGF0ZSh0aGlzLnBheW1lbnRUZXJtKTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIG9uVmVuZG9yQ2hhbmdlZCgpIHsKICAgICAgICAgICAgLy8gbGV0IHBheW1lbnRCaWxsaW5nID0ge307CiAgICAgICAgICAgIC8vIGlmICgKICAgICAgICAgICAgLy8gICAgIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLnN1cHBsaWVyLCAicGF5bWVudEJpbGxpbmciKQogICAgICAgICAgICAvLyApIHsKICAgICAgICAgICAgLy8gICBwYXltZW50QmlsbGluZyA9IHRoaXMuc3VwcGxpZXIucGF5bWVudEJpbGxpbmc7CiAgICAgICAgICAgIC8vICAgaWYgKAogICAgICAgICAgICAvLyAgICAgICBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocGF5bWVudEJpbGxpbmcsICJwYXltZW50VGVybSIpCiAgICAgICAgICAgIC8vICAgKSB7CiAgICAgICAgICAgIC8vICAgICB0aGlzLnBheW1lbnRUZXJtID0gbmV3IFBheW1lbnRUZXJtTW9kZWwocGF5bWVudEJpbGxpbmcucGF5bWVudFRlcm0pOwogICAgICAgICAgICAvLyAgICAgdGhpcy5jYWxjdWxhdGVEdWVEYXRlKHBheW1lbnRCaWxsaW5nLnBheW1lbnRUZXJtKTsKICAgICAgICAgICAgLy8gICB9CiAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgdGhpcy5sb2FkRGVwb3NpdEJhbGFuY2UodGhpcy5zdXBwbGllci5pZCk7CiAgICAgICAgICAgIHRoaXMubG9hZFBheW1lbnRUZXJtTGlzdCgpOwoKICAgICAgICAgICAgLyogU3VwcGxpZXIgZXhwZW5zZSBhY2NvdW50ICovCiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuZXhwZW5zZUFjY291bnREUy5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICBkcy5kYXRhKFtdKTsKCiAgICAgICAgICAgIC8vIEluc2VydCByb3cKICAgICAgICAgICAgbGV0IGplID0gbmV3IEV4cGVuc2VFbnRyeUV4dGVuZGVkTW9kZWwoewogICAgICAgICAgICAgICAgYWNjb3VudDogdGhpcy5zdXBwbGllci5hY2NvdW50VGF4LmV4cGVuc2VBY2MsCiAgICAgICAgICAgICAgICBxdWFudGl0eTogMSwKICAgICAgICAgICAgICAgIGRlY2ltYWxGb3JtYXQ6IHRoaXMuZGVjaW1hbEZvcm1hdCwKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBkcy5hZGQoamUpOwogICAgICAgICAgICB0aGlzLmFkZFJvdygpOwogICAgICAgICAgICB0aGlzLmxvYWRQdXJjaGFzZU9yZGVyKCkKICAgICAgICB9LAogICAgICAgIGNhbGN1bGF0ZUR1ZURhdGUocGF5bWVudFRlcm0pIHsKICAgICAgICAgICAgaWYgKHBheW1lbnRUZXJtKSB7CiAgICAgICAgICAgICAgICBpZiAocGF5bWVudFRlcm0uaGFzT3duUHJvcGVydHkoIm5ldER1ZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV0RHVlID0gcGF5bWVudFRlcm0ubmV0RHVlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGR1ZURhdGUgPSBuZXcgRGF0ZSh0aGlzLmV4cGVuc2UuZXhwZW5zZV9kYXRlKTsKICAgICAgICAgICAgICAgICAgICBkdWVEYXRlLnNldERhdGUoZHVlRGF0ZS5nZXREYXRlKCkgKyBwYXJzZUludChuZXREdWUpKTsgLy9udW1iZXIgIG9mIGRheXMgdG8gYWRkLCBlLnguIDE1IGRheXMKICAgICAgICAgICAgICAgICAgICB0aGlzLmV4cGVuc2UuZHVlX2RhdGUgPSBkdWVEYXRlLnRvSVNPU3RyaW5nKCkuc3Vic3RyKDAsIDEwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgTnVtYmVyRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IGRhdGEtYmluZD0idmFsdWU6JyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgICAgICAua2VuZG9OdW1lcmljVGV4dEJveCh7CiAgICAgICAgICAgICAgICAgICAgZGVjaW1hbHM6IDMwLAogICAgICAgICAgICAgICAgICAgIGZvcm1hdDogYCR7dGhpcy5kZWNpbWFsRm9ybWF0fWAsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIEhlbHAoa2V5X3NlYXJjaCkgewogICAgICAgICAgICBTaG93UmVzb3VyY2Uoa2V5X3NlYXJjaCk7CiAgICAgICAgfSwKICAgICAgICAvLyBJbml0aWFsIERhdGEKICAgICAgICBpbml0aWFsRGF0YSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuaW5pdEV4cGVuc2UpIHsKICAgICAgICAgICAgICAgIC8vIEVkaXQgTW9kZQogICAgICAgICAgICAgICAgdGhpcy5leHBlbnNlID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5pbml0RXhwZW5zZSk7CiAgICAgICAgICAgICAgICB0aGlzLmJpbmREYXRhKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBCcmFuZCBOZXcgTW9kZQogICAgICAgICAgICAgICAgdGhpcy5zZXREZWZhdWx0RGF0YSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAvLyBTZXQgZGVmYXVsdCBkYXRhCiAgICAgICAgYXN5bmMgc2V0RGVmYXVsdERhdGEoKSB7CiAgICAgICAgICAgIC8vIEJyYW5kIE5ldyBNb2RlCiAgICAgICAgICAgIHRoaXMuaXNFZGl0ID0gZmFsc2U7CgogICAgICAgICAgICB0aGlzLmV4cGVuc2UgPSBPYmplY3QuYXNzaWduKHt9LCBuZXcgRXhwZW5zZU1vZGVsKHsKICAgICAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zdWJzdHIoMCwgMTApLAogICAgICAgICAgICAgICAgZHVlX2RhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zdWJzdHIoMCwgMTApLAogICAgICAgICAgICAgICAgYmlsbF9kYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3Vic3RyKDAsIDEwKSwKICAgICAgICAgICAgICAgIG1vbnRoX29mOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3Vic3RyKDAsIDcpLAogICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAvKiBEZWZhdWx0IFNpZGViYXIgKi8KICAgICAgICAgICAgbGV0IGxvY2F0aW9ucyA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJsb2NhdGlvbnMvZ2V0TGlzdCIpOwogICAgICAgICAgICB0aGlzLmxvY2F0aW9uID0gbmV3IExvY2F0aW9uTW9kZWwobG9jYXRpb25zWzBdKTsKCiAgICAgICAgICAgIGxldCBzZWdtZW50cyA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJzZWdtZW50cy9nZXRMaXN0Iik7CiAgICAgICAgICAgIHRoaXMuc2VnbWVudCA9IG5ldyBTZWdtZW50TW9kZWwoc2VnbWVudHMuZmluZCgoaSkgPT4gaS5pc1N5c3RlbSA9PT0gMSkpOwoKICAgICAgICAgICAgLy8gR2VuZXJhdGUgTnVtYmVyCiAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVOdW1iZXIoKTsKCiAgICAgICAgICAgIC8vIEFkZCAyIGRlZmF1bHQgbGluZXMKICAgICAgICAgICAgLy8gdGhpcy5hZGRSb3coKTsKICAgICAgICAgICAgLy8gdGhpcy5hZGRSb3coKTsKCiAgICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpOwogICAgICAgIH0sCiAgICAgICAgLy8gQmluZCBkYXRhIGZyb20gcHJvcCBmb3IgZWRpdCBtb2RlCiAgICAgICAgYXN5bmMgYmluZERhdGEoKSB7CiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwoKICAgICAgICAgICAgLy8gRWRpdCBNb2RlCiAgICAgICAgICAgIHRoaXMuaXNFZGl0ID0gdHJ1ZTsKCiAgICAgICAgICAgIC8vIEN1cnJlbmN5CiAgICAgICAgICAgIHRoaXMuY3VycmVuY3kgPSBuZXcgQ3VycmVuY3lNb2RlbCh0aGlzLmV4cGVuc2UuYmlsbF9jdXJyZW5jeSk7CiAgICAgICAgICAgIHRoaXMuZXhjaGFuZ2VSYXRlID0gbmV3IEV4Y2hhbmdlUmF0ZU1vZGVsKHRoaXMuZXhwZW5zZS5iaWxsX2N1cnJlbmN5KTsKICAgICAgICAgICAgdGhpcy5leGNoYW5nZVJhdGUuaWQgPSB0aGlzLmV4cGVuc2UuZXhwZW5zZV9lbnRyaWVzWzBdLmV4Y2hhbmdlX3JhdGVfdXVpZDsKICAgICAgICAgICAgdGhpcy5leGNoYW5nZVJhdGUucmF0ZSA9IHRoaXMuZXhwZW5zZS5leHBlbnNlX2VudHJpZXNbMF0uZXhjaGFuZ2VfcmF0ZTsKCiAgICAgICAgICAgIC8vIFBheW1lbnQgVGVybQogICAgICAgICAgICBsZXQgcGF5bWVudFRlcm1zID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goInBheW1lbnRUZXJtcy9nZXRMaXN0Iik7CiAgICAgICAgICAgIHRoaXMucGF5bWVudFRlcm0gPSBuZXcgUGF5bWVudFRlcm1Nb2RlbChwYXltZW50VGVybXMuZmluZCgoaSkgPT4gaS5pZCA9PT0gdGhpcy5leHBlbnNlLnBheW1lbnRfdGVybSkpOwoKICAgICAgICAgICAgLy8gQ29udGFjdHMKICAgICAgICAgICAgdGhpcy5zdXBwbGllciA9IG5ldyBTdXBwbGllck1vZGVsKHRoaXMuZXhwZW5zZS5zdXBwbGllcik7CiAgICAgICAgICAgIHRoaXMuZW1wbG95ZWUgPSBuZXcgRW1wbG95ZWVNb2RlbCh0aGlzLmV4cGVuc2UuZW1wbG95ZWUpOwogICAgICAgICAgICB0aGlzLmhhc0FkZGl0aW9uYWxDb3N0ID0gQm9vbGVhbih0aGlzLmV4cGVuc2UuYWRkaXRpb25hbF9jb3N0X3N1cHBsaWVyLnV1aWQpOwoKICAgICAgICAgICAgLy8gU2lkZWJhcgogICAgICAgICAgICBsZXQgbG9jYXRpb25zID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goImxvY2F0aW9ucy9nZXRMaXN0Iik7CiAgICAgICAgICAgIHRoaXMubG9jYXRpb24gPSBuZXcgTG9jYXRpb25Nb2RlbChsb2NhdGlvbnMuZmluZCgoaSkgPT4gaS5pZCA9PT0gdGhpcy5leHBlbnNlLmxvY2F0aW9uX3V1aWQpKTsKCiAgICAgICAgICAgIGxldCBzZWdtZW50cyA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJzZWdtZW50cy9nZXRMaXN0Iik7CiAgICAgICAgICAgIHRoaXMuc2VnbWVudCA9IG5ldyBTZWdtZW50TW9kZWwoCiAgICAgICAgICAgICAgICBzZWdtZW50cy5maW5kKChpKSA9PiBpLmlkID09PSB0aGlzLmV4cGVuc2Uuc2VnbWVudF91dWlkKQogICAgICAgICAgICApOwoKICAgICAgICAgICAgbGV0IHByb2plY3RzID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goInByb2plY3RzL2dldExpc3QiKTsKICAgICAgICAgICAgdGhpcy5wcm9qZWN0ID0gbmV3IFByb2plY3RNb2RlbCgKICAgICAgICAgICAgICAgIHByb2plY3RzLmZpbmQoKGkpID0+IGkuaWQgPT09IHRoaXMuZXhwZW5zZS5wcm9qZWN0X3V1aWQpCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAvLyBDYXNoIEFkdmFuY2UKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgdGhpcy5lbXBsb3llZS5pZCAhPT0gIiIgJiYKICAgICAgICAgICAgICAgIHRoaXMuc2VnbWVudC5pZCAhPT0gIiIgJiYKICAgICAgICAgICAgICAgIHRoaXMuZXhwZW5zZS51c2VfZm9yX29wdGlvbiA9PT0gMgogICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIGxldCBjYXNoQWR2YW5jZXMgPSBhd2FpdCBjYXNoQWR2YW5jZUhhbmRsZXIuZ2V0QnlFbXBsb3llZUlkKAogICAgICAgICAgICAgICAgICAgIHRoaXMuZW1wbG95ZWUuaWQKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB0aGlzLmNhc2hBZHZhbmNlcyA9IGNhc2hBZHZhbmNlcy5kYXRhLmZpbHRlcigKICAgICAgICAgICAgICAgICAgICAoaSkgPT4gaS5zZWdtZW50X3V1aWQgPT09IHRoaXMuc2VnbWVudC5pZAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRW50cmllcwogICAgICAgICAgICBsZXQgZW50cmllcyA9IFtdLAogICAgICAgICAgICAgICAgc3ViVG90YWwgPSAwLAogICAgICAgICAgICAgICAgZGlzY291bnRBbW91bnQgPSAwLAogICAgICAgICAgICAgICAgcHVyY2hhc2VUYXhBbW91bnQgPSAwLAogICAgICAgICAgICAgICAgd2hkVGF4QW1vdW50ID0gMCwKICAgICAgICAgICAgICAgIHNlY29uZGFyeUFjY291bnRzID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goImFjY291bnRpbmcvZ2V0U2Vjb25kYXJ5QWNjb3VudHMiKSwKICAgICAgICAgICAgICAgIGRpc2NvdW50SXRlbXMgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgiZGlzY291bnRJdGVtcy9nZXRMaXN0IiksCiAgICAgICAgICAgICAgICB0YXhJdGVtcyA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJ0YXhlcy9nZXRMaXN0IiksCiAgICAgICAgICAgICAgICB1b21zID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goInVuaXRPZk1lYXN1cmVtZW50cy9nZXRMaXN0IiksCiAgICAgICAgICAgICAgICBjbGF6eiA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJjbGFzc2VzL2dldExpc3QiKTsKCiAgICAgICAgICAgIHRoaXMuZXhwZW5zZS5leHBlbnNlX2VudHJpZXMuZm9yRWFjaCgodmFsdWUpID0+IHsKICAgICAgICAgICAgICAgIC8vIFB1cmNoYXNlIFRheAogICAgICAgICAgICAgICAgaWYgKHZhbHVlLmFjY291bnQuYWNjb3VudF90eXBlLm51bWJlciA9PT0gQWNjb3VudFR5cGVDb2RlLlBVUkNIQVNFX1RBWCkgewogICAgICAgICAgICAgICAgICAgIHB1cmNoYXNlVGF4QW1vdW50ICs9IHZhbHVlLmFtb3VudDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmFtb3VudCA+IDAgJiYgdmFsdWUuYWNjb3VudC5udW1iZXIgIT09IEFjY291bnRUeXBlQ29kZS5UQVhfUkVMQVRFRF9FWFBFTlNFX0NPREUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGVudHJ5ID0gbmV3IEV4cGVuc2VFbnRyeUV4dGVuZGVkTW9kZWwodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBlbnRyeS5kZWNpbWFsRm9ybWF0ID0gdGhpcy5kZWNpbWFsRm9ybWF0OwoKICAgICAgICAgICAgICAgICAgICAgICAgLyogU2Vjb25kYXJ5IEFjY291bnQgKi8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnNlY29uZGFyeV9hY2NfdXVpZCAhPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLnNlY29uZGFyeV9hY2NvdW50ID0gbmV3IEFjY291bnRNb2RlbChzZWNvbmRhcnlBY2NvdW50cy5maW5kKChpKSA9PiBpLnV1aWQgPT09IHZhbHVlLnNlY29uZGFyeV9hY2NfdXVpZCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBTdWJ0b3RhbAogICAgICAgICAgICAgICAgICAgICAgICBzdWJUb3RhbCArPSB2YWx1ZS5hbW91bnQ7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBVT00KICAgICAgICAgICAgICAgICAgICAgICAgZW50cnkudW9tID0gbmV3IFVvbU1vZGVsKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdW9tcy5maW5kKChpdGVtKSA9PiBpdGVtLmlkID09PSB2YWx1ZS51b21fdXVpZCkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERpc2NvdW50CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5oYXNPd25Qcm9wZXJ0eSgnZGlzY291bnQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5kaXNjb3VudC5oYXNPd25Qcm9wZXJ0eSgndXVpZCcpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5LmRpc2NvdW50ID0gbmV3IERpc2NvdW50SXRlbU1vZGVsKGRpc2NvdW50SXRlbXMuZmluZCgoaSkgPT4gaS5pZCA9PT0gdmFsdWUuZGlzY291bnQudXVpZCkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGF4CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5oYXNPd25Qcm9wZXJ0eSgndGF4X2l0ZW0nKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS50YXhfaXRlbS5oYXNPd25Qcm9wZXJ0eSgndXVpZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW50cnkudGF4X2l0ZW0gPSB0YXhJdGVtcy5maW5kKChpKSA9PiBpLmlkID09PSB2YWx1ZS50YXhfaXRlbS51dWlkKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogQXBwbHkgSW5jbHVzaXZlIFRheCB0byBhbW91bnQgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW50cnkudGF4X2l0ZW0uaGFzT3duUHJvcGVydHkoJ3RheFR5cGUnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVudHJ5LnRheF9pdGVtLnRheFR5cGUuaGFzT3duUHJvcGVydHkoJ3R5cGVJZCcpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVudHJ5LnRheF9pdGVtLnRheFR5cGUudHlwZUlkID09PSAxICYmIGVudHJ5LnRheF9pdGVtLmJhc2VBbW91bnQudG9Mb3dlckNhc2UoKSA9PT0gVGF4VHlwZS5JTkNMVVNJVkUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViVG90YWwgKz0gZW50cnkudGF4X2Ftb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENsYXNzZXMKICAgICAgICAgICAgICAgICAgICAgICAgZW50cnkuY2xhc3MxID0gbmV3IENsYXNzTW9kZWwoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGF6ei5maW5kKChpdGVtKSA9PiBpdGVtLmlkID09PSB2YWx1ZS5jbGFzc18xX3V1aWQpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5LmNsYXNzMiA9IG5ldyBDbGFzc01vZGVsKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhenouZmluZCgoaXRlbSkgPT4gaXRlbS5pZCA9PT0gdmFsdWUuY2xhc3NfMl91dWlkKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICBlbnRyeS5jbGFzczMgPSBuZXcgQ2xhc3NNb2RlbCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXp6LmZpbmQoKGl0ZW0pID0+IGl0ZW0uaWQgPT09IHZhbHVlLmNsYXNzXzNfdXVpZCkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW50cnkuY2xhc3M0ID0gbmV3IENsYXNzTW9kZWwoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGF6ei5maW5kKChpdGVtKSA9PiBpdGVtLmlkID09PSB2YWx1ZS5jbGFzc180X3V1aWQpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5LmNsYXNzNSA9IG5ldyBDbGFzc01vZGVsKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhenouZmluZCgoaXRlbSkgPT4gaXRlbS5pZCA9PT0gdmFsdWUuY2xhc3NfNV91dWlkKQogICAgICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICAgICAgZW50cmllcy5wdXNoKGVudHJ5KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBEaXNjb3VudAogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuYWNjb3VudC5hY2NvdW50X3R5cGUubnVtYmVyID09PSBBY2NvdW50VHlwZUNvZGUuRElTQ09VTlQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50QW1vdW50ICs9IHZhbHVlLmFtb3VudCAqIC0xOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBXSEQgVGF4CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5hY2NvdW50LmFjY291bnRfdHlwZS5udW1iZXIgPT09IEFjY291bnRUeXBlQ29kZS5XSERfVEFYKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGRUYXhBbW91bnQgKz0gdmFsdWUuYW1vdW50ICogLTE7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERlcG9zaXQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKH5BY2NvdW50VHlwZUNvZGUuUFVSQ0hBU0VfREVQT1NJVFMuaW5kZXhPZih2YWx1ZS5hY2NvdW50LmFjY291bnRfdHlwZS5udW1iZXIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRlcG9zaXRBbW91bnQgPSB2YWx1ZS5hbW91bnQgKiAtMTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVHJhbnNhY3Rpb24gQWNjb3VudCAoUGF5YWJsZSBBY2NvdW50IC8gQ2xlYXJpbmcgQWNjb3VudCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmFjY291bnQudXVpZCA9PT0gdGhpcy5leHBlbnNlLnRyYW5zYWN0aW9uX2FjY291bnQudXVpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hbW91bnREdWUgPSB2YWx1ZS5hbW91bnQgKiAtMTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBTZWNvbmRhcnkgQWNjb3VudCAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWNvbmRhcnlBY2NvdW50ID0gbmV3IEFjY291bnRNb2RlbChzZWNvbmRhcnlBY2NvdW50cy5maW5kKChpKSA9PiBpLnV1aWQgPT09IHZhbHVlLnNlY29uZGFyeV9hY2NfdXVpZCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIEJpbmQgRXhwZW5zZSBFbnRyaWVzCiAgICAgICAgICAgIHRoaXMuZXhwZW5zZUVudHJpZXMgPSBlbnRyaWVzOwoKICAgICAgICAgICAgLy8gQ2FsY3VsYXRpb24KICAgICAgICAgICAgdGhpcy5zdWJUb3RhbCA9IHN1YlRvdGFsOwogICAgICAgICAgICB0aGlzLmRpc2NvdW50QW1vdW50ID0gZGlzY291bnRBbW91bnQ7CiAgICAgICAgICAgIHRoaXMucHVyY2hhc2VUYXggPSBwdXJjaGFzZVRheEFtb3VudDsKICAgICAgICAgICAgdGhpcy53aGRUYXggPSB3aGRUYXhBbW91bnQ7CiAgICAgICAgICAgIHRoaXMudG90YWxBbW91bnQgPSBzdWJUb3RhbCAtIHRoaXMuZGlzY291bnRBbW91bnQ7CgogICAgICAgICAgICAvKiBKb3VybmFsICovCiAgICAgICAgICAgIGxldCBqb3VybmFscyA9IGF3YWl0IGpvdXJuYWxIYW5kbGVyLmdldE9uZSh0aGlzLmV4cGVuc2Uuam91cm5hbF91dWlkKTsKICAgICAgICAgICAgdGhpcy5qb3VybmFsID0gam91cm5hbHMuZGF0YTsKICAgICAgICAgICAgdGhpcy5sb2FkRXhwZW5zZVB1cmNoYXNlT3JkZXIoKQogICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSwKICAgICAgICAvKiBMb2FkIERhdGEgKi8KICAgICAgICBhc3luYyBsb2FkRGF0YSgpIHsKICAgICAgICAgICAgLy8gU3VwcGxpZXIgU2V0dGluZyBzdWNoIGFzIGRlY2ltYWwgZm9ybWF0CiAgICAgICAgICAgIGF3YWl0IHRoaXMubG9hZFB1cmNoYXNlRm9ybUNvbnRlbnQoKTsKCiAgICAgICAgICAgIC8vIENhbGwgQWNjb3VudCBMaXN0CiAgICAgICAgICAgIHRoaXMuYWNjb3VudHMgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgiYWNjb3VudGluZy9nZXRBY2NvdW50cyIpOwogICAgICAgICAgICB0aGlzLmV4cGVuc2VBY2NvdW50cyA9IHRoaXMuYWNjb3VudHM7CgogICAgICAgICAgICAvLyBBZHZhbmNlIFNldHRsZW1lbnQgQ2xlYXJpbmcgQWNjb3VudCBieSBiYW5oamlfYWNjb3VudF9udW1iZXIKICAgICAgICAgICAgbGV0IGFkdlNldENsckFjYyA9IHRoaXMuYWNjb3VudHMuZmluZChpID0+IGkuYmFuaGppX2FjY291bnRfbnVtYmVyID09PSBBY2NvdW50VHlwZUNvZGUuQURWQU5DRV9TRVRUTEVNRU5UX0NMRUFSSU5HX0NPREUpOwogICAgICAgICAgICB0aGlzLmFkdmFuY2VTZXR0bGVtZW50Q2xlYXJpbmdBY2NvdW50ID0gbmV3IEFjY291bnRNb2RlbChhZHZTZXRDbHJBY2MpOwoKICAgICAgICAgICAgLy8gT3RoZXIgQ2xlYXJpbmcgU3VzcGVuc2VzIEFjY291bnQgYnkgYmFuaGppX2FjY291bnRfbnVtYmVyCiAgICAgICAgICAgIGxldCBvdGhlckNsclN1c0FjYyA9IHRoaXMuYWNjb3VudHMuZmluZChpID0+IGkuYmFuaGppX2FjY291bnRfbnVtYmVyID09PSBBY2NvdW50VHlwZUNvZGUuT1RIRVJfQ0xFQVJJTkdfU1VTUEVOU0VTX0NPREUpOwogICAgICAgICAgICB0aGlzLm90aGVyQ2xlYXJpbmdTdXNwZW5zZUFjY291bnQgPSBuZXcgQWNjb3VudE1vZGVsKG90aGVyQ2xyU3VzQWNjKTsKCiAgICAgICAgICAgIC8vIEZpbHRlciBUcmFuc2FjdGlvbiBBY2NvdW50cwogICAgICAgICAgICB0aGlzLmZpbHRlclRyYW5zYWN0aW9uQWNjb3VudCgpOwogICAgICAgIH0sCiAgICAgICAgLy8gTnVtYmVyCiAgICAgICAgYXN5bmMgZ2VuZXJhdGVOdW1iZXIoKSB7CiAgICAgICAgICAgIGxldCBudW0gPSBhd2FpdCBIZWxwZXIuZ2VuZXJhdGVBY2NvdW50aW5nTnVtYmVyKAogICAgICAgICAgICAgICAgRW50aXR5VHlwZS5FWFBFTlNFUywKICAgICAgICAgICAgICAgIHRoaXMuZXhwZW5zZS5leHBlbnNlX2RhdGUKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIHRoaXMuZXhwZW5zZS5udW1iZXIgPSBudW0ubnVtYmVyOwogICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uVHlwZSA9IG51bS5wcmVmaXg7CiAgICAgICAgICAgIHRoaXMuZXhwZW5zZS5wcmVmaXhfZm9ybWF0ID0gbnVtLnByZWZpeF9mb3JtYXQ7CiAgICAgICAgfSwKICAgICAgICAvLyBHZXQgRXhjaGFuZ2UgUmF0ZQogICAgICAgIGFzeW5jIGdldEV4Y2hhbmdlUmF0ZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuZXhwZW5zZS5leHBlbnNlX2RhdGUgJiYgdGhpcy5jdXJyZW5jeS5jb2RlICE9PSAiIikgewogICAgICAgICAgICAgICAgdGhpcy5leGNoYW5nZVJhdGUgPSBhd2FpdCBIZWxwZXIuZ2V0TGFzdEV4Y2hhbmdlUmF0ZUJ5RGF0ZSgKICAgICAgICAgICAgICAgICAgICB0aGlzLmV4cGVuc2UuZXhwZW5zZV9kYXRlLAogICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVuY3kuY29kZQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuZXhjaGFuZ2VSYXRlID0gbmV3IEV4Y2hhbmdlUmF0ZU1vZGVsKGluc3RpdHV0ZS5iYXNlQ3VycmVuY3kpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLmV4Y2hhbmdlUmF0ZSwgIlhyYXRlIik7CiAgICAgICAgICAgIHRoaXMuc3VwcGxpZXJEZXBvc2l0QmFsYW5jZSgpOwogICAgICAgIH0sCiAgICAgICAgLy8gTG9hZCBDYXNoIEFkdmFuY2UKICAgICAgICBsb2FkQ2FzaEFkdmFuY2UoKSB7CiAgICAgICAgICAgIC8qIFB1cmNoYXNlIE9yZGVyICovCiAgICAgICAgICAgIHRoaXMubG9hZFB1cmNoYXNlT3JkZXIoKQogICAgICAgICAgICAvKiBDbGVhciAqLwogICAgICAgICAgICB0aGlzLmNhc2hBZHZhbmNlcyA9IFtdOwogICAgICAgICAgICB0aGlzLmV4cGVuc2UudXNlX2Zvcl90cmFuc2FjdGlvbl91dWlkID0gIiI7CgogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICB0aGlzLmVtcGxveWVlLmlkICE9PSAiIiAmJgogICAgICAgICAgICAgICAgdGhpcy5zZWdtZW50LmlkICE9PSAiIiAmJgogICAgICAgICAgICAgICAgdGhpcy5leHBlbnNlLnVzZV9mb3Jfb3B0aW9uID09PSAyCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy5zaG93Q2FzaEFkdmFuY2VMb2FkaW5nID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICBjYXNoQWR2YW5jZUhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAuZ2V0QnlFbXBsb3llZUlkKHRoaXMuZW1wbG95ZWUuaWQpCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmVzcG9uc2VEYXRhID0gbmV3IFJlc3BvbnNlRGF0YU1vZGVsKHJlcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8qIEZpbHRlciBieSBzZWdtZW50ICovCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FzaEFkdmFuY2VzID0gcmVzcG9uc2VEYXRhLmRhdGEuZmlsdGVyKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGl0ZW0pID0+IGl0ZW0uc2VnbWVudF91dWlkID09PSB0aGlzLnNlZ21lbnQuaWQKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5maW5hbGx5KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93Q2FzaEFkdmFuY2VMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIC8qIE9uIGRhdGUgY2hhbmdlcyAqLwogICAgICAgIG9uRGF0ZUNoYW5nZXMoKSB7CiAgICAgICAgICAgIHRoaXMuZXhwZW5zZS5tb250aF9vZiA9IG5ldyBEYXRlKHRoaXMuZXhwZW5zZS5leHBlbnNlX2RhdGUpLnRvSVNPU3RyaW5nKCkuc3Vic3RyKDAsIDcpOwogICAgICAgICAgICB0aGlzLmdldEV4Y2hhbmdlUmF0ZSgpOwogICAgICAgICAgICB0aGlzLmdlbmVyYXRlTnVtYmVyKCk7CiAgICAgICAgfSwKICAgICAgICAvKiBPbiBUcmFuc2FjdGlvbiBBY2NvdW50IENoYW5nZXMgKi8KICAgICAgICBvblRyYW5zYWN0aW9uQWNjb3VudENoYW5nZXMoKSB7CiAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5QWNjb3VudCA9IG5ldyBBY2NvdW50TW9kZWwoKTsKICAgICAgICB9LAogICAgICAgIC8qIE9uIENhc2ggQWR2YW5jZSBDaGFuZ2VzICovCiAgICAgICAgb25DYXNoQWR2YW5jZUNoYW5nZXMoKSB7CiAgICAgICAgICAgIHRoaXMuc2V0Q2FzaEFkdmFuY2VQcm9qZWN0KCk7CiAgICAgICAgICAgIHRoaXMuZGlzYWJsZVByb2plY3QgPSBmYWxzZTsKICAgICAgICB9LAogICAgICAgIC8qIEJpbmQgcHJvamVjdCBmcm9tIGNhc2ggYWR2YW5jZSAqLwogICAgICAgIGFzeW5jIHNldENhc2hBZHZhbmNlUHJvamVjdCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuZXhwZW5zZS51c2VfZm9yX3RyYW5zYWN0aW9uX3V1aWQgIT09ICIiKSB7CiAgICAgICAgICAgICAgICBsZXQgY2FzaEFkdmFuY2UgPSB0aGlzLmNhc2hBZHZhbmNlcy5maW5kKAogICAgICAgICAgICAgICAgICAgIChpKSA9PiBpLnV1aWQgPT09IHRoaXMuZXhwZW5zZS51c2VfZm9yX3RyYW5zYWN0aW9uX3V1aWQKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgaWYgKGNhc2hBZHZhbmNlLnByb2plY3RfdXVpZCAhPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgcHJvamVjdHMgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgicHJvamVjdHMvZ2V0TGlzdCIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMucHJvamVjdCA9IHByb2plY3RzLmZpbmQoCiAgICAgICAgICAgICAgICAgICAgICAgIChpKSA9PiBpLmlkID09PSBjYXNoQWR2YW5jZS5wcm9qZWN0X3V1aWQKICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGVQcm9qZWN0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNhYmxlUHJvamVjdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAvLyBPbiBFbXBsb3llZSBSYWRpbyBDaGFuZ2VzCiAgICAgICAgb25Vc2VGb3JPcHRpb25DaGFuZ2VzKCkgewogICAgICAgICAgICAvLyBDbGVhciBTZWxlY3RlZCBDYXNoIEFkdmFuY2UKICAgICAgICAgICAgdGhpcy5leHBlbnNlLnVzZV9mb3JfdHJhbnNhY3Rpb25fdXVpZCA9ICIiOwogICAgICAgICAgICB0aGlzLmV4cGVuc2UudHJhbnNhY3Rpb25fYWNjb3VudCA9IG5ldyBBY2NvdW50TW9kZWwoKTsKCiAgICAgICAgICAgIC8qIExvYWQgQ2FzaCBBZHZhbmNlICovCiAgICAgICAgICAgIGlmICh0aGlzLmV4cGVuc2UudXNlX2Zvcl9vcHRpb24gPT09IDIpIHsKICAgICAgICAgICAgICAgIHRoaXMubG9hZENhc2hBZHZhbmNlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5QWNjb3VudCA9IG5ldyBBY2NvdW50TW9kZWwoKTsKICAgICAgICAgICAgdGhpcy5maWx0ZXJUcmFuc2FjdGlvbkFjY291bnQoKTsKICAgICAgICB9LAogICAgICAgIC8vIEZpbHRlciBUcmFuc2F0aW9uIEFjY291bnQKICAgICAgICBhc3luYyBmaWx0ZXJUcmFuc2FjdGlvbkFjY291bnQoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmV4cGVuc2UudXNlX2Zvcl9vcHRpb24gPT09IDApIHsKICAgICAgICAgICAgICAgIC8vIENyZWRpdCAoUGF5YWJsZSBBY2NvdW50KQogICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbkFjY291bnRzID0gdGhpcy5hY2NvdW50cy5maWx0ZXIoCiAgICAgICAgICAgICAgICAgICAgKGkpID0+CiAgICAgICAgICAgICAgICAgICAgICAgIH5BY2NvdW50VHlwZUNvZGUuUEFZQUJMRV9BQ0NPVU5UUy5pbmRleE9mKGkuYWNjb3VudF90eXBlLm51bWJlcikKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5leHBlbnNlLnVzZV9mb3Jfb3B0aW9uID09PSAzKSB7CiAgICAgICAgICAgICAgICAvLyBDYXNoIEFjY291bnQKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb25BY2NvdW50cyA9IHRoaXMuYWNjb3VudHMuZmlsdGVyKAogICAgICAgICAgICAgICAgICAgIChpKSA9PgogICAgICAgICAgICAgICAgICAgICAgICB+QWNjb3VudFR5cGVDb2RlLkNBU0hfQUNDT1VOVFMuaW5kZXhPZihpLmFjY291bnRfdHlwZS5udW1iZXIpCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gUmVpbWJ1cnNlbWVudCAvIENhc2ggQWR2YW5jZQogICAgICAgICAgICAgICAgdGhpcy5leHBlbnNlLnRyYW5zYWN0aW9uX2FjY291bnQgPSB0aGlzLmFkdmFuY2VTZXR0bGVtZW50Q2xlYXJpbmdBY2NvdW50OwogICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbkFjY291bnRzID0gW3RoaXMuYWR2YW5jZVNldHRsZW1lbnRDbGVhcmluZ0FjY291bnRdOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAvLyBPbiBBZGRpdGlvbmFsIENvc3QgQ2hhbmdlcwogICAgICAgIG9uQWRkaXRpb25hbENvc3RDaGVja2JveENoYW5nZXMoKSB7CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuZXhwZW5zZUFjY291bnREUy5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICBkcy5kYXRhKFtdKTsKCiAgICAgICAgICAgIGlmICh0aGlzLmhhc0FkZGl0aW9uYWxDb3N0KSB7CiAgICAgICAgICAgICAgICB0aGlzLmV4cGVuc2VBY2NvdW50cyA9IFt0aGlzLm90aGVyQ2xlYXJpbmdTdXNwZW5zZUFjY291bnRdOwoKICAgICAgICAgICAgICAgIC8vIEluc2VydCByb3cKICAgICAgICAgICAgICAgIGxldCBqZSA9IG5ldyBFeHBlbnNlRW50cnlFeHRlbmRlZE1vZGVsKHsKICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiB0aGlzLm90aGVyQ2xlYXJpbmdTdXNwZW5zZUFjY291bnQsCiAgICAgICAgICAgICAgICAgICAgcXVhbnRpdHk6IDEsCiAgICAgICAgICAgICAgICAgICAgZGVjaW1hbEZvcm1hdDogdGhpcy5kZWNpbWFsRm9ybWF0LAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgZHMuYWRkKGplKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuZXhwZW5zZS5hZGRpdGlvbmFsX2Nvc3Rfc3VwcGxpZXIgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5leHBlbnNlQWNjb3VudHMgPSB0aGlzLmFjY291bnRzOwogICAgICAgICAgICAgICAgdGhpcy5hZGRSb3coKTsKICAgICAgICAgICAgICAgIHRoaXMuYWRkUm93KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIC8qIEtlbmRvICovCiAgICAgICAgLy8gRGF0YVNvdXJjZSBDaGFuZ2VzCiAgICAgICAgb25FeHBlbnNlQWNjb3VudERTQ2hhbmdlcyhlKSB7CiAgICAgICAgICAgIGlmIChlLmZpZWxkKSB7CiAgICAgICAgICAgICAgICBsZXQgZGF0YVJvdyA9IGUuaXRlbXNbMF07CgogICAgICAgICAgICAgICAgaWYgKGUuZmllbGQgPT09ICJhY2NvdW50IikgewogICAgICAgICAgICAgICAgICAgIC8qIFNldCBhY2NvdW50IGlkICovCiAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImFjY291bnRfdXVpZCIsIGRhdGFSb3cuYWNjb3VudC51dWlkKTsKCiAgICAgICAgICAgICAgICAgICAgLyogQWRkIEV4dHJhIFJvdyAqLwogICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkRXh0cmFSb3coZGF0YVJvdy51aWQpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLmZpZWxkID09PSAic2Vjb25kYXJ5X2FjY291bnQiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFSb3cuc2Vjb25kYXJ5X2FjY291bnQgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoInNlY29uZGFyeV9hY2NfdXVpZCIsIGRhdGFSb3cuc2Vjb25kYXJ5X2FjY291bnQudXVpZCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IGRlZmF1bHQgd2hlbiBkZXNlbGVjdAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgic2Vjb25kYXJ5X2FjY191dWlkIiwgIiIpOwogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgic2Vjb25kYXJ5X2FjY291bnQiLCBuZXcgQWNjb3VudE1vZGVsKCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS5maWVsZCA9PT0gInF1YW50aXR5IiB8fCBlLmZpZWxkID09PSAicHJpY2UiKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGFtdCA9CiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQoZGF0YVJvdy5xdWFudGl0eSkgKgogICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KGRhdGFSb3cucHJpY2UpOwogICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJhbW91bnQiLCBhbXQpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLmZpZWxkID09PSAidW9tIikgewogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhUm93LnVvbSkgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgidW9tX3V1aWQiLCBkYXRhUm93LnVvbS5pZCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLmZpZWxkID09PSAidGF4X2l0ZW0iKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFSb3cudGF4X2l0ZW0gPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IGRlZmF1bHQgd2hlbiBkZXNlbGVjdAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgidGF4X2l0ZW0iLCBuZXcgVGF4TW9kZWwoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLmZpZWxkID09PSAiY2xhc3MxIikgewogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhUm93LmNsYXNzMSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiY2xhc3NfMV91dWlkIiwgZGF0YVJvdy5jbGFzczEuaWQpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCBkZWZhdWx0IHdoZW4gZGVzZWxlY3QKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNsYXNzXzFfdXVpZCIsICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNsYXNzMSIsIG5ldyBDbGFzc01vZGVsKCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS5maWVsZCA9PT0gImNsYXNzMiIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVJvdy5jbGFzczIgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNsYXNzXzJfdXVpZCIsIGRhdGFSb3cuY2xhc3MyLmlkKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgZGVmYXVsdCB3aGVuIGRlc2VsZWN0CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjbGFzc18yX3V1aWQiLCAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjbGFzczIiLCBuZXcgQ2xhc3NNb2RlbCgpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUuZmllbGQgPT09ICJjbGFzczMiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFSb3cuY2xhc3MzICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjbGFzc18zX3V1aWQiLCBkYXRhUm93LmNsYXNzMy5pZCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IGRlZmF1bHQgd2hlbiBkZXNlbGVjdAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiY2xhc3NfM191dWlkIiwgIiIpOwogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiY2xhc3MzIiwgbmV3IENsYXNzTW9kZWwoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLmZpZWxkID09PSAiY2xhc3M0IikgewogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhUm93LmNsYXNzNCAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiY2xhc3NfNF91dWlkIiwgZGF0YVJvdy5jbGFzczQuaWQpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCBkZWZhdWx0IHdoZW4gZGVzZWxlY3QKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNsYXNzXzRfdXVpZCIsICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNsYXNzNCIsIG5ldyBDbGFzc01vZGVsKCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS5maWVsZCA9PT0gImNsYXNzNSIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVJvdy5jbGFzczUgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImNsYXNzXzVfdXVpZCIsIGRhdGFSb3cuY2xhc3M1LmlkKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgZGVmYXVsdCB3aGVuIGRlc2VsZWN0CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjbGFzc181X3V1aWQiLCAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjbGFzczUiLCBuZXcgQ2xhc3NNb2RlbCgpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGNhbGN1bGF0ZURpc2NvdW50KGRpc2NvdW50SXRlbSwgc3ViVG90YWwpIHsKICAgICAgICAgICAgaWYgKGRpc2NvdW50SXRlbSkgewogICAgICAgICAgICAgICAgY29uc3QgbmF0dXJlID0gZGlzY291bnRJdGVtLm5hdHVyZTsKICAgICAgICAgICAgICAgIGNvbnN0IGFtb3VudCA9IGRpc2NvdW50SXRlbS5hbW91bnQ7CiAgICAgICAgICAgICAgICBpZiAobmF0dXJlID09PSAiQW1vdW50IikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBrZW5kby5wYXJzZUZsb2F0KGFtb3VudCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5hdHVyZSA9PT0gIlBlcmNlbnRhZ2UiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1YlRvdGFsICogKGtlbmRvLnBhcnNlRmxvYXQoYW1vdW50KSAvIDEwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGF1dG9DYWxjdWxhdGVUYXgodGF4LCBhbW91bnQpIHsKICAgICAgICAgICAgaWYgKHRheCkgewogICAgICAgICAgICAgICAgdmFyIGZvcm11bGEgPSB0YXguZm9ybXVsYTsKICAgICAgICAgICAgICAgIHZhciBpbkFtdCA9IGtlbmRvLnBhcnNlRmxvYXQoYW1vdW50KTsKICAgICAgICAgICAgICAgIHZhciBuQW10ID0ga2VuZG8ucGFyc2VGbG9hdChhbW91bnQpOwogICAgICAgICAgICAgICAgdmFyIHRheEJhc2UgPSBrZW5kby5wYXJzZUZsb2F0KHRheC50YXhCYXNlKSAvIDEwMDsKICAgICAgICAgICAgICAgIHZhciByYXRlID0ga2VuZG8ucGFyc2VGbG9hdCh0YXgucmF0ZSkgLyAxMDA7CiAgICAgICAgICAgICAgICB2YXIgdG90YWwgPSBldmFsKGZvcm11bGEpOwogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKGluQW10LCBuQW10LCB0YXhCYXNlLCByYXRlLCBmb3JtdWxhLCB0b3RhbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdG90YWw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gcmV0dXJuIDAKICAgICAgICB9LAogICAgICAgIC8vIEF1dG8gQ2FsY3VsYXRlIEluIERhdGFTb3VyY2UKICAgICAgICBhc3luYyBhdXRvQ2FsY3VsYXRlKCkgewogICAgICAgICAgICBsZXQgZXhwRFMgPSB0aGlzLiRyZWZzLmV4cGVuc2VBY2NvdW50RFMua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIHN1YlRvdGFsID0gMCwKICAgICAgICAgICAgICAgIGRpc2NvdW50ID0gMCwKICAgICAgICAgICAgICAgIHB1cmNoYXNlVGF4ID0gMCwKICAgICAgICAgICAgICAgIHdoZFRheCA9IDAsCiAgICAgICAgICAgICAgICBpbmNsdXNpdmVUYXggPSAwLAogICAgICAgICAgICAgICAgdGF4TGlzdERldGFpbCA9IFtdLAogICAgICAgICAgICAgICAgdGF4ID0gW10sCiAgICAgICAgICAgICAgICBkaXNjb3VudEl0ZW0gPSBbXTsKCiAgICAgICAgICAgIC8vIEV4cGVuc2UKICAgICAgICAgICAgZXhwRFMuZGF0YSgpLmZvckVhY2goKHZhbHVlKSA9PiB7CiAgICAgICAgICAgICAgICBsZXQgYW10ID0ga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5wcmljZSkgKiBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnF1YW50aXR5KTsKCiAgICAgICAgICAgICAgICAvKiBTdWJ0b3RhbCAqLwogICAgICAgICAgICAgICAgc3ViVG90YWwgKz0gYW10OwoKICAgICAgICAgICAgICAgIC8vIERpc2NvdW50CiAgICAgICAgICAgICAgICBsZXQgZGlzY291bnRBbW91bnQgPSAwOwogICAgICAgICAgICAgICAgaWYgKHZhbHVlLmhhc093blByb3BlcnR5KCdkaXNjb3VudCcpKQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5kaXNjb3VudC5oYXNPd25Qcm9wZXJ0eSgnaWQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmRpc2NvdW50LmlkICE9PSAiIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzY291bnRBbW91bnQgPSB0aGlzLmNhbGN1bGF0ZURpc2NvdW50KHZhbHVlLmRpc2NvdW50LCBhbXQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzY291bnQgKz0gZGlzY291bnRBbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudEl0ZW0ucHVzaCh2YWx1ZS5kaXNjb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBUYXgKICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5oYXNPd25Qcm9wZXJ0eSgndGF4X2l0ZW0nKSkKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUudGF4X2l0ZW0uaGFzT3duUHJvcGVydHkoJ2lkJykpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS50YXhfaXRlbS5pZCAhPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBhbXRBZnRlckRpc2NvdW50ID0gYW10IC0gZGlzY291bnRBbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXhBbW91bnQgPSB0aGlzLmF1dG9DYWxjdWxhdGVUYXgodmFsdWUudGF4X2l0ZW0sIGFtdEFmdGVyRGlzY291bnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnRheF9pdGVtLmJhc2VBbW91bnQudG9Mb3dlckNhc2UoKSA9PT0gVGF4VHlwZS5JTkNMVVNJVkUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNsdXNpdmVUYXggKz0gdGF4QW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLyp0b2RvOiBhZGQgZXhwZW5zZSB0YXggKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnN0IHZhdFRheF8gPSB2YWx1ZS50YXhfaXRlbSB8fCB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGF4Wyd0YXhBbW91bnQnXSA9IHRheEFtb3VudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGF4WydhbW91bnQnXSA9IHZhbHVlLmFtb3VudCB8fCAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXhbJ2Rpc2NvdW50J10gPSBkaXNjb3VudEFtb3VudCB8fCAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXhbJ3R4blJhdGUnXSA9IHRoaXMuZXhjaGFuZ2VSYXRlLnJhdGUgfHwgMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGF4Wydpc1ZhdCddID0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGF4WydsaW5lJ10gPSBuZXcgVGF4TW9kZWwodmFsdWUudGF4X2l0ZW0gfHwge30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXguZGV0YWlsID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwZWNpZmljVGF4OiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWNMaWdodGluZ1RheDoge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3RoZXJUYXg6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGF4TGlzdERldGFpbC5wdXNoKHRheCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUudGF4X2l0ZW0uaGFzT3duUHJvcGVydHkoJ3RheFR5cGUnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUudGF4X2l0ZW0udGF4VHlwZS5oYXNPd25Qcm9wZXJ0eSgndHlwZUlkJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS50YXhfaXRlbS50YXhUeXBlLnR5cGVJZCA9PT0gMikgey8qIFdIRCBUYXggKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoZFRheCArPSB0YXhBbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7LyogUHVyY2hhc2UgVGF4ICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXJjaGFzZVRheCArPSB0YXhBbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBTZXQgVGF4IEFtb3VudCAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnRheF9pdGVtLnRheFR5cGUudHlwZUlkID09PSAxICYmIHZhbHVlLnRheF9pdGVtLmJhc2VBbW91bnQudG9Mb3dlckNhc2UoKSA9PT0gVGF4VHlwZS5JTkNMVVNJVkUpIHsvKiBJbmNsdXNpdmUgVGF4ICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUuc2V0KCJ0YXhfYW1vdW50IiwgdGF4QW1vdW50ICogLTEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZS5zZXQoInRheF9hbW91bnQiLCB0YXhBbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8qIEFwcGx5IEluY2x1c2l2ZSBUYXggKi8KICAgICAgICAgICAgc3ViVG90YWwgLT0gaW5jbHVzaXZlVGF4OwoKICAgICAgICAgICAgdGhpcy5zdWJUb3RhbCA9IHN1YlRvdGFsOwogICAgICAgICAgICB0aGlzLmRpc2NvdW50QW1vdW50ID0gZGlzY291bnQ7CiAgICAgICAgICAgIHRoaXMucHVyY2hhc2VUYXggPSBwdXJjaGFzZVRheDsKICAgICAgICAgICAgdGhpcy53aGRUYXggPSB3aGRUYXg7CgogICAgICAgICAgICBsZXQgdG90YWxBbW91bnQgPSAodGhpcy5zdWJUb3RhbCAtIGRpc2NvdW50KSArIHdoZFRheCArIHB1cmNoYXNlVGF4OwogICAgICAgICAgICB0aGlzLnRvdGFsQW1vdW50ID0gdG90YWxBbW91bnQ7CgogICAgICAgICAgICBsZXQgYW1vdW50RHVlID0gKHRoaXMudG90YWxBbW91bnQgLSB0aGlzLmRlcG9zaXRBbW91bnQpIC0gd2hkVGF4OwogICAgICAgICAgICB0aGlzLmFtb3VudER1ZSA9IGFtb3VudER1ZTsKCiAgICAgICAgICAgIHRoaXMuc3VwcGxpZXJEaXNjb3VudEl0ZW0gPSB0aGlzLnJlbW92ZUR1cGxpY2F0ZShkaXNjb3VudEl0ZW0pOwoKICAgICAgICAgICAgdGhpcy50YXhMaXN0RGV0YWlsID0gdGF4TGlzdERldGFpbAogICAgICAgICAgICBhd2FpdCB0aGlzLmF1dG9DYWxjdWxhdGVUYXhEZXRhaWwoKQogICAgICAgIH0sCiAgICAgICAgLy8gUm93IE51bWJlciBUZW1wbGF0ZQogICAgICAgIHJvd051bWJlclRtcGwoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5leHBlbnNlQWNjb3VudERTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICBpbmRleCA9IGRzLmluZGV4T2YoZGF0YUl0ZW0pOwoKICAgICAgICAgICAgcmV0dXJuIGluZGV4ICsgMTsKICAgICAgICB9LAogICAgICAgIC8vIEdyaWQgQ3VzdG9tIEVkaXRvcgogICAgICAgIGV4cGVuc2VBY2NvdW50RWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICByZXR1cm4gSGVscGVyLmFjY291bnRFZGl0b3IoY29udGFpbmVyLCBvcHRpb25zLCB0aGlzLmV4cGVuc2VBY2NvdW50cyk7CiAgICAgICAgfSwKICAgICAgICAvLyBBZGQgTmV3IFJvdwogICAgICAgIGFkZFJvdygpIHsKICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5leHBlbnNlQWNjb3VudERTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICBsYXN0ID0gZHMudG90YWwoKTsKCiAgICAgICAgICAgIGxldCBqZSA9IG5ldyBFeHBlbnNlRW50cnlFeHRlbmRlZE1vZGVsKCk7CiAgICAgICAgICAgIGplLnF1YW50aXR5ID0gMTsKICAgICAgICAgICAgamUuZGVjaW1hbEZvcm1hdCA9IHRoaXMuZGVjaW1hbEZvcm1hdDsKCiAgICAgICAgICAgIGRzLmluc2VydChsYXN0LCBqZSk7CiAgICAgICAgfSwKICAgICAgICAvLyBBZGQgRXh0cmEgUm93CiAgICAgICAgYWRkRXh0cmFSb3codWlkKSB7CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuZXhwZW5zZUFjY291bnREUy5rZW5kb1dpZGdldCgpLAogICAgICAgICAgICAgICAgdG90YWwgPSBkcy50b3RhbCgpLAogICAgICAgICAgICAgICAgcm93ID0gZHMuZ2V0QnlVaWQodWlkKSwKICAgICAgICAgICAgICAgIGluZGV4ID0gZHMuaW5kZXhPZihyb3cpOwoKICAgICAgICAgICAgaWYgKGluZGV4ID09PSB0b3RhbCAtIDEpIHsKICAgICAgICAgICAgICAgIHRoaXMuYWRkUm93KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIC8vIFJlbW92ZSBSb3cKICAgICAgICByZW1vdmVSb3coZSkgewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgICAgICBsZXQgZ3JpZCA9IHRoaXMuJHJlZnMuZXhwZW5zZUdyaWQua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIGRzID0gZ3JpZC5kYXRhU291cmNlLAogICAgICAgICAgICAgICAgZGF0YUl0ZW0gPSBncmlkLmRhdGFJdGVtKGtlbmRvLmpRdWVyeShlLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoInRyIikpOwoKICAgICAgICAgICAgaWYgKGRzLmRhdGEoKS5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICBkcy5yZW1vdmUoZGF0YUl0ZW0pOwogICAgICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHJlbW92ZUVtcHR5Um93KCkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLmV4cGVuc2VBY2NvdW50RFMua2VuZG9XaWRnZXQoKTsKCiAgICAgICAgICAgIC8qIENvbGxlY3QgZW1wdHkgcm93IGJ5IHVpZCAqLwogICAgICAgICAgICBsZXQgZW1wdHlJZHMgPSBbXTsKICAgICAgICAgICAgZHMuZGF0YSgpLmZvckVhY2godmFsdWUgPT4gewogICAgICAgICAgICAgICAgaWYgKHZhbHVlLmFjY291bnQubmFtZSA9PT0gJycpIHsKICAgICAgICAgICAgICAgICAgICBlbXB0eUlkcy5wdXNoKHZhbHVlLnVpZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLyogUmVtb3ZlIGVtcHR5IHJvdyBieSB1aWQgKi8KICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlbXB0eUlkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgY29uc3QgZGF0YUl0ZW0gPSBkcy5nZXRCeVVpZChlbXB0eUlkc1tpXSk7CiAgICAgICAgICAgICAgICBkcy5yZW1vdmUoZGF0YUl0ZW0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAvLyBTaHJpbmsgRGF0YQogICAgICAgIHNocmlua0RhdGEoKSB7CiAgICAgICAgICAgIC8vIERhdGUKICAgICAgICAgICAgdGhpcy5leHBlbnNlLmV4cGVuc2VfZGF0ZSA9IEhlbHBlci50b0lTT0RhdGUodGhpcy5leHBlbnNlLmV4cGVuc2VfZGF0ZSk7CiAgICAgICAgICAgIHRoaXMuZXhwZW5zZS5iaWxsX2RhdGUgPSBIZWxwZXIudG9JU09EYXRlKHRoaXMuZXhwZW5zZS5iaWxsX2RhdGUpOwogICAgICAgICAgICB0aGlzLmV4cGVuc2UuZHVlX2RhdGUgPSBIZWxwZXIudG9JU09EYXRlKHRoaXMuZXhwZW5zZS5kdWVfZGF0ZSk7CiAgICAgICAgICAgIHRoaXMuZXhwZW5zZS5wYXltZW50X3Rlcm0gPSB0aGlzLnBheW1lbnRUZXJtLmlkOwoKICAgICAgICAgICAgLy8gQ3VycmVuY3kKICAgICAgICAgICAgdGhpcy5leHBlbnNlLmJpbGxfY3VycmVuY3kgPSB0aGlzLmN1cnJlbmN5OwoKICAgICAgICAgICAgLy8gU3VwcGxpZXIKICAgICAgICAgICAgdGhpcy5leHBlbnNlLnN1cHBsaWVyID0gbmV3IENvbnRhY3RNb2RlbCh0aGlzLnN1cHBsaWVyKTsKCiAgICAgICAgICAgIC8vIEVtcGxveWVlCiAgICAgICAgICAgIHRoaXMuZXhwZW5zZS5lbXBsb3llZSA9IG5ldyBDb250YWN0TW9kZWwodGhpcy5lbXBsb3llZSk7CgogICAgICAgICAgICAvLyBTaWRlYmFyCiAgICAgICAgICAgIHRoaXMuZXhwZW5zZS5sb2NhdGlvbl91dWlkID0gdGhpcy5sb2NhdGlvbi5pZDsKICAgICAgICAgICAgdGhpcy5leHBlbnNlLnNlZ21lbnRfdXVpZCA9IHRoaXMuc2VnbWVudC5pZDsKICAgICAgICAgICAgdGhpcy5leHBlbnNlLnByb2plY3RfdXVpZCA9IHRoaXMucHJvamVjdC5pZDsKCiAgICAgICAgICAgIC8qIFN0YXR1cyAqLwogICAgICAgICAgICBpZiAodGhpcy5leHBlbnNlLnVzZV9mb3Jfb3B0aW9uID09PSAzKSB7LyogQ2FzaCAqLwogICAgICAgICAgICAgICAgdGhpcy5leHBlbnNlLmlzX2NsZWFyZWQgPSAxOyAvKiBQYWlkICovCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFVzZXIKICAgICAgICAgICAgaWYgKHRoaXMuaXNFZGl0KSB7CiAgICAgICAgICAgICAgICB0aGlzLmV4cGVuc2UubW9kaWZpZWRfYnkgPSB0aGlzLnVzZXI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLmV4cGVuc2UuY3JlYXRlZF9ieSA9IHRoaXMudXNlcjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLyogUmVtb3ZlIEVtcHR5IFJvd3MgKi8KICAgICAgICAgICAgdGhpcy5yZW1vdmVFbXB0eVJvdygpOwoKICAgICAgICAgICAgLyogRXhwZW5zZSBFbnRyaWVzICovCiAgICAgICAgICAgIGxldCBlbnRyaWVzID0gW10sCiAgICAgICAgICAgICAgICBleHBEUyA9IHRoaXMuJHJlZnMuZXhwZW5zZUFjY291bnREUy5rZW5kb1dpZGdldCgpOwoKICAgICAgICAgICAgLyogRXhwZW5zZSBBY2NvdW50IG9uIERyICovCiAgICAgICAgICAgIGV4cERTLmRhdGEoKS5mb3JFYWNoKCh2YWx1ZSkgPT4gewogICAgICAgICAgICAgICAgbGV0IGVudHJ5ID0gbmV3IEV4cGVuc2VFbnRyeU1vZGVsKHZhbHVlKTsKCiAgICAgICAgICAgICAgICAvLyBBY2NvdW50CiAgICAgICAgICAgICAgICBlbnRyeS5hY2NvdW50ID0gbmV3IEFjY291bnRNb2RlbCh2YWx1ZS5hY2NvdW50KTsKCiAgICAgICAgICAgICAgICAvLyBDb250YWN0CiAgICAgICAgICAgICAgICBlbnRyeS5wcmltYXJ5X2NvbnRhY3QgPSBuZXcgQ29udGFjdE1vZGVsKHRoaXMuc3VwcGxpZXIpOwogICAgICAgICAgICAgICAgZW50cnkuc2Vjb25kYXJ5X2NvbnRhY3RzID0gW25ldyBDb250YWN0TW9kZWwodGhpcy5lbXBsb3llZSldOwoKICAgICAgICAgICAgICAgIC8qIERpc2NvdW50ICovCiAgICAgICAgICAgICAgICBlbnRyeS5kaXNjb3VudCA9IG5ldyBEaXNjb3VudEl0ZW1Nb2RlbCh2YWx1ZS5kaXNjb3VudCk7CgogICAgICAgICAgICAgICAgLyogVGF4ICovCiAgICAgICAgICAgICAgICBlbnRyeS50YXhfaXRlbSA9IG5ldyBUYXhNb2RlbCh2YWx1ZS50YXhfaXRlbSk7CgogICAgICAgICAgICAgICAgLy8gQ3VycmVuY3kKICAgICAgICAgICAgICAgIGVudHJ5LmN1cnJlbmN5ID0gbmV3IEN1cnJlbmN5TW9kZWwodGhpcy5jdXJyZW5jeSk7CiAgICAgICAgICAgICAgICBlbnRyeS5leGNoYW5nZV9yYXRlX3V1aWQgPSB0aGlzLmV4Y2hhbmdlUmF0ZS5pZDsKICAgICAgICAgICAgICAgIGVudHJ5LmV4Y2hhbmdlX3JhdGUgPSB0aGlzLmV4Y2hhbmdlUmF0ZS5yYXRlOwogICAgICAgICAgICAgICAgZW50cnkuZXhjaGFuZ2VkX2Ftb3VudCA9IHZhbHVlLmFtb3VudCAqIHRoaXMuZXhjaGFuZ2VSYXRlLnJhdGU7CiAgICAgICAgICAgICAgICBlbnRyeS5leGNoYW5nZWRfdGF4X2Ftb3VudCA9IHZhbHVlLnRheF9hbW91bnQgKiB0aGlzLmV4Y2hhbmdlUmF0ZS5yYXRlOwoKICAgICAgICAgICAgICAgIC8vIERpc2NvdW50IG9uIENyCiAgICAgICAgICAgICAgICBsZXQgZGlzY291bnRBbW91bnQgPSAwOwogICAgICAgICAgICAgICAgaWYgKHZhbHVlLmhhc093blByb3BlcnR5KCdkaXNjb3VudCcpKQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5kaXNjb3VudC5oYXNPd25Qcm9wZXJ0eSgnaWQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmRpc2NvdW50LmlkICE9PSAiIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHN1YlRvID0ga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5wcmljZSkgKiBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnF1YW50aXR5KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50QW1vdW50ID0gdGhpcy5jYWxjdWxhdGVEaXNjb3VudCh2YWx1ZS5kaXNjb3VudCwgc3ViVG8pOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIERpc2NvdW50IEVudHJ5ICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZGlzY291bnRFbnRyeSA9IG5ldyBFeHBlbnNlRW50cnlNb2RlbChlbnRyeSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudEVudHJ5LmFjY291bnQgPSBuZXcgQWNjb3VudE1vZGVsKHZhbHVlLmRpc2NvdW50LmFjY291bnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzY291bnRFbnRyeS5hY2NvdW50X3V1aWQgPSB2YWx1ZS5kaXNjb3VudC5hY2NvdW50LnV1aWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudEVudHJ5LmFtb3VudCA9IGRpc2NvdW50QW1vdW50ICogLTE7IC8vIENyIHNpZGUgaXMgbmVnYXRpdmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50RW50cnkuZXhjaGFuZ2VkX2Ftb3VudCA9IGRpc2NvdW50QW1vdW50ICogdGhpcy5leGNoYW5nZVJhdGUucmF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50RW50cnkudGF4X2Ftb3VudCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudEVudHJ5LmV4Y2hhbmdlZF90YXhfYW1vdW50ID0gMDsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBQdXNoIERpc2NvdW50IEVudHJ5ICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRyaWVzLnB1c2goZGlzY291bnRFbnRyeSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBUYXhlcyBvbiBEcgogICAgICAgICAgICAgICAgaWYgKHZhbHVlLmhhc093blByb3BlcnR5KCd0YXhfaXRlbScpKQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS50YXhfaXRlbS5oYXNPd25Qcm9wZXJ0eSgnaWQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnRheF9pdGVtLmlkICE9PSAiIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGFtdEFmdGVyRGlzY291bnQgPSBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmFtb3VudCkgLSBkaXNjb3VudEFtb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0YXhBbW91bnQgPSB0aGlzLmF1dG9DYWxjdWxhdGVUYXgodmFsdWUudGF4X2l0ZW0sIGFtdEFmdGVyRGlzY291bnQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS50YXhfaXRlbS5oYXNPd25Qcm9wZXJ0eSgndGF4VHlwZScpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS50YXhfaXRlbS50YXhUeXBlLmhhc093blByb3BlcnR5KCd0eXBlSWQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnRheF9pdGVtLnRheFR5cGUudHlwZUlkID09PSAyKSB7LyogV0hEIFRheCBvbiBDciBzaWRlICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUudGF4X2l0ZW0uYmFzZUFtb3VudC50b0xvd2VyQ2FzZSgpID09PSAibmV0Iikgey8qIFdIRCBUYXggTmV0IG9uIERyIHNpZGUgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGQgQW5vdGhlciBUYXggUmVsYXRlZCBFeHBlbnNlIEFjY291bnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdGF4UmVsYXRlZEV4cGVuc2VBY2NvdW50ID0gbmV3IEFjY291bnRNb2RlbCh0aGlzLmFjY291bnRzLmZpbmQoaSA9PiBpLmJhbmhqaUFjY0NvZGUgPT09IEFjY291bnRUeXBlQ29kZS5UQVhfUkVMQVRFRF9FWFBFTlNFX0NPREUpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogVGF4IFJlbGF0ZWQgRXhwZW5zZSBFbnRyeSBvbiBEciAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0YXhSZWxhdGVkRXhwZW5zZUVudHJ5ID0gbmV3IEV4cGVuc2VFbnRyeU1vZGVsKGVudHJ5KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXhSZWxhdGVkRXhwZW5zZUVudHJ5LmFjY291bnQgPSB0YXhSZWxhdGVkRXhwZW5zZUFjY291bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGF4UmVsYXRlZEV4cGVuc2VFbnRyeS5hY2NvdW50X3V1aWQgPSB0YXhSZWxhdGVkRXhwZW5zZUFjY291bnQudXVpZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXhSZWxhdGVkRXhwZW5zZUVudHJ5LmRlc2NyaXB0aW9uID0gaTE4bi50KCJ3aXRob2xkaW5nX3RheF9leHBlbnNlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGF4UmVsYXRlZEV4cGVuc2VFbnRyeS5hbW91bnQgPSB0YXhBbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGF4UmVsYXRlZEV4cGVuc2VFbnRyeS5leGNoYW5nZWRfYW1vdW50ID0gdGF4QW1vdW50ICogdGhpcy5leGNoYW5nZVJhdGUucmF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXhSZWxhdGVkRXhwZW5zZUVudHJ5LnRheF9hbW91bnQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRheFJlbGF0ZWRFeHBlbnNlRW50cnkuZXhjaGFuZ2VkX3RheF9hbW91bnQgPSAwOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBQdXNoIFRheCBSZWxhdGVkIEV4cGVuc2UgRW50cnkgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRyaWVzLnB1c2godGF4UmVsYXRlZEV4cGVuc2VFbnRyeSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gV0hEIFRheAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGF4QW1vdW50ICo9IC0xOyAvLyBDciBzaWRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBUYXggRW50cnkgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0YXhFbnRyeSA9IG5ldyBFeHBlbnNlRW50cnlNb2RlbChlbnRyeSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXhFbnRyeS5hY2NvdW50ID0gbmV3IEFjY291bnRNb2RlbCh2YWx1ZS50YXhfaXRlbS5hY2NvdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRheEVudHJ5LmFjY291bnRfdXVpZCA9IHZhbHVlLnRheF9pdGVtLmFjY291bnQudXVpZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRheEVudHJ5LmFtb3VudCA9IHRheEFtb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRheEVudHJ5LmV4Y2hhbmdlZF9hbW91bnQgPSB0YXhBbW91bnQgKiB0aGlzLmV4Y2hhbmdlUmF0ZS5yYXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGF4RW50cnkudGF4X2Ftb3VudCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXhFbnRyeS5leGNoYW5nZWRfdGF4X2Ftb3VudCA9IDA7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogUHVzaCBUYXggRW50cnkgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudHJpZXMucHVzaCh0YXhFbnRyeSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvKiBQdXNoIEVudHJ5ICovCiAgICAgICAgICAgICAgICBlbnRyaWVzLnB1c2goZW50cnkpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIERlcG9zaXQgQWNjb3VudCBvbiBDcgogICAgICAgICAgICBpZiAodGhpcy5kZXBvc2l0QW1vdW50ID4gMCkgewogICAgICAgICAgICAgICAgZW50cmllcy5wdXNoKAogICAgICAgICAgICAgICAgICAgIG5ldyBFeHBlbnNlRW50cnlNb2RlbCh7CiAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IG5ldyBBY2NvdW50TW9kZWwodGhpcy5zdXBwbGllci5hY2NvdW50VGF4LnB1cmNoYXNlRGVwb3NpdEFjYyksCiAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRfdXVpZDogdGhpcy5zdXBwbGllci5hY2NvdW50VGF4LnB1cmNoYXNlRGVwb3NpdEFjYy51dWlkLAogICAgICAgICAgICAgICAgICAgICAgICBwcmltYXJ5X2NvbnRhY3Q6IG5ldyBDb250YWN0TW9kZWwodGhpcy5zdXBwbGllciksCiAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZGFyeV9jb250YWN0czogW25ldyBDb250YWN0TW9kZWwodGhpcy5lbXBsb3llZSldLAogICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5leHBlbnNlLmpvdXJuYWxfbm90ZSwKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k6IG5ldyBDdXJyZW5jeU1vZGVsKHRoaXMuY3VycmVuY3kpLAogICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IHRoaXMuZGVwb3NpdEFtb3VudCAqIC0xLCAvLyBDciBzaWRlIGlzIG5lZ2F0aXZlCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlX3JhdGVfdXVpZDogdGhpcy5leGNoYW5nZVJhdGUuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlX3JhdGU6IHRoaXMuZXhjaGFuZ2VSYXRlLnJhdGUsCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFRyYW5zYWN0aW9uIEFjY291bnQgb24gQ3IKICAgICAgICAgICAgZW50cmllcy5wdXNoKAogICAgICAgICAgICAgICAgbmV3IEV4cGVuc2VFbnRyeU1vZGVsKHsKICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiBuZXcgQWNjb3VudE1vZGVsKHRoaXMuZXhwZW5zZS50cmFuc2FjdGlvbl9hY2NvdW50KSwKICAgICAgICAgICAgICAgICAgICBhY2NvdW50X3V1aWQ6IHRoaXMuZXhwZW5zZS50cmFuc2FjdGlvbl9hY2NvdW50LnV1aWQsCiAgICAgICAgICAgICAgICAgICAgc2Vjb25kYXJ5X2FjY191dWlkOiB0aGlzLnNlY29uZGFyeUFjY291bnQudXVpZCwKICAgICAgICAgICAgICAgICAgICBwcmltYXJ5X2NvbnRhY3Q6IG5ldyBDb250YWN0TW9kZWwodGhpcy5zdXBwbGllciksCiAgICAgICAgICAgICAgICAgICAgc2Vjb25kYXJ5X2NvbnRhY3RzOiBbbmV3IENvbnRhY3RNb2RlbCh0aGlzLmVtcGxveWVlKV0sCiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuZXhwZW5zZS5qb3VybmFsX25vdGUsCiAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k6IG5ldyBDdXJyZW5jeU1vZGVsKHRoaXMuY3VycmVuY3kpLAogICAgICAgICAgICAgICAgICAgIGFtb3VudDogdGhpcy5hbW91bnREdWUgKiAtMSwvLyBDciBzaWRlIGlzIG5lZ2F0aXZlCiAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VfcmF0ZV91dWlkOiB0aGlzLmV4Y2hhbmdlUmF0ZS5pZCwKICAgICAgICAgICAgICAgICAgICBleGNoYW5nZV9yYXRlOiB0aGlzLmV4Y2hhbmdlUmF0ZS5yYXRlLAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIC8vIFVzZSBleGlzdGluZyB1dWlkCiAgICAgICAgICAgIGlmICh0aGlzLmlzRWRpdCkgewogICAgICAgICAgICAgICAgLyogQ2xlYXIgdXVpZCAqLwogICAgICAgICAgICAgICAgZW50cmllcy5mb3JFYWNoKHZhbHVlID0+IHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZS51dWlkID0gIiI7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAvKiBBcHBseSBleGlzdGluZyB1dWlkICovCiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuam91cm5hbC5qb3VybmFsX2VudHJpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaSA8IGVudHJpZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9sZEVudHJ5ID0gdGhpcy5qb3VybmFsLmpvdXJuYWxfZW50cmllc1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgZW50cmllc1tpXS51dWlkID0gb2xkRW50cnkudXVpZDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8qIEJpbmQgRXhwZW5zZSBFbnRyaWVzICovCiAgICAgICAgICAgIHRoaXMuZXhwZW5zZS5leHBlbnNlX2VudHJpZXMgPSBlbnRyaWVzOwoKICAgICAgICAgICAgLy8gbWFwcGluZyB0byBEeW5hbW9kYiAoIGV4cGVuc2UgcmVjb3JkICkgLT4gc2F2ZSBldmVyeXdoZXJlIG1vcm5nIF5fXgogICAgICAgICAgICB0aGlzLm1hcHBpbmdFeHBlbnNlKHRoaXMuZXhwZW5zZSk7CiAgICAgICAgfSwKICAgICAgICAvLyBBZGQgSm91cm5hbAogICAgICAgIGFkZEpvdXJuYWwoKSB7CiAgICAgICAgICAgIGxldCBlbnRyaWVzID0gW107CgogICAgICAgICAgICAvKiBBZGQgSm91cm5hbCBFbnRyaWVzICovCiAgICAgICAgICAgIHRoaXMuZXhwZW5zZS5leHBlbnNlX2VudHJpZXMuZm9yRWFjaCgodmFsdWUpID0+IHsKICAgICAgICAgICAgICAgIGxldCBlbnRyeSA9IG5ldyBKb3VybmFsRW50cnlNb2RlbCh2YWx1ZSk7CgogICAgICAgICAgICAgICAgLyogQXBwbHkgSW5jbHVzaXZlIFRheCB0byBhbW91bnQgKi8KICAgICAgICAgICAgICAgIGlmICh2YWx1ZS50YXhfYW1vdW50ICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnRheF9pdGVtLmhhc093blByb3BlcnR5KCJ0YXhUeXBlIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnRheF9pdGVtLnRheFR5cGUuaGFzT3duUHJvcGVydHkoInR5cGVJZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUudGF4X2l0ZW0udGF4VHlwZS50eXBlSWQgPT09IDEgJiYgdmFsdWUudGF4X2l0ZW0uYmFzZUFtb3VudC50b0xvd2VyQ2FzZSgpID09PSBUYXhUeXBlLklOQ0xVU0lWRSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5LmFtb3VudCA9IHZhbHVlLmFtb3VudCArIHZhbHVlLnRheF9hbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbnRyeS5leGNoYW5nZWRfYW1vdW50ID0gZW50cnkuYW1vdW50ICogdGhpcy5leGNoYW5nZVJhdGUucmF0ZTsKCiAgICAgICAgICAgICAgICAvLyBBZGQgRW50cnkKICAgICAgICAgICAgICAgIGVudHJpZXMucHVzaChlbnRyeSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gSm91cm5hbCBFbnRyaWVzCiAgICAgICAgICAgIHRoaXMuam91cm5hbEVudHJpZXMgPSBlbnRyaWVzOwoKICAgICAgICAgICAgLy8gSm91cm5hbAogICAgICAgICAgICB0aGlzLmpvdXJuYWwubnVtYmVyID0gdGhpcy5leHBlbnNlLm51bWJlcjsKICAgICAgICAgICAgdGhpcy5qb3VybmFsLmRlc2NyaXB0aW9uID0gdGhpcy5leHBlbnNlLmpvdXJuYWxfbm90ZTsKICAgICAgICAgICAgdGhpcy5qb3VybmFsLmpvdXJuYWxfZGF0ZSA9IEhlbHBlci50b0lTT0RhdGUodGhpcy5leHBlbnNlLmV4cGVuc2VfZGF0ZSk7CiAgICAgICAgICAgIHRoaXMuam91cm5hbC5qb3VybmFsX3R5cGUgPSBFbnRpdHlUeXBlLkFVVE9fSk9VUk5BTDsKICAgICAgICAgICAgdGhpcy5qb3VybmFsLnRyYW5zYWN0aW9uX3R5cGUgPSBFbnRpdHlUeXBlLkVYUEVOU0VTOwogICAgICAgICAgICB0aGlzLmpvdXJuYWwucmVsYXRlZF90cmFuc2FjdGlvbl91dWlkID0gdGhpcy5leHBlbnNlLnVzZV9mb3JfdHJhbnNhY3Rpb25fdXVpZDsKICAgICAgICAgICAgdGhpcy5qb3VybmFsLm1vbnRoX29mID0gdGhpcy5leHBlbnNlLm1vbnRoX29mOwogICAgICAgICAgICB0aGlzLmpvdXJuYWwubG9jYXRpb25fdXVpZCA9IHRoaXMuZXhwZW5zZS5sb2NhdGlvbl91dWlkOwogICAgICAgICAgICB0aGlzLmpvdXJuYWwucHJvamVjdF91dWlkID0gdGhpcy5leHBlbnNlLnByb2plY3RfdXVpZDsKICAgICAgICAgICAgdGhpcy5qb3VybmFsLnNlZ21lbnRfdXVpZCA9IHRoaXMuZXhwZW5zZS5zZWdtZW50X3V1aWQ7CiAgICAgICAgICAgIHRoaXMuam91cm5hbC5wcmVmaXhfZm9ybWF0ID0gdGhpcy5leHBlbnNlLnByZWZpeF9mb3JtYXQ7CiAgICAgICAgICAgIHRoaXMuam91cm5hbC5pc19kcmFmdCA9IHRoaXMuZXhwZW5zZS5pc19kcmFmdDsKICAgICAgICAgICAgdGhpcy5qb3VybmFsLmNyZWF0ZWRfZGF0ZSA9IHRoaXMuZXhwZW5zZS5jcmVhdGVkX2RhdGU7CiAgICAgICAgICAgIHRoaXMuam91cm5hbC5jcmVhdGVkX2J5ID0gdGhpcy5leHBlbnNlLmNyZWF0ZWRfYnk7CiAgICAgICAgICAgIHRoaXMuam91cm5hbC5tb2RpZmllZF9ieSA9IHRoaXMuZXhwZW5zZS5tb2RpZmllZF9ieTsKICAgICAgICB9LAogICAgICAgIC8vIFZhbGlkYXRpbmcKICAgICAgICB2YWxpZGF0ZUZvcm0oKSB7CiAgICAgICAgICAgIGxldCByZXN1bHQgPSB0cnVlLAogICAgICAgICAgICAgICAgZXhwRFMgPSB0aGlzLiRyZWZzLmV4cGVuc2VBY2NvdW50RFMua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIG1zZyA9ICIiLAogICAgICAgICAgICAgICAgc2Vjb25kYXJ5QWNjb3VudENvdW50ID0gMCwKICAgICAgICAgICAgICAgIGV4cGVuc2VDb3VudCA9IDA7CgogICAgICAgICAgICAvLyBTdXBwbGllcgogICAgICAgICAgICBpZiAodGhpcy5zdXBwbGllci5pZCA9PT0gIiIpIHsKICAgICAgICAgICAgICAgIG1zZyArPSBgPHA+JHtpMThuLnQoInN1cHBsaWVyX2lzX3JlcXVpcmVkIil9PC9wPmA7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQmlsbCBOdW1iZXIKICAgICAgICAgICAgaWYgKHRoaXMuZXhwZW5zZS5iaWxsX251bWJlciA9PT0gIiIpIHsKICAgICAgICAgICAgICAgIG1zZyArPSBgPHA+JHtpMThuLnQoImJpbGxfbnVtYmVyX2lzX3JlcXVpcmVkIil9PC9wPmA7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gUGF5bWVudCBUZXJtCiAgICAgICAgICAgIGlmICh0aGlzLnBheW1lbnRUZXJtLmhhc093blByb3BlcnR5KCJpZCIpKQogICAgICAgICAgICAgICAgaWYgKHRoaXMucGF5bWVudFRlcm0uaWQgPT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgbXNnICs9IGA8cD4ke2kxOG4udCgicGF5bWVudF90ZXJtX2lzX3JlcXVpcmVkIil9PC9wPmA7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBFbXBsb3llZQogICAgICAgICAgICBsZXQgZW1wbG95ZWVPcHRpb25zID0gWzEsIDJdOwogICAgICAgICAgICBpZiAodGhpcy5lbXBsb3llZS5pZCA9PT0gIiIgJiYgfmVtcGxveWVlT3B0aW9ucy5pbmRleE9mKHRoaXMuZXhwZW5zZS51c2VfZm9yX29wdGlvbikpIHsKICAgICAgICAgICAgICAgIG1zZyArPSBgPHA+JHtpMThuLnQoImVtcGxveWVlX2lzX3JlcXVpcmVkIil9PC9wPmA7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRXhwZW5zZQogICAgICAgICAgICBleHBEUy5kYXRhKCkuZm9yRWFjaCgodmFsdWUsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICAvLyBObyBhY2NvdW50CiAgICAgICAgICAgICAgICBpZiAodmFsdWUuYWNjb3VudC51dWlkID09PSAiIiAmJiB2YWx1ZS5hbW91bnQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgbXNnICs9IGA8cD4ke2kxOG4udCgKICAgICAgICAgICAgICAgICAgICAgICAgInBsZWFzZV9zZWxlY3RfZXhwZW5zZV9hY2NvdW50X2F0X3Jvd19udW1iZXIiCiAgICAgICAgICAgICAgICAgICAgKX0gJHtpbmRleCArIDF9PC9wPmA7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gTm8gYW1vdW50CiAgICAgICAgICAgICAgICBpZiAodmFsdWUuYWNjb3VudC51dWlkICE9PSAiIiAmJiB2YWx1ZS5hbW91bnQgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBtc2cgKz0gYDxwPiR7dmFsdWUuYWNjb3VudC5uYW1lfSAke2kxOG4udCgiaGFzX25vX2Ftb3VudCIpfTwvcD5gOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIC8vIERpc2NvdW50CiAgICAgICAgICAgICAgICAvLyBpZih2YWx1ZS5oYXNPd25Qcm9wZXJ0eSgnZGlzY291bnQnKSkKICAgICAgICAgICAgICAgIC8vIGlmKHZhbHVlLmRpc2NvdW50Lmhhc093blByb3BlcnR5KCdhY2NvdW50JykpCiAgICAgICAgICAgICAgICAvLyBpZiAodmFsdWUuZGlzY291bnQuYWNjb3VudC51dWlkID09PSAiIiB8fCB2YWx1ZS5kaXNjb3VudC5hY2NvdW50LmFjY291bnRfdHlwZS5udW1iZXIgPT09IDApIHsKICAgICAgICAgICAgICAgIC8vICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIC8vICAgICBtc2cgKz0gYDxwPiR7aTE4bi50KCJpbnZhbGlkX2Rpc2NvdW50X2FjY291bnRfYXRfcm93X251bWJlciIpfSAke2luZGV4ICsgMX08L3A+YDsKICAgICAgICAgICAgICAgIC8vIH0KCiAgICAgICAgICAgICAgICAvLyAvLyBUYXgKICAgICAgICAgICAgICAgIC8vIGlmKHZhbHVlLmhhc093blByb3BlcnR5KCd0YXhfaXRlbScpKQogICAgICAgICAgICAgICAgLy8gaWYodmFsdWUudGF4X2l0ZW0uaGFzT3duUHJvcGVydHkoJ2FjY291bnQnKSkKICAgICAgICAgICAgICAgIC8vIGlmICh2YWx1ZS50YXhfaXRlbS5hY2NvdW50LnV1aWQgPT09ICIiIHx8IHZhbHVlLnRheF9pdGVtLmFjY291bnQuYWNjb3VudF90eXBlLm51bWJlciA9PT0gMCkgewogICAgICAgICAgICAgICAgLy8gICAgIHJlc3VsdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgLy8gICAgIG1zZyArPSBgPHA+JHtpMThuLnQoImludmFsaWRfdGF4X2FjY291bnRfYXRfcm93X251bWJlciIpfSAke2luZGV4ICsgMX08L3A+YDsKICAgICAgICAgICAgICAgIC8vIH0KCiAgICAgICAgICAgICAgICAvLyBDb3VudCBFbXB0eSBSb3cKICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5hY2NvdW50LnV1aWQgIT09ICIiICYmIHZhbHVlLmFtb3VudCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBleHBlbnNlQ291bnQrKzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBDb3VudCBzZWNvbmRhcnkgYWNjb3VudAogICAgICAgICAgICAgICAgaWYgKHZhbHVlLnNlY29uZGFyeV9hY2NvdW50LnV1aWQgIT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgc2Vjb25kYXJ5QWNjb3VudENvdW50Kys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gRW1wdHkgUm93CiAgICAgICAgICAgIGlmIChleHBlbnNlQ291bnQgPT09IDApIHsKICAgICAgICAgICAgICAgIG1zZyArPSBgPHA+JHtpMThuLnQoInBsZWFzZV9zZWxlY3RfZXhwZW5zZV9hY2NvdW50Iil9PC9wPmA7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVHJhbnNhY3Rpb24gQWNjb3VudAogICAgICAgICAgICBpZiAodGhpcy5leHBlbnNlLnRyYW5zYWN0aW9uX2FjY291bnQudXVpZCA9PT0gIiIpIHsKICAgICAgICAgICAgICAgIG1zZyArPSBgPHA+JHtpMThuLnQoInBsZWFzZV9zZWxlY3RfdHJhbnNhY3Rpb25fYWNjb3VudCIpfTwvcD5gOwogICAgICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFNlY29uZGFyeSBBY2NvdW50CiAgICAgICAgICAgIGlmICh0aGlzLnNlY29uZGFyeUFjY291bnQudXVpZCA9PT0gIiIgJiYgc2Vjb25kYXJ5QWNjb3VudENvdW50ID4gMCkgewogICAgICAgICAgICAgICAgbXNnICs9IGA8cD4ke2kxOG4udCgidHJhbnNhY3Rpb25fc2Vjb25kYXJ5X2FjY291bnRfaXNfcmVxdWlyZWQiKX08L3A+YDsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLnNlY29uZGFyeUFjY291bnQudXVpZCAhPT0gIiIgJiYgc2Vjb25kYXJ5QWNjb3VudENvdW50ID09PSAwKSB7CiAgICAgICAgICAgICAgICBtc2cgKz0gYDxwPiR7aTE4bi50KCJleHBlbnNlX3NlY29uZGFyeV9hY2NvdW50X2lzX3JlcXVpcmVkIil9PC9wPmA7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVXNlIGZvciBDYXNoIEFkdmFuY2UKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgdGhpcy5leHBlbnNlLnVzZV9mb3Jfb3B0aW9uID09PSAyICYmCiAgICAgICAgICAgICAgICB0aGlzLmV4cGVuc2UudXNlX2Zvcl90cmFuc2FjdGlvbl91dWlkID09PSAiIgogICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIG1zZyArPSBgPHA+JHtpMThuLnQoInBsZWFzZV9zZWxlY3RfcmVsYXRlZF9jYXNoX2FkdmFuY2UiKX08L3A+YDsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvKiBMb2NhdGlvbiAqLwogICAgICAgICAgICBpZiAodGhpcy5sb2NhdGlvbi5pZCA9PT0gIiIpIHsKICAgICAgICAgICAgICAgIG1zZyArPSBgPHA+JHtpMThuLnQoImxvY2F0aW9uX2lzX3JlcXVpcmVkIil9PC9wPmA7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLyogU2VnbWVudCAqLwogICAgICAgICAgICBpZiAodGhpcy5zZWdtZW50LmlkID09PSAiIikgewogICAgICAgICAgICAgICAgbXNnICs9IGA8cD4ke2kxOG4udCgic2VnbWVudF9pc19yZXF1aXJlZCIpfTwvcD5gOwogICAgICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFNob3cgQWxlcnQKICAgICAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSBtc2c7CgogICAgICAgICAgICB0aGlzLmFsZXJ0ID0gcmVzdWx0ID09PSBmYWxzZTsKCiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfSwKICAgICAgICAvLyBBbGwgU2F2ZXMKICAgICAgICBhc3luYyBvblNhdmVPcHRpb25DbGljayhtb2RlKSB7CiAgICAgICAgICAgIGlmICh0aGlzLiRyZWZzLmZvcm0udmFsaWRhdGUoKSAmJiB0aGlzLnZhbGlkYXRlRm9ybSgpKSB7CiAgICAgICAgICAgICAgICBsZXQgaXNWYWxpZENsb3NpbmdEYXRlID0gYXdhaXQgSGVscGVyLnZhbGlkYXRlQ2xvc2luZ0RhdGUoCiAgICAgICAgICAgICAgICAgICAgdGhpcy5leHBlbnNlLmV4cGVuc2VfZGF0ZQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGlmIChpc1ZhbGlkQ2xvc2luZ0RhdGUpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmVNb2RlID0gbW9kZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgY2FuY2VsKCkgewogICAgICAgICAgICB0aGlzLiRzd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiBpMThuLnQoIm1zZ190aXRsZV93YXJuaW5nIiksCiAgICAgICAgICAgICAgICB0ZXh0OiBpMThuLnQoIm1zZ19kaXNjYXJkIiksCiAgICAgICAgICAgICAgICBpY29uOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogaTE4bi50KCJjYW5jZWwiKSwKICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiM0ZDQ4NDgiLAogICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjRUQxQTNBIiwKICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBpMThuLnQoImRpc2NhcmQiKSwKICAgICAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhcigpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5nbygtMSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgY2xlYXIoKSB7CiAgICAgICAgICAgIC8vIFJlc2V0IEZvcm0KICAgICAgICAgICAgdGhpcy5pc0VkaXQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5zYXZlTW9kZSA9ICIiOwoKICAgICAgICAgICAgdGhpcy5zdWJUb3RhbCA9IDA7CiAgICAgICAgICAgIHRoaXMuZGlzY291bnRBbW91bnQgPSAwOwogICAgICAgICAgICB0aGlzLnB1cmNoYXNlVGF4ID0gMDsKICAgICAgICAgICAgdGhpcy53aGRUYXggPSAwOwogICAgICAgICAgICB0aGlzLnRvdGFsQW1vdW50ID0gMDsKICAgICAgICAgICAgdGhpcy5zdXBwbGllckRlcG9zaXRBbW91bnQgPSAwOwogICAgICAgICAgICB0aGlzLmRlcG9zaXRBbW91bnQgPSAwOwogICAgICAgICAgICB0aGlzLmFtb3VudER1ZSA9IDA7CiAgICAgICAgICAgIHRoaXMuaGFzQWRkaXRpb25hbENvc3QgPSBmYWxzZTsKCiAgICAgICAgICAgIHRoaXMuZXhwZW5zZSA9IG5ldyBFeHBlbnNlTW9kZWwoKTsKICAgICAgICAgICAgdGhpcy5qb3VybmFsID0gbmV3IEpvdXJuYWxNb2RlbCgpOwogICAgICAgICAgICB0aGlzLmpvdXJuYWxFbnRyaWVzID0gW107CiAgICAgICAgICAgIHRoaXMuZW1wbG95ZWUgPSBuZXcgRW1wbG95ZWVNb2RlbCgpOwogICAgICAgICAgICB0aGlzLnN1cHBsaWVyID0gbmV3IFN1cHBsaWVyTW9kZWwoKTsKICAgICAgICAgICAgdGhpcy5wYXltZW50VGVybSA9IG5ldyBQYXltZW50VGVybU1vZGVsKCk7CiAgICAgICAgICAgIHRoaXMuY3VycmVuY3kgPSBuZXcgQ3VycmVuY3lNb2RlbChpbnN0aXR1dGUuYmFzZUN1cnJlbmN5KTsKICAgICAgICAgICAgdGhpcy5leGNoYW5nZVJhdGUgPSBuZXcgRXhjaGFuZ2VSYXRlTW9kZWwoaW5zdGl0dXRlLmJhc2VDdXJyZW5jeSk7CiAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5QWNjb3VudCA9IG5ldyBBY2NvdW50TW9kZWwoKTsKICAgICAgICAgICAgdGhpcy5sb2NhdGlvbiA9IG5ldyBMb2NhdGlvbk1vZGVsKCk7CiAgICAgICAgICAgIHRoaXMuc2VnbWVudCA9IG5ldyBTZWdtZW50TW9kZWwoKTsKICAgICAgICAgICAgdGhpcy5wcm9qZWN0ID0gbmV3IFByb2plY3RNb2RlbCgpOwoKICAgICAgICAgICAgbGV0IGV4cERTID0gdGhpcy4kcmVmcy5leHBlbnNlQWNjb3VudERTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgIGV4cERTLmRhdGEoW10pOwoKICAgICAgICAgICAgdGhpcy5zZXREZWZhdWx0RGF0YSgpOwogICAgICAgIH0sCiAgICAgICAgc2F2ZSgpIHsKICAgICAgICAgICAgbGV0IHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgLy8gRHJhZnQgTW9kZQogICAgICAgICAgICBpZiAodGhpcy5zYXZlTW9kZSA9PT0gU2F2ZU9wdGlvbi5TQVZFRFJBRlQpIHsKICAgICAgICAgICAgICAgIHRoaXMuZXhwZW5zZS5pc19kcmFmdCA9IDE7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLmV4cGVuc2UuaXNfZHJhZnQgPSAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBTaHJpbmsgRGF0YQogICAgICAgICAgICB0aGlzLnNocmlua0RhdGEoKTsKCiAgICAgICAgICAgIC8vIEFkZCBKb3VybmFsCiAgICAgICAgICAgIHRoaXMuYWRkSm91cm5hbCgpOwoKICAgICAgICAgICAgLy8gU3luYyBEYXRhCiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICBleHBlbnNlSGFuZGxlci5zYXZlKHsKICAgICAgICAgICAgICAgIGV4cGVuc2U6IHRoaXMuZXhwZW5zZSwKICAgICAgICAgICAgICAgIGpvdXJuYWw6IHRoaXMuam91cm5hbCwKICAgICAgICAgICAgICAgIGpvdXJuYWxfZW50cmllczogdGhpcy5qb3VybmFsRW50cmllcywKICAgICAgICAgICAgfSkudGhlbihhc3luYyAocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnV1aWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlbGYuc2F2ZVR4bkV4cGVuc2UocmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAvLyBhd2FpdCBzZWxmLmF1dG9DYWxjdWxhdGVUYXhEZXRhaWwoKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcihpMThuLnQoImVycm9yX3NvbWV0aGluZ193cm9uZyIpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcihlcnJvcik7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmZpbmFsbHkoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIC8vIHNlbGYuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgLy8gUmVzcG9uc2UgU3RhdHVzCiAgICAgICAgYXN5bmMgcmVzcG9uc2VTdGF0dXMocmVzcG9uc2UpIHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5zYXZlTW9kZSA9PT0gU2F2ZU9wdGlvbi5TQVZFQ0xPU0UgfHwgdGhpcy5zYXZlTW9kZSA9PT0gU2F2ZU9wdGlvbi5ERUxFVEUpIHsKICAgICAgICAgICAgICAgICAgICAvKiBTYXZlIENsb3NlIG9yIERlbGV0ZSAqLwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzRWRpdCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdvQmFja1RvVmlld1BhZ2UoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIuZ28oLTEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLmNsZWFyKCk7CgogICAgICAgICAgICAgICAgLyogQWxlcnQgU3VjY2VzcyAqLwogICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5zdWNjZXNzKGkxOG4udCgic3VjY2Vzc2Z1bCIpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8qIEFsZXJ0IEVycm9yICovCiAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LmVycm9yKGkxOG4udCgiZXJyb3Jfc29tZXRoaW5nX3dyb25nIikpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAvLyBHbyBiYWNrIHRvIHZpZXcgcGFnZSBhZnRlciBlZGl0IG1vZGUKICAgICAgICBnZXRFeHBlbnNlKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IEV4cGVuc2VNb2RlbCh0aGlzLmV4cGVuc2UpOwogICAgICAgIH0sCiAgICAgICAgZ29CYWNrVG9WaWV3UGFnZSgpIHsKICAgICAgICAgICAgdGhpcy4kcm91dGVyLnJlcGxhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkV4cGVuc2VzIFZpZXciLAogICAgICAgICAgICAgICAgcGFyYW1zOiB7aW5pdEV4cGVuc2U6IHRoaXMuZ2V0RXhwZW5zZSgpfSwKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBIaWRlU21hbGxTaWRlQmFyKCkgewogICAgICAgICAgICB0aGlzLmlzSGlkZUJhciA9ICF0aGlzLmlzSGlkZUJhcjsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRQYXltZW50VGVybUxpc3QoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN1cHBsaWVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0ckZpbHRlciA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiP2lkPSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdXBwbGllci5pZCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiJnRyYW5zYWN0aW9uRGF0ZT0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXhwZW5zZS5leHBlbnNlX2RhdGUgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIiZ0eXBlPVZlbmRvciI7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGF5bWVudFRlcm0gPSBuZXcgUGF5bWVudFRlcm1Nb2RlbCgpOwogICAgICAgICAgICAgICAgICAgICAgICBwYXltZW50VGVybUhhbmRsZXJfLmdldChzdHJGaWx0ZXIpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRlcm1zID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWtlbmRvLmpRdWVyeS5pc0VtcHR5T2JqZWN0KHRlcm1zKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBheW1lbnRUZXJtID0gdGVybXMudGVybTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYWxjdWxhdGVEdWVEYXRlKHRoaXMucGF5bWVudFRlcm0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGF1dG9DYWxjdWxhdGVUYXhEZXRhaWwoKSB7CiAgICAgICAgICAgIGxldCBpZHMgPSBbXQogICAgICAgICAgICB0aGlzLnRheExpc3REZXRhaWwuZm9yRWFjaChuID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGxpbmUgPSBuLmxpbmUgfHwge30KICAgICAgICAgICAgICAgIGlkcy5wdXNoKGxpbmUuaWQgfHwgJycpCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIGNvbnN0IHVuaXF1ZSA9IFsuLi5uZXcgU2V0KGlkcyldCiAgICAgICAgICAgIGxldCByZXN1bHQgPSBbXQogICAgICAgICAgICBmb3IgKGNvbnN0IG0gb2YgdW5pcXVlKSB7CiAgICAgICAgICAgICAgICBsZXQgYW1vdW50ID0gMCwgcm93ID0ge30sIGRpc2NvdW50ID0gMCwgeERpc2NvdW50ID0gMCwgeEFtb3VudCA9IDAsIHRheEFtb3VudCA9IDAsIHhUYXhBbW91bnQgPSAwCiAgICAgICAgICAgICAgICBsZXQgdGF4RGV0YWlsID0gW10sIGlzVmF0ID0gMAogICAgICAgICAgICAgICAgY29uc3QgZm91bmQgPSB0aGlzLnRheExpc3REZXRhaWwuZmlsdGVyKG4gPT4gbi5saW5lLmlkID09PSBtKQogICAgICAgICAgICAgICAgZm91bmQuZm9yRWFjaChrID0+IHsKICAgICAgICAgICAgICAgICAgICByb3cgPSBrCiAgICAgICAgICAgICAgICAgICAgaWYgKGsuaXNWYXQgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaXNWYXQgPSAxCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRldGFpbF8gPSBrLmRldGFpbCB8fCB7fQogICAgICAgICAgICAgICAgICAgICAgICB0YXhEZXRhaWwucHVzaChkZXRhaWxfKQoKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGF4QW1vdW50ICs9IGsudGF4QW1vdW50IHx8IDAKICAgICAgICAgICAgICAgICAgICB4VGF4QW1vdW50ICs9IChrLnRheEFtb3VudCB8fCAwKSAqIChrLnR4blJhdGUgfHwgMSkKICAgICAgICAgICAgICAgICAgICBhbW91bnQgKz0gKGsuYW1vdW50IHx8IDApCiAgICAgICAgICAgICAgICAgICAgeEFtb3VudCArPSAoay5hbW91bnQgfHwgMCkgKiAoay50eG5SYXRlIHx8IDEpCiAgICAgICAgICAgICAgICAgICAgZGlzY291bnQgKz0gKGsuZGlzY291bnQgfHwgMCkKICAgICAgICAgICAgICAgICAgICB4RGlzY291bnQgKz0gKGsuZGlzY291bnQgfHwgMCkgKiAoay50eG5SYXRlIHx8IDEpCiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIGlmIChpc1ZhdCA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgIHJvdy5kZXRhaWwgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNwZWNpZmljVGF4OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVMb2NhbGU6ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmF0ZTogMSwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljTGlnaHRpbmdUYXg6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZUxvY2FsZTogJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRJZDogJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYXRlOiAxLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBvdGhlclRheDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lTG9jYWxlOiAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudElkOiAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhdGU6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJvdy5kZXRhaWwgPSB7fQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJvdy5hbW91bnQgPSBhbW91bnQKICAgICAgICAgICAgICAgIHJvdy5leGNoYW5nZUFtb3VudCA9IHhBbW91bnQKICAgICAgICAgICAgICAgIHJvdy50YXhBbW91bnQgPSB0YXhBbW91bnQKICAgICAgICAgICAgICAgIHJvdy5leGNoYW5nZVRheEFtb3VudCA9IHhUYXhBbW91bnQKICAgICAgICAgICAgICAgIHJvdy5kaXNjb3VudCA9IGRpc2NvdW50CiAgICAgICAgICAgICAgICByb3cuZXhjaGFuZ2VEaXNjb3VudCA9IHhEaXNjb3VudAogICAgICAgICAgICAgICAgcm93LmN1cnJlbmN5ID0gdGhpcy5jdXJyZW5jeSB8fCB7fQogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gocm93KQogICAgICAgICAgICAgICAgdGF4RGV0YWlsID0gW10KICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCB0YXhEZXRhaWwgPSByZXN1bHQubWFwKGsgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IGsuYW1vdW50LAogICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiBrLmN1cnJlbmN5LAogICAgICAgICAgICAgICAgICAgIGRldGFpbDogay5kZXRhaWwsCiAgICAgICAgICAgICAgICAgICAgZGlzY291bnQ6IGsuZGlzY291bnQsCiAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VBbW91bnQ6IGsuZXhjaGFuZ2VBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VEaXNjb3VudDogay5leGNoYW5nZURpc2NvdW50LAogICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlVGF4QW1vdW50OiBrLmV4Y2hhbmdlVGF4QW1vdW50LAogICAgICAgICAgICAgICAgICAgIGlzVmF0OiBrLmlzVmF0LAogICAgICAgICAgICAgICAgICAgIGxpbmU6IGsubGluZSwKICAgICAgICAgICAgICAgICAgICB0YXhBbW91bnQ6IGsudGF4QW1vdW50LAogICAgICAgICAgICAgICAgICAgIHR4blJhdGU6IGsudHhuUmF0ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICB0aGlzLnR4bkV4cGVuc2Uuc2FsZVRheERldGFpbCA9IHRheERldGFpbAogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coJ3NhbGVUYXhEZXRhaWwgdHhuRXhwZW5zZScsIEpTT04uc3RyaW5naWZ5KHRheERldGFpbCkpCiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkUHVyY2hhc2VPcmRlcigpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgbGV0IHNlZ21lbnRJZCA9ICIiLCBsb2NhdGlvbklkID0gJycsIHByaWNlTGV2ZWxJZCA9ICIiLCBzdXBwbGllcklkID0gIiIsIHR4bkRhdGUgPSAiIjsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWdtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnRJZCA9IHRoaXMuc2VnbWVudC5pZCB8fCAnJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubG9jYXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25JZCA9IHRoaXMubG9jYXRpb24uaWQgfHwgJyc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN1cHBsaWVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1cHBsaWVySWQgPSB0aGlzLnN1cHBsaWVyLmlkOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyBpZiAodGhpcy5wcmljZUxldmVsKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gICAgIHByaWNlTGV2ZWxJZCA9IHRoaXMucHJpY2VMZXZlbC5pZCB8fCAnJzsKICAgICAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZXhwZW5zZS5leHBlbnNlX2RhdGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHhuRGF0ZSA9IHRoaXMuZXhwZW5zZS5leHBlbnNlX2RhdGU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxldCBzdHJGaWx0ZXIgPSAiIjsKICAgICAgICAgICAgICAgICAgICBpZiAoc2VnbWVudElkICE9PSAiIiAmJiBzdXBwbGllcklkICE9PSAiIiAmJiBsb2NhdGlvbklkICE9PSAiIiAmJiB0eG5EYXRlICE9PSAiIikgewogICAgICAgICAgICAgICAgICAgICAgICBzdHJGaWx0ZXIgPSAiP2lkPSIgKyBzdXBwbGllcklkICsgIiZzZWdJZD0iICsgc2VnbWVudElkICsgIiZsb2NJZD0iICsgbG9jYXRpb25JZCArICImcGxJZD0iICsgcHJpY2VMZXZlbElkICsgIiZkYXRlPSIgKyB0eG5EYXRlICsgJyZ0eXBlPVB1cmNoYXNlIE9yZGVyJwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoc3RyRmlsdGVyICE9PSAiIikgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZkZyb20gPSBbXQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nUE8gPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIHNhbGVPcmRlckhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50cmFuc2FjdGlvbkZpbHRlcihzdHJGaWx0ZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nUE8gPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlT3JkZXJzID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nUE8gPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRFeHBlbnNlUHVyY2hhc2VPcmRlcigpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgIT09ICIiIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlLnBhcmFtcy5pZCAhPT0gdW5kZWZpbmVkCiAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlkID0gKHRoaXMuZXhwZW5zZS51dWlkIHx8ICcnKQogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coJ2V4cGVuc2UgaWQnLCBpZCkKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RySWQgPSBpZC5pbmNsdWRlcygndHhuLScpID8gaWQgOiAndHhuLScgKyBpZAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nUE8gPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGJpbGxpbmdIYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZXhwZW5zZVZpZXcoJz9pZD0nICsgc3RySWQudHJpbSgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZ1BPID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLmRhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZU9yZGVyID0gcmVzLmRhdGEuZGF0YVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmdQTyA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgIH0sCiAgICB3YXRjaDogewogICAgICAgIGluaXRFeHBlbnNlKCkgewogICAgICAgICAgICB0aGlzLmluaXRpYWxEYXRhKCk7CiAgICAgICAgfSwKICAgIH0sCiAgICBjcmVhdGVkKCkgewogICAgICAgIHRoaXMubG9hZERhdGEoKTsKICAgIH0sCiAgICBjb21wdXRlZDogewogICAgICAgIGRpc2FibGVNZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuZXhwZW5zZSkgewogICAgICAgICAgICAgICAgY29uc3QgdXVpZCA9IHRoaXMuZXhwZW5zZS51dWlkIHx8ICIiOwogICAgICAgICAgICAgICAgaWYgKHV1aWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9LAogICAgfSwKICAgIG1vdW50ZWQoKSB7CiAgICAgICAgLy8gSW5pdGlhbCBEYXRhCiAgICAgICAgdGhpcy5pbml0aWFsRGF0YSgpOwogICAgfSwKfTsK"},{"version":3,"sources":["Expenses.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6xBA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Expenses.vue","sourceRoot":"src/views/suppliers","sourcesContent":["<template>\n    <v-app>\n        <v-container>\n            <v-row>\n                <v-col sm=\"12\" cols=\"12\">\n                    <v-card\n                        outlined\n                        dense\n                        class=\"pa-4 no_border rounded-sm\"\n                        color=\"white\"\n                    >\n                        <v-row>\n                            <v-col\n                                class=\"bigSide pr-2 py-0\"\n                                sm=\"8\"\n                                cols=\"12\"\n                                style=\"transition: 0.3s ease-in\"\n                                :class=\"{ hide_big_bar_class: isHideBar }\"\n                            >\n                                <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                                    <v-card outlined dense class=\"no_border\">\n                                        <h2 class=\"mb-0\">\n                                            {{ $t(\"expenses\") }}\n                                        </h2>\n\n                                        <v-icon\n                                            v-if=\"isHideBar\"\n                                            @click=\"cancel()\"\n                                            style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                                            class=\"float-right\"\n                                        >close\n                                        </v-icon>\n                                        <span\n                                            style=\"transition: 0.3s ease-in; z-index: 10;\"\n                                            :class=\"{\n\t\t\t\t\t\t\t\t\t\t\t\ticonArrow: !isHideBar,\n\t\t\t\t\t\t\t\t\t\t\t\ticonArrowHide: isHideBar,\n\t\t\t\t\t\t\t\t\t\t\t}\"\n                                        >\n\t\t\t\t\t\t\t\t\t\t\t<v-icon\n                                                size=\"22\"\n                                                class=\"arr_icon\"\n                                                @click=\"HideSmallSideBar\"\n                                                v-if=\"isHideBar\"\n                                            >mdi-chevron-left-circle\n\t\t\t\t\t\t\t\t\t\t\t</v-icon>\n\t\t\t\t\t\t\t\t\t\t\t<v-icon\n                                                size=\"22\"\n                                                class=\"arr_icon\"\n                                                @click=\"HideSmallSideBar\"\n                                                v-if=\"!isHideBar\"\n                                            >mdi-chevron-right-circle\n\t\t\t\t\t\t\t\t\t\t\t</v-icon>\n\t\t\t\t\t\t\t\t\t\t</span>\n                                    </v-card>\n                                    <v-card outlined dense class=\"px-3 rounded-4 no_border\" color=\"grayBg\">\n                                        <v-row>\n                                            <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                                                <label class=\"label\">{{ $t(\"supplier\") }}</label>\n                                                <app-supplier-dropdownlist\n                                                    :initSupplier=\"supplier\"\n                                                    @emitSupplier=\"supplier = $event\"\n                                                    @onChanged=\"onVendorChanged\"\n                                                />\n\n                                                <label class=\"label\" style=\"\">{{\n                                                        $t(\"transaction_date\")\n                                                    }}</label>\n                                                <app-datepicker\n                                                    :initialDate=\"expense.expense_date\"\n                                                    :disabled=\"disableMe\"\n                                                    @emitDate=\"expense.expense_date = $event\"\n                                                    @onChanged=\"onDateChanges\"\n                                                />\n\n                                                <label class=\"label\">{{\n                                                        $t(\"suppliers_invoice_no\")\n                                                    }}</label>\n                                                <v-text-field\n                                                    class=\"mt-1\"\n                                                    v-model=\"expense.bill_number\"\n                                                    outlined\n                                                />\n                                            </v-col>\n\n                                            <v-col sm=\"4\" cols=\"12\">\n                                                <label class=\"label\">{{ $t(\"vendor_invoice_date\") }}</label>\n                                                <app-datepicker\n                                                    :initialDate=\"expense.bill_date\"\n                                                    @emitDate=\"expense.bill_date = $event\"\n                                                />\n\n                                                <label class=\"label\">{{ $t(\"number\") }}</label>\n                                                <v-row class=\"mt-1 mr-0\">\n                                                    <v-col sm=\"10\" cols=\"10\" class=\"py-0 pr-0 pr-1\">\n                                                        <v-text-field\n                                                            :rules=\"[(v) => !!v || 'Number is required']\"\n                                                            v-model=\"expense.number\"\n                                                            readonly\n                                                            outlined\n                                                            required\n                                                        />\n                                                    </v-col>\n                                                    <v-col sm=\"2\" cols=\"2\" class=\"py-0 px-0\">\n                                                        <v-icon\n                                                            color=\"black\"\n                                                            size=\"30\"\n                                                            class=\"border_qrcode\"\n                                                            @click=\"generateNumber\"\n                                                        >mdi-qrcode\n                                                        </v-icon>\n                                                    </v-col>\n                                                </v-row>\n\n                                                <label class=\"label\">{{ $t(\"bill_currency\") }}</label>\n                                                <app-currency-dropdownlist\n                                                    :initCurrency=\"currency\"\n                                                    @emitCurrency=\"currency = $event\"\n                                                    @onChanged=\"getExchangeRate\"\n                                                />\n                                                <div class=\"hide_message\">\n                                                    <v-checkbox\n                                                        class=\"my_check_box my-0\"\n                                                        v-model=\"hasAdditionalCost\"\n                                                        @change=\"onAdditionalCostCheckboxChanges\"\n                                                        label=\"Has additional cost?\"\n                                                    />\n                                                    <div class=\"py-0 pl-0\" v-if=\"hasAdditionalCost\">\n                                                        <app-supplier-dropdownlist\n                                                            :initSupplier=\"expense.additional_cost_supplier\"\n                                                            @emitSupplier=\"expense.additional_cost_supplier = $event\"\n                                                        />\n                                                    </div>\n                                                </div>\n                                            </v-col>\n                                            <v-col class=\"pb-0\" sm=\"4\" cols=\"12\">\n                                                <label class=\"label\">{{ $t(\"term\") }}</label>\n                                                <app-payment-term-purchase-dropdownlist\n                                                    :initPaymentTerm=\"paymentTerm\"\n                                                    @emitPaymentTerm=\"paymentTerm = $event\"\n                                                    @onChanged=\"onDueDateChanged\"\n                                                />\n\n                                                <label class=\"label\">{{ $t(\"due_date\") }}</label>\n                                                <app-datepicker\n                                                    :initialDate=\"expense.due_date\"\n                                                    @emitDate=\"expense.due_date = $event\"\n                                                    @onChanged=\"onDueDateChanged\"\n                                                />\n\n                                                <label class=\"label\">{{\n                                                        $t(\"transaction_account\")\n                                                    }}</label>\n                                                <v-select\n                                                    class=\"mt-1\"\n                                                    :loading=\"transactionAccounts.length === 0\"\n                                                    @change=\"onTransactionAccountChanges\"\n                                                    :items=\"transactionAccounts\"\n                                                    item-value=\"uuid\"\n                                                    :item-text=\"(item) => `${item.number} - ${this.$store.state.accounting.accountLanguage ==='English' ? item.name : item.local_name}`\"\n                                                    v-model=\"expense.transaction_account\"\n                                                    no-data-text=\"No data found.\"\n                                                    :rules=\"[\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t(v) => !!v || 'Transaction Account is required',\n\t\t\t\t\t\t\t\t\t\t\t\t\t]\"\n                                                    placeholder=\"Transaction Account\"\n                                                    return-object\n                                                    outlined\n                                                ></v-select>\n\n                                                <div v-if=\"this.$store.state.accounting.secondaryAccount\">\n                                                    <label class=\"label\">{{ $t(\"secondary_account\") }}</label>\n                                                    <app-secondary-account-dropdownlist\n                                                        :initPrimaryAccountId=\"expense.transaction_account.uuid\"\n                                                        :initAccount=\"secondaryAccount\"\n                                                        @emitAccount=\"secondaryAccount = $event\"/>\n                                                </div>\n                                            </v-col>\n                                        </v-row>\n                                    </v-card>\n\n                                    <v-row style=\"background-color: #fff\">\n                                        <v-col sm=\"12\" cols=\"12\" class=\"pb-0\">\n                                            <h3 class=\"mb-0 text-uppercase grey--text mb-3\">\n                                                {{ $t(\"expense_accounts\") }}\n                                            </h3>\n                                        </v-col>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                            <kendo-datasource\n                                                ref=\"expenseAccountDS\"\n                                                :data=\"expenseEntries\"\n                                                :change=\"onExpenseAccountDSChanges\"\n                                            />\n                                            <kendo-grid\n                                                id=\"expenseGrid\"\n                                                ref=\"expenseGrid\"\n                                                class=\"grid-function\"\n                                                :data-source-ref=\"'expenseAccountDS'\"\n                                                :sortable=\"false\"\n                                                :filterable=\"false\"\n                                                :column-menu=\"true\"\n                                                :editable=\"true\"\n                                                :scrollable-virtual=\"true\"\n                                            >\n                                                <kendo-grid-column\n                                                    :command=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ticonClass: 'k-icon k-i-trash',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext: ' ',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclick: removeRow,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass: 'btn-plus',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                    :title=\"''\"\n                                                    :width=\"63\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'text-align: right; background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :title=\"$t('no.')\"\n                                                    :template=\"rowNumberTmpl\"\n                                                    :width=\"53\"\n                                                    :column-menu=\"false\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'background-color: #EDF1F5;',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass: 'text-center',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                    :attributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'text-align: center',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'account'\"\n                                                    :title=\"$t('account')\"\n                                                    :width=\"200\"\n                                                    :template=\"this.$store.state.accounting.accountLanguage === 'English' ? '<span>#=account.number#</span> <span>#=account.name#</span>' : '<span>#=account.number#</span> <span>#=account.local_name#</span>' \"\n                                                    :editor=\"expenseAccountEditor\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'secondary_account'\"\n                                                    :title=\"$t('s_account')\"\n                                                    :template=\"\n                                                        this.$store.state.accounting.accountLanguage ===\n                                                        'English'\n                                                            ? '<span>#=secondary_account.number#</span> <span>#=secondary_account.name#</span>'\n                                                            : '<span>#=secondary_account.number#</span> <span>#=secondary_account.local_name#</span>'\n                                                    \"\n                                                    :width=\"200\"\n                                                    :hidden=\"!this.$store.state.accounting.secondaryAccount\"\n                                                    :editor=\"AccountSecondaryEditor\"\n                                                    :headerAttributes=\"{\n                                                        style: 'background-color: #EDF1F5',\n                                                    }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'description'\"\n                                                    :title=\"$t('description')\"\n                                                    :width=\"200\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n\n                                                <kendo-grid-column\n                                                    :field=\"'uom'\"\n                                                    :title=\"$t('uom')\"\n                                                    :editor=\"UomEditor\"\n                                                    :template=\"'<span>#=uom.name||``#</span>'\"\n                                                    :width=\"150\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'text-align: right; background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                    :attributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'text-align: right;',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'quantity'\"\n                                                    :title=\"$t('qty')\"\n                                                    :width=\"160\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'price'\"\n                                                    :title=\"$t('price')\"\n                                                    :width=\"150\"\n                                                    :editor=\"NumberEditor\"\n                                                    :template=\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<span>#=kendo.toString(price, decimalFormat)#</span>'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'text-align: right; background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                    :attributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'text-align: right',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'amount'\"\n                                                    :title=\"$t('amount')\"\n                                                    :width=\"150\"\n                                                    :editable=\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"\n                                                    :editor=\"NumberEditor\"\n                                                    :template=\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<span>#=kendo.toString(amount, decimalFormat)#</span>'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'text-align: right; background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                    :attributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'text-align: right',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'tax_item'\"\n                                                    :title=\"$t('tax')\"\n                                                    :template=\"'<span>#=tax_item.defaultTax||``#</span>'\"\n                                                    :editor=\"PurchaseTaxEditor\"\n                                                    :width=\"150\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'text-align: right; background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                    :attributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'text-align: right',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'discount'\"\n                                                    :title=\"$t('discount')\"\n                                                    :template=\"'<span>#=discount.name||``#</span>'\"\n                                                    :editor=\"PurchaseDiscountItemEditor\"\n                                                    :width=\"150\"\n                                                    :hidden=\"!purchaseFormContent.discountItem\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'text-align: right; background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                    :attributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'text-align: right',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n\n                                                <kendo-grid-column\n                                                    :field=\"'class1'\"\n                                                    :title=\"$t('class_1')\"\n                                                    :template=\"'<span>#=class1.name||``#</span>'\"\n                                                    :width=\"200\"\n                                                    :hidden=\"!purchaseFormContent.class1\"\n                                                    :editor=\"ClassEditor.class1\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'class2'\"\n                                                    :title=\"$t('class_2')\"\n                                                    :template=\"'<span>#=class2.name||``#</span>'\"\n                                                    :width=\"200\"\n                                                    :hidden=\"!purchaseFormContent.class2\"\n                                                    :editor=\"ClassEditor.class2\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'class3'\"\n                                                    :title=\"$t('class_3')\"\n                                                    :template=\"'<span>#=class3.name||``#</span>'\"\n                                                    :width=\"200\"\n                                                    :hidden=\"!purchaseFormContent.class3\"\n                                                    :editor=\"ClassEditor.class3\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'class4'\"\n                                                    :title=\"$t('class_4')\"\n                                                    :template=\"'<span>#=class4.name||``#</span>'\"\n                                                    :width=\"200\"\n                                                    :hidden=\"!purchaseFormContent.class4\"\n                                                    :editor=\"ClassEditor.class4\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'class5'\"\n                                                    :title=\"$t('class_5')\"\n                                                    :template=\"'<span>#=class5.name||``#</span>'\"\n                                                    :width=\"200\"\n                                                    :hidden=\"!purchaseFormContent.class5\"\n                                                    :editor=\"ClassEditor.class5\"\n                                                    :headerAttributes=\"{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: 'background-color: #EDF1F5',\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\n                                                />\n                                            </kendo-grid>\n                                        </v-col>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"pt-0\">\n                                            <v-row>\n                                                <v-col sm=\"9\" cols=\"12\" class=\"py-0\">\n                                                    <v-btn\n                                                        color=\"primary\"\n                                                        class=\"float-left mt-2 btn_plus white--text mr-2\"\n                                                        @click=\"addRow\"\n                                                    >\n                                                        <v-icon size=\"\" class=\"ma-1\">mdi-plus</v-icon>\n                                                    </v-btn>\n                                                </v-col>\n                                            </v-row>\n                                        </v-col>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                            <v-row>\n                                                <v-col sm=\"6\" cols=\"12\" class=\"\">\n                                                    <v-card\n                                                        class=\"no-boxshadow rounded-4 pa-3\"\n                                                        color=\"grayBg\"\n                                                        height=\"270px\"\n                                                    >\n                                                        <label>{{ $t(\"msg_on_voucher\") }}</label>\n                                                        <v-textarea\n                                                            class=\"mt-1\"\n                                                            no-resize\n                                                            height=\"90px\"\n                                                            v-model=\"expense.voucher_note\"\n                                                            outlined\n                                                            clearable\n                                                            rows=\"3\"\n                                                            placeholder=\"This will appear on the invoice\"\n                                                        />\n                                                        <label>{{ $t(\"message_for_journal\") }}</label>\n                                                        <v-textarea\n                                                            class=\"mt-1\"\n                                                            no-resize\n                                                            height=\"90px\"\n                                                            v-model=\"expense.journal_note\"\n                                                            outlined\n                                                            clearable\n                                                            rows=\"3\"\n                                                            placeholder=\"This will appear on the journal entry\"\n                                                        />\n                                                    </v-card>\n                                                </v-col>\n                                                <v-col sm=\"6\" cols=\"6\">\n                                                    <v-simple-table>\n                                                        <template v-slot:default>\n                                                            <tbody>\n                                                            <tr>\n                                                                <td class=\"text-left\">\n                                                                    {{ $t(\"subtotal\") }}\n                                                                </td>\n                                                                <td class=\"text-center\">\n                                                                    :\n                                                                </td>\n                                                                <td class=\"text-right\">\n                                                                    {{ numberFormat(subTotal) }}\n                                                                </td>\n                                                            </tr>\n                                                            <tr>\n                                                                <td class=\"text-left\">\n                                                                    {{ $t(\"discount\") }}\n                                                                </td>\n                                                                <td class=\"text-center\">\n                                                                    :\n                                                                </td>\n                                                                <td class=\"text-right\">\n                                                                    ({{ numberFormat(discountAmount) }})\n                                                                </td>\n                                                            </tr>\n                                                            <tr>\n                                                                <td class=\"text-left\">\n                                                                    {{ $t(\"purchase_tax\") }}\n                                                                </td>\n                                                                <td class=\"text-center\">\n                                                                    :\n                                                                </td>\n                                                                <td class=\"text-right\">\n                                                                    {{ numberFormat(purchaseTax) }}\n                                                                </td>\n                                                            </tr>\n                                                            <tr>\n                                                                <td class=\"text-left\">\n                                                                    {{ $t(\"withholding_tax\") }}\n                                                                </td>\n                                                                <td class=\"text-center\">\n                                                                    :\n                                                                </td>\n                                                                <td class=\"text-right\">\n                                                                    {{ numberFormat(whdTax) }}\n                                                                </td>\n                                                            </tr>\n                                                            <tr>\n                                                                <td class=\"text-left text-uppercase\">\n                                                                    {{ $t(\"total\") }}\n                                                                </td>\n                                                                <td class=\"text-center\">\n                                                                    :\n                                                                </td>\n                                                                <td\n                                                                    class=\"text-right primary--text text-bold\"\n                                                                >\n                                                                    {{ numberFormat(totalAmount) }}\n                                                                </td>\n                                                            </tr>\n                                                            <tr>\n                                                                <td class=\"text-left\">\n                                                                    {{ $t(\"deposit\") }}\n                                                                    <span class=\"float-right primary--text\">{{\n                                                                            numberFormat(supplierDepositAmount)\n                                                                        }}</span>\n                                                                </td>\n                                                                <td class=\"text-center\">\n                                                                    :\n                                                                </td>\n                                                                <td class=\"text-right\">\n                                                                    <v-text-field\n                                                                        class=\"text-right mt-3 float-right deposite_input\"\n                                                                        type=\"number\"\n                                                                        min=\"0\"\n                                                                        :disabled=\"supplierDepositAmount <= 0\"\n                                                                        v-model=\"depositAmount\"\n                                                                        @change=\"onDepositDeductionChange\"\n                                                                        width=\"80\"\n                                                                        outlined\n                                                                    />\n                                                                </td>\n                                                            </tr>\n                                                            <tr>\n                                                                <td class=\"text-left text-uppercase\">\n                                                                    {{ $t(\"amount_due\") }}\n                                                                </td>\n                                                                <td class=\"text-center\">\n                                                                    :\n                                                                </td>\n                                                                <td class=\"text-right text-bold\">\n                                                                    {{ numberFormat(amountDue) }}\n                                                                </td>\n                                                            </tr>\n                                                            </tbody>\n                                                        </template>\n                                                    </v-simple-table>\n                                                </v-col>\n                                            </v-row>\n                                        </v-col>\n                                    </v-row>\n\n                                    <v-divider/>\n\n                                    <v-card outlined dense class=\"no_border function_footer\">\n                                        <!-- Warning Message -->\n                                        <v-alert type=\"warning\" v-model=\"alert\" dismissible>\n                                            <span v-html=\"errorMessage\"/>\n                                        </v-alert>\n\n                                        <!--                    <v-menu>-->\n                                        <!--                      <template v-slot:activator=\"{ on }\">-->\n                                        <!--                        <v-btn-->\n                                        <!--                            color=\"black\"-->\n                                        <!--                            outlined-->\n                                        <!--                            class=\"mr-2 text-capitalize  black&#45;&#45;text float-left\"-->\n                                        <!--                            v-on=\"on\"-->\n                                        <!--                        >-->\n                                        <!--                          {{ $t(\"select_template\") }}-->\n                                        <!--                          <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>-->\n                                        <!--                        </v-btn>-->\n                                        <!--                      </template>-->\n                                        <!--                      <v-list>-->\n                                        <!--                        <v-list-item-->\n                                        <!--                            v-for=\"(item, index) in templates\"-->\n                                        <!--                            :key=\"index\"-->\n                                        <!--                        >-->\n                                        <!--                          <v-list-item-title>-->\n                                        <!--                            {{ item.title }}-->\n                                        <!--                          </v-list-item-title>-->\n                                        <!--                        </v-list-item>-->\n                                        <!--                      </v-list>-->\n                                        <!--                    </v-menu>-->\n                                        <v-btn\n                                            color=\"primary\"\n                                            outlined\n                                            class=\"text-capitalize  black--text float-left\"\n                                            @click=\"cancel\"\n                                        >{{ $t(\"cancel\") }}\n                                        </v-btn>\n                                        <!--                    <v-menu>-->\n                                        <!--                      <template v-slot:activator=\"{ on }\">-->\n                                        <!--                        <v-btn-->\n                                        <!--                            color=\"primary\"-->\n                                        <!--                            class=\"ml-2 float-right text-capitalize  white&#45;&#45;text\"-->\n                                        <!--                            v-on=\"on\"-->\n                                        <!--                        >-->\n                                        <!--                          {{ $t(\"save_option\") }}-->\n                                        <!--                          <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>-->\n                                        <!--                        </v-btn>-->\n                                        <!--                      </template>-->\n                                        <!--                      <v-list rounded>-->\n                                        <!--                        <v-list-item-group>-->\n                                        <!--                          <v-list-item v-if=\"!isEdit\">-->\n                                        <!--                            <v-list-item-content>-->\n                                        <!--                              <v-list-item-title-->\n                                        <!--                                  @click=\"onSaveOptionClick(SaveOption.SAVEDRAFT)\"-->\n                                        <!--                              >-->\n                                        <!--                                {{ $t(\"save_close\") }}-->\n                                        <!--                              </v-list-item-title>-->\n                                        <!--                            </v-list-item-content>-->\n                                        <!--                          </v-list-item>-->\n                                        <!--                          <v-list-item v-if=\"!isEdit\">-->\n                                        <!--                            <v-list-item-content>-->\n                                        <!--                              <v-list-item-title-->\n                                        <!--                                  @click=\"onSaveOptionClick(SaveOption.SAVENEW)\"-->\n                                        <!--                              >-->\n                                        <!--                                {{ $t(\"save_new\") }}-->\n                                        <!--                              </v-list-item-title>-->\n                                        <!--                            </v-list-item-content>-->\n                                        <!--                          </v-list-item>-->\n                                        <!--                          <v-list-item>-->\n                                        <!--                            <v-list-item-content>-->\n                                        <!--                              <v-list-item-title-->\n                                        <!--                                  @click=\"onSaveOptionClick(SaveOption.SAVEPRINT)\"-->\n                                        <!--                              >-->\n                                        <!--                                {{ $t(\"save_print\") }}-->\n                                        <!--                              </v-list-item-title>-->\n                                        <!--                            </v-list-item-content>-->\n                                        <!--                          </v-list-item>-->\n                                        <!--                        </v-list-item-group>-->\n                                        <!--                      </v-list>-->\n                                        <!--                    </v-menu>-->\n                                        <v-btn\n                                            color=\"primary\"\n                                            class=\"float-right white--text text-capitalize \"\n                                            @click=\"onSaveOptionClick(SaveOption.SAVECLOSE)\"\n                                        >\n                                            {{ $t(\"save_close\") }}\n                                        </v-btn>\n                                        <v-btn color=\"secondary\"\n                                               style=\"margin-right: 10px !important\"\n                                               class=\"white--text float-right text-capitalize\"\n                                               @click=\"onSaveOptionClick(SaveOption.SAVENEW)\" :hidden=\"isEdit\">\n                                            {{ $t(\"save_new\") }}\n                                        </v-btn>\n                                    </v-card>\n                                </v-form>\n                            </v-col>\n                            <v-col\n                                class=\"smallSide pl-2\"\n                                sm=\"4\"\n                                style=\"transition: 0.3s ease-in\"\n                                :class=\"{ hide_small_bar_class: isHideBar }\">\n                                <h3 style=\"color: #b3b5bc; font-size: 20px\"\n                                    v-if=\"!isHideBar\"\n                                    class=\"text-uppercase float-right mt-n3\">\n\t\t\t\t\t\t\t\t\t<span class=\"pointer\" @click=\"Help('expenses')\">\n\t\t\t\t\t\t\t\t\t\t{{ $t(\"help\") }}\n\t\t\t\t\t\t\t\t\t</span>\n                                    <v-icon\n                                        @click=\"cancel()\"\n                                        style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                                        class=\"float-right mt-n1\">close\n                                    </v-icon>\n                                </h3>\n\n                                <div v-if=\"!isHideBar\" class=\"small_sidebar mt-8 px-4 grayBg\">\n                                    <v-card\n                                        class=\"pa-3 no-boxshadow d-flex flex-column\"\n                                        color=\"primary\"\n                                        size=\"60px\"\n                                        style=\"margin-bottom: 2px;\">\n                                        <h3 class=\"text-white text-uppercase justify-start font_13\">\n                                            {{ $t(\"expense_amount\") }}</h3>\n                                        <h3 class=\"text-bold justify-end niradei_heavy font_22 text-white\">\n                                            {{ numberFormat(amountDue) }}\n                                        </h3>\n                                    </v-card>\n                                    <v-row>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"pb-0 pt-3\">\n                                            <label class=\"label\">{{ $t(\"segment\") }}</label>\n                                            <app-segment-dropdownlist\n                                                :initSegment=\"segment\"\n                                                @emitSegment=\"segment = $event\"\n                                                @onChanged=\"loadCashAdvance\"\n                                            />\n\n                                            <label class=\"label\">{{ $t(\"location\") }}</label>\n                                            <app-location-dropdownlist\n                                                :initLocation=\"location\"\n                                                @emitLocation=\"location = $event\"\n                                                @onChanged=\"onLocationChange\"\n                                            />\n\n                                            <label class=\"label\">{{ $t(\"project\") }}</label>\n                                            <app-project-dropdownlist\n                                                :initProject=\"project\"\n                                                @emitProject=\"project = $event\"\n                                                :initDisabled=\"disableProject\"\n                                            />\n\n                                            <label class=\"label\">{{ $t(\"for_the_month_of\") }}</label>\n                                            <app-monthof-picker\n                                                :initMonthOf=\"expense.month_of\"\n                                                @emitMonthOf=\"expense.month_of = $event\"\n                                            />\n\n                                            <label class=\"label\">{{ $t(\"employee\") }}</label>\n                                            <app-employee-dropdownlist\n                                                :initEmployee=\"employee\"\n                                                @emitEmployee=\"employee = $event\"\n                                                @onChanged=\"loadCashAdvance\"\n                                            />\n                                        </v-col>\n                                    </v-row>\n                                    <v-row>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                            <v-radio-group\n                                                class=\"mt-0 custom-radio\"\n                                                @change=\"onUseForOptionChanges\"\n                                                v-model=\"expense.use_for_option\"\n                                                column>\n                                                <v-radio :label=\"$t('credit')\" :value=\"0\"/>\n                                                <v-radio :label=\"$t('cash')\" :value=\"3\"/>\n                                                <v-radio\n                                                    :disabled=\"employee.id === ''\"\n                                                    :label=\"$t('for_reimbursement')\"\n                                                    :value=\"1\"/>\n                                                <v-radio\n                                                    :disabled=\"employee.id === ''\"\n                                                    :label=\"$t('related_to_cash_advance')\"\n                                                    :value=\"2\"/>\n                                            </v-radio-group>\n                                        </v-col>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                            <v-select\n                                                placeholder=\"Select Cash Advance\"\n                                                @change=\"onCashAdvanceChanges\"\n                                                :loading=\"showCashAdvanceLoading\"\n                                                :disabled=\"expense.use_for_option !== 2\"\n                                                v-model=\"expense.use_for_transaction_uuid\"\n                                                :items=\"cashAdvances\"\n                                                item-value=\"uuid\"\n                                                item-text=\"number\"\n                                                outlined\n                                            />\n                                        </v-col>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                            <LoadingMe\n                                                :isLoading=\"showLoadingPO\"\n                                                :fullPage=\"false\"\n                                                :myLoading=\"true\"\n                                                type=\"loading\"\n                                            />\n                                            <label class=\"label\">{{ $t(\"purchase_order\") }}</label>\n                                            <v-select\n                                                class=\"mt-1\"\n                                                :items=\"purchaseOrders\"\n                                                v-model=\"purchaseOrder\"\n                                                item-value=\"id\"\n                                                item-text=\"referenceNo\"\n                                                placeholder=\"Purchase Order\"\n                                                clearable\n                                                return-object\n                                                outlined\n                                            />\n                                        </v-col>\n                                    </v-row>\n                                    <p class=\"mb-0 detial_smallside_p\">\n                                        {{ $t(\"function_expense_detial\") }}\n                                    </p>\n                                </div>\n                            </v-col>\n                        </v-row>\n                    </v-card>\n                </v-col>\n            </v-row>\n            <LoadingMe\n                :isLoading=\"showLoading\"\n                :fullPage=\"true\"\n                :myLoading=\"true\"\n                type=\"loading\"\n            />\n        </v-container>\n    </v-app>\n</template>\n\n<script>\nimport {i18n} from \"@/i18n\";\nimport kendo from \"@progress/kendo-ui\";\nimport Helper from \"@/helper.js\";\n\nimport {\n    ExpenseModel,\n    ExpenseEntryModel,\n    ExpenseEntryExtendedModel,\n    JournalModel,\n    JournalEntryModel,\n    AccountModel,\n    CurrencyModel,\n    ExchangeRateModel,\n    PaymentTermModel,\n    SupplierModel,\n    EmployeeModel,\n    ContactModel,\n    ClassModel,\n    UomModel,\n    LocationModel,\n    SegmentModel,\n    ProjectModel,\n    DiscountItemModel,\n    TaxModel,\n    Expenses,\n    PurchaseFormContent,\n} from \"@/scripts/model/AppModels\";\nimport ResponseDataModel from \"@/scripts/model/ResponseData\";\nimport {ShowResource} from \"@/observable/store\";\n\n/* Editors */\nimport AccountSecondaryEditor from \"@/scripts/kendo_editor/AccountSecondary\";\nimport ClassEditor from \"@/scripts/kendo_editor/Clazz\";\nimport UomEditor from \"@/scripts/kendo_editor/Uom\";\nimport PurchaseDiscountItemEditor from \"@/scripts/kendo_editor/PurchaseDiscountItem\";\nimport PurchaseTaxEditor from \"@/scripts/kendo_editor/PurchaseTax\";\n\n/* Store */\nimport store from \"@/store\";\nimport paymentTermHandler_ from \"@/scripts/paymentterm/handler/paymentTermHandler\";\nimport AccountMappingModel from \"@/scripts/account-map/Account\";\nimport {uuid} from \"vue-uuid\";\nimport saleOrderHandler from \"@/scripts/transactionHandler\";\n\nconst institute = store.state.institute.institute;\n\n/* Handlers */\nconst {\n    expenseHandler,\n    cashAdvanceHandler,\n    journalHandler,\n} = require(\"@/scripts/AppHandlers\");\nconst purchaseFormContentHandler = require(\"@/scripts/purchaseFormContentHandler\");\nconst billingHandler = require(\"@/scripts/invoice/handler/billingHandler\");\n\nconst {\n    EntityType,\n    SaveOption,\n    AccountTypeCode,\n    TaxType,\n    Setting,\n} = require(\"@/scripts/default_setup/Collections\");\n\nexport default {\n    name: \"Expense\",\n    components: {\n        LoadingMe: () => import(\"@/components/Loading\"),\n        \"app-datepicker\": () =>\n            import(\"@/components/custom_templates/DatePickerComponent\"),\n        \"app-monthof-picker\": () =>\n            import(\"@/components/kendo_templates/MonthOfPicker\"),\n        \"app-currency-dropdownlist\": () =>\n            import(\"@/components/dropdownlist/Currency\"),\n        \"app-payment-term-purchase-dropdownlist\": () => import(\"@/components/dropdownlist/PaymentTermPurchase\"),\n        \"app-location-dropdownlist\": () =>\n            import(\"@/components/dropdownlist/Location\"),\n        \"app-employee-dropdownlist\": () =>\n            import(\"@/components/dropdownlist/Employee\"),\n        \"app-project-dropdownlist\": () =>\n            import(\"@/components/dropdownlist/Project\"),\n        \"app-segment-dropdownlist\": () =>\n            import(\"@/components/dropdownlist/Segment\"),\n        \"app-supplier-dropdownlist\": () =>\n            import(\"@/components/dropdownlist/Supplier\"),\n        \"app-secondary-account-dropdownlist\": () => import('@/components/dropdownlist/AccountSecondary'),\n    },\n    props: {\n        initExpense: {\n            type: ExpenseModel,\n        },\n    },\n    data: () => ({\n        // Obj\n        expense: new ExpenseModel(),\n        journal: new JournalModel(),\n        journalEntries: [],\n        employee: new EmployeeModel(),\n        supplier: new SupplierModel(),\n        paymentTerm: new PaymentTermModel(),\n        currency: new CurrencyModel(institute.baseCurrency),\n        exchangeRate: new ExchangeRateModel(institute.baseCurrency),\n        advanceSettlementClearingAccount: new AccountModel(),\n        otherClearingSuspenseAccount: new AccountModel(),\n        secondaryAccount: new AccountModel(),\n        location: new LocationModel(),\n        segment: new SegmentModel(),\n        project: new ProjectModel(),\n        // List\n        cashAdvances: [],\n        accounts: [],\n        expenseAccounts: [],\n        transactionAccounts: [],\n        expenseEntries: [],\n        // Other\n        subTotal: 0,\n        discountAmount: 0,\n        purchaseTax: 0,\n        whdTax: 0,\n        totalAmount: 0,\n        supplierDepositAmount: 0,\n        depositAmount: 0,\n        amountDue: 0,\n        hasAdditionalCost: false,\n        files: [],\n        user: Helper.getUser(),\n        templates: [],\n        maxDecimal: Setting.MAX_DECIMAL,\n        disableProject: false,\n        // Form validation\n        valid: true,\n        isEdit: false,\n        alert: false,\n        errorMessage: \"\",\n        saveMode: \"\",\n        SaveOption: SaveOption,\n        // Editors\n        AccountSecondaryEditor: AccountSecondaryEditor,\n        ClassEditor: ClassEditor,\n        UomEditor: UomEditor,\n        PurchaseDiscountItemEditor: PurchaseDiscountItemEditor,\n        PurchaseTaxEditor: PurchaseTaxEditor,\n        // Sidebar\n        col_expand: 9,\n        col_hide: 3,\n        isHideBar: false,\n        // LoadingMe\n        showLoading: false,\n        showCashAdvanceLoading: false,\n        // By B Nimol\n        decimalFormat: \"n2\",\n        purchaseFormContent: PurchaseFormContent,\n        depositBalance: 0,\n        txnExpense: new Expenses({}),\n        transactionType: {},\n        supplierDiscountItem: [],\n        taxListDetail: [],\n        purchaseOrders: [],\n        purchaseOrder: {},\n        refFrom: [],\n        showLoadingPO: false\n    }),\n    methods: {\n        onDepositDeductionChange() {\n            if (this.depositAmount === \"\" || this.depositAmount === undefined) {\n                this.depositAmount = 0;\n            }\n            const deduction = parseFloat(this.depositAmount) || 0;\n            if (deduction > parseFloat(this.supplierDepositAmount)) {\n                this.depositAmount = parseFloat(this.supplierDepositAmount);\n                // this.txnExpense.depositDeduction = this.depositAmount\n            }\n            this.autoCalculate();\n        },\n        removeEmptyValues(obj) {\n            for (let propName in obj) {\n                if (!obj[propName] || obj[propName].length === 0) {\n                    delete obj[propName];\n                } else if (typeof obj[propName] === \"object\") {\n                    this.removeEmptyValues(obj[propName]);\n                }\n            }\n            return obj;\n        },\n        onLocationChange() {\n            window.console.log(\n                \"location\",\n                this.removeEmptyValues(this.segment),\n                this.removeEmptyValues(this.location)\n            );\n        },\n        mappingExpense(expense) {\n            const ds = this.$refs.expenseAccountDS.kendoWidget();\n            const accountLine = ds\n                .data()\n                .filter((n) => n.amount > 0)\n                .map((m) => {\n                    const id = m.id || \"lin-\" + uuid.v1();\n                    const line = new ExpenseEntryExtendedModel(m);\n                    line[\"id\"] = id\n                    return line\n                });\n            window.console.log('accountLine__', accountLine)\n            window.console.log('accountLine', JSON.stringify(accountLine))\n            this.txnExpense.id = expense.uuid;\n            this.txnExpense.hasAdditionalCost = this.hasAdditionalCost;\n            this.txnExpense.journal_uuid = expense.journal_uuid;\n            this.txnExpense.type = \"Expense\";\n            this.txnExpense.abbr = this.abbr(this.transactionType);\n            this.txnExpense.transactionType = this.transactionType;\n            this.txnExpense.referenceNo = expense.number;\n            // this.txnExpense.referenceNo = expense.number\n            this.txnExpense.transactionDate = expense.expense_date;\n            this.txnExpense.transactionDateTZ = Helper.toISODate(expense.expense_date);\n            this.txnExpense.dueDate = expense.due_date;\n            this.txnExpense.billDate = expense.bill_date;\n            this.txnExpense.billNumber = expense.bill_number;\n            this.txnExpense.currency = this.removeEmptyValues(expense.bill_currency);\n            this.txnExpense.supplier = this.supplierMap(expense.supplier);\n            this.txnExpense.employee = this.removeEmptyValues(expense.employee);\n            this.txnExpense.paymentTerm = this.removeEmptyValues(this.paymentTerm);\n            this.txnExpense.segment = this.removeEmptyValues(this.segment);\n            this.txnExpense.location = this.removeEmptyValues(this.location);\n            this.txnExpense.project = this.removeEmptyValues(this.project);\n            this.txnExpense.monthOf = expense.month_of;\n\n            this.txnExpense.additionalCostSupplier = this.removeEmptyValues(\n                expense.additional_cost_supplier\n            );\n            this.txnExpense.use_for_transaction_uuid =\n                expense.use_for_transaction_uuid;\n            this.txnExpense.useForOption = expense.use_for_option;\n            this.txnExpense.transactionNote = expense.voucher_note;\n            this.txnExpense.journalNote = expense.journal_note;\n            this.txnExpense.itemLines = accountLine;\n            this.txnExpense.account = new AccountMappingModel(\n                this.removeEmptyValues(this.expense.transaction_account)\n            );\n            this.txnExpense.saveOption = expense.is_draft;\n            this.txnExpense.status = 1;\n            this.txnExpense.createdAt = expense.created_date;\n\n            this.txnExpense.total = parseFloat(this.totalAmount);\n            this.txnExpense.exchangeTotal =\n                parseFloat(this.totalAmount) * (this.exchangeRate.rate || 1);\n            this.txnExpense.amountDue = this.amountDue;\n            this.txnExpense.remainingAmount = this.amountDue;\n            this.txnExpense.subTotal = this.subTotal;\n            this.txnExpense.purchaseTax = this.purchaseTax;\n            this.txnExpense.whdTax = this.whdTax;\n            this.txnExpense.supplierDiscountItem = this.supplierDiscountItem;\n            this.txnExpense.loggedUser = this.loggedUser(this.expense.created_by);\n\n            this.txnExpense.txnRate = this.exchangeRate.rate;\n            this.txnExpense.discountTotal = parseFloat(this.discountAmount);\n            this.txnExpense.depositAmount = parseFloat(this.depositBalance);\n            this.txnExpense.depositDeduction = parseFloat(this.depositAmount);\n            this.txnExpense.exchangeDepositDeduction =\n                parseFloat(this.depositAmount) * this.exchangeRate.rate || 1;\n            this.txnExpense.exchangeAmount =\n                this.amountDue * this.exchangeRate.rate || 1;\n            this.txnExpense.purchaseOrder = this.purchaseOrder || {}\n            this.txnExpense.refFrom = []\n            if (this.purchaseOrder) {\n                this.txnExpense.refFrom = [\n                    {\n                        id: this.purchaseOrder.id || '',\n                        reference: this.purchaseOrder.referenceNo || ''\n                    }\n                ]\n            }\n        },\n        loggedUser(user) {\n            if (user) {\n                return {\n                    id: user.id,\n                    name: user.user_name,\n                    email: user.email,\n                };\n            }\n            return {};\n        },\n        supplierMap(supplier) {\n            if (supplier) {\n                return {\n                    id: supplier.uuid,\n                    name: supplier.name,\n                    email: supplier.email,\n                    phone: supplier.phone,\n                    address: supplier.address,\n                };\n            }\n            return {};\n        },\n        async saveTxnExpense(response) {\n            this.txnExpense[\"uuid\"] = response.data.uuid || '';\n            this.txnExpense[\"id\"] = this.txnExpense.id ? this.txnExpense.id : \"\";\n            this.txnExpense[\"journal_uuid\"] = response.data.journal_uuid || '';\n            this.txnExpense[\"actionType\"] = this.isEdit ? 'edit' : \"new\";\n            // let data = this.txnExpense;\n            // window.console.log('expense==', JSON.stringify(this.txnExpense.taxList))\n            billingHandler.createExpense(this.txnExpense).then((res) => {\n                if (res.data.statusCode === 201) {\n                    this.$snotify.success(\"Successfully\");\n                    this.responseStatus(response);\n                }\n            })\n                .catch((e) => {\n                    this.$snotify.error(\"Something went wrong\");\n                    this.errors.push(e);\n                });\n        },\n        removeDuplicate(array) {\n            const result = [];\n            const map = new Map();\n            for (const item of array) {\n                if (!map.has(item.id)) {\n                    map.set(item.id, true); // set any value to Map\n                    result.push(item);\n                }\n            }\n            return result;\n        },\n        account(txnAccount) {\n            if (txnAccount) {\n                return {\n                    id: txnAccount.uuid,\n                    uuid: txnAccount.uuid,\n                    account_uuid: txnAccount.account_uuid,\n                    name: txnAccount.name,\n                    local_name: txnAccount.local_name,\n                    number: txnAccount.number,\n                    is_taxable: txnAccount.is_taxable,\n                    banhjiAccCode: txnAccount.banhjiAccCode,\n                    group_code: txnAccount.group_code,\n                    parent_account: txnAccount.parent_account,\n                    type_code: txnAccount.type_code,\n                    account_type: txnAccount.account_type,\n                };\n            }\n            return {};\n        },\n        abbr(transactionType) {\n            if (transactionType) {\n                return transactionType.abbr;\n            }\n            return \"\";\n        },\n        supplierDepositBalance() {\n            this.supplierDepositAmount = 0;\n            if (this.depositBalance > 0) {\n                this.supplierDepositAmount =\n                    this.depositBalance / this.exchangeRate.rate;\n            }\n        },\n        async loadDepositBalance(id) {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const strFilter = id + \"?type=dep\";\n                    this.supplierDepositAmount = 0;\n                    this.depositAmount = 0;\n                    billingHandler\n                        .balance(strFilter)\n                        .then((res) => {\n                            if (res.data.statusCode === 200) {\n                                const data = res.data.data;\n                                if (data.length > 0) {\n                                    this.depositBalance = data[0].balance;\n                                    this.supplierDepositBalance();\n                                }\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 300);\n            });\n        },\n        async loadPurchaseFormContent() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    purchaseFormContentHandler.list().then((res) => {\n                        if (res.data.statusCode === 200) {\n                            const data = res.data.data;\n                            if (data.length > 0) {\n                                const supplierSetting = data[0];\n                                this.purchaseFormContent = supplierSetting;\n                                if (supplierSetting.hasOwnProperty(\"decimal\")) {\n                                    this.decimalFormat = \"n\" + supplierSetting.decimal;\n                                    // Add 2 default lines\n                                    this.addRow();\n                                    this.addRow();\n                                }\n                            }\n                        }\n                    });\n                }, 100);\n            });\n        },\n        numberFormat(value) {\n            return kendo.toString(value, `${this.decimalFormat}`);\n        },\n        onDueDateChanged() {\n            this.calculateDueDate(this.paymentTerm);\n        },\n        async onVendorChanged() {\n            // let paymentBilling = {};\n            // if (\n            //     Object.prototype.hasOwnProperty.call(this.supplier, \"paymentBilling\")\n            // ) {\n            //   paymentBilling = this.supplier.paymentBilling;\n            //   if (\n            //       Object.prototype.hasOwnProperty.call(paymentBilling, \"paymentTerm\")\n            //   ) {\n            //     this.paymentTerm = new PaymentTermModel(paymentBilling.paymentTerm);\n            //     this.calculateDueDate(paymentBilling.paymentTerm);\n            //   }\n            // }\n            this.loadDepositBalance(this.supplier.id);\n            this.loadPaymentTermList();\n\n            /* Supplier expense account */\n            let ds = this.$refs.expenseAccountDS.kendoWidget();\n            ds.data([]);\n\n            // Insert row\n            let je = new ExpenseEntryExtendedModel({\n                account: this.supplier.accountTax.expenseAcc,\n                quantity: 1,\n                decimalFormat: this.decimalFormat,\n            });\n\n            ds.add(je);\n            this.addRow();\n            this.loadPurchaseOrder()\n        },\n        calculateDueDate(paymentTerm) {\n            if (paymentTerm) {\n                if (paymentTerm.hasOwnProperty(\"netDue\")) {\n                    const netDue = paymentTerm.netDue;\n                    const dueDate = new Date(this.expense.expense_date);\n                    dueDate.setDate(dueDate.getDate() + parseInt(netDue)); //number  of days to add, e.x. 15 days\n                    this.expense.due_date = dueDate.toISOString().substr(0, 10);\n                }\n            }\n        },\n        NumberEditor(container, options) {\n            kendo\n                .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoNumericTextBox({\n                    decimals: 30,\n                    format: `${this.decimalFormat}`,\n                });\n        },\n        Help(key_search) {\n            ShowResource(key_search);\n        },\n        // Initial Data\n        initialData() {\n            if (this.initExpense) {\n                // Edit Mode\n                this.expense = Object.assign({}, this.initExpense);\n                this.bindData();\n            } else {\n                // Brand New Mode\n                this.setDefaultData();\n            }\n        },\n        // Set default data\n        async setDefaultData() {\n            // Brand New Mode\n            this.isEdit = false;\n\n            this.expense = Object.assign({}, new ExpenseModel({\n                date: new Date().toISOString().substr(0, 10),\n                due_date: new Date().toISOString().substr(0, 10),\n                bill_date: new Date().toISOString().substr(0, 10),\n                month_of: new Date().toISOString().substr(0, 7),\n            }));\n\n            /* Default Sidebar */\n            let locations = await this.$store.dispatch(\"locations/getList\");\n            this.location = new LocationModel(locations[0]);\n\n            let segments = await this.$store.dispatch(\"segments/getList\");\n            this.segment = new SegmentModel(segments.find((i) => i.isSystem === 1));\n\n            // Generate Number\n            this.generateNumber();\n\n            // Add 2 default lines\n            // this.addRow();\n            // this.addRow();\n\n            this.autoCalculate();\n        },\n        // Bind data from prop for edit mode\n        async bindData() {\n            this.showLoading = true;\n\n            // Edit Mode\n            this.isEdit = true;\n\n            // Currency\n            this.currency = new CurrencyModel(this.expense.bill_currency);\n            this.exchangeRate = new ExchangeRateModel(this.expense.bill_currency);\n            this.exchangeRate.id = this.expense.expense_entries[0].exchange_rate_uuid;\n            this.exchangeRate.rate = this.expense.expense_entries[0].exchange_rate;\n\n            // Payment Term\n            let paymentTerms = await this.$store.dispatch(\"paymentTerms/getList\");\n            this.paymentTerm = new PaymentTermModel(paymentTerms.find((i) => i.id === this.expense.payment_term));\n\n            // Contacts\n            this.supplier = new SupplierModel(this.expense.supplier);\n            this.employee = new EmployeeModel(this.expense.employee);\n            this.hasAdditionalCost = Boolean(this.expense.additional_cost_supplier.uuid);\n\n            // Sidebar\n            let locations = await this.$store.dispatch(\"locations/getList\");\n            this.location = new LocationModel(locations.find((i) => i.id === this.expense.location_uuid));\n\n            let segments = await this.$store.dispatch(\"segments/getList\");\n            this.segment = new SegmentModel(\n                segments.find((i) => i.id === this.expense.segment_uuid)\n            );\n\n            let projects = await this.$store.dispatch(\"projects/getList\");\n            this.project = new ProjectModel(\n                projects.find((i) => i.id === this.expense.project_uuid)\n            );\n\n            // Cash Advance\n            if (\n                this.employee.id !== \"\" &&\n                this.segment.id !== \"\" &&\n                this.expense.use_for_option === 2\n            ) {\n                let cashAdvances = await cashAdvanceHandler.getByEmployeeId(\n                    this.employee.id\n                );\n                this.cashAdvances = cashAdvances.data.filter(\n                    (i) => i.segment_uuid === this.segment.id\n                );\n            }\n\n            // Entries\n            let entries = [],\n                subTotal = 0,\n                discountAmount = 0,\n                purchaseTaxAmount = 0,\n                whdTaxAmount = 0,\n                secondaryAccounts = await this.$store.dispatch(\"accounting/getSecondaryAccounts\"),\n                discountItems = await this.$store.dispatch(\"discountItems/getList\"),\n                taxItems = await this.$store.dispatch(\"taxes/getList\"),\n                uoms = await this.$store.dispatch(\"unitOfMeasurements/getList\"),\n                clazz = await this.$store.dispatch(\"classes/getList\");\n\n            this.expense.expense_entries.forEach((value) => {\n                // Purchase Tax\n                if (value.account.account_type.number === AccountTypeCode.PURCHASE_TAX) {\n                    purchaseTaxAmount += value.amount;\n                } else {\n                    if (value.amount > 0 && value.account.number !== AccountTypeCode.TAX_RELATED_EXPENSE_CODE) {\n                        let entry = new ExpenseEntryExtendedModel(value);\n                        entry.decimalFormat = this.decimalFormat;\n\n                        /* Secondary Account */\n                        if (value.secondary_acc_uuid !== \"\") {\n                            value.secondary_account = new AccountModel(secondaryAccounts.find((i) => i.uuid === value.secondary_acc_uuid));\n                        }\n\n                        // Subtotal\n                        subTotal += value.amount;\n\n                        // UOM\n                        entry.uom = new UomModel(\n                            uoms.find((item) => item.id === value.uom_uuid)\n                        );\n\n                        // Discount\n                        if (value.hasOwnProperty('discount'))\n                            if (value.discount.hasOwnProperty('uuid'))\n                                entry.discount = new DiscountItemModel(discountItems.find((i) => i.id === value.discount.uuid));\n\n                        // Tax\n                        if (value.hasOwnProperty('tax_item'))\n                            if (value.tax_item.hasOwnProperty('uuid')) {\n                                entry.tax_item = taxItems.find((i) => i.id === value.tax_item.uuid);\n\n                                /* Apply Inclusive Tax to amount */\n                                if (entry.tax_item.hasOwnProperty('taxType'))\n                                    if (entry.tax_item.taxType.hasOwnProperty('typeId'))\n                                        if (entry.tax_item.taxType.typeId === 1 && entry.tax_item.baseAmount.toLowerCase() === TaxType.INCLUSIVE)\n                                            subTotal += entry.tax_amount;\n                            }\n\n                        // Classes\n                        entry.class1 = new ClassModel(\n                            clazz.find((item) => item.id === value.class_1_uuid)\n                        );\n                        entry.class2 = new ClassModel(\n                            clazz.find((item) => item.id === value.class_2_uuid)\n                        );\n                        entry.class3 = new ClassModel(\n                            clazz.find((item) => item.id === value.class_3_uuid)\n                        );\n                        entry.class4 = new ClassModel(\n                            clazz.find((item) => item.id === value.class_4_uuid)\n                        );\n                        entry.class5 = new ClassModel(\n                            clazz.find((item) => item.id === value.class_5_uuid)\n                        );\n\n                        entries.push(entry);\n                    } else {\n                        // Discount\n                        if (value.account.account_type.number === AccountTypeCode.DISCOUNT) {\n                            discountAmount += value.amount * -1;\n                        }\n\n                        // WHD Tax\n                        if (value.account.account_type.number === AccountTypeCode.WHD_TAX) {\n                            whdTaxAmount += value.amount * -1;\n                        }\n\n                        // Deposit\n                        if (~AccountTypeCode.PURCHASE_DEPOSITS.indexOf(value.account.account_type.number)) {\n                            this.depositAmount = value.amount * -1;\n                        }\n\n                        // Transaction Account (Payable Account / Clearing Account)\n                        if (value.account.uuid === this.expense.transaction_account.uuid) {\n                            this.amountDue = value.amount * -1;\n\n                            /* Secondary Account */\n                            this.secondaryAccount = new AccountModel(secondaryAccounts.find((i) => i.uuid === value.secondary_acc_uuid));\n                        }\n                    }\n                }\n            });\n\n            // Bind Expense Entries\n            this.expenseEntries = entries;\n\n            // Calculation\n            this.subTotal = subTotal;\n            this.discountAmount = discountAmount;\n            this.purchaseTax = purchaseTaxAmount;\n            this.whdTax = whdTaxAmount;\n            this.totalAmount = subTotal - this.discountAmount;\n\n            /* Journal */\n            let journals = await journalHandler.getOne(this.expense.journal_uuid);\n            this.journal = journals.data;\n            this.loadExpensePurchaseOrder()\n            this.showLoading = false;\n        },\n        /* Load Data */\n        async loadData() {\n            // Supplier Setting such as decimal format\n            await this.loadPurchaseFormContent();\n\n            // Call Account List\n            this.accounts = await this.$store.dispatch(\"accounting/getAccounts\");\n            this.expenseAccounts = this.accounts;\n\n            // Advance Settlement Clearing Account by banhji_account_number\n            let advSetClrAcc = this.accounts.find(i => i.banhji_account_number === AccountTypeCode.ADVANCE_SETTLEMENT_CLEARING_CODE);\n            this.advanceSettlementClearingAccount = new AccountModel(advSetClrAcc);\n\n            // Other Clearing Suspenses Account by banhji_account_number\n            let otherClrSusAcc = this.accounts.find(i => i.banhji_account_number === AccountTypeCode.OTHER_CLEARING_SUSPENSES_CODE);\n            this.otherClearingSuspenseAccount = new AccountModel(otherClrSusAcc);\n\n            // Filter Transaction Accounts\n            this.filterTransactionAccount();\n        },\n        // Number\n        async generateNumber() {\n            let num = await Helper.generateAccountingNumber(\n                EntityType.EXPENSES,\n                this.expense.expense_date\n            );\n\n            this.expense.number = num.number;\n            this.transactionType = num.prefix;\n            this.expense.prefix_format = num.prefix_format;\n        },\n        // Get Exchange Rate\n        async getExchangeRate() {\n            if (this.expense.expense_date && this.currency.code !== \"\") {\n                this.exchangeRate = await Helper.getLastExchangeRateByDate(\n                    this.expense.expense_date,\n                    this.currency.code\n                );\n            } else {\n                this.exchangeRate = new ExchangeRateModel(institute.baseCurrency);\n            }\n            window.console.log(this.exchangeRate, \"Xrate\");\n            this.supplierDepositBalance();\n        },\n        // Load Cash Advance\n        loadCashAdvance() {\n            /* Purchase Order */\n            this.loadPurchaseOrder()\n            /* Clear */\n            this.cashAdvances = [];\n            this.expense.use_for_transaction_uuid = \"\";\n\n            if (\n                this.employee.id !== \"\" &&\n                this.segment.id !== \"\" &&\n                this.expense.use_for_option === 2\n            ) {\n                this.showCashAdvanceLoading = true;\n\n                cashAdvanceHandler\n                    .getByEmployeeId(this.employee.id)\n                    .then((res) => {\n                        let responseData = new ResponseDataModel(res);\n                        /* Filter by segment */\n                        this.cashAdvances = responseData.data.filter(\n                            (item) => item.segment_uuid === this.segment.id\n                        );\n                    })\n                    .finally(() => {\n                        this.showCashAdvanceLoading = false;\n                    });\n            }\n        },\n        /* On date changes */\n        onDateChanges() {\n            this.expense.month_of = new Date(this.expense.expense_date).toISOString().substr(0, 7);\n            this.getExchangeRate();\n            this.generateNumber();\n        },\n        /* On Transaction Account Changes */\n        onTransactionAccountChanges() {\n            this.secondaryAccount = new AccountModel();\n        },\n        /* On Cash Advance Changes */\n        onCashAdvanceChanges() {\n            this.setCashAdvanceProject();\n            this.disableProject = false;\n        },\n        /* Bind project from cash advance */\n        async setCashAdvanceProject() {\n            if (this.expense.use_for_transaction_uuid !== \"\") {\n                let cashAdvance = this.cashAdvances.find(\n                    (i) => i.uuid === this.expense.use_for_transaction_uuid\n                );\n\n                if (cashAdvance.project_uuid !== \"\") {\n                    let projects = await this.$store.dispatch(\"projects/getList\");\n                    this.project = projects.find(\n                        (i) => i.id === cashAdvance.project_uuid\n                    );\n\n                    this.disableProject = true;\n                } else {\n                    this.disableProject = false;\n                }\n            }\n        },\n        // On Employee Radio Changes\n        onUseForOptionChanges() {\n            // Clear Selected Cash Advance\n            this.expense.use_for_transaction_uuid = \"\";\n            this.expense.transaction_account = new AccountModel();\n\n            /* Load Cash Advance */\n            if (this.expense.use_for_option === 2) {\n                this.loadCashAdvance();\n            }\n\n            this.secondaryAccount = new AccountModel();\n            this.filterTransactionAccount();\n        },\n        // Filter Transation Account\n        async filterTransactionAccount() {\n            if (this.expense.use_for_option === 0) {\n                // Credit (Payable Account)\n                this.transactionAccounts = this.accounts.filter(\n                    (i) =>\n                        ~AccountTypeCode.PAYABLE_ACCOUNTS.indexOf(i.account_type.number)\n                );\n            } else if (this.expense.use_for_option === 3) {\n                // Cash Account\n                this.transactionAccounts = this.accounts.filter(\n                    (i) =>\n                        ~AccountTypeCode.CASH_ACCOUNTS.indexOf(i.account_type.number)\n                );\n            } else {\n                // Reimbursement / Cash Advance\n                this.expense.transaction_account = this.advanceSettlementClearingAccount;\n                this.transactionAccounts = [this.advanceSettlementClearingAccount];\n            }\n        },\n        // On Additional Cost Changes\n        onAdditionalCostCheckboxChanges() {\n            let ds = this.$refs.expenseAccountDS.kendoWidget();\n            ds.data([]);\n\n            if (this.hasAdditionalCost) {\n                this.expenseAccounts = [this.otherClearingSuspenseAccount];\n\n                // Insert row\n                let je = new ExpenseEntryExtendedModel({\n                    account: this.otherClearingSuspenseAccount,\n                    quantity: 1,\n                    decimalFormat: this.decimalFormat,\n                });\n\n                ds.add(je);\n            } else {\n                this.expense.additional_cost_supplier = null;\n                this.expenseAccounts = this.accounts;\n                this.addRow();\n                this.addRow();\n            }\n        },\n        /* Kendo */\n        // DataSource Changes\n        onExpenseAccountDSChanges(e) {\n            if (e.field) {\n                let dataRow = e.items[0];\n\n                if (e.field === \"account\") {\n                    /* Set account id */\n                    dataRow.set(\"account_uuid\", dataRow.account.uuid);\n\n                    /* Add Extra Row */\n                    this.addExtraRow(dataRow.uid);\n                } else if (e.field === \"secondary_account\") {\n                    if (dataRow.secondary_account !== null) {\n                        dataRow.set(\"secondary_acc_uuid\", dataRow.secondary_account.uuid);\n                    } else {\n                        // Set default when deselect\n                        dataRow.set(\"secondary_acc_uuid\", \"\");\n                        dataRow.set(\"secondary_account\", new AccountModel());\n                    }\n                } else if (e.field === \"quantity\" || e.field === \"price\") {\n                    let amt =\n                        kendo.parseFloat(dataRow.quantity) *\n                        kendo.parseFloat(dataRow.price);\n                    dataRow.set(\"amount\", amt);\n                } else if (e.field === \"uom\") {\n                    if (dataRow.uom) {\n                        dataRow.set(\"uom_uuid\", dataRow.uom.id);\n                    }\n                } else if (e.field === \"tax_item\") {\n                    if (dataRow.tax_item === null) {\n                        // Set default when deselect\n                        dataRow.set(\"tax_item\", new TaxModel());\n                    }\n                } else if (e.field === \"class1\") {\n                    if (dataRow.class1 !== null) {\n                        dataRow.set(\"class_1_uuid\", dataRow.class1.id);\n                    } else {\n                        // Set default when deselect\n                        dataRow.set(\"class_1_uuid\", \"\");\n                        dataRow.set(\"class1\", new ClassModel());\n                    }\n                } else if (e.field === \"class2\") {\n                    if (dataRow.class2 !== null) {\n                        dataRow.set(\"class_2_uuid\", dataRow.class2.id);\n                    } else {\n                        // Set default when deselect\n                        dataRow.set(\"class_2_uuid\", \"\");\n                        dataRow.set(\"class2\", new ClassModel());\n                    }\n                } else if (e.field === \"class3\") {\n                    if (dataRow.class3 !== null) {\n                        dataRow.set(\"class_3_uuid\", dataRow.class3.id);\n                    } else {\n                        // Set default when deselect\n                        dataRow.set(\"class_3_uuid\", \"\");\n                        dataRow.set(\"class3\", new ClassModel());\n                    }\n                } else if (e.field === \"class4\") {\n                    if (dataRow.class4 !== null) {\n                        dataRow.set(\"class_4_uuid\", dataRow.class4.id);\n                    } else {\n                        // Set default when deselect\n                        dataRow.set(\"class_4_uuid\", \"\");\n                        dataRow.set(\"class4\", new ClassModel());\n                    }\n                } else if (e.field === \"class5\") {\n                    if (dataRow.class5 !== null) {\n                        dataRow.set(\"class_5_uuid\", dataRow.class5.id);\n                    } else {\n                        // Set default when deselect\n                        dataRow.set(\"class_5_uuid\", \"\");\n                        dataRow.set(\"class5\", new ClassModel());\n                    }\n                }\n\n                this.autoCalculate();\n            }\n        },\n        calculateDiscount(discountItem, subTotal) {\n            if (discountItem) {\n                const nature = discountItem.nature;\n                const amount = discountItem.amount;\n                if (nature === \"Amount\") {\n                    return kendo.parseFloat(amount);\n                } else if (nature === \"Percentage\") {\n                    return subTotal * (kendo.parseFloat(amount) / 100);\n                }\n            }\n        },\n        autoCalculateTax(tax, amount) {\n            if (tax) {\n                var formula = tax.formula;\n                var inAmt = kendo.parseFloat(amount);\n                var nAmt = kendo.parseFloat(amount);\n                var taxBase = kendo.parseFloat(tax.taxBase) / 100;\n                var rate = kendo.parseFloat(tax.rate) / 100;\n                var total = eval(formula);\n                window.console.log(inAmt, nAmt, taxBase, rate, formula, total);\n                return total;\n            }\n            // return 0\n        },\n        // Auto Calculate In DataSource\n        async autoCalculate() {\n            let expDS = this.$refs.expenseAccountDS.kendoWidget(),\n                subTotal = 0,\n                discount = 0,\n                purchaseTax = 0,\n                whdTax = 0,\n                inclusiveTax = 0,\n                taxListDetail = [],\n                tax = [],\n                discountItem = [];\n\n            // Expense\n            expDS.data().forEach((value) => {\n                let amt = kendo.parseFloat(value.price) * kendo.parseFloat(value.quantity);\n\n                /* Subtotal */\n                subTotal += amt;\n\n                // Discount\n                let discountAmount = 0;\n                if (value.hasOwnProperty('discount'))\n                    if (value.discount.hasOwnProperty('id'))\n                        if (value.discount.id !== \"\") {\n                            discountAmount = this.calculateDiscount(value.discount, amt);\n                            discount += discountAmount;\n                            discountItem.push(value.discount);\n                        }\n\n                // Tax\n                if (value.hasOwnProperty('tax_item'))\n                    if (value.tax_item.hasOwnProperty('id'))\n                        if (value.tax_item.id !== \"\") {\n                            let amtAfterDiscount = amt - discountAmount;\n                            const taxAmount = this.autoCalculateTax(value.tax_item, amtAfterDiscount);\n                            if (value.tax_item.baseAmount.toLowerCase() === TaxType.INCLUSIVE) {\n                                inclusiveTax += taxAmount;\n                            }\n                            /*todo: add expense tax */\n                            // const vatTax_ = value.tax_item || {}\n                            tax['taxAmount'] = taxAmount\n                            tax['amount'] = value.amount || 0\n                            tax['discount'] = discountAmount || 0\n                            tax['txnRate'] = this.exchangeRate.rate || 1\n                            tax['isVat'] = 1\n                            tax['line'] = new TaxModel(value.tax_item || {})\n                            tax.detail = {\n                                specificTax: {},\n                                publicLightingTax: {},\n                                otherTax: {},\n                            }\n                            taxListDetail.push(tax);\n                            /*****************************/\n                            if (value.tax_item.hasOwnProperty('taxType'))\n                                if (value.tax_item.taxType.hasOwnProperty('typeId'))\n                                    if (value.tax_item.taxType.typeId === 2) {/* WHD Tax */\n                                        whdTax += taxAmount;\n                                    } else {/* Purchase Tax */\n                                        purchaseTax += taxAmount;\n                                    }\n\n                            /* Set Tax Amount */\n                            if (value.tax_item.taxType.typeId === 1 && value.tax_item.baseAmount.toLowerCase() === TaxType.INCLUSIVE) {/* Inclusive Tax */\n                                value.set(\"tax_amount\", taxAmount * -1);\n                            } else {\n                                value.set(\"tax_amount\", taxAmount);\n                            }\n                        }\n\n            });\n\n            /* Apply Inclusive Tax */\n            subTotal -= inclusiveTax;\n\n            this.subTotal = subTotal;\n            this.discountAmount = discount;\n            this.purchaseTax = purchaseTax;\n            this.whdTax = whdTax;\n\n            let totalAmount = (this.subTotal - discount) + whdTax + purchaseTax;\n            this.totalAmount = totalAmount;\n\n            let amountDue = (this.totalAmount - this.depositAmount) - whdTax;\n            this.amountDue = amountDue;\n\n            this.supplierDiscountItem = this.removeDuplicate(discountItem);\n\n            this.taxListDetail = taxListDetail\n            await this.autoCalculateTaxDetail()\n        },\n        // Row Number Template\n        rowNumberTmpl(dataItem) {\n            let ds = this.$refs.expenseAccountDS.kendoWidget(),\n                index = ds.indexOf(dataItem);\n\n            return index + 1;\n        },\n        // Grid Custom Editor\n        expenseAccountEditor(container, options) {\n            return Helper.accountEditor(container, options, this.expenseAccounts);\n        },\n        // Add New Row\n        addRow() {\n            let ds = this.$refs.expenseAccountDS.kendoWidget(),\n                last = ds.total();\n\n            let je = new ExpenseEntryExtendedModel();\n            je.quantity = 1;\n            je.decimalFormat = this.decimalFormat;\n\n            ds.insert(last, je);\n        },\n        // Add Extra Row\n        addExtraRow(uid) {\n            let ds = this.$refs.expenseAccountDS.kendoWidget(),\n                total = ds.total(),\n                row = ds.getByUid(uid),\n                index = ds.indexOf(row);\n\n            if (index === total - 1) {\n                this.addRow();\n            }\n        },\n        // Remove Row\n        removeRow(e) {\n            e.preventDefault();\n\n            let grid = this.$refs.expenseGrid.kendoWidget(),\n                ds = grid.dataSource,\n                dataItem = grid.dataItem(kendo.jQuery(e.currentTarget).closest(\"tr\"));\n\n            if (ds.data().length > 1) {\n                ds.remove(dataItem);\n                this.autoCalculate();\n            }\n        },\n        removeEmptyRow() {\n            let ds = this.$refs.expenseAccountDS.kendoWidget();\n\n            /* Collect empty row by uid */\n            let emptyIds = [];\n            ds.data().forEach(value => {\n                if (value.account.name === '') {\n                    emptyIds.push(value.uid);\n                }\n            });\n\n            /* Remove empty row by uid */\n            for (let i = 0; i < emptyIds.length; i++) {\n                const dataItem = ds.getByUid(emptyIds[i]);\n                ds.remove(dataItem);\n            }\n        },\n        // Shrink Data\n        shrinkData() {\n            // Date\n            this.expense.expense_date = Helper.toISODate(this.expense.expense_date);\n            this.expense.bill_date = Helper.toISODate(this.expense.bill_date);\n            this.expense.due_date = Helper.toISODate(this.expense.due_date);\n            this.expense.payment_term = this.paymentTerm.id;\n\n            // Currency\n            this.expense.bill_currency = this.currency;\n\n            // Supplier\n            this.expense.supplier = new ContactModel(this.supplier);\n\n            // Employee\n            this.expense.employee = new ContactModel(this.employee);\n\n            // Sidebar\n            this.expense.location_uuid = this.location.id;\n            this.expense.segment_uuid = this.segment.id;\n            this.expense.project_uuid = this.project.id;\n\n            /* Status */\n            if (this.expense.use_for_option === 3) {/* Cash */\n                this.expense.is_cleared = 1; /* Paid */\n            }\n\n            // User\n            if (this.isEdit) {\n                this.expense.modified_by = this.user;\n            } else {\n                this.expense.created_by = this.user;\n            }\n\n            /* Remove Empty Rows */\n            this.removeEmptyRow();\n\n            /* Expense Entries */\n            let entries = [],\n                expDS = this.$refs.expenseAccountDS.kendoWidget();\n\n            /* Expense Account on Dr */\n            expDS.data().forEach((value) => {\n                let entry = new ExpenseEntryModel(value);\n\n                // Account\n                entry.account = new AccountModel(value.account);\n\n                // Contact\n                entry.primary_contact = new ContactModel(this.supplier);\n                entry.secondary_contacts = [new ContactModel(this.employee)];\n\n                /* Discount */\n                entry.discount = new DiscountItemModel(value.discount);\n\n                /* Tax */\n                entry.tax_item = new TaxModel(value.tax_item);\n\n                // Currency\n                entry.currency = new CurrencyModel(this.currency);\n                entry.exchange_rate_uuid = this.exchangeRate.id;\n                entry.exchange_rate = this.exchangeRate.rate;\n                entry.exchanged_amount = value.amount * this.exchangeRate.rate;\n                entry.exchanged_tax_amount = value.tax_amount * this.exchangeRate.rate;\n\n                // Discount on Cr\n                let discountAmount = 0;\n                if (value.hasOwnProperty('discount'))\n                    if (value.discount.hasOwnProperty('id'))\n                        if (value.discount.id !== \"\") {\n                            let subTo = kendo.parseFloat(value.price) * kendo.parseFloat(value.quantity);\n                            discountAmount = this.calculateDiscount(value.discount, subTo);\n\n                            /* Discount Entry */\n                            let discountEntry = new ExpenseEntryModel(entry);\n                            discountEntry.account = new AccountModel(value.discount.account);\n                            discountEntry.account_uuid = value.discount.account.uuid;\n                            discountEntry.amount = discountAmount * -1; // Cr side is negative\n                            discountEntry.exchanged_amount = discountAmount * this.exchangeRate.rate;\n                            discountEntry.tax_amount = 0;\n                            discountEntry.exchanged_tax_amount = 0;\n\n                            /* Push Discount Entry */\n                            entries.push(discountEntry);\n                        }\n\n                // Taxes on Dr\n                if (value.hasOwnProperty('tax_item'))\n                    if (value.tax_item.hasOwnProperty('id'))\n                        if (value.tax_item.id !== \"\") {\n                            let amtAfterDiscount = kendo.parseFloat(value.amount) - discountAmount;\n                            let taxAmount = this.autoCalculateTax(value.tax_item, amtAfterDiscount);\n\n                            if (value.tax_item.hasOwnProperty('taxType'))\n                                if (value.tax_item.taxType.hasOwnProperty('typeId'))\n                                    if (value.tax_item.taxType.typeId === 2) {/* WHD Tax on Cr side */\n                                        if (value.tax_item.baseAmount.toLowerCase() === \"net\") {/* WHD Tax Net on Dr side */\n                                            // Add Another Tax Related Expense Account\n                                            let taxRelatedExpenseAccount = new AccountModel(this.accounts.find(i => i.banhjiAccCode === AccountTypeCode.TAX_RELATED_EXPENSE_CODE));\n\n                                            /* Tax Related Expense Entry on Dr */\n                                            let taxRelatedExpenseEntry = new ExpenseEntryModel(entry);\n                                            taxRelatedExpenseEntry.account = taxRelatedExpenseAccount;\n                                            taxRelatedExpenseEntry.account_uuid = taxRelatedExpenseAccount.uuid;\n                                            taxRelatedExpenseEntry.description = i18n.t(\"witholding_tax_expense\");\n                                            taxRelatedExpenseEntry.amount = taxAmount;\n                                            taxRelatedExpenseEntry.exchanged_amount = taxAmount * this.exchangeRate.rate;\n                                            taxRelatedExpenseEntry.tax_amount = 0;\n                                            taxRelatedExpenseEntry.exchanged_tax_amount = 0;\n\n                                            /* Push Tax Related Expense Entry */\n                                            entries.push(taxRelatedExpenseEntry);\n                                        }\n\n                                        // WHD Tax\n                                        taxAmount *= -1; // Cr side\n                                    }\n\n                            /* Tax Entry */\n                            let taxEntry = new ExpenseEntryModel(entry);\n                            taxEntry.account = new AccountModel(value.tax_item.account);\n                            taxEntry.account_uuid = value.tax_item.account.uuid;\n                            taxEntry.amount = taxAmount;\n                            taxEntry.exchanged_amount = taxAmount * this.exchangeRate.rate;\n                            taxEntry.tax_amount = 0;\n                            taxEntry.exchanged_tax_amount = 0;\n\n                            /* Push Tax Entry */\n                            entries.push(taxEntry);\n                        }\n\n                /* Push Entry */\n                entries.push(entry);\n            });\n\n            // Deposit Account on Cr\n            if (this.depositAmount > 0) {\n                entries.push(\n                    new ExpenseEntryModel({\n                        account: new AccountModel(this.supplier.accountTax.purchaseDepositAcc),\n                        account_uuid: this.supplier.accountTax.purchaseDepositAcc.uuid,\n                        primary_contact: new ContactModel(this.supplier),\n                        secondary_contacts: [new ContactModel(this.employee)],\n                        description: this.expense.journal_note,\n                        currency: new CurrencyModel(this.currency),\n                        amount: this.depositAmount * -1, // Cr side is negative\n                        exchange_rate_uuid: this.exchangeRate.id,\n                        exchange_rate: this.exchangeRate.rate,\n                    })\n                );\n            }\n\n            // Transaction Account on Cr\n            entries.push(\n                new ExpenseEntryModel({\n                    account: new AccountModel(this.expense.transaction_account),\n                    account_uuid: this.expense.transaction_account.uuid,\n                    secondary_acc_uuid: this.secondaryAccount.uuid,\n                    primary_contact: new ContactModel(this.supplier),\n                    secondary_contacts: [new ContactModel(this.employee)],\n                    description: this.expense.journal_note,\n                    currency: new CurrencyModel(this.currency),\n                    amount: this.amountDue * -1,// Cr side is negative\n                    exchange_rate_uuid: this.exchangeRate.id,\n                    exchange_rate: this.exchangeRate.rate,\n                })\n            );\n\n            // Use existing uuid\n            if (this.isEdit) {\n                /* Clear uuid */\n                entries.forEach(value => {\n                    value.uuid = \"\";\n                });\n\n                /* Apply existing uuid */\n                for (let i = 0; i < this.journal.journal_entries.length; i++) {\n                    if (i < entries.length) {\n                        const oldEntry = this.journal.journal_entries[i];\n                        entries[i].uuid = oldEntry.uuid;\n                    }\n                }\n            }\n\n            /* Bind Expense Entries */\n            this.expense.expense_entries = entries;\n\n            // mapping to Dynamodb ( expense record ) -> save everywhere morng ^_^\n            this.mappingExpense(this.expense);\n        },\n        // Add Journal\n        addJournal() {\n            let entries = [];\n\n            /* Add Journal Entries */\n            this.expense.expense_entries.forEach((value) => {\n                let entry = new JournalEntryModel(value);\n\n                /* Apply Inclusive Tax to amount */\n                if (value.tax_amount !== 0) {\n                    if (value.tax_item.hasOwnProperty(\"taxType\")) {\n                        if (value.tax_item.taxType.hasOwnProperty(\"typeId\")) {\n                            if (value.tax_item.taxType.typeId === 1 && value.tax_item.baseAmount.toLowerCase() === TaxType.INCLUSIVE) {\n                                entry.amount = value.amount + value.tax_amount;\n                            }\n                        }\n                    }\n                }\n                entry.exchanged_amount = entry.amount * this.exchangeRate.rate;\n\n                // Add Entry\n                entries.push(entry);\n            });\n\n            // Journal Entries\n            this.journalEntries = entries;\n\n            // Journal\n            this.journal.number = this.expense.number;\n            this.journal.description = this.expense.journal_note;\n            this.journal.journal_date = Helper.toISODate(this.expense.expense_date);\n            this.journal.journal_type = EntityType.AUTO_JOURNAL;\n            this.journal.transaction_type = EntityType.EXPENSES;\n            this.journal.related_transaction_uuid = this.expense.use_for_transaction_uuid;\n            this.journal.month_of = this.expense.month_of;\n            this.journal.location_uuid = this.expense.location_uuid;\n            this.journal.project_uuid = this.expense.project_uuid;\n            this.journal.segment_uuid = this.expense.segment_uuid;\n            this.journal.prefix_format = this.expense.prefix_format;\n            this.journal.is_draft = this.expense.is_draft;\n            this.journal.created_date = this.expense.created_date;\n            this.journal.created_by = this.expense.created_by;\n            this.journal.modified_by = this.expense.modified_by;\n        },\n        // Validating\n        validateForm() {\n            let result = true,\n                expDS = this.$refs.expenseAccountDS.kendoWidget(),\n                msg = \"\",\n                secondaryAccountCount = 0,\n                expenseCount = 0;\n\n            // Supplier\n            if (this.supplier.id === \"\") {\n                msg += `<p>${i18n.t(\"supplier_is_required\")}</p>`;\n                result = false;\n            }\n\n            // Bill Number\n            if (this.expense.bill_number === \"\") {\n                msg += `<p>${i18n.t(\"bill_number_is_required\")}</p>`;\n                result = false;\n            }\n\n            // Payment Term\n            if (this.paymentTerm.hasOwnProperty(\"id\"))\n                if (this.paymentTerm.id === \"\") {\n                    msg += `<p>${i18n.t(\"payment_term_is_required\")}</p>`;\n                    result = false;\n                }\n\n            // Employee\n            let employeeOptions = [1, 2];\n            if (this.employee.id === \"\" && ~employeeOptions.indexOf(this.expense.use_for_option)) {\n                msg += `<p>${i18n.t(\"employee_is_required\")}</p>`;\n                result = false;\n            }\n\n            // Expense\n            expDS.data().forEach((value, index) => {\n                // No account\n                if (value.account.uuid === \"\" && value.amount > 0) {\n                    result = false;\n                    msg += `<p>${i18n.t(\n                        \"please_select_expense_account_at_row_number\"\n                    )} ${index + 1}</p>`;\n                }\n\n                // No amount\n                if (value.account.uuid !== \"\" && value.amount === 0) {\n                    result = false;\n                    msg += `<p>${value.account.name} ${i18n.t(\"has_no_amount\")}</p>`;\n                }\n\n                // // Discount\n                // if(value.hasOwnProperty('discount'))\n                // if(value.discount.hasOwnProperty('account'))\n                // if (value.discount.account.uuid === \"\" || value.discount.account.account_type.number === 0) {\n                //     result = false;\n                //     msg += `<p>${i18n.t(\"invalid_discount_account_at_row_number\")} ${index + 1}</p>`;\n                // }\n\n                // // Tax\n                // if(value.hasOwnProperty('tax_item'))\n                // if(value.tax_item.hasOwnProperty('account'))\n                // if (value.tax_item.account.uuid === \"\" || value.tax_item.account.account_type.number === 0) {\n                //     result = false;\n                //     msg += `<p>${i18n.t(\"invalid_tax_account_at_row_number\")} ${index + 1}</p>`;\n                // }\n\n                // Count Empty Row\n                if (value.account.uuid !== \"\" && value.amount > 0) {\n                    expenseCount++;\n                }\n\n                // Count secondary account\n                if (value.secondary_account.uuid !== \"\") {\n                    secondaryAccountCount++;\n                }\n            });\n\n            // Empty Row\n            if (expenseCount === 0) {\n                msg += `<p>${i18n.t(\"please_select_expense_account\")}</p>`;\n                result = false;\n            }\n\n            // Transaction Account\n            if (this.expense.transaction_account.uuid === \"\") {\n                msg += `<p>${i18n.t(\"please_select_transaction_account\")}</p>`;\n                result = false;\n            }\n\n            // Secondary Account\n            if (this.secondaryAccount.uuid === \"\" && secondaryAccountCount > 0) {\n                msg += `<p>${i18n.t(\"transaction_secondary_account_is_required\")}</p>`;\n                result = false;\n            }\n            if (this.secondaryAccount.uuid !== \"\" && secondaryAccountCount === 0) {\n                msg += `<p>${i18n.t(\"expense_secondary_account_is_required\")}</p>`;\n                result = false;\n            }\n\n            // Use for Cash Advance\n            if (\n                this.expense.use_for_option === 2 &&\n                this.expense.use_for_transaction_uuid === \"\"\n            ) {\n                msg += `<p>${i18n.t(\"please_select_related_cash_advance\")}</p>`;\n                result = false;\n            }\n\n            /* Location */\n            if (this.location.id === \"\") {\n                msg += `<p>${i18n.t(\"location_is_required\")}</p>`;\n                result = false;\n            }\n\n            /* Segment */\n            if (this.segment.id === \"\") {\n                msg += `<p>${i18n.t(\"segment_is_required\")}</p>`;\n                result = false;\n            }\n\n            // Show Alert\n            this.errorMessage = msg;\n\n            this.alert = result === false;\n\n            return result;\n        },\n        // All Saves\n        async onSaveOptionClick(mode) {\n            if (this.$refs.form.validate() && this.validateForm()) {\n                let isValidClosingDate = await Helper.validateClosingDate(\n                    this.expense.expense_date\n                );\n                if (isValidClosingDate) {\n                    this.saveMode = mode;\n                    this.save();\n                }\n            }\n        },\n        cancel() {\n            this.$swal({\n                title: i18n.t(\"msg_title_warning\"),\n                text: i18n.t(\"msg_discard\"),\n                icon: \"warning\",\n                showCancelButton: true,\n                cancelButtonText: i18n.t(\"cancel\"),\n                confirmButtonColor: \"#4d4848\",\n                cancelButtonColor: \"#ED1A3A\",\n                confirmButtonText: i18n.t(\"discard\"),\n            }).then((result) => {\n                if (result.value) {\n                    this.clear();\n                    this.$router.go(-1);\n                }\n            });\n        },\n        clear() {\n            // Reset Form\n            this.isEdit = false;\n            this.saveMode = \"\";\n\n            this.subTotal = 0;\n            this.discountAmount = 0;\n            this.purchaseTax = 0;\n            this.whdTax = 0;\n            this.totalAmount = 0;\n            this.supplierDepositAmount = 0;\n            this.depositAmount = 0;\n            this.amountDue = 0;\n            this.hasAdditionalCost = false;\n\n            this.expense = new ExpenseModel();\n            this.journal = new JournalModel();\n            this.journalEntries = [];\n            this.employee = new EmployeeModel();\n            this.supplier = new SupplierModel();\n            this.paymentTerm = new PaymentTermModel();\n            this.currency = new CurrencyModel(institute.baseCurrency);\n            this.exchangeRate = new ExchangeRateModel(institute.baseCurrency);\n            this.secondaryAccount = new AccountModel();\n            this.location = new LocationModel();\n            this.segment = new SegmentModel();\n            this.project = new ProjectModel();\n\n            let expDS = this.$refs.expenseAccountDS.kendoWidget();\n            expDS.data([]);\n\n            this.setDefaultData();\n        },\n        save() {\n            let self = this;\n\n            // Draft Mode\n            if (this.saveMode === SaveOption.SAVEDRAFT) {\n                this.expense.is_draft = 1;\n            } else {\n                this.expense.is_draft = 0;\n            }\n\n            // Shrink Data\n            this.shrinkData();\n\n            // Add Journal\n            this.addJournal();\n\n            // Sync Data\n            this.showLoading = true;\n            expenseHandler.save({\n                expense: this.expense,\n                journal: this.journal,\n                journal_entries: this.journalEntries,\n            }).then(async (response) => {\n                if (response) {\n                    if (response.data.uuid) {\n                        this.showLoading = true;\n                        await self.saveTxnExpense(response);\n                        // await self.autoCalculateTaxDetail()\n                        self.showLoading = false;\n                    }\n                } else {\n                    self.showLoading = false;\n                    this.$snotify.error(i18n.t(\"error_something_wrong\"));\n                }\n            })\n                .catch((error) => {\n                    self.showLoading = false;\n                    this.$snotify.error(error);\n                })\n                .finally(() => {\n                    // self.showLoading = false;\n                });\n        },\n        // Response Status\n        async responseStatus(response) {\n            if (response.status === 200) {\n                if (this.saveMode === SaveOption.SAVECLOSE || this.saveMode === SaveOption.DELETE) {\n                    /* Save Close or Delete */\n                    if (this.isEdit) {\n                        this.goBackToViewPage();\n                    } else {\n                        this.$router.go(-1);\n                    }\n                }\n\n                this.clear();\n\n                /* Alert Success */\n                this.$snotify.success(i18n.t(\"successful\"));\n            } else {\n                /* Alert Error */\n                this.$snotify.error(i18n.t(\"error_something_wrong\"));\n            }\n        },\n        // Go back to view page after edit mode\n        getExpense() {\n            return new ExpenseModel(this.expense);\n        },\n        goBackToViewPage() {\n            this.$router.replace({\n                name: \"Expenses View\",\n                params: {initExpense: this.getExpense()},\n            });\n        },\n        HideSmallSideBar() {\n            this.isHideBar = !this.isHideBar;\n        },\n        async loadPaymentTermList() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    if (this.supplier) {\n                        const strFilter =\n                            \"?id=\" +\n                            this.supplier.id +\n                            \"&transactionDate=\" +\n                            this.expense.expense_date +\n                            \"&type=Vendor\";\n                        this.paymentTerm = new PaymentTermModel();\n                        paymentTermHandler_.get(strFilter).then((res) => {\n                            if (res.data.statusCode === 200) {\n                                const terms = res.data.data;\n                                if (!kendo.jQuery.isEmptyObject(terms)) {\n                                    this.paymentTerm = terms.term;\n                                    this.calculateDueDate(this.paymentTerm);\n                                }\n                            }\n                        });\n                    }\n                }, 10);\n            });\n        },\n        async autoCalculateTaxDetail() {\n            let ids = []\n            this.taxListDetail.forEach(n => {\n                const line = n.line || {}\n                ids.push(line.id || '')\n            })\n            const unique = [...new Set(ids)]\n            let result = []\n            for (const m of unique) {\n                let amount = 0, row = {}, discount = 0, xDiscount = 0, xAmount = 0, taxAmount = 0, xTaxAmount = 0\n                let taxDetail = [], isVat = 0\n                const found = this.taxListDetail.filter(n => n.line.id === m)\n                found.forEach(k => {\n                    row = k\n                    if (k.isVat === 1) {\n                        isVat = 1\n                        const detail_ = k.detail || {}\n                        taxDetail.push(detail_)\n\n                    }\n                    taxAmount += k.taxAmount || 0\n                    xTaxAmount += (k.taxAmount || 0) * (k.txnRate || 1)\n                    amount += (k.amount || 0)\n                    xAmount += (k.amount || 0) * (k.txnRate || 1)\n                    discount += (k.discount || 0)\n                    xDiscount += (k.discount || 0) * (k.txnRate || 1)\n                })\n\n                if (isVat === 1) {\n                    row.detail = {\n                        specificTax: {\n                            name: '',\n                            nameLocale: '',\n                            amount: 0,\n                            exchangeAmount: 0,\n                            accountId: '',\n                            rate: 1,\n                        },\n                        publicLightingTax: {\n                            name: '',\n                            nameLocale: '',\n                            amount: 0,\n                            exchangeAmount: 0,\n                            accountId: '',\n                            rate: 1,\n                        },\n                        otherTax: {\n                            name: '',\n                            nameLocale: '',\n                            amount: 0,\n                            exchangeAmount: 0,\n                            accountId: '',\n                            rate: 1,\n                        }\n                    }\n                } else {\n                    row.detail = {}\n                }\n\n                row.amount = amount\n                row.exchangeAmount = xAmount\n                row.taxAmount = taxAmount\n                row.exchangeTaxAmount = xTaxAmount\n                row.discount = discount\n                row.exchangeDiscount = xDiscount\n                row.currency = this.currency || {}\n                result.push(row)\n                taxDetail = []\n            }\n            const taxDetail = result.map(k => {\n                return {\n                    amount: k.amount,\n                    currency: k.currency,\n                    detail: k.detail,\n                    discount: k.discount,\n                    exchangeAmount: k.exchangeAmount,\n                    exchangeDiscount: k.exchangeDiscount,\n                    exchangeTaxAmount: k.exchangeTaxAmount,\n                    isVat: k.isVat,\n                    line: k.line,\n                    taxAmount: k.taxAmount,\n                    txnRate: k.txnRate\n                }\n            })\n            this.txnExpense.saleTaxDetail = taxDetail\n            window.console.log('saleTaxDetail txnExpense', JSON.stringify(taxDetail))\n        },\n        async loadPurchaseOrder() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    let segmentId = \"\", locationId = '', priceLevelId = \"\", supplierId = \"\", txnDate = \"\";\n                    if (this.segment) {\n                        segmentId = this.segment.id || '';\n                    }\n                    if (this.location) {\n                        locationId = this.location.id || '';\n                    }\n                    if (this.supplier) {\n                        supplierId = this.supplier.id;\n                    }\n                    // if (this.priceLevel) {\n                    //     priceLevelId = this.priceLevel.id || '';\n                    // }\n                    if (this.expense.expense_date) {\n                        txnDate = this.expense.expense_date;\n                    }\n                    let strFilter = \"\";\n                    if (segmentId !== \"\" && supplierId !== \"\" && locationId !== \"\" && txnDate !== \"\") {\n                        strFilter = \"?id=\" + supplierId + \"&segId=\" + segmentId + \"&locId=\" + locationId + \"&plId=\" + priceLevelId + \"&date=\" + txnDate + '&type=Purchase Order'\n                    }\n                    if (strFilter !== \"\") {\n                        this.refFrom = []\n                        this.showLoadingPO = true\n                        saleOrderHandler\n                            .transactionFilter(strFilter)\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.showLoadingPO = false\n                                    this.purchaseOrders = res.data.data;\n                                } else {\n                                    this.showLoadingPO = false\n                                }\n                            })\n                    }\n                }, 10);\n            });\n        },\n        async loadExpensePurchaseOrder() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    if (\n                        this.$route.params.id !== \"\" ||\n                        this.$route.params.id !== undefined\n                    ) {\n                        const id = (this.expense.uuid || '')\n                        window.console.log('expense id', id)\n                        const strId = id.includes('txn-') ? id : 'txn-' + id\n                        this.showLoadingPO = true\n                        billingHandler\n                            .expenseView('?id=' + strId.trim())\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.showLoadingPO = false\n                                    if (res.data.data.length > 0) {\n                                        this.purchaseOrder = res.data.data[0];\n                                    }\n                                } else {\n                                    this.showLoadingPO = true\n                                }\n                            })\n                    }\n                }, 10);\n            });\n        },\n    },\n    watch: {\n        initExpense() {\n            this.initialData();\n        },\n    },\n    created() {\n        this.loadData();\n    },\n    computed: {\n        disableMe() {\n            if (this.expense) {\n                const uuid = this.expense.uuid || \"\";\n                if (uuid) {\n                    return true;\n                } else {\n                    return false;\n                }\n            }\n            return false;\n        },\n    },\n    mounted() {\n        // Initial Data\n        this.initialData();\n    },\n};\n</script>\n\n<style scoped>\n.v-input.custom-radio\n.v-input--selection-controls__input\n.v-input--selection-controls__ripple {\n    display: none !important;\n}\n\n.function_wrapper {\n    box-shadow: none !important;\n}\n\n.v-application--is-ltr .v-text-field .v-input__append-inner {\n    margin-top: 0 !important;\n}\n\n.v-input__slot {\n    background-color: #fff !important;\n}\n\n.function_content .label {\n    margin-bottom: 10px;\n    display: inline-block;\n}\n\n.border_radius10 {\n    border-radius: 10px !important;\n    background-color: #f2f2f2;\n}\n\n.pa-3.v-card h4 {\n    font-size: 18px;\n    color: #333;\n}\n\n.pa-3.v-card p {\n    font-size: 12px;\n    color: #b5b5b5;\n}\n\n.attachment_file {\n    background-color: #efeded;\n    border-radius: 0 !important;\n}\n\n.attachment_table.v-data-table table {\n    border: thin solid rgba(0, 0, 0, 0.12);\n}\n\n.attachment_table table tr th {\n    border-left: thin solid rgba(0, 0, 0, 0.12);\n    height: 35px;\n    border-right: thin solid rgba(0, 0, 0, 0.12);\n}\n\n.block_debit,\n.block_credit {\n    border-bottom: 1px solid #fff;\n}\n\n.block_debit p.number,\n.block_credit p.number {\n    font-size: 25px;\n    color: #7f7f7f;\n}\n\n.block_debit h5,\n.block_credit h5,\n.block_difference h5 {\n    text-transform: uppercase;\n    color: #7f7f7f;\n    font-size: 15px;\n    font-weight: normal;\n}\n\n.block_difference h5 {\n    font-size: 18px;\n}\n\n.block_difference h5 span {\n    font-size: 15px;\n}\n\n.custom_grid table th:last-child {\n    text-align: right !important;\n}\n\n@media (min-width: 1264px) {\n    .container {\n        max-width: 1250px;\n    }\n}\n\n@media (max-width: 576px) {\n    .pt-6.col-sm-5.col-12 {\n        padding-top: 0 !important;\n    }\n\n    .code_text {\n        width: 100%;\n    }\n\n    .phone_no_pt {\n        padding-top: 0 !important;\n    }\n\n    .select_template,\n    .save_option {\n        margin-bottom: 10px;\n    }\n}\n\n.hide_small_bar_class {\n    max-width: 0;\n    transition: 0.5s ease-in;\n    flex: 0 0 0;\n    padding: 0;\n}\n\n.hide_big_bar_class {\n    max-width: 100%;\n    transition: 0.5s ease-in;\n    flex: 0 0 100%;\n}\n\n.info_add {\n    background-color: #ffffff;\n}\n\n.small_sidebar {\n    height: 98%;\n    position: relative;\n    padding: 12px;\n    background-color: #edf1f5;\n}\n\n.iconArrow {\n    right: -35px;\n    position: absolute;\n    bottom: -10px;\n}\n\n.iconArrowHide {\n    position: absolute;\n    right: -7px;\n    bottom: -10px;\n}\n\n.color_grey {\n    color: #808080;\n}\n\n.card_green {\n    min-height: 70px;\n    background-color: #00b050 !important;\n    color: #ffffff;\n}\n\n.lb_bold {\n    font-size: 12px;\n}\n\n.detial_smallside_p {\n    position: absolute;\n    bottom: 10px;\n}\n\n.card_background {\n    background-color: #edf1f5;\n    min-height: 120px;\n}\n\n.deposite_input {\n    width: 100px;\n}\n\n.btn_save_draft {\n    color: #ffffff;\n    background-color: #00b0f0 !important;\n    text-transform: capitalize;\n}\n\n.save_option {\n    background-color: #203864 !important;\n}\n\n.btn_add_small {\n    height: 27px !important;\n    min-width: 25px !important;\n    font-size: 10px;\n    padding: 0 22px !important;\n    background-color: #00b050 !important;\n    color: #ffffff;\n    border-radius: 0 !important;\n}\n\n.list_site_inv {\n    background-color: #92d050;\n    color: #ffffff;\n    font-size: 12px;\n}\n\n.list_site_exp {\n    background-color: #c5e0b4;\n    color: #000000;\n    font-size: 12px;\n    line-height: 16px;\n    min-height: 40px;\n}\n\n.checkbox_inv {\n    padding: 2px;\n    margin-top: 3px;\n    margin-right: 2px;\n}\n\n.exp_select {\n    font-size: 12px !important;\n}\n\n.theme--light.v-data-table\n> .v-data-table__wrapper\n> table\n> tbody\n> tr:hover:not(.v-data-table__expanded__content):not(.v-data-table__empty-wrapper) {\n    background-color: transparent !important;\n}\n</style>\n"]}]}