{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/suppliers/PurchaseDeposits.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/src/views/suppliers/PurchaseDeposits.vue","mtime":1642155812729},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-commerce/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7aTE4bn0gZnJvbSAiQC9pMThuIjsKaW1wb3J0IGtlbmRvIGZyb20gIkBwcm9ncmVzcy9rZW5kby11aSI7CmltcG9ydCBQdXJjaGFzZURlcG9zaXRNb2RlbCBmcm9tICJAL3NjcmlwdHMvcHVyY2hhc2VfZGVwb3NpdC9tb2RlbC9QdXJjaGFzZURlcG9zaXQiOwppbXBvcnQge0Ryb3BEb3duTGlzdH0gZnJvbSAiQHByb2dyZXNzL2tlbmRvLXZ1ZS1kcm9wZG93bnMiOwppbXBvcnQge3V1aWR9IGZyb20gInZ1ZS11dWlkIjsKaW1wb3J0IEl0ZW1MaW5lTW9kZWwgZnJvbSAiQC9zY3JpcHRzL3B1cmNoYXNlX2RlcG9zaXQvbW9kZWwvSXRlbUxpbmUiOwppbXBvcnQge2RhdGFTdG9yZSwgU2hvd1Jlc291cmNlfSBmcm9tICJAL29ic2VydmFibGUvc3RvcmUiOwppbXBvcnQgUGF5bWVudE9wdGlvbkVkaXRvciBmcm9tICJAL3NjcmlwdHMva2VuZG9fZWRpdG9yL1BheW1lbnRPcHRpb25FZGl0b3IiOwppbXBvcnQgSGVscGVyIGZyb20gIkAvaGVscGVyIjsKCmNvbnN0IHNhbGVPcmRlckhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvdHJhbnNhY3Rpb25IYW5kbGVyIik7CmNvbnN0IHN1cHBsaWVySGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9zdXBwbGllckhhbmRsZXIiKTsKCmNvbnN0IGxvY2F0aW9uSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9sb2NhdGlvbkhhbmRsZXIiKTsKY29uc3Qgc2V0dGluZ3NIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3NldHRpbmdzSGFuZGxlciIpOwpjb25zdCBwdXJjaGFzZURlcG9zaXRNb2RlbCA9IG5ldyBQdXJjaGFzZURlcG9zaXRNb2RlbCh7fSk7CmNvbnN0IHByZWZpeEhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvcHJlZml4SGFuZGxlciIpOwpjb25zdCBiaWxsaW5nSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9pbnZvaWNlL2hhbmRsZXIvYmlsbGluZ0hhbmRsZXIiKTsKY29uc3QgYWNjb3VudEhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvaGFuZGxlci9hY2NvdW50aW5nL2FjY291bnQiKTsKY29uc3QgaXRlbUxpbmVNb2RlbCA9IG5ldyBJdGVtTGluZU1vZGVsKHt9KTsKY29uc3QgJCA9IGtlbmRvLmpRdWVyeQpjb25zdCBwYXltZW50T3B0aW9uSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wYXltZW50T3B0aW9uSGFuZGxlciIpOwpjb25zdCBjdXJyZW5jeUhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvY3VycmVuY3kvaGFuZGxlci9jdXJyZW5jeUhhbmRsZXIiKTsKCmNvbnN0IGRlZmF1bHRJdGVtID0ge1sibnVtYmVyTmFtZSJdOiAiU2VsZWN0IHZlbmRvci4uLiIsIFsiaWQiXTogbnVsbH07CmNvbnN0IGVtcHR5SXRlbSA9IHtbIm51bWJlck5hbWUiXTogImxvYWRpbmcgLi4uIn07CmNvbnN0IGl0ZW1MaW5lUHJlZml4ID0gImxpbi0iOwpjb25zdCBPUFRJT05fVFlQRSA9ICJTdXBwbGllciI7CmNvbnN0IHN0ckZpbHRlciA9ICI/b3B0aW9uVHlwZT0iICsgT1BUSU9OX1RZUEU7CmNvbnN0IGNvb2tpZUpTID0gcmVxdWlyZSgiQC9jb29raWUuanMiKTsKY29uc3QgY29va2llID0gY29va2llSlMuZ2V0Q29va2llKCk7CmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWU6ICJQdXJjaGFzZURlcG9zaXQiLAogICAgcHJvcHM6IFsiaWQiXSwKICAgIGNvbXBvbmVudHM6IHsKICAgICAgICBMb2FkaW5nTWU6ICgpID0+IGltcG9ydChgQC9jb21wb25lbnRzL0xvYWRpbmdgKSwKICAgICAgICAiYXBwLWRhdGVwaWNrZXIiOiAoKSA9PiBpbXBvcnQoYEAvY29tcG9uZW50cy9jdXN0b21fdGVtcGxhdGVzL0RhdGVQaWNrZXJDb21wb25lbnRgKSwKICAgICAgICBkcm9wZG93bmxpc3Q6IERyb3BEb3duTGlzdCwKICAgIH0sCiAgICBkYXRhOiAoKSA9PiAoewogICAgICAgIGlzRWRpdDogZmFsc2UsCiAgICAgICAgc2hvd0xvYWRpbmc6IGZhbHNlLAogICAgICAgIGFsZXJ0OiBmYWxzZSwKICAgICAgICBmaWxlczogW10sCiAgICAgICAgc2VnbWVudHM6IFtdLAogICAgICAgIGxvY2F0aW9uczogW10sCiAgICAgICAgcHVyY2hhc2VEZXBvc2l0OiBwdXJjaGFzZURlcG9zaXRNb2RlbCwKICAgICAgICBpdGVtTGluZTogaXRlbUxpbmVNb2RlbCwKICAgICAgICBzdXBwbGllckxpc3Q6IFtdLAogICAgICAgIHN1cHBsaWVyOiB7fSwKICAgICAgICB0ZXh0RmllbGQ6ICJudW1iZXJOYW1lIiwKICAgICAgICBkZWZhdWx0SXRlbTogZGVmYXVsdEl0ZW0sCiAgICAgICAgZGF0YUl0ZW1LZXk6ICJpZCIsCiAgICAgICAgZmlsdGVyOiAiIiwKICAgICAgICBjdXNCYXNlVXJsOiBzdXBwbGllckhhbmRsZXIuc2VhcmNoKCksCiAgICAgICAgdHJhbnNhY3Rpb25UeXBlczogW10sCiAgICAgICAgYWNjU3VwcGxpZXJEZXBvc2l0OiBbXSwKICAgICAgICBwYXltZW50TWV0aG9kOiBbXSwKICAgICAgICBwdXJjaGFzZU9yZGVyczogW10sCiAgICAgICAgc2FsZU9yZGVyQW1vdW50OiAwLAogICAgICAgIHNhbGVPcmRlckN1cnJlbmN5OiAiIiwKICAgICAgICBjdXJyZW5jeUNvZGU6ICIiLAogICAgICAgIGFjY0Nhc2g6IFtdLAogICAgICAgIGRlcG9zaXRMaW5lOiBbXSwKICAgICAgICBjdXJyZW5jeUxpc3Q6IFtdLAogICAgICAgIGRlY2ltYWxGb3JtYXQ6ICJuMiIsCiAgICAgICAgZGVwb3NpdEJhbGFuY2U6IDAsCiAgICAgICAgdmFsaWQ6IHRydWUsCiAgICAgICAgbG9nZ2VkVXNlcjogewogICAgICAgICAgICBpZDogY29va2llLmNyZWF0b3IsCiAgICAgICAgICAgIG5hbWU6IGNvb2tpZS5lbWFpbCwKICAgICAgICB9LAogICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnN1YnN0cigwLCAxMCksCiAgICAgICAgdGVtcGxhdGVzOiBbCiAgICAgICAgICAgIHt0aXRsZTogIlB1cmNoYXNlIERlcG9zaXQiLCB2YWx1ZTogIlB1cmNoYXNlIERlcG9zaXQifSwKICAgICAgICBdLAogICAgICAgIGlzSGlkZUJhcjogZmFsc2UsCiAgICAgICAgUGF5bWVudE9wdGlvbkVkaXRvcjogUGF5bWVudE9wdGlvbkVkaXRvciwKICAgICAgICByZWZGcm9tOiBbXSwKICAgICAgICByZWZUbzogW10sCiAgICB9KSwKICAgIG1ldGhvZHM6IHsKICAgICAgICBvblBPQ2hhbmdlZCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMucHVyY2hhc2VEZXBvc2l0KSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5wdXJjaGFzZURlcG9zaXQucHVyY2hhc2VPcmRlcikgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNhbGVPcmRlciA9IHRoaXMucHVyY2hhc2VEZXBvc2l0LnB1cmNoYXNlT3JkZXIgfHwge307CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VnbWVudCA9IHNhbGVPcmRlci5zZWdtZW50IHx8IHt9OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvY2F0aW9uID0gc2FsZU9yZGVyLmxvY2F0aW9uIHx8IHt9OwogICAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2VEZXBvc2l0LnNlZ21lbnQgPSBzZWdtZW50OwogICAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2VEZXBvc2l0LmxvY2F0aW9uID0gbG9jYXRpb247CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWZGcm9tLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICBpZDogc2FsZU9yZGVyLmlkIHx8ICcnLAogICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2U6IHNhbGVPcmRlci5udW1iZXIgfHwgJycKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZURlcG9zaXQucmVmRnJvbSA9IHRoaXMucmVmRnJvbQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBIZWxwKGtleV9zZWFyY2gpIHsKICAgICAgICAgICAgU2hvd1Jlc291cmNlKGtleV9zZWFyY2gpOwogICAgICAgIH0sCiAgICAgICAgc2F2ZU5ldygpIHsKICAgICAgICB9LAogICAgICAgIHJlbW92ZVJvdyhlKSB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgY29uc3QgZ3JpZCA9IGtlbmRvLmpRdWVyeSgiI2dyaWRQdXJjaGFzZURlcG9zaXQiKS5kYXRhKCJrZW5kb0dyaWQiKSwKICAgICAgICAgICAgICAgIGRhdGFTb3VyY2UgPSBncmlkLmRhdGFTb3VyY2UsCiAgICAgICAgICAgICAgICBkYXRhSXRlbSA9IGdyaWQuZGF0YUl0ZW0oJChlLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoInRyIikpOwoKICAgICAgICAgICAgaWYgKGRhdGFTb3VyY2UudG90YWwoKSA+IDEpIHsKICAgICAgICAgICAgICAgIGRhdGFTb3VyY2UucmVtb3ZlKGRhdGFJdGVtKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbnVtYmVyRm9ybWF0KG9iaiwgdHlwZSkgewogICAgICAgICAgICBpZiAob2JqKSB7CiAgICAgICAgICAgICAgICAvLyB0aGlzLnB1cmNoYXNlRGVwb3NpdC5sb2NhdGlvbiA9IG9iai5oYXNPd25Qcm9wZXJ0eSgnbG9jYXRpb24nKSA/IG9iai5sb2NhdGlvbiA6IHt9CiAgICAgICAgICAgICAgICAvLyB0aGlzLnB1cmNoYXNlRGVwb3NpdC5zZWdtZW50ID0gb2JqLmhhc093blByb3BlcnR5KCdzZWdtZW50JykgPyBvYmouc2VnbWVudCA6IHt9CiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gImFtb3VudCIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IG9iai5oYXNPd25Qcm9wZXJ0eSgiYW1vdW50IikgPyBvYmouYW1vdW50IDogMDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkZWNpbWFsRm9ybWF0ID0gb2JqLmhhc093blByb3BlcnR5KCJkZWNpbWFsRm9ybWF0IikKICAgICAgICAgICAgICAgICAgICAgICAgPyBvYmouZGVjaW1hbEZvcm1hdAogICAgICAgICAgICAgICAgICAgICAgICA6IGBuMmA7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGtlbmRvLnRvU3RyaW5nKHBhcnNlRmxvYXQodmFsdWUpLCBkZWNpbWFsRm9ybWF0KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gImN1cnJlbmN5IikgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbmN5ID0gb2JqLmhhc093blByb3BlcnR5KCJjdXJyZW5jeSIpID8gb2JqLmN1cnJlbmN5IDogIiI7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbmN5LmNvZGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICItIjsKICAgICAgICB9LAogICAgICAgIGFtb3VudEZvcm1hdCh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcocGFyc2VGbG9hdCh2YWx1ZSksIGAke3RoaXMuZGVjaW1hbEZvcm1hdH1gKTsKICAgICAgICB9LAogICAgICAgIGdlbmVyYXRlTnVtYmVyKCkgewogICAgICAgICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0cmFuRGF0ZSA9IG5ldyBEYXRlKHRoaXMudHJhbnNhY3Rpb25EYXRlKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlSW52b2ljZSA9IG5ldyBEYXRlKHRoaXMucHVyY2hhc2VEZXBvc2l0LnRyYW5zYWN0aW9uRGF0ZSk7CiAgICAgICAgICAgICAgICBjb25zdCB0cmFuRGF0ZU0gPSB0cmFuRGF0ZS5nZXRGdWxsWWVhcigpICsgdHJhbkRhdGUuZ2V0TW9udGgoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlSW52b2ljZU0gPQogICAgICAgICAgICAgICAgICAgIHRyYW5EYXRlSW52b2ljZS5nZXRGdWxsWWVhcigpICsgdHJhbkRhdGVJbnZvaWNlLmdldE1vbnRoKCk7CiAgICAgICAgICAgICAgICBpZiAodHJhbkRhdGVNID09PSB0cmFuRGF0ZUludm9pY2VNKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZURlcG9zaXQucmVmZXJlbmNlTm8gPSB0aGlzLnJlZmVyZW5jZU5vOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMudHJhbnNhY3Rpb25EYXRlICE9PSAiIiAmJiB0aGlzLnRyYW5zYWN0aW9uVHlwZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgbGV0IGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgYWJicjogdGhpcy5wdXJjaGFzZURlcG9zaXQudHJhbnNhY3Rpb25UeXBlLmFiYnIsCiAgICAgICAgICAgICAgICAgICAgc3RydWN0dXJlOiB0aGlzLnB1cmNoYXNlRGVwb3NpdC50cmFuc2FjdGlvblR5cGUuc3RydWN0dXJlLAogICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogdGhpcy50cmFuc2FjdGlvbkRhdGUsCiAgICAgICAgICAgICAgICAgICAgc2VxdWNlbmNpbmc6IHRoaXMucHVyY2hhc2VEZXBvc2l0LnRyYW5zYWN0aW9uVHlwZS5zZXF1Y2VuY2luZywKICAgICAgICAgICAgICAgICAgICBwcmVmaXhTZXBhcmF0b3I6IHRoaXMucHVyY2hhc2VEZXBvc2l0LnRyYW5zYWN0aW9uVHlwZS5wcmVmaXhTZXBhcmF0b3IgfHwgJycsCiAgICAgICAgICAgICAgICAgICAgbnVtYmVyU2VwYXJhdG9yOiB0aGlzLnB1cmNoYXNlRGVwb3NpdC50cmFuc2FjdGlvblR5cGUubnVtYmVyU2VwYXJhdG9yIHx8ICcnLAogICAgICAgICAgICAgICAgICAgIGZvcm1hdDogdGhpcy5wdXJjaGFzZURlcG9zaXQudHJhbnNhY3Rpb25UeXBlLmZvcm1hdCB8fCA1LAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJQdXJjaGFzZSBEZXBvc2l0IiwKICAgICAgICAgICAgICAgICAgICBlbnRpdHk6IDEsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgYmlsbGluZ0hhbmRsZXIKICAgICAgICAgICAgICAgICAgICAubGFzdE51bWJlcihkYXRhKQogICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhc3ROdW1iZXIgPSB0aGlzLnplcm9QYWQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VJbnQocmVzLmxhc3ROdW1iZXIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2VEZXBvc2l0LnRyYW5zYWN0aW9uVHlwZS5mb3JtYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlRGVwb3NpdC5udW1iZXIgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5zdWZmaXggKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2VEZXBvc2l0LnRyYW5zYWN0aW9uVHlwZS5udW1iZXJTZXBhcmF0b3IgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3ROdW1iZXI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9ycy5wdXNoKGUpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICB6ZXJvUGFkKG51bSwgcGxhY2VzKSB7CiAgICAgICAgICAgIHJldHVybiBTdHJpbmcobnVtKS5wYWRTdGFydChwbGFjZXMsICIwIik7CiAgICAgICAgfSwKICAgICAgICBzdWZmaXgodHJhbnNhY3Rpb25EYXRlKSB7CiAgICAgICAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyhuZXcgRGF0ZSh0cmFuc2FjdGlvbkRhdGUpLCBgeXltbWApOwogICAgICAgIH0sCiAgICAgICAgZXJyb3JNZXNzYWdlKCkgewogICAgICAgIH0sCiAgICAgICAgYWNjb3VudERyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IG5hbWU9IicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgICAgICAgICAgICBhdXRvQmluZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiAic3RhcnRzd2l0aCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogIm5hbWUiLAogICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZUZpZWxkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAiPHNwYW4+Iz1udW1iZXIjIC0gIz0gbmFtZSM8L3NwYW4+IiwKICAgICAgICAgICAgICAgICAgICBvcHRpb25MYWJlbDogIi0tU2VsZWN0LS0iLAogICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IG5ldyBrZW5kby5kYXRhLkRhdGFTb3VyY2UoewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLmFjY0Nhc2gsCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIG1ldGhvZERyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IG5hbWU9IicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgICAgICAgICAgICBhdXRvQmluZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiAic3RhcnRzd2l0aCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogIm5hbWUiLAogICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZUZpZWxkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAiPHNwYW4+Iz1jb2RlIyAtICM9IG5hbWUjPC9zcGFuPiIsCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6ICItLVNlbGVjdC0tIiwKICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlOiBuZXcga2VuZG8uZGF0YS5EYXRhU291cmNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogdGhpcy5wYXltZW50TWV0aG9kLAogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhY2NvdW50VGVtcGxhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3QgYWNjID0gZGF0YUl0ZW0uYWNjb3VudDsKICAgICAgICAgICAgaWYgKGFjYykgewogICAgICAgICAgICAgICAgcmV0dXJuIGA8c3Bhbj4ke2FjYy5uYW1lID8gYWNjLm5hbWUgOiBgYH08L3NwYW4+YDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBgYDsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbWV0aG9kVGVtcGxhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3QgbWV0aG9kID0gZGF0YUl0ZW0ucGF5bWVudE9wdGlvbiB8fCAnJwogICAgICAgICAgICBpZiAobWV0aG9kKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYDxzcGFuPiR7bWV0aG9kLmJhbmtBY2NvdW50TmFtZSB8fCBgYH08L3NwYW4+YDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBgYDsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYW1vdW50VGVtcGxhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3QgYW10ID0gZGF0YUl0ZW0uYW1vdW50OwogICAgICAgICAgICBpZiAoYW10KSB7CiAgICAgICAgICAgICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcocGFyc2VGbG9hdChhbXQpLCBgJHt0aGlzLmRlY2ltYWxGb3JtYXR9YCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYW1vdW50RWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IGRhdGEtYmluZD0idmFsdWU6JyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgICAgICAua2VuZG9OdW1lcmljVGV4dEJveCh7CiAgICAgICAgICAgICAgICAgICAgZGVjaW1hbHM6IDMwLAogICAgICAgICAgICAgICAgICAgIGZvcm1hdDogYCR7dGhpcy5kZWNpbWFsRm9ybWF0fWAsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGNhbmNlbCgpIHsKICAgICAgICAgICAgdGhpcy4kc3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogaTE4bi50KCJtc2dfdGl0bGVfd2FybmluZyIpLAogICAgICAgICAgICAgICAgdGV4dDogaTE4bi50KCJtc2dfZGlzY2FyZCIpLAogICAgICAgICAgICAgICAgaWNvbjogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IGkxOG4udCgiY2FuY2VsIiksCiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjNGQ0ODQ4IiwKICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI0VEMUEzQSIsCiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogaTE4bi50KCJkaXNjYXJkIiksCiAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIuZ28oLTEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGNsZWFyKCkgewogICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuc3VwcGxpZXIgPSB7fQogICAgICAgICAgICB0aGlzLnB1cmNoYXNlT3JkZXJzID0gW10KICAgICAgICAgICAgY29uc3Qgc2VnbWVudCA9IHRoaXMucHVyY2hhc2VEZXBvc2l0LnNlZ21lbnQgfHwge30KICAgICAgICAgICAgY29uc3QgbG9jYXRpb24gPSB0aGlzLnB1cmNoYXNlRGVwb3NpdC5sb2NhdGlvbiB8fCB7fQogICAgICAgICAgICB0aGlzLmdlbmVyYXRlTnVtYmVyKCkKICAgICAgICAgICAgY29uc3QgdHhuVHlwZSA9IHRoaXMucHVyY2hhc2VEZXBvc2l0LnRyYW5zYWN0aW9uVHlwZTsKICAgICAgICAgICAgdGhpcy5wdXJjaGFzZURlcG9zaXQgPSBuZXcgUHVyY2hhc2VEZXBvc2l0TW9kZWwoe30pOwogICAgICAgICAgICB0aGlzLnB1cmNoYXNlRGVwb3NpdC50cmFuc2FjdGlvblR5cGUgPSB0eG5UeXBlOwogICAgICAgICAgICB0aGlzLnB1cmNoYXNlRGVwb3NpdC5zZWdtZW50ID0gc2VnbWVudAogICAgICAgICAgICB0aGlzLnB1cmNoYXNlRGVwb3NpdC5sb2NhdGlvbiA9IGxvY2F0aW9uCiAgICAgICAgICAgIC8vIHRoaXMuZGVwb3NpdExpbmUgPSBbXTsKICAgICAgICAgICAgbGV0IGxpbmVzID0gdGhpcy4kcmVmcy5wdXJjaGFzZURlcG9zaXREUy5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICBsaW5lcy5kYXRhKFtdKTsKICAgICAgICAgICAgdGhpcy5hZGRSb3coKTsKICAgICAgICB9LAogICAgICAgIGNsb3NlKCkgewogICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5nbygtMSk7CiAgICAgICAgfSwKICAgICAgICBoaWRlU21hbGxTaXRlQmFyKCkgewogICAgICAgICAgICB0aGlzLmlzSGlkZUJhciA9ICF0aGlzLmlzSGlkZUJhcjsKICAgICAgICB9LAogICAgICAgIG9uRmlsdGVyQ2hhbmdlKGV2ZW50KSB7CiAgICAgICAgICAgIGNvbnN0IGZpbHRlciA9IGV2ZW50LmZpbHRlci52YWx1ZTsKICAgICAgICAgICAgdGhpcy5yZXF1ZXN0RGF0YSgwLCBmaWx0ZXIsIHRoaXMuY3VzQmFzZVVybCk7CiAgICAgICAgICAgIHRoaXMuZmlsdGVyID0gZmlsdGVyOwogICAgICAgIH0sCiAgICAgICAgcmVxdWVzdERhdGEoc2tpcCwgZmlsdGVyLCBiYXNlVXJsKSB7CiAgICAgICAgICAgIGNvbnN0IHVybCA9IGJhc2VVcmwgKyBgP2ZpbHRlcj0ke2ZpbHRlcn1gOwogICAgICAgICAgICBmZXRjaCh1cmwpCiAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC50aGVuKHRoaXMuYWZ0ZXJGZXRjaCk7CiAgICAgICAgfSwKICAgICAgICBhZnRlckZldGNoKGpzb24pIHsKICAgICAgICAgICAgdGhpcy5zdXBwbGllckxpc3QgPSBqc29uLmRhdGE7CiAgICAgICAgfSwKICAgICAgICBvbkNoYW5nZShldmVudCkgewogICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGV2ZW50LnZhbHVlOwogICAgICAgICAgICBpZiAodmFsdWUgJiYgdmFsdWVbIm51bWJlck5hbWUiXSA9PT0gZW1wdHlJdGVtWyJudW1iZXJOYW1lIl0pIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnN1cHBsaWVyID0gdmFsdWU7CiAgICAgICAgICAgIGlmICh2YWx1ZS5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgaWYgKHZhbHVlLmlkICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWNpbWFsRm9ybWF0ID0gdGhpcy5zdXBwbGllci5kZWNpbWFsRm9ybWF0OwogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5oYXNPd25Qcm9wZXJ0eSgiYmFzZUN1cnJlbmN5IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmJhc2VDdXJyZW5jeS5oYXNPd25Qcm9wZXJ0eSgiY29kZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbmN5Q29kZSA9ICIgIiArIHZhbHVlLmJhc2VDdXJyZW5jeS5jb2RlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2VEZXBvc2l0LnB1cmNoYXNlRGVwb3NpdEFjYyA9IHZhbHVlLmhhc093blByb3BlcnR5KAogICAgICAgICAgICAgICAgICAgICAgICAicHVyY2hhc2VEZXBvc2l0QWNjIgogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgPyB2YWx1ZS5wdXJjaGFzZURlcG9zaXRBY2MKICAgICAgICAgICAgICAgICAgICAgICAgOiB7fTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRQdXJjaGFzZU9yZGVycygpOwogICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZEN1c3RvbWVyQmFsYW5jZSh2YWx1ZS5pZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRMb2NhdGlvbigpIHsKICAgICAgICAgICAgdGhpcy5sb2NhdGlvbnMgPSBbXQogICAgICAgICAgICBjb25zdCByb2xlVHlwZSA9IGRhdGFTdG9yZS5yb2xlVHlwZSB8fCAwCiAgICAgICAgICAgIGlmIChyb2xlVHlwZSA9PT0gMCkgewogICAgICAgICAgICAgICAgaWYgKGRhdGFTdG9yZS5yb2xlRGF0YSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvbGVEYXRhID0gZGF0YVN0b3JlLnJvbGVEYXRhIHx8IFtdCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9jYXRpb24gPSByb2xlRGF0YS5maWx0ZXIoaXRtID0+IGl0bS50eXBlID09PSAnbG9jYXRpb24nKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvY2F0aW9uRGVmYXVsdCA9IGxvY2F0aW9uLmZpbHRlcihtID0+IG0uaXNEZWZhdWx0ID09PSAxKQogICAgICAgICAgICAgICAgICAgIHRoaXMubG9jYXRpb25zID0gbG9jYXRpb24KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkID09PSB1bmRlZmluZWQgfHwgdGhpcy4kcm91dGUucGFyYW1zLmlkID09PSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9jYXRpb25EZWZhdWx0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2VEZXBvc2l0LmxvY2F0aW9uID0gbG9jYXRpb25EZWZhdWx0WzBdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHJvbGVUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvY2F0aW9ucyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbkhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5saXN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2NhdGlvbnMgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiAodGhpcy5sb2NhdGlvbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgdGhpcy5wdXJjaGFzZURlcG9zaXQubG9jYXRpb24gPSB0aGlzLmxvY2F0aW9uc1swXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkU2VnbWVudCgpIHsKICAgICAgICAgICAgdGhpcy5zZWdtZW50cyA9IFtdCiAgICAgICAgICAgIGNvbnN0IHJvbGVUeXBlID0gZGF0YVN0b3JlLnJvbGVUeXBlIHx8IDAKICAgICAgICAgICAgaWYgKHJvbGVUeXBlID09PSAwKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YVN0b3JlLnJvbGVEYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm9sZURhdGEgPSBkYXRhU3RvcmUucm9sZURhdGEgfHwgW10KICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWdtZW50ID0gcm9sZURhdGEuZmlsdGVyKGl0bSA9PiBpdG0udHlwZSA9PT0gJ3NlZ21lbnQnKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlZ21lbnREZWZhdWx0ID0gc2VnbWVudC5maWx0ZXIobSA9PiBtLmlzRGVmYXVsdCA9PT0gMSkKICAgICAgICAgICAgICAgICAgICB0aGlzLnNlZ21lbnRzID0gc2VnbWVudAogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09IHVuZGVmaW5lZCB8fCB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWdtZW50RGVmYXVsdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlRGVwb3NpdC5zZWdtZW50ID0gc2VnbWVudERlZmF1bHRbMF07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAocm9sZVR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VnbWVudHMgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NIYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0U2VnKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWdtZW50cyA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRQcmVmaXgoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIHByZWZpeEhhbmRsZXIuZ2V0KCJwdXJjaGFzZSBkZXBvc2l0IikudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb25UeXBlcyA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50cmFuc2FjdGlvblR5cGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlRGVwb3NpdC50cmFuc2FjdGlvblR5cGUgPSB0aGlzLnRyYW5zYWN0aW9uVHlwZXNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVOdW1iZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkQWNjb3VudCgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgYWNjb3VudEhhbmRsZXIuZ2V0QWxsKCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY2NTdXBwbGllckRlcG9zaXQgPSByZXMuZGF0YQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcigobSkgPT4gbS5hY2NvdW50X3R5cGUubnVtYmVyID09PSA5KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCgoaXRlbSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBpdGVtLnV1aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQ6IGl0ZW0udXVpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogaXRlbS5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9uYW1lOiBpdGVtLmxvY2FsX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlcjogaXRlbS5udW1iZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX3RheGFibGU6IGl0ZW0uaXNfdGF4YWJsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFuaGppQWNjQ29kZTogaXRlbS5iYW5oamlBY2NDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cF9jb2RlOiBpdGVtLmdyb3VwX2NvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudF9hY2NvdW50OiBpdGVtLnBhcmVudF9hY2NvdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlX2NvZGU6IGl0ZW0udHlwZV9jb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50X3R5cGU6IGl0ZW0uYWNjb3VudF90eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY2NDYXNoID0gcmVzLmRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoKG0pID0+IG0uYWNjb3VudF90eXBlLm51bWJlciA8PSA1KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCgoaXRlbSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBpdGVtLnV1aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQ6IGl0ZW0udXVpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogaXRlbS5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9uYW1lOiBpdGVtLmxvY2FsX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlcjogaXRlbS5udW1iZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX3RheGFibGU6IGl0ZW0uaXNfdGF4YWJsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFuaGppQWNjQ29kZTogaXRlbS5iYW5oamlBY2NDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cF9jb2RlOiBpdGVtLmdyb3VwX2NvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudF9hY2NvdW50OiBpdGVtLnBhcmVudF9hY2NvdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlX2NvZGU6IGl0ZW0udHlwZV9jb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50X3R5cGU6IGl0ZW0uYWNjb3VudF90eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYWNjU3VwcGxpZXJEZXBvc2l0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2VEZXBvc2l0LmFjY1JlY2VpdmFibGUgPSB0aGlzLmFjY1N1cHBsaWVyRGVwb3NpdFswXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRQdXJjaGFzZU9yZGVycygpIHsKICAgICAgICAgICAgaWYgKHRoaXMuc3VwcGxpZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZU9yZGVycyA9IFtdOwogICAgICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICJieV9zdXBwbGllciIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdXBwbGllcjogdGhpcy5zdXBwbGllci5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJQdXJjaGFzZSBPcmRlciIsCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIHNhbGVPcmRlckhhbmRsZXIuc2VhcmNoKGRhdGEpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZm9yRWFjaCgobSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvRGF0YSA9IG0udHhuRGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlT3JkZXJzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogbS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBtLnRvdGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IG0ubnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogcG9EYXRhLmN1cnJlbmN5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWNpbWFsRm9ybWF0OiBtLmRlY2ltYWxGb3JtYXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBwb0RhdGEubG9jYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnQ6IHBvRGF0YS5zZWdtZW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2codGhpcy5wdXJjaGFzZU9yZGVycywncHVyY2hhc2UnKQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcm93TnVtYmVyVG1wbChkYXRhSXRlbSkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLnB1cmNoYXNlRGVwb3NpdERTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICBpbmRleCA9IGRzLmluZGV4T2YoZGF0YUl0ZW0pOwogICAgICAgICAgICByZXR1cm4gaW5kZXggKyAxOwogICAgICAgIH0sCiAgICAgICAgYWRkUm93KCkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLnB1cmNoYXNlRGVwb3NpdERTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICB0b3RhbCA9IGRzLnRvdGFsKCk7CiAgICAgICAgICAgIHRoaXMuaXRlbUxpbmUuaWQgPSBpdGVtTGluZVByZWZpeCArIHV1aWQudjEoKTsKICAgICAgICAgICAgdGhpcy5pdGVtTGluZS5kZWNpbWFsRm9ybWF0ID0gdGhpcy5kZWNpbWFsRm9ybWF0OwogICAgICAgICAgICB0aGlzLml0ZW1MaW5lLm9wdGlvblR5cGUgPSBPUFRJT05fVFlQRTsKICAgICAgICAgICAgZHMuaW5zZXJ0KHRvdGFsLCB0aGlzLml0ZW1MaW5lKTsKICAgICAgICAgICAgLy8gdGhpcy5pdGVtTGluZXMucHVzaCh0aGlzLml0ZW1MaW5lKQogICAgICAgICAgICAvLyB0aGlzLml0ZW1MaW5lcy5wdXNoKHRoaXMuaXRlbUxpbmUpYQogICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coJ2l0ZW0gTGluZScsIHRoaXMuaXRlbUxpbmUpCiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkUGF5bWVudE9wdGlvbigpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXltZW50TWV0aG9kID0gW107CiAgICAgICAgICAgICAgICAgICAgcGF5bWVudE9wdGlvbkhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgLmxpc3Qoc3RyRmlsdGVyKQogICAgICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGF5bWVudE1ldGhvZCA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaCgpOwogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkQ3VycmVuY3lEYXRhKCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgLmxpc3QoImZ1bi1jIikKICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbmN5TGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5maWx0ZXIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChvKSA9PiBvLnVzZWQgPT09IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKTsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFRyYW5zYWN0aW9uUmF0ZSgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHRoaXMudHJhbnNhY3Rpb25EYXRlKQogICAgICAgICAgICAgICAgICAgICAgICAudG9JU09TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgICAgICAuc3Vic3RyKDAsIDEwKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW5jeSA9IHRoaXMucHVyY2hhc2VEZXBvc2l0LmN1cnJlbmN5OwogICAgICAgICAgICAgICAgICAgIGxldCBjb2RlID0gIiI7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbmN5Lmhhc093blByb3BlcnR5KCJjb2RlIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZSA9IGN1cnJlbmN5LmNvZGU7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoY29kZSAhPT0gdW5kZWZpbmVkIHx8IGNvZGUgIT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRMYXN0RXhjaGFuZ2VSYXRlQnlEYXRlKGRhdGUsIGNvZGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gcmVzLmRhdGEuZGF0YVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZURlcG9zaXQuZXhjaGFuZ2VSYXRlID0gcmVzcG9uc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2VEZXBvc2l0LnR4blJhdGUgPSByZXNwb25zZS5yYXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGF1dG9DYWxjdWxhdGUoKSB7CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMucHVyY2hhc2VEZXBvc2l0RFMua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIGNvbnZlcnRlZEFtb3VudCA9IDAsCiAgICAgICAgICAgICAgICBhbW91bnQgPSAwOwogICAgICAgICAgICBkcy5kYXRhKCkuZm9yRWFjaCgodmFsdWUpID0+IHsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5hbW91bnQpIHsKICAgICAgICAgICAgICAgICAgICBhbW91bnQgKz0ga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5hbW91bnQpOwogICAgICAgICAgICAgICAgICAgIGNvbnZlcnRlZEFtb3VudCArPQogICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmFtb3VudCkgKiB0aGlzLnB1cmNoYXNlRGVwb3NpdC50eG5SYXRlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKGFtb3VudCwgImFtb3VudCIpOwogICAgICAgICAgICB0aGlzLnB1cmNoYXNlRGVwb3NpdC5leGNoYW5nZUFtb3VudCA9IGNvbnZlcnRlZEFtb3VudDsKICAgICAgICAgICAgdGhpcy5wdXJjaGFzZURlcG9zaXQuYW1vdW50ID0gYW1vdW50OwogICAgICAgIH0sCiAgICAgICAgZGF0YVNvdXJjZUNoYW5nZWQoZSkgewogICAgICAgICAgICBpZiAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgbGV0IGRhdGFSb3cgPSBlLml0ZW1zWzBdLCBwT3B0aW9uID0ge30KICAgICAgICAgICAgICAgIHN3aXRjaCAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgInBheW1lbnRPcHRpb24iOgogICAgICAgICAgICAgICAgICAgICAgICBwT3B0aW9uID0gZGF0YVJvdy5wYXltZW50T3B0aW9uIHx8IHt9CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJhY2NvdW50IiwgcE9wdGlvbi5hY2NvdW50IHx8IHt9KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhc3luYyBvblNhdmVDbG9zZShmbGFnKSB7CiAgICAgICAgICAgIGlmICghdGhpcy4kcmVmcy5mb3JtLnZhbGlkYXRlKCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuJHJlZnMuZm9ybS52YWxpZGF0ZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCBpZCA9ICIiOwogICAgICAgICAgICBpZiAodGhpcy5zdXBwbGllci5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgaWQgPSB0aGlzLnN1cHBsaWVyLmlkIHx8ICIiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpZCA9PT0gIiIpIHsKICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoInN1cHBsaWVyIGlzIHJlcXVpcmUiKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLnB1cmNoYXNlRGVwb3NpdERTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgIGxldCBkMSA9IGRzLmRhdGEoKTsKICAgICAgICAgICAgbGV0IGRhdGFWYWxpZGF0ZSA9IDA7CiAgICAgICAgICAgIGQxLmZvckVhY2goKHZhbHVlLCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKDEsIHZhbHVlKTsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICB2YWx1ZS5hY2NvdW50ID09IHVuZGVmaW5lZCB8fAogICAgICAgICAgICAgICAgICAgIHZhbHVlLmFjY291bnQuaWQgPT0gdW5kZWZpbmVkIHx8CiAgICAgICAgICAgICAgICAgICAgdmFsdWUuYWNjb3VudC5pZCA9PSBudWxsCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LmVycm9yKCJQbGVhc2UgY2hlY2sgQWNjb3VudCAgb24gcm93ICIgKyAoaW5kZXggKyAxKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGRhdGFWYWxpZGF0ZSArPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKGQxLmxlbmd0aCA9PSBkYXRhVmFsaWRhdGUpIHsKICAgICAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpdGVtTGluZURTID0gdGhpcy4kcmVmcy5wdXJjaGFzZURlcG9zaXREUy5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhUm93ID0gaXRlbUxpbmVEUy5kYXRhKCkuZmlsdGVyKChuKSA9PiBuLmFtb3VudCA+IDApLm1hcChtID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSXRlbUxpbmVNb2RlbChtKQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKDEsIGRhdGFSb3cpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVJvdy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgaXNBdXRvR2VuZXJhdGUgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlID0gbmV3IERhdGUodGhpcy50cmFuc2FjdGlvbkRhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlUmVjZWlwdCA9IG5ldyBEYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlRGVwb3NpdC50cmFuc2FjdGlvbkRhdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlTSA9IHRyYW5EYXRlLmdldEZ1bGxZZWFyKCkgKyB0cmFuRGF0ZS5nZXRNb250aCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlUmVjZWlwdE0gPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuRGF0ZVJlY2VpcHQuZ2V0RnVsbFllYXIoKSArIHRyYW5EYXRlUmVjZWlwdC5nZXRNb250aCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmFuRGF0ZU0gPT09IHRyYW5EYXRlUmVjZWlwdE0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNBdXRvR2VuZXJhdGUgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB0aGlzLnB1cmNoYXNlRGVwb3NpdC5pZCA/IHRoaXMucHVyY2hhc2VEZXBvc2l0LmlkIDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIlB1cmNoYXNlIERlcG9zaXQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQ6IHRoaXMucHVyY2hhc2VEZXBvc2l0LnV1aWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyB0aGlzLnB1cmNoYXNlRGVwb3NpdC51dWlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgam91cm5hbF91dWlkOiB0aGlzLnB1cmNoYXNlRGVwb3NpdC5qb3VybmFsX3V1aWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyB0aGlzLnB1cmNoYXNlRGVwb3NpdC5qb3VybmFsX3V1aWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IHRoaXMucHVyY2hhc2VEZXBvc2l0Lm51bWJlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYmJyOiB0aGlzLnB1cmNoYXNlRGVwb3NpdC50cmFuc2FjdGlvblR5cGUuYWJiciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbkRhdGU6IHRoaXMudHJhbnNhY3Rpb25EYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uRGF0ZVRaOiBIZWxwZXIudG9JU09EYXRlKHRoaXMudHJhbnNhY3Rpb25EYXRlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdXBwbGllcjogdGhpcy5zdXBwbGllciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvblR5cGU6IHRoaXMucHVyY2hhc2VEZXBvc2l0LnRyYW5zYWN0aW9uVHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtTGluZTogZGF0YVJvdywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbk5vdGU6IHRoaXMucHVyY2hhc2VEZXBvc2l0LnRyYW5zYWN0aW9uTm90ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb3VybmFsTm90ZTogdGhpcy5wdXJjaGFzZURlcG9zaXQuam91cm5hbE5vdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlTm86IHRoaXMucHVyY2hhc2VEZXBvc2l0LnJlZmVyZW5jZU5vLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogdGhpcy5wdXJjaGFzZURlcG9zaXQuYW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiB0aGlzLnB1cmNoYXNlRGVwb3NpdC5jdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogdGhpcy5wdXJjaGFzZURlcG9zaXQuZXhjaGFuZ2VBbW91bnQsIC8vIGFtb3VudCB0byBiYXNlIGN1cnJlbmN5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHhuUmF0ZTogdGhpcy5wdXJjaGFzZURlcG9zaXQudHhuUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXJjaGFzZURlcG9zaXRBY2M6IHRoaXMucHVyY2hhc2VEZXBvc2l0LnB1cmNoYXNlRGVwb3NpdEFjYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZVJhdGU6IHRoaXMucHVyY2hhc2VEZXBvc2l0LmV4Y2hhbmdlUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50OiB0aGlzLnB1cmNoYXNlRGVwb3NpdC5zZWdtZW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiB0aGlzLnB1cmNoYXNlRGVwb3NpdC5sb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXJjaGFzZU9yZGVyOiB0aGlzLnB1cmNoYXNlRGVwb3NpdC5wdXJjaGFzZU9yZGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHByb3ZlZEJ5OiB0aGlzLnB1cmNoYXNlRGVwb3NpdC5hcHByb3ZlZEJ5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdGVkQnk6IHRoaXMucHVyY2hhc2VEZXBvc2l0LnJlamVjdGVkQnksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybVRlbXBsYXRlOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IHRoaXMucHVyY2hhc2VEZXBvc2l0LmNyZWF0ZWRBdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZWRVc2VyOiB0aGlzLmxvZ2dlZFVzZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmRnJvbTogdGhpcy5wdXJjaGFzZURlcG9zaXQucmVmRnJvbSB8fCBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZUbzogdGhpcy5wdXJjaGFzZURlcG9zaXQucmVmVG8gfHwgW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNBdXRvR2VuZXJhdGU6IGlzQXV0b0dlbmVyYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvblR5cGU6IHRoaXMuJHJvdXRlLnBhcmFtcy5pZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHRoaXMuJHJvdXRlLnF1ZXJ5LnR5cGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAibmV3IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZygnZGF0YScsIEpTT04uc3RyaW5naWZ5KGRhdGEpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmlsbGluZ0hhbmRsZXIuY3JlYXRlUHVyY2hhc2VEZXBvc2l0KGRhdGEpLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5zdWNjZXNzKCJTdWNjZXNzZnVsbHkiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZsYWcgPT09ICJjbG9zZSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmbGFnID09PSAibmV3IikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcigiU29tZXRoaW5nIHdlbnQgd3JvbmciKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9ycy5wdXNoKGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZEN1c3RvbWVyQmFsYW5jZShpZCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJGaWx0ZXIgPSBpZCArICI/dHlwZT1kZXAiOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZGVwb3NpdEJhbGFuY2UgPSAwOwogICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuY3VycmVuY3lDb2RlID0gJycKICAgICAgICAgICAgICAgICAgICBiaWxsaW5nSGFuZGxlcgogICAgICAgICAgICAgICAgICAgICAgICAuYmFsYW5jZShzdHJGaWx0ZXIpCiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGVwb3NpdEJhbGFuY2UgPSBkYXRhWzBdLmJhbGFuY2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVuY3lDb2RlID0gIiAiICsgZGF0YVswXS5jdXJyZW5jeTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaCgpOwogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkVmlld0RlcG9zaXQoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0ckZpbHRlciA9ICI/aWQ9IiArIHRoaXMuJHJvdXRlLnBhcmFtcy5pZDsKICAgICAgICAgICAgICAgICAgICAgICAgYmlsbGluZ0hhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5wdXJjaGFzZURlcG9zaXRMaXN0KHN0ckZpbHRlcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2VEZXBvc2l0ID0gcmVzLmRhdGEuZGF0YVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkUHVyY2hhc2VPcmRlcnMoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGVjaW1hbEZvcm1hdCA9IHRoaXMucHVyY2hhc2VEZXBvc2l0LmRlY2ltYWxGb3JtYXQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGVwb3NpdExpbmUgPSB0aGlzLnB1cmNoYXNlRGVwb3NpdC5pdGVtTGluZXM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3VwcGxpZXIgPSB0aGlzLnB1cmNoYXNlRGVwb3NpdC5zdXBwbGllcjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkQ3VzdG9tZXJCYWxhbmNlKHRoaXMuc3VwcGxpZXIuaWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uRGF0ZSA9IHRoaXMucHVyY2hhc2VEZXBvc2l0LnRyYW5zYWN0aW9uRGF0ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMub25DaGFuZ2UodGhpcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5udW1iZXJGb3JtYXQodGhpcy5zYWxlRGVwb3NpdC5wdXJjaGFzZU9yZGVyLCAnYW1vdW50JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5udW1iZXJGb3JtYXQodGhpcy5zYWxlRGVwb3NpdC5wdXJjaGFzZU9yZGVyLCAnY3VycmVuY3knKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLnB1cmNoYXNlT3JkZXJzID0gdGhpcy5zYWxlRGVwb3NpdC5wdXJjaGFzZU9yZGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaCgpOwogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgaW5pdERhdGEoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5sb2FkVmlld0RlcG9zaXQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuYWRkUm93KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHJlbG9hZCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRWaWV3RGVwb3NpdCgpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLmNsZWFyKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0sCiAgICBjcmVhdGVkKCkgewogICAgICAgIHRoaXMubG9hZEFjY291bnQoKTsKICAgICAgICB0aGlzLmxvYWRDdXJyZW5jeURhdGEoKTsKICAgIH0sCiAgICB3YXRjaDogewogICAgICAgIC8vIGlkKCkgewogICAgICAgIC8vICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8gICAgIHRoaXMuY2xlYXIoKTsKICAgICAgICAvLyAgIH0gZWxzZSB7CiAgICAgICAgLy8gICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgIC8vICAgICB0aGlzLmxvYWRWaWV3RGVwb3NpdCgpOwogICAgICAgIC8vICAgfQogICAgICAgIC8vIH0sCiAgICAgICAgJyRyb3V0ZSc6ICdyZWxvYWQnCiAgICB9LAogICAgbW91bnRlZDogYXN5bmMgZnVuY3Rpb24gKCkgewogICAgICAgIGF3YWl0IHRoaXMubG9hZFByZWZpeCgpOwogICAgICAgIGF3YWl0IHRoaXMubG9hZExvY2F0aW9uKCk7CiAgICAgICAgYXdhaXQgdGhpcy5sb2FkU2VnbWVudCgpOwogICAgICAgIGF3YWl0IHRoaXMubG9hZFBheW1lbnRPcHRpb24oKTsKICAgICAgICB0aGlzLnJlcXVlc3REYXRhKDAsIHRoaXMuZmlsdGVyLCB0aGlzLmN1c0Jhc2VVcmwpOwogICAgICAgIGF3YWl0IHRoaXMuaW5pdERhdGEoKTsKICAgIH0sCiAgICBjb21wdXRlZDogewogICAgICAgIGRpc2FibGVNZSgpIHsKICAgICAgICAgICAgcmV0dXJuICEhdGhpcy4kcm91dGUucGFyYW1zLmlkOwogICAgICAgIH0sCiAgICAgICAgYW1vdW50TGluZUhlYWRlclRlbXBsYXRlKCkgewogICAgICAgICAgICBpZiAodGhpcy5wdXJjaGFzZURlcG9zaXQpIHsKICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLnB1cmNoYXNlRGVwb3NpdC5jdXJyZW5jeSkKICAgICAgICAgICAgICAgIGlmICh0aGlzLnB1cmNoYXNlRGVwb3NpdC5oYXNPd25Qcm9wZXJ0eSgiY3VycmVuY3kiKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbmN5ID0gdGhpcy5wdXJjaGFzZURlcG9zaXQuY3VycmVuY3kuaGFzT3duUHJvcGVydHkoImNvZGUiKQogICAgICAgICAgICAgICAgICAgICAgICA/IHRoaXMucHVyY2hhc2VEZXBvc2l0LmN1cnJlbmN5LmNvZGUKICAgICAgICAgICAgICAgICAgICAgICAgOiAiIjsKICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVuY3kpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJBbW91bnQgKCIgKyBjdXJyZW5jeSArICIpIjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIkFtb3VudCI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAiQW1vdW50IjsKICAgICAgICB9LAogICAgICAgIC8vIHNlZ21lbnQoKSB7CiAgICAgICAgLy8gICBpZiAodGhpcy5wdXJjaGFzZURlcG9zaXQpIHsKICAgICAgICAvLyAgICAgaWYgKHRoaXMucHVyY2hhc2VEZXBvc2l0LnB1cmNoYXNlT3JkZXIpIHsKICAgICAgICAvLyAgICAgICBpZiAodGhpcy5wdXJjaGFzZURlcG9zaXQucHVyY2hhc2VPcmRlci5oYXNPd25Qcm9wZXJ0eSgnc2VnbWVudCcpKSB7CiAgICAgICAgLy8gICAgICAgICBpZiAodGhpcy5wdXJjaGFzZURlcG9zaXQucHVyY2hhc2VPcmRlci5oYXNPd25Qcm9wZXJ0eSgnaWQnKSkgewogICAgICAgIC8vICAgICAgICAgICByZXR1cm4gdGhpcy5wdXJjaGFzZURlcG9zaXQucHVyY2hhc2VPcmRlci5zZWdtZW50Lm5hbWUKICAgICAgICAvLyAgICAgICAgIH0KICAgICAgICAvLyAgICAgICB9CiAgICAgICAgLy8gICAgIH0KICAgICAgICAvLyAgIH0KICAgICAgICAvLyAgIHJldHVybiAnJwogICAgICAgIC8vIH0sCiAgICAgICAgLy8gbG9jYXRpb24oKSB7CiAgICAgICAgLy8gICBpZiAodGhpcy5wdXJjaGFzZURlcG9zaXQpIHsKICAgICAgICAvLyAgICAgaWYgKHRoaXMucHVyY2hhc2VEZXBvc2l0LnB1cmNoYXNlT3JkZXIpIHsKICAgICAgICAvLyAgICAgICBpZiAodGhpcy5wdXJjaGFzZURlcG9zaXQucHVyY2hhc2VPcmRlci5oYXNPd25Qcm9wZXJ0eSgnbG9jYXRpb24nKSkgewogICAgICAgIC8vICAgICAgICAgaWYgKHRoaXMucHVyY2hhc2VEZXBvc2l0LnB1cmNoYXNlT3JkZXIubG9jYXRpb24uaGFzT3duUHJvcGVydHkoJ2lkJykpIHsKICAgICAgICAvLyAgICAgICAgICAgcmV0dXJuIHRoaXMucHVyY2hhc2VEZXBvc2l0LnB1cmNoYXNlT3JkZXIubG9jYXRpb24ubmFtZQogICAgICAgIC8vICAgICAgICAgfQogICAgICAgIC8vICAgICAgIH0KICAgICAgICAvLyAgICAgfQogICAgICAgIC8vICAgfQogICAgICAgIC8vICAgcmV0dXJuICcnCiAgICAgICAgLy8gfSwKICAgICAgICB2YWxpZFN1cHBsaWVyKCkgewogICAgICAgICAgICBsZXQgc3VwcGxpZXIgPSB0aGlzLnN1cHBsaWVyOwogICAgICAgICAgICByZXR1cm4gc3VwcGxpZXIuaWQgIT09IHVuZGVmaW5lZCAmJiBzdXBwbGllci5pZCAhPT0gbnVsbDsKICAgICAgICB9LAogICAgICAgIGhpZGRlbkJ1dHRvbigpIHsKICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKfTsK"},{"version":3,"sources":["PurchaseDeposits.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PurchaseDeposits.vue","sourceRoot":"src/views/suppliers","sourcesContent":["<template>\n    <v-app>\n        <v-container>\n            <v-row>\n                <v-col sm=\"12\" cols=\"12\">\n                    <v-card\n                        outlined\n                        dense\n                        class=\"pa-4 no_border rounded-sm\"\n                        color=\"white\"\n                    >\n                        <v-row>\n                            <v-col\n                                class=\"bigSide pr-2 py-0\"\n                                sm=\"8\"\n                                cols=\"12\"\n                                style=\"transition: .3s ease-in;\"\n                                :class=\"{ hide_big_bar_class: isHideBar }\"\n                            >\n                                <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                                    <v-card outlined dense class=\"no_border\">\n                                        <h2 class=\"mb-0\">{{ $t(\"purchase_deposit\") }}</h2>\n                                        <v-icon\n                                            v-if=\"isHideBar\"\n                                            @click=\"cancel()\"\n                                            style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                                            class=\"float-right\"\n                                        >close\n                                        </v-icon>\n                                        <span\n                                            style=\"transition: .3s ease-in; z-index:10;\"\n                                            :class=\"{\n                        iconArrow: !isHideBar,\n                        iconArrowHide: isHideBar,\n                      }\"\n                                        >\n                      <v-icon\n                          size=\"22\"\n                          class=\"arr_icon\"\n                          @click=\"hideSmallSiteBar\"\n                          v-if=\"isHideBar\"\n                      >\n                        mdi-chevron-left-circle\n                      </v-icon>\n                      <v-icon\n                          size=\"22\"\n                          class=\"arr_icon\"\n                          @click=\"hideSmallSiteBar\"\n                          v-if=\"!isHideBar\"\n                      >\n                        mdi-chevron-right-circle\n                      </v-icon>\n                    </span>\n                                    </v-card>\n                                    <v-card\n                                        outlined\n                                        dense\n                                        class=\"px-3 rounded-4 no_border mb-3\"\n                                        color=\"grayBg\"\n                                    >\n                                        <v-row>\n                                            <v-col sm=\"5\" cols=\"12\" class=\"pb-0 px-4 pt-4\">\n                                                <label class=\"label  mb-0\">{{ $t(\"supplier\") }}</label>\n                                                <div class=\"kendo_dropdown_custom mt-1 pb-3\">\n                                                    <dropdownlist\n                                                        :data-items=\"supplierList\"\n                                                        @change=\"onChange\"\n                                                        :value=\"supplier\"\n                                                        :data-item-key=\"dataItemKey\"\n                                                        :text-field=\"textField\"\n                                                        :default-item=\"defaultItem\"\n                                                        :filterable=\"true\"\n                                                        :disabled=\"disableMe\"\n                                                        @filterchange=\"onFilterChange\"\n                                                        :required=\"true\"\n                                                        :valid=\"validSupplier\">\n                                                    </dropdownlist>\n                                                </div>\n                                                <label class=\"label  mb-0\">{{ $t(\"date\") }}</label>\n                                                <app-datepicker\n                                                    :initialDate=\"transactionDate\"\n                                                    :disabled=\"disableMe\"\n                                                    @emitDate=\"transactionDate = $event\"\n                                                />\n                                                <label class=\"label mb-0\">{{ $t(\"number\") }}</label>\n                                                <v-row class=\"mt-1 mr-0\">\n                                                    <v-col sm=\"3\" cols=\"3\" class=\"py-0 pr-0\">\n                                                        <div class=\"code_text text-bold\">\n                                                            {{ purchaseDeposit.transactionType.abbr }}\n                                                        </div>\n                                                    </v-col>\n                                                    <v-col sm=\"7\" cols=\"7\" class=\"py-0 pl-0\">\n                                                        <v-text-field\n                                                            class=\" custom-border \"\n                                                            v-model=\"purchaseDeposit.number\"\n                                                            outlined\n                                                            readonly\n                                                            tage=\"Number\"\n                                                            :rules=\"[(v) => !!v || 'Number is required']\"\n                                                            required\n                                                        />\n                                                    </v-col>\n                                                    <v-col sm=\"2\" cols=\"2\" class=\"py-0 px-0\">\n                                                        <v-icon\n                                                            color=\"black\"\n                                                            size=\"30\"\n                                                            class=\"border_qrcode\"\n                                                            @click=\"generateNumber\"\n                                                            :disabled=\"disableMe\"\n                                                        >mdi-qrcode\n                                                        </v-icon>\n                                                    </v-col>\n                                                </v-row>\n                                                <label class=\"label mb-0\">{{\n                                                        $t(\"transaction_currency\")\n                                                    }}</label>\n                                                <v-select\n                                                    class=\"mt-1\"\n                                                    v-model=\"purchaseDeposit.currency\"\n                                                    :items=\"currencyList\"\n                                                    @change=\"loadTransactionRate\"\n                                                    item-value=\"id\"\n                                                    :item-text=\"(item) => `${item.code} - ${item.name}`\"\n                                                    return-object\n                                                    :rules=\"[(v) => !!v['id'] || 'is required']\"\n                                                    tage=\"Transaction Currency\"\n                                                    placeholder=\"Currency\"\n                                                    outlined\n                                                />\n                                            </v-col>\n                                            <v-col sm=\"7\" cosl=\"12\" class=\"px-4 pt-4\">\n                                                <v-row>\n                                                    <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                                        <v-row>\n                                                            <v-col sm=\"6\" cols=\"12\" class=\"py-0\">\n                                                                <p class=\"mb-1 pt-0 d-block\">\n                                                                    {{ $t(\"current_deposit_balance\") }}\n                                                                </p>\n                                                                <h3 class=\"color_green float-right\">\n                                                                    {{ amountFormat(depositBalance) }}\n                                                                    {{ currencyCode }}\n                                                                </h3>\n                                                            </v-col>\n                                                        </v-row>\n                                                    </v-col>\n                                                    <v-col sm=\"12\" cols=\"12\" class=\"py-1 pl-0 \">\n                                                        <v-card\n                                                            outlined\n                                                            dense\n                                                            class=\"no_border px-3 mt-3\"\n                                                            color=\"white\"\n                                                        >\n                                                            <v-row>\n                                                                <v-col sm=\"12\" cols=\"12\" class=\"py-0 pt-4\">\n                                                                    <label class=\"label mb-0\">{{\n                                                                            $t(\"deposit_to_account\")\n                                                                        }}</label>\n                                                                    <v-select\n                                                                        class=\"mt-1\"\n                                                                        v-model=\"purchaseDeposit.purchaseDepositAcc\"\n                                                                        :items=\"accSupplierDeposit\"\n                                                                        :disabled=\"true\"\n                                                                        :rules=\"[(v) => !!v || 'Term  is required']\"\n                                                                        item-value=\"id\"\n                                                                        :item-text=\"\n                                      (item) => `${item.number} - ${item.name}`\n                                    \"\n                                                                        return-object\n                                                                        placeholder=\"Account Deposit\"\n                                                                        tage=\"Account Deposit\"\n                                                                        outlined\n                                                                    />\n                                                                    <label class=\"label mb-0\">{{\n                                                                            $t(\"purchase_order\")\n                                                                        }}</label>\n                                                                    <v-select\n                                                                        class=\"mt-1\"\n                                                                        v-model=\"purchaseDeposit.purchaseOrder\"\n                                                                        :items=\"purchaseOrders\"\n                                                                        @change=\"onPOChanged\"\n                                                                        item-value=\"id\"\n                                                                        item-text=\"number\"\n                                                                        return-object\n                                                                        clearable\n                                                                        tage=\"Purchase Order\"\n                                                                        placeholder=\"Purchase Order\"\n                                                                        outlined\n                                                                    />\n                                                                </v-col>\n                                                                <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                                                    <v-row>\n                                                                        <v-col sm=\"6\" cols=\"12\" class=\"py-0\">\n                                                                            <label class=\"label mb-0\">{{\n                                                                                    $t(\"amount\")\n                                                                                }}</label>\n                                                                            <p class=\"mt-3\">\n                                                                                {{\n                                                                                    numberFormat(\n                                                                                        purchaseDeposit.purchaseOrder,\n                                                                                        \"amount\"\n                                                                                    )\n                                                                                }}\n                                                                            </p>\n                                                                        </v-col>\n                                                                        <v-col sm=\"6\" cols=\"12\" class=\"py-0\">\n                                                                            <label class=\"label mb-0\">{{\n                                                                                    $t(\"currency\")\n                                                                                }}</label>\n                                                                            <p class=\"mt-3\">\n                                                                                {{\n                                                                                    numberFormat(\n                                                                                        purchaseDeposit.purchaseOrder,\n                                                                                        \"currency\"\n                                                                                    )\n                                                                                }}\n                                                                            </p>\n                                                                        </v-col>\n                                                                    </v-row>\n                                                                </v-col>\n                                                            </v-row>\n                                                        </v-card>\n                                                    </v-col>\n                                                </v-row>\n                                            </v-col>\n                                        </v-row>\n                                    </v-card>\n\n                                    <v-card outlined dense class=\"no_border\" color=\"white\">\n                                        <v-row>\n                                            <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                                <kendo-datasource\n                                                    ref=\"purchaseDepositDS\"\n                                                    :change=\"dataSourceChanged\"\n                                                    :data=\"depositLine\"\n                                                />\n                                                <kendo-grid\n                                                    id=\"gridPurchaseDeposit\"\n                                                    class=\"grid-function\"\n                                                    :data-source-ref=\"'purchaseDepositDS'\"\n                                                    :sortable=\"false\"\n                                                    :filterable=\"false\"\n                                                    :column-menu=\"true\"\n                                                    :editable=\"true\"\n                                                    :scrollable-virtual=\"true\">\n                                                    <kendo-grid-column\n                                                        :command=\"{\n                              iconClass: 'k-icon k-i-trash',\n                              text: ' ',\n                              click: removeRow,\n                              class: 'btn-plus',}\"\n                                                        :title=\"''\"\n                                                        :width=\"63\"\n                                                        :headerAttributes=\"{ style: 'text-align: right; background-color: #EDF1F5',}\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :title=\"$t('no.')\"\n                                                        :width=\"53\"\n                                                        :template=\"rowNumberTmpl\"\n                                                        :column-menu=\"false\"\n                                                        :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5;',\n                              class: 'text-products',}\"\n                                                        :attributes=\"{ style: 'text-align: products' }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'paymentOption'\"\n                                                        :title=\"$t('payment_option')\"\n                                                        :width=\"250\"\n                                                        :template=\"methodTemplate\"\n                                                        :editor=\"PaymentOptionEditor\"\n                                                        :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'account'\"\n                                                        :title=\"$t('account')\"\n                                                        :width=\"200\"\n                                                        :template=\"accountTemplate\"\n                                                        :editor=\"accountDropDownEditor\"\n                                                        :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'description'\"\n                                                        :title=\"$t('description')\"\n                                                        :width=\"200\"\n                                                        :template=\"'<span>#=description#</span>'\"\n                                                        :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                                                    />\n\n                                                    <kendo-grid-column\n                                                        :field=\"'amount'\"\n                                                        :title=\"$t('amount')\"\n                                                        :format=\"'{0:n}'\"\n                                                        :width=\"200\"\n                                                        :template=\"amountTemplate\"\n                                                        :headerTemplate=\"amountLineHeaderTemplate\"\n                                                        :editor=\"amountEditor\"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{ style: 'text-align: right' }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'refNo'\"\n                                                        :title=\"$t('payment_ref')\"\n                                                        :format=\"'{0:n}'\"\n                                                        :width=\"200\"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{ style: 'text-align: right' }\"\n                                                    />\n                                                </kendo-grid>\n                                            </v-col>\n                                            <v-col sm=\"12\" cols=\"12\" class=\"pt-1\">\n                                                <v-btn\n                                                    class=\"float-left btn_plus white--text mr-2\"\n                                                    color=\"primary\"\n                                                    @click=\"addRow\"\n                                                >\n                                                    <v-icon size=\"\" class=\"ma-1\">mdi-plus</v-icon>\n                                                </v-btn>\n                                            </v-col>\n                                            <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                                <v-row>\n                                                    <v-col class=\"pt-0\" sm=\"7\" cols=\"12\">\n                                                        <v-card\n                                                            class=\"no-boxshadow rounded-4 pa-3\"\n                                                            color=\"grayBg\"\n                                                            height=\"138px\"\n                                                        >\n                                                            <v-row>\n                                                                <v-col class=\"py-0\" sm=\"6\" cols=\"12\">\n                                                                    <label>{{ $t(\"message_on_deposit\") }}</label>\n                                                                    <v-textarea\n                                                                        class=\"mt-1\"\n                                                                        no-resize\n                                                                        height=\"90px\"\n                                                                        v-model=\"purchaseDeposit.transactionNote\"\n                                                                        outlined\n                                                                        clearable\n                                                                        rows=\"3\"\n                                                                        placeholder=\"This will appear on the deposit\"\n                                                                    />\n                                                                </v-col>\n                                                                <v-col class=\"py-0\" sm=\"6\" cols=\"12\">\n                                                                    <label>{{ $t(\"message_for_journal\") }}</label>\n                                                                    <v-textarea\n                                                                        class=\"mt-1\"\n                                                                        no-resize\n                                                                        height=\"90px\"\n                                                                        outlined\n                                                                        v-model=\"purchaseDeposit.journalNote\"\n                                                                        clearable\n                                                                        rows=\"3\"\n                                                                        placeholder=\"This will appear on the journal\"\n                                                                    />\n                                                                </v-col>\n                                                            </v-row>\n                                                        </v-card>\n                                                    </v-col>\n                                                    <v-col sm=\"5\" cols=\"12\" class=\"pt-1 pb-0\">\n                                                        <v-simple-table>\n                                                            <template v-slot:default>\n                                                                <tbody>\n                                                                <tr>\n                                                                    <td class=\"text-left text-uppercase\">\n                                                                        {{ $t(\"total\") }}\n                                                                    </td>\n                                                                    <td class=\"text-center\">:</td>\n                                                                    <td class=\"text-left color_green text-bold\">\n                                                                        {{\n                                                                            amountFormat(\n                                                                                purchaseDeposit.exchangeAmount\n                                                                            )\n                                                                        }}\n                                                                    </td>\n                                                                </tr>\n                                                                </tbody>\n                                                            </template>\n                                                        </v-simple-table>\n                                                    </v-col>\n                                                </v-row>\n                                            </v-col>\n                                        </v-row>\n                                    </v-card>\n\n                                    <v-divider/>\n                                    <v-card outlined dense class=\"no_border function_footer\">\n                                        <v-alert type=\"warning\" v-model=\"alert\" dismissible>\n                                            <span v-html=\"errorMessage\"/>\n                                        </v-alert>\n                                        <v-menu>\n                                            <template v-slot:activator=\"{ on }\">\n                                                <v-btn\n                                                    class=\"text-capitalize  black--text float-left mr-2\"\n                                                    v-on=\"on\"\n                                                >\n                                                    {{ $t(\"select_template\") }}\n                                                    <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>\n                                                </v-btn>\n                                            </template>\n                                            <v-list>\n                                                <v-list-item\n                                                    v-for=\"(item, index) in templates\"\n                                                    :key=\"index\"\n                                                >\n                                                    <v-list-item-title>{{\n                                                            item.title\n                                                        }}\n                                                    </v-list-item-title>\n                                                </v-list-item>\n                                            </v-list>\n                                        </v-menu>\n                                        <v-btn\n                                            color=\"primary\"\n                                            outlined\n                                            class=\" text-capitalize  black--text float-left mr-2\"\n                                            @click=\"cancel\"\n                                        >{{ $t(\"cancel\") }}\n                                        </v-btn>\n                                        <!--                    <v-menu>-->\n                                        <!--                      <template v-slot:activator=\"{ on }\">-->\n                                        <!--                        <v-btn color=\"primary\"-->\n                                        <!--                               class=\"ml-2 float-right  text-capitalize white&#45;&#45;text\" v-on=\"on\">-->\n                                        <!--                          {{ $t('save_option') }}-->\n                                        <!--                          <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>-->\n                                        <!--                        </v-btn>-->\n                                        <!--                      </template>-->\n                                        <!--                      <v-list rounded>-->\n                                        <!--                        <v-list-item-group>-->\n                                        <!--                          <v-list-item>-->\n                                        <!--                            <v-list-item-content>-->\n                                        <!--                              <v-list-item-title @click=\"onSaveClose('new')\">-->\n                                        <!--                                {{ $t('save_new') }}-->\n                                        <!--                              </v-list-item-title>-->\n                                        <!--                            </v-list-item-content>-->\n                                        <!--                          </v-list-item>-->\n                                        <!--                          &lt;!&ndash;                                                    <v-list-item>&ndash;&gt;-->\n                                        <!--                          &lt;!&ndash;                                                        <v-list-item-content>&ndash;&gt;-->\n                                        <!--                          &lt;!&ndash;                                                            <v-list-item-title @click=\"savePrint\">{{ $t('save_print') }}&ndash;&gt;-->\n                                        <!--                          &lt;!&ndash;                                                            </v-list-item-title>&ndash;&gt;-->\n                                        <!--                          &lt;!&ndash;                                                        </v-list-item-content>&ndash;&gt;-->\n                                        <!--                          &lt;!&ndash;                                                    </v-list-item>&ndash;&gt;-->\n                                        <!--                          <v-list-item>-->\n                                        <!--                            <v-list-item-content>-->\n                                        <!--                              <v-list-item-title>{{-->\n                                        <!--                                  $t('save_draft')-->\n                                        <!--                                }}-->\n                                        <!--                              </v-list-item-title>-->\n                                        <!--                            </v-list-item-content>-->\n                                        <!--                          </v-list-item>-->\n                                        <!--                        </v-list-item-group>-->\n                                        <!--                      </v-list>-->\n                                        <!--                    </v-menu>-->\n                                        <v-btn\n                                            color=\"primary\"\n                                            @click=\"onSaveClose('close')\"\n                                            class=\"float-right white--text text-capitalize \"\n                                        >\n                                            {{ $t(\"save_close\") }}\n                                        </v-btn>\n                                        <v-btn color=\"secondary\"\n                                               style=\"margin-right: 10px !important\"\n                                               class=\"white--text float-right text-capitalize\"\n                                               @click=\"onSaveClose('new')\" :hidden=\"hiddenButton\">{{ $t(\"save_new\") }}\n                                        </v-btn>\n                                    </v-card>\n                                </v-form>\n                            </v-col>\n                            <v-col\n                                class=\"smallSide pl-2 pt-0\"\n                                sm=\"4\"\n                                style=\"transition: .3s ease-in;\"\n                                :class=\"{ hide_small_bar_class: isHideBar }\"\n                            >\n                                <div class=\"d-flex justify-end\">\n                                    <h3\n                                        style=\"color: #b3b5bc; font-size:20px;\"\n                                        v-if=\"!isHideBar\"\n                                        class=\"text-uppercase\"\n                                    >\n                    <span class=\"pointer\" @click=\"Help('purchase deposit')\">\n                      {{ $t(\"help\") }}\n                    </span>\n                                        <v-icon\n                                            @click=\"cancel()\"\n                                            style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                                            class=\"float-right mt-n1\"\n                                        >close\n                                        </v-icon>\n                                    </h3>\n                                </div>\n\n                                <div v-if=\"!isHideBar\" class=\"small_sidebar mt-2 px-4 grayBg\">\n                                    <v-card outlined dense class=\"pa-3 no_border my_card rounded-4 white--text\"\n                                            color=\"primary\" height=\"60px\">\n                                        <h3 class=\"text-left font_13 flex-1 text-uppercase\">{{\n                                                $t('amount_deposit')\n                                            }}</h3>\n                                        <h3 class=\"text-right flex-1 font_20 niradei_heavy\">\n                                            {{ amountFormat(purchaseDeposit.exchangeAmount) }} </h3>\n                                    </v-card>\n                                    <v-row>\n                                        <v-col sm=\"12\" cols=\"12\">\n                                            <v-row>\n                                                <v-col sm=\"12\" cols=\"12\" class=\"pt-2\">\n                                                    <v-row>\n                                                        <v-col sm=\"12\" cols=\"12\" class=\"pb-0 pt-0\">\n                                                            <label class=\"label\">{{ $t(\"segment\") }}</label>\n                                                            <!--                              <h4 class=\"text-bold py-1\">{{ segment }}</h4>-->\n                                                            <v-select\n                                                                class=\"mt-1\"\n                                                                v-model=\"purchaseDeposit.segment\"\n                                                                :items=\"segments\"\n                                                                item-value=\"id\"\n                                                                :item-text=\"(item) => `${item.code} - ${item.name}`\"\n                                                                return-object\n                                                                :rules=\"[(v) => !!v['id']|| 'Segment is required']\"\n                                                                outlined=\"\"\n                                                            />\n                                                        </v-col>\n                                                        <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                                            <label class=\"label\">{{ $t(\"location\") }}</label>\n                                                            <!--                              <h4 class=\"text-bold py-1\">{{ location }}</h4>-->\n                                                            <v-select\n                                                                class=\"mt-1\"\n                                                                v-model=\"purchaseDeposit.location\"\n                                                                :items=\"locations\"\n                                                                item-value=\"id\"\n                                                                :rules=\"[(v) => !!v['id']|| 'Location is required']\"\n                                                                :item-text=\"(item) => `${item.code} - ${item.name}`\"\n                                                                return-object\n                                                                outlined=\"\"\n                                                            />\n                                                        </v-col>\n                                                    </v-row>\n\n                                                    <!--                                                    <label class=\"label font_14\">{{ $t('project') }}</label>-->\n                                                    <!--                                                    <label-->\n                                                    <!--                                                        class=\"label text-bold text-uppercase font_14\">{{-->\n                                                    <!--                                                            $t('tnc_to_be_added')-->\n                                                    <!--                                                        }}</label>-->\n                                                    <!--                                                    <v-select class=\" mt-1\"-->\n                                                    <!--                                                              :items=\"transaction\"-->\n                                                    <!--                                                              tage=\"Transactions to be added\"-->\n                                                    <!--                                                              :rules=\"[v => !!v || 'Payble Account is required']\"-->\n                                                    <!--                                                              return-object-->\n                                                    <!--                                                              outlined-->\n                                                    <!--                                                    >-->\n                                                    <!--                                                        <template v-slot:item=\"{ item }\">-->\n                                                    <!--                                                            <p class=\"d-block text-center\">{{ item.id }}.-->\n                                                    <!--                                                                {{ item.name }}</p>-->\n                                                    <!--                                                            <br>-->\n                                                    <!--                                                            <div class=\"item_list d-flex\">-->\n                                                    <!--                                                                <span>-->\n                                                    <!--                                                                    {{ item.no }}-->\n                                                    <!--                                                                </span>-->\n                                                    <!--                                                                <v-btn>{{ $t('add') }}</v-btn>-->\n                                                    <!--                                                            </div>-->\n                                                    <!--                                                        </template>-->\n                                                    <!--                                                    </v-select>-->\n\n                                                    <!--                                                    <v-row>-->\n                                                    <!--                                                        <label class=\"text-bold ml-9 mt-2\" style=\"font-size: 12px;\">1.-->\n                                                    <!--                                                            {{ $t('sale_quote') }}</label>-->\n                                                    <!--                                                        <v-col sm=\"9\" cols=\"9\" class=\"py-0 pr-0\">-->\n                                                    <!--                                                            <v-card outlined-->\n                                                    <!--                                                                    class=\"px-3 py-1 text-white no-boxshadow no_border justify-left d-flex\"-->\n                                                    <!--                                                                    style=\"background-color: #92d050; height: 30px\">-->\n                                                    <!--                                                                <input type=\"checkbox\" class=\"checkbox_inv float-left\"/>-->\n                                                    <!--                                                                <p class=\"mb-0\" style=\"width: 100%\">-->\n                                                    <!--                                                                    <span class=\"pl-3 float-left\">No. 00224</span>-->\n                                                    <!--                                                                    <span class=\"float-right\">2,500.00</span>-->\n                                                    <!--                                                                </p>-->\n                                                    <!--                                                            </v-card>-->\n                                                    <!--                                                        </v-col>-->\n                                                    <!--                                                        <v-col sm=\"3\" cols=\"3\" class=\"py-0  pl-1\">-->\n                                                    <!--                                                            <v-btn-->\n                                                    <!--                                                                class=\"text-white text-bold rounded-0 float-right text-uppercase\"-->\n                                                    <!--                                                                style=\"height: 30px !important; background-color: rgb(0, 176, 80) !important\">-->\n                                                    <!--                                                                {{ $t('add') }}-->\n                                                    <!--                                                            </v-btn>-->\n                                                    <!--                                                        </v-col>-->\n                                                    <!--                                                    </v-row>-->\n                                                    <!--                                                    <v-row>-->\n                                                    <!--                                                        <label class=\"text-bold ml-9\" style=\"font-size: 12px;\">2.-->\n                                                    <!--                                                            {{ $t('sale_quote') }}</label>-->\n                                                    <!--                                                        <v-col sm=\"9\" cols=\"9\" class=\"py-0 pr-0\">-->\n                                                    <!--                                                            <v-card outlined-->\n                                                    <!--                                                                    class=\"px-3 py-1 text-white no-boxshadow no_border justify-left d-flex\"-->\n                                                    <!--                                                                    style=\"background-color: #92d050; height: 30px\">-->\n                                                    <!--                                                                <input type=\"checkbox\" class=\"checkbox_inv float-left\"/>-->\n                                                    <!--                                                                <p class=\"mb-0\" style=\"width: 100%\">-->\n                                                    <!--                                                                    <span class=\"pl-3 float-left\">No. 00224</span>-->\n                                                    <!--                                                                    <span class=\"float-right\">2,500.00</span>-->\n                                                    <!--                                                                </p>-->\n                                                    <!--                                                            </v-card>-->\n                                                    <!--                                                        </v-col>-->\n                                                    <!--                                                        <v-col sm=\"3\" cols=\"3\" class=\"py-0  pl-1\">-->\n                                                    <!--                                                            <v-btn-->\n                                                    <!--                                                                class=\"text-white text-bold rounded-0 float-right text-uppercase\"-->\n                                                    <!--                                                                style=\"height: 30px !important; background-color: rgb(0, 176, 80) !important\">-->\n                                                    <!--                                                                {{ $t('add') }}-->\n                                                    <!--                                                            </v-btn>-->\n                                                    <!--                                                        </v-col>-->\n                                                    <!--                                                    </v-row>-->\n                                                    <!--                                                    <v-row>-->\n                                                    <!--                                                        <label class=\"text-bold ml-9 mt-2\" style=\"font-size: 12px;\">4.-->\n                                                    <!--                                                            {{ $t('sale_quote') }}</label>-->\n                                                    <!--                                                        <v-col sm=\"9\" cols=\"9\" class=\"py-0 pr-0\">-->\n                                                    <!--                                                            <v-card outlined-->\n                                                    <!--                                                                    class=\"px-3 py-1 text-white no-boxshadow no_border justify-left d-flex\"-->\n                                                    <!--                                                                    style=\"background-color: #92d050; height: 30px\">-->\n                                                    <!--                                                                <input type=\"checkbox\" class=\"checkbox_inv float-left\"/>-->\n                                                    <!--                                                                <p class=\"mb-0\" style=\"width: 100%\">-->\n                                                    <!--                                                                    <span class=\"pl-3 float-left\">No. 00224</span>-->\n                                                    <!--                                                                    <span class=\"float-right\">2,500.00</span>-->\n                                                    <!--                                                                </p>-->\n                                                    <!--                                                            </v-card>-->\n                                                    <!--                                                        </v-col>-->\n                                                    <!--                                                        <v-col sm=\"3\" cols=\"3\" class=\"py-0  pl-1\">-->\n                                                    <!--                                                            <v-btn-->\n                                                    <!--                                                                class=\"text-white text-bold rounded-0 float-right text-uppercase\"-->\n                                                    <!--                                                                style=\"height: 30px !important; background-color: rgb(0, 176, 80) !important\">-->\n                                                    <!--                                                                {{ $t('add') }}-->\n                                                    <!--                                                            </v-btn>-->\n                                                    <!--                                                        </v-col>-->\n                                                    <!--                                                    </v-row>-->\n                                                </v-col>\n                                            </v-row>\n                                        </v-col>\n                                    </v-row>\n\n                                    <p class=\"mb-0 detial_smallside_p pr-4 font_14\">\n                                        {{ $t(\"purchase_deposit_desc\") }}\n                                    </p>\n                                </div>\n                            </v-col>\n                        </v-row>\n                    </v-card>\n                </v-col>\n            </v-row>\n            <LoadingMe :isLoading=\"showLoading\" :fullPage=\"false\" :myLoading=\"true\"/>\n        </v-container>\n    </v-app>\n</template>\n\n<script>\nimport {i18n} from \"@/i18n\";\nimport kendo from \"@progress/kendo-ui\";\nimport PurchaseDepositModel from \"@/scripts/purchase_deposit/model/PurchaseDeposit\";\nimport {DropDownList} from \"@progress/kendo-vue-dropdowns\";\nimport {uuid} from \"vue-uuid\";\nimport ItemLineModel from \"@/scripts/purchase_deposit/model/ItemLine\";\nimport {dataStore, ShowResource} from \"@/observable/store\";\nimport PaymentOptionEditor from \"@/scripts/kendo_editor/PaymentOptionEditor\";\nimport Helper from \"@/helper\";\n\nconst saleOrderHandler = require(\"@/scripts/transactionHandler\");\nconst supplierHandler = require(\"@/scripts/supplierHandler\");\n\nconst locationHandler = require(\"@/scripts/locationHandler\");\nconst settingsHandler = require(\"@/scripts/settingsHandler\");\nconst purchaseDepositModel = new PurchaseDepositModel({});\nconst prefixHandler = require(\"@/scripts/prefixHandler\");\nconst billingHandler = require(\"@/scripts/invoice/handler/billingHandler\");\nconst accountHandler = require(\"@/scripts/handler/accounting/account\");\nconst itemLineModel = new ItemLineModel({});\nconst $ = kendo.jQuery\nconst paymentOptionHandler = require(\"@/scripts/paymentOptionHandler\");\nconst currencyHandler = require(\"@/scripts/currency/handler/currencyHandler\");\n\nconst defaultItem = {[\"numberName\"]: \"Select vendor...\", [\"id\"]: null};\nconst emptyItem = {[\"numberName\"]: \"loading ...\"};\nconst itemLinePrefix = \"lin-\";\nconst OPTION_TYPE = \"Supplier\";\nconst strFilter = \"?optionType=\" + OPTION_TYPE;\nconst cookieJS = require(\"@/cookie.js\");\nconst cookie = cookieJS.getCookie();\nexport default {\n    name: \"PurchaseDeposit\",\n    props: [\"id\"],\n    components: {\n        LoadingMe: () => import(`@/components/Loading`),\n        \"app-datepicker\": () => import(`@/components/custom_templates/DatePickerComponent`),\n        dropdownlist: DropDownList,\n    },\n    data: () => ({\n        isEdit: false,\n        showLoading: false,\n        alert: false,\n        files: [],\n        segments: [],\n        locations: [],\n        purchaseDeposit: purchaseDepositModel,\n        itemLine: itemLineModel,\n        supplierList: [],\n        supplier: {},\n        textField: \"numberName\",\n        defaultItem: defaultItem,\n        dataItemKey: \"id\",\n        filter: \"\",\n        cusBaseUrl: supplierHandler.search(),\n        transactionTypes: [],\n        accSupplierDeposit: [],\n        paymentMethod: [],\n        purchaseOrders: [],\n        saleOrderAmount: 0,\n        saleOrderCurrency: \"\",\n        currencyCode: \"\",\n        accCash: [],\n        depositLine: [],\n        currencyList: [],\n        decimalFormat: \"n2\",\n        depositBalance: 0,\n        valid: true,\n        loggedUser: {\n            id: cookie.creator,\n            name: cookie.email,\n        },\n        transactionDate: new Date().toISOString().substr(0, 10),\n        templates: [\n            {title: \"Purchase Deposit\", value: \"Purchase Deposit\"},\n        ],\n        isHideBar: false,\n        PaymentOptionEditor: PaymentOptionEditor,\n        refFrom: [],\n        refTo: [],\n    }),\n    methods: {\n        onPOChanged() {\n            if (this.purchaseDeposit) {\n                if (this.purchaseDeposit.purchaseOrder) {\n                    const saleOrder = this.purchaseDeposit.purchaseOrder || {};\n                    const segment = saleOrder.segment || {};\n                    const location = saleOrder.location || {};\n                    this.purchaseDeposit.segment = segment;\n                    this.purchaseDeposit.location = location;\n                    this.refFrom.push({\n                        id: saleOrder.id || '',\n                        reference: saleOrder.number || ''\n                    })\n                }\n                this.purchaseDeposit.refFrom = this.refFrom\n            }\n        },\n        Help(key_search) {\n            ShowResource(key_search);\n        },\n        saveNew() {\n        },\n        removeRow(e) {\n            e.preventDefault();\n            const grid = kendo.jQuery(\"#gridPurchaseDeposit\").data(\"kendoGrid\"),\n                dataSource = grid.dataSource,\n                dataItem = grid.dataItem($(e.currentTarget).closest(\"tr\"));\n\n            if (dataSource.total() > 1) {\n                dataSource.remove(dataItem);\n            }\n        },\n        numberFormat(obj, type) {\n            if (obj) {\n                // this.purchaseDeposit.location = obj.hasOwnProperty('location') ? obj.location : {}\n                // this.purchaseDeposit.segment = obj.hasOwnProperty('segment') ? obj.segment : {}\n                if (type === \"amount\") {\n                    const value = obj.hasOwnProperty(\"amount\") ? obj.amount : 0;\n                    const decimalFormat = obj.hasOwnProperty(\"decimalFormat\")\n                        ? obj.decimalFormat\n                        : `n2`;\n                    return kendo.toString(parseFloat(value), decimalFormat);\n                } else if (type === \"currency\") {\n                    const currency = obj.hasOwnProperty(\"currency\") ? obj.currency : \"\";\n                    return currency.code;\n                }\n            }\n            return \"-\";\n        },\n        amountFormat(value) {\n            return kendo.toString(parseFloat(value), `${this.decimalFormat}`);\n        },\n        generateNumber() {\n            if (this.$route.params.id) {\n                const tranDate = new Date(this.transactionDate);\n                const tranDateInvoice = new Date(this.purchaseDeposit.transactionDate);\n                const tranDateM = tranDate.getFullYear() + tranDate.getMonth();\n                const tranDateInvoiceM =\n                    tranDateInvoice.getFullYear() + tranDateInvoice.getMonth();\n                if (tranDateM === tranDateInvoiceM) {\n                    this.purchaseDeposit.referenceNo = this.referenceNo;\n                    return;\n                }\n            }\n\n            if (this.transactionDate !== \"\" && this.transactionTypes.length > 0) {\n                let data = {\n                    abbr: this.purchaseDeposit.transactionType.abbr,\n                    structure: this.purchaseDeposit.transactionType.structure,\n                    transactionDate: this.transactionDate,\n                    sequcencing: this.purchaseDeposit.transactionType.sequcencing,\n                    prefixSeparator: this.purchaseDeposit.transactionType.prefixSeparator || '',\n                    numberSeparator: this.purchaseDeposit.transactionType.numberSeparator || '',\n                    format: this.purchaseDeposit.transactionType.format || 5,\n                    type: \"Purchase Deposit\",\n                    entity: 1,\n                };\n                billingHandler\n                    .lastNumber(data)\n                    .then((response) => {\n                        if (response.data.statusCode === 200) {\n                            const res = response.data.data;\n                            const lastNumber = this.zeroPad(\n                                parseInt(res.lastNumber),\n                                this.purchaseDeposit.transactionType.format\n                            );\n                            this.purchaseDeposit.number =\n                                res.suffix +\n                                this.purchaseDeposit.transactionType.numberSeparator +\n                                lastNumber;\n                        }\n                    })\n                    .catch((e) => {\n                        this.errors.push(e);\n                    });\n            }\n        },\n        zeroPad(num, places) {\n            return String(num).padStart(places, \"0\");\n        },\n        suffix(transactionDate) {\n            return kendo.toString(new Date(transactionDate), `yymm`);\n        },\n        errorMessage() {\n        },\n        accountDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=number# - #= name#</span>\",\n                    optionLabel: \"--Select--\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.accCash,\n                    }),\n                });\n        },\n        methodDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=code# - #= name#</span>\",\n                    optionLabel: \"--Select--\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.paymentMethod,\n                    }),\n                });\n        },\n        accountTemplate(dataItem) {\n            const acc = dataItem.account;\n            if (acc) {\n                return `<span>${acc.name ? acc.name : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        methodTemplate(dataItem) {\n            const method = dataItem.paymentOption || ''\n            if (method) {\n                return `<span>${method.bankAccountName || ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        amountTemplate(dataItem) {\n            const amt = dataItem.amount;\n            if (amt) {\n                return kendo.toString(parseFloat(amt), `${this.decimalFormat}`);\n            } else {\n                return 0;\n            }\n        },\n        amountEditor(container, options) {\n            kendo\n                .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoNumericTextBox({\n                    decimals: 30,\n                    format: `${this.decimalFormat}`,\n                });\n        },\n        cancel() {\n            this.$swal({\n                title: i18n.t(\"msg_title_warning\"),\n                text: i18n.t(\"msg_discard\"),\n                icon: \"warning\",\n                showCancelButton: true,\n                cancelButtonText: i18n.t(\"cancel\"),\n                confirmButtonColor: \"#4d4848\",\n                cancelButtonColor: \"#ED1A3A\",\n                confirmButtonText: i18n.t(\"discard\"),\n            }).then((result) => {\n                if (result.value) {\n                    this.clear();\n                    this.$router.go(-1);\n                }\n            });\n        },\n        clear() {\n            this.showLoading = false;\n            this.supplier = {}\n            this.purchaseOrders = []\n            const segment = this.purchaseDeposit.segment || {}\n            const location = this.purchaseDeposit.location || {}\n            this.generateNumber()\n            const txnType = this.purchaseDeposit.transactionType;\n            this.purchaseDeposit = new PurchaseDepositModel({});\n            this.purchaseDeposit.transactionType = txnType;\n            this.purchaseDeposit.segment = segment\n            this.purchaseDeposit.location = location\n            // this.depositLine = [];\n            let lines = this.$refs.purchaseDepositDS.kendoWidget();\n            lines.data([]);\n            this.addRow();\n        },\n        close() {\n            window.history.go(-1);\n        },\n        hideSmallSiteBar() {\n            this.isHideBar = !this.isHideBar;\n        },\n        onFilterChange(event) {\n            const filter = event.filter.value;\n            this.requestData(0, filter, this.cusBaseUrl);\n            this.filter = filter;\n        },\n        requestData(skip, filter, baseUrl) {\n            const url = baseUrl + `?filter=${filter}`;\n            fetch(url)\n                .then((response) => {\n                    return response.json();\n                })\n                .then(this.afterFetch);\n        },\n        afterFetch(json) {\n            this.supplierList = json.data;\n        },\n        onChange(event) {\n            const value = event.value;\n            if (value && value[\"numberName\"] === emptyItem[\"numberName\"]) {\n                return;\n            }\n            this.supplier = value;\n            if (value.hasOwnProperty(\"id\")) {\n                if (value.id !== null) {\n                    this.decimalFormat = this.supplier.decimalFormat;\n                    if (value.hasOwnProperty(\"baseCurrency\")) {\n                        if (value.baseCurrency.hasOwnProperty(\"code\")) {\n                            this.currencyCode = \" \" + value.baseCurrency.code;\n                        }\n                    }\n                    this.purchaseDeposit.purchaseDepositAcc = value.hasOwnProperty(\n                        \"purchaseDepositAcc\"\n                    )\n                        ? value.purchaseDepositAcc\n                        : {};\n                    this.loadPurchaseOrders();\n                    this.loadCustomerBalance(value.id);\n                }\n            }\n        },\n        async loadLocation() {\n            this.locations = []\n            const roleType = dataStore.roleType || 0\n            if (roleType === 0) {\n                if (dataStore.roleData) {\n                    const roleData = dataStore.roleData || []\n                    const location = roleData.filter(itm => itm.type === 'location')\n                    const locationDefault = location.filter(m => m.isDefault === 1)\n                    this.locations = location\n                    if (this.$route.params.id === undefined || this.$route.params.id === '') {\n                        if (locationDefault.length > 0) {\n                            this.purchaseDeposit.location = locationDefault[0];\n                        }\n                    }\n                }\n            } else if (roleType === 1) {\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        this.locations = [];\n                        locationHandler\n                            .list()\n                            .then((res) => {\n                                this.showLoading = true;\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    this.locations = res.data.data;\n                                    // if (this.locations.length > 0) {\n                                    //     this.purchaseDeposit.location = this.locations[0];\n                                    // }\n                                } else {\n                                    this.showLoading = false;\n                                }\n                            })\n                    }, 10);\n                });\n            }\n        },\n        async loadSegment() {\n            this.segments = []\n            const roleType = dataStore.roleType || 0\n            if (roleType === 0) {\n                if (dataStore.roleData) {\n                    const roleData = dataStore.roleData || []\n                    const segment = roleData.filter(itm => itm.type === 'segment')\n                    const segmentDefault = segment.filter(m => m.isDefault === 1)\n                    this.segments = segment\n                    if (this.$route.params.id === undefined || this.$route.params.id === '') {\n                        if (segmentDefault.length > 0) {\n                            this.purchaseDeposit.segment = segmentDefault[0];\n                        }\n                    }\n                }\n            } else if (roleType === 1) {\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        this.segments = [];\n                        settingsHandler\n                            .getSeg()\n                            .then((res) => {\n                                this.showLoading = true;\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    this.segments = res.data.data;\n                                } else {\n                                    this.showLoading = false;\n                                }\n                            })\n                    }, 10);\n                });\n            }\n        },\n        async loadPrefix() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    prefixHandler.get(\"purchase deposit\").then((res) => {\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false;\n                            this.transactionTypes = res.data.data;\n                            if (this.transactionTypes.length > 0) {\n                                this.purchaseDeposit.transactionType = this.transactionTypes[0];\n                                if (this.$route.params.id === undefined) {\n                                    this.generateNumber();\n                                }\n                            }\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async loadAccount() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    accountHandler.getAll().then((res) => {\n                        this.showLoading = false;\n                        this.accSupplierDeposit = res.data\n                            .filter((m) => m.account_type.number === 9)\n                            .map((item) => {\n                                return {\n                                    id: item.uuid,\n                                    uuid: item.uuid,\n                                    name: item.name,\n                                    local_name: item.local_name,\n                                    number: item.number,\n                                    is_taxable: item.is_taxable,\n                                    banhjiAccCode: item.banhjiAccCode,\n                                    group_code: item.group_code,\n                                    parent_account: item.parent_account,\n                                    type_code: item.type_code,\n                                    account_type: item.account_type,\n                                };\n                            });\n                        this.accCash = res.data\n                            .filter((m) => m.account_type.number <= 5)\n                            .map((item) => {\n                                return {\n                                    id: item.uuid,\n                                    uuid: item.uuid,\n                                    name: item.name,\n                                    local_name: item.local_name,\n                                    number: item.number,\n                                    is_taxable: item.is_taxable,\n                                    banhjiAccCode: item.banhjiAccCode,\n                                    group_code: item.group_code,\n                                    parent_account: item.parent_account,\n                                    type_code: item.type_code,\n                                    account_type: item.account_type,\n                                };\n                            });\n                        if (this.accSupplierDeposit.length > 0) {\n                            this.purchaseDeposit.accReceivable = this.accSupplierDeposit[0];\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async loadPurchaseOrders() {\n            if (this.supplier) {\n                this.showLoading = true;\n                this.purchaseOrders = [];\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        let data = {\n                            method: \"by_supplier\",\n                            supplier: this.supplier.id,\n                            type: \"Purchase Order\",\n                        };\n                        saleOrderHandler.search(data).then((res) => {\n                            this.showLoading = false;\n                            const response = res.data.data;\n                            response.forEach((m) => {\n                                const poData = m.txnData;\n                                this.purchaseOrders.push({\n                                    id: m.id,\n                                    amount: m.total,\n                                    number: m.number,\n                                    currency: poData.currency,\n                                    decimalFormat: m.decimalFormat,\n                                    location: poData.location,\n                                    segment: poData.segment,\n                                });\n                            });\n                            // window.console.log(this.purchaseOrders,'purchase')\n                        });\n                    }, 10);\n                });\n            }\n        },\n        rowNumberTmpl(dataItem) {\n            let ds = this.$refs.purchaseDepositDS.kendoWidget(),\n                index = ds.indexOf(dataItem);\n            return index + 1;\n        },\n        addRow() {\n            let ds = this.$refs.purchaseDepositDS.kendoWidget(),\n                total = ds.total();\n            this.itemLine.id = itemLinePrefix + uuid.v1();\n            this.itemLine.decimalFormat = this.decimalFormat;\n            this.itemLine.optionType = OPTION_TYPE;\n            ds.insert(total, this.itemLine);\n            // this.itemLines.push(this.itemLine)\n            // this.itemLines.push(this.itemLine)a\n            // window.console.log('item Line', this.itemLine)\n        },\n        async loadPaymentOption() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    this.paymentMethod = [];\n                    paymentOptionHandler\n                        .list(strFilter)\n                        .then((res) => {\n                            if (res.data.statusCode === 200) {\n                                this.showLoading = false;\n                                this.paymentMethod = res.data.data;\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 10);\n            });\n        },\n        async loadCurrencyData() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    currencyHandler\n                        .list(\"fun-c\")\n                        .then((response) => {\n                            if (response.data.statusCode === 200) {\n                                this.currencyList = response.data.data.filter(\n                                    (o) => o.used === 1\n                                );\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 10);\n            });\n        },\n        async loadTransactionRate() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const date = new Date(this.transactionDate)\n                        .toISOString()\n                        .substr(0, 10);\n                    const currency = this.purchaseDeposit.currency;\n                    let code = \"\";\n                    if (currency.hasOwnProperty(\"code\")) {\n                        code = currency.code;\n                    }\n\n                    if (code !== undefined || code !== \"\") {\n                        this.showLoading = true;\n                        currencyHandler\n                            .getLastExchangeRateByDate(date, code)\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    const response = res.data.data[0];\n                                    this.purchaseDeposit.exchangeRate = response;\n                                    this.purchaseDeposit.txnRate = response.rate;\n                                    this.showLoading = false;\n                                }\n                            });\n                    }\n                }, 10);\n            });\n        },\n        autoCalculate() {\n            let ds = this.$refs.purchaseDepositDS.kendoWidget(),\n                convertedAmount = 0,\n                amount = 0;\n            ds.data().forEach((value) => {\n                if (value.amount) {\n                    amount += kendo.parseFloat(value.amount);\n                    convertedAmount +=\n                        kendo.parseFloat(value.amount) * this.purchaseDeposit.txnRate;\n                }\n            });\n            window.console.log(amount, \"amount\");\n            this.purchaseDeposit.exchangeAmount = convertedAmount;\n            this.purchaseDeposit.amount = amount;\n        },\n        dataSourceChanged(e) {\n            if (e.field) {\n                let dataRow = e.items[0], pOption = {}\n                switch (e.field) {\n                    case \"paymentOption\":\n                        pOption = dataRow.paymentOption || {}\n                        dataRow.set(\"account\", pOption.account || {});\n                        break;\n                    default:\n                        break;\n                }\n                if (e.field) {\n                    this.autoCalculate();\n                }\n            }\n        },\n        async onSaveClose(flag) {\n            if (!this.$refs.form.validate()) {\n                this.$refs.form.validate();\n                return;\n            }\n            let id = \"\";\n            if (this.supplier.hasOwnProperty(\"id\")) {\n                id = this.supplier.id || \"\";\n            }\n            if (id === \"\") {\n                this.$snotify.error(\"supplier is require\");\n                return;\n            }\n            let ds = this.$refs.purchaseDepositDS.kendoWidget();\n            let d1 = ds.data();\n            let dataValidate = 0;\n            d1.forEach((value, index) => {\n                window.console.log(1, value);\n                if (\n                    value.account == undefined ||\n                    value.account.id == undefined ||\n                    value.account.id == null\n                ) {\n                    this.$snotify.error(\"Please check Account  on row \" + (index + 1));\n                } else {\n                    dataValidate += 1;\n                }\n            });\n            if (d1.length == dataValidate) {\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        let itemLineDS = this.$refs.purchaseDepositDS.kendoWidget();\n                        const dataRow = itemLineDS.data().filter((n) => n.amount > 0).map(m => {\n                            return new ItemLineModel(m)\n                        });\n                        // window.console.log(1, dataRow);\n                        if (dataRow.length > 0) {\n                            let isAutoGenerate = 1;\n                            if (this.$route.params.id) {\n                                const tranDate = new Date(this.transactionDate);\n                                const tranDateReceipt = new Date(\n                                    this.purchaseDeposit.transactionDate\n                                );\n                                const tranDateM = tranDate.getFullYear() + tranDate.getMonth();\n                                const tranDateReceiptM =\n                                    tranDateReceipt.getFullYear() + tranDateReceipt.getMonth();\n                                if (tranDateM === tranDateReceiptM) {\n                                    isAutoGenerate = 0;\n                                }\n                            }\n                            let data = {\n                                id: this.purchaseDeposit.id ? this.purchaseDeposit.id : \"\",\n                                type: \"Purchase Deposit\",\n                                uuid: this.purchaseDeposit.uuid\n                                    ? this.purchaseDeposit.uuid\n                                    : \"\",\n                                journal_uuid: this.purchaseDeposit.journal_uuid\n                                    ? this.purchaseDeposit.journal_uuid\n                                    : \"\",\n                                number: this.purchaseDeposit.number,\n                                abbr: this.purchaseDeposit.transactionType.abbr,\n                                transactionDate: this.transactionDate,\n                                transactionDateTZ: Helper.toISODate(this.transactionDate),\n                                supplier: this.supplier,\n                                transactionType: this.purchaseDeposit.transactionType,\n                                itemLine: dataRow,\n                                transactionNote: this.purchaseDeposit.transactionNote,\n                                journalNote: this.purchaseDeposit.journalNote,\n                                referenceNo: this.purchaseDeposit.referenceNo,\n                                amount: this.purchaseDeposit.amount,\n                                currency: this.purchaseDeposit.currency,\n                                exchangeAmount: this.purchaseDeposit.exchangeAmount, // amount to base currency\n                                txnRate: this.purchaseDeposit.txnRate,\n                                purchaseDepositAcc: this.purchaseDeposit.purchaseDepositAcc,\n                                exchangeRate: this.purchaseDeposit.exchangeRate,\n                                segment: this.purchaseDeposit.segment,\n                                location: this.purchaseDeposit.location,\n                                purchaseOrder: this.purchaseDeposit.purchaseOrder,\n                                status: 1,\n                                approvedBy: this.purchaseDeposit.approvedBy,\n                                rejectedBy: this.purchaseDeposit.rejectedBy,\n                                formTemplate: {},\n                                createdAt: this.purchaseDeposit.createdAt,\n                                loggedUser: this.loggedUser,\n                                refFrom: this.purchaseDeposit.refFrom || [],\n                                refTo: this.purchaseDeposit.refTo || [],\n                                isAutoGenerate: isAutoGenerate,\n                                actionType: this.$route.params.id\n                                    ? this.$route.query.type\n                                    : \"new\",\n                            };\n                            this.showLoading = true;\n                            // window.console.log('data', JSON.stringify(data))\n                            billingHandler.createPurchaseDeposit(data).then((response) => {\n                                if (response.data.statusCode === 201) {\n                                    this.showLoading = false;\n                                    this.$snotify.success(\"Successfully\");\n                                    if (flag === \"close\") {\n                                        this.clear();\n                                        this.close();\n                                    } else if (flag === \"new\") {\n                                        this.clear();\n                                    }\n                                }\n                            }).catch((e) => {\n                                this.showLoading = false;\n                                this.$snotify.error(\"Something went wrong\");\n                                this.errors.push(e);\n                            });\n                        }\n                    }, 10);\n                });\n            }\n        },\n        async loadCustomerBalance(id) {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const strFilter = id + \"?type=dep\";\n                    this.depositBalance = 0;\n                    // this.currencyCode = ''\n                    billingHandler\n                        .balance(strFilter)\n                        .then((res) => {\n                            if (res.data.statusCode === 200) {\n                                const data = res.data.data;\n                                if (data.length > 0) {\n                                    this.depositBalance = data[0].balance;\n                                    this.currencyCode = \" \" + data[0].currency;\n                                }\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 10);\n            });\n        },\n        async loadViewDeposit() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    if (this.$route.params.id) {\n                        this.showLoading = true;\n                        const strFilter = \"?id=\" + this.$route.params.id;\n                        billingHandler\n                            .purchaseDepositList(strFilter)\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n\n                                    this.purchaseDeposit = res.data.data[0];\n                                    this.loadPurchaseOrders();\n\n                                    this.decimalFormat = this.purchaseDeposit.decimalFormat;\n                                    this.depositLine = this.purchaseDeposit.itemLines;\n                                    this.supplier = this.purchaseDeposit.supplier;\n                                    this.loadCustomerBalance(this.supplier.id);\n                                    this.transactionDate = this.purchaseDeposit.transactionDate;\n\n                                    // this.onChange(this)\n                                    // this.numberFormat(this.saleDeposit.purchaseOrder, 'amount')\n                                    // this.numberFormat(this.saleDeposit.purchaseOrder, 'currency')\n                                    // this.purchaseOrders = this.saleDeposit.purchaseOrder\n                                }\n                            })\n                            .catch();\n                        {\n                            this.showLoading = false;\n                        }\n                    }\n                }, 10);\n            });\n        },\n        async initData() {\n            if (this.$route.params.id !== undefined) {\n                await this.loadViewDeposit();\n            } else {\n                this.addRow();\n            }\n        },\n        reload() {\n            if (this.$route.params.id !== undefined) {\n                this.loadViewDeposit()\n            } else {\n                this.clear()\n            }\n        }\n    },\n    created() {\n        this.loadAccount();\n        this.loadCurrencyData();\n    },\n    watch: {\n        // id() {\n        //   if (this.$route.params.id === undefined) {\n        //     this.clear();\n        //   } else {\n        //     this.showLoading = true;\n        //     this.loadViewDeposit();\n        //   }\n        // },\n        '$route': 'reload'\n    },\n    mounted: async function () {\n        await this.loadPrefix();\n        await this.loadLocation();\n        await this.loadSegment();\n        await this.loadPaymentOption();\n        this.requestData(0, this.filter, this.cusBaseUrl);\n        await this.initData();\n    },\n    computed: {\n        disableMe() {\n            return !!this.$route.params.id;\n        },\n        amountLineHeaderTemplate() {\n            if (this.purchaseDeposit) {\n                // window.console.log(this.purchaseDeposit.currency)\n                if (this.purchaseDeposit.hasOwnProperty(\"currency\")) {\n                    const currency = this.purchaseDeposit.currency.hasOwnProperty(\"code\")\n                        ? this.purchaseDeposit.currency.code\n                        : \"\";\n                    if (currency) {\n                        return \"Amount (\" + currency + \")\";\n                    } else {\n                        return \"Amount\";\n                    }\n                }\n            }\n            return \"Amount\";\n        },\n        // segment() {\n        //   if (this.purchaseDeposit) {\n        //     if (this.purchaseDeposit.purchaseOrder) {\n        //       if (this.purchaseDeposit.purchaseOrder.hasOwnProperty('segment')) {\n        //         if (this.purchaseDeposit.purchaseOrder.hasOwnProperty('id')) {\n        //           return this.purchaseDeposit.purchaseOrder.segment.name\n        //         }\n        //       }\n        //     }\n        //   }\n        //   return ''\n        // },\n        // location() {\n        //   if (this.purchaseDeposit) {\n        //     if (this.purchaseDeposit.purchaseOrder) {\n        //       if (this.purchaseDeposit.purchaseOrder.hasOwnProperty('location')) {\n        //         if (this.purchaseDeposit.purchaseOrder.location.hasOwnProperty('id')) {\n        //           return this.purchaseDeposit.purchaseOrder.location.name\n        //         }\n        //       }\n        //     }\n        //   }\n        //   return ''\n        // },\n        validSupplier() {\n            let supplier = this.supplier;\n            return supplier.id !== undefined && supplier.id !== null;\n        },\n        hiddenButton() {\n            if (this.$route.params.id) {\n                return true\n            } else {\n                return false\n            }\n        }\n    },\n};\n</script>\n\n<style scoped>\n.theme--light.v-data-table\n> .v-data-table__wrapper\n> table\n> tbody\n> tr:hover:not(.v-data-table__expanded__content):not(.v-data-table__empty-wrapper) {\n    background-color: transparent !important;\n}\n\n.hide_small_bar_class {\n    max-width: 0;\n    transition: 0.5s ease-in;\n    flex: 0 0 0;\n}\n\n.hide_big_bar_class {\n    max-width: 100%;\n    transition: 0.5s ease-in;\n    flex: 0 0 100%;\n}\n\n.small_sidebar {\n    height: 96%;\n    position: relative;\n    padding: 12px;\n    background-color: #edf1f5;\n}\n\n.iconArrow {\n    right: -35px;\n    position: absolute;\n    bottom: -10px;\n}\n\n.iconArrowHide {\n    position: absolute;\n    right: -7px;\n    bottom: -10px;\n}\n\n.detial_smallside_p {\n    position: absolute;\n    bottom: 12px;\n}\n\n.v-data-table__wrapper td {\n    border-bottom: 1px solid #808080;\n    border-top: 1px solid #808080;\n}\n\nelement.style {\n}\n\n.v-list-item .v-list-item__title,\n.v-list-item .v-list-item__subtitle {\n    line-height: 1.2;\n}\n</style>\n"]}]}