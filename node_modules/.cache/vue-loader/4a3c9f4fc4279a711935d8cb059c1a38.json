{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/customers/SaleOrder.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/customers/SaleOrder.vue","mtime":1638760538972},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7aTE4bn0gZnJvbSAiQC9pMThuIjsKaW1wb3J0IERhdGVQaWNrZXJDb21wb25lbnQgZnJvbSAiQC9jb21wb25lbnRzL2N1c3RvbV90ZW1wbGF0ZXMvRGF0ZVBpY2tlckNvbXBvbmVudCI7CmltcG9ydCBrZW5kbyBmcm9tICJAcHJvZ3Jlc3Mva2VuZG8tdWkiOwppbXBvcnQge0Ryb3BEb3duTGlzdH0gZnJvbSAiQHByb2dyZXNzL2tlbmRvLXZ1ZS1kcm9wZG93bnMiOwppbXBvcnQgU2FsZUZvcm1Db250ZW50TW9kZWwgZnJvbSAiQC9zY3JpcHRzL21vZGVsL1NhbGVGb3JtQ29udGVudCI7CmltcG9ydCBJdGVtTGluZU1vZGVsIGZyb20gIkAvc2NyaXB0cy9pbnZvaWNlL21vZGVsL0l0ZW1MaW5lIjsKaW1wb3J0IHt1dWlkfSBmcm9tICJ2dWUtdXVpZCI7CmltcG9ydCBTYWxlT3JkZXJNb2RlbCBmcm9tICJAL3NjcmlwdHMvbW9kZWwvVHJhbnNhY3Rpb24iOwoKLyogU3RvcmUgKi8KaW1wb3J0IHN0b3JlIGZyb20gIkAvc3RvcmUiOwoKY29uc3QgaW5zdGl0dXRlID0gc3RvcmUuc3RhdGUuaW5zdGl0dXRlLmluc3RpdHV0ZTsKCmltcG9ydCB7U2hvd1Jlc291cmNlfSBmcm9tICJAL29ic2VydmFibGUvc3RvcmUiOwppbXBvcnQgcGF5bWVudFRlcm1IYW5kbGVyXyBmcm9tICJAL3NjcmlwdHMvcGF5bWVudHRlcm0vaGFuZGxlci9wYXltZW50VGVybUhhbmRsZXIiOwppbXBvcnQgY3JlZGl0TGltaXRIYW5kbGVyIGZyb20gIkAvc2NyaXB0cy9jcmVkaXRMaW1pdC9oYW5kbGVyL2NyZWRpdExpbWl0SGFuZGxlciI7CmltcG9ydCBIZWxwZXIgZnJvbSAiQC9oZWxwZXIiOwppbXBvcnQgdHJhbnNhY3Rpb25IYW5kbGVyIGZyb20gIkAvc2NyaXB0cy90cmFuc2FjdGlvbkhhbmRsZXIiOwppbXBvcnQge2RhdGFTdG9yZX0gZnJvbSAiQC9vYnNlcnZhYmxlL3N0b3JlIjsKCi8vLy9oYW5kbGVyCmNvbnN0IHNhbGVPcmRlckhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvdHJhbnNhY3Rpb25IYW5kbGVyIik7CmNvbnN0IGJpbGxpbmdIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2ludm9pY2UvaGFuZGxlci9iaWxsaW5nSGFuZGxlciIpOwpjb25zdCBjdXN0b21lckhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvY3VzdG9tZXJIYW5kbGVyIik7CmNvbnN0IHByb2plY3RIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3Byb2plY3RIYW5kbGVyIik7CmNvbnN0IHByZWZpeEhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvcHJlZml4SGFuZGxlciIpOwpjb25zdCBwYXltZW50VGVybUhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvcGF5bWVudFRlcm1IYW5kbGVyIik7CmNvbnN0IHByaWNlTGV2ZWxIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3ByaWNlTGV2ZWxIYW5kbGVyIik7CmNvbnN0IHNhbGVGb3JtQ29udGVudEhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvc2FsZUZvcm1Db250ZW50SGFuZGxlciIpOwpjb25zdCBlbXBsb3llZUhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvZW1wbG95ZWVIYW5kbGVyIik7CmNvbnN0IGl0ZW1Nb2RpZmllckhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvaXRlbU1vZGlmaWVySGFuZGxlciIpOwpjb25zdCBkaXNjb3VudEl0ZW1IYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2Rpc2NvdW50SXRlbUhhbmRsZXIiKTsKY29uc3QgdW9tUHJpY2VIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3VvbVByaWNlSGFuZGxlciIpOwpjb25zdCBwcm9kdWN0VmFyaWFudEhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvcHJvZHVjdFZhcmlhbnRIYW5kbGVyIik7CmNvbnN0IG90aGVyQ2hhcmdlSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9vdGhlckNoYXJnZUhhbmRsZXIiKTsKY29uc3QgbG9jYXRpb25IYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2xvY2F0aW9uSGFuZGxlciIpOwpjb25zdCBzZXR0aW5nc0hhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvc2V0dGluZ3NIYW5kbGVyIik7CmNvbnN0IHNhbGVDaGFubmVsSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9zYWxlQ2hhbm5lbEhhbmRsZXIiKTsKY29uc3Qgc2FsZVVuaXRJdGVtSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9zYWxlVW5pdEl0ZW1IYW5kbGVyIik7CmNvbnN0IHNldHRpbmdIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3NldHRpbmdIYW5kbGVyIik7CmNvbnN0IGNhdGFsb2dIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2NhdGFsb2dIYW5kbGVyIik7CmNvbnN0IHByb2R1Y3RIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3Byb2R1Y3RIYW5kbGVyIik7CmNvbnN0IGN1cnJlbmN5SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9jdXJyZW5jeS9oYW5kbGVyL2N1cnJlbmN5SGFuZGxlciIpOwpjb25zdCBzdXBwbGllckhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvc3VwcGxpZXJIYW5kbGVyIik7Cgpjb25zdCBzYWxlRm9ybUNvbnRlbnRNb2RlbCA9IG5ldyBTYWxlRm9ybUNvbnRlbnRNb2RlbCh7fSk7CmNvbnN0IGl0ZW1MaW5lTW9kZWwgPSBuZXcgSXRlbUxpbmVNb2RlbCh7fSk7Ci8vb3RoZXIKY29uc3QgJCA9IGtlbmRvLmpRdWVyeQpjb25zdCB0ZXh0RmllbGQgPSAibnVtYmVyTmFtZSI7CmNvbnN0IGtleUZpZWxkID0gImlkIjsKY29uc3QgZGVmYXVsdEl0ZW0gPSB7W3RleHRGaWVsZF06ICJTZWxlY3QgQ3VzdG9tZXIuLi4iLCBba2V5RmllbGRdOiBudWxsfTsKY29uc3QgZGVmYXVsdFN1cEl0ZW0gPSB7W3RleHRGaWVsZF06ICJTZWxlY3QgU3VwcGxpZXIuLi4iLCBba2V5RmllbGRdOiBudWxsfTsKY29uc3QgZGVmYXVsdEVtcEl0ZW0gPSB7W3RleHRGaWVsZF06ICJTZWxlY3QgRW1wbG95ZWUuLi4iLCBba2V5RmllbGRdOiBudWxsfTsKY29uc3QgZW1wdHlJdGVtID0ge1t0ZXh0RmllbGRdOiAibG9hZGluZyAuLi4ifTsKY29uc3QgaW52b2ljZVByZWZpeCA9ICJsaW4tIjsKY29uc3QgRElTQ09VTlRfVFlQRSA9ICI/dHlwZT1TYWxlIjsKY29uc3QgY29va2llSlMgPSByZXF1aXJlKCJAL2Nvb2tpZS5qcyIpOwpjb25zdCBjb29raWUgPSBjb29raWVKUy5nZXRDb29raWUoKTsKZXhwb3J0IGRlZmF1bHQgewogICAgbmFtZTogIlNhbGVPcmRlciIsCiAgICBwcm9wczogewogICAgICAgIGlkOiB7CiAgICAgICAgICAgIHR5cGU6IFN0cmluZywKICAgICAgICB9LAogICAgICAgIGluaXRTYWxlT3JkZXI6IHsKICAgICAgICAgICAgdHlwZTogU2FsZU9yZGVyTW9kZWwsCiAgICAgICAgfSwKICAgIH0sCiAgICBjb21wb25lbnRzOiB7CiAgICAgICAgTG9hZGluZ01lOiAoKSA9PiBpbXBvcnQoYEAvY29tcG9uZW50cy9Mb2FkaW5nYCksCiAgICAgICAgImFwcC1kYXRlcGlja2VyIjogRGF0ZVBpY2tlckNvbXBvbmVudCwKICAgICAgICBkcm9wZG93bmxpc3Q6IERyb3BEb3duTGlzdCwKICAgICAgICAiYXBwLW1vbnRob2YtcGlja2VyIjogKCkgPT4gaW1wb3J0KCJAL2NvbXBvbmVudHMva2VuZG9fdGVtcGxhdGVzL01vbnRoT2ZQaWNrZXIiKSwKICAgIH0sCiAgICBkYXRhOiAoKSA9PiAoewogICAgICAgIHNhbGVPcmRlcjogbmV3IFNhbGVPcmRlck1vZGVsKCksCiAgICAgICAgaXNFZGl0OiBmYWxzZSwKICAgICAgICBudW1TZWxlY3Q6IFsxXSwKICAgICAgICBkaWFsb2dUYXg6IGZhbHNlLAogICAgICAgIHRoZURhdGU6ICIiLAogICAgICAgIC8vQ2F0YWxvZwogICAgICAgIGRpYWxvZ0NhdGFsb2c6IGZhbHNlLAogICAgICAgIGdyaWRTY2hlbWE6IHsKICAgICAgICAgICAgbW9kZWw6IHsKICAgICAgICAgICAgICAgIGlkOiAiaWQiLAogICAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgaW1nVVJMOiAiaHR0cHM6Ly9zMy1hcC1zb3V0aGVhc3QtMS5hbWF6b25hd3MuY29tL2ltYWdlcy5iYW5oamkvIiwKICAgICAgICAvLyBMb2FkaW5nTWUKICAgICAgICBzaG93TG9hZGluZzogZmFsc2UsCiAgICAgICAgbG9hZGluZ0FsZXJ0OiBmYWxzZSwKICAgICAgICBsb2FkaW5nQ29sb3JBbGVydDogIiIsCiAgICAgICAgbG9hZGluZ1RleHRBbGVydDogIiIsCiAgICAgICAgYmlsbF9kYXRlOiAiIiwKICAgICAgICBhbGVydDogZmFsc2UsCiAgICAgICAgZmlsZXM6IFtdLAogICAgICAgIGVycm9yczogW10sCiAgICAgICAgLy8gRm9ybSB2YWxpZGF0aW9uCiAgICAgICAgdmFsaWQ6IHRydWUsCiAgICAgICAgdGVtcGxhdGVzOiBbCiAgICAgICAgICAgIHt0aXRsZTogIkRyYWZ0In0sCiAgICAgICAgICAgIHt0aXRsZTogIk9wZW4ifSwKICAgICAgICAgICAge3RpdGxlOiAiUGFydGlhbGx5IENsb3NlZCJ9LAogICAgICAgICAgICB7dGl0bGU6ICJDbG9zZWQifSwKICAgICAgICBdLAogICAgICAgIHNhbGVPcmRlclR5cGU6IDEsCiAgICAgICAgc2FsZU9yZGVyVHlwZXM6IFsKICAgICAgICAgICAge25hbWU6ICJTdGFuZGFyZCBPcmRlciIsIGlkOiAxfSwKICAgICAgICAgICAge25hbWU6ICJPcGVuIE9yZGVyIiwgaWQ6IDJ9LAogICAgICAgICAgICB7bmFtZTogIkNvbnRyYWN0IiwgaWQ6IDN9LAogICAgICAgICAgICB7bmFtZTogIkNvbnNpZ25tZW50IE9yZGVyIiwgaWQ6IDR9LAogICAgICAgICAgICAvLyB7bmFtZTogJ09yZGVyIHJlcXVpcmVkIFB1cmNoYXNlJywgaWQ6IDV9LAogICAgICAgIF0sCiAgICAgICAgaXNSZXF1cmVkUHVyY2hhc2U6IGZhbHNlLAogICAgICAgIGNvbF9leHBhbmQ6IDksCiAgICAgICAgY29sX2hpZGU6IDMsCiAgICAgICAgaXNIaWRlQmFyOiBmYWxzZSwKICAgICAgICBmaWx0ZXI6ICIiLAogICAgICAgIHRleHRGaWVsZDogIm51bWJlck5hbWUiLAogICAgICAgIGRhdGFJdGVtS2V5OiAiaWQiLAogICAgICAgIGRlZmF1bHRJdGVtOiBkZWZhdWx0SXRlbSwKICAgICAgICBkZWZhdWx0U3VwSXRlbTogZGVmYXVsdFN1cEl0ZW0sCiAgICAgICAgZGVmYXVsdEVtcEl0ZW06IGRlZmF1bHRFbXBJdGVtLAogICAgICAgIG1PdGhlckNoYXJnZTogW10sCiAgICAgICAgLy9pdGVtCiAgICAgICAgaXRlbUxpbmVzOiBbXSwKICAgICAgICBpdGVtTGluZTogaXRlbUxpbmVNb2RlbCwKICAgICAgICBkYXRlRm9ybWF0OiBpdGVtTGluZU1vZGVsLmRhdGVGb3JtYXQsCiAgICAgICAgLy9jdXN0b21lcgogICAgICAgIGN1c0Jhc2VVcmw6IGN1c3RvbWVySGFuZGxlci5zZWFyY2goKSwKICAgICAgICBjdXN0b21lcjoge30sCiAgICAgICAgY3VzdG9tZXJMaXN0OiBbXSwKICAgICAgICBzdXBwbGllckxpc3Q6IFtdLAogICAgICAgIHN1cHBsaWVyOiB7fSwKICAgICAgICBzdXBCYXNlVXJsOiBzdXBwbGllckhhbmRsZXIuc2VhcmNoKCksCiAgICAgICAgYmlsbGluZ0FkZHJlc3M6IFtdLAogICAgICAgIGRlbGl2ZXJ5QWRkcmVzczogW10sCiAgICAgICAgcHJpY2VMZXZlbDogW10sCiAgICAgICAgLy9kYXRlCiAgICAgICAgcGF5bWVudFRlcm1zOiBbXSwKICAgICAgICB0cmFuc2FjdGlvbnM6IFtdLAogICAgICAgIGVtcGxveWVlTGlzdDogW10sCiAgICAgICAgZW1wbG95ZWU6IHt9LAogICAgICAgIGVtcEJhc2VVcmw6IGVtcGxveWVlSGFuZGxlci5zZWFyY2hVUkwoKSwKICAgICAgICBzYWxlQ2hhbm5lbExpc3Q6IFtdLAogICAgICAgIGxvY2F0aW9uczogW10sCiAgICAgICAgY3VzdG9tZXJQcm9qZWN0czogW10sCiAgICAgICAgc2VnbWVudHM6IFtdLAogICAgICAgIHRyYW5zYWN0aW9uVHlwZToge30sCiAgICAgICAgdGF4TGlzdFRvdGFsOiB7fSwKICAgICAgICBjdXN0b21lckRpc2NvdW50SXRlbTogW10sCiAgICAgICAgY3VzdG9tZXJTYWxlVW5pdDogW10sCiAgICAgICAgc2FsZUZvcm1Db250ZW50OiBzYWxlRm9ybUNvbnRlbnRNb2RlbCwKICAgICAgICB0cmFuc2FjdGlvbkRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zdWJzdHIoMCwgMTApLAogICAgICAgIG1vbnRoT2Y6IGZhbHNlLAogICAgICAgIGRlbGl2ZXJ5RGF0ZVRpbWU6IG5ldyBEYXRlKCksCiAgICAgICAgdmFsaWRpdHlEYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3Vic3RyKDAsIDEwKSwKICAgICAgICBzcGVjaWZpY0Rpc2NvdW50SXRlbTogW10sCiAgICAgICAgb3RoZXJDaGFyZ2VMaXN0OiBbXSwKICAgICAgICBzYWxlVW5pdEl0ZW1MaXN0OiBbXSwKICAgICAgICBvdGhlclRheDogW10sCiAgICAgICAgc3BlY2lmaWNUYXg6IFtdLAogICAgICAgIHB1YmxpY0xpZ2h0aW5nVGF4OiBbXSwKICAgICAgICB2YXRUYXg6IFtdLAogICAgICAgIHRheDogW10sCiAgICAgICAgbG9nZ2VkVXNlcjogewogICAgICAgICAgICBpZDogY29va2llLmNyZWF0b3IsCiAgICAgICAgICAgIG5hbWU6IGNvb2tpZS5lbWFpbCwKICAgICAgICB9LAogICAgICAgIGxlYWRzOiBbXSwKICAgICAgICBjYXRhbG9nczogW10sCiAgICAgICAgdHhuTGlzdDogW10sCiAgICAgICAgcXVvdGVzOiBbXSwKICAgICAgICB0eG5MaXN0czogW10sCiAgICAgICAgaXNTYXZlTmV3OiBmYWxzZSwKICAgICAgICBpc1NhdmVDbG9zZTogZmFsc2UsCiAgICAgICAgaXNTYXZlUHJpbnQ6IGZhbHNlLAogICAgICAgIGlzU2F2ZURyYWZ0OiBmYWxzZSwKICAgICAgICBleGNoYW5nZVJhdGU6IHt9LAogICAgICAgIGJhc2VDdXJyZW5jeUNvZGU6ICIiLAogICAgICAgIGN1cnJlbmN5Q29kZTogIiIsCiAgICAgICAgdHJhbnNhY3Rpb25SYXRlOiAxLAogICAgICAgIHNhdmVPcHRpb246ICIiLAogICAgICAgIGZvcm1BUjogWwogICAgICAgICAgICB7aWQ6IDEsIG5hbWU6ICJEZWZhdWx0IEZvcm0ifSwKICAgICAgICAgICAge2lkOiAyLCBuYW1lOiAiRm9ybSA4MG1tIn0sCiAgICAgICAgXSwKICAgICAgICBpc1ByaWNlTGV2ZWxDaGFuZ2VkOiBmYWxzZSwKICAgICAgICByZWZGcm9tOiBbXSwgLy8gY2FuIFNPIGNhbiBiZSBmcm9tIFNhbGUgUXVvdGVzCiAgICAgICAgYnRuRGlzYWJsZWQ6IGZhbHNlCiAgICB9KSwKICAgIG1ldGhvZHM6IHsKICAgICAgICBmb3JtYXREYXRlVGltZSh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcobmV3IERhdGUodmFsdWUpLCB0aGlzLmRhdGVGb3JtYXQgKyBgIGhoOm1tIHR0YCk7CiAgICAgICAgfSwKICAgICAgICBhbW91bnRGb3JtYXQodmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIGtlbmRvLnRvU3RyaW5nKHZhbHVlLmFtb3VudCwgYG4ke3RoaXMuc2FsZUZvcm1Db250ZW50LmRlY2ltYWx9YCk7CiAgICAgICAgfSwKICAgICAgICBwcmljZUZvcm1hdCh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcodmFsdWUucHJpY2UsIGBuJHt0aGlzLnNhbGVGb3JtQ29udGVudC5kZWNpbWFsfWApOwogICAgICAgIH0sCiAgICAgICAgSGVscChrZXlfc2VhcmNoKSB7CiAgICAgICAgICAgIFNob3dSZXNvdXJjZShrZXlfc2VhcmNoKTsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxEYXRhKCkgewogICAgICAgICAgICBpZiAodGhpcy5pbml0U2FsZU9yZGVyKSB7CiAgICAgICAgICAgICAgICAvLyBFZGl0IE1vZGUKICAgICAgICAgICAgICAgIHRoaXMuc2FsZU9yZGVyID0gdGhpcy5pbml0U2FsZU9yZGVyOwogICAgICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIuY3JlZGl0TGltaXQgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIuY3VycmVudEJhbGFuY2UgPSAwOwogICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKHRoaXMuaW5pdFNhbGVPcmRlciwgJ3Byb3BEYXRhJykKICAgICAgICAgICAgICAgIHRoaXMuYmluZERhdGEoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEJyYW5kIE5ldyBNb2RlCiAgICAgICAgICAgICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldERlZmF1bHREYXRhKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHNldERlZmF1bHREYXRhKCkgewogICAgICAgICAgICAvLyBCcmFuZCBOZXcgTW9kZQogICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coJ2RlZmF1bHQgb3IgY2xlYXInKQogICAgICAgICAgICB0aGlzLmlzRWRpdCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLnNhbGVPcmRlciA9IG5ldyBTYWxlT3JkZXJNb2RlbCh7fSk7CiAgICAgICAgICAgIC8vc2FsZSBvcmRlciB0eXBlCiAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIuc2FsZU9yZGVyVHlwZSA9IDE7CiAgICAgICAgICAgICAgICB0aGlzLnNhbGVPcmRlclR5cGUgPSAxOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuYXBwVHlwZSA9PT0gJ25wbycgfHwgdGhpcy5hcHBUeXBlID09PSAnUHVibGlzaCBTZWN0b3JzJyl7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIuc2FsZU9yZGVyVHlwZSA9IDM7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXJUeXBlID0gMzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnNhbGVPcmRlci5kZWxpdmVyeURhdGVUaW1lID0gbmV3IERhdGUoKTsKICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIuZm9ybVRlbXBsYXRlID0gMTsKICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIudHJhbnNhY3Rpb25EYXRlID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnN1YnN0cigwLCAxMCk7CiAgICAgICAgICAgIC8vIEdlbmVyYXRlIE51bWJlcgogICAgICAgICAgICB0aGlzLml0ZW1MaW5lcyA9IFtdCiAgICAgICAgICAgIC8vIGxldCBkcyA9IHRoaXMuJHJlZnMuaXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICAvLyBkcy5kYXRhKFtdKTsKICAgICAgICAgICAgLy8gQWRkIDIgZGVmYXVsdCBsaW5lcwogICAgICAgICAgICB0aGlzLnJlbW92ZUVtcHR5TGluZSgpCiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5hZGRSb3coKQogICAgICAgICAgICAgICAgLy8gdGhpcy5hZGRSb3coKQogICAgICAgICAgICB9LCA1MDApCiAgICAgICAgICAgIC8vIEFkZCAyIGRlZmF1bHQgbGluZXMKICAgICAgICAgICAgdGhpcy5vdGhlckNoYXJnZUxpc3QgPSBbXTsKICAgICAgICAgICAgdGhpcy5tT3RoZXJDaGFyZ2UgPSBbXTsKICAgICAgICAgICAgdGhpcy5lbXBsb3llZSA9IHt9OwogICAgICAgICAgICB0aGlzLnRheExpc3RUb3RhbCA9IHt9OwogICAgICAgICAgICB0aGlzLnF1b3RlcyA9IFtdOwogICAgICAgICAgICB0aGlzLmlzU2F2ZU5ldyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmlzU2F2ZUNsb3NlID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuaXNTYXZlUHJpbnQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5pc1NhdmVEcmFmdCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmNyZWRpdExpbWl0VXNhZ2UoMCwgMSk7CiAgICAgICAgICAgIHRoaXMuaXNSZXF1cmVkUHVyY2hhc2UgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5jdXN0b21lciA9IHt9CiAgICAgICAgfSwKICAgICAgICBiaW5kRGF0YSgpIHsKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKHRoaXMuc2FsZU9yZGVyLCAnYmluZERhdGEnKQogICAgICAgICAgICAvLyBFZGl0IE1vZGUKICAgICAgICAgICAgaWYgKHRoaXMuc2FsZU9yZGVyKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5zYWxlT3JkZXIuaGFzT3duUHJvcGVydHkoImN1c3RvbWVyIikpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlzRWRpdCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXN0b21lciA9IHRoaXMuc2FsZU9yZGVyLmN1c3RvbWVyOwogICAgICAgICAgICAgICAgICAgIC8vIGxldCBlID0ge3ZhbHVlOiB0aGlzLnNhbGVPcmRlci5jdXN0b21lcn0KICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLm9uQ2hhbmdlKGUpCiAgICAgICAgICAgICAgICAgICAgdGhpcy5iaWxsaW5nQWRkcmVzcyA9IHRoaXMuc2FsZU9yZGVyLmN1c3RvbWVyLmJpbGxpbmdBZGRyZXNzOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZGVsaXZlcnlBZGRyZXNzID0gdGhpcy5zYWxlT3JkZXIuY3VzdG9tZXIuZGVsaXZlcnlBZGRyZXNzOwogICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuY3VzdG9tZXJQcm9qZWN0cyA9IHRoaXMuc2FsZU9yZGVyLmN1c3RvbWVyLgogICAgICAgICAgICAgICAgICAgIHRoaXMudGF4TGlzdFRvdGFsID0gdGhpcy5zYWxlT3JkZXIudGF4TGlzdFRvdGFsOwogICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbUxpbmVzID0gdGhpcy5zYWxlT3JkZXIuaXRlbUxpbmVzOwogICAgICAgICAgICAgICAgICAgIHRoaXMubU90aGVyQ2hhcmdlID0gdGhpcy5zYWxlT3JkZXIub3RoZXJDaGFyZ2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkUHJvamVjdEJ5Q3VzdG9tZXIoKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXN0b21lci5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRDdXN0b21lckJhbGFuY2UodGhpcy5jdXN0b21lci5pZCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhZGRTZWxlY3QoKSB7CiAgICAgICAgICAgIGxldCBhbW91bnRfbnVtID0gdGhpcy5udW1TZWxlY3QubGVuZ3RoOwogICAgICAgICAgICBsZXQgbnVtID0gdGhpcy5udW1TZWxlY3RbYW1vdW50X251bSAtIDFdOwogICAgICAgICAgICBsZXQgbmV3X251bSA9IG51bSArIDE7CiAgICAgICAgICAgIGxldCBsZW5naHRJdGVtID0gdGhpcy5zcGVjaWZpY0Rpc2NvdW50SXRlbS5sZW5ndGg7CiAgICAgICAgICAgIGlmIChuZXdfbnVtIDw9IGxlbmdodEl0ZW0pIHsKICAgICAgICAgICAgICAgIHRoaXMubnVtU2VsZWN0LnB1c2gobmV3X251bSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHJlbW92ZVNlbGVjdChpbmRleCkgewogICAgICAgICAgICB0aGlzLm51bVNlbGVjdC5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coaW5kZXgsIHRoaXMubnVtU2VsZWN0KQogICAgICAgICAgICAvLyB0aGlzLnNlbGVjdERpc2NvdW50LnNwbGljZShpbmRleCwxKQogICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coInJlbW92ZSIsdGhpcy5zZWxlY3REaXNjb3VudCkKICAgICAgICAgICAgLy8gdGhpcy5zZWxlY3REaXNjb3VudCA9IHRoaXMuc2VsZWN0RGlzY291bnQuZmlsdGVyKGl0ZW0gPT4gIGl0ZW0uaWQgIT0gdmFsLmlkKTsKICAgICAgICB9LAogICAgICAgIGVycm9yTWVzc2FnZSgpIHsKICAgICAgICB9LAogICAgICAgIGFjY291bnREcm9wRG93bkVkaXRvcigpIHsKICAgICAgICB9LAogICAgICAgIGhpZGVfc21hbGxzaXRlYmFyKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuaXNIaWRlQmFyKSB7CiAgICAgICAgICAgICAgICAvLyB0aGlzLmNvbF9leHBhbmQgPSAxMgogICAgICAgICAgICAgICAgLy8gdGhpcy5jb2xfaGlkZSA9IDAKICAgICAgICAgICAgICAgIHRoaXMuaXNIaWRlQmFyID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIHRoaXMuY29sX2V4cGFuZCA9IDkKICAgICAgICAgICAgICAgIC8vIHRoaXMuY29sX2hpZGUgPSAzCiAgICAgICAgICAgICAgICB0aGlzLmlzSGlkZUJhciA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAvL251bWJlcgogICAgICAgIGdlbmVyYXRlTnVtYmVyKCkgewogICAgICAgICAgICBpZiAodGhpcy5pc0VkaXQgPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIGxldCBkID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnN1YnN0cigwLCAxMCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5zYWxlT3JkZXIudHJhbnNhY3Rpb25EYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKHRoaXMudHJhbnNhY3Rpb25EYXRlKQogICAgICAgICAgICAgICAgICAgIGQgPSB0aGlzLnNhbGVPcmRlci50cmFuc2FjdGlvbkRhdGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICBhYmJyOiB0aGlzLnNhbGVPcmRlci50cmFuc2FjdGlvblR5cGUuYWJiciwKICAgICAgICAgICAgICAgICAgICBzdHJ1Y3R1cmU6IHRoaXMuc2FsZU9yZGVyLnRyYW5zYWN0aW9uVHlwZS5zdHJ1Y3R1cmUsCiAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25EYXRlOiBkLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJTYWxlIE9yZGVyIiwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBiaWxsaW5nSGFuZGxlcgogICAgICAgICAgICAgICAgICAgIC5sYXN0TnVtYmVyKGRhdGEpCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGFzdE51bWJlciA9IHRoaXMuemVyb1BhZCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUludChyZXMubGFzdE51bWJlciksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIudHJhbnNhY3Rpb25UeXBlLmZvcm1hdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG51bWJlciA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnN1ZmZpeCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIudHJhbnNhY3Rpb25UeXBlLm51bWJlclNlcGFyYXRvciArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdE51bWJlcjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2FsZU9yZGVyLm51bWJlciA9IG51bWJlcjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JzLnB1c2goZSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHplcm9QYWQobnVtLCBwbGFjZXMpIHsKICAgICAgICAgICAgcmV0dXJuIFN0cmluZyhudW0pLnBhZFN0YXJ0KHBsYWNlcywgIjAiKTsKICAgICAgICB9LAogICAgICAgIC8vY3VzdG9tZXIKICAgICAgICBvbkNoYW5nZShldmVudCkgewogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coZXZlbnQpOwogICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGV2ZW50LnZhbHVlOwogICAgICAgICAgICBpZiAodmFsdWUgJiYgdmFsdWVbdGV4dEZpZWxkXSA9PT0gZW1wdHlJdGVtW3RleHRGaWVsZF0pIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmN1c3RvbWVyID0gdmFsdWU7CiAgICAgICAgICAgIHRoaXMuc2FsZU9yZGVyLmN1c3RvbWVyID0gdmFsdWU7CiAgICAgICAgICAgIC8vIHRoaXMuaW52b2ljZSA9IHZhbHVlCiAgICAgICAgICAgIC8vIHRoaXMuc2FsZU9yZGVyLnBheW1lbnRUZXJtID0gdmFsdWUuaGFzT3duUHJvcGVydHkoInBheW1lbnRUZXJtIikKICAgICAgICAgICAgLy8gICA/IHZhbHVlLnBheW1lbnRUZXJtCiAgICAgICAgICAgIC8vICAgOiB7fTsKICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIucHJpY2VMZXZlbCA9IHZhbHVlLmhhc093blByb3BlcnR5KCJwcmljZUxldmVsIikKICAgICAgICAgICAgICAgID8gdmFsdWUucHJpY2VMZXZlbAogICAgICAgICAgICAgICAgOiB7fTsKICAgICAgICAgICAgY29uc3QgYmFzZUN1cnJlbmN5ID0gdmFsdWUuaGFzT3duUHJvcGVydHkoImJhc2VDdXJyZW5jeSIpCiAgICAgICAgICAgICAgICA/IHZhbHVlLmJhc2VDdXJyZW5jeQogICAgICAgICAgICAgICAgOiB7fTsKICAgICAgICAgICAgaWYgKGJhc2VDdXJyZW5jeS5oYXNPd25Qcm9wZXJ0eSgiY29kZSIpKSB7CiAgICAgICAgICAgICAgICB0aGlzLmJhc2VDdXJyZW5jeUNvZGUgPSBiYXNlQ3VycmVuY3kuY29kZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBwcmljZUxldmVsID0gdmFsdWUuaGFzT3duUHJvcGVydHkoInByaWNlTGV2ZWwiKQogICAgICAgICAgICAgICAgPyB2YWx1ZS5wcmljZUxldmVsCiAgICAgICAgICAgICAgICA6IHt9OwogICAgICAgICAgICBpZiAocHJpY2VMZXZlbC5oYXNPd25Qcm9wZXJ0eSgiY3VycmVuY3kiKSkgewogICAgICAgICAgICAgICAgaWYgKHByaWNlTGV2ZWwuY3VycmVuY3kuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRUcmFuc2FjdGlvblJhdGUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmJpbGxpbmdBZGRyZXNzID0gdmFsdWUuaGFzT3duUHJvcGVydHkoImJpbGxpbmdBZGRyZXNzIikKICAgICAgICAgICAgICAgID8gdmFsdWUuYmlsbGluZ0FkZHJlc3MKICAgICAgICAgICAgICAgIDogW107CiAgICAgICAgICAgIHRoaXMuZGVsaXZlcnlBZGRyZXNzID0gdmFsdWUuaGFzT3duUHJvcGVydHkoImRlbGl2ZXJ5QWRkcmVzcyIpCiAgICAgICAgICAgICAgICA/IHZhbHVlLmRlbGl2ZXJ5QWRkcmVzcwogICAgICAgICAgICAgICAgOiBbXTsKICAgICAgICAgICAgaWYgKHRoaXMuYmlsbGluZ0FkZHJlc3MubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIuYmlsbGluZ0FkZHJlc3MgPSB0aGlzLmJpbGxpbmdBZGRyZXNzWzBdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLmRlbGl2ZXJ5QWRkcmVzcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNhbGVPcmRlci5kZWxpdmVyeUFkZHJlc3MgPSB0aGlzLmRlbGl2ZXJ5QWRkcmVzc1swXTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLm9uU2FsZU9yZGVyRGF0ZUNoYW5nZWQoKTsKICAgICAgICAgICAgdGhpcy5sb2FkUHJvamVjdEJ5Q3VzdG9tZXIoKTsKICAgICAgICAgICAgLy8gY29uc3QgY3JlZGl0TGltaXQgPSB2YWx1ZS5oYXNPd25Qcm9wZXJ0eSgiY3JlZGl0TGltaXQiKQogICAgICAgICAgICAvLyAgID8gdmFsdWUuY3JlZGl0TGltaXQKICAgICAgICAgICAgLy8gICA6IDA7CiAgICAgICAgICAgIC8vIHRoaXMuc2FsZU9yZGVyLmNyZWRpdExpbWl0ID0ga2VuZG8ucGFyc2VGbG9hdChjcmVkaXRMaW1pdCk7CiAgICAgICAgICAgIHRoaXMubG9hZENyZWRpdExpbWl0KCk7CiAgICAgICAgICAgIHRoaXMubG9hZEN1c3RvbWVyQmFsYW5jZSh0aGlzLmN1c3RvbWVyLmlkKTsKICAgICAgICAgICAgLy8gbG9hZCBxdW90ZQogICAgICAgICAgICB0aGlzLmxvYWRRdW90ZSgpOwogICAgICAgICAgICB0aGlzLmxvYWRQYXltZW50VGVybUxpc3QoKTsKICAgICAgICB9LAogICAgICAgIG9uRmlsdGVyQ2hhbmdlKGV2ZW50KSB7CiAgICAgICAgICAgIGNvbnN0IGZpbHRlciA9IGV2ZW50LmZpbHRlci52YWx1ZTsKICAgICAgICAgICAgdGhpcy5yZXF1ZXN0RGF0YSgwLCBmaWx0ZXIsIHRoaXMuY3VzQmFzZVVybCk7CiAgICAgICAgICAgIHRoaXMuZmlsdGVyID0gZmlsdGVyOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgcmVxdWVzdERhdGEoc2tpcCwgZmlsdGVyLCBiYXNlVXJsKSB7CiAgICAgICAgICAgIGxldCB1cmwgPSBiYXNlVXJsICsgYD9maWx0ZXI9JHtmaWx0ZXJ9YDsKICAgICAgICAgICAgaWYodGhpcy5hcHBUeXBlID09PSAnbnBvJyl7CiAgICAgICAgICAgICAgICB1cmwgPSBiYXNlVXJsICsgYD9maWx0ZXI9JHtmaWx0ZXJ9JmlzX2Rvbm9yPXRydWVgOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMucmVxdWVzdFN0YXJ0ZWQgPSB0cnVlOwogICAgICAgICAgICBmZXRjaCh1cmwpCiAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC50aGVuKHRoaXMuYWZ0ZXJGZXRjaCk7CiAgICAgICAgfSwKICAgICAgICBhZnRlckZldGNoKGpzb24pIHsKICAgICAgICAgICAgdGhpcy5jdXN0b21lckxpc3QgPSBqc29uLmRhdGE7CiAgICAgICAgfSwKICAgICAgICAvL3N1cHBsaWVyCiAgICAgICAgb25TdXBwbGllckNoYW5nZShldmVudCkgewogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coZXZlbnQpOwogICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGV2ZW50LnZhbHVlOwogICAgICAgICAgICBpZiAodmFsdWUgJiYgdmFsdWVbdGV4dEZpZWxkXSA9PT0gZW1wdHlJdGVtW3RleHRGaWVsZF0pIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnN1cHBsaWVyID0gdmFsdWU7CiAgICAgICAgICAgIHRoaXMuc2FsZU9yZGVyLnN1cHBsaWVyID0gdmFsdWU7CiAgICAgICAgfSwKICAgICAgICBvblN1cHBsaWVyRmlsdGVyQ2hhbmdlKGV2ZW50KSB7CiAgICAgICAgICAgIGNvbnN0IHN1cGZpbHRlciA9IGV2ZW50LmZpbHRlci52YWx1ZTsKICAgICAgICAgICAgdGhpcy5zdXBwbGllclJlcXVlc3REYXRhKDAsIHN1cGZpbHRlciwgdGhpcy5zdXBCYXNlVXJsKTsKICAgICAgICB9LAogICAgICAgIHN1cHBsaWVyUmVxdWVzdERhdGEoc2tpcCwgZmlsdGVyLCBiYXNlVXJsKSB7CiAgICAgICAgICAgIGNvbnN0IHVybCA9IGJhc2VVcmwgKyBgP2ZpbHRlcj0ke2ZpbHRlcn1gOwogICAgICAgICAgICB0aGlzLnJlcXVlc3RTdGFydGVkID0gdHJ1ZTsKICAgICAgICAgICAgZmV0Y2godXJsKQogICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAudGhlbih0aGlzLnN1cEFmdGVyRmV0Y2gpOwogICAgICAgIH0sCiAgICAgICAgc3VwQWZ0ZXJGZXRjaChqc29uKSB7CiAgICAgICAgICAgIHRoaXMuc3VwcGxpZXJMaXN0ID0ganNvbi5kYXRhOwogICAgICAgIH0sCiAgICAgICAgLy9lbXBsb3llZQogICAgICAgIG9uRW1wbG95ZWVDaGFuZ2UoZXZlbnQpIHsKICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBldmVudC52YWx1ZTsKICAgICAgICAgICAgaWYgKHZhbHVlICYmIHZhbHVlW3RleHRGaWVsZF0gPT09IGVtcHR5SXRlbVt0ZXh0RmllbGRdKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5lbXBsb3llZSA9IHZhbHVlOwogICAgICAgICAgICB0aGlzLnNhbGVPcmRlci5lbXBsb3llZSA9IHZhbHVlOwogICAgICAgIH0sCiAgICAgICAgb25FbXBsb3llZUZpbHRlckNoYW5nZWQoZXZlbnQpIHsKICAgICAgICAgICAgY29uc3QgZW1wZmlsdGVyID0gZXZlbnQuZmlsdGVyLnZhbHVlOwogICAgICAgICAgICB0aGlzLmVtcGxveWVlUmVxdWVzdERhdGEoMCwgZW1wZmlsdGVyLCB0aGlzLmVtcEJhc2VVcmwpOwogICAgICAgIH0sCiAgICAgICAgZW1wbG95ZWVSZXF1ZXN0RGF0YShza2lwLCBmaWx0ZXIsIGJhc2VVcmwpIHsKICAgICAgICAgICAgY29uc3QgdXJsID0gYmFzZVVybCArIGA/ZmlsdGVyPSR7ZmlsdGVyfWA7CiAgICAgICAgICAgIHRoaXMucmVxdWVzdFN0YXJ0ZWQgPSB0cnVlOwogICAgICAgICAgICBmZXRjaCh1cmwpCiAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC50aGVuKHRoaXMuZW1wQWZ0ZXJGZXRjaCk7CiAgICAgICAgfSwKICAgICAgICBlbXBBZnRlckZldGNoKGpzb24pIHsKICAgICAgICAgICAgdGhpcy5lbXBsb3llZUxpc3QgPSBqc29uLmRhdGE7CiAgICAgICAgfSwKICAgICAgICByZW1vdmVSb3coZSkgewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGNvbnN0IGdyaWQgPSBrZW5kby5qUXVlcnkoIiNncmlkSXRlbUxpbmVTYWxlT3JkZXIiKS5kYXRhKCJrZW5kb0dyaWQiKSwKICAgICAgICAgICAgICAgIGRhdGFTb3VyY2UgPSBncmlkLmRhdGFTb3VyY2UsCiAgICAgICAgICAgICAgICBkYXRhSXRlbSA9IGdyaWQuZGF0YUl0ZW0oJChlLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoInRyIikpOwoKICAgICAgICAgICAgaWYgKGRhdGFTb3VyY2UudG90YWwoKSA+IDEpIHsKICAgICAgICAgICAgICAgIGRhdGFTb3VyY2UucmVtb3ZlKGRhdGFJdGVtKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmF1dG9DYWxjdWxhdGUoKQogICAgICAgIH0sCiAgICAgICAgLy9kYXRlCiAgICAgICAgYXN5bmMgb25TYWxlT3JkZXJEYXRlQ2hhbmdlZCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuc2FsZU9yZGVyLnRyYW5zYWN0aW9uRGF0ZSkgewogICAgICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIubW9udGhPZiA9IG5ldyBEYXRlKHRoaXMuc2FsZU9yZGVyLnRyYW5zYWN0aW9uRGF0ZSkudG9JU09TdHJpbmcoKS5zdWJzdHIoMCwgNykKICAgICAgICAgICAgfQogICAgICAgICAgICBhd2FpdCB0aGlzLmxvYWRDcmVkaXRMaW1pdCgpOwogICAgICAgICAgICBhd2FpdCB0aGlzLmxvYWRDdXN0b21lckJhbGFuY2UodGhpcy5jdXN0b21lci5pZCk7CiAgICAgICAgICAgIGF3YWl0IHRoaXMub25QcmljZUxldmVsQ2hhbmdlKCk7CiAgICAgICAgICAgIGF3YWl0IHRoaXMubG9hZFBheW1lbnRUZXJtTGlzdCgpOwogICAgICAgICAgICBpZiAodGhpcy5jdXN0b21lcikgewogICAgICAgICAgICAgICAgY29uc3QgcGF5bWVudFRlcm0gPSB0aGlzLnNhbGVPcmRlci5wYXltZW50VGVybSB8fCB7fTsKICAgICAgICAgICAgICAgIGNvbnN0IG5ldER1ZSA9IHBheW1lbnRUZXJtLm5ldER1ZSB8fCAwOwogICAgICAgICAgICAgICAgY29uc3Qgc29tZURhdGUgPSBuZXcgRGF0ZSh0aGlzLnNhbGVPcmRlci50cmFuc2FjdGlvbkRhdGUpOwogICAgICAgICAgICAgICAgc29tZURhdGUuc2V0RGF0ZShzb21lRGF0ZS5nZXREYXRlKCkgKyBwYXJzZUludChuZXREdWUpKTsgLy9udW1iZXIgIG9mIGRheXMgdG8gYWRkLCBlLnguIDE1IGRheXMKICAgICAgICAgICAgICAgIHRoaXMuc2FsZU9yZGVyLnZhbGlkaXR5RGF0ZSA9IHNvbWVEYXRlLnRvSVNPU3RyaW5nKCkuc3Vic3RyKDAsIDEwKTsKICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygiZHVlRGF0ZSIsIHRoaXMuc2FsZU9yZGVyLnZhbGlkaXR5RGF0ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlTnVtYmVyKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIG9uUGF5bWVudFRlcm1DaGFuZ2VkKCkgewogICAgICAgICAgICAvLyB0aGlzLm9uU2FsZU9yZGVyRGF0ZUNoYW5nZWQoKTsKICAgICAgICAgICAgaWYgKHRoaXMuY3VzdG9tZXIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBheW1lbnRUZXJtID0gdGhpcy5zYWxlT3JkZXIucGF5bWVudFRlcm0gfHwge307CiAgICAgICAgICAgICAgICBjb25zdCBuZXREdWUgPSBwYXltZW50VGVybS5uZXREdWUgfHwgMDsKICAgICAgICAgICAgICAgIGNvbnN0IHNvbWVEYXRlID0gbmV3IERhdGUodGhpcy5zYWxlT3JkZXIudHJhbnNhY3Rpb25EYXRlKTsKICAgICAgICAgICAgICAgIHNvbWVEYXRlLnNldERhdGUoc29tZURhdGUuZ2V0RGF0ZSgpICsgcGFyc2VJbnQobmV0RHVlKSk7IC8vbnVtYmVyICBvZiBkYXlzIHRvIGFkZCwgZS54LiAxNSBkYXlzCiAgICAgICAgICAgICAgICB0aGlzLnNhbGVPcmRlci52YWxpZGl0eURhdGUgPSBzb21lRGF0ZS50b0lTT1N0cmluZygpLnN1YnN0cigwLCAxMCk7CiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coImR1ZURhdGUiLCB0aGlzLnNhbGVPcmRlci52YWxpZGl0eURhdGUpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAvL251bWJlcgogICAgICAgIG51bWJlckZvcm1hdCh2YWx1ZSkgewogICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2codGhpcy5zYWxlRm9ybUNvbnRlbnQuZGVjaW1hbCwnbmltb2wnKQogICAgICAgICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcodmFsdWUsIGBuJHt0aGlzLnNhbGVGb3JtQ29udGVudC5kZWNpbWFsfWApOwogICAgICAgICAgICAvLyByZXR1cm4gdmFsdWUKICAgICAgICB9LAogICAgICAgIC8vCiAgICAgICAgYXN5bmMgbG9hZExlYWQoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0ckZpbHRlciA9ICI/dHlwZT1TYWxlIExlYWQiOwogICAgICAgICAgICAgICAgICAgIHRoaXMubGVhZHMgPSBbXTsKICAgICAgICAgICAgICAgICAgICBiaWxsaW5nSGFuZGxlci5saXN0KHN0ckZpbHRlcikudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxlYWRzID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRQYXltZW50VGVybSgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgcGF5bWVudFRlcm1IYW5kbGVyLmdldEFsbCgpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGF5bWVudFRlcm1zID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucGF5bWVudFRlcm1zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgIT09IHVuZGVmaW5lZCB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlLnBhcmFtcy5pZCAhPSAiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2FsZU9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2FsZU9yZGVyLnBheW1lbnRUZXJtID0gdGhpcy5wYXltZW50VGVybXNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFByaWNlTGV2ZWwoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0ckZpbHRlciA9ICI/bmF0dXJlPXNhbGUiOwogICAgICAgICAgICAgICAgICAgIHByaWNlTGV2ZWxIYW5kbGVyLmdldChzdHJGaWx0ZXIpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByaWNlTGV2ZWwgPSByZXM7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnByaWNlTGV2ZWwubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlLnBhcmFtcy5pZCAhPT0gdW5kZWZpbmVkIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGUucGFyYW1zLmlkICE9ICIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zYWxlT3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIucHJpY2VMZXZlbCA9IHRoaXMucHJpY2VMZXZlbFswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkVHJhbnNhY3Rpb25SYXRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICByZW1vdmVEdXBsaWNhdGUoYXJyYXkpIHsKICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gW107CiAgICAgICAgICAgIGNvbnN0IG1hcCA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGFycmF5KSB7CiAgICAgICAgICAgICAgICBpZiAoIW1hcC5oYXMoaXRlbS5pZCkpIHsKICAgICAgICAgICAgICAgICAgICBtYXAuc2V0KGl0ZW0uaWQsIHRydWUpOyAvLyBzZXQgYW55IHZhbHVlIHRvIE1hcAogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfSwKICAgICAgICBhdXRvQ2FsY3VsYXRlRGlzY291bnQoZGlzY291bnRJdGVtLCBzdWJUb3RhbCkgewogICAgICAgICAgICBpZiAoZGlzY291bnRJdGVtKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coJ2Rpc2NvdW50SXRlbScsIGRpc2NvdW50SXRlbSwgc3ViVG90YWwpCiAgICAgICAgICAgICAgICBjb25zdCBuYXR1cmUgPSBkaXNjb3VudEl0ZW0ubmF0dXJlIHx8ICcnOwogICAgICAgICAgICAgICAgY29uc3QgYW1vdW50ID0gZGlzY291bnRJdGVtLmFtb3VudCB8fCAwOwogICAgICAgICAgICAgICAgaWYgKG5hdHVyZSA9PT0gIkFtb3VudCIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChhbW91bnQpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuYXR1cmUgPT09ICJQZXJjZW50YWdlIikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdWJUb3RhbCAqIChwYXJzZUZsb2F0KGFtb3VudCkgLyAxMDApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYXV0b0NhbGN1bGF0ZVRheCh0YXgsIGFtb3VudCkgewogICAgICAgICAgICBpZiAodGF4KSB7CiAgICAgICAgICAgICAgICB2YXIgZm9ybXVsYSA9IHRheC5mb3JtdWxhOwogICAgICAgICAgICAgICAgdmFyIGluQW10ID0ga2VuZG8ucGFyc2VGbG9hdChhbW91bnQpOwogICAgICAgICAgICAgICAgdmFyIG5BbXQgPSBrZW5kby5wYXJzZUZsb2F0KGFtb3VudCk7CiAgICAgICAgICAgICAgICB2YXIgdGF4QmFzZSA9IGtlbmRvLnBhcnNlRmxvYXQodGF4LnRheEJhc2UpIC8gMTAwOwogICAgICAgICAgICAgICAgdmFyIHJhdGUgPSBrZW5kby5wYXJzZUZsb2F0KHRheC5yYXRlKSAvIDEwMDsKICAgICAgICAgICAgICAgIHZhciB0b3RhbCA9IGV2YWwoZm9ybXVsYSk7CiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coaW5BbXQsIG5BbXQsIHRheEJhc2UsIHJhdGUsIGZvcm11bGEsIHRvdGFsKTsKICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyhhbW91bnQpCiAgICAgICAgICAgICAgICByZXR1cm4gdG90YWw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gcmV0dXJuIDAKICAgICAgICB9LAogICAgICAgIGF1dG9DYWxjdWxhdGVUYXhCeVR5cGUodGF4KSB7CiAgICAgICAgICAgIC8vIHJldHVybiBieSBhIGtleQogICAgICAgICAgICBjb25zdCBncm91cEFsbCA9IChsaXN0KSA9PgogICAgICAgICAgICAgICAgbGlzdC5yZWR1Y2UoKHRheCwgaXRlbSkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRheEFtb3VudCA9IHRheFtpdGVtLm5hbWVdIHx8IDA7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIHRheCwgewogICAgICAgICAgICAgICAgICAgICAgICBbaXRlbS5uYW1lXTogdGF4QW1vdW50ICsgcGFyc2VGbG9hdChpdGVtLmFtb3VudCksCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCB7fSk7CiAgICAgICAgICAgIHRoaXMudGF4TGlzdFRvdGFsID0gZ3JvdXBBbGwodGF4KTsKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKCduaW1vbCcsIGdyb3VwQWxsKHRheCkpCiAgICAgICAgICAgIC8vIHRoaXMuCiAgICAgICAgfSwKICAgICAgICBkYXRhU291cmNlQ2hhbmdlZChlKSB7CiAgICAgICAgICAgIGlmIChlLmZpZWxkKSB7CiAgICAgICAgICAgICAgICBsZXQgZGF0YVJvdyA9IGUuaXRlbXNbMF0sCiAgICAgICAgICAgICAgICAgICAgYnVvbSA9IHt9LAogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNpb25SYXRlID0gMSwKICAgICAgICAgICAgICAgICAgICB3YWMgPSAwLAogICAgICAgICAgICAgICAgICAgIHFvaCA9IDAsCiAgICAgICAgICAgICAgICAgICAgYW1vdW50ID0gMCwKICAgICAgICAgICAgICAgICAgICB4QW1vdW50ID0gMDsKICAgICAgICAgICAgICAgIHN3aXRjaCAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgIml0ZW0iOgogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmF0dHJpYnV0ZV8gPSB0aGlzLmF0dHJpYnV0ZXMuZmlsdGVyKG0gPT4gbS50eXBlLmlkID09PSBkYXRhUm93LnZhcmlhbnQuaWQpCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJkZXNjcmlwdGlvbiIsIGRhdGFSb3cuaXRlbS5kZXNjcmlwdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGJ1b20gPSBkYXRhUm93Lml0ZW0udW9tIHx8IHt9OwogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiYnVvbSIsIGJ1b20pOwogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLml0ZW1DaGFuZ2UoZGF0YVJvdykKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAidW9tIjoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNQcmljZUxldmVsQ2hhbmdlZCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVvbSA9IGRhdGFSb3cudW9tLmJ1b20gfHwge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFvaCA9IGRhdGFSb3cudW9tLnFvaCB8fCAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzaW9uUmF0ZSA9IGRhdGFSb3cudW9tLmNvbnZlcnNpb25SYXRlIHx8IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhYyA9IGRhdGFSb3cudW9tLndhYyB8fCAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiYnVvbSIsIGJ1b20pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgid2FjIiwgd2FjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoInFvaCIsIHFvaCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjb252ZXJzaW9uUmF0ZSIsIHBhcnNlRmxvYXQoY29udmVyc2lvblJhdGUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFSb3cudW9tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQoZGF0YVJvdy51b20ucHJpY2UpICogcGFyc2VGbG9hdChkYXRhUm93LnF0eSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4QW1vdW50ID0gYW1vdW50ICogcGFyc2VGbG9hdCh0aGlzLnNhbGVPcmRlci50eG5SYXRlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgicHJpY2UiLCBwYXJzZUZsb2F0KGRhdGFSb3cudW9tLnByaWNlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiYW1vdW50IiwgYW1vdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJleGNoYW5nZUFtb3VudCIsIHhBbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50ID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUZsb2F0KGRhdGFSb3cucHJpY2UpICogcGFyc2VGbG9hdChkYXRhUm93LnF0eSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4QW1vdW50ID0gYW1vdW50ICogcGFyc2VGbG9hdCh0aGlzLnNhbGVPcmRlci50eG5SYXRlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgicHJpY2UiLCBwYXJzZUZsb2F0KGRhdGFSb3cucHJpY2UpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJhbW91bnQiLCBhbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImV4Y2hhbmdlQW1vdW50IiwgeEFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImJ1b20iLCB7fSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjb252ZXJzaW9uUmF0ZSIsIDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgicHJpY2UiLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoInFvaCIsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgid2FjIiwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJhbW91bnQiLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImV4Y2hhbmdlQW1vdW50IiwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoInByaWNlIiwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImFtb3VudCIsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgInByaWNlIjoKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudCA9IHBhcnNlRmxvYXQoZGF0YVJvdy5wcmljZSkgKiBwYXJzZUZsb2F0KGRhdGFSb3cucXR5KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhBbW91bnQgPSBhbW91bnQgKiBwYXJzZUZsb2F0KHRoaXMuc2FsZU9yZGVyLnR4blJhdGUpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJwcmljZSIsIHBhcnNlRmxvYXQoZGF0YVJvdy5wcmljZSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImFtb3VudCIsIGFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiZXhjaGFuZ2VBbW91bnQiLCB4QW1vdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZygncHJpY2UnLGRhdGFSb3cucHJpY2UpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoInByaWNlIiwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiYW1vdW50IiwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiZXhjaGFuZ2VBbW91bnQiLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJxdHkiOgogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50ID0gcGFyc2VGbG9hdChkYXRhUm93LnByaWNlKSAqIHBhcnNlRmxvYXQoZGF0YVJvdy5xdHkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgeEFtb3VudCA9IGFtb3VudCAqIHBhcnNlRmxvYXQodGhpcy5zYWxlT3JkZXIudHhuUmF0ZSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoInByaWNlIiwgcGFyc2VGbG9hdChkYXRhUm93LnByaWNlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiYW1vdW50IiwgYW1vdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJleGNoYW5nZUFtb3VudCIsIHhBbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJwcmljZSIsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImFtb3VudCIsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImV4Y2hhbmdlQW1vdW50IiwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAib3RoZXJUYXgiOgogICAgICAgICAgICAgICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coIi0tIiwgZGF0YVJvdykKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhdXRvQ2FsY3VsYXRlKCkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLml0ZW1MaW5lRFMua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIHN1YlRvdGFsID0gMCwKICAgICAgICAgICAgICAgIHRvdGFsVGF4ID0gMCwKICAgICAgICAgICAgICAgIGRpc2NvdW50VG90YWwgPSAwLAogICAgICAgICAgICAgICAgc3BUYXggPSAwLAogICAgICAgICAgICAgICAgcGx0YXggPSAwLAogICAgICAgICAgICAgICAgb3RoZXJUYXggPSAwLAogICAgICAgICAgICAgICAgdmF0VGF4ID0gMCwKICAgICAgICAgICAgICAgIGRpc2NvdW50SW52b2ljZSA9IDAsCiAgICAgICAgICAgICAgICB0YXhMaXN0ID0gW10sCiAgICAgICAgICAgICAgICBkaXNjb3VudEl0ZW0gPSBbXSwKICAgICAgICAgICAgICAgIHNhbGVVbml0ID0gW10sCiAgICAgICAgICAgICAgICBpbmNsdXNpdmVUYXggPSAwLAogICAgICAgICAgICAgICAgaXRlbVN1YnRvdGFsID0gMCwKICAgICAgICAgICAgICAgIHR4bkl0bVN1YnRvdGFsID0gMCwKICAgICAgICAgICAgICAgIHNlcnZpY2VTdWJ0b3RhbCA9IDAsCiAgICAgICAgICAgICAgICBpdGVtRGlzY291bnQgPSAwLAogICAgICAgICAgICAgICAgc2VydmljZURpc2NvdW50ID0gMCwKICAgICAgICAgICAgICAgIHR4bkRpc2NvdW50ID0gMDsKCiAgICAgICAgICAgIGNvbnN0IHJvd3MgPSBkcy5kYXRhKCkuZmlsdGVyKChtKSA9PiBwYXJzZUZsb2F0KG0uYW1vdW50KSA+IDApOwogICAgICAgICAgICByb3dzLmZvckVhY2goKHZhbHVlKSA9PiB7CiAgICAgICAgICAgICAgICBsZXQgbW9kaWZpZXJQcmljZSA9IDA7CiAgICAgICAgICAgICAgICBpZiAodmFsdWUubW9kaWZpZXIpIHsKICAgICAgICAgICAgICAgICAgICBtb2RpZmllclByaWNlID0ga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5tb2RpZmllci5wcmljZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gc3ViVG90YWwgKz0gKGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuYW1vdW50KSArIG1vZGlmaWVyUHJpY2UpCiAgICAgICAgICAgICAgICBsZXQgZGlzY291bnQgPSAwOwogICAgICAgICAgICAgICAgaWYgKHZhbHVlLmRpc2NvdW50SXRlbSkgewogICAgICAgICAgICAgICAgICAgIGxldCBzdWJUbyA9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucHJpY2UpICoga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5xdHkpOwogICAgICAgICAgICAgICAgICAgIGRpc2NvdW50ID0gdGhpcy5hdXRvQ2FsY3VsYXRlRGlzY291bnQodmFsdWUuZGlzY291bnRJdGVtLCBzdWJUbyk7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCdkaXNjb3VudCBpdGVtJywgZGlzY291bnQsICctLScsIHZhbHVlLmRpc2NvdW50SXRlbSkKICAgICAgICAgICAgICAgICAgICB2YWx1ZVsiZGlzY291bnRBbW91bnQiXSA9IGRpc2NvdW50OwogICAgICAgICAgICAgICAgICAgIHZhbHVlWyJkaXNjb3VudEV4Y2hhbmdlQW1vdW50Il0gPQogICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5zYWxlT3JkZXIudHhuUmF0ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmRpc2NvdW50SXRlbS5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudEl0ZW0ucHVzaCh2YWx1ZS5kaXNjb3VudEl0ZW0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBkaXNjb3VudFRvdGFsICs9IGRpc2NvdW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHZhbHVlLnNhbGVVbml0KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnNhbGVVbml0Lmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNhbGVVbml0LnB1c2godmFsdWUuc2FsZVVuaXQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5zcGVjaWZpY1RheCkgewogICAgICAgICAgICAgICAgICAgIHNwVGF4ID0gdGhpcy5hdXRvQ2FsY3VsYXRlVGF4KAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZS5zcGVjaWZpY1RheCwKICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5hbW91bnQpIC0ga2VuZG8ucGFyc2VGbG9hdChkaXNjb3VudCkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZygnc3AgJywgZGlzY291bnQpCiAgICAgICAgICAgICAgICAgICAgc3BUYXggPSBrZW5kby5wYXJzZUZsb2F0KHNwVGF4KSA/IGtlbmRvLnBhcnNlRmxvYXQoc3BUYXgpIDogMDsKICAgICAgICAgICAgICAgICAgICB2YWx1ZVsic3BlY2lmaWNUYXhBbW91bnQiXSA9IHNwVGF4OwogICAgICAgICAgICAgICAgICAgIHZhbHVlWyJzcGVjaWZpY1RheEV4Y2hhbmdlQW1vdW50Il0gPQogICAgICAgICAgICAgICAgICAgICAgICBzcFRheCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5zYWxlT3JkZXIudHhuUmF0ZSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGF4ID0gdmFsdWUuc3BlY2lmaWNUYXg7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFzZUFtb3VudCA9IHRheC5iYXNlQW1vdW50OwogICAgICAgICAgICAgICAgICAgIGlmIChiYXNlQW1vdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiYXNlQW1vdW50LnRvTG93ZXJDYXNlKCkgPT09ICJpbmNsdXNpdmUiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNsdXNpdmVUYXggKz0gc3BUYXg7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnNwZWNpZmljVGF4Lmhhc093blByb3BlcnR5KCJ0YXhUeXBlIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGF4TGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHZhbHVlLnNwZWNpZmljVGF4LnRheFR5cGUubmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogc3BUYXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogdmFsdWUuc3BlY2lmaWNUYXgudGF4VHlwZS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHZhbHVlLnB1YmxpY0xpZ2h0aW5nVGF4KSB7CiAgICAgICAgICAgICAgICAgICAgcGx0YXggPSB0aGlzLmF1dG9DYWxjdWxhdGVUYXgoCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLnB1YmxpY0xpZ2h0aW5nVGF4LAogICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmFtb3VudCkgLSBrZW5kby5wYXJzZUZsb2F0KGRpc2NvdW50KQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgcGx0YXggPSBrZW5kby5wYXJzZUZsb2F0KHBsdGF4KSA/IGtlbmRvLnBhcnNlRmxvYXQocGx0YXgpIDogMDsKICAgICAgICAgICAgICAgICAgICB2YWx1ZVsicHVibGljTGlnaHRpbmdUYXhBbW91bnQiXSA9IHBsdGF4OwogICAgICAgICAgICAgICAgICAgIHZhbHVlWyJwdWJsaWNMaWdodGluZ1RheEV4Y2hhbmdlQW1vdW50Il0gPQogICAgICAgICAgICAgICAgICAgICAgICBwbHRheCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5zYWxlT3JkZXIudHhuUmF0ZSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGF4ID0gdmFsdWUucHVibGljTGlnaHRpbmdUYXg7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFzZUFtb3VudCA9IHRheC5iYXNlQW1vdW50OwogICAgICAgICAgICAgICAgICAgIGlmIChiYXNlQW1vdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiYXNlQW1vdW50LnRvTG93ZXJDYXNlKCkgPT09ICJpbmNsdXNpdmUiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNsdXNpdmVUYXggKz0gcGx0YXg7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnB1YmxpY0xpZ2h0aW5nVGF4Lmhhc093blByb3BlcnR5KCJ0YXhUeXBlIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGF4TGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHZhbHVlLnB1YmxpY0xpZ2h0aW5nVGF4LnRheFR5cGUubmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogcGx0YXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogdmFsdWUucHVibGljTGlnaHRpbmdUYXgudGF4VHlwZS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHZhbHVlLm90aGVyVGF4KSB7CiAgICAgICAgICAgICAgICAgICAgb3RoZXJUYXggPSB0aGlzLmF1dG9DYWxjdWxhdGVUYXgoCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLm90aGVyVGF4LAogICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmFtb3VudCkgLSBrZW5kby5wYXJzZUZsb2F0KGRpc2NvdW50KQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgb3RoZXJUYXggPSBrZW5kby5wYXJzZUZsb2F0KG90aGVyVGF4KQogICAgICAgICAgICAgICAgICAgICAgICA/IGtlbmRvLnBhcnNlRmxvYXQob3RoZXJUYXgpCiAgICAgICAgICAgICAgICAgICAgICAgIDogMDsKICAgICAgICAgICAgICAgICAgICB2YWx1ZVsib3RoZXJUYXhBbW91bnQiXSA9IG90aGVyVGF4OwogICAgICAgICAgICAgICAgICAgIHZhbHVlWyJvdGhlclRheEV4Y2hhbmdlQW1vdW50Il0gPQogICAgICAgICAgICAgICAgICAgICAgICBvdGhlclRheCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5zYWxlT3JkZXIudHhuUmF0ZSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGF4ID0gdmFsdWUub3RoZXJUYXg7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFzZUFtb3VudCA9IHRheC5iYXNlQW1vdW50OwogICAgICAgICAgICAgICAgICAgIGlmIChiYXNlQW1vdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiYXNlQW1vdW50LnRvTG93ZXJDYXNlKCkgPT09ICJpbmNsdXNpdmUiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNsdXNpdmVUYXggKz0gb3RoZXJUYXg7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLm90aGVyVGF4Lmhhc093blByb3BlcnR5KCJ0YXhUeXBlIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGF4TGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHZhbHVlLm90aGVyVGF4LnRheFR5cGUubmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogb3RoZXJUYXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogdmFsdWUub3RoZXJUYXgudGF4VHlwZS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh2YWx1ZS52YXRUYXgpIHsKICAgICAgICAgICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coJ1ZhdCBUYXgnLCB2YWx1ZS52YXRUYXgpCiAgICAgICAgICAgICAgICAgICAgbGV0IGFtdCA9CiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQoc3BUYXggPyBzcFRheCA6IDApICsKICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdChwbHRheCA/IHBsdGF4IDogMCkgKwogICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KG90aGVyVGF4ID8gb3RoZXJUYXggOiAwKSArCiAgICAgICAgICAgICAgICAgICAgICAgIChrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmFtb3VudCA/IHZhbHVlLmFtb3VudCA6IDApIC0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIChkaXNjb3VudCA/IGRpc2NvdW50IDogMCkpOwogICAgICAgICAgICAgICAgICAgIHZhdFRheCA9IHRoaXMuYXV0b0NhbGN1bGF0ZVRheCh2YWx1ZS52YXRUYXgsIGFtdCk7CiAgICAgICAgICAgICAgICAgICAgdmF0VGF4ID0ga2VuZG8ucGFyc2VGbG9hdCh2YXRUYXgpID8ga2VuZG8ucGFyc2VGbG9hdCh2YXRUYXgpIDogMDsKICAgICAgICAgICAgICAgICAgICB2YWx1ZVsidmF0VGF4QW1vdW50Il0gPSB2YXRUYXg7CiAgICAgICAgICAgICAgICAgICAgdmFsdWVbInZhdFRheEV4Y2hhbmdlQW1vdW50Il0gPQogICAgICAgICAgICAgICAgICAgICAgICB2YXRUYXggKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMuc2FsZU9yZGVyLnR4blJhdGUpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRheCA9IHZhbHVlLnZhdFRheDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiYXNlQW1vdW50ID0gdGF4LmJhc2VBbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKGJhc2VBbW91bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJhc2VBbW91bnQudG9Mb3dlckNhc2UoKSA9PT0gImluY2x1c2l2ZSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluY2x1c2l2ZVRheCArPSB2YXRUYXg7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnZhdFRheC5oYXNPd25Qcm9wZXJ0eSgidGF4VHlwZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRheExpc3QucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB2YWx1ZS52YXRUYXgudGF4VHlwZS5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiB2YXRUYXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogdmFsdWUudmF0VGF4LnRheFR5cGUuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRvdGFsVGF4ICs9CiAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdChzcFRheCA/IHNwVGF4IDogMCkgKwogICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQocGx0YXggPyBwbHRheCA6IDApICsKICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KG90aGVyVGF4ID8gb3RoZXJUYXggOiAwKSArCiAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YXRUYXggPyB2YXRUYXggOiAwKTsKICAgICAgICAgICAgICAgIHN1YlRvdGFsICs9CiAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5hbW91bnQpICsgbW9kaWZpZXJQcmljZSAtIGluY2x1c2l2ZVRheDsKCiAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gdmFsdWUuaXRlbTsKICAgICAgICAgICAgICAgIGNvbnN0IGl0bVR5cGUgPSBpdGVtLnR5cGUgfHwgIiI7CiAgICAgICAgICAgICAgICBpZiAoaXRtVHlwZSA9PT0gIlZhcmlhbnQiKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbVN1YnRvdGFsICs9CiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucHJpY2UpICoga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5xdHkpOwogICAgICAgICAgICAgICAgICAgIGl0ZW1EaXNjb3VudCArPSBrZW5kby5wYXJzZUZsb2F0KGRpc2NvdW50KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRtVHlwZSA9PT0gIlNlcnZpY2UiKSB7CiAgICAgICAgICAgICAgICAgICAgc2VydmljZVN1YnRvdGFsICs9CiAgICAgICAgICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodmFsdWUucHJpY2UpICoga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5xdHkpOwogICAgICAgICAgICAgICAgICAgIHNlcnZpY2VEaXNjb3VudCArPSBrZW5kby5wYXJzZUZsb2F0KGRpc2NvdW50KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdHhuSXRtU3VidG90YWwgKz0KICAgICAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5wcmljZSkgKiBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnF0eSk7CiAgICAgICAgICAgICAgICAgICAgdHhuRGlzY291bnQgKz0ga2VuZG8ucGFyc2VGbG9hdChkaXNjb3VudCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvL2luY2x1ZGUgVGF4IEFtb3VudAogICAgICAgICAgICAgICAgY29uc3QgYW1vdW50Tm9kaXNjb3VudCA9CiAgICAgICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5wcmljZSkgKiBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLnF0eSkgLQogICAgICAgICAgICAgICAgICAgIGRpc2NvdW50OwogICAgICAgICAgICAgICAgY29uc3QgaW5jbHVkZVRheEFtb3VudCA9CiAgICAgICAgICAgICAgICAgICAgYW1vdW50Tm9kaXNjb3VudCArIHZhdFRheCArIHBsdGF4ICsgc3BUYXggKyBvdGhlclRheDsKICAgICAgICAgICAgICAgIHZhbHVlWyJpbmNsdWRlVGF4QW1vdW50Il0gPSBpbmNsdWRlVGF4QW1vdW50OwogICAgICAgICAgICAgICAgdmFsdWVbImluY2x1ZGVUYXhFeGNoYW5nZUFtb3VudCJdID0KICAgICAgICAgICAgICAgICAgICBpbmNsdWRlVGF4QW1vdW50ICoga2VuZG8ucGFyc2VGbG9hdCh0aGlzLnNhbGVPcmRlci50eG5SYXRlKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB0aGlzLnNhbGVPcmRlci5pdGVtU3VidG90YWwgPSBpdGVtU3VidG90YWw7CiAgICAgICAgICAgIHRoaXMuc2FsZU9yZGVyLmV4Y2hhbmdlSXRlbVN1YnRvdGFsID0gaXRlbVN1YnRvdGFsICoga2VuZG8ucGFyc2VGbG9hdCh0aGlzLnNhbGVPcmRlci50eG5SYXRlKTsKCiAgICAgICAgICAgIHRoaXMuc2FsZU9yZGVyLnNlcnZpY2VTdWJ0b3RhbCA9IHNlcnZpY2VTdWJ0b3RhbDsKICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIuZXhjaGFuZ2VTZXJ2aWNlU3VidG90YWwgPSBzZXJ2aWNlU3VidG90YWwgKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMuc2FsZU9yZGVyLnR4blJhdGUpOwogICAgICAgICAgICB0aGlzLnNhbGVPcmRlci50eG5JdG1TdWJ0b3RhbCA9IHR4bkl0bVN1YnRvdGFsOwogICAgICAgICAgICB0aGlzLnNhbGVPcmRlci5leGNoYW5nZVR4bkl0bVN1YnRvdGFsID0gdHhuSXRtU3VidG90YWwgKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMuc2FsZU9yZGVyLnR4blJhdGUpOwoKICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIuaXRlbURpc2NvdW50ID0gaXRlbURpc2NvdW50OwogICAgICAgICAgICB0aGlzLnNhbGVPcmRlci5leGNoYW5nZUl0ZW1EaXNjb3VudCA9IGl0ZW1EaXNjb3VudCAqIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5zYWxlT3JkZXIudHhuUmF0ZSk7CiAgICAgICAgICAgIHRoaXMuc2FsZU9yZGVyLnNlcnZpY2VEaXNjb3VudCA9IHNlcnZpY2VEaXNjb3VudDsKICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIuZXhjaGFuZ2VTZXJ2aWNlRGlzY291bnQgPSBzZXJ2aWNlRGlzY291bnQgKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMuc2FsZU9yZGVyLnR4blJhdGUpOwogICAgICAgICAgICB0aGlzLnNhbGVPcmRlci50eG5JdG1EaXNjb3VudCA9IHR4bkRpc2NvdW50OwogICAgICAgICAgICB0aGlzLnNhbGVPcmRlci5leGNoYW5nZVR4bkl0bURpc2NvdW50ID0gdHhuRGlzY291bnQgKiBrZW5kby5wYXJzZUZsb2F0KHRoaXMuc2FsZU9yZGVyLnR4blJhdGUpOwoKICAgICAgICAgICAgZGlzY291bnRUb3RhbCA9IGRpc2NvdW50VG90YWwgPyBkaXNjb3VudFRvdGFsIDogMDsKCiAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyhzcFRheCwgcGx0YXgsIG90aGVyVGF4LCB2YXRUYXgpCiAgICAgICAgICAgIGxldCB0b3RhbCA9CiAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHN1YlRvdGFsKSAtCiAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KGRpc2NvdW50VG90YWwpICsKICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodG90YWxUYXgpOwogICAgICAgICAgICB0aGlzLnNhbGVPcmRlci5zdWJUb3RhbCA9IHN1YlRvdGFsOwogICAgICAgICAgICB0aGlzLnNhbGVPcmRlci50b3RhbFRheEFtb3VudCA9IGtlbmRvLnBhcnNlRmxvYXQodG90YWxUYXgpOwogICAgICAgICAgICB0aGlzLnNhbGVPcmRlci5kaXNjb3VudFRvdGFsID0ga2VuZG8ucGFyc2VGbG9hdChkaXNjb3VudFRvdGFsKTsKICAgICAgICAgICAgaWYgKHRoaXMuc2FsZU9yZGVyLnNwZWNpZmljRGlzY291bnRJdGVtKSB7CiAgICAgICAgICAgICAgICBkaXNjb3VudEludm9pY2UgPSB0aGlzLmF1dG9DYWxjdWxhdGVEaXNjb3VudCgKICAgICAgICAgICAgICAgICAgICB0aGlzLnNhbGVPcmRlci5zcGVjaWZpY0Rpc2NvdW50SXRlbSwKICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHN1YlRvdGFsKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGRpc2NvdW50SW52b2ljZSA9IGRpc2NvdW50SW52b2ljZSA/IGRpc2NvdW50SW52b2ljZSA6IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gdGhpcy5vbk90aGVyQ2hhcmdlQ2hhbmdlKCkKICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIudG90YWwgPQogICAgICAgICAgICAgICAga2VuZG8ucGFyc2VGbG9hdCh0b3RhbCkgLQogICAgICAgICAgICAgICAgZGlzY291bnRJbnZvaWNlICsKICAgICAgICAgICAgICAgIGtlbmRvLnBhcnNlRmxvYXQodGhpcy5zYWxlT3JkZXIub3RoZXJDaGFyZ2VBbW91bnQpOwogICAgICAgICAgICB0aGlzLnNhbGVPcmRlci5leGNoYW5nZUFtb3VudCA9CiAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHRoaXMuc2FsZU9yZGVyLnRvdGFsKSAqCiAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHRoaXMuc2FsZU9yZGVyLnR4blJhdGUpOwogICAgICAgICAgICB0aGlzLmF1dG9DYWxjdWxhdGVUYXhCeVR5cGUodGF4TGlzdCk7CiAgICAgICAgICAgIHRoaXMuY3VzdG9tZXJEaXNjb3VudEl0ZW0gPSB0aGlzLnJlbW92ZUR1cGxpY2F0ZShkaXNjb3VudEl0ZW0pOwogICAgICAgICAgICB0aGlzLmN1c3RvbWVyU2FsZVVuaXQgPSB0aGlzLnJlbW92ZUR1cGxpY2F0ZShzYWxlVW5pdCk7CiAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZygnZGlzY291bnQgJywgdGhpcy5jdXN0b21lckRpc2NvdW50SXRlbSkKICAgICAgICB9LAogICAgICAgIHJvd051bWJlclRtcGwoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5pdGVtTGluZURTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICBpbmRleCA9IGRzLmluZGV4T2YoZGF0YUl0ZW0pOwogICAgICAgICAgICByZXR1cm4gaW5kZXggKyAxOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFNhbGVGb3JtQ29udGVudCgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgc2FsZUZvcm1Db250ZW50SGFuZGxlci5saXN0KCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2FsZUZvcm1Db250ZW50ID0gZGF0YVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coZGF0YVswXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIHZhdFRlbXBsYXRlKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGNvbnN0IHZhdCA9IGRhdGFJdGVtLnZhdFRheDsKICAgICAgICAgICAgaWYgKHZhdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGA8c3Bhbj4ke3ZhdC5kZWZhdWx0VGF4ID8gdmF0LmRlZmF1bHRUYXggOiBgYH08L3NwYW4+YDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBgYDsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaXRlbVRlbXBsYXRlKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBkYXRhSXRlbS5pdGVtOwogICAgICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGA8c3Bhbj4ke2l0ZW0ubmFtZSA/IGl0ZW0ubmFtZSA6IGBgfTwvc3Bhbj5gOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGBgOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBVT01UZW1wbGF0ZShkYXRhSXRlbSkgewogICAgICAgICAgICBjb25zdCB1b20gPSBkYXRhSXRlbS51b207CiAgICAgICAgICAgIGlmICh1b20pIHsKICAgICAgICAgICAgICAgIHJldHVybiBgPHNwYW4+JHt1b20udW9tID8gdW9tLnVvbS5uYW1lIDogYGB9PC9zcGFuPmA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYGA7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHNhbGVVbml0VGVtcGxhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3Qgc2FsZVVuaXQgPSBkYXRhSXRlbS5zYWxlVW5pdDsKICAgICAgICAgICAgaWYgKHNhbGVVbml0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYDxzcGFuPiR7c2FsZVVuaXQubmFtZSA/IHNhbGVVbml0Lm5hbWUgOiBgYH08L3NwYW4+YDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBgYDsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZGlzY291bnRJdGVtVGVtcGxhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3QgZGlzY291bnRJdGVtID0gZGF0YUl0ZW0uZGlzY291bnRJdGVtOwogICAgICAgICAgICBpZiAoZGlzY291bnRJdGVtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYDxzcGFuPiR7ZGlzY291bnRJdGVtLmNvZGUgPyBkaXNjb3VudEl0ZW0uY29kZSA6IGBgfSAtICR7CiAgICAgICAgICAgICAgICAgICAgZGlzY291bnRJdGVtLm5hbWUgPyBkaXNjb3VudEl0ZW0ubmFtZSA6IGBgCiAgICAgICAgICAgICAgICB9PC9zcGFuPmA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYGA7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIFNlcnZpY2VEYXRlRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IHJlcXVpcmVkIG5hbWU9IicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvRGF0ZVBpY2tlcigpOwoKICAgICAgICAgICAgLy8gbGV0IGRzID0gdGhpcy4kcmVmcy5pdGVtTGluZURTLmtlbmRvV2lkZ2V0KCkKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKGRzLmRhdGEoKSkKICAgICAgICAgICAgLy8gLy8gY29uc3QgZGF0ZVN0cmluZyA9IGtlbmRvLnRvU3RyaW5nKChuZXcgRGF0ZShvcHRpb25zLm1vZGVsLml0ZW1zLnNlcnZpY2VEYXRlKSksIHRoaXMuaXRlbUxpbmUuZGF0ZUZvcm1hdCkKICAgICAgICAgICAgLy8gLy8gY29uc3QgZGF0ZVN0cmluZyA9IGtlbmRvLnRvU3RyaW5nKG9wdGlvbnMubW9kZWwuaXRlbXMuc2VydmljZURhdGUpCiAgICAgICAgICAgIC8vIGNvbnN0ICRpbnB1dCA9ICQoIjxpbnB1dCB2YWx1ZT0iICsgb3B0aW9ucy5tb2RlbC5zZXJ2aWNlRGF0ZSArICIgLz4iKS5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgIC8vICRpbnB1dC5rZW5kb0RhdGVQaWNrZXIoKQogICAgICAgICAgICAvLyAvLyAkaW5wdXQuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAvLyAvLyBvcHRpb25zLm1vZGVsLml0ZW1zLnNlcnZpY2VEYXRlID0gZGF0ZVN0cmluZwogICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coJGlucHV0KQogICAgICAgIH0sCiAgICAgICAgU2VydmljZURhdGVUb0VkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCByZXF1aXJlZCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0RhdGVQaWNrZXIoKTsKICAgICAgICB9LAogICAgICAgIEl0ZW1Ecm9wRG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogImNvbnRhaW5zIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVGV4dEZpZWxkOiAibmFtZSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlRmllbGQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgaGVhZGVyVGVtcGxhdGU6CiAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJkcm9wZG93bi1oZWFkZXIgay13aWRnZXQgay1oZWFkZXIiPicgKwogICAgICAgICAgICAgICAgICAgICAgICAiPHNwYW4+SXRlbXMgPC9zcGFuPiIgKwogICAgICAgICAgICAgICAgICAgICAgICAiPHNwYW4+PC9zcGFuPiIgKwogICAgICAgICAgICAgICAgICAgICAgICAiPC9kaXY+IiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9bmFtZSM8L3NwYW4+IiwKICAgICAgICAgICAgICAgICAgICBvcHRpb25MYWJlbDogIi0tLSBTZWxlY3QgLS0tIiwKICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlOiBuZXcga2VuZG8uZGF0YS5EYXRhU291cmNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyRmlsdGVyaW5nOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc3BvcnQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHByb2R1Y3RWYXJpYW50SGFuZGxlci5pdGVtU2VhcmNoVVJMKCc/cGxJZD0nICsgdGhpcy5zYWxlT3JkZXIucHJpY2VMZXZlbC5pZCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDoge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZToge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2t1OiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhLmNvdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGF0YTogdGhpcy52YXJpYW50cwogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBVT01Ecm9wRG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogInN0YXJ0c3dpdGgiLAogICAgICAgICAgICAgICAgICAgIGRhdGFUZXh0RmllbGQ6ICJ1b20ubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlRmllbGQ6ICJ1b20uaWQiLAogICAgICAgICAgICAgICAgICAgIGNhc2NhZGVGcm9tOiAiaXRlbSIsCiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICI8c3Bhbj4jPXVvbS5uYW1lIHx8IGBObyBQcmljZSBMZXZlbGAjPC9zcGFuPiIsCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6ICItLS0gU2VsZWN0IC0tLSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZTogbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZlckZpbHRlcmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNwb3J0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdXJsOiB1b21QcmljZUhhbmRsZXIuZ2V0VVJMKG9wdGlvbnMubW9kZWwuaXRlbS5pZCwgdGhpcy5zYWxlT3JkZXIucHJpY2VMZXZlbC5pZCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB1b21QcmljZUhhbmRsZXIudW9tUHJpY2VCeVByaWNlTGV2ZWxVUkwoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpZD0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5tb2RlbC5pdGVtLmlkICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiZwbElkPSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNhbGVPcmRlci5wcmljZUxldmVsLmlkICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiZkYXRlPSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNhbGVPcmRlci50cmFuc2FjdGlvbkRhdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAianNvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWw6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogImlkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHt0eXBlOiAic3RyaW5nIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5hbWU6IHt0eXBlOiAic3RyaW5nIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNrdToge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YS5jb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRhdGE6IHRoaXMudmFyaWFudHMKICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgRGlzY291bnRJdGVtRHJvcERvd25FZGl0b3IoY29udGFpbmVyLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAualF1ZXJ5KCc8aW5wdXQgbmFtZT0iJyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgICAgICAua2VuZG9Ecm9wRG93bkxpc3QoewogICAgICAgICAgICAgICAgICAgIGF1dG9CaW5kOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGF1dG9XaWR0aDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDQwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXI6ICJzdGFydHN3aXRoIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVGV4dEZpZWxkOiAibmFtZSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlRmllbGQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgY2FzY2FkZUZyb206ICJpdGVtIiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9Y29kZSMgLSAjPW5hbWUjPC9zcGFuPiIsCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6ICItLS0gU2VsZWN0IC0tLSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZTogbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZlckZpbHRlcmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNwb3J0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBkaXNjb3VudEl0ZW1IYW5kbGVyLmdldFVSTChESVNDT1VOVF9UWVBFKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogImpzb24iLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBzY2hlbWE6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBuYW1lOiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBza3U6IHt0eXBlOiAic3RyaW5nIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGEuY291bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBTcGVjaWZpY1RheERyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IG5hbWU9IicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgICAgICAgICAgICBhdXRvQmluZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiAic3RhcnRzd2l0aCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogImRlZmF1bHRUYXgiLAogICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZUZpZWxkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAiPHNwYW4+Iz1kZWZhdWx0VGF4Izwvc3Bhbj4iLAogICAgICAgICAgICAgICAgICAgIG9wdGlvbkxhYmVsOiAiLS0tIFNlbGVjdCAtLS0iLAogICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IG5ldyBrZW5kby5kYXRhLkRhdGFTb3VyY2UoewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLnNwZWNpZmljVGF4LmZpbHRlcigobSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMubW9kZWwuaGFzT3duUHJvcGVydHkoInZhdFRheCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmF0ID0gb3B0aW9ucy5tb2RlbC52YXRUYXg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm1vZGVsLnZhdFRheCAhPT0gbnVsbCB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5tb2RlbC52YXRUYXggIT09ICJudWxsIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLm1vZGVsLnZhdFRheC5iYXNlQW1vdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5iYXNlQW1vdW50LnRvTG93ZXJDYXNlKCkgPT09CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubW9kZWwudmF0VGF4LmJhc2VBbW91bnQudG9Mb3dlckNhc2UoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgUHVibGljTGlnaHRpbmdUYXhEcm9wRG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogInN0YXJ0c3dpdGgiLAogICAgICAgICAgICAgICAgICAgIGRhdGFUZXh0RmllbGQ6ICJkZWZhdWx0VGF4IiwKICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogImlkIiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9ZGVmYXVsdFRheCM8L3NwYW4+IiwKICAgICAgICAgICAgICAgICAgICBvcHRpb25MYWJlbDogIi0tLSBTZWxlY3QgLS0tIiwKICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlOiBuZXcga2VuZG8uZGF0YS5EYXRhU291cmNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogdGhpcy5wdWJsaWNMaWdodGluZ1RheC5maWx0ZXIoKG0pID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLm1vZGVsLmhhc093blByb3BlcnR5KCJ2YXRUYXgiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhdCA9IG9wdGlvbnMubW9kZWwudmF0VGF4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5tb2RlbC52YXRUYXggIT09IG51bGwgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubW9kZWwudmF0VGF4ICE9PSAibnVsbCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5tb2RlbC52YXRUYXguYmFzZUFtb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0uYmFzZUFtb3VudC50b0xvd2VyQ2FzZSgpID09PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm1vZGVsLnZhdFRheC5iYXNlQW1vdW50LnRvTG93ZXJDYXNlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIE90aGVyVGF4RHJvcERvd25FZGl0b3IoY29udGFpbmVyLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAualF1ZXJ5KCc8aW5wdXQgbmFtZT0iJyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgICAgICAua2VuZG9Ecm9wRG93bkxpc3QoewogICAgICAgICAgICAgICAgICAgIGF1dG9CaW5kOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGF1dG9XaWR0aDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDQwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXI6ICJzdGFydHN3aXRoIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVGV4dEZpZWxkOiAiZGVmYXVsdFRheCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlRmllbGQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICI8c3Bhbj4jPWRlZmF1bHRUYXgjPC9zcGFuPiIsCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6ICItLS0gU2VsZWN0IC0tLSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZTogbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHRoaXMub3RoZXJUYXguZmlsdGVyKChtKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5tb2RlbC5oYXNPd25Qcm9wZXJ0eSgidmF0VGF4IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YXQgPSBvcHRpb25zLm1vZGVsLnZhdFRheDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmF0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubW9kZWwudmF0VGF4ICE9PSBudWxsICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm1vZGVsLnZhdFRheCAhPT0gIm51bGwiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMubW9kZWwudmF0VGF4LmJhc2VBbW91bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLmJhc2VBbW91bnQudG9Mb3dlckNhc2UoKSA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5tb2RlbC52YXRUYXguYmFzZUFtb3VudC50b0xvd2VyQ2FzZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBWYXRUYXhEcm9wRG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogInN0YXJ0c3dpdGgiLAogICAgICAgICAgICAgICAgICAgIGRhdGFUZXh0RmllbGQ6ICJkZWZhdWx0VGF4IiwKICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogImlkIiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9ZGVmYXVsdFRheCM8L3NwYW4+IiwKICAgICAgICAgICAgICAgICAgICBvcHRpb25MYWJlbDogIi0tU2VsZWN0LS0iLAogICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IG5ldyBrZW5kby5kYXRhLkRhdGFTb3VyY2UoewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLnZhdFRheCwKICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgU2FsZVVuaXREcm9wRG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBuYW1lPSInICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgYXV0b0JpbmQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogInN0YXJ0c3dpdGgiLAogICAgICAgICAgICAgICAgICAgIGRhdGFUZXh0RmllbGQ6ICJuYW1lIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogImlkIiwKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogIjxzcGFuPiM9Y29kZSMgLSAjPW5hbWUjPC9zcGFuPiIsCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6ICItLS0gU2VsZWN0IC0tLSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZTogbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHRoaXMuc2FsZVVuaXRJdGVtTGlzdCwKICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgTW9kaWZpZXJEcm9wRG93bkVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAgY29uc3QgaXRlbSA9IG9wdGlvbnMubW9kZWwuaXRlbSB8fCB7fQogICAgICAgICAgICBjb25zdCB1b20gPSBpdGVtLnVvbSB8fCB7fQogICAgICAgICAgICBjb25zdCBpdGVtSWQgPSBpdGVtLmlkIHx8ICcnCiAgICAgICAgICAgIGNvbnN0IHVvbUlkID0gdW9tLmlkIHx8ICcnCiAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAualF1ZXJ5KCc8aW5wdXQgbmFtZT0iJyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgICAgICAua2VuZG9Ecm9wRG93bkxpc3QoewogICAgICAgICAgICAgICAgICAgIGF1dG9CaW5kOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGF1dG9XaWR0aDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDQwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXI6ICJjb250YWlucyIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogIm5hbWUiLAogICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZUZpZWxkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgIGhlYWRlclRlbXBsYXRlOgogICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0iZHJvcGRvd24taGVhZGVyIGstd2lkZ2V0IGstaGVhZGVyIj4nICsKICAgICAgICAgICAgICAgICAgICAgICAgIjxzcGFuPk1vZGlmaWVyIDwvc3Bhbj4iICsKICAgICAgICAgICAgICAgICAgICAgICAgIjxzcGFuPjwvc3Bhbj4iICsKICAgICAgICAgICAgICAgICAgICAgICAgIjwvZGl2PiIsCiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICI8c3Bhbj4jPW5hbWUjPC9zcGFuPiIsCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6ICItLS0gU2VsZWN0IC0tLSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZTogbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZlckZpbHRlcmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNwb3J0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBpdGVtTW9kaWZpZXJIYW5kbGVyLnNlYXJjaFVSTCgnP3BsSWQ9JyArIHRoaXMuc2FsZU9yZGVyLnByaWNlTGV2ZWwuaWQgKyAnJmlkPScgKyBpdGVtSWQgKyAnJnVvbUlkPScgKyB1b21JZCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDoge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZToge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpY2U6IHt0eXBlOiAibnVtYmVyIn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVvbToge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YS5jb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIEVtcGxveWVlRHJvcERvd25FZGl0b3IoY29udGFpbmVyLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGtlbmRvCiAgICAgICAgICAgICAgICAualF1ZXJ5KCc8aW5wdXQgZGF0YS1iaW5kPSJ2YWx1ZTonICsgb3B0aW9ucy5maWVsZCArICciLz4nKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNvbnRhaW5lcikKICAgICAgICAgICAgICAgIC5rZW5kb011bHRpU2VsZWN0KHsKICAgICAgICAgICAgICAgICAgICBhdXRvQmluZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICAgICAgICAgICAgc3VnZ2VzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXI6ICJjb250YWlucyIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogIm5hbWUiLAogICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZUZpZWxkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgIGhlYWRlclRlbXBsYXRlOgogICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0iZHJvcGRvd24taGVhZGVyIGstd2lkZ2V0IGstaGVhZGVyIj4nICsKICAgICAgICAgICAgICAgICAgICAgICAgIjxzcGFuPkVtcGxveWVlIDwvc3Bhbj4iICsKICAgICAgICAgICAgICAgICAgICAgICAgIjxzcGFuPjwvc3Bhbj4iICsKICAgICAgICAgICAgICAgICAgICAgICAgIjwvZGl2PiIsCiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICI8c3Bhbj4jPW5hbWUjPC9zcGFuPiIsCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6ICItLS0gU2VsZWN0IC0tLSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZTogbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZlckZpbHRlcmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNwb3J0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBlbXBsb3llZUhhbmRsZXIuc2VhcmNoVVJMKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDoge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZToge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0TmFtZToge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YS5jb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGVtcEltcGwoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgbGV0IGVtcElkcyA9IFtdOwogICAgICAgICAgICBkYXRhSXRlbS5lbXBsb3llZS5mb3JFYWNoKChtKSA9PiB7CiAgICAgICAgICAgICAgICBlbXBJZHMucHVzaChtLmZpcnN0TmFtZSArICIgLSAiICsgbS5sYXN0TmFtZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coZW1wSWRzLmpvaW4oJywgJykpCiAgICAgICAgICAgIHJldHVybiBgPHNwYW4+JHtlbXBJZHMuam9pbigiLCAiKX08L3NwYW4+YDsKICAgICAgICB9LAogICAgICAgIGFkZFJvdygpIHsKICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5pdGVtTGluZURTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICB0b3RhbCA9IGRzLnRvdGFsKCk7CiAgICAgICAgICAgIHRoaXMuaXRlbUxpbmUuaWQgPSBpbnZvaWNlUHJlZml4ICsgdXVpZC52MSgpOwogICAgICAgICAgICBkcy5pbnNlcnQodG90YWwsIHRoaXMuaXRlbUxpbmUpOwogICAgICAgIH0sCiAgICAgICAgb25TcGVjaWZpY0Rpc2NvdW50Q2hhbmdlZCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuc2FsZU9yZGVyLnNwZWNpZmljRGlzY291bnRJdGVtKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkaXNjb3VudE9yZGVyID0gdGhpcy5hdXRvQ2FsY3VsYXRlRGlzY291bnQoCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIuc3BlY2lmaWNEaXNjb3VudEl0ZW0sCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIuc3ViVG90YWwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB0aGlzLnNhbGVPcmRlci5zcGVjaWZpY0Rpc2NvdW50VG90YWwgPSBrZW5kby50b1N0cmluZygKICAgICAgICAgICAgICAgICAgICBkaXNjb3VudE9yZGVyID8gZGlzY291bnRPcmRlciA6IDAsCiAgICAgICAgICAgICAgICAgICAgIm4iCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgbGV0IHRvdGFsID0KICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHRoaXMuc2FsZU9yZGVyLnN1YlRvdGFsKSAtCiAgICAgICAgICAgICAgICAgICAgKGtlbmRvLnBhcnNlRmxvYXQodGhpcy5zYWxlT3JkZXIuZGlzY291bnRUb3RhbCkgKwogICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHRoaXMuc2FsZU9yZGVyLnRvdGFsVGF4QW1vdW50KSkgLQogICAgICAgICAgICAgICAgICAgIGRpc2NvdW50T3JkZXI7CiAgICAgICAgICAgICAgICB0aGlzLnNhbGVPcmRlci50b3RhbCA9IGtlbmRvLnRvU3RyaW5nKHRvdGFsLCAibiIpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBvbk90aGVyQ2hhcmdlQ2hhbmdlKCkgewogICAgICAgICAgICBsZXQgb3RoZXJDaGFyZ2UgPSAwOwogICAgICAgICAgICB0aGlzLm1PdGhlckNoYXJnZS5mb3JFYWNoKChtKSA9PiB7CiAgICAgICAgICAgICAgICBvdGhlckNoYXJnZSArPSB0aGlzLmF1dG9DYWxjdWxhdGVEaXNjb3VudChtLCB0aGlzLnNhbGVPcmRlci5zdWJUb3RhbCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLnNhbGVPcmRlci5vdGhlckNoYXJnZUFtb3VudCA9IG90aGVyQ2hhcmdlOwogICAgICAgICAgICB0aGlzLmF1dG9DYWxjdWxhdGUoKTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRPdGhlckNoYXJnZSgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgb3RoZXJDaGFyZ2VIYW5kbGVyLmxpc3QoKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vdGhlckNoYXJnZUxpc3QgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgb25PdGhlckFtb3VudCh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5hdXRvQ2FsY3VsYXRlRGlzY291bnQodmFsdWUsIHRoaXMuc2FsZU9yZGVyLnN1YlRvdGFsKTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWREaXNjb3VudEl0ZW0oKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIGRpc2NvdW50SXRlbUhhbmRsZXIubGlzdCgpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNwZWNpZmljRGlzY291bnRJdGVtID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRTZWdtZW50KCkgewogICAgICAgICAgICB0aGlzLnNlZ21lbnRzID0gW10KICAgICAgICAgICAgY29uc3Qgcm9sZVR5cGUgPSBkYXRhU3RvcmUucm9sZVR5cGUgfHwgMAogICAgICAgICAgICBpZiAocm9sZVR5cGUgPT09IDApIHsKICAgICAgICAgICAgICAgIGlmIChkYXRhU3RvcmUucm9sZURhdGEpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCByb2xlRGF0YSA9IGRhdGFTdG9yZS5yb2xlRGF0YSB8fCBbXQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlZ21lbnQgPSByb2xlRGF0YS5maWx0ZXIoaXRtID0+IGl0bS50eXBlID09PSAnc2VnbWVudCcpCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VnbWVudERlZmF1bHQgPSBzZWdtZW50LmZpbHRlcihtID0+IG0uaXNEZWZhdWx0ID09PSAxKQogICAgICAgICAgICAgICAgICAgIHRoaXMuc2VnbWVudHMgPSBzZWdtZW50CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCA9PT0gdW5kZWZpbmVkIHx8IHRoaXMuJHJvdXRlLnBhcmFtcy5pZCA9PT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlZ21lbnREZWZhdWx0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2FsZU9yZGVyLnNlZ21lbnQgPSBzZWdtZW50RGVmYXVsdFswXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChyb2xlVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWdtZW50cyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5nc0hhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRTZWcoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlZ21lbnRzID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgoKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRMb2NhdGlvbigpIHsKICAgICAgICAgICAgdGhpcy5sb2NhdGlvbnMgPSBbXQogICAgICAgICAgICBjb25zdCByb2xlVHlwZSA9IGRhdGFTdG9yZS5yb2xlVHlwZSB8fCAwCiAgICAgICAgICAgIGlmIChyb2xlVHlwZSA9PT0gMCkgewogICAgICAgICAgICAgICAgaWYgKGRhdGFTdG9yZS5yb2xlRGF0YSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvbGVEYXRhID0gZGF0YVN0b3JlLnJvbGVEYXRhIHx8IFtdCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9jYXRpb24gPSByb2xlRGF0YS5maWx0ZXIoaXRtID0+IGl0bS50eXBlID09PSAnbG9jYXRpb24nKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvY2F0aW9uRGVmYXVsdCA9IGxvY2F0aW9uLmZpbHRlcihtID0+IG0uaXNEZWZhdWx0ID09PSAxKQogICAgICAgICAgICAgICAgICAgIHRoaXMubG9jYXRpb25zID0gbG9jYXRpb24KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkID09PSB1bmRlZmluZWQgfHwgdGhpcy4kcm91dGUucGFyYW1zLmlkID09PSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9jYXRpb25EZWZhdWx0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2FsZU9yZGVyLmxvY2F0aW9uID0gbG9jYXRpb25EZWZhdWx0WzBdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHJvbGVUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvY2F0aW9ucyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbkhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5saXN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2NhdGlvbnMgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkUHJvamVjdEJ5Q3VzdG9tZXIoKSB7CiAgICAgICAgICAgIHRoaXMuY3VzdG9tZXJQcm9qZWN0cyA9IFtdCiAgICAgICAgICAgIGNvbnN0IHJvbGVUeXBlID0gZGF0YVN0b3JlLnJvbGVUeXBlIHx8IDAKICAgICAgICAgICAgaWYgKHJvbGVUeXBlID09PSAwKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YVN0b3JlLnJvbGVEYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm9sZURhdGEgPSBkYXRhU3RvcmUucm9sZURhdGEgfHwgW10KICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9qZWN0ID0gcm9sZURhdGEuZmlsdGVyKGl0bSA9PiBpdG0udHlwZSA9PT0gJ3Byb2plY3QnKQogICAgICAgICAgICAgICAgICAgIHByb2plY3QuZm9yRWFjaChrID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VzdG9tZXJzID0gay5jdXN0b21lcnMgfHwgW10KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvQ3VzdG9tZXIgPSBjdXN0b21lcnMuZmlsdGVyKG4gPT4gbi5jdXN0b21lci5pZCA9PT0gdGhpcy5jdXN0b21lci5pZCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb0N1c3RvbWVyLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3VzdG9tZXJQcm9qZWN0cy5wdXNoKGspCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09IHVuZGVmaW5lZCB8fCB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2plY3REZWZhdWx0ID0gdGhpcy5jdXN0b21lclByb2plY3RzLmZpbHRlcihtID0+IG0uaXNEZWZhdWx0ID09PSAxKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvamVjdERlZmF1bHQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIucHJvamVjdCA9IHByb2plY3REZWZhdWx0WzBdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHJvbGVUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0SGFuZGxlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldEJ5Q3VzdG9tZXIodGhpcy5jdXN0b21lci5pZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXN0b21lclByb2plY3RzID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFNhbGVDaGFubmVsKCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBzYWxlQ2hhbm5lbEhhbmRsZXIuZ2V0KCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2FsZUNoYW5uZWxMaXN0ID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNhbGVDaGFubmVsTGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgIT09IHVuZGVmaW5lZCB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgIT0gIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIuc2FsZUNoYW5uZWwgPSB0aGlzLnNhbGVDaGFubmVsTGlzdFswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkVGF4KCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBzZXR0aW5nSGFuZGxlci5nZXQoKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50YXggPSByZXM7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3RoZXJUYXggPSB0aGlzLnRheC5maWx0ZXIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAobSkgPT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobS50YXhUeXBlLnR5cGVJZCA9PT0gNyB8fCBtLnRheFR5cGUudHlwZUlkID09PSAxMCkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLnRyYW5zYWN0aW9uVHlwZSA9PT0gIlNhbGUiCiAgICAgICAgICAgICAgICAgICAgICAgICk7IC8vIHZhbHVhYmxlIHRheAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNwZWNpZmljVGF4ID0gdGhpcy50YXguZmlsdGVyKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKG0pID0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG0udGF4VHlwZS50eXBlSWQgPT09IDggfHwgbS50YXhUeXBlLnR5cGVJZCA9PT0gMTApICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbS50cmFuc2FjdGlvblR5cGUgPT09ICJTYWxlIgogICAgICAgICAgICAgICAgICAgICAgICApOyAvLyB2YWx1YWJsZSB0YXgKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wdWJsaWNMaWdodGluZ1RheCA9IHRoaXMudGF4LmZpbHRlcigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChtKSA9PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChtLnRheFR5cGUudHlwZUlkID09PSA5IHx8IG0udGF4VHlwZS50eXBlSWQgPT09IDEwKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0udHJhbnNhY3Rpb25UeXBlID09PSAiU2FsZSIKICAgICAgICAgICAgICAgICAgICAgICAgKTsgLy8gdmFsdWFibGUgdGF4CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmF0VGF4ID0gdGhpcy50YXguZmlsdGVyKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKG0pID0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG0udGF4VHlwZS50eXBlSWQgPT09IDEgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbS50YXhUeXBlLnR5cGVJZCA9PT0gOCB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLnRheFR5cGUudHlwZUlkID09PSAxMCkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLnRyYW5zYWN0aW9uVHlwZSA9PT0gIlNhbGUiCiAgICAgICAgICAgICAgICAgICAgICAgICk7IC8vIHZhbHVhYmxlIHRheAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRTYWxlVW5pdEl0ZW1zKCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBzYWxlVW5pdEl0ZW1IYW5kbGVyLmxpc3QoKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2FsZVVuaXRJdGVtTGlzdCA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZEN1c3RvbWVyQmFsYW5jZShpZCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJGaWx0ZXIgPSBpZCArICI/dHlwZT1iYWwiOwogICAgICAgICAgICAgICAgICAgIGJpbGxpbmdIYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgIC5iYWxhbmNlKHN0ckZpbHRlcikKICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIuY3VycmVudEJhbGFuY2UgPSBkYXRhWzBdLmJhbGFuY2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKTsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgY3JlZGl0TGltaXRVc2FnZShiYWxhbmNlLCBjcmVkaXRMaW1pdCkgewogICAgICAgICAgICBsZXQgbnVtID0gMDsKICAgICAgICAgICAgbGV0IHBlciA9IChiYWxhbmNlIC8gY3JlZGl0TGltaXQpICogMTAwCiAgICAgICAgICAgIGlmIChpc05hTihwZXIpKSB7CiAgICAgICAgICAgICAgICAvLyBJdCBpc24ndCBhIG51bWJlcgogICAgICAgICAgICAgICAgbnVtID0gMAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gSXQgaXMgYSBudW1iZXIKICAgICAgICAgICAgICAgIG51bSA9IHBlcjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbnVtICsgIiAlIjsKICAgICAgICB9LAogICAgICAgIGNsb3NlKGRhdGEpIHsKICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIkN1c3RvbWVycyIsCiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgd2luZG93Lmhpc3RvcnkuZ28oLTEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhkYXRhLCAiY2xvc2UiKTsKICAgICAgICAgICAgLy8gbG9jYWxTdG9yYWdlLmRhdGEuaWQgPSBKU09OLnN0cmluZ2lmeShkYXRhKQogICAgICAgIH0sCiAgICAgICAgLy9jYXRhbG9nCiAgICAgICAgbG9hZEltYWdlKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGlmIChkYXRhSXRlbS5oYXNPd25Qcm9wZXJ0eSgiaW1hZ2VzIikpIHsKICAgICAgICAgICAgICAgIGlmIChkYXRhSXRlbS5pbWFnZXMuaGFzT3duUHJvcGVydHkoImRlZmF1bHQiKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHVybCA9IHRoaXMuaW1nVVJMICsgZGF0YUl0ZW0uaW1hZ2VzLmRlZmF1bHQudGh1bWI7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgIjxpbWcgd2lkdGg9JzUwJyBoZWlnaHQ9JzUwJyBzdHlsZT0gJ21hcmdpbjogYXV0bztkaXNwbGF5OiBibG9jazsnIHNyYz0nIiArCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCArCiAgICAgICAgICAgICAgICAgICAgICAgICInIC8+IgogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRDYXRhbG9ncygpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgY2F0YWxvZ0hhbmRsZXIuZ2V0KCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXRhbG9ncyA9IHJlczsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhZGRDYXRhbG9nKGUpIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBsZXQgZ3JpZCA9IGtlbmRvLmpRdWVyeSgiI2dyaWRDYXRhbG9nIikuZGF0YSgia2VuZG9HcmlkIik7CiAgICAgICAgICAgIGxldCBkYXRhSXRlbSA9IGdyaWQuZGF0YUl0ZW0oJChlLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoInRyIikpOwogICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coZGF0YUl0ZW0pCiAgICAgICAgICAgIGlmIChkYXRhSXRlbS52YXJpYW50cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBkYXRhSXRlbS52YXJpYW50cy5mb3JFYWNoKChtKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG0uaGFzT3duUHJvcGVydHkoInZhcmlhbnQiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAobS52YXJpYW50Lmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRTaW5nbGVJdGVtKG0udmFyaWFudC5pZCwgImkiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy5kaWFsb2dDYXRhbG9nID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGRhdGFJdGVtLnNlcnZpY2VzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGRhdGFJdGVtLnNlcnZpY2VzLmZvckVhY2goKG0pID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAobS5oYXNPd25Qcm9wZXJ0eSgic2VydmljZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtLnNlcnZpY2UuaGFzT3duUHJvcGVydHkoImlkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZFNpbmdsZUl0ZW0obS5zZXJ2aWNlLmlkLCAicyIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB0aGlzLmRpYWxvZ0NhdGFsb2cgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFNpbmdsZUl0ZW0oaXRlbUlkLCB0eXBlKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdEhhbmRsZXIuZ2V0T25lKGl0ZW1JZCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRhdGEgPSByZXM7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhkYXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5pdGVtTGluZURTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbCA9IGRzLnRvdGFsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbUxpbmUuaWQgPSBpbnZvaWNlUHJlZml4ICsgdXVpZC52MSgpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1MaW5lLml0ZW0gPSBkYXRhOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PSAiaSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbUxpbmUuZGVzY3JpcHRpb24gPSBkYXRhLnZhcmlhbnQuc2FsZURlc2NyaXB0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtTGluZS5kZXNjcmlwdGlvbiA9IGRhdGEuc2FsZURlc2NyaXB0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGRzLmluc2VydCh0b3RhbCwgdGhpcy5pdGVtTGluZSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCA1MDApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRQcmVmaXgoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIHByZWZpeEhhbmRsZXIuZ2V0KCJzYWxlIG9yZGVyIikudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb25UeXBlID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRyYW5zYWN0aW9uVHlwZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIudHJhbnNhY3Rpb25UeXBlID0gdGhpcy50cmFuc2FjdGlvblR5cGVbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmluaXRzYWxlT3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZU51bWJlcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRWaWV3c2FsZU9yZGVyKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuaW5pdHNhbGVPcmRlcikgewogICAgICAgICAgICAgICAgdGhpcy5pc0VkaXQgPSB0cnVlCiAgICAgICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgc2FsZU9yZGVySGFuZGxlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnZpZXcodGhpcy4kcm91dGUucGFyYW1zLmlkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNhbGVPcmRlciA9IHJlcy5kYXRhLmRhdGFbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucXVvdGVzID0gdGhpcy5zYWxlT3JkZXIucmVmRnJvbSB8fCBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJpbmREYXRhKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaCgpOwogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0RGVmYXVsdERhdGEoKQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkUXVvdGUoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnNhbGVPcmRlci5jdXN0b21lcikgewogICAgICAgICAgICAgICAgdGhpcy5yZWZGcm9tID0gW10KICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5xdW90ZXMgPSBbXTsKICAgICAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAiYnlfY3VzdG9tZXIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tZXI6IHRoaXMuc2FsZU9yZGVyLmN1c3RvbWVyLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudElkOiB0aGlzLnNhbGVPcmRlci5zZWdtZW50LmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25JZDogdGhpcy5zYWxlT3JkZXIubG9jYXRpb24uaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmljZUxldmVsSWQ6IHRoaXMuc2FsZU9yZGVyLnByaWNlTGV2ZWwuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiU2FsZSBRdW90ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIHNhbGVPcmRlckhhbmRsZXIuc2VhcmNoKGRhdGEpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5xdW90ZXMgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYWRkUXVvdGUoZGF0YSkgewogICAgICAgICAgICAvL2FkZCBpdGVtIGxpbmVzCiAgICAgICAgICAgIGxldCB0eG5EYXRhID0gZGF0YS50eG5EYXRhIHx8IHt9CiAgICAgICAgICAgIGNvbnN0IGl0ZW1MaW5lcyA9IGRhdGEuaXRlbUxpbmVzIHx8IFtdCiAgICAgICAgICAgIHRoaXMucmVmRnJvbS5wdXNoKHsKICAgICAgICAgICAgICAgIGlkOiBkYXRhLmlkIHx8ICcnLAogICAgICAgICAgICAgICAgcmVmZXJlbmNlOiBkYXRhLm51bWJlciB8fCAnJywKICAgICAgICAgICAgICAgIGN1c3RvbWVySWQ6IHR4bkRhdGEuY3VzdG9tZXJJZCB8fCAnJywKICAgICAgICAgICAgfSkKICAgICAgICAgICAgaWYgKGl0ZW1MaW5lcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUVtcHR5TGluZSgpOwogICAgICAgICAgICAgICAgaXRlbUxpbmVzLmZvckVhY2goKG0pID0+IHsKICAgICAgICAgICAgICAgICAgICBtLnR4bl9hZGRfaWQgPSB0eG5EYXRhLmlkOwogICAgICAgICAgICAgICAgICAgIG0uaWQgPSBpbnZvaWNlUHJlZml4ICsgdXVpZC52MSgpOwogICAgICAgICAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuaXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpLAogICAgICAgICAgICAgICAgICAgICAgICB0b3RhbCA9IGRzLnRvdGFsKCk7CiAgICAgICAgICAgICAgICAgICAgZHMuaW5zZXJ0KHRvdGFsLCBtKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgLy8gdGhpcy5hZGRSb3coKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvL2FkZCBvdGhlciBjaGFyZAogICAgICAgICAgICBpZiAoZGF0YS5vdGhlckNoYXJnZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBkYXRhLm90aGVyQ2hhcmdlLmZvckVhY2goKG0pID0+IHsKICAgICAgICAgICAgICAgICAgICBtLnR4bl9hZGRfaWQgPSB0eG5EYXRhLmlkOwogICAgICAgICAgICAgICAgICAgIHRoaXMubU90aGVyQ2hhcmdlLnB1c2gobSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpOwogICAgICAgICAgICAgICAgdGhpcy5vbk90aGVyQ2hhcmdlQ2hhbmdlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gYWRkIHR4bmxpc3QKICAgICAgICAgICAgdGhpcy50eG5MaXN0cy5wdXNoKHR4bkRhdGEpOwogICAgICAgICAgICBpZiAodHhuRGF0YS5sZWFkLmlkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMudHhuTGlzdHMucHVzaCh0eG5EYXRhLmxlYWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLnR4bkxpc3RzKTsKICAgICAgICAgICAgLy9yZW1vdmUgdHhuCiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5xdW90ZXMuZmluZEluZGV4KChpdGVtKSA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YS5pZCA9PT0gaXRlbS5pZDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpOwogICAgICAgICAgICB0aGlzLnF1b3Rlcy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgICAvLyB0aGlzLnF1b3Rlc1tpbmRleF0uaXNfYWRkZWQgPSB0cnVlCiAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLnF1b3RlcykKICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIucmVmRnJvbSA9IHRoaXMucmVtb3ZlRHVwbGljYXRlKHRoaXMucmVmRnJvbSkKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCdyZWYnLCB0aGlzLnNhbGVPcmRlci5yZWZGcm9tKQogICAgICAgIH0sCiAgICAgICAgcmVtb3ZlRW1wdHlMaW5lKCkgewogICAgICAgICAgICBjb25zdCBncmlkID0ga2VuZG8ualF1ZXJ5KCIjZ3JpZEl0ZW1MaW5lU2FsZU9yZGVyIikuZGF0YSgia2VuZG9HcmlkIiksCiAgICAgICAgICAgICAgICBkYXRhU291cmNlID0gZ3JpZC5kYXRhU291cmNlOwogICAgICAgICAgICBkYXRhU291cmNlLmRhdGEoKS5mb3JFYWNoKChtKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAobSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBtLml0ZW0gfHwge30KICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5pZCA9PT0gdW5kZWZpbmVkIHx8IGl0ZW0uaWQgPT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2UucmVtb3ZlKG0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkVHJhbnNhY3Rpb25SYXRlKCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUodGhpcy5zYWxlT3JkZXIudHJhbnNhY3Rpb25EYXRlKQogICAgICAgICAgICAgICAgICAgICAgICAudG9JU09TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgICAgICAuc3Vic3RyKDAsIDEwKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwcmljZUxldmVsID0gdGhpcy5zYWxlT3JkZXIucHJpY2VMZXZlbDsKICAgICAgICAgICAgICAgICAgICBsZXQgY29kZSA9ICIiOwogICAgICAgICAgICAgICAgICAgIGlmIChwcmljZUxldmVsLmhhc093blByb3BlcnR5KCJjdXJyZW5jeSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcmljZUxldmVsLmN1cnJlbmN5Lmhhc093blByb3BlcnR5KCJjb2RlIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUgPSBwcmljZUxldmVsLmN1cnJlbmN5LmNvZGU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGNvZGUgIT09IHVuZGVmaW5lZCB8fCBjb2RlICE9PSAiIikgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lIYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0TGFzdEV4Y2hhbmdlUmF0ZUJ5RGF0ZShkYXRlLCBjb2RlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV4Y2hhbmdlUmF0ZSA9IHJlcy5kYXRhLmRhdGFbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVuY3lDb2RlID0gdGhpcy5leGNoYW5nZVJhdGUuY29kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvblJhdGUgPSB0aGlzLmV4Y2hhbmdlUmF0ZS5yYXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNhbGVPcmRlci50eG5SYXRlID0gdGhpcy5leGNoYW5nZVJhdGUucmF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIuZXhjaGFuZ2VSYXRlID0gdGhpcy5leGNoYW5nZVJhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgY2xlYXIoKSB7CiAgICAgICAgICAgIHRoaXMuaWQgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIHRoaXMuc2FsZU9yZGVyID0ge307CiAgICAgICAgICAgIHRoaXMuaXRlbUxpbmVzID0gW107CiAgICAgICAgICAgIHRoaXMuY3VzdG9tZXIgPSAnJwogICAgICAgICAgICB0aGlzLmdlbmVyYXRlTnVtYmVyKCk7CiAgICAgICAgfSwKICAgICAgICBzYXZlQ2xvc2UoKSB7CiAgICAgICAgICAgIGxldCBpZCA9ICIiOwogICAgICAgICAgICBpZiAodGhpcy5jdXN0b21lci5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgaWQgPSB0aGlzLmN1c3RvbWVyLmlkIHx8ICIiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpZCA9PT0gIiIpIHsKICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoImN1c3RvbWVyIGlzIHJlcXVpcmUiKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLml0ZW1MaW5lRFMua2VuZG9XaWRnZXQoKTsKICAgICAgICAgICAgbGV0IGQxID0gZHMuZGF0YSgpLmZpbHRlcigobSkgPT4gbS5hbW91bnQgPiAwKTsKICAgICAgICAgICAgbGV0IGRhdGFWYWxpZGF0ZSA9IDA7CiAgICAgICAgICAgIGQxLmZvckVhY2goKHZhbHVlLCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHZhbHVlLml0ZW0uaWQgPT0gdW5kZWZpbmVkIHx8IHZhbHVlLnVvbS5pZCA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LmVycm9yKAogICAgICAgICAgICAgICAgICAgICAgICAiUGxlYXNlIGNoZWNrIEl0ZW0gb3IgVW9tICBvbiByb3cgIiArIChpbmRleCArIDEpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbGlkYXRlICs9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAoZDEubGVuZ3RoID09IGRhdGFWYWxpZGF0ZSkgewogICAgICAgICAgICAgICAgdGhpcy5pc1NhdmVDbG9zZSA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLnNhdmVPcHRpb24gPSAic2F2ZUNsb3NlIjsKICAgICAgICAgICAgICAgIHRoaXMuc2F2ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzYXZlUHJpbnQoKSB7CiAgICAgICAgICAgIHRoaXMuaXNTYXZlUHJpbnQgPSB0cnVlOwogICAgICAgICAgICB0aGlzLnNhdmVPcHRpb24gPSAic2F2ZVByaW50IjsKICAgICAgICAgICAgdGhpcy5zYXZlKCk7CiAgICAgICAgfSwKICAgICAgICBzYXZlTmV3KCkgewogICAgICAgICAgICB0aGlzLnNhdmVPcHRpb24gPSAic2F2ZU5ldyI7CiAgICAgICAgICAgIHRoaXMuaXNTYXZlTmV3ID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5zYXZlKCk7CiAgICAgICAgfSwKICAgICAgICBjYW5jZWwoKSB7CiAgICAgICAgICAgIHRoaXMuJHN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IGkxOG4udCgibXNnX3RpdGxlX3dhcm5pbmciKSwKICAgICAgICAgICAgICAgIHRleHQ6IGkxOG4udCgibXNnX2Rpc2NhcmQiKSwKICAgICAgICAgICAgICAgIGljb246ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBpMThuLnQoImNhbmNlbCIpLAogICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzRkNDg0OCIsCiAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNFRDFBM0EiLAogICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IGkxOG4udCgiZGlzY2FyZCIpLAogICAgICAgICAgICB9KS50aGVuKChyZXN1bHRDZW4pID0+IHsKICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhyZXN1bHRDZW4pOwogICAgICAgICAgICAgICAgaWYgKHJlc3VsdENlbi52YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5nbygtMSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgc2F2ZURyYWZ0KCkgewogICAgICAgICAgICB0aGlzLnNhdmVPcHRpb24gPSAic2F2ZURyYWZ0IjsKICAgICAgICAgICAgdGhpcy5pc1NhdmVEcmFmdCA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuc2F2ZSgpOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgc2F2ZSgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLiRyZWZzLmZvcm0udmFsaWRhdGUoKSkgewogICAgICAgICAgICAgICAgdGhpcy4kcmVmcy5mb3JtLnZhbGlkYXRlKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVFbXB0eUxpbmUoKTsKICAgICAgICAgICAgICAgICAgICBsZXQgaXRlbUxpbmVEUyA9IHRoaXMuJHJlZnMuaXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpLAogICAgICAgICAgICAgICAgICAgICAgICB0b3RhbCA9IGl0ZW1MaW5lRFMudG90YWwoKTsKICAgICAgICAgICAgICAgICAgICBsZXQgaXRtTGluZXMgPSBpdGVtTGluZURTLmRhdGEoKS5maWx0ZXIobSA9PiBtLmFtb3VudCA+IDApLm1hcChtID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBJdGVtTGluZU1vZGVsKG0pOwogICAgICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgICAgIGlmICh0b3RhbCA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoIkZpZWxkIFJlcXVpcmVkISIpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc1JlcXVyZWRQdXJjaGFzZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNhbGVPcmRlci5zdXBwbGllciA9IHt9OwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vaXMgZm9yIHB1cmNoYXNlCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2FsZU9yZGVyVHlwZSA9IDU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyhpdG1MaW5lcywgJ2l0bUxpbmVzJykKICAgICAgICAgICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoaXRtTGluZXMpLCAnaXRtTGluZXMnKQogICAgICAgICAgICAgICAgICAgIGxldCBkYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICBpZDogdGhpcy5zYWxlT3JkZXIuaWQgPyB0aGlzLnNhbGVPcmRlci5pZCA6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiU2FsZSBPcmRlciIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uVHlwZTogdGhpcy5zYWxlT3JkZXIudHJhbnNhY3Rpb25UeXBlLAogICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IHRoaXMuc2FsZU9yZGVyLm51bWJlciwKICAgICAgICAgICAgICAgICAgICAgICAgYWJicjogdGhpcy5zYWxlT3JkZXIudHJhbnNhY3Rpb25UeXBlLmFiYnIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogdGhpcy5zYWxlT3JkZXIudHJhbnNhY3Rpb25EYXRlLAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbkRhdGVUWjogSGVscGVyLnRvSVNPRGF0ZSh0aGlzLnNhbGVPcmRlci50cmFuc2FjdGlvbkRhdGUpLAogICAgICAgICAgICAgICAgICAgICAgICB2YWxpZGl0eURhdGU6IHRoaXMuc2FsZU9yZGVyLnZhbGlkaXR5RGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgbW9udGhPZjogdGhpcy5zYWxlT3JkZXIubW9udGhPZiwKICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tZXI6IHRoaXMuc2FsZU9yZGVyLmN1c3RvbWVyLAogICAgICAgICAgICAgICAgICAgICAgICBwYXltZW50VGVybTogdGhpcy5zYWxlT3JkZXIucGF5bWVudFRlcm0sCiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50UHJvbW90aW9uOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgcHJpY2VMZXZlbDogdGhpcy5zYWxlT3JkZXIucHJpY2VMZXZlbCwKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbUxpbmVzOiBpdG1MaW5lcywKICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudDogdGhpcy5zYWxlT3JkZXIuc2VnbWVudCwKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IHRoaXMuc2FsZU9yZGVyLmxvY2F0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0OiB0aGlzLnNhbGVPcmRlci5wcm9qZWN0LAogICAgICAgICAgICAgICAgICAgICAgICBzYWxlQ2hhbm5lbDogdGhpcy5zYWxlT3JkZXIuc2FsZUNoYW5uZWwsCiAgICAgICAgICAgICAgICAgICAgICAgIGJpbGxpbmdBZGRyZXNzOiB0aGlzLnNhbGVPcmRlci5iaWxsaW5nQWRkcmVzcywKICAgICAgICAgICAgICAgICAgICAgICAgZGVsaXZlcnlBZGRyZXNzOiB0aGlzLnNhbGVPcmRlci5kZWxpdmVyeUFkZHJlc3MsCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGl2ZXJ5RGF0ZVRpbWU6IHRoaXMuc2FsZU9yZGVyLmRlbGl2ZXJ5RGF0ZVRpbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uTm90ZTogdGhpcy5zYWxlT3JkZXIudHJhbnNhY3Rpb25Ob3RlLAogICAgICAgICAgICAgICAgICAgICAgICBzdWJUb3RhbDogdGhpcy5zYWxlT3JkZXIuc3ViVG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiB0aGlzLnNhbGVPcmRlci50b3RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiB0aGlzLnNhbGVPcmRlci5hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50VG90YWw6IHRoaXMuc2FsZU9yZGVyLmRpc2NvdW50VG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgIHNwZWNpZmljRGlzY291bnRUb3RhbDogdGhpcy5zYWxlT3JkZXIuc3BlY2lmaWNEaXNjb3VudFRvdGFsLAogICAgICAgICAgICAgICAgICAgICAgICBkZWxpdmVyeUZlZTogdGhpcy5zYWxlT3JkZXIuZGVsaXZlcnlGZWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsVGF4QW1vdW50OiB0aGlzLnNhbGVPcmRlci50b3RhbFRheEFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEJhbGFuY2U6IHRoaXMuc2FsZU9yZGVyLmN1cnJlbnRCYWxhbmNlLAogICAgICAgICAgICAgICAgICAgICAgICBjcmVkaXRMaW1pdDogdGhpcy5zYWxlT3JkZXIuY3JlZGl0TGltaXQsCiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVPcHRpb246IHRoaXMuc2F2ZU9wdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgdHhuUmF0ZTogdGhpcy5zYWxlT3JkZXIudHhuUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgcmF0ZTogMSwKICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VSYXRlOiB0aGlzLnNhbGVPcmRlci5leGNoYW5nZVJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OiB0aGlzLnNhbGVPcmRlci5leGNoYW5nZUFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAxLAogICAgICAgICAgICAgICAgICAgICAgICBhcHByb3ZlZEJ5OiB0aGlzLnNhbGVPcmRlci5hcHByb3ZlZEJ5LAogICAgICAgICAgICAgICAgICAgICAgICBmb3JtVGVtcGxhdGU6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBzcGVjaWZpY0Rpc2NvdW50SXRlbTogdGhpcy5zYWxlT3JkZXIuc3BlY2lmaWNEaXNjb3VudEl0ZW0sCiAgICAgICAgICAgICAgICAgICAgICAgIG90aGVyQ2hhcmdlOiB0aGlzLm1PdGhlckNoYXJnZSwKICAgICAgICAgICAgICAgICAgICAgICAgb3RoZXJDaGFyZ2VBbW91bnQ6IHRoaXMuc2FsZU9yZGVyLm90aGVyQ2hhcmdlQW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWNMaW5rOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGF4TGlzdFRvdGFsOiB0aGlzLnRheExpc3RUb3RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tZXJEaXNjb3VudEl0ZW06IHRoaXMuY3VzdG9tZXJEaXNjb3VudEl0ZW0sCiAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbWVyU2FsZVVuaXQ6IHRoaXMuY3VzdG9tZXJTYWxlVW5pdCwKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VkVXNlcjogdGhpcy5sb2dnZWRVc2VyLAogICAgICAgICAgICAgICAgICAgICAgICB0eG5MaXN0OiB0aGlzLnR4bkxpc3RzLAogICAgICAgICAgICAgICAgICAgICAgICBzYWxlT3JkZXJUeXBlOiB0aGlzLnNhbGVPcmRlci5zYWxlT3JkZXJUeXBlLAogICAgICAgICAgICAgICAgICAgICAgICBlbXBsb3llZTogdGhpcy5zYWxlT3JkZXIuZW1wbG95ZWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHN1cHBsaWVyOiB0aGlzLnNhbGVPcmRlci5zdXBwbGllciwKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVN1YnRvdGFsOiB0aGlzLnNhbGVPcmRlci5pdGVtU3VidG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlSXRlbVN1YnRvdGFsOiB0aGlzLnNhbGVPcmRlci5leGNoYW5nZUl0ZW1TdWJ0b3RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgc2VydmljZVN1YnRvdGFsOiB0aGlzLnNhbGVPcmRlci5zZXJ2aWNlU3VidG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlU2VydmljZVN1YnRvdGFsOiB0aGlzLnNhbGVPcmRlci5leGNoYW5nZVNlcnZpY2VTdWJ0b3RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgdHhuSXRtU3VidG90YWw6IHRoaXMuc2FsZU9yZGVyLnR4bkl0bVN1YnRvdGFsLAogICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZVR4bkl0bVN1YnRvdGFsOiB0aGlzLnNhbGVPcmRlci5leGNoYW5nZVR4bkl0bVN1YnRvdGFsLAogICAgICAgICAgICAgICAgICAgICAgICBpdGVtRGlzY291bnQ6IHRoaXMuc2FsZU9yZGVyLml0ZW1EaXNjb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VJdGVtRGlzY291bnQ6IHRoaXMuc2FsZU9yZGVyLmV4Y2hhbmdlSXRlbURpc2NvdW50LAogICAgICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlRGlzY291bnQ6IHRoaXMuc2FsZU9yZGVyLnNlcnZpY2VEaXNjb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VTZXJ2aWNlRGlzY291bnQ6IHRoaXMuc2FsZU9yZGVyLmV4Y2hhbmdlU2VydmljZURpc2NvdW50LAogICAgICAgICAgICAgICAgICAgICAgICB0eG5JdG1EaXNjb3VudDogdGhpcy5zYWxlT3JkZXIudHhuSXRtRGlzY291bnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlVHhuSXRtRGlzY291bnQ6IHRoaXMuc2FsZU9yZGVyLmV4Y2hhbmdlVHhuSXRtRGlzY291bnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGxlYWQ6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICByb3V0ZVZpZXc6ICJzYWxlX29yZGVyX3ZpZXciLAogICAgICAgICAgICAgICAgICAgICAgICBleHNwZWN0ZWREYXRlOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgdXNlZERhdGVBdDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRBdDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZWQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZkZyb206IHRoaXMuc2FsZU9yZGVyLnJlZkZyb20gfHwgW10sCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZlRvOiB0aGlzLnNhbGVPcmRlci5yZWZUbyB8fCBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3Vic3RyKDAsIDEwKSwKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZygnZGF0YScsIGRhdGEpCiAgICAgICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKCdkYXRhJywgSlNPTi5zdHJpbmdpZnkoZGF0YSkpCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5idG5EaXNhYmxlZCA9IHRydWUKICAgICAgICAgICAgICAgICAgICBzYWxlT3JkZXJIYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgIC5jcmVhdGUoZGF0YSkKICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXNDb2RlID09PSAyMDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJ0bkRpc2FibGVkID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1NhdmVOZXcgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldERlZmF1bHREYXRhKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZShyZXNwb25zZS5kYXRhLmRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLiRyZWZzLmZvcm0ucmVzZXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LnN1Y2Nlc3MoIlN1Y2Nlc3NmdWxseSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJ0bkRpc2FibGVkID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcigiU29tZXRoaW5nIHdlbnQgd3JvbmciKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JzLnB1c2goZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRQYXltZW50VGVybUxpc3QoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1c3RvbWVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0ckZpbHRlciA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiP2lkPSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXN0b21lci5pZCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiJnRyYW5zYWN0aW9uRGF0ZT0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2FsZU9yZGVyLnRyYW5zYWN0aW9uRGF0ZSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiJnR5cGU9Q3VzdG9tZXIiOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNhbGVPcmRlci5wYXltZW50VGVybSA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICBwYXltZW50VGVybUhhbmRsZXJfLmdldChzdHJGaWx0ZXIpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRlcm1zID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNhbGVPcmRlci5wYXltZW50VGVybSA9IHRlcm1zLnRlcm07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkQ3JlZGl0TGltaXQoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1c3RvbWVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0ckZpbHRlciA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiP2lkPSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXN0b21lci5pZCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiJnRyYW5zYWN0aW9uRGF0ZT0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2FsZU9yZGVyLnRyYW5zYWN0aW9uRGF0ZSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiJnR5cGU9Q3VzdG9tZXIiOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNhbGVPcmRlci5jcmVkaXRMaW1pdCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWRpdExpbWl0SGFuZGxlci5nZXQoc3RyRmlsdGVyKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmNyZWRpdExpbWl0SXRlbSA9IHJlcy5kYXRhLmRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjcmVkaXQgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2FsZU9yZGVyLmNyZWRpdExpbWl0ID0ga2VuZG8ucGFyc2VGbG9hdCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlZGl0LmFtb3VudCB8fCAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGNsZWFyVU9NSXRlbSgpIHsKICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5pdGVtTGluZURTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgIGRzLmRhdGEoKS5tYXAoKG4pID0+IHsKICAgICAgICAgICAgICAgIG4uc2V0KCJ1b20iLCB7fSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmlzUHJpY2VMZXZlbENoYW5nZWQgPSBmYWxzZTsKICAgICAgICB9LAogICAgICAgIG9uUHJpY2VMZXZlbENoYW5nZSgpIHsKICAgICAgICAgICAgdGhpcy5pc1ByaWNlTGV2ZWxDaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5sb2FkVHJhbnNhY3Rpb25SYXRlKCk7CiAgICAgICAgICAgIHRoaXMuY2xlYXJVT01JdGVtKCk7CiAgICAgICAgICAgIHRoaXMubG9hZFF1b3RlKCkKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRTYWxlT3JkZXIoaWQpIHsKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKGlkLCAnbG9hZCBpZCcpCiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlCiAgICAgICAgICAgIHRyYW5zYWN0aW9uSGFuZGxlci52aWV3KGlkKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgdGhpcy5pc0VkaXQgPSB0cnVlCiAgICAgICAgICAgICAgICB0aGlzLml0ZW1MaW5lcyA9IFtdCiAgICAgICAgICAgICAgICB0aGlzLnNhbGVPcmRlciA9IHJlcy5kYXRhLmRhdGFbMF0KICAgICAgICAgICAgICAgIHRoaXMuYmluZERhdGEoKTsKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRFbXBsb3llZUNlbnRlcigpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbXBsb3llZXMgPSBbXTsKICAgICAgICAgICAgICAgICAgICBlbXBsb3llZUhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgLmNlbnRlcih1bmRlZmluZWQpCiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIuZW1wbG95ZWUgPSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbXBsb3llZXMgPSBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtcGxveWVlcyA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgKHRoaXMuZW1wbG95ZWVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgdGhpcy50cmFuc2FjdGlvbi5lbXBsb3llZSA9IHRoaXMuZW1wbG95ZWVzWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKTsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFNpbmdsZURhdGEoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5uYW1lID09PSAnU2FsZSBPcmRlcicpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmluaXRzYWxlT3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAvLyBFZGl0IE1vZGUKICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1MaW5lcyA9IFtdCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIgPSB0aGlzLmluaXRzYWxlT3JkZXI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5iaW5kRGF0YSgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBuZXcKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRTYWxlT3JkZXIodGhpcy4kcm91dGUucGFyYW1zLmlkKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RGVmYXVsdERhdGEoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHByZWZpeEhhbmRsZXIuZ2V0KCJzYWxlIG9yZGVyIikudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb25UeXBlID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudHJhbnNhY3Rpb25UeXBlLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgIT09IHVuZGVmaW5lZCB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlLnBhcmFtcy5pZCAhPSAiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYWxlT3JkZXIudHJhbnNhY3Rpb25UeXBlID0gdGhpcy50cmFuc2FjdGlvblR5cGVbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmluaXRTYWxlT3JkZXIgJiYgdGhpcy4kcm91dGUucGFyYW1zLmlkID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZU51bWJlcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5sb2FkUGF5bWVudFRlcm0oKTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMubG9hZFNhbGVGb3JtQ29udGVudCgpOwogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5sb2FkT3RoZXJDaGFyZ2UoKTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMubG9hZFByaWNlTGV2ZWwoKTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMubG9hZERpc2NvdW50SXRlbSgwKTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMubG9hZFNhbGVDaGFubmVsKCk7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmxvYWRDYXRhbG9ncygpOwogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5sb2FkTGVhZCgpOwogICAgICAgICAgICAgICAgdGhpcy5sb2FkVGF4KCk7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRTYWxlVW5pdEl0ZW1zKCk7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRTZWdtZW50KCk7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRMb2NhdGlvbigpOwogICAgICAgICAgICAgICAgdGhpcy5sb2FkRW1wbG95ZWVDZW50ZXIoKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICB9LAogICAgYWN0aXZhdGVkKCkgewogICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQpIHsKICAgICAgICAgICAgdGhpcy5sb2FkVmlld3NhbGVPcmRlcigpOwogICAgICAgIH0KICAgIH0sCiAgICB3YXRjaDogewogICAgICAgIGluaXRzYWxlT3JkZXIoKSB7CiAgICAgICAgICAgIHRoaXMuaW5pdGlhbERhdGEoKTsKICAgICAgICB9LAogICAgICAgICckcm91dGUnOiAnbG9hZFNpbmdsZURhdGEnLAogICAgfSwKICAgIGNyZWF0ZWQoKSB7CiAgICAgICAgdGhpcy5sb2FkVGF4KCk7CiAgICAgICAgdGhpcy5sb2FkU2FsZVVuaXRJdGVtcygpOwogICAgICAgIC8vIHRoaXMubG9hZFByZWZpeCgpCiAgICAgICAgdGhpcy5sb2FkU2VnbWVudCgpOwogICAgICAgIHRoaXMubG9hZExvY2F0aW9uKCk7CiAgICAgICAgLy8gbG9jYWxTdG9yYWdlLnNhbGVPcmRlciA9ICJ7bmFtZTogJ2FiY3Nzc3MnfSIKICAgIH0sCiAgICBjb21wdXRlZDogewogICAgICAgIGFwcFR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiBkYXRhU3RvcmUucHJvZHVjdFR5cGU7CiAgICAgICAgfSwKICAgICAgICBkYXRlRm9ybWF0dGVkKCkgewogICAgICAgICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcobmV3IERhdGUoKSwgaW5zdGl0dXRlLmRhdGVGb3JtYXQpOwogICAgICAgIH0sCiAgICAgICAgZGF0ZVRpbWVGb3JtYXR0ZWQoKSB7CiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhpbnN0aXR1dGUuZGF0ZUZvcm1hdCArICIgSEg6bW0iLCAiaW5zdCBkYXRlIik7CiAgICAgICAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyhuZXcgRGF0ZSgpLCBpbnN0aXR1dGUuZGF0ZUZvcm1hdCArICIgSEg6bW0iKTsKICAgICAgICB9LAogICAgICAgIHZhbGlkQ3VzdG9tZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1c3RvbWVyLmlkICE9PSB1bmRlZmluZWQgJiYgdGhpcy5jdXN0b21lci5pZCAhPT0gbnVsbDsKICAgICAgICB9LAogICAgICAgIGhpZGRlbkJ1dHRvbigpIHsKICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBkaXNhYmxlZE1lKCkgewogICAgICAgICAgICByZXR1cm4gISF0aGlzLiRyb3V0ZS5wYXJhbXMuaWQ7CiAgICAgICAgfSwKICAgIH0sCiAgICBtb3VudGVkOiBhc3luYyBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5sb2FkU2luZ2xlRGF0YSgpOwogICAgICAgIGF3YWl0IHRoaXMucmVxdWVzdERhdGEoMCwgdGhpcy5maWx0ZXIsIHRoaXMuY3VzQmFzZVVybCk7CiAgICAgICAgYXdhaXQgdGhpcy5zdXBwbGllclJlcXVlc3REYXRhKDAsIHRoaXMuZmlsdGVyLCB0aGlzLnN1cEJhc2VVcmwpOwogICAgICAgIGF3YWl0IHRoaXMuZW1wbG95ZWVSZXF1ZXN0RGF0YSgwLCB0aGlzLmZpbHRlciwgdGhpcy5lbXBCYXNlVXJsKTsKICAgIH0sCn07Cg=="},{"version":3,"sources":["SaleOrder.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqyBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"SaleOrder.vue","sourceRoot":"src/views/customers","sourcesContent":["<template>\n    <v-app>\n        <v-container>\n            <v-row>\n                <v-col sm=\"12\" cols=\"12\">\n                    <v-card\n                        outlined\n                        dense\n                        class=\"pa-4 no_border rounded-sm\"\n                        color=\"white\">\n                        <v-row>\n                            <v-col\n                                class=\"bigSide py-0 pr-2\"\n                                sm=\"8\"\n                                cols=\"12\"\n                                style=\"transition: .3s ease-in;\"\n                                :class=\"{ hide_big_bar_class: isHideBar }\">\n                                <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                                    <v-card outlined dense class=\"no_border\">\n                                        <h2 class=\"mb-0\"><span v-if=\"appType != 'npo'\">{{\n                                                saleFormContent.saleOrder\n                                            }}</span> <span v-else> {{ $t('contract') }}</span></h2>\n\n                                        <v-icon v-if=\"isHideBar\" @click=\"cancel()\"\n                                                style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                                                class=\"float-right\">close\n                                        </v-icon>\n                                        <span style=\"transition: .3s ease-in; z-index:10;\"\n                                              :class=\"{iconArrow: !isHideBar, iconArrowHide: isHideBar}\">\n                                            <v-icon size=\"22\" class=\"arr_icon\" @click=\"hide_smallsitebar\"\n                                                    v-if=\"isHideBar\">mdi-chevron-left-circle</v-icon>\n                                            <v-icon size=\"22\" class=\"arr_icon\" @click=\"hide_smallsitebar\"\n                                                    v-if=\"!isHideBar\">mdi-chevron-right-circle</v-icon>\n                                        </span>\n                                    </v-card>\n                                    <v-card\n                                        outlined\n                                        dense\n                                        class=\"px-3 mb-3 rounded-4 no_border\"\n                                        color=\"grayBg\">\n                                        <v-row>\n                                            <v-col sm=\"4\" cols=\"12\" class=\"pb-0 pa-4\">\n                                                <label v-if=\"appType == 'npo' \" class=\"label  mb-0\">{{\n                                                        $t(\"donor\")\n                                                    }}</label>\n                                                <label v-else class=\"label  mb-0\">{{ $t(\"customer\") }}</label>\n                                                <div class=\"kendo_dropdown_custom pb-2 mt-1\">\n                                                    <dropdownlist\n                                                        class=\"v-input__slot\"\n                                                        :data-items=\"customerList\"\n                                                        @change=\"onChange\"\n                                                        :rules=\"[(v) => !!v || 'Customer is required']\"\n                                                        :value=\"customer\"\n                                                        :data-item-key=\"dataItemKey\"\n                                                        :text-field=\"textField\"\n                                                        :default-item=\"defaultItem\"\n                                                        :filterable=\"true\"\n                                                        @filterchange=\"onFilterChange\"\n                                                        :required=\"true\"\n                                                        :valid=\"validCustomer\"\n                                                        :disabled=\"isEdit\">\n                                                    </dropdownlist>\n                                                </div>\n                                                <label class=\"label\" style=\"\">{{ $t(\"date\") }}</label>\n                                                <app-datepicker\n                                                    :initialDate=\"saleOrder.transactionDate\"\n                                                    @onChanged=\"onSaleOrderDateChanged\"\n                                                    @emitDate=\"saleOrder.transactionDate = $event\"/>\n                                                <label class=\"label\">{{ $t(\"number\") }}</label>\n                                                <v-row class=\"mt-1 mr-0\">\n                                                    <v-col sm=\"3\" cols=\"3\" class=\"py-0 pr-0\">\n                                                        <div class=\"code_text text-bold\">\n                                                            {{ saleOrder.transactionType.abbr }}\n                                                        </div>\n                                                    </v-col>\n                                                    <v-col sm=\"7\" cols=\"7\" class=\"py-0 pl-0 pr-1\">\n                                                        <v-text-field\n                                                            class=\" custom-border \"\n                                                            disabled\n                                                            v-model=\"saleOrder.number\"\n                                                            outlined\n                                                            :rules=\"[(v) => !!v || 'Number is required']\"\n                                                            required/>\n                                                    </v-col>\n                                                    <v-col sm=\"2\" cols=\"2\" class=\"py-0 px-0\">\n                                                        <v-icon color=\"black\"\n                                                                size=\"30\"\n                                                                class=\"border_qrcode\"\n                                                                :disabled=\"disabledMe\"\n                                                                @click=\"generateNumber\">mdi-qrcode\n                                                        </v-icon>\n                                                    </v-col>\n                                                </v-row>\n                                            </v-col>\n                                            <v-col sm=\"8\" cols=\"12\" class=\"pa-4\">\n                                                <v-row v-if=\"appType != 'npo'\" class=\"mt-0\">\n                                                    <v-col sm=\"6\" cols=\"12\" class=\"pt-0 pb-5\">\n                                                        <p class=\"mb-1 d-block\">\n                                                            {{ $t(\"current_balance\") }}\n                                                        </p>\n                                                        <h3 class=\"primary--text float-right\">\n                                                            {{ numberFormat(saleOrder.currentBalance) }}\n                                                        </h3>\n                                                    </v-col>\n                                                    <v-col sm=\"6\" cols=\"12\" class=\"pl-0 pt-0 pb-5\">\n                                                        <p class=\"mb-1 d-block\">\n                                                            {{ $t(\"credit_limit_allowed\") }}\n                                                        </p>\n                                                        <h3 class=\"primary--text float-left\">\n                                                            {{\n                                                                creditLimitUsage(saleOrder.currentBalance, saleOrder.creditLimit)\n                                                            }}\n                                                        </h3>\n                                                        <h3 class=\"primary--text float-right\">\n                                                            {{ numberFormat(saleOrder.creditLimit) }}\n                                                        </h3>\n                                                    </v-col>\n                                                </v-row>\n                                                <v-row class=\"mr-0\">\n                                                    <v-col class=\"pb-0 pt-0\" sm=\"6\" cols=\"12\">\n                                                        <label class=\"label\">{{ $t(\"term\") }}</label>\n                                                        <v-select\n                                                            class=\"mt-1\"\n                                                            v-model=\"saleOrder.paymentTerm\"\n                                                            :items=\"paymentTerms\"\n                                                            @change=\"onPaymentTermChanged\"\n                                                            placeholder=\"Term\"\n                                                            item-text=\"name\"\n                                                            item-value=\"id\"\n                                                            return-object\n                                                            outlined/>\n                                                        <div v-if=\"appType === 'npo' || appType  ===  'Publish Sectors' \">\n                                                            <label class=\"label\">{{ $t(\"contract\") }}</label>\n                                                            <v-select\n                                                                class=\"mt-1\"\n                                                                :items=\"saleOrderTypes\"\n                                                                v-model=\"saleOrder.saleOrderType\"\n                                                                item-text=\"name\"\n                                                                item-value=\"id\"\n                                                                return-object\n                                                            outlined/>\n                                                        </div>\n                                                    </v-col>\n                                                    <v-col class=\"pb-0 pr-0 pt-0\" sm=\"6\" cols=\"12\">\n                                                        <label class=\"label mb-0\">{{ $t(\"price_level\") }}</label>\n                                                        <v-select\n                                                            class=\"mt-1\"\n                                                            v-model=\"saleOrder.priceLevel\"\n                                                            :items=\"priceLevel\"\n                                                            :rules=\"[(v) => !!v['id'] || 'Price level is required']\"\n                                                            @change=\"onPriceLevelChange\"\n                                                            item-value=\"id\"\n                                                            item-text=\"name\"\n                                                            return-object\n                                                            placeholder=\"Price Level\"\n                                                            tage=\"Price Level\"\n                                                            outlined/>\n                                                 \n                                                    </v-col>\n                                                    <v-col\n                                                        sm=\"6\"\n                                                        col=\"6\"\n                                                        class=\" py-0 d-flex justify-space-between\">\n                                                        <div>\n                                                            <p class=\"label mb-0\">{{ $t(\"currency\") }}</p>\n                                                            <p class=\"label mb-0 pt-4 pb-3\">{{ currencyCode }}</p>\n                                                        </div>\n                                                        <div>\n                                                            <p class=\"label mb-0\">{{ $t(\"rate\") }}</p>\n                                                            <p class=\"label mb-0 pt-4 pb-3\">{{ transactionRate }}</p>\n                                                        </div>\n                                                    </v-col>\n                                                </v-row>\n                                            </v-col>\n                                        </v-row>\n                                    </v-card>\n                                    <v-row class=\"pt-1 px-3\" style=\"background-color: #fff;\">\n                                        <v-col sm=\"12\" cols=\"12\" class=\"pt-0 pb-1 px-0\">\n                                            <kendo-datasource\n                                                ref=\"itemLineDS\"\n                                                :data=\"itemLines\"\n                                                :change=\"dataSourceChanged\"/>\n                                            <kendo-grid\n                                                id=\"gridItemLineSaleOrder\"\n                                                class=\"grid-function\"\n                                                :data-source-ref=\"'itemLineDS'\"\n                                                :sortable=\"false\"\n                                                :column-menu=\"true\"\n                                                :editable=\"true\"\n                                                :scrollable-virtual=\"true\">\n                                                <kendo-grid-column\n                                                    :command=\"{iconClass: 'k-icon k-i-trash', text: ' ', click: removeRow, className: 'btn-plus'}\"\n                                                    :title=\"''\"\n                                                    :width=\"63\"\n                                                    :headerAttributes=\"{style: 'text-align: left; background-color: #EDF1F5'}\"/>\n                                                <kendo-grid-column\n                                                    :title=\"$t('no.')\"\n                                                    :width=\"53\"\n                                                    :column-menu=\"false\"\n                                                    :template=\"rowNumberTmpl\"\n                                                    :headerAttributes=\"{style: 'background-color: #EDF1F5;', class: 'text-products'}\"\n                                                    :attributes=\"{style: 'text-align: products'}\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'item'\"\n                                                    :title=\"$t('item')\"\n                                                    :template=\"itemTemplate\"\n                                                    :editor=\"ItemDropDownEditor\"\n                                                    :width=\"200\"\n                                                    :headerAttributes=\"{style: 'background-color: #EDF1F5'}\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'description'\"\n                                                    :title=\"$t('description')\"\n                                                    :template=\"'<span>#=description#</span>'\"\n                                                    :width=\"200\"\n                                                    :headerAttributes=\"{style: 'background-color: #EDF1F5'}\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'uom'\"\n                                                    :title=\"$t('uom')\"\n                                                    :width=\"100\"\n                                                    :template=\"UOMTemplate\"\n                                                    :editor=\"UOMDropDownEditor\"\n                                                    :headerAttributes=\"{style: 'text-align: left; background-color: #EDF1F5'}\"\n                                                    :attributes=\"{style: 'text-align: left'}\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'qty'\"\n                                                    :title=\"$t('qty')\"\n                                                    :format=\"'{0:n}'\"\n                                                    :template=\"'<span>#=qty#</span>'\"\n                                                    :width=\"100\"\n                                                    :headerAttributes=\"{style: 'text-align: left; background-color: #EDF1F5'}\"\n                                                    :attributes=\"{ style: 'text-align: left;'}\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'price'\"\n                                                    :title=\"$t('price')\"\n                                                    :width=\"150\"\n                                                    :template=\"priceFormat\"\n                                                    :headerAttributes=\"{style:'text-align: left; background-color: #EDF1F5'}\"\n                                                    :attributes=\"{style: 'text-align: left'}\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'amount'\"\n                                                    :title=\"$t('amount')\"\n                                                    :width=\"150\"\n                                                    :editable=\"() => {return false}\"\n                                                    :template=\"amountFormat\"\n                                                    :headerAttributes=\"{style:'text-align: left; background-color: #EDF1F5'}\"\n                                                    :attributes=\"{style: 'text-align: left'}\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'vatTax'\"\n                                                    :title=\"$t('vat')\"\n                                                    :width=\"200\"\n                                                    :template=\"vatTemplate\"\n                                                    :hidden=\"appType !='npo' ? false: true\"\n                                                    :editor=\"VatTaxDropDownEditor\"\n                                                    :headerAttributes=\"{style:'text-align: left; background-color: #EDF1F5'}\"\n                                                    :attributes=\"{ style: 'text-align: left' }\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'serviceDate'\"\n                                                    :title=\"$t('date_from')\"\n                                                    :width=\"160\"\n                                                    :hidden=\"!saleFormContent.serviceDate\"\n                                                    :template=\"'<span>#= kendo.toString(new Date(serviceDate), dateFormat)#</span>'\"\n                                                    :editor=\"ServiceDateEditor\"\n                                                    :headerAttributes=\"{style: 'background-color: #EDF1F5'}\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'serviceDateTo'\"\n                                                    :title=\"$t('date_to')\"\n                                                    :width=\"160\"\n                                                    :hidden=\"!saleFormContent.serviceDateTo\"\n                                                    :template=\"'<span>#= kendo.toString(new Date(serviceDateTo), dateFormat)#</span>'\"\n                                                    :editor=\"ServiceDateToEditor\"\n                                                    :headerAttributes=\"{style: 'background-color: #EDF1F5'}\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'modifier'\"\n                                                    :title=\"$t('modifier')\"\n                                                    :width=\"200\"\n                                                    :hidden=\"!saleFormContent.modifier\"\n                                                    :template=\"'<span>#=modifier.name?modifier.name:``#</span>'\"\n                                                    :editor=\"ModifierDropDownEditor\"\n                                                    :headerAttributes=\"{style:'text-align: left; background-color: #EDF1F5',}\"\n                                                    :attributes=\"{ style: 'text-align: left' }\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'discountItem'\"\n                                                    :title=\"$t('discount_item')\"\n                                                    :width=\"200\"\n                                                    :hidden=\"!saleFormContent.discountItem\"\n                                                    :template=\"discountItemTemplate\"\n                                                    :editor=\"DiscountItemDropDownEditor\"\n                                                    :headerAttributes=\"{style: 'text-align: left; background-color: #EDF1F5',}\"\n                                                    :attributes=\"{style: 'text-align: left'}\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'specificTax'\"\n                                                    :title=\"$t('specificTax')\"\n                                                    :width=\"200\"\n                                                    :hidden=\"!saleFormContent.specificTax\"\n                                                    :template=\"'<span>#=specificTax.defaultTax?specificTax.defaultTax:``#</span>'\"\n                                                    :editor=\"SpecificTaxDropDownEditor\"\n                                                    :headerAttributes=\"{style:'text-align: left; background-color: #EDF1F5'}\"\n                                                    :attributes=\"{ style: 'text-align: left' }\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'otherTax'\"\n                                                    :title=\"$t('otherTax')\"\n                                                    :width=\"200\"\n                                                    :hidden=\"!saleFormContent.otherTax\"\n                                                    :template=\"'<span>#=otherTax.defaultTax?otherTax.defaultTax:``#</span>'\"\n                                                    :editor=\"OtherTaxDropDownEditor\"\n                                                    :headerAttributes=\"{style:'text-align: left; background-color: #EDF1F5',}\"\n                                                    :attributes=\"{ style: 'text-align: left' }\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'publicLightingTax'\"\n                                                    :title=\"$t('pl_tax')\"\n                                                    :width=\"200\"\n                                                    :hidden=\"!saleFormContent.publicLightingTax\"\n                                                    :template=\"'<span>#=publicLightingTax.defaultTax?publicLightingTax.defaultTax:``#</span>'\"\n                                                    :editor=\"PublicLightingTaxDropDownEditor\"\n                                                    :headerAttributes=\"{style:'text-align: left; background-color: #EDF1F5',}\"\n                                                    :attributes=\"{ style: 'text-align: left' }\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'saleUnit'\"\n                                                    :title=\"$t('sale_unit')\"\n                                                    :width=\"200\"\n                                                    :hidden=\"!saleFormContent.saleUnit\"\n                                                    :template=\"saleUnitTemplate\"\n                                                    :editor=\"SaleUnitDropDownEditor\"\n                                                    :headerAttributes=\"{style:'text-align: left; background-color: #EDF1F5'}\"\n                                                    :attributes=\"{ style: 'text-align: left' }\"/>\n                                                <kendo-grid-column\n                                                    :field=\"'employee'\"\n                                                    :title=\"$t('employee')\"\n                                                    :width=\"200\"\n                                                    :hidden=\"!saleFormContent.employee\"\n                                                    :template=\"empImpl\"\n                                                    :editor=\"EmployeeDropDownEditor\"\n                                                    :headerAttributes=\"{style:'text-align: left; background-color: #EDF1F5'}\"\n                                                    :attributes=\"{ style: 'text-align: left' }\"/>\n                                            </kendo-grid>\n                                        </v-col>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"pt-0 pl-0\">\n                                            <v-btn\n                                                class=\"float-left btn_plus\"\n                                                @click=\"addRow\">\n                                                <v-icon size=\"\" class=\"ma-1\">mdi-plus</v-icon>\n                                            </v-btn>\n                                        </v-col>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                            <v-row>\n                                                <v-row>\n                                                    <v-col class=\"pt-0\" sm=\"5\" cols=\"6\">\n                                                        <v-card\n                                                            class=\"no-boxshadow rounded-4 pa-3\"\n                                                            color=\"grayBg\">\n                                                            <v-row>\n                                                                <v-col class=\"py-0 px-4\" sm=\"12\" cols=\"12\">\n                                                                    <label\n                                                                        class=\"label mb-0\">{{\n                                                                            $t(\"billing_address\")\n                                                                        }}</label>\n                                                                    <v-select\n                                                                        class=\"mt-1\"\n                                                                        v-model=\"saleOrder.billingAddress\"\n                                                                        :items=\"billingAddress\"\n                                                                        item-value=\"id\"\n                                                                        item-text=\"name\"\n                                                                        placeholder=\"Address\"\n                                                                        outlined/>\n                                                                    <label\n                                                                        class=\"label mb-0\">{{\n                                                                            $t(\"pickup_delivery_address\")\n                                                                        }}</label>\n                                                                    <v-select\n                                                                        class=\"mt-1\"\n                                                                        v-model=\"saleOrder.deliveryAddress\"\n                                                                        :items=\"deliveryAddress\"\n                                                                        item-value=\"id\"\n                                                                        item-text=\"name\"\n                                                                        placeholder=\"Address\"\n                                                                        outlined/>\n                                                                    <!--                                                                    <label class=\"label  mb-0\">{{-->\n                                                                    <!--                                                                            $t(\"pickup_delivery_date_time\")-->\n                                                                    <!--                                                                        }}</label>-->\n                                                                    <!--                                                                    <v-datetime-picker-->\n                                                                    <!--                                                                        outlined-->\n                                                                    <!--                                                                        class=\"mt-1 py-0 date_time\"-->\n                                                                    <!--                                                                        :date-format=\"dateFormatted\"-->\n                                                                    <!--                                                                        v-model=\"saleOrder.deliveryDateTime\"-->\n                                                                    <!--                                                                    >-->\n                                                                    <!--                                                                    </v-datetime-picker>-->\n                                                                    <label v-if=\"appType != 'npo' \">{{\n                                                                            $t(\"message_on_sale_order\")\n                                                                        }}</label>\n                                                                    <label v-else>{{\n                                                                            $t(\"message_on_contract\")\n                                                                        }}</label>\n                                                                    <v-textarea\n                                                                        class=\"mt-1\"\n                                                                        v-model=\"saleOrder.transactionNote\"\n                                                                        outlined\n                                                                        no-resize\n                                                                        height=\"70px\"\n                                                                        placeholder=\"\"/>\n                                                                </v-col>\n                                                            </v-row>\n                                                        </v-card>\n                                                    </v-col>\n                                                    <v-col class=\"pt-0\" sm=\"7\" cols=\"6\">\n                                                        <v-simple-table>\n                                                            <template v-slot:default>\n                                                                <tbody>\n                                                                <tr v-if=\"appType != 'npo'\">\n                                                                    <td class=\"text-left pr-0\">{{ $t(\"subtotal\") }}</td>\n                                                                    <td class=\"text-center\">:</td>\n                                                                    <td class=\"text-right\">\n                                                                        {{ numberFormat(saleOrder.subTotal) }}\n                                                                    </td>\n                                                                </tr>\n                                                                <tr v-if=\"appType != 'npo' \">\n                                                                    <td class=\"text-left pr-0\">{{\n                                                                            $t(\"general_discount\")\n                                                                        }}\n                                                                    </td>\n                                                                    <td class=\"text-center\">:</td>\n                                                                    <td class=\"text-right\">\n                                                                        ({{ numberFormat(saleOrder.discountTotal) }})\n                                                                    </td>\n                                                                </tr>\n                                                                <tr v-if=\"appType != 'npo' \">\n                                                                    <td class=\"text-left pr-0\">{{ $t(\"total_tax\") }}\n                                                                        <v-btn @click=\"dialogTax = true\"\n                                                                               color=\"grayBg\"\n                                                                               outlined\n                                                                               class=\"black--text text-bold float-right text-uppercase\"\n                                                                               style=\"height: 30px !important;\">\n                                                                            {{ $t(\"tax\") }}\n                                                                        </v-btn>\n                                                                    </td>\n                                                                    <td class=\"text-center\">:</td>\n                                                                    <td class=\"text-right\">\n                                                                        {{ numberFormat(saleOrder.totalTaxAmount) }}\n                                                                    </td>\n                                                                </tr>\n                                                                <tr style=\"background: #F8F8F9\">\n                                                                    <td class=\"text-left text-uppercase pr-0\">\n                                                                        {{ $t(\"total\") }}\n                                                                    </td>\n                                                                    <td class=\"text-center\">:</td>\n                                                                    <td class=\"text-right primary--text text-bold\"\n                                                                        id=\"total\">{{ numberFormat(saleOrder.total) }}\n                                                                    </td>\n                                                                </tr>\n                                                                </tbody>\n                                                            </template>\n                                                        </v-simple-table>\n                                                    </v-col>\n                                                </v-row>\n                                            </v-row>\n                                        </v-col>\n                                    </v-row>\n                                    <v-divider/>\n                                    <v-card outlined dense class=\"no_border function_footer\">\n                                        <v-alert type=\"warning\" v-model=\"alert\" dismissible>\n                                            <span v-html=\"errorMessage\"/>\n                                        </v-alert>\n                                        <v-menu>\n                                            <template v-slot:activator=\"{ on }\">\n                                                <v-btn\n                                                    class=\"mr-2 float-left select_template\"\n                                                    v-on=\"on\">\n                                                    {{ $t(\"select_template\") }}\n                                                    <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>\n                                                </v-btn>\n                                            </template>\n                                            <v-list>\n                                                <v-list-item\n                                                    v-for=\"(item, index) in formAR\"\n                                                    :key=\"index\">\n                                                    <v-list-item-title>{{ item.name }}</v-list-item-title>\n                                                </v-list-item>\n                                            </v-list>\n                                        </v-menu>\n                                        <v-btn\n                                            class=\"text-capitalize  black--text float-left\"\n                                            color=\"primary\"\n                                            outlined\n                                            @click=\"cancel\">{{ $t(\"cancel\") }}\n                                        </v-btn>\n                                        <!--                    <v-menu>-->\n                                        <!--                      <template v-slot:activator=\"{ on }\">-->\n                                        <!--                        <v-btn class=\"ml-2 float-right text-capitalize  white&#45;&#45;text\"-->\n                                        <!--                               color=\"primary\" v-on=\"on\">-->\n                                        <!--                          {{ $t('save_option') }}-->\n                                        <!--                          <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>-->\n                                        <!--                        </v-btn>-->\n                                        <!--                      </template>-->\n                                        <!--                      <v-list rounded>-->\n                                        <!--                        <v-list-item-group>-->\n                                        <!--                          <v-list-item>-->\n                                        <!--                            <v-list-item-content>-->\n                                        <!--                              <v-list-item-title v-if=\"!isEdit\" @click=\"saveNew\">-->\n                                        <!--                                {{ $t('save_new') }}-->\n                                        <!--                              </v-list-item-title>-->\n                                        <!--                            </v-list-item-content>-->\n                                        <!--                          </v-list-item>-->\n                                        <!--                          <v-list-item>-->\n                                        <!--                            <v-list-item-content>-->\n                                        <!--                              <v-list-item-title @click=\"saveClose\">{{-->\n                                        <!--                                  $t('save_close')-->\n                                        <!--                                }}-->\n                                        <!--                              </v-list-item-title>-->\n                                        <!--                            </v-list-item-content>-->\n                                        <!--                          </v-list-item>-->\n\n                                        <!--                        </v-list-item-group>-->\n                                        <!--                      </v-list>-->\n                                        <!--                    </v-menu>-->\n                                        <v-btn\n                                            @click=\"saveClose\"\n                                            class=\"float-right text-capitalize  white--text\"\n                                            :disabled=\"btnDisabled\"\n                                            color=\"primary\">\n                                            {{ $t(\"save_close\") }}\n                                        </v-btn>\n                                        <v-btn color=\"secondary\"\n                                               style=\"margin-right: 10px !important\"\n                                               :disabled=\"btnDisabled\"\n                                               class=\"white--text float-right text-capitalize\"\n                                               @click=\"saveNew\" :hidden=\"hiddenButton\">{{ $t(\"save_new\") }}\n                                        </v-btn>\n                                    </v-card>\n                                </v-form>\n                            </v-col>\n                            <v-col\n                                class=\"smallSide pl-2 pt-0\"\n                                sm=\"4\"\n                                style=\"transition: .3s ease-in;\"\n                                :class=\"{ hide_small_bar_class: isHideBar }\">\n                                <div class=\"d-flex justify-end\">\n                                    <h3 style=\"color: #b3b5bc; font-size:20px;\"\n                                        v-if=\"!isHideBar\"\n                                        class=\"text-uppercase\">\n                                        <span class=\"pointer\" @click=\"Help('sale order')\">{{ $t(\"help\") }}</span>\n                                        <v-icon\n                                            @click=\"cancel()\"\n                                            style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                                            class=\"float-right mt-n1\">close\n                                        </v-icon>\n                                    </h3>\n                                </div>\n                                <div v-if=\"!isHideBar\"\n                                     class=\"small_sidebar mt-2 px-4 pt-5 grayBg\">\n                                    <v-card outlined dense class=\"pa-3 no_border my_card rounded-4 white--text\"\n                                            color=\"primary\" height=\"60px\">\n                                        <h3 class=\"text-left font_13 flex-1 text-uppercase\">\n                                            {{ $t('amount') }}</h3>\n                                        <h3 class=\"text-right flex-1 font_20 niradei_heavy\">\n                                            {{ numberFormat(saleOrder.total) }} </h3>\n                                    </v-card>\n                                    <v-row>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"pt-3 kendo_dropdown_custom\">\n                                            <label class=\"label mb-2\">{{ $t(\"segment\") }}</label>\n                                            <v-select\n                                                class=\"mt-1\"\n                                                v-model=\"saleOrder.segment\"\n                                                :items=\"segments\"\n                                                item-value=\"id\"\n                                                @change=\"loadQuote\"\n                                                :item-text=\"(item) => `${item.code} - ${item.name}`\"\n                                                return-object\n                                                tage=\"segment\"\n                                                :rules=\"[(v) => !!v || 'Segment is required']\"\n                                                placeholder=\"Segment\"\n                                                outlined=\"\"/>\n                                            <label class=\"label mb-0\">{{ $t(\"location\") }}</label>\n                                            <v-select\n                                                class=\"mt-1\"\n                                                v-model=\"saleOrder.location\"\n                                                :items=\"locations\"\n                                                @change=\"loadQuote\"\n                                                item-value=\"id\"\n                                                :item-text=\"(item) => `${item.code} - ${item.name}`\"\n                                                return-object\n                                                tage=\"Location\"\n                                                placeholder=\"bu/location\"\n                                                outlined=\"\"/>\n                                            <label class=\"label font_14\">{{ $t(\"sale_channel\") }}</label>\n                                            <v-select\n                                                class=\" mt-1\"\n                                                v-model=\"saleOrder.saleChannel\"\n                                                :items=\"saleChannelList\"\n                                                item-value=\"id\"\n                                                item-text=\"name\"\n                                                return-object\n                                                tage=\"Sale Channel\"\n                                                placeholder=\"Channel\"\n                                                outlined/>\n                                            <label class=\"label font_14\">{{ $t(\"employee\") }}</label>\n                                            <v-col sm=\"12\"\n                                                   cols=\"12\"\n                                                   class=\"kendo_dropdown_custom pl-0 pb-3 pt-0\"\n                                                   style=\"padding: 0\">\n                                                <dropdownlist\n                                                    class=\"v-input__slot\"\n                                                    :data-items=\"employeeList\"\n                                                    @change=\"onEmployeeChange\"\n                                                    :value=\"saleOrder.employee\"\n                                                    :data-item-key=\"dataItemKey\"\n                                                    :text-field=\"'name'\"\n                                                    :default-item=\"defaultEmpItem\"\n                                                    :filterable=\"true\"\n                                                    @filterchange=\"onEmployeeFilterChanged\">\n                                                </dropdownlist>\n                                            </v-col>\n                                            <label class=\"label\">{{ $t(\"for_month_of\") }}</label>\n                                            <app-monthof-picker\n                                                :initMonthOf=\"saleOrder.monthOf\"\n                                                @emitMonthOf=\"saleOrder.monthOf = $event\"/>\n                                            <!--                                            <v-checkbox-->\n                                            <!--                                                v-model=\"isRequredPurchase\"-->\n                                            <!--                                                hide-details-->\n                                            <!--                                                :label=\"$t('order_required_purchase')\"-->\n                                            <!--                                                class=\"shrink mr-2 mt-0\"-->\n                                            <!--                                            ></v-checkbox>-->\n                                            <!--                                            <dropdownlist-->\n                                            <!--                                                class=\"v-input__slot mt-1\"-->\n                                            <!--                                                :disabled=\"!isRequredPurchase\"-->\n                                            <!--                                                :data-items=\"supplierList\"-->\n                                            <!--                                                @change=\"onSupplierChange\"-->\n                                            <!--                                                :value=\"saleOrder.supplier\"-->\n                                            <!--                                                :data-item-key=\"dataItemKey\"-->\n                                            <!--                                                :text-field=\"textField\"-->\n                                            <!--                                                :default-item=\"defaultSupItem\"-->\n                                            <!--                                                :filterable=\"true\"-->\n                                            <!--                                                @filterchange=\"onSupplierFilterChange\"-->\n                                            <!--                                            >-->\n                                            <!--                                            </dropdownlist>-->\n                                        </v-col>\n                                    </v-row>\n                                    <v-divider class=\"mb-3\"/>\n                                    <p class=\"text-bold ml-1\" style=\"font-size: 14px;\">{{ $t(\"tnc_to_be_added\") }}</p>\n                                    <v-row v-for=\"item in quotes\" v-bind:key=\"item.id\">\n                                        <v-col sm=\"9\" cols=\"9\" class=\"py-0 pr-0\">\n                                            <v-card\n                                                outlined\n                                                class=\"px-3 py-1 text-white no-boxshadow no_border justify-left d-flex\"\n                                                color=\"third\"\n                                                style=\"height: 30px\">\n                                                <p class=\"mb-0 white--text\" style=\"width: 100%\">\n                                                    <span class=\"pl-3 float-left\">{{ item.number }}</span>\n                                                    <span class=\"float-right\">{{ numberFormat(item.total) }}</span>\n                                                </p>\n                                            </v-card>\n                                        </v-col>\n                                        <v-col sm=\"3\" cols=\"3\" class=\"py-0  pl-1\">\n                                            <v-btn\n                                                class=\"white--text text-bold rounded-0 float-right text-uppercase\"\n                                                color=\"primary\"\n                                                style=\"height: 30px !important;\"\n                                                @click=\"addQuote(item)\">{{ $t(\"add\") }}\n                                            </v-btn>\n                                        </v-col>\n                                    </v-row>\n                                    <p v-if=\"appType != 'npo' \" class=\"mb-0 detial_smallside_p pr-4 font_14\">\n                                        {{ $t(\"sale_order_funct_desc\") }}\n                                    </p>\n                                </div>\n                            </v-col>\n                        </v-row>\n                    </v-card>\n                </v-col>\n            </v-row>\n            <LoadingMe\n                :isLoading=\"showLoading\"\n                :fullPage=\"false\"\n                :myLoading=\"true\"\n                type=\"loading\"\n                :alertMessage=\"loadingAlert\"\n                :color=\"loadingColorAlert\"\n                :alertText=\"loadingTextAlert\"/>\n            <v-dialog v-model=\"dialogTax\" max-width=\"450px\">\n                <v-card>\n                    <div class=\"modal_header\">\n                        <v-card-title>{{ $t(\"tax_list\") }}</v-card-title>\n                        <v-icon class=\"btn_close\" @click=\"dialogTax = false\">close</v-icon>\n                    </div>\n                    <v-card-text class=\"modal_text_content\">\n                        <v-row>\n                            <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                <v-simple-table>\n                                    <template v-slot:default>\n                                        <tbody>\n                                        <tr\n                                            v-for=\"(value, name) in taxListTotal\"\n                                            v-bind:key=\"name\"\n                                        >\n                                            <td class=\"text-left\" width=\"180px\">{{ name }}</td>\n                                            <td class=\"text-center\">:</td>\n                                            <td class=\"text-right\">\n                                                {{ numberFormat(value) }}\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td class=\"text-left\" width=\"180px\">\n                                                {{ $t(\"total\") }}\n                                            </td>\n                                            <td class=\"text-center\">:</td>\n                                            <td class=\"text-right\">\n                                                {{ numberFormat(saleOrder.totalTaxAmount) }}\n                                            </td>\n                                        </tr>\n                                        </tbody>\n                                    </template>\n                                </v-simple-table>\n                            </v-col>\n                        </v-row>\n                    </v-card-text>\n                    <v-divider/>\n                </v-card>\n            </v-dialog>\n            <v-dialog v-model=\"dialogCatalog\" max-width=\"850px\">\n\n                <v-card>\n                    <div class=\"modal_header\">\n                        <v-card-title>{{ $t(\"catalog\") }}</v-card-title>\n                        <v-icon class=\"btn_close\" @click=\"dialogCatalog = false\"\n                        >close\n                        </v-icon>\n                    </div>\n                    <v-card-text class=\"modal_text_conent\">\n                        <v-row>\n                            <v-col sm=\"12\" cols=\"12\" class=\"pb-0\">\n                                <v-simple-table>\n                                    <kendo-datasource\n                                        ref=\"catalogDatasource\"\n                                        :data=\"catalogs\"\n                                        :schema=\"gridSchema\"\n                                    />\n                                    <kendo-grid\n                                        id=\"gridCatalog\"\n                                        class=\"grid-function\"\n                                        :data-source-ref=\"'catalogDatasource'\"\n                                        :style=\"{ width: '100%' }\"\n                                        :noRecords=\"true\"\n                                        :pageable-numeric=\"false\"\n                                        :pageable-previous-next=\"false\"\n                                        :pageable-messages-display=\"'Showing {2} data items'\"\n                                        :scrollable-virtual=\"true\"\n                                    >\n                                        <kendo-grid-column\n                                            :field=\"'images'\"\n                                            :title=\"$t('image')\"\n                                            :width=\"50\"\n                                            :template=\"loadImage\"\n                                            :headerAttributes=\"{ style: 'background-color: #EDF1F5' }\"\n                                        />\n                                        <kendo-grid-column\n                                            :field=\"'number'\"\n                                            :title=\"$t('number')\"\n                                            :width=\"70\"\n                                            :template=\"'<span>#=number#</span>'\"\n                                            :groupHeaderColumnTemplate=\"'#=value#'\"\n                                            :headerAttributes=\"{ style: 'background-color: #EDF1F5' }\"\n                                        />\n                                        <kendo-grid-column\n                                            :field=\"'name'\"\n                                            :title=\"$t('name')\"\n                                            :attributes=\"{ class: 'tb_name_td' }\"\n                                            :width=\"100\"\n                                            :template=\"'<span>#=name#</span>'\"\n                                            :headerAttributes=\"{ style: 'background-color: #EDF1F5' }\"\n                                        />\n                                        <kendo-grid-column\n                                            :field=\"'description'\"\n                                            :title=\"$t('description')\"\n                                            :width=\"100\"\n                                            :template=\"'<span>#=description#</span>'\"\n                                            :headerAttributes=\"{ style: 'background-color: #EDF1F5' }\"\n                                        />\n                                        <kendo-grid-column\n                                            :field=\"'noOfProduct'\"\n                                            :title=\"$t('products')\"\n                                            :template=\"'<span>#=noOfProduct#</span>'\"\n                                            :width=\"50\"\n                                            :headerAttributes=\"{\n                        style: 'text-align: left; background-color: #EDF1F5',\n                      }\"\n                                        />\n                                        <kendo-grid-column\n                                            :field=\"''\"\n                                            :title=\"$t('action')\"\n                                            :width=\"60\"\n                                            :command=\"[{ text: $t('add'), click: addCatalog }]\"\n                                            :headerAttributes=\"{\n                        style: 'text-align: left; background-color: #EDF1F5',\n                      }\"\n                                        />\n                                    </kendo-grid>\n                                </v-simple-table>\n                            </v-col>\n                        </v-row>\n                    </v-card-text>\n                </v-card>\n            </v-dialog>\n        </v-container>\n    </v-app>\n</template>\n\n<script>\nimport {i18n} from \"@/i18n\";\nimport DatePickerComponent from \"@/components/custom_templates/DatePickerComponent\";\nimport kendo from \"@progress/kendo-ui\";\nimport {DropDownList} from \"@progress/kendo-vue-dropdowns\";\nimport SaleFormContentModel from \"@/scripts/model/SaleFormContent\";\nimport ItemLineModel from \"@/scripts/invoice/model/ItemLine\";\nimport {uuid} from \"vue-uuid\";\nimport SaleOrderModel from \"@/scripts/model/Transaction\";\n\n/* Store */\nimport store from \"@/store\";\n\nconst institute = store.state.institute.institute;\n\nimport {ShowResource} from \"@/observable/store\";\nimport paymentTermHandler_ from \"@/scripts/paymentterm/handler/paymentTermHandler\";\nimport creditLimitHandler from \"@/scripts/creditLimit/handler/creditLimitHandler\";\nimport Helper from \"@/helper\";\nimport transactionHandler from \"@/scripts/transactionHandler\";\nimport {dataStore} from \"@/observable/store\";\n\n////handler\nconst saleOrderHandler = require(\"@/scripts/transactionHandler\");\nconst billingHandler = require(\"@/scripts/invoice/handler/billingHandler\");\nconst customerHandler = require(\"@/scripts/customerHandler\");\nconst projectHandler = require(\"@/scripts/projectHandler\");\nconst prefixHandler = require(\"@/scripts/prefixHandler\");\nconst paymentTermHandler = require(\"@/scripts/paymentTermHandler\");\nconst priceLevelHandler = require(\"@/scripts/priceLevelHandler\");\nconst saleFormContentHandler = require(\"@/scripts/saleFormContentHandler\");\nconst employeeHandler = require(\"@/scripts/employeeHandler\");\nconst itemModifierHandler = require(\"@/scripts/itemModifierHandler\");\nconst discountItemHandler = require(\"@/scripts/discountItemHandler\");\nconst uomPriceHandler = require(\"@/scripts/uomPriceHandler\");\nconst productVariantHandler = require(\"@/scripts/productVariantHandler\");\nconst otherChargeHandler = require(\"@/scripts/otherChargeHandler\");\nconst locationHandler = require(\"@/scripts/locationHandler\");\nconst settingsHandler = require(\"@/scripts/settingsHandler\");\nconst saleChannelHandler = require(\"@/scripts/saleChannelHandler\");\nconst saleUnitItemHandler = require(\"@/scripts/saleUnitItemHandler\");\nconst settingHandler = require(\"@/scripts/settingHandler\");\nconst catalogHandler = require(\"@/scripts/catalogHandler\");\nconst productHandler = require(\"@/scripts/productHandler\");\nconst currencyHandler = require(\"@/scripts/currency/handler/currencyHandler\");\nconst supplierHandler = require(\"@/scripts/supplierHandler\");\n\nconst saleFormContentModel = new SaleFormContentModel({});\nconst itemLineModel = new ItemLineModel({});\n//other\nconst $ = kendo.jQuery\nconst textField = \"numberName\";\nconst keyField = \"id\";\nconst defaultItem = {[textField]: \"Select Customer...\", [keyField]: null};\nconst defaultSupItem = {[textField]: \"Select Supplier...\", [keyField]: null};\nconst defaultEmpItem = {[textField]: \"Select Employee...\", [keyField]: null};\nconst emptyItem = {[textField]: \"loading ...\"};\nconst invoicePrefix = \"lin-\";\nconst DISCOUNT_TYPE = \"?type=Sale\";\nconst cookieJS = require(\"@/cookie.js\");\nconst cookie = cookieJS.getCookie();\nexport default {\n    name: \"SaleOrder\",\n    props: {\n        id: {\n            type: String,\n        },\n        initSaleOrder: {\n            type: SaleOrderModel,\n        },\n    },\n    components: {\n        LoadingMe: () => import(`@/components/Loading`),\n        \"app-datepicker\": DatePickerComponent,\n        dropdownlist: DropDownList,\n        \"app-monthof-picker\": () => import(\"@/components/kendo_templates/MonthOfPicker\"),\n    },\n    data: () => ({\n        saleOrder: new SaleOrderModel(),\n        isEdit: false,\n        numSelect: [1],\n        dialogTax: false,\n        theDate: \"\",\n        //Catalog\n        dialogCatalog: false,\n        gridSchema: {\n            model: {\n                id: \"id\",\n            },\n        },\n        imgURL: \"https://s3-ap-southeast-1.amazonaws.com/images.banhji/\",\n        // LoadingMe\n        showLoading: false,\n        loadingAlert: false,\n        loadingColorAlert: \"\",\n        loadingTextAlert: \"\",\n        bill_date: \"\",\n        alert: false,\n        files: [],\n        errors: [],\n        // Form validation\n        valid: true,\n        templates: [\n            {title: \"Draft\"},\n            {title: \"Open\"},\n            {title: \"Partially Closed\"},\n            {title: \"Closed\"},\n        ],\n        saleOrderType: 1,\n        saleOrderTypes: [\n            {name: \"Standard Order\", id: 1},\n            {name: \"Open Order\", id: 2},\n            {name: \"Contract\", id: 3},\n            {name: \"Consignment Order\", id: 4},\n            // {name: 'Order required Purchase', id: 5},\n        ],\n        isRequredPurchase: false,\n        col_expand: 9,\n        col_hide: 3,\n        isHideBar: false,\n        filter: \"\",\n        textField: \"numberName\",\n        dataItemKey: \"id\",\n        defaultItem: defaultItem,\n        defaultSupItem: defaultSupItem,\n        defaultEmpItem: defaultEmpItem,\n        mOtherCharge: [],\n        //item\n        itemLines: [],\n        itemLine: itemLineModel,\n        dateFormat: itemLineModel.dateFormat,\n        //customer\n        cusBaseUrl: customerHandler.search(),\n        customer: {},\n        customerList: [],\n        supplierList: [],\n        supplier: {},\n        supBaseUrl: supplierHandler.search(),\n        billingAddress: [],\n        deliveryAddress: [],\n        priceLevel: [],\n        //date\n        paymentTerms: [],\n        transactions: [],\n        employeeList: [],\n        employee: {},\n        empBaseUrl: employeeHandler.searchURL(),\n        saleChannelList: [],\n        locations: [],\n        customerProjects: [],\n        segments: [],\n        transactionType: {},\n        taxListTotal: {},\n        customerDiscountItem: [],\n        customerSaleUnit: [],\n        saleFormContent: saleFormContentModel,\n        transactionDate: new Date().toISOString().substr(0, 10),\n        monthOf: false,\n        deliveryDateTime: new Date(),\n        validityDate: new Date().toISOString().substr(0, 10),\n        specificDiscountItem: [],\n        otherChargeList: [],\n        saleUnitItemList: [],\n        otherTax: [],\n        specificTax: [],\n        publicLightingTax: [],\n        vatTax: [],\n        tax: [],\n        loggedUser: {\n            id: cookie.creator,\n            name: cookie.email,\n        },\n        leads: [],\n        catalogs: [],\n        txnList: [],\n        quotes: [],\n        txnLists: [],\n        isSaveNew: false,\n        isSaveClose: false,\n        isSavePrint: false,\n        isSaveDraft: false,\n        exchangeRate: {},\n        baseCurrencyCode: \"\",\n        currencyCode: \"\",\n        transactionRate: 1,\n        saveOption: \"\",\n        formAR: [\n            {id: 1, name: \"Default Form\"},\n            {id: 2, name: \"Form 80mm\"},\n        ],\n        isPriceLevelChanged: false,\n        refFrom: [], // can SO can be from Sale Quotes\n        btnDisabled: false\n    }),\n    methods: {\n        formatDateTime(value) {\n            return kendo.toString(new Date(value), this.dateFormat + ` hh:mm tt`);\n        },\n        amountFormat(value) {\n            return kendo.toString(value.amount, `n${this.saleFormContent.decimal}`);\n        },\n        priceFormat(value) {\n            return kendo.toString(value.price, `n${this.saleFormContent.decimal}`);\n        },\n        Help(key_search) {\n            ShowResource(key_search);\n        },\n        initialData() {\n            if (this.initSaleOrder) {\n                // Edit Mode\n                this.saleOrder = this.initSaleOrder;\n                this.saleOrder.creditLimit = 0;\n                this.saleOrder.currentBalance = 0;\n                // window.console.log(this.initSaleOrder, 'propData')\n                this.bindData();\n            } else {\n                // Brand New Mode\n                if (this.$route.params.id === undefined) {\n                    this.setDefaultData();\n                }\n            }\n        },\n        setDefaultData() {\n            // Brand New Mode\n            // window.console.log('default or clear')\n            this.isEdit = false;\n            this.saleOrder = new SaleOrderModel({});\n            //sale order type\n            if (this.$route.params.id !== undefined) {\n                this.saleOrder.saleOrderType = 1;\n                this.saleOrderType = 1;\n                if (this.appType === 'npo' || this.appType === 'Publish Sectors'){\n                    this.saleOrder.saleOrderType = 3;\n                    this.saleOrderType = 3;\n                }\n            }\n            this.saleOrder.deliveryDateTime = new Date();\n            this.saleOrder.formTemplate = 1;\n            this.saleOrder.transactionDate = new Date().toISOString().substr(0, 10);\n            // Generate Number\n            this.itemLines = []\n            // let ds = this.$refs.itemLineDS.kendoWidget();\n            // ds.data([]);\n            // Add 2 default lines\n            this.removeEmptyLine()\n            setTimeout(() => {\n                this.addRow()\n                // this.addRow()\n            }, 500)\n            // Add 2 default lines\n            this.otherChargeList = [];\n            this.mOtherCharge = [];\n            this.employee = {};\n            this.taxListTotal = {};\n            this.quotes = [];\n            this.isSaveNew = false;\n            this.isSaveClose = false;\n            this.isSavePrint = false;\n            this.isSaveDraft = false;\n            this.creditLimitUsage(0, 1);\n            this.isRequredPurchase = false;\n            this.customer = {}\n        },\n        bindData() {\n            // window.console.log(this.saleOrder, 'bindData')\n            // Edit Mode\n            if (this.saleOrder) {\n                if (this.saleOrder.hasOwnProperty(\"customer\")) {\n                    this.isEdit = true;\n                    this.customer = this.saleOrder.customer;\n                    // let e = {value: this.saleOrder.customer}\n                    // this.onChange(e)\n                    this.billingAddress = this.saleOrder.customer.billingAddress;\n                    this.deliveryAddress = this.saleOrder.customer.deliveryAddress;\n                    // this.customerProjects = this.saleOrder.customer.\n                    this.taxListTotal = this.saleOrder.taxListTotal;\n                    this.itemLines = this.saleOrder.itemLines;\n                    this.mOtherCharge = this.saleOrder.otherCharge;\n                    this.loadProjectByCustomer();\n                    if (this.customer.hasOwnProperty(\"id\")) {\n                        this.loadCustomerBalance(this.customer.id);\n                    }\n                }\n            }\n        },\n        addSelect() {\n            let amount_num = this.numSelect.length;\n            let num = this.numSelect[amount_num - 1];\n            let new_num = num + 1;\n            let lenghtItem = this.specificDiscountItem.length;\n            if (new_num <= lenghtItem) {\n                this.numSelect.push(new_num);\n            }\n        },\n        removeSelect(index) {\n            this.numSelect.splice(index, 1);\n            // window.console.log(index, this.numSelect)\n            // this.selectDiscount.splice(index,1)\n            // window.console.log(\"remove\",this.selectDiscount)\n            // this.selectDiscount = this.selectDiscount.filter(item =>  item.id != val.id);\n        },\n        errorMessage() {\n        },\n        accountDropDownEditor() {\n        },\n        hide_smallsitebar() {\n            if (!this.isHideBar) {\n                // this.col_expand = 12\n                // this.col_hide = 0\n                this.isHideBar = true;\n            } else {\n                // this.col_expand = 9\n                // this.col_hide = 3\n                this.isHideBar = false;\n            }\n        },\n        //number\n        generateNumber() {\n            if (this.isEdit == false) {\n                let d = new Date().toISOString().substr(0, 10);\n                if (this.saleOrder.transactionDate) {\n                    // window.console.log(this.transactionDate)\n                    d = this.saleOrder.transactionDate;\n                }\n                let data = {\n                    abbr: this.saleOrder.transactionType.abbr,\n                    structure: this.saleOrder.transactionType.structure,\n                    transactionDate: d,\n                    type: \"Sale Order\",\n                };\n                billingHandler\n                    .lastNumber(data)\n                    .then((response) => {\n                        if (response.data.statusCode === 200) {\n                            const res = response.data.data;\n                            const lastNumber = this.zeroPad(\n                                parseInt(res.lastNumber),\n                                this.saleOrder.transactionType.format\n                            );\n                            const number =\n                                res.suffix +\n                                this.saleOrder.transactionType.numberSeparator +\n                                lastNumber;\n                            this.saleOrder.number = number;\n                        }\n                    })\n                    .catch((e) => {\n                        this.errors.push(e);\n                    });\n            }\n        },\n        zeroPad(num, places) {\n            return String(num).padStart(places, \"0\");\n        },\n        //customer\n        onChange(event) {\n            window.console.log(event);\n            const value = event.value;\n            if (value && value[textField] === emptyItem[textField]) {\n                return;\n            }\n            this.customer = value;\n            this.saleOrder.customer = value;\n            // this.invoice = value\n            // this.saleOrder.paymentTerm = value.hasOwnProperty(\"paymentTerm\")\n            //   ? value.paymentTerm\n            //   : {};\n            this.saleOrder.priceLevel = value.hasOwnProperty(\"priceLevel\")\n                ? value.priceLevel\n                : {};\n            const baseCurrency = value.hasOwnProperty(\"baseCurrency\")\n                ? value.baseCurrency\n                : {};\n            if (baseCurrency.hasOwnProperty(\"code\")) {\n                this.baseCurrencyCode = baseCurrency.code;\n            }\n            const priceLevel = value.hasOwnProperty(\"priceLevel\")\n                ? value.priceLevel\n                : {};\n            if (priceLevel.hasOwnProperty(\"currency\")) {\n                if (priceLevel.currency.hasOwnProperty(\"id\")) {\n                    this.loadTransactionRate();\n                }\n            }\n            this.billingAddress = value.hasOwnProperty(\"billingAddress\")\n                ? value.billingAddress\n                : [];\n            this.deliveryAddress = value.hasOwnProperty(\"deliveryAddress\")\n                ? value.deliveryAddress\n                : [];\n            if (this.billingAddress.length > 0) {\n                this.saleOrder.billingAddress = this.billingAddress[0];\n            }\n            if (this.deliveryAddress.length > 0) {\n                this.saleOrder.deliveryAddress = this.deliveryAddress[0];\n            }\n            this.onSaleOrderDateChanged();\n            this.loadProjectByCustomer();\n            // const creditLimit = value.hasOwnProperty(\"creditLimit\")\n            //   ? value.creditLimit\n            //   : 0;\n            // this.saleOrder.creditLimit = kendo.parseFloat(creditLimit);\n            this.loadCreditLimit();\n            this.loadCustomerBalance(this.customer.id);\n            // load quote\n            this.loadQuote();\n            this.loadPaymentTermList();\n        },\n        onFilterChange(event) {\n            const filter = event.filter.value;\n            this.requestData(0, filter, this.cusBaseUrl);\n            this.filter = filter;\n        },\n        async requestData(skip, filter, baseUrl) {\n            let url = baseUrl + `?filter=${filter}`;\n            if(this.appType === 'npo'){\n                url = baseUrl + `?filter=${filter}&is_donor=true`;\n            }\n            this.requestStarted = true;\n            fetch(url)\n                .then((response) => {\n                    return response.json();\n                })\n                .then(this.afterFetch);\n        },\n        afterFetch(json) {\n            this.customerList = json.data;\n        },\n        //supplier\n        onSupplierChange(event) {\n            window.console.log(event);\n            const value = event.value;\n            if (value && value[textField] === emptyItem[textField]) {\n                return;\n            }\n            this.supplier = value;\n            this.saleOrder.supplier = value;\n        },\n        onSupplierFilterChange(event) {\n            const supfilter = event.filter.value;\n            this.supplierRequestData(0, supfilter, this.supBaseUrl);\n        },\n        supplierRequestData(skip, filter, baseUrl) {\n            const url = baseUrl + `?filter=${filter}`;\n            this.requestStarted = true;\n            fetch(url)\n                .then((response) => {\n                    return response.json();\n                })\n                .then(this.supAfterFetch);\n        },\n        supAfterFetch(json) {\n            this.supplierList = json.data;\n        },\n        //employee\n        onEmployeeChange(event) {\n            const value = event.value;\n            if (value && value[textField] === emptyItem[textField]) {\n                return;\n            }\n            this.employee = value;\n            this.saleOrder.employee = value;\n        },\n        onEmployeeFilterChanged(event) {\n            const empfilter = event.filter.value;\n            this.employeeRequestData(0, empfilter, this.empBaseUrl);\n        },\n        employeeRequestData(skip, filter, baseUrl) {\n            const url = baseUrl + `?filter=${filter}`;\n            this.requestStarted = true;\n            fetch(url)\n                .then((response) => {\n                    return response.json();\n                })\n                .then(this.empAfterFetch);\n        },\n        empAfterFetch(json) {\n            this.employeeList = json.data;\n        },\n        removeRow(e) {\n            e.preventDefault();\n            const grid = kendo.jQuery(\"#gridItemLineSaleOrder\").data(\"kendoGrid\"),\n                dataSource = grid.dataSource,\n                dataItem = grid.dataItem($(e.currentTarget).closest(\"tr\"));\n\n            if (dataSource.total() > 1) {\n                dataSource.remove(dataItem);\n            }\n            this.autoCalculate()\n        },\n        //date\n        async onSaleOrderDateChanged() {\n            if (this.saleOrder.transactionDate) {\n                this.saleOrder.monthOf = new Date(this.saleOrder.transactionDate).toISOString().substr(0, 7)\n            }\n            await this.loadCreditLimit();\n            await this.loadCustomerBalance(this.customer.id);\n            await this.onPriceLevelChange();\n            await this.loadPaymentTermList();\n            if (this.customer) {\n                const paymentTerm = this.saleOrder.paymentTerm || {};\n                const netDue = paymentTerm.netDue || 0;\n                const someDate = new Date(this.saleOrder.transactionDate);\n                someDate.setDate(someDate.getDate() + parseInt(netDue)); //number  of days to add, e.x. 15 days\n                this.saleOrder.validityDate = someDate.toISOString().substr(0, 10);\n                window.console.log(\"dueDate\", this.saleOrder.validityDate);\n            }\n            if (this.$route.params.id === undefined) {\n                this.generateNumber();\n            }\n        },\n        onPaymentTermChanged() {\n            // this.onSaleOrderDateChanged();\n            if (this.customer) {\n                const paymentTerm = this.saleOrder.paymentTerm || {};\n                const netDue = paymentTerm.netDue || 0;\n                const someDate = new Date(this.saleOrder.transactionDate);\n                someDate.setDate(someDate.getDate() + parseInt(netDue)); //number  of days to add, e.x. 15 days\n                this.saleOrder.validityDate = someDate.toISOString().substr(0, 10);\n                window.console.log(\"dueDate\", this.saleOrder.validityDate);\n            }\n        },\n        //number\n        numberFormat(value) {\n            // window.console.log(this.saleFormContent.decimal,'nimol')\n            return kendo.toString(value, `n${this.saleFormContent.decimal}`);\n            // return value\n        },\n        //\n        async loadLead() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const strFilter = \"?type=Sale Lead\";\n                    this.leads = [];\n                    billingHandler.list(strFilter).then((res) => {\n                        if (res) {\n                            if (res.data) {\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    this.leads = res.data.data;\n                                }\n                            }\n                        }\n                        this.showLoading = false;\n                    });\n                }, 10);\n            });\n        },\n        async loadPaymentTerm() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    paymentTermHandler.getAll().then((res) => {\n                        this.showLoading = false;\n                        this.paymentTerms = res.data.data;\n                        if (this.paymentTerms.length > 0) {\n                            if (\n                                this.$route.params.id !== undefined ||\n                                this.$route.params.id != \"\"\n                            ) {\n                                if (this.saleOrder) {\n                                    this.saleOrder.paymentTerm = this.paymentTerms[0];\n                                }\n                            }\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async loadPriceLevel() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const strFilter = \"?nature=sale\";\n                    priceLevelHandler.get(strFilter).then((res) => {\n                        this.priceLevel = res;\n                        if (this.priceLevel.length > 0) {\n                            if (\n                                this.$route.params.id !== undefined ||\n                                this.$route.params.id != \"\"\n                            ) {\n                                if (this.saleOrder) {\n                                    this.saleOrder.priceLevel = this.priceLevel[0];\n                                }\n                                this.loadTransactionRate();\n                            }\n                        }\n                    });\n                }, 10);\n            });\n        },\n        removeDuplicate(array) {\n            const result = [];\n            const map = new Map();\n            for (const item of array) {\n                if (!map.has(item.id)) {\n                    map.set(item.id, true); // set any value to Map\n                    result.push(item);\n                }\n            }\n            return result;\n        },\n        autoCalculateDiscount(discountItem, subTotal) {\n            if (discountItem) {\n                window.console.log('discountItem', discountItem, subTotal)\n                const nature = discountItem.nature || '';\n                const amount = discountItem.amount || 0;\n                if (nature === \"Amount\") {\n                    return parseFloat(amount);\n                } else if (nature === \"Percentage\") {\n                    return subTotal * (parseFloat(amount) / 100);\n                } else {\n                    return 0\n                }\n            } else {\n                return 0\n            }\n        },\n        autoCalculateTax(tax, amount) {\n            if (tax) {\n                var formula = tax.formula;\n                var inAmt = kendo.parseFloat(amount);\n                var nAmt = kendo.parseFloat(amount);\n                var taxBase = kendo.parseFloat(tax.taxBase) / 100;\n                var rate = kendo.parseFloat(tax.rate) / 100;\n                var total = eval(formula);\n                window.console.log(inAmt, nAmt, taxBase, rate, formula, total);\n                // window.console.log(amount)\n                return total;\n            }\n            // return 0\n        },\n        autoCalculateTaxByType(tax) {\n            // return by a key\n            const groupAll = (list) =>\n                list.reduce((tax, item) => {\n                    const taxAmount = tax[item.name] || 0;\n                    return Object.assign({}, tax, {\n                        [item.name]: taxAmount + parseFloat(item.amount),\n                    });\n                }, {});\n            this.taxListTotal = groupAll(tax);\n            // window.console.log('nimol', groupAll(tax))\n            // this.\n        },\n        dataSourceChanged(e) {\n            if (e.field) {\n                let dataRow = e.items[0],\n                    buom = {},\n                    conversionRate = 1,\n                    wac = 0,\n                    qoh = 0,\n                    amount = 0,\n                    xAmount = 0;\n                switch (e.field) {\n                    case \"item\":\n                        // this.attribute_ = this.attributes.filter(m => m.type.id === dataRow.variant.id)\n                        dataRow.set(\"description\", dataRow.item.description);\n                        buom = dataRow.item.uom || {};\n                        dataRow.set(\"buom\", buom);\n                        // this.itemChange(dataRow)\n                        break;\n                    case \"uom\":\n                        if (this.isPriceLevelChanged === false) {\n                            try {\n                                try {\n                                    buom = dataRow.uom.buom || {};\n                                    qoh = dataRow.uom.qoh || 0;\n                                    conversionRate = dataRow.uom.conversionRate || 1;\n                                    wac = dataRow.uom.wac || 0;\n                                    dataRow.set(\"buom\", buom);\n                                    dataRow.set(\"wac\", wac);\n                                    dataRow.set(\"qoh\", qoh);\n                                    dataRow.set(\"conversionRate\", parseFloat(conversionRate));\n                                    if (dataRow.uom) {\n                                        amount =\n                                            parseFloat(dataRow.uom.price) * parseFloat(dataRow.qty);\n                                        xAmount = amount * parseFloat(this.saleOrder.txnRate);\n\n                                        dataRow.set(\"price\", parseFloat(dataRow.uom.price));\n                                        dataRow.set(\"amount\", amount);\n                                        dataRow.set(\"exchangeAmount\", xAmount);\n                                    } else {\n                                        amount =\n                                            parseFloat(dataRow.price) * parseFloat(dataRow.qty);\n                                        xAmount = amount * parseFloat(this.saleOrder.txnRate);\n\n                                        dataRow.set(\"price\", parseFloat(dataRow.price));\n                                        dataRow.set(\"amount\", amount);\n                                        dataRow.set(\"exchangeAmount\", xAmount);\n                                    }\n                                } catch (err) {\n                                    dataRow.set(\"buom\", {});\n                                    dataRow.set(\"conversionRate\", 1);\n                                    dataRow.set(\"price\", 0);\n                                    dataRow.set(\"qoh\", 0);\n                                    dataRow.set(\"wac\", 0);\n                                    dataRow.set(\"amount\", 0);\n                                    dataRow.set(\"exchangeAmount\", 0);\n                                }\n                            } catch {\n                                dataRow.set(\"price\", 0);\n                                dataRow.set(\"amount\", 0);\n                            }\n                        }\n                        break;\n                    case \"price\":\n                        try {\n                            amount = parseFloat(dataRow.price) * parseFloat(dataRow.qty);\n                            xAmount = amount * parseFloat(this.saleOrder.txnRate);\n\n                            dataRow.set(\"price\", parseFloat(dataRow.price));\n                            dataRow.set(\"amount\", amount);\n                            dataRow.set(\"exchangeAmount\", xAmount);\n                            // window.console.log('price',dataRow.price)\n                        } catch {\n                            dataRow.set(\"price\", 0);\n                            dataRow.set(\"amount\", 0);\n                            dataRow.set(\"exchangeAmount\", 0);\n                        }\n                        break;\n                    case \"qty\":\n                        try {\n                            amount = parseFloat(dataRow.price) * parseFloat(dataRow.qty);\n                            xAmount = amount * parseFloat(this.saleOrder.txnRate);\n\n                            dataRow.set(\"price\", parseFloat(dataRow.price));\n                            dataRow.set(\"amount\", amount);\n                            dataRow.set(\"exchangeAmount\", xAmount);\n                        } catch {\n                            dataRow.set(\"price\", 0);\n                            dataRow.set(\"amount\", 0);\n                            dataRow.set(\"exchangeAmount\", 0);\n                        }\n                        break;\n                    case \"otherTax\":\n                        // window.console.log(\"--\", dataRow)\n                        break;\n                    default:\n                        break;\n                }\n                if (e.field) {\n                    this.autoCalculate();\n                }\n            }\n        },\n        autoCalculate() {\n            let ds = this.$refs.itemLineDS.kendoWidget(),\n                subTotal = 0,\n                totalTax = 0,\n                discountTotal = 0,\n                spTax = 0,\n                pltax = 0,\n                otherTax = 0,\n                vatTax = 0,\n                discountInvoice = 0,\n                taxList = [],\n                discountItem = [],\n                saleUnit = [],\n                inclusiveTax = 0,\n                itemSubtotal = 0,\n                txnItmSubtotal = 0,\n                serviceSubtotal = 0,\n                itemDiscount = 0,\n                serviceDiscount = 0,\n                txnDiscount = 0;\n\n            const rows = ds.data().filter((m) => parseFloat(m.amount) > 0);\n            rows.forEach((value) => {\n                let modifierPrice = 0;\n                if (value.modifier) {\n                    modifierPrice = kendo.parseFloat(value.modifier.price);\n                }\n\n                // subTotal += (kendo.parseFloat(value.amount) + modifierPrice)\n                let discount = 0;\n                if (value.discountItem) {\n                    let subTo = kendo.parseFloat(value.price) * kendo.parseFloat(value.qty);\n                    discount = this.autoCalculateDiscount(value.discountItem, subTo);\n                    window.console.log('discount item', discount, '--', value.discountItem)\n                    value[\"discountAmount\"] = discount;\n                    value[\"discountExchangeAmount\"] =\n                        discount * kendo.parseFloat(this.saleOrder.txnRate);\n                    if (value.discountItem.hasOwnProperty(\"id\")) {\n                        discountItem.push(value.discountItem);\n                    }\n                    discountTotal += discount;\n                }\n                if (value.saleUnit) {\n                    if (value.saleUnit.hasOwnProperty(\"id\")) {\n                        saleUnit.push(value.saleUnit);\n                    }\n                }\n                if (value.specificTax) {\n                    spTax = this.autoCalculateTax(\n                        value.specificTax,\n                        kendo.parseFloat(value.amount) - kendo.parseFloat(discount)\n                    );\n                    // window.console.log('sp ', discount)\n                    spTax = kendo.parseFloat(spTax) ? kendo.parseFloat(spTax) : 0;\n                    value[\"specificTaxAmount\"] = spTax;\n                    value[\"specificTaxExchangeAmount\"] =\n                        spTax * kendo.parseFloat(this.saleOrder.txnRate);\n                    const tax = value.specificTax;\n                    const baseAmount = tax.baseAmount;\n                    if (baseAmount) {\n                        if (baseAmount.toLowerCase() === \"inclusive\") {\n                            inclusiveTax += spTax;\n                        }\n                    }\n                    if (value.specificTax.hasOwnProperty(\"taxType\")) {\n                        taxList.push({\n                            name: value.specificTax.taxType.name,\n                            amount: spTax,\n                            id: value.specificTax.taxType.id,\n                        });\n                    }\n                }\n                if (value.publicLightingTax) {\n                    pltax = this.autoCalculateTax(\n                        value.publicLightingTax,\n                        kendo.parseFloat(value.amount) - kendo.parseFloat(discount)\n                    );\n                    pltax = kendo.parseFloat(pltax) ? kendo.parseFloat(pltax) : 0;\n                    value[\"publicLightingTaxAmount\"] = pltax;\n                    value[\"publicLightingTaxExchangeAmount\"] =\n                        pltax * kendo.parseFloat(this.saleOrder.txnRate);\n                    const tax = value.publicLightingTax;\n                    const baseAmount = tax.baseAmount;\n                    if (baseAmount) {\n                        if (baseAmount.toLowerCase() === \"inclusive\") {\n                            inclusiveTax += pltax;\n                        }\n                    }\n                    if (value.publicLightingTax.hasOwnProperty(\"taxType\")) {\n                        taxList.push({\n                            name: value.publicLightingTax.taxType.name,\n                            amount: pltax,\n                            id: value.publicLightingTax.taxType.id,\n                        });\n                    }\n                }\n                if (value.otherTax) {\n                    otherTax = this.autoCalculateTax(\n                        value.otherTax,\n                        kendo.parseFloat(value.amount) - kendo.parseFloat(discount)\n                    );\n                    otherTax = kendo.parseFloat(otherTax)\n                        ? kendo.parseFloat(otherTax)\n                        : 0;\n                    value[\"otherTaxAmount\"] = otherTax;\n                    value[\"otherTaxExchangeAmount\"] =\n                        otherTax * kendo.parseFloat(this.saleOrder.txnRate);\n                    const tax = value.otherTax;\n                    const baseAmount = tax.baseAmount;\n                    if (baseAmount) {\n                        if (baseAmount.toLowerCase() === \"inclusive\") {\n                            inclusiveTax += otherTax;\n                        }\n                    }\n                    if (value.otherTax.hasOwnProperty(\"taxType\")) {\n                        taxList.push({\n                            name: value.otherTax.taxType.name,\n                            amount: otherTax,\n                            id: value.otherTax.taxType.id,\n                        });\n                    }\n                }\n\n                if (value.vatTax) {\n                    // window.console.log('Vat Tax', value.vatTax)\n                    let amt =\n                        kendo.parseFloat(spTax ? spTax : 0) +\n                        kendo.parseFloat(pltax ? pltax : 0) +\n                        kendo.parseFloat(otherTax ? otherTax : 0) +\n                        (kendo.parseFloat(value.amount ? value.amount : 0) -\n                            (discount ? discount : 0));\n                    vatTax = this.autoCalculateTax(value.vatTax, amt);\n                    vatTax = kendo.parseFloat(vatTax) ? kendo.parseFloat(vatTax) : 0;\n                    value[\"vatTaxAmount\"] = vatTax;\n                    value[\"vatTaxExchangeAmount\"] =\n                        vatTax * kendo.parseFloat(this.saleOrder.txnRate);\n                    const tax = value.vatTax;\n                    const baseAmount = tax.baseAmount;\n                    if (baseAmount) {\n                        if (baseAmount.toLowerCase() === \"inclusive\") {\n                            inclusiveTax += vatTax;\n                        }\n                    }\n                    if (value.vatTax.hasOwnProperty(\"taxType\")) {\n                        taxList.push({\n                            name: value.vatTax.taxType.name,\n                            amount: vatTax,\n                            id: value.vatTax.taxType.id,\n                        });\n                    }\n                }\n                totalTax +=\n                    kendo.parseFloat(spTax ? spTax : 0) +\n                    kendo.parseFloat(pltax ? pltax : 0) +\n                    kendo.parseFloat(otherTax ? otherTax : 0) +\n                    kendo.parseFloat(vatTax ? vatTax : 0);\n                subTotal +=\n                    kendo.parseFloat(value.amount) + modifierPrice - inclusiveTax;\n\n                const item = value.item;\n                const itmType = item.type || \"\";\n                if (itmType === \"Variant\") {\n                    itemSubtotal +=\n                        kendo.parseFloat(value.price) * kendo.parseFloat(value.qty);\n                    itemDiscount += kendo.parseFloat(discount);\n                } else if (itmType === \"Service\") {\n                    serviceSubtotal +=\n                        kendo.parseFloat(value.price) * kendo.parseFloat(value.qty);\n                    serviceDiscount += kendo.parseFloat(discount);\n                } else {\n                    txnItmSubtotal +=\n                        kendo.parseFloat(value.price) * kendo.parseFloat(value.qty);\n                    txnDiscount += kendo.parseFloat(discount);\n                }\n                //include Tax Amount\n                const amountNodiscount =\n                    kendo.parseFloat(value.price) * kendo.parseFloat(value.qty) -\n                    discount;\n                const includeTaxAmount =\n                    amountNodiscount + vatTax + pltax + spTax + otherTax;\n                value[\"includeTaxAmount\"] = includeTaxAmount;\n                value[\"includeTaxExchangeAmount\"] =\n                    includeTaxAmount * kendo.parseFloat(this.saleOrder.txnRate);\n            });\n\n            this.saleOrder.itemSubtotal = itemSubtotal;\n            this.saleOrder.exchangeItemSubtotal = itemSubtotal * kendo.parseFloat(this.saleOrder.txnRate);\n\n            this.saleOrder.serviceSubtotal = serviceSubtotal;\n            this.saleOrder.exchangeServiceSubtotal = serviceSubtotal * kendo.parseFloat(this.saleOrder.txnRate);\n            this.saleOrder.txnItmSubtotal = txnItmSubtotal;\n            this.saleOrder.exchangeTxnItmSubtotal = txnItmSubtotal * kendo.parseFloat(this.saleOrder.txnRate);\n\n            this.saleOrder.itemDiscount = itemDiscount;\n            this.saleOrder.exchangeItemDiscount = itemDiscount * kendo.parseFloat(this.saleOrder.txnRate);\n            this.saleOrder.serviceDiscount = serviceDiscount;\n            this.saleOrder.exchangeServiceDiscount = serviceDiscount * kendo.parseFloat(this.saleOrder.txnRate);\n            this.saleOrder.txnItmDiscount = txnDiscount;\n            this.saleOrder.exchangeTxnItmDiscount = txnDiscount * kendo.parseFloat(this.saleOrder.txnRate);\n\n            discountTotal = discountTotal ? discountTotal : 0;\n\n            // window.console.log(spTax, pltax, otherTax, vatTax)\n            let total =\n                kendo.parseFloat(subTotal) -\n                kendo.parseFloat(discountTotal) +\n                kendo.parseFloat(totalTax);\n            this.saleOrder.subTotal = subTotal;\n            this.saleOrder.totalTaxAmount = kendo.parseFloat(totalTax);\n            this.saleOrder.discountTotal = kendo.parseFloat(discountTotal);\n            if (this.saleOrder.specificDiscountItem) {\n                discountInvoice = this.autoCalculateDiscount(\n                    this.saleOrder.specificDiscountItem,\n                    kendo.parseFloat(subTotal)\n                );\n                discountInvoice = discountInvoice ? discountInvoice : 0;\n            }\n            // this.onOtherChargeChange()\n            this.saleOrder.total =\n                kendo.parseFloat(total) -\n                discountInvoice +\n                kendo.parseFloat(this.saleOrder.otherChargeAmount);\n            this.saleOrder.exchangeAmount =\n                kendo.parseFloat(this.saleOrder.total) *\n                kendo.parseFloat(this.saleOrder.txnRate);\n            this.autoCalculateTaxByType(taxList);\n            this.customerDiscountItem = this.removeDuplicate(discountItem);\n            this.customerSaleUnit = this.removeDuplicate(saleUnit);\n            // window.console.log('discount ', this.customerDiscountItem)\n        },\n        rowNumberTmpl(dataItem) {\n            let ds = this.$refs.itemLineDS.kendoWidget(),\n                index = ds.indexOf(dataItem);\n            return index + 1;\n        },\n        async loadSaleFormContent() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    saleFormContentHandler.list().then((res) => {\n                        if (res.data.statusCode === 200) {\n                            const data = res.data.data;\n                            if (data.length > 0) {\n                                this.saleFormContent = data[0];\n                                // window.console.log(data[0])\n                            }\n                        }\n                    });\n                }, 10);\n            });\n        },\n        vatTemplate(dataItem) {\n            const vat = dataItem.vatTax;\n            if (vat) {\n                return `<span>${vat.defaultTax ? vat.defaultTax : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        itemTemplate(dataItem) {\n            const item = dataItem.item;\n            if (item) {\n                return `<span>${item.name ? item.name : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        UOMTemplate(dataItem) {\n            const uom = dataItem.uom;\n            if (uom) {\n                return `<span>${uom.uom ? uom.uom.name : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        saleUnitTemplate(dataItem) {\n            const saleUnit = dataItem.saleUnit;\n            if (saleUnit) {\n                return `<span>${saleUnit.name ? saleUnit.name : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        discountItemTemplate(dataItem) {\n            const discountItem = dataItem.discountItem;\n            if (discountItem) {\n                return `<span>${discountItem.code ? discountItem.code : ``} - ${\n                    discountItem.name ? discountItem.name : ``\n                }</span>`;\n            } else {\n                return ``;\n            }\n        },\n        ServiceDateEditor(container, options) {\n            kendo\n                .jQuery('<input required name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDatePicker();\n\n            // let ds = this.$refs.itemLineDS.kendoWidget()\n            // window.console.log(ds.data())\n            // // const dateString = kendo.toString((new Date(options.model.items.serviceDate)), this.itemLine.dateFormat)\n            // // const dateString = kendo.toString(options.model.items.serviceDate)\n            // const $input = $(\"<input value=\" + options.model.serviceDate + \" />\").appendTo(container)\n            // $input.kendoDatePicker()\n            // // $input.appendTo(container)\n            // // options.model.items.serviceDate = dateString\n            // window.console.log($input)\n        },\n        ServiceDateToEditor(container, options) {\n            kendo\n                .jQuery('<input required name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDatePicker();\n        },\n        ItemDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"contains\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    headerTemplate:\n                        '<div class=\"dropdown-header k-widget k-header\">' +\n                        \"<span>Items </span>\" +\n                        \"<span></span>\" +\n                        \"</div>\",\n                    template: \"<span>#=name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        serverFiltering: true,\n                        transport: {\n                            read: {\n                                url: productVariantHandler.itemSearchURL('?plId=' + this.saleOrder.priceLevel.id),\n                            },\n                            dataType: \"json\",\n                        },\n                        schema: {\n                            model: {\n                                id: \"id\",\n                                fields: {\n                                    id: {type: \"string\"},\n                                    name: {type: \"string\"},\n                                    sku: {type: \"string\"},\n                                },\n                            },\n                            data: function (response) {\n                                return response.data;\n                            },\n                            total: function (response) {\n                                return response.data.count;\n                            },\n                        },\n                        // data: this.variants\n                    }),\n                });\n        },\n        UOMDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"uom.name\",\n                    dataValueField: \"uom.id\",\n                    cascadeFrom: \"item\",\n                    template: \"<span>#=uom.name || `No Price Level`#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        serverFiltering: true,\n                        transport: {\n                            read: {\n                                // url: uomPriceHandler.getURL(options.model.item.id, this.saleOrder.priceLevel.id),\n                                url: uomPriceHandler.uomPriceByPriceLevelURL(\n                                    \"id=\" +\n                                    options.model.item.id +\n                                    \"&plId=\" +\n                                    this.saleOrder.priceLevel.id +\n                                    \"&date=\" +\n                                    this.saleOrder.transactionDate\n                                ),\n                            },\n                            dataType: \"json\",\n                        },\n                        schema: {\n                            model: {\n                                id: \"id\",\n                                fields: {\n                                    id: {type: \"string\"},\n                                    // name: {type: \"string\"},\n                                    // sku: {type: \"string\"},\n                                },\n                            },\n                            data: function (response) {\n                                return response.data;\n                            },\n                            total: function (response) {\n                                return response.data.count;\n                            },\n                        },\n                        // data: this.variants\n                    }),\n                });\n        },\n        DiscountItemDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    cascadeFrom: \"item\",\n                    template: \"<span>#=code# - #=name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        serverFiltering: true,\n                        transport: {\n                            read: {\n                                url: discountItemHandler.getURL(DISCOUNT_TYPE),\n                            },\n                            dataType: \"json\",\n                        },\n                        schema: {\n                            model: {\n                                id: \"id\",\n                                fields: {\n                                    id: {type: \"string\"},\n                                    // name: {type: \"string\"},\n                                    // sku: {type: \"string\"},\n                                },\n                            },\n                            data: function (response) {\n                                return response.data;\n                            },\n                            total: function (response) {\n                                return response.data.count;\n                            },\n                        },\n                    }),\n                });\n        },\n        SpecificTaxDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"defaultTax\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=defaultTax#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.specificTax.filter((m) => {\n                            if (options.model.hasOwnProperty(\"vatTax\")) {\n                                const vat = options.model.vatTax;\n                                if (vat) {\n                                    if (\n                                        options.model.vatTax !== null ||\n                                        options.model.vatTax !== \"null\"\n                                    ) {\n                                        if (options.model.vatTax.baseAmount) {\n                                            return (\n                                                m.baseAmount.toLowerCase() ===\n                                                options.model.vatTax.baseAmount.toLowerCase()\n                                            );\n                                        } else {\n                                            return m;\n                                        }\n                                    }\n                                } else {\n                                    return m;\n                                }\n                            }\n                        }),\n                    }),\n                });\n        },\n        PublicLightingTaxDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"defaultTax\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=defaultTax#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.publicLightingTax.filter((m) => {\n                            if (options.model.hasOwnProperty(\"vatTax\")) {\n                                const vat = options.model.vatTax;\n                                if (vat) {\n                                    if (\n                                        options.model.vatTax !== null &&\n                                        options.model.vatTax !== \"null\"\n                                    ) {\n                                        if (options.model.vatTax.baseAmount) {\n                                            return (\n                                                m.baseAmount.toLowerCase() ===\n                                                options.model.vatTax.baseAmount.toLowerCase()\n                                            );\n                                        } else {\n                                            return m;\n                                        }\n                                    }\n                                } else {\n                                    return m;\n                                }\n                            }\n                        }),\n                    }),\n                });\n        },\n        OtherTaxDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"defaultTax\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=defaultTax#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.otherTax.filter((m) => {\n                            if (options.model.hasOwnProperty(\"vatTax\")) {\n                                const vat = options.model.vatTax;\n                                if (vat) {\n                                    if (\n                                        options.model.vatTax !== null &&\n                                        options.model.vatTax !== \"null\"\n                                    ) {\n                                        if (options.model.vatTax.baseAmount) {\n                                            return (\n                                                m.baseAmount.toLowerCase() ===\n                                                options.model.vatTax.baseAmount.toLowerCase()\n                                            );\n                                        } else {\n                                            return m;\n                                        }\n                                    }\n                                } else {\n                                    return m;\n                                }\n                            }\n                        }),\n                    }),\n                });\n        },\n        VatTaxDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"defaultTax\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=defaultTax#</span>\",\n                    optionLabel: \"--Select--\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.vatTax,\n                    }),\n                });\n        },\n        SaleUnitDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=code# - #=name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.saleUnitItemList,\n                    }),\n                });\n        },\n        ModifierDropDownEditor(container, options) {\n            const item = options.model.item || {}\n            const uom = item.uom || {}\n            const itemId = item.id || ''\n            const uomId = uom.id || ''\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"contains\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    headerTemplate:\n                        '<div class=\"dropdown-header k-widget k-header\">' +\n                        \"<span>Modifier </span>\" +\n                        \"<span></span>\" +\n                        \"</div>\",\n                    template: \"<span>#=name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        serverFiltering: true,\n                        transport: {\n                            read: {\n                                url: itemModifierHandler.searchURL('?plId=' + this.saleOrder.priceLevel.id + '&id=' + itemId + '&uomId=' + uomId),\n                            },\n                            dataType: \"json\",\n                        },\n                        schema: {\n                            model: {\n                                id: \"id\",\n                                fields: {\n                                    id: {type: \"string\"},\n                                    name: {type: \"string\"},\n                                    price: {type: \"number\"},\n                                    uom: {type: \"string\"},\n                                },\n                            },\n                            data: function (response) {\n                                return response.data;\n                            },\n                            total: function (response) {\n                                return response.data.count;\n                            },\n                        },\n                    }),\n                });\n        },\n        EmployeeDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoMultiSelect({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    suggest: true,\n                    filter: \"contains\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    headerTemplate:\n                        '<div class=\"dropdown-header k-widget k-header\">' +\n                        \"<span>Employee </span>\" +\n                        \"<span></span>\" +\n                        \"</div>\",\n                    template: \"<span>#=name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        serverFiltering: true,\n                        transport: {\n                            read: {\n                                url: employeeHandler.searchURL(),\n                            },\n                            dataType: \"json\",\n                        },\n                        schema: {\n                            model: {\n                                id: \"id\",\n                                fields: {\n                                    id: {type: \"string\"},\n                                    name: {type: \"string\"},\n                                    firstName: {type: \"string\"},\n                                    lastName: {type: \"string\"},\n                                },\n                            },\n                            data: function (response) {\n                                return response.data;\n                            },\n                            total: function (response) {\n                                return response.data.count;\n                            },\n                        },\n                    }),\n                });\n        },\n        empImpl(dataItem) {\n            let empIds = [];\n            dataItem.employee.forEach((m) => {\n                empIds.push(m.firstName + \" - \" + m.lastName);\n            });\n            // window.console.log(empIds.join(', '))\n            return `<span>${empIds.join(\", \")}</span>`;\n        },\n        addRow() {\n            let ds = this.$refs.itemLineDS.kendoWidget(),\n                total = ds.total();\n            this.itemLine.id = invoicePrefix + uuid.v1();\n            ds.insert(total, this.itemLine);\n        },\n        onSpecificDiscountChanged() {\n            if (this.saleOrder.specificDiscountItem) {\n                const discountOrder = this.autoCalculateDiscount(\n                    this.saleOrder.specificDiscountItem,\n                    this.saleOrder.subTotal\n                );\n                this.saleOrder.specificDiscountTotal = kendo.toString(\n                    discountOrder ? discountOrder : 0,\n                    \"n\"\n                );\n                let total =\n                    kendo.parseFloat(this.saleOrder.subTotal) -\n                    (kendo.parseFloat(this.saleOrder.discountTotal) +\n                        kendo.parseFloat(this.saleOrder.totalTaxAmount)) -\n                    discountOrder;\n                this.saleOrder.total = kendo.toString(total, \"n\");\n            }\n        },\n        onOtherChargeChange() {\n            let otherCharge = 0;\n            this.mOtherCharge.forEach((m) => {\n                otherCharge += this.autoCalculateDiscount(m, this.saleOrder.subTotal);\n            });\n            this.saleOrder.otherChargeAmount = otherCharge;\n            this.autoCalculate();\n        },\n        async loadOtherCharge() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    otherChargeHandler.list().then((res) => {\n                        if (res.data.statusCode === 200) {\n                            this.otherChargeList = res.data.data;\n                        }\n                    });\n                }, 10);\n            });\n        },\n        onOtherAmount(value) {\n            return this.autoCalculateDiscount(value, this.saleOrder.subTotal);\n        },\n        async loadDiscountItem() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    discountItemHandler.list().then((res) => {\n                        if (res.data.statusCode === 200) {\n                            this.specificDiscountItem = res.data.data;\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async loadSegment() {\n            this.segments = []\n            const roleType = dataStore.roleType || 0\n            if (roleType === 0) {\n                if (dataStore.roleData) {\n                    const roleData = dataStore.roleData || []\n                    const segment = roleData.filter(itm => itm.type === 'segment')\n                    const segmentDefault = segment.filter(m => m.isDefault === 1)\n                    this.segments = segment\n                    if (this.$route.params.id === undefined || this.$route.params.id === '') {\n                        if (segmentDefault.length > 0) {\n                            this.saleOrder.segment = segmentDefault[0];\n                        }\n                    }\n                }\n            } else if (roleType === 1) {\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        this.segments = [];\n                        settingsHandler\n                            .getSeg()\n                            .then((res) => {\n                                this.showLoading = true;\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    this.segments = res.data.data;\n                                } else {\n                                    this.showLoading = false\n                                }\n                            })\n                    }, 10);\n                });\n            }\n\n\n        },\n        async loadLocation() {\n            this.locations = []\n            const roleType = dataStore.roleType || 0\n            if (roleType === 0) {\n                if (dataStore.roleData) {\n                    const roleData = dataStore.roleData || []\n                    const location = roleData.filter(itm => itm.type === 'location')\n                    const locationDefault = location.filter(m => m.isDefault === 1)\n                    this.locations = location\n                    if (this.$route.params.id === undefined || this.$route.params.id === '') {\n                        if (locationDefault.length > 0) {\n                            this.saleOrder.location = locationDefault[0];\n                        }\n                    }\n                }\n            } else if (roleType === 1) {\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        this.locations = [];\n                        locationHandler\n                            .list()\n                            .then((res) => {\n                                this.showLoading = true;\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    this.locations = res.data.data;\n                                } else {\n                                    this.showLoading = false;\n                                }\n                            })\n                    }, 10);\n                });\n            }\n        },\n        async loadProjectByCustomer() {\n            this.customerProjects = []\n            const roleType = dataStore.roleType || 0\n            if (roleType === 0) {\n                if (dataStore.roleData) {\n                    const roleData = dataStore.roleData || []\n                    const project = roleData.filter(itm => itm.type === 'project')\n                    project.forEach(k => {\n                        const customers = k.customers || []\n                        const proCustomer = customers.filter(n => n.customer.id === this.customer.id)\n                        if (proCustomer.length > 0) {\n                            this.customerProjects.push(k)\n                        }\n                    })\n                    if (this.$route.params.id === undefined || this.$route.params.id === '') {\n                        const projectDefault = this.customerProjects.filter(m => m.isDefault === 1)\n                        if (projectDefault.length > 0) {\n                            this.saleOrder.project = projectDefault[0];\n                        }\n                    }\n                }\n            } else if (roleType === 1) {\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        projectHandler\n                            .getByCustomer(this.customer.id)\n                            .then((res) => {\n                                this.showLoading = true;\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    this.customerProjects = res.data.data;\n                                } else {\n                                    this.showLoading = false;\n                                }\n                            })\n                    }, 10);\n                });\n            }\n        },\n        async loadSaleChannel() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    this.showLoading = true;\n                    saleChannelHandler.get().then((res) => {\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false;\n                            this.saleChannelList = res.data.data;\n                            if (this.saleChannelList.length > 0) {\n                                if (\n                                    this.$route.params.id !== undefined ||\n                                    this.$route.params.id != \"\"\n                                ) {\n                                    this.saleOrder.saleChannel = this.saleChannelList[0];\n                                }\n                            }\n                        } else {\n                            this.showLoading = false;\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async loadTax() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    settingHandler.get().then((res) => {\n                        this.tax = res;\n                        this.otherTax = this.tax.filter(\n                            (m) =>\n                                (m.taxType.typeId === 7 || m.taxType.typeId === 10) &&\n                                m.transactionType === \"Sale\"\n                        ); // valuable tax\n                        this.specificTax = this.tax.filter(\n                            (m) =>\n                                (m.taxType.typeId === 8 || m.taxType.typeId === 10) &&\n                                m.transactionType === \"Sale\"\n                        ); // valuable tax\n                        this.publicLightingTax = this.tax.filter(\n                            (m) =>\n                                (m.taxType.typeId === 9 || m.taxType.typeId === 10) &&\n                                m.transactionType === \"Sale\"\n                        ); // valuable tax\n                        this.vatTax = this.tax.filter(\n                            (m) =>\n                                (m.taxType.typeId === 1 ||\n                                    m.taxType.typeId === 8 ||\n                                    m.taxType.typeId === 10) &&\n                                m.transactionType === \"Sale\"\n                        ); // valuable tax\n                    });\n                }, 10);\n            });\n        },\n        async loadSaleUnitItems() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    saleUnitItemHandler.list().then((res) => {\n                        if (res.data.statusCode === 200)\n                            this.saleUnitItemList = res.data.data;\n                    });\n                }, 10);\n            });\n        },\n        async loadCustomerBalance(id) {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const strFilter = id + \"?type=bal\";\n                    billingHandler\n                        .balance(strFilter)\n                        .then((res) => {\n                            if (res.data.statusCode === 200) {\n                                const data = res.data.data;\n                                if (data.length > 0) {\n                                    this.saleOrder.currentBalance = data[0].balance;\n                                }\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 10);\n            });\n        },\n        creditLimitUsage(balance, creditLimit) {\n            let num = 0;\n            let per = (balance / creditLimit) * 100\n            if (isNaN(per)) {\n                // It isn't a number\n                num = 0\n            } else {\n                // It is a number\n                num = per;\n            }\n            return num + \" %\";\n        },\n        close(data) {\n            if (this.$route.params.id === undefined) {\n                this.$router.push({\n                    name: \"Customers\",\n                    params: {\n                        data: data,\n                    },\n                });\n            } else {\n                window.history.go(-1);\n            }\n            window.console.log(data, \"close\");\n            // localStorage.data.id = JSON.stringify(data)\n        },\n        //catalog\n        loadImage(dataItem) {\n            if (dataItem.hasOwnProperty(\"images\")) {\n                if (dataItem.images.hasOwnProperty(\"default\")) {\n                    const url = this.imgURL + dataItem.images.default.thumb;\n                    return (\n                        \"<img width='50' height='50' style= 'margin: auto;display: block;' src='\" +\n                        url +\n                        \"' />\"\n                    );\n                }\n            } else {\n                return \"\";\n            }\n        },\n        async loadCatalogs() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    this.showLoading = true;\n                    catalogHandler.get().then((res) => {\n                        this.showLoading = false;\n                        this.catalogs = res;\n                    });\n                }, 10);\n            });\n        },\n        addCatalog(e) {\n            e.preventDefault();\n            let grid = kendo.jQuery(\"#gridCatalog\").data(\"kendoGrid\");\n            let dataItem = grid.dataItem($(e.currentTarget).closest(\"tr\"));\n            // window.console.log(dataItem)\n            if (dataItem.variants.length > 0) {\n                dataItem.variants.forEach((m) => {\n                    if (m.hasOwnProperty(\"variant\")) {\n                        if (m.variant.hasOwnProperty(\"id\")) {\n                            this.loadSingleItem(m.variant.id, \"i\");\n                        }\n                    }\n                });\n                this.dialogCatalog = false;\n            }\n            if (dataItem.services.length > 0) {\n                dataItem.services.forEach((m) => {\n                    if (m.hasOwnProperty(\"service\")) {\n                        if (m.service.hasOwnProperty(\"id\")) {\n                            this.loadSingleItem(m.service.id, \"s\");\n                        }\n                    }\n                });\n                this.dialogCatalog = false;\n            }\n        },\n        async loadSingleItem(itemId, type) {\n            new Promise((resolve) => {\n                resolve(\"resolved\");\n                setTimeout(() => {\n                    this.showLoading = true;\n                    productHandler.getOne(itemId).then((res) => {\n                        this.showLoading = false;\n                        let data = res;\n                        window.console.log(data);\n                        let ds = this.$refs.itemLineDS.kendoWidget(),\n                            total = ds.total();\n                        this.itemLine.id = invoicePrefix + uuid.v1();\n                        this.itemLine.item = data;\n                        if (type == \"i\") {\n                            this.itemLine.description = data.variant.saleDescription;\n                        } else {\n                            this.itemLine.description = data.saleDescription;\n                        }\n                        ds.insert(total, this.itemLine);\n                    });\n                }, 500);\n            });\n        },\n        async loadPrefix() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    prefixHandler.get(\"sale order\").then((res) => {\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false;\n                            this.transactionType = res.data.data;\n                            if (this.transactionType.length > 0) {\n                                this.saleOrder.transactionType = this.transactionType[0];\n                                if (!this.initsaleOrder) {\n                                    this.generateNumber();\n                                }\n                            }\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async loadViewsaleOrder() {\n            if (!this.initsaleOrder) {\n                this.isEdit = true\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        this.showLoading = true;\n                        saleOrderHandler\n                            .view(this.$route.params.id)\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    this.saleOrder = res.data.data[0];\n                                    this.quotes = this.saleOrder.refFrom || []\n                                    this.bindData();\n                                }\n                            })\n                            .catch();\n                        {\n                            this.showLoading = false;\n                        }\n                    }, 10);\n                });\n            } else {\n                this.setDefaultData()\n            }\n        },\n        async loadQuote() {\n            if (this.saleOrder.customer) {\n                this.refFrom = []\n                this.showLoading = true;\n                this.quotes = [];\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        let data = {\n                            method: \"by_customer\",\n                            customer: this.saleOrder.customer.id,\n                            segmentId: this.saleOrder.segment.id,\n                            locationId: this.saleOrder.location.id,\n                            priceLevelId: this.saleOrder.priceLevel.id,\n                            type: \"Sale Quote\",\n                        };\n                        saleOrderHandler.search(data).then((res) => {\n                            this.showLoading = false;\n                            this.quotes = res.data.data;\n                        });\n                    }, 10);\n                });\n            }\n        },\n        addQuote(data) {\n            //add item lines\n            let txnData = data.txnData || {}\n            const itemLines = data.itemLines || []\n            this.refFrom.push({\n                id: data.id || '',\n                reference: data.number || '',\n                customerId: txnData.customerId || '',\n            })\n            if (itemLines.length > 0) {\n                this.removeEmptyLine();\n                itemLines.forEach((m) => {\n                    m.txn_add_id = txnData.id;\n                    m.id = invoicePrefix + uuid.v1();\n                    let ds = this.$refs.itemLineDS.kendoWidget(),\n                        total = ds.total();\n                    ds.insert(total, m);\n                });\n                // this.addRow();\n            }\n            //add other chard\n            if (data.otherCharge.length > 0) {\n                data.otherCharge.forEach((m) => {\n                    m.txn_add_id = txnData.id;\n                    this.mOtherCharge.push(m);\n                });\n                this.autoCalculate();\n                this.onOtherChargeChange();\n            }\n            // add txnlist\n            this.txnLists.push(txnData);\n            if (txnData.lead.id !== undefined) {\n                this.txnLists.push(txnData.lead);\n            }\n            // window.console.log(this.txnLists);\n            //remove txn\n            const index = this.quotes.findIndex((item) => {\n                return data.id === item.id;\n            });\n            this.autoCalculate();\n            this.quotes.splice(index, 1);\n            // this.quotes[index].is_added = true\n            // window.console.log(this.quotes)\n            this.saleOrder.refFrom = this.removeDuplicate(this.refFrom)\n            window.console.log('ref', this.saleOrder.refFrom)\n        },\n        removeEmptyLine() {\n            const grid = kendo.jQuery(\"#gridItemLineSaleOrder\").data(\"kendoGrid\"),\n                dataSource = grid.dataSource;\n            dataSource.data().forEach((m) => {\n                if (m) {\n                    const item = m.item || {}\n                    if (item.id === undefined || item.id === '') {\n                        dataSource.remove(m);\n                    }\n                }\n            });\n        },\n        async loadTransactionRate() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const date = new Date(this.saleOrder.transactionDate)\n                        .toISOString()\n                        .substr(0, 10);\n                    const priceLevel = this.saleOrder.priceLevel;\n                    let code = \"\";\n                    if (priceLevel.hasOwnProperty(\"currency\")) {\n                        if (priceLevel.currency.hasOwnProperty(\"code\")) {\n                            code = priceLevel.currency.code;\n                        }\n                    }\n                    if (code !== undefined || code !== \"\") {\n                        this.showLoading = true;\n                        currencyHandler\n                            .getLastExchangeRateByDate(date, code)\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    this.exchangeRate = res.data.data[0];\n                                    this.currencyCode = this.exchangeRate.code;\n                                    this.transactionRate = this.exchangeRate.rate;\n                                    this.saleOrder.txnRate = this.exchangeRate.rate;\n                                    this.saleOrder.exchangeRate = this.exchangeRate;\n                                    this.showLoading = false;\n                                }\n                            });\n                    }\n                }, 10);\n            });\n        },\n        clear() {\n            this.id = undefined;\n            this.saleOrder = {};\n            this.itemLines = [];\n            this.customer = ''\n            this.generateNumber();\n        },\n        saveClose() {\n            let id = \"\";\n            if (this.customer.hasOwnProperty(\"id\")) {\n                id = this.customer.id || \"\";\n            }\n            if (id === \"\") {\n                this.$snotify.error(\"customer is require\");\n                return;\n            }\n            let ds = this.$refs.itemLineDS.kendoWidget();\n            let d1 = ds.data().filter((m) => m.amount > 0);\n            let dataValidate = 0;\n            d1.forEach((value, index) => {\n                if (value.item.id == undefined || value.uom.id == undefined) {\n                    this.$snotify.error(\n                        \"Please check Item or Uom  on row \" + (index + 1)\n                    );\n                } else {\n                    dataValidate += 1;\n                }\n            });\n            if (d1.length == dataValidate) {\n                this.isSaveClose = true;\n                this.saveOption = \"saveClose\";\n                this.save();\n            }\n        },\n        savePrint() {\n            this.isSavePrint = true;\n            this.saveOption = \"savePrint\";\n            this.save();\n        },\n        saveNew() {\n            this.saveOption = \"saveNew\";\n            this.isSaveNew = true;\n            this.save();\n        },\n        cancel() {\n            this.$swal({\n                title: i18n.t(\"msg_title_warning\"),\n                text: i18n.t(\"msg_discard\"),\n                icon: \"warning\",\n                showCancelButton: true,\n                cancelButtonText: i18n.t(\"cancel\"),\n                confirmButtonColor: \"#4d4848\",\n                cancelButtonColor: \"#ED1A3A\",\n                confirmButtonText: i18n.t(\"discard\"),\n            }).then((resultCen) => {\n                window.console.log(resultCen);\n                if (resultCen.value) {\n                    this.$router.go(-1);\n                }\n            });\n        },\n        saveDraft() {\n            this.saveOption = \"saveDraft\";\n            this.isSaveDraft = true;\n            this.save();\n        },\n        async save() {\n            if (!this.$refs.form.validate()) {\n                this.$refs.form.validate();\n                return;\n            }\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    this.removeEmptyLine();\n                    let itemLineDS = this.$refs.itemLineDS.kendoWidget(),\n                        total = itemLineDS.total();\n                    let itmLines = itemLineDS.data().filter(m => m.amount > 0).map(m => {\n                        return new ItemLineModel(m);\n                    })\n\n                    if (total <= 0) {\n                        this.$snotify.error(\"Field Required!\");\n                        return;\n                    }\n                    if (!this.isRequredPurchase) {\n                        this.saleOrder.supplier = {};\n                    } else {\n                        //is for purchase\n                        this.saleOrderType = 5;\n                    }\n                    // window.console.log(itmLines, 'itmLines')\n                    // window.console.log(JSON.stringify(itmLines), 'itmLines')\n                    let data = {\n                        id: this.saleOrder.id ? this.saleOrder.id : \"\",\n                        type: \"Sale Order\",\n                        transactionType: this.saleOrder.transactionType,\n                        number: this.saleOrder.number,\n                        abbr: this.saleOrder.transactionType.abbr,\n                        transactionDate: this.saleOrder.transactionDate,\n                        transactionDateTZ: Helper.toISODate(this.saleOrder.transactionDate),\n                        validityDate: this.saleOrder.validityDate,\n                        monthOf: this.saleOrder.monthOf,\n                        customer: this.saleOrder.customer,\n                        paymentTerm: this.saleOrder.paymentTerm,\n                        discountPromotion: {},\n                        priceLevel: this.saleOrder.priceLevel,\n                        itemLines: itmLines,\n                        segment: this.saleOrder.segment,\n                        location: this.saleOrder.location,\n                        project: this.saleOrder.project,\n                        saleChannel: this.saleOrder.saleChannel,\n                        billingAddress: this.saleOrder.billingAddress,\n                        deliveryAddress: this.saleOrder.deliveryAddress,\n                        deliveryDateTime: this.saleOrder.deliveryDateTime,\n                        transactionNote: this.saleOrder.transactionNote,\n                        subTotal: this.saleOrder.subTotal,\n                        total: this.saleOrder.total,\n                        amount: this.saleOrder.amount,\n                        discountTotal: this.saleOrder.discountTotal,\n                        specificDiscountTotal: this.saleOrder.specificDiscountTotal,\n                        deliveryFee: this.saleOrder.deliveryFee,\n                        totalTaxAmount: this.saleOrder.totalTaxAmount,\n                        currentBalance: this.saleOrder.currentBalance,\n                        creditLimit: this.saleOrder.creditLimit,\n                        saveOption: this.saveOption,\n                        txnRate: this.saleOrder.txnRate,\n                        rate: 1,\n                        exchangeRate: this.saleOrder.exchangeRate,\n                        exchangeAmount: this.saleOrder.exchangeAmount,\n                        status: 1,\n                        approvedBy: this.saleOrder.approvedBy,\n                        formTemplate: {},\n                        specificDiscountItem: this.saleOrder.specificDiscountItem,\n                        otherCharge: this.mOtherCharge,\n                        otherChargeAmount: this.saleOrder.otherChargeAmount,\n                        publicLink: \"\",\n                        taxListTotal: this.taxListTotal,\n                        customerDiscountItem: this.customerDiscountItem,\n                        customerSaleUnit: this.customerSaleUnit,\n                        loggedUser: this.loggedUser,\n                        txnList: this.txnLists,\n                        saleOrderType: this.saleOrder.saleOrderType,\n                        employee: this.saleOrder.employee,\n                        supplier: this.saleOrder.supplier,\n                        itemSubtotal: this.saleOrder.itemSubtotal,\n                        exchangeItemSubtotal: this.saleOrder.exchangeItemSubtotal,\n                        serviceSubtotal: this.saleOrder.serviceSubtotal,\n                        exchangeServiceSubtotal: this.saleOrder.exchangeServiceSubtotal,\n                        txnItmSubtotal: this.saleOrder.txnItmSubtotal,\n                        exchangeTxnItmSubtotal: this.saleOrder.exchangeTxnItmSubtotal,\n                        itemDiscount: this.saleOrder.itemDiscount,\n                        exchangeItemDiscount: this.saleOrder.exchangeItemDiscount,\n                        serviceDiscount: this.saleOrder.serviceDiscount,\n                        exchangeServiceDiscount: this.saleOrder.exchangeServiceDiscount,\n                        txnItmDiscount: this.saleOrder.txnItmDiscount,\n                        exchangeTxnItmDiscount: this.saleOrder.exchangeTxnItmDiscount,\n                        lead: {},\n                        routeView: \"sale_order_view\",\n                        exspectedDate: \"\",\n                        usedDateAt: \"\",\n                        deletedAt: \"\",\n                        deleted: 0,\n                        refFrom: this.saleOrder.refFrom || [],\n                        refTo: this.saleOrder.refTo || [],\n                        createdAt: new Date().toISOString().substr(0, 10),\n                    };\n                    // window.console.log('data', data)\n                    // window.console.log('data', JSON.stringify(data))\n                    this.showLoading = true;\n                    this.btnDisabled = true\n                    saleOrderHandler\n                        .create(data)\n                        .then((response) => {\n                            this.showLoading = false;\n                            if (response.data.statusCode === 201) {\n                                this.btnDisabled = false\n                                if (this.isSaveNew == true) {\n                                    this.setDefaultData();\n                                } else {\n                                    this.close(response.data.data);\n                                }\n                                // this.$refs.form.reset();\n                                this.$snotify.success(\"Successfully\");\n                            } else {\n                                this.btnDisabled = false\n                                this.showLoading = false;\n                            }\n                        })\n                        .catch((e) => {\n                            this.$snotify.error(\"Something went wrong\");\n                            this.errors.push(e);\n                            window.console.log(e);\n                        });\n                }, 10);\n            });\n        },\n        async loadPaymentTermList() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    if (this.customer) {\n                        const strFilter =\n                            \"?id=\" +\n                            this.customer.id +\n                            \"&transactionDate=\" +\n                            this.saleOrder.transactionDate +\n                            \"&type=Customer\";\n                        this.saleOrder.paymentTerm = {};\n                        paymentTermHandler_.get(strFilter).then((res) => {\n                            if (res.data.statusCode === 200) {\n                                const terms = res.data.data;\n                                this.saleOrder.paymentTerm = terms.term;\n                            }\n                        });\n                    }\n                }, 10);\n            });\n        },\n        async loadCreditLimit() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    if (this.customer) {\n                        const strFilter =\n                            \"?id=\" +\n                            this.customer.id +\n                            \"&transactionDate=\" +\n                            this.saleOrder.transactionDate +\n                            \"&type=Customer\";\n                        this.saleOrder.creditLimit = 0;\n                        creditLimitHandler.get(strFilter).then((res) => {\n                            if (res.data.statusCode === 200) {\n                                // this.creditLimitItem = res.data.data\n                                const credit = res.data.data;\n                                this.saleOrder.creditLimit = kendo.parseFloat(\n                                    credit.amount || 0\n                                );\n                            }\n                        });\n                    }\n                }, 10);\n            });\n        },\n        async clearUOMItem() {\n            let ds = this.$refs.itemLineDS.kendoWidget();\n            ds.data().map((n) => {\n                n.set(\"uom\", {});\n            });\n            this.isPriceLevelChanged = false;\n        },\n        onPriceLevelChange() {\n            this.isPriceLevelChanged = true;\n            this.loadTransactionRate();\n            this.clearUOMItem();\n            this.loadQuote()\n        },\n        async loadSaleOrder(id) {\n            window.console.log(id, 'load id')\n            this.showLoading = true\n            transactionHandler.view(id).then((res) => {\n                this.showLoading = false\n                this.isEdit = true\n                this.itemLines = []\n                this.saleOrder = res.data.data[0]\n                this.bindData();\n            })\n        },\n        async loadEmployeeCenter() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    this.employees = [];\n                    employeeHandler\n                        .center(undefined)\n                        .then((res) => {\n                            this.showLoading = true;\n                            this.saleOrder.employee = {}\n                            this.employees = []\n                            if (res.data.statusCode === 200) {\n                                this.showLoading = false;\n                                this.employees = res.data.data;\n                                // if (this.employees.length > 0) {\n                                //     this.transaction.employee = this.employees[0];\n                                // }\n                            } else {\n                                this.showLoading = false;\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 10);\n            });\n        },\n        async loadSingleData() {\n            if (this.$route.name === 'Sale Order') {\n                if (this.initsaleOrder) {\n                    // Edit Mode\n                    this.itemLines = []\n                    this.saleOrder = this.initsaleOrder;\n                    this.bindData();\n                } else {\n                    // new\n                    if (this.$route.params.id != undefined) {\n                        this.loadSaleOrder(this.$route.params.id)\n                    } else {\n                        this.setDefaultData()\n                    }\n                }\n                prefixHandler.get(\"sale order\").then((res) => {\n                    if (res.data.statusCode === 200) {\n                        this.showLoading = false;\n                        this.transactionType = res.data.data;\n                        if (this.transactionType.length > 0) {\n                            if (\n                                this.$route.params.id !== undefined ||\n                                this.$route.params.id != \"\"\n                            ) {\n                                this.saleOrder.transactionType = this.transactionType[0];\n                                if (!this.initSaleOrder && this.$route.params.id === undefined) {\n                                    this.generateNumber();\n                                }\n                            }\n                        }\n                    }\n                });\n                await this.loadPaymentTerm();\n                await this.loadSaleFormContent();\n                await this.loadOtherCharge();\n                await this.loadPriceLevel();\n                await this.loadDiscountItem(0);\n                await this.loadSaleChannel();\n                await this.loadCatalogs();\n                await this.loadLead();\n                this.loadTax();\n                this.loadSaleUnitItems();\n                this.loadSegment();\n                this.loadLocation();\n                this.loadEmployeeCenter();\n            }\n        },\n    },\n    activated() {\n        if (this.$route.params.id) {\n            this.loadViewsaleOrder();\n        }\n    },\n    watch: {\n        initsaleOrder() {\n            this.initialData();\n        },\n        '$route': 'loadSingleData',\n    },\n    created() {\n        this.loadTax();\n        this.loadSaleUnitItems();\n        // this.loadPrefix()\n        this.loadSegment();\n        this.loadLocation();\n        // localStorage.saleOrder = \"{name: 'abcssss'}\"\n    },\n    computed: {\n        appType() {\n            return dataStore.productType;\n        },\n        dateFormatted() {\n            return kendo.toString(new Date(), institute.dateFormat);\n        },\n        dateTimeFormatted() {\n            window.console.log(institute.dateFormat + \" HH:mm\", \"inst date\");\n            return kendo.toString(new Date(), institute.dateFormat + \" HH:mm\");\n        },\n        validCustomer() {\n            return this.customer.id !== undefined && this.customer.id !== null;\n        },\n        hiddenButton() {\n            if (this.$route.params.id) {\n                return true\n            } else {\n                return false\n            }\n        },\n        disabledMe() {\n            return !!this.$route.params.id;\n        },\n    },\n    mounted: async function () {\n        this.loadSingleData();\n        await this.requestData(0, this.filter, this.cusBaseUrl);\n        await this.supplierRequestData(0, this.filter, this.supBaseUrl);\n        await this.employeeRequestData(0, this.filter, this.empBaseUrl);\n    },\n};\n</script>\n\n<style scoped>\n.function_wrapper {\n    box-shadow: none !important;\n}\n\n.v-application--is-ltr .v-text-field .v-input__append-inner {\n    margin-top: 0 !important;\n}\n\n.v-input__slot {\n    background-color: #fff !important;\n}\n\n.function_content .label {\n    margin-bottom: 10px;\n    display: inline-block;\n}\n\n.border_radius10 {\n    border-radius: 10px !important;\n    background-color: #f2f2f2;\n}\n\n.pa-3.v-card h4 {\n    font-size: 18px;\n    color: #333;\n}\n\n.pa-3.v-card p {\n    font-size: 12px;\n    color: #b5b5b5;\n}\n\n.attachment_file {\n    background-color: #efeded;\n    border-radius: 0 !important;\n}\n\n.attachment_table.v-data-table table {\n    border: thin solid rgba(0, 0, 0, 0.12);\n}\n\n.attachment_table table tr th {\n    border-left: thin solid rgba(0, 0, 0, 0.12);\n    height: 35px;\n    border-right: thin solid rgba(0, 0, 0, 0.12);\n}\n\n.block_debit,\n.block_credit {\n    border-bottom: 1px solid #fff;\n}\n\n.block_debit p.number,\n.block_credit p.number {\n    font-size: 25px;\n    color: #7f7f7f;\n}\n\n.block_debit h5,\n.block_credit h5,\n.block_difference h5 {\n    text-transform: uppercase;\n    color: #7f7f7f;\n    font-size: 15px;\n    font-weight: normal;\n}\n\n.block_difference h5 {\n    font-size: 18px;\n}\n\n.block_difference h5 span {\n    font-size: 15px;\n}\n\n.custom_grid table th:last-child {\n    text-align: right !important;\n}\n\n.primary--text {\n    color: #f44336;\n}\n\n@media (min-width: 1264px) {\n    .container {\n        max-width: 1250px;\n    }\n}\n\n@media (max-width: 576px) {\n    .pt-6.col-sm-5.col-12 {\n        padding-top: 0 !important;\n    }\n\n    .code_text {\n        width: 100%;\n    }\n\n    .phone_no_pt {\n        padding-top: 0 !important;\n    }\n\n    .select_template,\n    .save_option {\n        margin-bottom: 10px;\n    }\n}\n\n.hide_small_bar_class {\n    max-width: 0;\n    transition: 0.5s ease-in;\n    flex: 0 0 0;\n}\n\n.hide_big_bar_class {\n    max-width: 100%;\n    transition: 0.5s ease-in;\n    flex: 0 0 100%;\n}\n\n.info_add {\n    background-color: #ffffff;\n}\n\n.small_sidebar {\n    height: 98%;\n    position: relative;\n    padding: 12px;\n    background-color: #edf1f5;\n}\n\n.iconArrow {\n    right: -35px;\n    position: absolute;\n    bottom: -10px;\n}\n\n.iconArrowHide {\n    position: absolute;\n    right: -7px;\n    bottom: -10px;\n}\n\n.color_grey {\n    color: #808080;\n}\n\n.card_green {\n    min-height: 70px;\n    background-color: #00b050 !important;\n    color: #ffffff;\n}\n\n.lb_bold {\n    font-size: 12px;\n}\n\n.detial_smallside_p {\n    position: absolute;\n    bottom: 10px;\n}\n\n.card_background {\n    background-color: #edf1f5;\n    min-height: 120px;\n}\n\n.deposite_input {\n    width: 100px;\n}\n\n.btn_save_draft {\n    color: #ffffff;\n    background-color: #00b0f0 !important;\n    text-transform: capitalize;\n}\n\n.save_option {\n    background-color: #203864 !important;\n}\n\n.btn_add_small {\n    height: 27px !important;\n    min-width: 25px !important;\n    font-size: 10px;\n    padding: 0 22px !important;\n    background-color: #00b050 !important;\n    color: #ffffff;\n    border-radius: 0 !important;\n}\n\n.list_site_inv {\n    background-color: #92d050;\n    color: #ffffff;\n    font-size: 12px;\n}\n\n.list_site_exp {\n    background-color: #c5e0b4;\n    color: #000000;\n    font-size: 12px;\n    line-height: 16px;\n    min-height: 40px;\n}\n\n.checkbox_inv {\n    padding: 2px;\n    margin-top: 3px;\n    margin-right: 2px;\n}\n\n.exp_select {\n    font-size: 12px !important;\n}\n\n.v-text-field {\n    padding-top: 0px !important;\n}\n</style>\n"]}]}