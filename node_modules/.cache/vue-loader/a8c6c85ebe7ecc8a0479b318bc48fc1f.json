{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/suppliers/PurchaseDeposits.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/suppliers/PurchaseDeposits.vue","mtime":1638499443344},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7aTE4bn0gZnJvbSAiQC9pMThuIjsKaW1wb3J0IGtlbmRvIGZyb20gIkBwcm9ncmVzcy9rZW5kby11aSI7CmltcG9ydCBQdXJjaGFzZURlcG9zaXRNb2RlbCBmcm9tICJAL3NjcmlwdHMvcHVyY2hhc2VfZGVwb3NpdC9tb2RlbC9QdXJjaGFzZURlcG9zaXQiOwppbXBvcnQge0Ryb3BEb3duTGlzdH0gZnJvbSAiQHByb2dyZXNzL2tlbmRvLXZ1ZS1kcm9wZG93bnMiOwppbXBvcnQge3V1aWR9IGZyb20gInZ1ZS11dWlkIjsKaW1wb3J0IEl0ZW1MaW5lTW9kZWwgZnJvbSAiQC9zY3JpcHRzL3B1cmNoYXNlX2RlcG9zaXQvbW9kZWwvSXRlbUxpbmUiOwppbXBvcnQge2RhdGFTdG9yZSwgU2hvd1Jlc291cmNlfSBmcm9tICJAL29ic2VydmFibGUvc3RvcmUiOwppbXBvcnQgUGF5bWVudE9wdGlvbkVkaXRvciBmcm9tICJAL3NjcmlwdHMva2VuZG9fZWRpdG9yL1BheW1lbnRPcHRpb25FZGl0b3IiOwoKY29uc3Qgc2FsZU9yZGVySGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy90cmFuc2FjdGlvbkhhbmRsZXIiKTsKY29uc3Qgc3VwcGxpZXJIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3N1cHBsaWVySGFuZGxlciIpOwoKY29uc3QgbG9jYXRpb25IYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2xvY2F0aW9uSGFuZGxlciIpOwpjb25zdCBzZXR0aW5nc0hhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvc2V0dGluZ3NIYW5kbGVyIik7CmNvbnN0IHB1cmNoYXNlRGVwb3NpdE1vZGVsID0gbmV3IFB1cmNoYXNlRGVwb3NpdE1vZGVsKHt9KTsKY29uc3QgcHJlZml4SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wcmVmaXhIYW5kbGVyIik7CmNvbnN0IGJpbGxpbmdIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2ludm9pY2UvaGFuZGxlci9iaWxsaW5nSGFuZGxlciIpOwpjb25zdCBhY2NvdW50SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9oYW5kbGVyL2FjY291bnRpbmcvYWNjb3VudCIpOwpjb25zdCBpdGVtTGluZU1vZGVsID0gbmV3IEl0ZW1MaW5lTW9kZWwoe30pOwpjb25zdCAkID0ga2VuZG8ualF1ZXJ5CmNvbnN0IHBheW1lbnRPcHRpb25IYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3BheW1lbnRPcHRpb25IYW5kbGVyIik7CmNvbnN0IGN1cnJlbmN5SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9jdXJyZW5jeS9oYW5kbGVyL2N1cnJlbmN5SGFuZGxlciIpOwoKY29uc3QgZGVmYXVsdEl0ZW0gPSB7WyJudW1iZXJOYW1lIl06ICJTZWxlY3QgdmVuZG9yLi4uIiwgWyJpZCJdOiBudWxsfTsKY29uc3QgZW1wdHlJdGVtID0ge1sibnVtYmVyTmFtZSJdOiAibG9hZGluZyAuLi4ifTsKY29uc3QgaXRlbUxpbmVQcmVmaXggPSAibGluLSI7CmNvbnN0IE9QVElPTl9UWVBFID0gIlN1cHBsaWVyIjsKY29uc3Qgc3RyRmlsdGVyID0gIj9vcHRpb25UeXBlPSIgKyBPUFRJT05fVFlQRTsKY29uc3QgY29va2llSlMgPSByZXF1aXJlKCJAL2Nvb2tpZS5qcyIpOwpjb25zdCBjb29raWUgPSBjb29raWVKUy5nZXRDb29raWUoKTsKZXhwb3J0IGRlZmF1bHQgewogICAgbmFtZTogIlB1cmNoYXNlRGVwb3NpdCIsCiAgICBwcm9wczogWyJpZCJdLAogICAgY29tcG9uZW50czogewogICAgICAgIExvYWRpbmdNZTogKCkgPT4gaW1wb3J0KGBAL2NvbXBvbmVudHMvTG9hZGluZ2ApLAogICAgICAgICJhcHAtZGF0ZXBpY2tlciI6ICgpID0+IGltcG9ydChgQC9jb21wb25lbnRzL2N1c3RvbV90ZW1wbGF0ZXMvRGF0ZVBpY2tlckNvbXBvbmVudGApLAogICAgICAgIGRyb3Bkb3dubGlzdDogRHJvcERvd25MaXN0LAogICAgfSwKICAgIGRhdGE6ICgpID0+ICh7CiAgICAgICAgaXNFZGl0OiBmYWxzZSwKICAgICAgICBzaG93TG9hZGluZzogZmFsc2UsCiAgICAgICAgYWxlcnQ6IGZhbHNlLAogICAgICAgIGZpbGVzOiBbXSwKICAgICAgICBzZWdtZW50czogW10sCiAgICAgICAgbG9jYXRpb25zOiBbXSwKICAgICAgICBwdXJjaGFzZURlcG9zaXQ6IHB1cmNoYXNlRGVwb3NpdE1vZGVsLAogICAgICAgIGl0ZW1MaW5lOiBpdGVtTGluZU1vZGVsLAogICAgICAgIHN1cHBsaWVyTGlzdDogW10sCiAgICAgICAgc3VwcGxpZXI6IHt9LAogICAgICAgIHRleHRGaWVsZDogIm51bWJlck5hbWUiLAogICAgICAgIGRlZmF1bHRJdGVtOiBkZWZhdWx0SXRlbSwKICAgICAgICBkYXRhSXRlbUtleTogImlkIiwKICAgICAgICBmaWx0ZXI6ICIiLAogICAgICAgIGN1c0Jhc2VVcmw6IHN1cHBsaWVySGFuZGxlci5zZWFyY2goKSwKICAgICAgICB0cmFuc2FjdGlvblR5cGVzOiBbXSwKICAgICAgICBhY2NTdXBwbGllckRlcG9zaXQ6IFtdLAogICAgICAgIHBheW1lbnRNZXRob2Q6IFtdLAogICAgICAgIHB1cmNoYXNlT3JkZXJzOiBbXSwKICAgICAgICBzYWxlT3JkZXJBbW91bnQ6IDAsCiAgICAgICAgc2FsZU9yZGVyQ3VycmVuY3k6ICIiLAogICAgICAgIGN1cnJlbmN5Q29kZTogIiIsCiAgICAgICAgYWNjQ2FzaDogW10sCiAgICAgICAgZGVwb3NpdExpbmU6IFtdLAogICAgICAgIGN1cnJlbmN5TGlzdDogW10sCiAgICAgICAgZGVjaW1hbEZvcm1hdDogIm4yIiwKICAgICAgICBkZXBvc2l0QmFsYW5jZTogMCwKICAgICAgICB2YWxpZDogdHJ1ZSwKICAgICAgICBsb2dnZWRVc2VyOiB7CiAgICAgICAgICAgIGlkOiBjb29raWUuY3JlYXRvciwKICAgICAgICAgICAgbmFtZTogY29va2llLmVtYWlsLAogICAgICAgIH0sCiAgICAgICAgdHJhbnNhY3Rpb25EYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3Vic3RyKDAsIDEwKSwKICAgICAgICB0ZW1wbGF0ZXM6IFsKICAgICAgICAgICAge3RpdGxlOiAiUHVyY2hhc2UgRGVwb3NpdCIsIHZhbHVlOiAiUHVyY2hhc2UgRGVwb3NpdCJ9LAogICAgICAgIF0sCiAgICAgICAgaXNIaWRlQmFyOiBmYWxzZSwKICAgICAgICBQYXltZW50T3B0aW9uRWRpdG9yOiBQYXltZW50T3B0aW9uRWRpdG9yLAogICAgICAgIHJlZkZyb206IFtdLAogICAgICAgIHJlZlRvOiBbXSwKICAgIH0pLAogICAgbWV0aG9kczogewogICAgICAgIG9uUE9DaGFuZ2VkKCkgewogICAgICAgICAgICBpZiAodGhpcy5wdXJjaGFzZURlcG9zaXQpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnB1cmNoYXNlRGVwb3NpdC5wdXJjaGFzZU9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2FsZU9yZGVyID0gdGhpcy5wdXJjaGFzZURlcG9zaXQucHVyY2hhc2VPcmRlciB8fCB7fTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWdtZW50ID0gc2FsZU9yZGVyLnNlZ21lbnQgfHwge307CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9jYXRpb24gPSBzYWxlT3JkZXIubG9jYXRpb24gfHwge307CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZURlcG9zaXQuc2VnbWVudCA9IHNlZ21lbnQ7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZURlcG9zaXQubG9jYXRpb24gPSBsb2NhdGlvbjsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZkZyb20ucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBzYWxlT3JkZXIuaWQgfHwgJycsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZTogc2FsZU9yZGVyLm51bWJlciB8fCAnJwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlRGVwb3NpdC5yZWZGcm9tID0gdGhpcy5yZWZGcm9tCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIEhlbHAoa2V5X3NlYXJjaCkgewogICAgICAgICAgICBTaG93UmVzb3VyY2Uoa2V5X3NlYXJjaCk7CiAgICAgICAgfSwKICAgICAgICBzYXZlTmV3KCkgewogICAgICAgIH0sCiAgICAgICAgcmVtb3ZlUm93KGUpIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBjb25zdCBncmlkID0ga2VuZG8ualF1ZXJ5KCIjZ3JpZFB1cmNoYXNlRGVwb3NpdCIpLmRhdGEoImtlbmRvR3JpZCIpLAogICAgICAgICAgICAgICAgZGF0YVNvdXJjZSA9IGdyaWQuZGF0YVNvdXJjZSwKICAgICAgICAgICAgICAgIGRhdGFJdGVtID0gZ3JpZC5kYXRhSXRlbSgkKGUuY3VycmVudFRhcmdldCkuY2xvc2VzdCgidHIiKSk7CgogICAgICAgICAgICBpZiAoZGF0YVNvdXJjZS50b3RhbCgpID4gMSkgewogICAgICAgICAgICAgICAgZGF0YVNvdXJjZS5yZW1vdmUoZGF0YUl0ZW0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBudW1iZXJGb3JtYXQob2JqLCB0eXBlKSB7CiAgICAgICAgICAgIGlmIChvYmopIHsKICAgICAgICAgICAgICAgIC8vIHRoaXMucHVyY2hhc2VEZXBvc2l0LmxvY2F0aW9uID0gb2JqLmhhc093blByb3BlcnR5KCdsb2NhdGlvbicpID8gb2JqLmxvY2F0aW9uIDoge30KICAgICAgICAgICAgICAgIC8vIHRoaXMucHVyY2hhc2VEZXBvc2l0LnNlZ21lbnQgPSBvYmouaGFzT3duUHJvcGVydHkoJ3NlZ21lbnQnKSA/IG9iai5zZWdtZW50IDoge30KICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAiYW1vdW50IikgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gb2JqLmhhc093blByb3BlcnR5KCJhbW91bnQiKSA/IG9iai5hbW91bnQgOiAwOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlY2ltYWxGb3JtYXQgPSBvYmouaGFzT3duUHJvcGVydHkoImRlY2ltYWxGb3JtYXQiKQogICAgICAgICAgICAgICAgICAgICAgICA/IG9iai5kZWNpbWFsRm9ybWF0CiAgICAgICAgICAgICAgICAgICAgICAgIDogYG4yYDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcocGFyc2VGbG9hdCh2YWx1ZSksIGRlY2ltYWxGb3JtYXQpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAiY3VycmVuY3kiKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVuY3kgPSBvYmouaGFzT3duUHJvcGVydHkoImN1cnJlbmN5IikgPyBvYmouY3VycmVuY3kgOiAiIjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVuY3kuY29kZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gIi0iOwogICAgICAgIH0sCiAgICAgICAgYW1vdW50Rm9ybWF0KHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyhwYXJzZUZsb2F0KHZhbHVlKSwgYCR7dGhpcy5kZWNpbWFsRm9ybWF0fWApOwogICAgICAgIH0sCiAgICAgICAgZ2VuZXJhdGVOdW1iZXIoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlID0gbmV3IERhdGUodGhpcy50cmFuc2FjdGlvbkRhdGUpOwogICAgICAgICAgICAgICAgY29uc3QgdHJhbkRhdGVJbnZvaWNlID0gbmV3IERhdGUodGhpcy5wdXJjaGFzZURlcG9zaXQudHJhbnNhY3Rpb25EYXRlKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlTSA9IHRyYW5EYXRlLmdldEZ1bGxZZWFyKCkgKyB0cmFuRGF0ZS5nZXRNb250aCgpOwogICAgICAgICAgICAgICAgY29uc3QgdHJhbkRhdGVJbnZvaWNlTSA9CiAgICAgICAgICAgICAgICAgICAgdHJhbkRhdGVJbnZvaWNlLmdldEZ1bGxZZWFyKCkgKyB0cmFuRGF0ZUludm9pY2UuZ2V0TW9udGgoKTsKICAgICAgICAgICAgICAgIGlmICh0cmFuRGF0ZU0gPT09IHRyYW5EYXRlSW52b2ljZU0pIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlRGVwb3NpdC5yZWZlcmVuY2VObyA9IHRoaXMucmVmZXJlbmNlTm87CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy50cmFuc2FjdGlvbkRhdGUgIT09ICIiICYmIHRoaXMudHJhbnNhY3Rpb25UeXBlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICBhYmJyOiB0aGlzLnB1cmNoYXNlRGVwb3NpdC50cmFuc2FjdGlvblR5cGUuYWJiciwKICAgICAgICAgICAgICAgICAgICBzdHJ1Y3R1cmU6IHRoaXMucHVyY2hhc2VEZXBvc2l0LnRyYW5zYWN0aW9uVHlwZS5zdHJ1Y3R1cmUsCiAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25EYXRlOiB0aGlzLnRyYW5zYWN0aW9uRGF0ZSwKICAgICAgICAgICAgICAgICAgICBzZXF1Y2VuY2luZzogdGhpcy5wdXJjaGFzZURlcG9zaXQudHJhbnNhY3Rpb25UeXBlLnNlcXVjZW5jaW5nLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJQdXJjaGFzZSBEZXBvc2l0IiwKICAgICAgICAgICAgICAgICAgICBlbnRpdHk6IDEsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgYmlsbGluZ0hhbmRsZXIKICAgICAgICAgICAgICAgICAgICAubGFzdE51bWJlcihkYXRhKQogICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhc3ROdW1iZXIgPSB0aGlzLnplcm9QYWQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VJbnQocmVzLmxhc3ROdW1iZXIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2VEZXBvc2l0LnRyYW5zYWN0aW9uVHlwZS5mb3JtYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlRGVwb3NpdC5udW1iZXIgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5zdWZmaXggKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2VEZXBvc2l0LnRyYW5zYWN0aW9uVHlwZS5udW1iZXJTZXBhcmF0b3IgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3ROdW1iZXI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9ycy5wdXNoKGUpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICB6ZXJvUGFkKG51bSwgcGxhY2VzKSB7CiAgICAgICAgICAgIHJldHVybiBTdHJpbmcobnVtKS5wYWRTdGFydChwbGFjZXMsICIwIik7CiAgICAgICAgfSwKICAgICAgICBzdWZmaXgodHJhbnNhY3Rpb25EYXRlKSB7CiAgICAgICAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyhuZXcgRGF0ZSh0cmFuc2FjdGlvbkRhdGUpLCBgeXltbWApOwogICAgICAgIH0sCiAgICAgICAgZXJyb3JNZXNzYWdlKCkgewogICAgICAgIH0sCiAgICAgICAgYWNjb3VudERyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IG5hbWU9IicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgICAgICAgICAgICBhdXRvQmluZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiAic3RhcnRzd2l0aCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogIm5hbWUiLAogICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZUZpZWxkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAiPHNwYW4+Iz1udW1iZXIjIC0gIz0gbmFtZSM8L3NwYW4+IiwKICAgICAgICAgICAgICAgICAgICBvcHRpb25MYWJlbDogIi0tU2VsZWN0LS0iLAogICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IG5ldyBrZW5kby5kYXRhLkRhdGFTb3VyY2UoewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLmFjY0Nhc2gsCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIG1ldGhvZERyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IG5hbWU9IicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgICAgICAgICAgICBhdXRvQmluZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiAic3RhcnRzd2l0aCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogIm5hbWUiLAogICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZUZpZWxkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAiPHNwYW4+Iz1jb2RlIyAtICM9IG5hbWUjPC9zcGFuPiIsCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6ICItLVNlbGVjdC0tIiwKICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlOiBuZXcga2VuZG8uZGF0YS5EYXRhU291cmNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogdGhpcy5wYXltZW50TWV0aG9kLAogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhY2NvdW50VGVtcGxhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3QgYWNjID0gZGF0YUl0ZW0uYWNjb3VudDsKICAgICAgICAgICAgaWYgKGFjYykgewogICAgICAgICAgICAgICAgcmV0dXJuIGA8c3Bhbj4ke2FjYy5uYW1lID8gYWNjLm5hbWUgOiBgYH08L3NwYW4+YDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBgYDsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbWV0aG9kVGVtcGxhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3QgbWV0aG9kID0gZGF0YUl0ZW0ucGF5bWVudE9wdGlvbiB8fCAnJwogICAgICAgICAgICBpZiAobWV0aG9kKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYDxzcGFuPiR7bWV0aG9kLmJhbmtBY2NvdW50TmFtZSB8fCBgYH08L3NwYW4+YDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBgYDsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYW1vdW50VGVtcGxhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3QgYW10ID0gZGF0YUl0ZW0uYW1vdW50OwogICAgICAgICAgICBpZiAoYW10KSB7CiAgICAgICAgICAgICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcocGFyc2VGbG9hdChhbXQpLCBgJHt0aGlzLmRlY2ltYWxGb3JtYXR9YCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYW1vdW50RWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IGRhdGEtYmluZD0idmFsdWU6JyArIG9wdGlvbnMuZmllbGQgKyAnIi8+JykKICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpCiAgICAgICAgICAgICAgICAua2VuZG9OdW1lcmljVGV4dEJveCh7CiAgICAgICAgICAgICAgICAgICAgZGVjaW1hbHM6IDMwLAogICAgICAgICAgICAgICAgICAgIGZvcm1hdDogYCR7dGhpcy5kZWNpbWFsRm9ybWF0fWAsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGNhbmNlbCgpIHsKICAgICAgICAgICAgdGhpcy4kc3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogaTE4bi50KCJtc2dfdGl0bGVfd2FybmluZyIpLAogICAgICAgICAgICAgICAgdGV4dDogaTE4bi50KCJtc2dfZGlzY2FyZCIpLAogICAgICAgICAgICAgICAgaWNvbjogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IGkxOG4udCgiY2FuY2VsIiksCiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjNGQ0ODQ4IiwKICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI0VEMUEzQSIsCiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogaTE4bi50KCJkaXNjYXJkIiksCiAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIuZ28oLTEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGNsZWFyKCkgewogICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuc3VwcGxpZXIgPSB7fQogICAgICAgICAgICB0aGlzLnB1cmNoYXNlT3JkZXJzID0gW10KICAgICAgICAgICAgY29uc3Qgc2VnbWVudCA9IHRoaXMucHVyY2hhc2VEZXBvc2l0LnNlZ21lbnQgfHwge30KICAgICAgICAgICAgY29uc3QgbG9jYXRpb24gPSB0aGlzLnB1cmNoYXNlRGVwb3NpdC5sb2NhdGlvbiB8fCB7fQogICAgICAgICAgICB0aGlzLmdlbmVyYXRlTnVtYmVyKCkKICAgICAgICAgICAgY29uc3QgdHhuVHlwZSA9IHRoaXMucHVyY2hhc2VEZXBvc2l0LnRyYW5zYWN0aW9uVHlwZTsKICAgICAgICAgICAgdGhpcy5wdXJjaGFzZURlcG9zaXQgPSBuZXcgUHVyY2hhc2VEZXBvc2l0TW9kZWwoe30pOwogICAgICAgICAgICB0aGlzLnB1cmNoYXNlRGVwb3NpdC50cmFuc2FjdGlvblR5cGUgPSB0eG5UeXBlOwogICAgICAgICAgICB0aGlzLnB1cmNoYXNlRGVwb3NpdC5zZWdtZW50ID0gc2VnbWVudAogICAgICAgICAgICB0aGlzLnB1cmNoYXNlRGVwb3NpdC5sb2NhdGlvbiA9IGxvY2F0aW9uCiAgICAgICAgICAgIC8vIHRoaXMuZGVwb3NpdExpbmUgPSBbXTsKICAgICAgICAgICAgbGV0IGxpbmVzID0gdGhpcy4kcmVmcy5wdXJjaGFzZURlcG9zaXREUy5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICBsaW5lcy5kYXRhKFtdKTsKICAgICAgICAgICAgdGhpcy5hZGRSb3coKTsKICAgICAgICB9LAogICAgICAgIGNsb3NlKCkgewogICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5nbygtMSk7CiAgICAgICAgfSwKICAgICAgICBoaWRlU21hbGxTaXRlQmFyKCkgewogICAgICAgICAgICB0aGlzLmlzSGlkZUJhciA9ICF0aGlzLmlzSGlkZUJhcjsKICAgICAgICB9LAogICAgICAgIG9uRmlsdGVyQ2hhbmdlKGV2ZW50KSB7CiAgICAgICAgICAgIGNvbnN0IGZpbHRlciA9IGV2ZW50LmZpbHRlci52YWx1ZTsKICAgICAgICAgICAgdGhpcy5yZXF1ZXN0RGF0YSgwLCBmaWx0ZXIsIHRoaXMuY3VzQmFzZVVybCk7CiAgICAgICAgICAgIHRoaXMuZmlsdGVyID0gZmlsdGVyOwogICAgICAgIH0sCiAgICAgICAgcmVxdWVzdERhdGEoc2tpcCwgZmlsdGVyLCBiYXNlVXJsKSB7CiAgICAgICAgICAgIGNvbnN0IHVybCA9IGJhc2VVcmwgKyBgP2ZpbHRlcj0ke2ZpbHRlcn1gOwogICAgICAgICAgICBmZXRjaCh1cmwpCiAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC50aGVuKHRoaXMuYWZ0ZXJGZXRjaCk7CiAgICAgICAgfSwKICAgICAgICBhZnRlckZldGNoKGpzb24pIHsKICAgICAgICAgICAgdGhpcy5zdXBwbGllckxpc3QgPSBqc29uLmRhdGE7CiAgICAgICAgfSwKICAgICAgICBvbkNoYW5nZShldmVudCkgewogICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGV2ZW50LnZhbHVlOwogICAgICAgICAgICBpZiAodmFsdWUgJiYgdmFsdWVbIm51bWJlck5hbWUiXSA9PT0gZW1wdHlJdGVtWyJudW1iZXJOYW1lIl0pIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnN1cHBsaWVyID0gdmFsdWU7CiAgICAgICAgICAgIGlmICh2YWx1ZS5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgaWYgKHZhbHVlLmlkICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWNpbWFsRm9ybWF0ID0gdGhpcy5zdXBwbGllci5kZWNpbWFsRm9ybWF0OwogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5oYXNPd25Qcm9wZXJ0eSgiYmFzZUN1cnJlbmN5IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmJhc2VDdXJyZW5jeS5oYXNPd25Qcm9wZXJ0eSgiY29kZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbmN5Q29kZSA9ICIgIiArIHZhbHVlLmJhc2VDdXJyZW5jeS5jb2RlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2VEZXBvc2l0LnB1cmNoYXNlRGVwb3NpdEFjYyA9IHZhbHVlLmhhc093blByb3BlcnR5KAogICAgICAgICAgICAgICAgICAgICAgICAicHVyY2hhc2VEZXBvc2l0QWNjIgogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgPyB2YWx1ZS5wdXJjaGFzZURlcG9zaXRBY2MKICAgICAgICAgICAgICAgICAgICAgICAgOiB7fTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRQdXJjaGFzZU9yZGVycygpOwogICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZEN1c3RvbWVyQmFsYW5jZSh2YWx1ZS5pZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRMb2NhdGlvbigpIHsKICAgICAgICAgICAgdGhpcy5sb2NhdGlvbnMgPSBbXQogICAgICAgICAgICBjb25zdCByb2xlVHlwZSA9IGRhdGFTdG9yZS5yb2xlVHlwZSB8fCAwCiAgICAgICAgICAgIGlmIChyb2xlVHlwZSA9PT0gMCkgewogICAgICAgICAgICAgICAgaWYgKGRhdGFTdG9yZS5yb2xlRGF0YSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvbGVEYXRhID0gZGF0YVN0b3JlLnJvbGVEYXRhIHx8IFtdCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9jYXRpb24gPSByb2xlRGF0YS5maWx0ZXIoaXRtID0+IGl0bS50eXBlID09PSAnbG9jYXRpb24nKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvY2F0aW9uRGVmYXVsdCA9IGxvY2F0aW9uLmZpbHRlcihtID0+IG0uaXNEZWZhdWx0ID09PSAxKQogICAgICAgICAgICAgICAgICAgIHRoaXMubG9jYXRpb25zID0gbG9jYXRpb24KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkID09PSB1bmRlZmluZWQgfHwgdGhpcy4kcm91dGUucGFyYW1zLmlkID09PSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9jYXRpb25EZWZhdWx0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2VEZXBvc2l0LmxvY2F0aW9uID0gbG9jYXRpb25EZWZhdWx0WzBdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHJvbGVUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvY2F0aW9ucyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbkhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5saXN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2NhdGlvbnMgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiAodGhpcy5sb2NhdGlvbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgdGhpcy5wdXJjaGFzZURlcG9zaXQubG9jYXRpb24gPSB0aGlzLmxvY2F0aW9uc1swXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkU2VnbWVudCgpIHsKICAgICAgICAgICAgdGhpcy5zZWdtZW50cyA9IFtdCiAgICAgICAgICAgIGNvbnN0IHJvbGVUeXBlID0gZGF0YVN0b3JlLnJvbGVUeXBlIHx8IDAKICAgICAgICAgICAgaWYgKHJvbGVUeXBlID09PSAwKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YVN0b3JlLnJvbGVEYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm9sZURhdGEgPSBkYXRhU3RvcmUucm9sZURhdGEgfHwgW10KICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWdtZW50ID0gcm9sZURhdGEuZmlsdGVyKGl0bSA9PiBpdG0udHlwZSA9PT0gJ3NlZ21lbnQnKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlZ21lbnREZWZhdWx0ID0gc2VnbWVudC5maWx0ZXIobSA9PiBtLmlzRGVmYXVsdCA9PT0gMSkKICAgICAgICAgICAgICAgICAgICB0aGlzLnNlZ21lbnRzID0gc2VnbWVudAogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09IHVuZGVmaW5lZCB8fCB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWdtZW50RGVmYXVsdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlRGVwb3NpdC5zZWdtZW50ID0gc2VnbWVudERlZmF1bHRbMF07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAocm9sZVR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VnbWVudHMgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NIYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0U2VnKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWdtZW50cyA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRQcmVmaXgoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIHByZWZpeEhhbmRsZXIuZ2V0KCJwdXJjaGFzZSBkZXBvc2l0IikudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb25UeXBlcyA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50cmFuc2FjdGlvblR5cGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlRGVwb3NpdC50cmFuc2FjdGlvblR5cGUgPSB0aGlzLnRyYW5zYWN0aW9uVHlwZXNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVOdW1iZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkQWNjb3VudCgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgYWNjb3VudEhhbmRsZXIuZ2V0QWxsKCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY2NTdXBwbGllckRlcG9zaXQgPSByZXMuZGF0YQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcigobSkgPT4gbS5hY2NvdW50X3R5cGUubnVtYmVyID09PSA5KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCgoaXRlbSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBpdGVtLnV1aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQ6IGl0ZW0udXVpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogaXRlbS5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9uYW1lOiBpdGVtLmxvY2FsX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlcjogaXRlbS5udW1iZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX3RheGFibGU6IGl0ZW0uaXNfdGF4YWJsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFuaGppQWNjQ29kZTogaXRlbS5iYW5oamlBY2NDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cF9jb2RlOiBpdGVtLmdyb3VwX2NvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudF9hY2NvdW50OiBpdGVtLnBhcmVudF9hY2NvdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlX2NvZGU6IGl0ZW0udHlwZV9jb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50X3R5cGU6IGl0ZW0uYWNjb3VudF90eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY2NDYXNoID0gcmVzLmRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoKG0pID0+IG0uYWNjb3VudF90eXBlLm51bWJlciA8PSA1KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCgoaXRlbSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBpdGVtLnV1aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQ6IGl0ZW0udXVpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogaXRlbS5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9uYW1lOiBpdGVtLmxvY2FsX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlcjogaXRlbS5udW1iZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX3RheGFibGU6IGl0ZW0uaXNfdGF4YWJsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFuaGppQWNjQ29kZTogaXRlbS5iYW5oamlBY2NDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cF9jb2RlOiBpdGVtLmdyb3VwX2NvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudF9hY2NvdW50OiBpdGVtLnBhcmVudF9hY2NvdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlX2NvZGU6IGl0ZW0udHlwZV9jb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50X3R5cGU6IGl0ZW0uYWNjb3VudF90eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYWNjU3VwcGxpZXJEZXBvc2l0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2VEZXBvc2l0LmFjY1JlY2VpdmFibGUgPSB0aGlzLmFjY1N1cHBsaWVyRGVwb3NpdFswXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRQdXJjaGFzZU9yZGVycygpIHsKICAgICAgICAgICAgaWYgKHRoaXMuc3VwcGxpZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZU9yZGVycyA9IFtdOwogICAgICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICJieV9zdXBwbGllciIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdXBwbGllcjogdGhpcy5zdXBwbGllci5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJQdXJjaGFzZSBPcmRlciIsCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIHNhbGVPcmRlckhhbmRsZXIuc2VhcmNoKGRhdGEpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZm9yRWFjaCgobSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvRGF0YSA9IG0udHhuRGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlT3JkZXJzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogbS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBtLnRvdGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IG0ubnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogcG9EYXRhLmN1cnJlbmN5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWNpbWFsRm9ybWF0OiBtLmRlY2ltYWxGb3JtYXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBwb0RhdGEubG9jYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnQ6IHBvRGF0YS5zZWdtZW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2codGhpcy5wdXJjaGFzZU9yZGVycywncHVyY2hhc2UnKQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcm93TnVtYmVyVG1wbChkYXRhSXRlbSkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLnB1cmNoYXNlRGVwb3NpdERTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICBpbmRleCA9IGRzLmluZGV4T2YoZGF0YUl0ZW0pOwogICAgICAgICAgICByZXR1cm4gaW5kZXggKyAxOwogICAgICAgIH0sCiAgICAgICAgYWRkUm93KCkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLnB1cmNoYXNlRGVwb3NpdERTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICB0b3RhbCA9IGRzLnRvdGFsKCk7CiAgICAgICAgICAgIHRoaXMuaXRlbUxpbmUuaWQgPSBpdGVtTGluZVByZWZpeCArIHV1aWQudjEoKTsKICAgICAgICAgICAgdGhpcy5pdGVtTGluZS5kZWNpbWFsRm9ybWF0ID0gdGhpcy5kZWNpbWFsRm9ybWF0OwogICAgICAgICAgICB0aGlzLml0ZW1MaW5lLm9wdGlvblR5cGUgPSBPUFRJT05fVFlQRTsKICAgICAgICAgICAgZHMuaW5zZXJ0KHRvdGFsLCB0aGlzLml0ZW1MaW5lKTsKICAgICAgICAgICAgLy8gdGhpcy5pdGVtTGluZXMucHVzaCh0aGlzLml0ZW1MaW5lKQogICAgICAgICAgICAvLyB0aGlzLml0ZW1MaW5lcy5wdXNoKHRoaXMuaXRlbUxpbmUpYQogICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coJ2l0ZW0gTGluZScsIHRoaXMuaXRlbUxpbmUpCiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkUGF5bWVudE9wdGlvbigpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXltZW50TWV0aG9kID0gW107CiAgICAgICAgICAgICAgICAgICAgcGF5bWVudE9wdGlvbkhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgLmxpc3Qoc3RyRmlsdGVyKQogICAgICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGF5bWVudE1ldGhvZCA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaCgpOwogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkQ3VycmVuY3lEYXRhKCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgLmxpc3QoImZ1bi1jIikKICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbmN5TGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5maWx0ZXIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChvKSA9PiBvLnVzZWQgPT09IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKTsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFRyYW5zYWN0aW9uUmF0ZSgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHRoaXMudHJhbnNhY3Rpb25EYXRlKQogICAgICAgICAgICAgICAgICAgICAgICAudG9JU09TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgICAgICAuc3Vic3RyKDAsIDEwKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW5jeSA9IHRoaXMucHVyY2hhc2VEZXBvc2l0LmN1cnJlbmN5OwogICAgICAgICAgICAgICAgICAgIGxldCBjb2RlID0gIiI7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbmN5Lmhhc093blByb3BlcnR5KCJjb2RlIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZSA9IGN1cnJlbmN5LmNvZGU7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoY29kZSAhPT0gdW5kZWZpbmVkIHx8IGNvZGUgIT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRMYXN0RXhjaGFuZ2VSYXRlQnlEYXRlKGRhdGUsIGNvZGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gcmVzLmRhdGEuZGF0YVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZURlcG9zaXQuZXhjaGFuZ2VSYXRlID0gcmVzcG9uc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2VEZXBvc2l0LnR4blJhdGUgPSByZXNwb25zZS5yYXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGF1dG9DYWxjdWxhdGUoKSB7CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMucHVyY2hhc2VEZXBvc2l0RFMua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIGNvbnZlcnRlZEFtb3VudCA9IDAsCiAgICAgICAgICAgICAgICBhbW91bnQgPSAwOwogICAgICAgICAgICBkcy5kYXRhKCkuZm9yRWFjaCgodmFsdWUpID0+IHsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5hbW91bnQpIHsKICAgICAgICAgICAgICAgICAgICBhbW91bnQgKz0ga2VuZG8ucGFyc2VGbG9hdCh2YWx1ZS5hbW91bnQpOwogICAgICAgICAgICAgICAgICAgIGNvbnZlcnRlZEFtb3VudCArPQogICAgICAgICAgICAgICAgICAgICAgICBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmFtb3VudCkgKiB0aGlzLnB1cmNoYXNlRGVwb3NpdC50eG5SYXRlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKGFtb3VudCwgImFtb3VudCIpOwogICAgICAgICAgICB0aGlzLnB1cmNoYXNlRGVwb3NpdC5leGNoYW5nZUFtb3VudCA9IGNvbnZlcnRlZEFtb3VudDsKICAgICAgICAgICAgdGhpcy5wdXJjaGFzZURlcG9zaXQuYW1vdW50ID0gYW1vdW50OwogICAgICAgIH0sCiAgICAgICAgZGF0YVNvdXJjZUNoYW5nZWQoZSkgewogICAgICAgICAgICBpZiAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgbGV0IGRhdGFSb3cgPSBlLml0ZW1zWzBdLCBwT3B0aW9uID0ge30KICAgICAgICAgICAgICAgIHN3aXRjaCAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgInBheW1lbnRPcHRpb24iOgogICAgICAgICAgICAgICAgICAgICAgICBwT3B0aW9uID0gZGF0YVJvdy5wYXltZW50T3B0aW9uIHx8IHt9CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJhY2NvdW50IiwgcE9wdGlvbi5hY2NvdW50IHx8IHt9KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhc3luYyBvblNhdmVDbG9zZShmbGFnKSB7CiAgICAgICAgICAgIGlmICghdGhpcy4kcmVmcy5mb3JtLnZhbGlkYXRlKCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuJHJlZnMuZm9ybS52YWxpZGF0ZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCBpZCA9ICIiOwogICAgICAgICAgICBpZiAodGhpcy5zdXBwbGllci5oYXNPd25Qcm9wZXJ0eSgiaWQiKSkgewogICAgICAgICAgICAgICAgaWQgPSB0aGlzLnN1cHBsaWVyLmlkIHx8ICIiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpZCA9PT0gIiIpIHsKICAgICAgICAgICAgICAgIHRoaXMuJHNub3RpZnkuZXJyb3IoInN1cHBsaWVyIGlzIHJlcXVpcmUiKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLnB1cmNoYXNlRGVwb3NpdERTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgIGxldCBkMSA9IGRzLmRhdGEoKTsKICAgICAgICAgICAgbGV0IGRhdGFWYWxpZGF0ZSA9IDA7CiAgICAgICAgICAgIGQxLmZvckVhY2goKHZhbHVlLCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKDEsIHZhbHVlKTsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICB2YWx1ZS5hY2NvdW50ID09IHVuZGVmaW5lZCB8fAogICAgICAgICAgICAgICAgICAgIHZhbHVlLmFjY291bnQuaWQgPT0gdW5kZWZpbmVkIHx8CiAgICAgICAgICAgICAgICAgICAgdmFsdWUuYWNjb3VudC5pZCA9PSBudWxsCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LmVycm9yKCJQbGVhc2UgY2hlY2sgQWNjb3VudCAgb24gcm93ICIgKyAoaW5kZXggKyAxKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGRhdGFWYWxpZGF0ZSArPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKGQxLmxlbmd0aCA9PSBkYXRhVmFsaWRhdGUpIHsKICAgICAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpdGVtTGluZURTID0gdGhpcy4kcmVmcy5wdXJjaGFzZURlcG9zaXREUy5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhUm93ID0gaXRlbUxpbmVEUy5kYXRhKCkuZmlsdGVyKChuKSA9PiBuLmFtb3VudCA+IDApLm1hcChtID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSXRlbUxpbmVNb2RlbChtKQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKDEsIGRhdGFSb3cpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVJvdy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgaXNBdXRvR2VuZXJhdGUgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlID0gbmV3IERhdGUodGhpcy50cmFuc2FjdGlvbkRhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlUmVjZWlwdCA9IG5ldyBEYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlRGVwb3NpdC50cmFuc2FjdGlvbkRhdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlTSA9IHRyYW5EYXRlLmdldEZ1bGxZZWFyKCkgKyB0cmFuRGF0ZS5nZXRNb250aCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlUmVjZWlwdE0gPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuRGF0ZVJlY2VpcHQuZ2V0RnVsbFllYXIoKSArIHRyYW5EYXRlUmVjZWlwdC5nZXRNb250aCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmFuRGF0ZU0gPT09IHRyYW5EYXRlUmVjZWlwdE0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNBdXRvR2VuZXJhdGUgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB0aGlzLnB1cmNoYXNlRGVwb3NpdC5pZCA/IHRoaXMucHVyY2hhc2VEZXBvc2l0LmlkIDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIlB1cmNoYXNlIERlcG9zaXQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQ6IHRoaXMucHVyY2hhc2VEZXBvc2l0LnV1aWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyB0aGlzLnB1cmNoYXNlRGVwb3NpdC51dWlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgam91cm5hbF91dWlkOiB0aGlzLnB1cmNoYXNlRGVwb3NpdC5qb3VybmFsX3V1aWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyB0aGlzLnB1cmNoYXNlRGVwb3NpdC5qb3VybmFsX3V1aWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IHRoaXMucHVyY2hhc2VEZXBvc2l0Lm51bWJlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYmJyOiB0aGlzLnB1cmNoYXNlRGVwb3NpdC50cmFuc2FjdGlvblR5cGUuYWJiciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbkRhdGU6IHRoaXMudHJhbnNhY3Rpb25EYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1cHBsaWVyOiB0aGlzLnN1cHBsaWVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uVHlwZTogdGhpcy5wdXJjaGFzZURlcG9zaXQudHJhbnNhY3Rpb25UeXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1MaW5lOiBkYXRhUm93LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uTm90ZTogdGhpcy5wdXJjaGFzZURlcG9zaXQudHJhbnNhY3Rpb25Ob3RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvdXJuYWxOb3RlOiB0aGlzLnB1cmNoYXNlRGVwb3NpdC5qb3VybmFsTm90ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VObzogdGhpcy5wdXJjaGFzZURlcG9zaXQucmVmZXJlbmNlTm8sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiB0aGlzLnB1cmNoYXNlRGVwb3NpdC5hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k6IHRoaXMucHVyY2hhc2VEZXBvc2l0LmN1cnJlbmN5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlQW1vdW50OiB0aGlzLnB1cmNoYXNlRGVwb3NpdC5leGNoYW5nZUFtb3VudCwgLy8gYW1vdW50IHRvIGJhc2UgY3VycmVuY3kKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eG5SYXRlOiB0aGlzLnB1cmNoYXNlRGVwb3NpdC50eG5SYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1cmNoYXNlRGVwb3NpdEFjYzogdGhpcy5wdXJjaGFzZURlcG9zaXQucHVyY2hhc2VEZXBvc2l0QWNjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlUmF0ZTogdGhpcy5wdXJjaGFzZURlcG9zaXQuZXhjaGFuZ2VSYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnQ6IHRoaXMucHVyY2hhc2VEZXBvc2l0LnNlZ21lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IHRoaXMucHVyY2hhc2VEZXBvc2l0LmxvY2F0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1cmNoYXNlT3JkZXI6IHRoaXMucHVyY2hhc2VEZXBvc2l0LnB1cmNoYXNlT3JkZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcHJvdmVkQnk6IHRoaXMucHVyY2hhc2VEZXBvc2l0LmFwcHJvdmVkQnksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0ZWRCeTogdGhpcy5wdXJjaGFzZURlcG9zaXQucmVqZWN0ZWRCeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtVGVtcGxhdGU6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogdGhpcy5wdXJjaGFzZURlcG9zaXQuY3JlYXRlZEF0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlZFVzZXI6IHRoaXMubG9nZ2VkVXNlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZGcm9tOiB0aGlzLnB1cmNoYXNlRGVwb3NpdC5yZWZGcm9tIHx8IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZlRvOiB0aGlzLnB1cmNoYXNlRGVwb3NpdC5yZWZUbyB8fCBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0F1dG9HZW5lcmF0ZTogaXNBdXRvR2VuZXJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uVHlwZTogdGhpcy4kcm91dGUucGFyYW1zLmlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gdGhpcy4kcm91dGUucXVlcnkudHlwZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ICJuZXciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKCdkYXRhJywgSlNPTi5zdHJpbmdpZnkoZGF0YSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaWxsaW5nSGFuZGxlci5jcmVhdGVQdXJjaGFzZURlcG9zaXQoZGF0YSkudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXNDb2RlID09PSAyMDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LnN1Y2Nlc3MoIlN1Y2Nlc3NmdWxseSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmxhZyA9PT0gImNsb3NlIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZsYWcgPT09ICJuZXciKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LmVycm9yKCJTb21ldGhpbmcgd2VudCB3cm9uZyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JzLnB1c2goZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkQ3VzdG9tZXJCYWxhbmNlKGlkKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0ckZpbHRlciA9IGlkICsgIj90eXBlPWRlcCI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZXBvc2l0QmFsYW5jZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5jdXJyZW5jeUNvZGUgPSAnJwogICAgICAgICAgICAgICAgICAgIGJpbGxpbmdIYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgIC5iYWxhbmNlKHN0ckZpbHRlcikKICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZXBvc2l0QmFsYW5jZSA9IGRhdGFbMF0uYmFsYW5jZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW5jeUNvZGUgPSAiICIgKyBkYXRhWzBdLmN1cnJlbmN5OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKCk7CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRWaWV3RGVwb3NpdCgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyRmlsdGVyID0gIj9pZD0iICsgdGhpcy4kcm91dGUucGFyYW1zLmlkOwogICAgICAgICAgICAgICAgICAgICAgICBiaWxsaW5nSGFuZGxlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnB1cmNoYXNlRGVwb3NpdExpc3Qoc3RyRmlsdGVyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZURlcG9zaXQgPSByZXMuZGF0YS5kYXRhWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRQdXJjaGFzZU9yZGVycygpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWNpbWFsRm9ybWF0ID0gdGhpcy5wdXJjaGFzZURlcG9zaXQuZGVjaW1hbEZvcm1hdDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZXBvc2l0TGluZSA9IHRoaXMucHVyY2hhc2VEZXBvc2l0Lml0ZW1MaW5lczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdXBwbGllciA9IHRoaXMucHVyY2hhc2VEZXBvc2l0LnN1cHBsaWVyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRDdXN0b21lckJhbGFuY2UodGhpcy5zdXBwbGllci5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb25EYXRlID0gdGhpcy5wdXJjaGFzZURlcG9zaXQudHJhbnNhY3Rpb25EYXRlOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5vbkNoYW5nZSh0aGlzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLm51bWJlckZvcm1hdCh0aGlzLnNhbGVEZXBvc2l0LnB1cmNoYXNlT3JkZXIsICdhbW91bnQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLm51bWJlckZvcm1hdCh0aGlzLnNhbGVEZXBvc2l0LnB1cmNoYXNlT3JkZXIsICdjdXJyZW5jeScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMucHVyY2hhc2VPcmRlcnMgPSB0aGlzLnNhbGVEZXBvc2l0LnB1cmNoYXNlT3JkZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBpbml0RGF0YSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmxvYWRWaWV3RGVwb3NpdCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5hZGRSb3coKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcmVsb2FkKCkgewogICAgICAgICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMubG9hZFZpZXdEZXBvc2l0KCkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuY2xlYXIoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKICAgIGNyZWF0ZWQoKSB7CiAgICAgICAgdGhpcy5sb2FkQWNjb3VudCgpOwogICAgICAgIHRoaXMubG9hZEN1cnJlbmN5RGF0YSgpOwogICAgfSwKICAgIHdhdGNoOiB7CiAgICAgICAgLy8gaWQoKSB7CiAgICAgICAgLy8gICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkID09PSB1bmRlZmluZWQpIHsKICAgICAgICAvLyAgICAgdGhpcy5jbGVhcigpOwogICAgICAgIC8vICAgfSBlbHNlIHsKICAgICAgICAvLyAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgLy8gICAgIHRoaXMubG9hZFZpZXdEZXBvc2l0KCk7CiAgICAgICAgLy8gICB9CiAgICAgICAgLy8gfSwKICAgICAgICAnJHJvdXRlJzogJ3JlbG9hZCcKICAgIH0sCiAgICBtb3VudGVkOiBhc3luYyBmdW5jdGlvbiAoKSB7CiAgICAgICAgYXdhaXQgdGhpcy5sb2FkUHJlZml4KCk7CiAgICAgICAgYXdhaXQgdGhpcy5sb2FkTG9jYXRpb24oKTsKICAgICAgICBhd2FpdCB0aGlzLmxvYWRTZWdtZW50KCk7CiAgICAgICAgYXdhaXQgdGhpcy5sb2FkUGF5bWVudE9wdGlvbigpOwogICAgICAgIHRoaXMucmVxdWVzdERhdGEoMCwgdGhpcy5maWx0ZXIsIHRoaXMuY3VzQmFzZVVybCk7CiAgICAgICAgYXdhaXQgdGhpcy5pbml0RGF0YSgpOwogICAgfSwKICAgIGNvbXB1dGVkOiB7CiAgICAgICAgZGlzYWJsZU1lKCkgewogICAgICAgICAgICByZXR1cm4gISF0aGlzLiRyb3V0ZS5wYXJhbXMuaWQ7CiAgICAgICAgfSwKICAgICAgICBhbW91bnRMaW5lSGVhZGVyVGVtcGxhdGUoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnB1cmNoYXNlRGVwb3NpdCkgewogICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKHRoaXMucHVyY2hhc2VEZXBvc2l0LmN1cnJlbmN5KQogICAgICAgICAgICAgICAgaWYgKHRoaXMucHVyY2hhc2VEZXBvc2l0Lmhhc093blByb3BlcnR5KCJjdXJyZW5jeSIpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVuY3kgPSB0aGlzLnB1cmNoYXNlRGVwb3NpdC5jdXJyZW5jeS5oYXNPd25Qcm9wZXJ0eSgiY29kZSIpCiAgICAgICAgICAgICAgICAgICAgICAgID8gdGhpcy5wdXJjaGFzZURlcG9zaXQuY3VycmVuY3kuY29kZQogICAgICAgICAgICAgICAgICAgICAgICA6ICIiOwogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW5jeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIkFtb3VudCAoIiArIGN1cnJlbmN5ICsgIikiOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiQW1vdW50IjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICJBbW91bnQiOwogICAgICAgIH0sCiAgICAgICAgLy8gc2VnbWVudCgpIHsKICAgICAgICAvLyAgIGlmICh0aGlzLnB1cmNoYXNlRGVwb3NpdCkgewogICAgICAgIC8vICAgICBpZiAodGhpcy5wdXJjaGFzZURlcG9zaXQucHVyY2hhc2VPcmRlcikgewogICAgICAgIC8vICAgICAgIGlmICh0aGlzLnB1cmNoYXNlRGVwb3NpdC5wdXJjaGFzZU9yZGVyLmhhc093blByb3BlcnR5KCdzZWdtZW50JykpIHsKICAgICAgICAvLyAgICAgICAgIGlmICh0aGlzLnB1cmNoYXNlRGVwb3NpdC5wdXJjaGFzZU9yZGVyLmhhc093blByb3BlcnR5KCdpZCcpKSB7CiAgICAgICAgLy8gICAgICAgICAgIHJldHVybiB0aGlzLnB1cmNoYXNlRGVwb3NpdC5wdXJjaGFzZU9yZGVyLnNlZ21lbnQubmFtZQogICAgICAgIC8vICAgICAgICAgfQogICAgICAgIC8vICAgICAgIH0KICAgICAgICAvLyAgICAgfQogICAgICAgIC8vICAgfQogICAgICAgIC8vICAgcmV0dXJuICcnCiAgICAgICAgLy8gfSwKICAgICAgICAvLyBsb2NhdGlvbigpIHsKICAgICAgICAvLyAgIGlmICh0aGlzLnB1cmNoYXNlRGVwb3NpdCkgewogICAgICAgIC8vICAgICBpZiAodGhpcy5wdXJjaGFzZURlcG9zaXQucHVyY2hhc2VPcmRlcikgewogICAgICAgIC8vICAgICAgIGlmICh0aGlzLnB1cmNoYXNlRGVwb3NpdC5wdXJjaGFzZU9yZGVyLmhhc093blByb3BlcnR5KCdsb2NhdGlvbicpKSB7CiAgICAgICAgLy8gICAgICAgICBpZiAodGhpcy5wdXJjaGFzZURlcG9zaXQucHVyY2hhc2VPcmRlci5sb2NhdGlvbi5oYXNPd25Qcm9wZXJ0eSgnaWQnKSkgewogICAgICAgIC8vICAgICAgICAgICByZXR1cm4gdGhpcy5wdXJjaGFzZURlcG9zaXQucHVyY2hhc2VPcmRlci5sb2NhdGlvbi5uYW1lCiAgICAgICAgLy8gICAgICAgICB9CiAgICAgICAgLy8gICAgICAgfQogICAgICAgIC8vICAgICB9CiAgICAgICAgLy8gICB9CiAgICAgICAgLy8gICByZXR1cm4gJycKICAgICAgICAvLyB9LAogICAgICAgIHZhbGlkU3VwcGxpZXIoKSB7CiAgICAgICAgICAgIGxldCBzdXBwbGllciA9IHRoaXMuc3VwcGxpZXI7CiAgICAgICAgICAgIHJldHVybiBzdXBwbGllci5pZCAhPT0gdW5kZWZpbmVkICYmIHN1cHBsaWVyLmlkICE9PSBudWxsOwogICAgICAgIH0sCiAgICAgICAgaGlkZGVuQnV0dG9uKCkgewogICAgICAgICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9LAp9Owo="},{"version":3,"sources":["PurchaseDeposits.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PurchaseDeposits.vue","sourceRoot":"src/views/suppliers","sourcesContent":["<template>\n    <v-app>\n        <v-container>\n            <v-row>\n                <v-col sm=\"12\" cols=\"12\">\n                    <v-card\n                        outlined\n                        dense\n                        class=\"pa-4 no_border rounded-sm\"\n                        color=\"white\"\n                    >\n                        <v-row>\n                            <v-col\n                                class=\"bigSide pr-2 py-0\"\n                                sm=\"8\"\n                                cols=\"12\"\n                                style=\"transition: .3s ease-in;\"\n                                :class=\"{ hide_big_bar_class: isHideBar }\"\n                            >\n                                <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                                    <v-card outlined dense class=\"no_border\">\n                                        <h2 class=\"mb-0\">{{ $t(\"purchase_deposit\") }}</h2>\n                                        <v-icon\n                                            v-if=\"isHideBar\"\n                                            @click=\"cancel()\"\n                                            style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                                            class=\"float-right\"\n                                        >close\n                                        </v-icon>\n                                        <span\n                                            style=\"transition: .3s ease-in; z-index:10;\"\n                                            :class=\"{\n                        iconArrow: !isHideBar,\n                        iconArrowHide: isHideBar,\n                      }\"\n                                        >\n                      <v-icon\n                          size=\"22\"\n                          class=\"arr_icon\"\n                          @click=\"hideSmallSiteBar\"\n                          v-if=\"isHideBar\"\n                      >\n                        mdi-chevron-left-circle\n                      </v-icon>\n                      <v-icon\n                          size=\"22\"\n                          class=\"arr_icon\"\n                          @click=\"hideSmallSiteBar\"\n                          v-if=\"!isHideBar\"\n                      >\n                        mdi-chevron-right-circle\n                      </v-icon>\n                    </span>\n                                    </v-card>\n                                    <v-card\n                                        outlined\n                                        dense\n                                        class=\"px-3 rounded-4 no_border mb-3\"\n                                        color=\"grayBg\"\n                                    >\n                                        <v-row>\n                                            <v-col sm=\"5\" cols=\"12\" class=\"pb-0 px-4 pt-4\">\n                                                <label class=\"label  mb-0\">{{ $t(\"supplier\") }}</label>\n                                                <div class=\"kendo_dropdown_custom mt-1 pb-3\">\n                                                    <dropdownlist\n                                                        :data-items=\"supplierList\"\n                                                        @change=\"onChange\"\n                                                        :value=\"supplier\"\n                                                        :data-item-key=\"dataItemKey\"\n                                                        :text-field=\"textField\"\n                                                        :default-item=\"defaultItem\"\n                                                        :filterable=\"true\"\n                                                        :disabled=\"disableMe\"\n                                                        @filterchange=\"onFilterChange\"\n                                                        :required=\"true\"\n                                                        :valid=\"validSupplier\">\n                                                    </dropdownlist>\n                                                </div>\n                                                <label class=\"label  mb-0\">{{ $t(\"date\") }}</label>\n                                                <app-datepicker\n                                                    :initialDate=\"transactionDate\"\n                                                    :disabled=\"disableMe\"\n                                                    @emitDate=\"transactionDate = $event\"\n                                                />\n                                                <label class=\"label mb-0\">{{ $t(\"number\") }}</label>\n                                                <v-row class=\"mt-1 mr-0\">\n                                                    <v-col sm=\"3\" cols=\"3\" class=\"py-0 pr-0\">\n                                                        <div class=\"code_text text-bold\">\n                                                            {{ purchaseDeposit.transactionType.abbr }}\n                                                        </div>\n                                                    </v-col>\n                                                    <v-col sm=\"7\" cols=\"7\" class=\"py-0 pl-0\">\n                                                        <v-text-field\n                                                            class=\" custom-border \"\n                                                            v-model=\"purchaseDeposit.number\"\n                                                            outlined\n                                                            readonly\n                                                            tage=\"Number\"\n                                                            :rules=\"[(v) => !!v || 'Number is required']\"\n                                                            required\n                                                        />\n                                                    </v-col>\n                                                    <v-col sm=\"2\" cols=\"2\" class=\"py-0 px-0\">\n                                                        <v-icon\n                                                            color=\"black\"\n                                                            size=\"30\"\n                                                            class=\"border_qrcode\"\n                                                            @click=\"generateNumber\"\n                                                            :disabled=\"disableMe\"\n                                                        >mdi-qrcode\n                                                        </v-icon>\n                                                    </v-col>\n                                                </v-row>\n                                                <label class=\"label mb-0\">{{\n                                                        $t(\"transaction_currency\")\n                                                    }}</label>\n                                                <v-select\n                                                    class=\"mt-1\"\n                                                    v-model=\"purchaseDeposit.currency\"\n                                                    :items=\"currencyList\"\n                                                    @change=\"loadTransactionRate\"\n                                                    item-value=\"id\"\n                                                    :item-text=\"(item) => `${item.code} - ${item.name}`\"\n                                                    return-object\n                                                    :rules=\"[(v) => !!v['id'] || 'is required']\"\n                                                    tage=\"Transaction Currency\"\n                                                    placeholder=\"Currency\"\n                                                    outlined\n                                                />\n                                            </v-col>\n                                            <v-col sm=\"7\" cosl=\"12\" class=\"px-4 pt-4\">\n                                                <v-row>\n                                                    <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                                        <v-row>\n                                                            <v-col sm=\"6\" cols=\"12\" class=\"py-0\">\n                                                                <p class=\"mb-1 pt-0 d-block\">\n                                                                    {{ $t(\"current_deposit_balance\") }}\n                                                                </p>\n                                                                <h3 class=\"color_green float-right\">\n                                                                    {{ amountFormat(depositBalance) }}\n                                                                    {{ currencyCode }}\n                                                                </h3>\n                                                            </v-col>\n                                                        </v-row>\n                                                    </v-col>\n                                                    <v-col sm=\"12\" cols=\"12\" class=\"py-1 pl-0 \">\n                                                        <v-card\n                                                            outlined\n                                                            dense\n                                                            class=\"no_border px-3 mt-3\"\n                                                            color=\"white\"\n                                                        >\n                                                            <v-row>\n                                                                <v-col sm=\"12\" cols=\"12\" class=\"py-0 pt-4\">\n                                                                    <label class=\"label mb-0\">{{\n                                                                            $t(\"deposit_to_account\")\n                                                                        }}</label>\n                                                                    <v-select\n                                                                        class=\"mt-1\"\n                                                                        v-model=\"purchaseDeposit.purchaseDepositAcc\"\n                                                                        :items=\"accSupplierDeposit\"\n                                                                        :disabled=\"true\"\n                                                                        :rules=\"[(v) => !!v || 'Term  is required']\"\n                                                                        item-value=\"id\"\n                                                                        :item-text=\"\n                                      (item) => `${item.number} - ${item.name}`\n                                    \"\n                                                                        return-object\n                                                                        placeholder=\"Account Deposit\"\n                                                                        tage=\"Account Deposit\"\n                                                                        outlined\n                                                                    />\n                                                                    <label class=\"label mb-0\">{{\n                                                                            $t(\"purchase_order\")\n                                                                        }}</label>\n                                                                    <v-select\n                                                                        class=\"mt-1\"\n                                                                        v-model=\"purchaseDeposit.purchaseOrder\"\n                                                                        :items=\"purchaseOrders\"\n                                                                        @change=\"onPOChanged\"\n                                                                        item-value=\"id\"\n                                                                        item-text=\"number\"\n                                                                        return-object\n                                                                        clearable\n                                                                        tage=\"Purchase Order\"\n                                                                        placeholder=\"Purchase Order\"\n                                                                        outlined\n                                                                    />\n                                                                </v-col>\n                                                                <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                                                    <v-row>\n                                                                        <v-col sm=\"6\" cols=\"12\" class=\"py-0\">\n                                                                            <label class=\"label mb-0\">{{\n                                                                                    $t(\"amount\")\n                                                                                }}</label>\n                                                                            <p class=\"mt-3\">\n                                                                                {{\n                                                                                    numberFormat(\n                                                                                        purchaseDeposit.purchaseOrder,\n                                                                                        \"amount\"\n                                                                                    )\n                                                                                }}\n                                                                            </p>\n                                                                        </v-col>\n                                                                        <v-col sm=\"6\" cols=\"12\" class=\"py-0\">\n                                                                            <label class=\"label mb-0\">{{\n                                                                                    $t(\"currency\")\n                                                                                }}</label>\n                                                                            <p class=\"mt-3\">\n                                                                                {{\n                                                                                    numberFormat(\n                                                                                        purchaseDeposit.purchaseOrder,\n                                                                                        \"currency\"\n                                                                                    )\n                                                                                }}\n                                                                            </p>\n                                                                        </v-col>\n                                                                    </v-row>\n                                                                </v-col>\n                                                            </v-row>\n                                                        </v-card>\n                                                    </v-col>\n                                                </v-row>\n                                            </v-col>\n                                        </v-row>\n                                    </v-card>\n\n                                    <v-card outlined dense class=\"no_border\" color=\"white\">\n                                        <v-row>\n                                            <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                                <kendo-datasource\n                                                    ref=\"purchaseDepositDS\"\n                                                    :change=\"dataSourceChanged\"\n                                                    :data=\"depositLine\"\n                                                />\n                                                <kendo-grid\n                                                    id=\"gridPurchaseDeposit\"\n                                                    class=\"grid-function\"\n                                                    :data-source-ref=\"'purchaseDepositDS'\"\n                                                    :sortable=\"false\"\n                                                    :filterable=\"false\"\n                                                    :column-menu=\"true\"\n                                                    :editable=\"true\"\n                                                    :scrollable-virtual=\"true\">\n                                                    <kendo-grid-column\n                                                        :command=\"{\n                              iconClass: 'k-icon k-i-trash',\n                              text: ' ',\n                              click: removeRow,\n                              class: 'btn-plus',}\"\n                                                        :title=\"''\"\n                                                        :width=\"63\"\n                                                        :headerAttributes=\"{ style: 'text-align: right; background-color: #EDF1F5',}\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :title=\"$t('no.')\"\n                                                        :width=\"53\"\n                                                        :template=\"rowNumberTmpl\"\n                                                        :column-menu=\"false\"\n                                                        :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5;',\n                              class: 'text-products',}\"\n                                                        :attributes=\"{ style: 'text-align: products' }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'paymentOption'\"\n                                                        :title=\"$t('payment_option')\"\n                                                        :width=\"250\"\n                                                        :template=\"methodTemplate\"\n                                                        :editor=\"PaymentOptionEditor\"\n                                                        :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'account'\"\n                                                        :title=\"$t('account')\"\n                                                        :width=\"200\"\n                                                        :template=\"accountTemplate\"\n                                                        :editor=\"accountDropDownEditor\"\n                                                        :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'description'\"\n                                                        :title=\"$t('description')\"\n                                                        :width=\"200\"\n                                                        :template=\"'<span>#=description#</span>'\"\n                                                        :headerAttributes=\"{\n                              style: 'background-color: #EDF1F5',\n                            }\"\n                                                    />\n\n                                                    <kendo-grid-column\n                                                        :field=\"'amount'\"\n                                                        :title=\"$t('amount')\"\n                                                        :format=\"'{0:n}'\"\n                                                        :width=\"200\"\n                                                        :template=\"amountTemplate\"\n                                                        :headerTemplate=\"amountLineHeaderTemplate\"\n                                                        :editor=\"amountEditor\"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{ style: 'text-align: right' }\"\n                                                    />\n                                                    <kendo-grid-column\n                                                        :field=\"'refNo'\"\n                                                        :title=\"$t('payment_ref')\"\n                                                        :format=\"'{0:n}'\"\n                                                        :width=\"200\"\n                                                        :headerAttributes=\"{\n                              style:\n                                'text-align: right; background-color: #EDF1F5',\n                            }\"\n                                                        :attributes=\"{ style: 'text-align: right' }\"\n                                                    />\n                                                </kendo-grid>\n                                            </v-col>\n                                            <v-col sm=\"12\" cols=\"12\" class=\"pt-1\">\n                                                <v-btn\n                                                    class=\"float-left btn_plus white--text mr-2\"\n                                                    color=\"primary\"\n                                                    @click=\"addRow\"\n                                                >\n                                                    <v-icon size=\"\" class=\"ma-1\">mdi-plus</v-icon>\n                                                </v-btn>\n                                            </v-col>\n                                            <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                                <v-row>\n                                                    <v-col class=\"pt-0\" sm=\"7\" cols=\"12\">\n                                                        <v-card\n                                                            class=\"no-boxshadow rounded-4 pa-3\"\n                                                            color=\"grayBg\"\n                                                            height=\"138px\"\n                                                        >\n                                                            <v-row>\n                                                                <v-col class=\"py-0\" sm=\"6\" cols=\"12\">\n                                                                    <label>{{ $t(\"message_on_deposit\") }}</label>\n                                                                    <v-textarea\n                                                                        class=\"mt-1\"\n                                                                        no-resize\n                                                                        height=\"90px\"\n                                                                        v-model=\"purchaseDeposit.transactionNote\"\n                                                                        outlined\n                                                                        clearable\n                                                                        rows=\"3\"\n                                                                        placeholder=\"This will appear on the deposit\"\n                                                                    />\n                                                                </v-col>\n                                                                <v-col class=\"py-0\" sm=\"6\" cols=\"12\">\n                                                                    <label>{{ $t(\"message_for_journal\") }}</label>\n                                                                    <v-textarea\n                                                                        class=\"mt-1\"\n                                                                        no-resize\n                                                                        height=\"90px\"\n                                                                        outlined\n                                                                        v-model=\"purchaseDeposit.journalNote\"\n                                                                        clearable\n                                                                        rows=\"3\"\n                                                                        placeholder=\"This will appear on the journal\"\n                                                                    />\n                                                                </v-col>\n                                                            </v-row>\n                                                        </v-card>\n                                                    </v-col>\n                                                    <v-col sm=\"5\" cols=\"12\" class=\"pt-1 pb-0\">\n                                                        <v-simple-table>\n                                                            <template v-slot:default>\n                                                                <tbody>\n                                                                <tr>\n                                                                    <td class=\"text-left text-uppercase\">\n                                                                        {{ $t(\"total\") }}\n                                                                    </td>\n                                                                    <td class=\"text-center\">:</td>\n                                                                    <td class=\"text-left color_green text-bold\">\n                                                                        {{\n                                                                            amountFormat(\n                                                                                purchaseDeposit.exchangeAmount\n                                                                            )\n                                                                        }}\n                                                                    </td>\n                                                                </tr>\n                                                                </tbody>\n                                                            </template>\n                                                        </v-simple-table>\n                                                    </v-col>\n                                                </v-row>\n                                            </v-col>\n                                        </v-row>\n                                    </v-card>\n\n                                    <v-divider/>\n                                    <v-card outlined dense class=\"no_border function_footer\">\n                                        <v-alert type=\"warning\" v-model=\"alert\" dismissible>\n                                            <span v-html=\"errorMessage\"/>\n                                        </v-alert>\n                                        <v-menu>\n                                            <template v-slot:activator=\"{ on }\">\n                                                <v-btn\n                                                    class=\"text-capitalize  black--text float-left mr-2\"\n                                                    v-on=\"on\"\n                                                >\n                                                    {{ $t(\"select_template\") }}\n                                                    <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>\n                                                </v-btn>\n                                            </template>\n                                            <v-list>\n                                                <v-list-item\n                                                    v-for=\"(item, index) in templates\"\n                                                    :key=\"index\"\n                                                >\n                                                    <v-list-item-title>{{\n                                                            item.title\n                                                        }}\n                                                    </v-list-item-title>\n                                                </v-list-item>\n                                            </v-list>\n                                        </v-menu>\n                                        <v-btn\n                                            color=\"primary\"\n                                            outlined\n                                            class=\" text-capitalize  black--text float-left mr-2\"\n                                            @click=\"cancel\"\n                                        >{{ $t(\"cancel\") }}\n                                        </v-btn>\n                                        <!--                    <v-menu>-->\n                                        <!--                      <template v-slot:activator=\"{ on }\">-->\n                                        <!--                        <v-btn color=\"primary\"-->\n                                        <!--                               class=\"ml-2 float-right  text-capitalize white&#45;&#45;text\" v-on=\"on\">-->\n                                        <!--                          {{ $t('save_option') }}-->\n                                        <!--                          <v-icon size=\"\" class=\"ma-1\">expand_more</v-icon>-->\n                                        <!--                        </v-btn>-->\n                                        <!--                      </template>-->\n                                        <!--                      <v-list rounded>-->\n                                        <!--                        <v-list-item-group>-->\n                                        <!--                          <v-list-item>-->\n                                        <!--                            <v-list-item-content>-->\n                                        <!--                              <v-list-item-title @click=\"onSaveClose('new')\">-->\n                                        <!--                                {{ $t('save_new') }}-->\n                                        <!--                              </v-list-item-title>-->\n                                        <!--                            </v-list-item-content>-->\n                                        <!--                          </v-list-item>-->\n                                        <!--                          &lt;!&ndash;                                                    <v-list-item>&ndash;&gt;-->\n                                        <!--                          &lt;!&ndash;                                                        <v-list-item-content>&ndash;&gt;-->\n                                        <!--                          &lt;!&ndash;                                                            <v-list-item-title @click=\"savePrint\">{{ $t('save_print') }}&ndash;&gt;-->\n                                        <!--                          &lt;!&ndash;                                                            </v-list-item-title>&ndash;&gt;-->\n                                        <!--                          &lt;!&ndash;                                                        </v-list-item-content>&ndash;&gt;-->\n                                        <!--                          &lt;!&ndash;                                                    </v-list-item>&ndash;&gt;-->\n                                        <!--                          <v-list-item>-->\n                                        <!--                            <v-list-item-content>-->\n                                        <!--                              <v-list-item-title>{{-->\n                                        <!--                                  $t('save_draft')-->\n                                        <!--                                }}-->\n                                        <!--                              </v-list-item-title>-->\n                                        <!--                            </v-list-item-content>-->\n                                        <!--                          </v-list-item>-->\n                                        <!--                        </v-list-item-group>-->\n                                        <!--                      </v-list>-->\n                                        <!--                    </v-menu>-->\n                                        <v-btn\n                                            color=\"primary\"\n                                            @click=\"onSaveClose('close')\"\n                                            class=\"float-right white--text text-capitalize \"\n                                        >\n                                            {{ $t(\"save_close\") }}\n                                        </v-btn>\n                                        <v-btn color=\"secondary\"\n                                               style=\"margin-right: 10px !important\"\n                                               class=\"white--text float-right text-capitalize\"\n                                               @click=\"onSaveClose('new')\" :hidden=\"hiddenButton\">{{ $t(\"save_new\") }}\n                                        </v-btn>\n                                    </v-card>\n                                </v-form>\n                            </v-col>\n                            <v-col\n                                class=\"smallSide pl-2 pt-0\"\n                                sm=\"4\"\n                                style=\"transition: .3s ease-in;\"\n                                :class=\"{ hide_small_bar_class: isHideBar }\"\n                            >\n                                <div class=\"d-flex justify-end\">\n                                    <h3\n                                        style=\"color: #b3b5bc; font-size:20px;\"\n                                        v-if=\"!isHideBar\"\n                                        class=\"text-uppercase\"\n                                    >\n                    <span class=\"pointer\" @click=\"Help('purchase deposit')\">\n                      {{ $t(\"help\") }}\n                    </span>\n                                        <v-icon\n                                            @click=\"cancel()\"\n                                            style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                                            class=\"float-right mt-n1\"\n                                        >close\n                                        </v-icon>\n                                    </h3>\n                                </div>\n\n                                <div v-if=\"!isHideBar\" class=\"small_sidebar mt-2 px-4 grayBg\">\n                                    <v-card outlined dense class=\"pa-3 no_border my_card rounded-4 white--text\"\n                                            color=\"primary\" height=\"60px\">\n                                        <h3 class=\"text-left font_13 flex-1 text-uppercase\">{{\n                                                $t('amount_deposit')\n                                            }}</h3>\n                                        <h3 class=\"text-right flex-1 font_20 niradei_heavy\">\n                                            {{ amountFormat(purchaseDeposit.exchangeAmount) }} </h3>\n                                    </v-card>\n                                    <v-row>\n                                        <v-col sm=\"12\" cols=\"12\">\n                                            <v-row>\n                                                <v-col sm=\"12\" cols=\"12\" class=\"pt-2\">\n                                                    <v-row>\n                                                        <v-col sm=\"12\" cols=\"12\" class=\"pb-0 pt-0\">\n                                                            <label class=\"label\">{{ $t(\"segment\") }}</label>\n                                                            <!--                              <h4 class=\"text-bold py-1\">{{ segment }}</h4>-->\n                                                            <v-select\n                                                                class=\"mt-1\"\n                                                                v-model=\"purchaseDeposit.segment\"\n                                                                :items=\"segments\"\n                                                                item-value=\"id\"\n                                                                :item-text=\"(item) => `${item.code} - ${item.name}`\"\n                                                                return-object\n                                                                :rules=\"[(v) => !!v['id']|| 'Segment is required']\"\n                                                                outlined=\"\"\n                                                            />\n                                                        </v-col>\n                                                        <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                                            <label class=\"label\">{{ $t(\"location\") }}</label>\n                                                            <!--                              <h4 class=\"text-bold py-1\">{{ location }}</h4>-->\n                                                            <v-select\n                                                                class=\"mt-1\"\n                                                                v-model=\"purchaseDeposit.location\"\n                                                                :items=\"locations\"\n                                                                item-value=\"id\"\n                                                                :rules=\"[(v) => !!v['id']|| 'Location is required']\"\n                                                                :item-text=\"(item) => `${item.code} - ${item.name}`\"\n                                                                return-object\n                                                                outlined=\"\"\n                                                            />\n                                                        </v-col>\n                                                    </v-row>\n\n                                                    <!--                                                    <label class=\"label font_14\">{{ $t('project') }}</label>-->\n                                                    <!--                                                    <label-->\n                                                    <!--                                                        class=\"label text-bold text-uppercase font_14\">{{-->\n                                                    <!--                                                            $t('tnc_to_be_added')-->\n                                                    <!--                                                        }}</label>-->\n                                                    <!--                                                    <v-select class=\" mt-1\"-->\n                                                    <!--                                                              :items=\"transaction\"-->\n                                                    <!--                                                              tage=\"Transactions to be added\"-->\n                                                    <!--                                                              :rules=\"[v => !!v || 'Payble Account is required']\"-->\n                                                    <!--                                                              return-object-->\n                                                    <!--                                                              outlined-->\n                                                    <!--                                                    >-->\n                                                    <!--                                                        <template v-slot:item=\"{ item }\">-->\n                                                    <!--                                                            <p class=\"d-block text-center\">{{ item.id }}.-->\n                                                    <!--                                                                {{ item.name }}</p>-->\n                                                    <!--                                                            <br>-->\n                                                    <!--                                                            <div class=\"item_list d-flex\">-->\n                                                    <!--                                                                <span>-->\n                                                    <!--                                                                    {{ item.no }}-->\n                                                    <!--                                                                </span>-->\n                                                    <!--                                                                <v-btn>{{ $t('add') }}</v-btn>-->\n                                                    <!--                                                            </div>-->\n                                                    <!--                                                        </template>-->\n                                                    <!--                                                    </v-select>-->\n\n                                                    <!--                                                    <v-row>-->\n                                                    <!--                                                        <label class=\"text-bold ml-9 mt-2\" style=\"font-size: 12px;\">1.-->\n                                                    <!--                                                            {{ $t('sale_quote') }}</label>-->\n                                                    <!--                                                        <v-col sm=\"9\" cols=\"9\" class=\"py-0 pr-0\">-->\n                                                    <!--                                                            <v-card outlined-->\n                                                    <!--                                                                    class=\"px-3 py-1 text-white no-boxshadow no_border justify-left d-flex\"-->\n                                                    <!--                                                                    style=\"background-color: #92d050; height: 30px\">-->\n                                                    <!--                                                                <input type=\"checkbox\" class=\"checkbox_inv float-left\"/>-->\n                                                    <!--                                                                <p class=\"mb-0\" style=\"width: 100%\">-->\n                                                    <!--                                                                    <span class=\"pl-3 float-left\">No. 00224</span>-->\n                                                    <!--                                                                    <span class=\"float-right\">2,500.00</span>-->\n                                                    <!--                                                                </p>-->\n                                                    <!--                                                            </v-card>-->\n                                                    <!--                                                        </v-col>-->\n                                                    <!--                                                        <v-col sm=\"3\" cols=\"3\" class=\"py-0  pl-1\">-->\n                                                    <!--                                                            <v-btn-->\n                                                    <!--                                                                class=\"text-white text-bold rounded-0 float-right text-uppercase\"-->\n                                                    <!--                                                                style=\"height: 30px !important; background-color: rgb(0, 176, 80) !important\">-->\n                                                    <!--                                                                {{ $t('add') }}-->\n                                                    <!--                                                            </v-btn>-->\n                                                    <!--                                                        </v-col>-->\n                                                    <!--                                                    </v-row>-->\n                                                    <!--                                                    <v-row>-->\n                                                    <!--                                                        <label class=\"text-bold ml-9\" style=\"font-size: 12px;\">2.-->\n                                                    <!--                                                            {{ $t('sale_quote') }}</label>-->\n                                                    <!--                                                        <v-col sm=\"9\" cols=\"9\" class=\"py-0 pr-0\">-->\n                                                    <!--                                                            <v-card outlined-->\n                                                    <!--                                                                    class=\"px-3 py-1 text-white no-boxshadow no_border justify-left d-flex\"-->\n                                                    <!--                                                                    style=\"background-color: #92d050; height: 30px\">-->\n                                                    <!--                                                                <input type=\"checkbox\" class=\"checkbox_inv float-left\"/>-->\n                                                    <!--                                                                <p class=\"mb-0\" style=\"width: 100%\">-->\n                                                    <!--                                                                    <span class=\"pl-3 float-left\">No. 00224</span>-->\n                                                    <!--                                                                    <span class=\"float-right\">2,500.00</span>-->\n                                                    <!--                                                                </p>-->\n                                                    <!--                                                            </v-card>-->\n                                                    <!--                                                        </v-col>-->\n                                                    <!--                                                        <v-col sm=\"3\" cols=\"3\" class=\"py-0  pl-1\">-->\n                                                    <!--                                                            <v-btn-->\n                                                    <!--                                                                class=\"text-white text-bold rounded-0 float-right text-uppercase\"-->\n                                                    <!--                                                                style=\"height: 30px !important; background-color: rgb(0, 176, 80) !important\">-->\n                                                    <!--                                                                {{ $t('add') }}-->\n                                                    <!--                                                            </v-btn>-->\n                                                    <!--                                                        </v-col>-->\n                                                    <!--                                                    </v-row>-->\n                                                    <!--                                                    <v-row>-->\n                                                    <!--                                                        <label class=\"text-bold ml-9 mt-2\" style=\"font-size: 12px;\">4.-->\n                                                    <!--                                                            {{ $t('sale_quote') }}</label>-->\n                                                    <!--                                                        <v-col sm=\"9\" cols=\"9\" class=\"py-0 pr-0\">-->\n                                                    <!--                                                            <v-card outlined-->\n                                                    <!--                                                                    class=\"px-3 py-1 text-white no-boxshadow no_border justify-left d-flex\"-->\n                                                    <!--                                                                    style=\"background-color: #92d050; height: 30px\">-->\n                                                    <!--                                                                <input type=\"checkbox\" class=\"checkbox_inv float-left\"/>-->\n                                                    <!--                                                                <p class=\"mb-0\" style=\"width: 100%\">-->\n                                                    <!--                                                                    <span class=\"pl-3 float-left\">No. 00224</span>-->\n                                                    <!--                                                                    <span class=\"float-right\">2,500.00</span>-->\n                                                    <!--                                                                </p>-->\n                                                    <!--                                                            </v-card>-->\n                                                    <!--                                                        </v-col>-->\n                                                    <!--                                                        <v-col sm=\"3\" cols=\"3\" class=\"py-0  pl-1\">-->\n                                                    <!--                                                            <v-btn-->\n                                                    <!--                                                                class=\"text-white text-bold rounded-0 float-right text-uppercase\"-->\n                                                    <!--                                                                style=\"height: 30px !important; background-color: rgb(0, 176, 80) !important\">-->\n                                                    <!--                                                                {{ $t('add') }}-->\n                                                    <!--                                                            </v-btn>-->\n                                                    <!--                                                        </v-col>-->\n                                                    <!--                                                    </v-row>-->\n                                                </v-col>\n                                            </v-row>\n                                        </v-col>\n                                    </v-row>\n\n                                    <p class=\"mb-0 detial_smallside_p pr-4 font_14\">\n                                        {{ $t(\"purchase_deposit_desc\") }}\n                                    </p>\n                                </div>\n                            </v-col>\n                        </v-row>\n                    </v-card>\n                </v-col>\n            </v-row>\n            <LoadingMe :isLoading=\"showLoading\" :fullPage=\"false\" :myLoading=\"true\"/>\n        </v-container>\n    </v-app>\n</template>\n\n<script>\nimport {i18n} from \"@/i18n\";\nimport kendo from \"@progress/kendo-ui\";\nimport PurchaseDepositModel from \"@/scripts/purchase_deposit/model/PurchaseDeposit\";\nimport {DropDownList} from \"@progress/kendo-vue-dropdowns\";\nimport {uuid} from \"vue-uuid\";\nimport ItemLineModel from \"@/scripts/purchase_deposit/model/ItemLine\";\nimport {dataStore, ShowResource} from \"@/observable/store\";\nimport PaymentOptionEditor from \"@/scripts/kendo_editor/PaymentOptionEditor\";\n\nconst saleOrderHandler = require(\"@/scripts/transactionHandler\");\nconst supplierHandler = require(\"@/scripts/supplierHandler\");\n\nconst locationHandler = require(\"@/scripts/locationHandler\");\nconst settingsHandler = require(\"@/scripts/settingsHandler\");\nconst purchaseDepositModel = new PurchaseDepositModel({});\nconst prefixHandler = require(\"@/scripts/prefixHandler\");\nconst billingHandler = require(\"@/scripts/invoice/handler/billingHandler\");\nconst accountHandler = require(\"@/scripts/handler/accounting/account\");\nconst itemLineModel = new ItemLineModel({});\nconst $ = kendo.jQuery\nconst paymentOptionHandler = require(\"@/scripts/paymentOptionHandler\");\nconst currencyHandler = require(\"@/scripts/currency/handler/currencyHandler\");\n\nconst defaultItem = {[\"numberName\"]: \"Select vendor...\", [\"id\"]: null};\nconst emptyItem = {[\"numberName\"]: \"loading ...\"};\nconst itemLinePrefix = \"lin-\";\nconst OPTION_TYPE = \"Supplier\";\nconst strFilter = \"?optionType=\" + OPTION_TYPE;\nconst cookieJS = require(\"@/cookie.js\");\nconst cookie = cookieJS.getCookie();\nexport default {\n    name: \"PurchaseDeposit\",\n    props: [\"id\"],\n    components: {\n        LoadingMe: () => import(`@/components/Loading`),\n        \"app-datepicker\": () => import(`@/components/custom_templates/DatePickerComponent`),\n        dropdownlist: DropDownList,\n    },\n    data: () => ({\n        isEdit: false,\n        showLoading: false,\n        alert: false,\n        files: [],\n        segments: [],\n        locations: [],\n        purchaseDeposit: purchaseDepositModel,\n        itemLine: itemLineModel,\n        supplierList: [],\n        supplier: {},\n        textField: \"numberName\",\n        defaultItem: defaultItem,\n        dataItemKey: \"id\",\n        filter: \"\",\n        cusBaseUrl: supplierHandler.search(),\n        transactionTypes: [],\n        accSupplierDeposit: [],\n        paymentMethod: [],\n        purchaseOrders: [],\n        saleOrderAmount: 0,\n        saleOrderCurrency: \"\",\n        currencyCode: \"\",\n        accCash: [],\n        depositLine: [],\n        currencyList: [],\n        decimalFormat: \"n2\",\n        depositBalance: 0,\n        valid: true,\n        loggedUser: {\n            id: cookie.creator,\n            name: cookie.email,\n        },\n        transactionDate: new Date().toISOString().substr(0, 10),\n        templates: [\n            {title: \"Purchase Deposit\", value: \"Purchase Deposit\"},\n        ],\n        isHideBar: false,\n        PaymentOptionEditor: PaymentOptionEditor,\n        refFrom: [],\n        refTo: [],\n    }),\n    methods: {\n        onPOChanged() {\n            if (this.purchaseDeposit) {\n                if (this.purchaseDeposit.purchaseOrder) {\n                    const saleOrder = this.purchaseDeposit.purchaseOrder || {};\n                    const segment = saleOrder.segment || {};\n                    const location = saleOrder.location || {};\n                    this.purchaseDeposit.segment = segment;\n                    this.purchaseDeposit.location = location;\n                    this.refFrom.push({\n                        id: saleOrder.id || '',\n                        reference: saleOrder.number || ''\n                    })\n                }\n                this.purchaseDeposit.refFrom = this.refFrom\n            }\n        },\n        Help(key_search) {\n            ShowResource(key_search);\n        },\n        saveNew() {\n        },\n        removeRow(e) {\n            e.preventDefault();\n            const grid = kendo.jQuery(\"#gridPurchaseDeposit\").data(\"kendoGrid\"),\n                dataSource = grid.dataSource,\n                dataItem = grid.dataItem($(e.currentTarget).closest(\"tr\"));\n\n            if (dataSource.total() > 1) {\n                dataSource.remove(dataItem);\n            }\n        },\n        numberFormat(obj, type) {\n            if (obj) {\n                // this.purchaseDeposit.location = obj.hasOwnProperty('location') ? obj.location : {}\n                // this.purchaseDeposit.segment = obj.hasOwnProperty('segment') ? obj.segment : {}\n                if (type === \"amount\") {\n                    const value = obj.hasOwnProperty(\"amount\") ? obj.amount : 0;\n                    const decimalFormat = obj.hasOwnProperty(\"decimalFormat\")\n                        ? obj.decimalFormat\n                        : `n2`;\n                    return kendo.toString(parseFloat(value), decimalFormat);\n                } else if (type === \"currency\") {\n                    const currency = obj.hasOwnProperty(\"currency\") ? obj.currency : \"\";\n                    return currency.code;\n                }\n            }\n            return \"-\";\n        },\n        amountFormat(value) {\n            return kendo.toString(parseFloat(value), `${this.decimalFormat}`);\n        },\n        generateNumber() {\n            if (this.$route.params.id) {\n                const tranDate = new Date(this.transactionDate);\n                const tranDateInvoice = new Date(this.purchaseDeposit.transactionDate);\n                const tranDateM = tranDate.getFullYear() + tranDate.getMonth();\n                const tranDateInvoiceM =\n                    tranDateInvoice.getFullYear() + tranDateInvoice.getMonth();\n                if (tranDateM === tranDateInvoiceM) {\n                    this.purchaseDeposit.referenceNo = this.referenceNo;\n                    return;\n                }\n            }\n\n            if (this.transactionDate !== \"\" && this.transactionTypes.length > 0) {\n                let data = {\n                    abbr: this.purchaseDeposit.transactionType.abbr,\n                    structure: this.purchaseDeposit.transactionType.structure,\n                    transactionDate: this.transactionDate,\n                    sequcencing: this.purchaseDeposit.transactionType.sequcencing,\n                    type: \"Purchase Deposit\",\n                    entity: 1,\n                };\n                billingHandler\n                    .lastNumber(data)\n                    .then((response) => {\n                        if (response.data.statusCode === 200) {\n                            const res = response.data.data;\n                            const lastNumber = this.zeroPad(\n                                parseInt(res.lastNumber),\n                                this.purchaseDeposit.transactionType.format\n                            );\n                            this.purchaseDeposit.number =\n                                res.suffix +\n                                this.purchaseDeposit.transactionType.numberSeparator +\n                                lastNumber;\n                        }\n                    })\n                    .catch((e) => {\n                        this.errors.push(e);\n                    });\n            }\n        },\n        zeroPad(num, places) {\n            return String(num).padStart(places, \"0\");\n        },\n        suffix(transactionDate) {\n            return kendo.toString(new Date(transactionDate), `yymm`);\n        },\n        errorMessage() {\n        },\n        accountDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=number# - #= name#</span>\",\n                    optionLabel: \"--Select--\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.accCash,\n                    }),\n                });\n        },\n        methodDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"startswith\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    template: \"<span>#=code# - #= name#</span>\",\n                    optionLabel: \"--Select--\",\n                    dataSource: new kendo.data.DataSource({\n                        data: this.paymentMethod,\n                    }),\n                });\n        },\n        accountTemplate(dataItem) {\n            const acc = dataItem.account;\n            if (acc) {\n                return `<span>${acc.name ? acc.name : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        methodTemplate(dataItem) {\n            const method = dataItem.paymentOption || ''\n            if (method) {\n                return `<span>${method.bankAccountName || ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        amountTemplate(dataItem) {\n            const amt = dataItem.amount;\n            if (amt) {\n                return kendo.toString(parseFloat(amt), `${this.decimalFormat}`);\n            } else {\n                return 0;\n            }\n        },\n        amountEditor(container, options) {\n            kendo\n                .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoNumericTextBox({\n                    decimals: 30,\n                    format: `${this.decimalFormat}`,\n                });\n        },\n        cancel() {\n            this.$swal({\n                title: i18n.t(\"msg_title_warning\"),\n                text: i18n.t(\"msg_discard\"),\n                icon: \"warning\",\n                showCancelButton: true,\n                cancelButtonText: i18n.t(\"cancel\"),\n                confirmButtonColor: \"#4d4848\",\n                cancelButtonColor: \"#ED1A3A\",\n                confirmButtonText: i18n.t(\"discard\"),\n            }).then((result) => {\n                if (result.value) {\n                    this.clear();\n                    this.$router.go(-1);\n                }\n            });\n        },\n        clear() {\n            this.showLoading = false;\n            this.supplier = {}\n            this.purchaseOrders = []\n            const segment = this.purchaseDeposit.segment || {}\n            const location = this.purchaseDeposit.location || {}\n            this.generateNumber()\n            const txnType = this.purchaseDeposit.transactionType;\n            this.purchaseDeposit = new PurchaseDepositModel({});\n            this.purchaseDeposit.transactionType = txnType;\n            this.purchaseDeposit.segment = segment\n            this.purchaseDeposit.location = location\n            // this.depositLine = [];\n            let lines = this.$refs.purchaseDepositDS.kendoWidget();\n            lines.data([]);\n            this.addRow();\n        },\n        close() {\n            window.history.go(-1);\n        },\n        hideSmallSiteBar() {\n            this.isHideBar = !this.isHideBar;\n        },\n        onFilterChange(event) {\n            const filter = event.filter.value;\n            this.requestData(0, filter, this.cusBaseUrl);\n            this.filter = filter;\n        },\n        requestData(skip, filter, baseUrl) {\n            const url = baseUrl + `?filter=${filter}`;\n            fetch(url)\n                .then((response) => {\n                    return response.json();\n                })\n                .then(this.afterFetch);\n        },\n        afterFetch(json) {\n            this.supplierList = json.data;\n        },\n        onChange(event) {\n            const value = event.value;\n            if (value && value[\"numberName\"] === emptyItem[\"numberName\"]) {\n                return;\n            }\n            this.supplier = value;\n            if (value.hasOwnProperty(\"id\")) {\n                if (value.id !== null) {\n                    this.decimalFormat = this.supplier.decimalFormat;\n                    if (value.hasOwnProperty(\"baseCurrency\")) {\n                        if (value.baseCurrency.hasOwnProperty(\"code\")) {\n                            this.currencyCode = \" \" + value.baseCurrency.code;\n                        }\n                    }\n                    this.purchaseDeposit.purchaseDepositAcc = value.hasOwnProperty(\n                        \"purchaseDepositAcc\"\n                    )\n                        ? value.purchaseDepositAcc\n                        : {};\n                    this.loadPurchaseOrders();\n                    this.loadCustomerBalance(value.id);\n                }\n            }\n        },\n        async loadLocation() {\n            this.locations = []\n            const roleType = dataStore.roleType || 0\n            if (roleType === 0) {\n                if (dataStore.roleData) {\n                    const roleData = dataStore.roleData || []\n                    const location = roleData.filter(itm => itm.type === 'location')\n                    const locationDefault = location.filter(m => m.isDefault === 1)\n                    this.locations = location\n                    if (this.$route.params.id === undefined || this.$route.params.id === '') {\n                        if (locationDefault.length > 0) {\n                            this.purchaseDeposit.location = locationDefault[0];\n                        }\n                    }\n                }\n            } else if (roleType === 1) {\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        this.locations = [];\n                        locationHandler\n                            .list()\n                            .then((res) => {\n                                this.showLoading = true;\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    this.locations = res.data.data;\n                                    // if (this.locations.length > 0) {\n                                    //     this.purchaseDeposit.location = this.locations[0];\n                                    // }\n                                } else {\n                                    this.showLoading = false;\n                                }\n                            })\n                    }, 10);\n                });\n            }\n        },\n        async loadSegment() {\n            this.segments = []\n            const roleType = dataStore.roleType || 0\n            if (roleType === 0) {\n                if (dataStore.roleData) {\n                    const roleData = dataStore.roleData || []\n                    const segment = roleData.filter(itm => itm.type === 'segment')\n                    const segmentDefault = segment.filter(m => m.isDefault === 1)\n                    this.segments = segment\n                    if (this.$route.params.id === undefined || this.$route.params.id === '') {\n                        if (segmentDefault.length > 0) {\n                            this.purchaseDeposit.segment = segmentDefault[0];\n                        }\n                    }\n                }\n            } else if (roleType === 1) {\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        this.segments = [];\n                        settingsHandler\n                            .getSeg()\n                            .then((res) => {\n                                this.showLoading = true;\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    this.segments = res.data.data;\n                                } else {\n                                    this.showLoading = false;\n                                }\n                            })\n                    }, 10);\n                });\n            }\n        },\n        async loadPrefix() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    prefixHandler.get(\"purchase deposit\").then((res) => {\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false;\n                            this.transactionTypes = res.data.data;\n                            if (this.transactionTypes.length > 0) {\n                                this.purchaseDeposit.transactionType = this.transactionTypes[0];\n                                if (this.$route.params.id === undefined) {\n                                    this.generateNumber();\n                                }\n                            }\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async loadAccount() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    accountHandler.getAll().then((res) => {\n                        this.showLoading = false;\n                        this.accSupplierDeposit = res.data\n                            .filter((m) => m.account_type.number === 9)\n                            .map((item) => {\n                                return {\n                                    id: item.uuid,\n                                    uuid: item.uuid,\n                                    name: item.name,\n                                    local_name: item.local_name,\n                                    number: item.number,\n                                    is_taxable: item.is_taxable,\n                                    banhjiAccCode: item.banhjiAccCode,\n                                    group_code: item.group_code,\n                                    parent_account: item.parent_account,\n                                    type_code: item.type_code,\n                                    account_type: item.account_type,\n                                };\n                            });\n                        this.accCash = res.data\n                            .filter((m) => m.account_type.number <= 5)\n                            .map((item) => {\n                                return {\n                                    id: item.uuid,\n                                    uuid: item.uuid,\n                                    name: item.name,\n                                    local_name: item.local_name,\n                                    number: item.number,\n                                    is_taxable: item.is_taxable,\n                                    banhjiAccCode: item.banhjiAccCode,\n                                    group_code: item.group_code,\n                                    parent_account: item.parent_account,\n                                    type_code: item.type_code,\n                                    account_type: item.account_type,\n                                };\n                            });\n                        if (this.accSupplierDeposit.length > 0) {\n                            this.purchaseDeposit.accReceivable = this.accSupplierDeposit[0];\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async loadPurchaseOrders() {\n            if (this.supplier) {\n                this.showLoading = true;\n                this.purchaseOrders = [];\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        let data = {\n                            method: \"by_supplier\",\n                            supplier: this.supplier.id,\n                            type: \"Purchase Order\",\n                        };\n                        saleOrderHandler.search(data).then((res) => {\n                            this.showLoading = false;\n                            const response = res.data.data;\n                            response.forEach((m) => {\n                                const poData = m.txnData;\n                                this.purchaseOrders.push({\n                                    id: m.id,\n                                    amount: m.total,\n                                    number: m.number,\n                                    currency: poData.currency,\n                                    decimalFormat: m.decimalFormat,\n                                    location: poData.location,\n                                    segment: poData.segment,\n                                });\n                            });\n                            // window.console.log(this.purchaseOrders,'purchase')\n                        });\n                    }, 10);\n                });\n            }\n        },\n        rowNumberTmpl(dataItem) {\n            let ds = this.$refs.purchaseDepositDS.kendoWidget(),\n                index = ds.indexOf(dataItem);\n            return index + 1;\n        },\n        addRow() {\n            let ds = this.$refs.purchaseDepositDS.kendoWidget(),\n                total = ds.total();\n            this.itemLine.id = itemLinePrefix + uuid.v1();\n            this.itemLine.decimalFormat = this.decimalFormat;\n            this.itemLine.optionType = OPTION_TYPE;\n            ds.insert(total, this.itemLine);\n            // this.itemLines.push(this.itemLine)\n            // this.itemLines.push(this.itemLine)a\n            // window.console.log('item Line', this.itemLine)\n        },\n        async loadPaymentOption() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    this.paymentMethod = [];\n                    paymentOptionHandler\n                        .list(strFilter)\n                        .then((res) => {\n                            if (res.data.statusCode === 200) {\n                                this.showLoading = false;\n                                this.paymentMethod = res.data.data;\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 10);\n            });\n        },\n        async loadCurrencyData() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    currencyHandler\n                        .list(\"fun-c\")\n                        .then((response) => {\n                            if (response.data.statusCode === 200) {\n                                this.currencyList = response.data.data.filter(\n                                    (o) => o.used === 1\n                                );\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 10);\n            });\n        },\n        async loadTransactionRate() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const date = new Date(this.transactionDate)\n                        .toISOString()\n                        .substr(0, 10);\n                    const currency = this.purchaseDeposit.currency;\n                    let code = \"\";\n                    if (currency.hasOwnProperty(\"code\")) {\n                        code = currency.code;\n                    }\n\n                    if (code !== undefined || code !== \"\") {\n                        this.showLoading = true;\n                        currencyHandler\n                            .getLastExchangeRateByDate(date, code)\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    const response = res.data.data[0];\n                                    this.purchaseDeposit.exchangeRate = response;\n                                    this.purchaseDeposit.txnRate = response.rate;\n                                    this.showLoading = false;\n                                }\n                            });\n                    }\n                }, 10);\n            });\n        },\n        autoCalculate() {\n            let ds = this.$refs.purchaseDepositDS.kendoWidget(),\n                convertedAmount = 0,\n                amount = 0;\n            ds.data().forEach((value) => {\n                if (value.amount) {\n                    amount += kendo.parseFloat(value.amount);\n                    convertedAmount +=\n                        kendo.parseFloat(value.amount) * this.purchaseDeposit.txnRate;\n                }\n            });\n            window.console.log(amount, \"amount\");\n            this.purchaseDeposit.exchangeAmount = convertedAmount;\n            this.purchaseDeposit.amount = amount;\n        },\n        dataSourceChanged(e) {\n            if (e.field) {\n                let dataRow = e.items[0], pOption = {}\n                switch (e.field) {\n                    case \"paymentOption\":\n                        pOption = dataRow.paymentOption || {}\n                        dataRow.set(\"account\", pOption.account || {});\n                        break;\n                    default:\n                        break;\n                }\n                if (e.field) {\n                    this.autoCalculate();\n                }\n            }\n        },\n        async onSaveClose(flag) {\n            if (!this.$refs.form.validate()) {\n                this.$refs.form.validate();\n                return;\n            }\n            let id = \"\";\n            if (this.supplier.hasOwnProperty(\"id\")) {\n                id = this.supplier.id || \"\";\n            }\n            if (id === \"\") {\n                this.$snotify.error(\"supplier is require\");\n                return;\n            }\n            let ds = this.$refs.purchaseDepositDS.kendoWidget();\n            let d1 = ds.data();\n            let dataValidate = 0;\n            d1.forEach((value, index) => {\n                window.console.log(1, value);\n                if (\n                    value.account == undefined ||\n                    value.account.id == undefined ||\n                    value.account.id == null\n                ) {\n                    this.$snotify.error(\"Please check Account  on row \" + (index + 1));\n                } else {\n                    dataValidate += 1;\n                }\n            });\n            if (d1.length == dataValidate) {\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        let itemLineDS = this.$refs.purchaseDepositDS.kendoWidget();\n                        const dataRow = itemLineDS.data().filter((n) => n.amount > 0).map(m => {\n                            return new ItemLineModel(m)\n                        });\n                        // window.console.log(1, dataRow);\n                        if (dataRow.length > 0) {\n                            let isAutoGenerate = 1;\n                            if (this.$route.params.id) {\n                                const tranDate = new Date(this.transactionDate);\n                                const tranDateReceipt = new Date(\n                                    this.purchaseDeposit.transactionDate\n                                );\n                                const tranDateM = tranDate.getFullYear() + tranDate.getMonth();\n                                const tranDateReceiptM =\n                                    tranDateReceipt.getFullYear() + tranDateReceipt.getMonth();\n                                if (tranDateM === tranDateReceiptM) {\n                                    isAutoGenerate = 0;\n                                }\n                            }\n                            let data = {\n                                id: this.purchaseDeposit.id ? this.purchaseDeposit.id : \"\",\n                                type: \"Purchase Deposit\",\n                                uuid: this.purchaseDeposit.uuid\n                                    ? this.purchaseDeposit.uuid\n                                    : \"\",\n                                journal_uuid: this.purchaseDeposit.journal_uuid\n                                    ? this.purchaseDeposit.journal_uuid\n                                    : \"\",\n                                number: this.purchaseDeposit.number,\n                                abbr: this.purchaseDeposit.transactionType.abbr,\n                                transactionDate: this.transactionDate,\n                                supplier: this.supplier,\n                                transactionType: this.purchaseDeposit.transactionType,\n                                itemLine: dataRow,\n                                transactionNote: this.purchaseDeposit.transactionNote,\n                                journalNote: this.purchaseDeposit.journalNote,\n                                referenceNo: this.purchaseDeposit.referenceNo,\n                                amount: this.purchaseDeposit.amount,\n                                currency: this.purchaseDeposit.currency,\n                                exchangeAmount: this.purchaseDeposit.exchangeAmount, // amount to base currency\n                                txnRate: this.purchaseDeposit.txnRate,\n                                purchaseDepositAcc: this.purchaseDeposit.purchaseDepositAcc,\n                                exchangeRate: this.purchaseDeposit.exchangeRate,\n                                segment: this.purchaseDeposit.segment,\n                                location: this.purchaseDeposit.location,\n                                purchaseOrder: this.purchaseDeposit.purchaseOrder,\n                                status: 1,\n                                approvedBy: this.purchaseDeposit.approvedBy,\n                                rejectedBy: this.purchaseDeposit.rejectedBy,\n                                formTemplate: {},\n                                createdAt: this.purchaseDeposit.createdAt,\n                                loggedUser: this.loggedUser,\n                                refFrom: this.purchaseDeposit.refFrom || [],\n                                refTo: this.purchaseDeposit.refTo || [],\n                                isAutoGenerate: isAutoGenerate,\n                                actionType: this.$route.params.id\n                                    ? this.$route.query.type\n                                    : \"new\",\n                            };\n                            this.showLoading = true;\n                            // window.console.log('data', JSON.stringify(data))\n                            billingHandler.createPurchaseDeposit(data).then((response) => {\n                                if (response.data.statusCode === 201) {\n                                    this.showLoading = false;\n                                    this.$snotify.success(\"Successfully\");\n                                    if (flag === \"close\") {\n                                        this.clear();\n                                        this.close();\n                                    } else if (flag === \"new\") {\n                                        this.clear();\n                                    }\n                                }\n                            }).catch((e) => {\n                                this.showLoading = false;\n                                this.$snotify.error(\"Something went wrong\");\n                                this.errors.push(e);\n                            });\n                        }\n                    }, 10);\n                });\n            }\n        },\n        async loadCustomerBalance(id) {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const strFilter = id + \"?type=dep\";\n                    this.depositBalance = 0;\n                    // this.currencyCode = ''\n                    billingHandler\n                        .balance(strFilter)\n                        .then((res) => {\n                            if (res.data.statusCode === 200) {\n                                const data = res.data.data;\n                                if (data.length > 0) {\n                                    this.depositBalance = data[0].balance;\n                                    this.currencyCode = \" \" + data[0].currency;\n                                }\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 10);\n            });\n        },\n        async loadViewDeposit() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    if (this.$route.params.id) {\n                        this.showLoading = true;\n                        const strFilter = \"?id=\" + this.$route.params.id;\n                        billingHandler\n                            .purchaseDepositList(strFilter)\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n\n                                    this.purchaseDeposit = res.data.data[0];\n                                    this.loadPurchaseOrders();\n\n                                    this.decimalFormat = this.purchaseDeposit.decimalFormat;\n                                    this.depositLine = this.purchaseDeposit.itemLines;\n                                    this.supplier = this.purchaseDeposit.supplier;\n                                    this.loadCustomerBalance(this.supplier.id);\n                                    this.transactionDate = this.purchaseDeposit.transactionDate;\n\n                                    // this.onChange(this)\n                                    // this.numberFormat(this.saleDeposit.purchaseOrder, 'amount')\n                                    // this.numberFormat(this.saleDeposit.purchaseOrder, 'currency')\n                                    // this.purchaseOrders = this.saleDeposit.purchaseOrder\n                                }\n                            })\n                            .catch();\n                        {\n                            this.showLoading = false;\n                        }\n                    }\n                }, 10);\n            });\n        },\n        async initData() {\n            if (this.$route.params.id !== undefined) {\n                await this.loadViewDeposit();\n            } else {\n                this.addRow();\n            }\n        },\n        reload() {\n            if (this.$route.params.id !== undefined) {\n                this.loadViewDeposit()\n            } else {\n                this.clear()\n            }\n        }\n    },\n    created() {\n        this.loadAccount();\n        this.loadCurrencyData();\n    },\n    watch: {\n        // id() {\n        //   if (this.$route.params.id === undefined) {\n        //     this.clear();\n        //   } else {\n        //     this.showLoading = true;\n        //     this.loadViewDeposit();\n        //   }\n        // },\n        '$route': 'reload'\n    },\n    mounted: async function () {\n        await this.loadPrefix();\n        await this.loadLocation();\n        await this.loadSegment();\n        await this.loadPaymentOption();\n        this.requestData(0, this.filter, this.cusBaseUrl);\n        await this.initData();\n    },\n    computed: {\n        disableMe() {\n            return !!this.$route.params.id;\n        },\n        amountLineHeaderTemplate() {\n            if (this.purchaseDeposit) {\n                // window.console.log(this.purchaseDeposit.currency)\n                if (this.purchaseDeposit.hasOwnProperty(\"currency\")) {\n                    const currency = this.purchaseDeposit.currency.hasOwnProperty(\"code\")\n                        ? this.purchaseDeposit.currency.code\n                        : \"\";\n                    if (currency) {\n                        return \"Amount (\" + currency + \")\";\n                    } else {\n                        return \"Amount\";\n                    }\n                }\n            }\n            return \"Amount\";\n        },\n        // segment() {\n        //   if (this.purchaseDeposit) {\n        //     if (this.purchaseDeposit.purchaseOrder) {\n        //       if (this.purchaseDeposit.purchaseOrder.hasOwnProperty('segment')) {\n        //         if (this.purchaseDeposit.purchaseOrder.hasOwnProperty('id')) {\n        //           return this.purchaseDeposit.purchaseOrder.segment.name\n        //         }\n        //       }\n        //     }\n        //   }\n        //   return ''\n        // },\n        // location() {\n        //   if (this.purchaseDeposit) {\n        //     if (this.purchaseDeposit.purchaseOrder) {\n        //       if (this.purchaseDeposit.purchaseOrder.hasOwnProperty('location')) {\n        //         if (this.purchaseDeposit.purchaseOrder.location.hasOwnProperty('id')) {\n        //           return this.purchaseDeposit.purchaseOrder.location.name\n        //         }\n        //       }\n        //     }\n        //   }\n        //   return ''\n        // },\n        validSupplier() {\n            let supplier = this.supplier;\n            return supplier.id !== undefined && supplier.id !== null;\n        },\n        hiddenButton() {\n            if (this.$route.params.id) {\n                return true\n            } else {\n                return false\n            }\n        }\n    },\n};\n</script>\n\n<style scoped>\n.theme--light.v-data-table\n> .v-data-table__wrapper\n> table\n> tbody\n> tr:hover:not(.v-data-table__expanded__content):not(.v-data-table__empty-wrapper) {\n    background-color: transparent !important;\n}\n\n.hide_small_bar_class {\n    max-width: 0;\n    transition: 0.5s ease-in;\n    flex: 0 0 0;\n}\n\n.hide_big_bar_class {\n    max-width: 100%;\n    transition: 0.5s ease-in;\n    flex: 0 0 100%;\n}\n\n.small_sidebar {\n    height: 96%;\n    position: relative;\n    padding: 12px;\n    background-color: #edf1f5;\n}\n\n.iconArrow {\n    right: -35px;\n    position: absolute;\n    bottom: -10px;\n}\n\n.iconArrowHide {\n    position: absolute;\n    right: -7px;\n    bottom: -10px;\n}\n\n.detial_smallside_p {\n    position: absolute;\n    bottom: 12px;\n}\n\n.v-data-table__wrapper td {\n    border-bottom: 1px solid #808080;\n    border-top: 1px solid #808080;\n}\n\nelement.style {\n}\n\n.v-list-item .v-list-item__title,\n.v-list-item .v-list-item__subtitle {\n    line-height: 1.2;\n}\n</style>\n"]}]}