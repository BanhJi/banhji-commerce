{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/products/product/inventory_adjustment/InventoryAdjustment.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/products/product/inventory_adjustment/InventoryAdjustment.vue","mtime":1639364469154},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8vIGltcG9ydCBrZW5kbyBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tdWknCmltcG9ydCB7aTE4bn0gZnJvbSAiQC9pMThuIjsKaW1wb3J0IEludmVudG9yeUFkanVzdG1lbnQgZnJvbSAiQC9zY3JpcHRzL21vZGVsL2ludmVudG9yeUFkanVzdG1lbnQiOwppbXBvcnQge1Nob3dSZXNvdXJjZX0gZnJvbSAiQC9vYnNlcnZhYmxlL3N0b3JlIjsKaW1wb3J0IHt1dWlkfSBmcm9tICJ2dWUtdXVpZCI7CmltcG9ydCBrZW5kbyBmcm9tICJAcHJvZ3Jlc3Mva2VuZG8tdWkiOwppbXBvcnQgU2FsZUZvcm1Db250ZW50TW9kZWwgZnJvbSAiQC9zY3JpcHRzL21vZGVsL1NhbGVGb3JtQ29udGVudCI7CmltcG9ydCBJdGVtTGluZU1vZGVsIGZyb20gIkAvc2NyaXB0cy9pbnZlbnRvcnktYWRqdXN0bWVudC9tb2RlbC9JdGVtTGluZSI7Ci8vIGltcG9ydCB7IERyb3BEb3duTGlzdCB9IGZyb20gIkBwcm9ncmVzcy9rZW5kby12dWUtZHJvcGRvd25zIjsKCmNvbnN0IGFjY291bnRIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2hhbmRsZXIvYWNjb3VudGluZy9hY2NvdW50Iik7CmNvbnN0IGJpbGxpbmdIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2ludm9pY2UvaGFuZGxlci9iaWxsaW5nSGFuZGxlciIpOwpjb25zdCBwcmVmaXhIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3ByZWZpeEhhbmRsZXIiKTsKY29uc3Qgd2FyZWhvdXNlSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy93YXJlaG91c2VIYW5kbGVyIik7CmNvbnN0IHNldHRpbmdzSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9zZXR0aW5nc0hhbmRsZXIiKTsKY29uc3QgbG9jYXRpb25IYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2xvY2F0aW9uSGFuZGxlciIpOwpjb25zdCBwcm9qZWN0SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9wcm9qZWN0SGFuZGxlciIpOwpjb25zdCBwcm9kdWN0VmFyaWFudEhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvcHJvZHVjdFZhcmlhbnRIYW5kbGVyIik7CmNvbnN0IHNhbGVGb3JtQ29udGVudEhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvc2FsZUZvcm1Db250ZW50SGFuZGxlciIpOwpjb25zdCBzYWxlRm9ybUNvbnRlbnRNb2RlbCA9IG5ldyBTYWxlRm9ybUNvbnRlbnRNb2RlbCh7fSk7CmNvbnN0IGN1cnJlbmN5SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9jdXJyZW5jeS9oYW5kbGVyL2N1cnJlbmN5SGFuZGxlciIpOwoKY29uc3QgaXRlbUxpbmVNb2RlbCA9IG5ldyBJdGVtTGluZU1vZGVsKHt9KTsKY29uc3QgcHJlZml4ID0gImludmVudG9yeSBhZGp1c3RtZW50IjsKY29uc3QgdHhuVHlwZSA9ICJJbnZlbnRvcnkgQWRqdXN0bWVudCI7CmNvbnN0IGl0ZW1MaW5lUHJlZml4ID0gImxpbi0iOwpjb25zdCAkID0ga2VuZG8ualF1ZXJ5Cgpjb25zdCBjb29raWVKUyA9IHJlcXVpcmUoIkAvY29va2llLmpzIik7CmNvbnN0IGNvb2tpZSA9IGNvb2tpZUpTLmdldENvb2tpZSgpOwoKZXhwb3J0IGRlZmF1bHQgewogICAgbmFtZTogIkludmVudG9yeUFkanVzdG1lbnQiLAogICAgY29tcG9uZW50czogewogICAgICAgIExvYWRpbmdNZTogKCkgPT4gaW1wb3J0KGBAL2NvbXBvbmVudHMvTG9hZGluZ2ApLAogICAgICAgICJhcHAtZGF0ZXBpY2tlciI6ICgpID0+IGltcG9ydCgiQC9jb21wb25lbnRzL2N1c3RvbV90ZW1wbGF0ZXMvRGF0ZVBpY2tlckNvbXBvbmVudCIpLAogICAgICAgICJhcHAtbW9udGhwaWNrZXIiOiAoKSA9PiBpbXBvcnQoIkAvY29tcG9uZW50cy9rZW5kb190ZW1wbGF0ZXMvTW9udGhPZlBpY2tlciIpLAogICAgICAgIC8vIGRyb3Bkb3dubGlzdDogRHJvcERvd25MaXN0LAogICAgfSwKICAgIHByb3BzOiBbImlkIl0sCiAgICBkYXRhOiAoKSA9PiAoewogICAgICAgIGlzRWRpdDogZmFsc2UsCiAgICAgICAgLy8gTG9hZGluZ01lCiAgICAgICAgc2hvd0xvYWRpbmc6IHRydWUsCiAgICAgICAgYWxlcnQ6IGZhbHNlLAogICAgICAgIHZhbGlkOiB0cnVlLAogICAgICAgIHRlbXBsYXRlczogWwogICAgICAgICAgICB7dGl0bGU6ICJEcmFmdCJ9LAogICAgICAgICAgICB7dGl0bGU6ICJPcGVuIn0sCiAgICAgICAgICAgIHt0aXRsZTogIlBhcnRpYWxseSBDbG9zZWQifSwKICAgICAgICAgICAge3RpdGxlOiAiQ2xvc2VkIn0sCiAgICAgICAgXSwKICAgICAgICBpc0hpZGVCYXI6IGZhbHNlLAogICAgICAgIGFjY291bnRzOiBbXSwKICAgICAgICBzZWdtZW50czogW10sCiAgICAgICAgbG9jYXRpb25zOiBbXSwKICAgICAgICBwcm9qZWN0czogW10sCiAgICAgICAgd2FyZWhvdXNlczogW10sCiAgICAgICAgYnVvbTogW10sCiAgICAgICAgaXRlbUxpbmVzOiBbXSwKICAgICAgICBiYXNlQ3VycmVuY3k6IHt9LAogICAgICAgIGV4Y2hhbmdlUmF0ZToge30sCiAgICAgICAgc2FsZUZvcm1Db250ZW50OiBzYWxlRm9ybUNvbnRlbnRNb2RlbCwKICAgICAgICBpbnZlbnRvcnlBZGp1c3RtZW50OiBuZXcgSW52ZW50b3J5QWRqdXN0bWVudCh7fSksCiAgICAgICAgaXRlbUxpbmU6IGl0ZW1MaW5lTW9kZWwsCiAgICAgICAgdHJhbnNhY3Rpb25EYXRlOiAiIiwKICAgICAgICBqUmF3OiBbXSwKICAgICAgICBkcjogMCwKICAgICAgICBjcjogMCwKICAgICAgICBsb2dnZWRVc2VyOiB7CiAgICAgICAgICAgIGlkOiBjb29raWUuY3JlYXRvciwKICAgICAgICAgICAgbmFtZTogY29va2llLmVtYWlsLAogICAgICAgIH0sCiAgICAgICAgc3RvY2tDb3VudHM6IFtdCiAgICB9KSwKICAgIG1ldGhvZHM6IHsKICAgICAgICBudW1iZXJGb3JtYXQodmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIGtlbmRvLnRvU3RyaW5nKHZhbHVlLCBgbiR7dGhpcy5zYWxlRm9ybUNvbnRlbnQuZGVjaW1hbH1gKTsKICAgICAgICB9LAogICAgICAgIG9uVHJhbnNhY3Rpb25EYXRlQ2hhbmdlZCgpIHsKICAgICAgICAgICAgLy8gdGhpcy5yZXNldERhdGFXaGVuVHhuRGF0ZUNoYW5nZWQoKQogICAgICAgICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVOdW1iZXIoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmludmVudG9yeUFkanVzdG1lbnQubW9udGhPZiA9IG5ldyBEYXRlKAogICAgICAgICAgICAgICAgdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LnRyYW5zYWN0aW9uRGF0ZQogICAgICAgICAgICApCiAgICAgICAgICAgICAgICAudG9JU09TdHJpbmcoKQogICAgICAgICAgICAgICAgLnN1YnN0cigwLCA3KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGluaXREYXRhKCkgewogICAgICAgICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMubG9hZFZpZXdBZGp1c3RtZW50KCk7CiAgICAgICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coJzEnLCB0aGlzLiRyb3V0ZS5wYXJhbXMpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLmFkZFJvdygpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkU2FsZUZvcm1Db250ZW50KCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBzYWxlRm9ybUNvbnRlbnRIYW5kbGVyLmxpc3QoKS50aGVuKGFzeW5jIChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYWxlRm9ybUNvbnRlbnQgPSBkYXRhWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYmFzZUN1cnJlbmN5ID0gZGF0YVswXS5iYXNlQ3VycmVuY3k7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LmN1cnJlbmN5ID0gdGhpcy5iYXNlQ3VycmVuY3k7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5pbml0RGF0YSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMubG9hZFRyYW5zYWN0aW9uUmF0ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFRyYW5zYWN0aW9uUmF0ZSgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC50cmFuc2FjdGlvbkRhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgIC50b0lTT1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWJzdHIoMCwgMTApOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbmN5ID0gdGhpcy5iYXNlQ3VycmVuY3k7CiAgICAgICAgICAgICAgICAgICAgbGV0IGNvZGUgPSAiIjsKICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVuY3kuaGFzT3duUHJvcGVydHkoImNvZGUiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb2RlID0gY3VycmVuY3kuY29kZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGNvZGUgIT09IHVuZGVmaW5lZCB8fCBjb2RlICE9PSAiIikgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lIYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0TGFzdEV4Y2hhbmdlUmF0ZUJ5RGF0ZShkYXRlLCBjb2RlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV4Y2hhbmdlUmF0ZSA9IHJlcy5kYXRhLmRhdGFbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC50eG5SYXRlID0gdGhpcy5leGNoYW5nZVJhdGUucmF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LmV4Y2hhbmdlUmF0ZSA9IHRoaXMuZXhjaGFuZ2VSYXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGl0ZW1UZW1wbGF0ZShkYXRhSXRlbSkgewogICAgICAgICAgICBjb25zdCBpdGVtID0gZGF0YUl0ZW0uaXRlbTsKICAgICAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBgPHNwYW4+JHtpdGVtLm5hbWUgPyBpdGVtLm5hbWUgOiBgYH08L3NwYW4+YDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBgYDsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgSXRlbURyb3BEb3duRWRpdG9yKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgICAgICBrZW5kbwogICAgICAgICAgICAgICAgLmpRdWVyeSgnPGlucHV0IG5hbWU9IicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHsKICAgICAgICAgICAgICAgICAgICBhdXRvQmluZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiAiY29udGFpbnMiLAogICAgICAgICAgICAgICAgICAgIGRhdGFUZXh0RmllbGQ6ICJuYW1lIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogImlkIiwKICAgICAgICAgICAgICAgICAgICBoZWFkZXJUZW1wbGF0ZToKICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9ImRyb3Bkb3duLWhlYWRlciBrLXdpZGdldCBrLWhlYWRlciI+JyArCiAgICAgICAgICAgICAgICAgICAgICAgICI8c3Bhbj5JdGVtcyA8L3NwYW4+IiArCiAgICAgICAgICAgICAgICAgICAgICAgICI8c3Bhbj48L3NwYW4+IiArCiAgICAgICAgICAgICAgICAgICAgICAgICI8L2Rpdj4iLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAiPHNwYW4+Iz1uYW1lIzwvc3Bhbj4iLAogICAgICAgICAgICAgICAgICAgIG9wdGlvbkxhYmVsOiAiLS0tIFNlbGVjdCAtLS0iLAogICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IG5ldyBrZW5kby5kYXRhLkRhdGFTb3VyY2UoewogICAgICAgICAgICAgICAgICAgICAgICBzZXJ2ZXJGaWx0ZXJpbmc6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zcG9ydDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogcHJvZHVjdFZhcmlhbnRIYW5kbGVyLml0ZW1WYXJpYW50U2VhcmNoVVJMKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAiaWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDoge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZToge3R5cGU6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2t1OiB7dHlwZTogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhLmNvdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgcW9oVGVtcGxhdGUoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgLy8gY29uc3QgYnVvbSA9IGRhdGFJdGVtLmJ1b20gfHwge30KICAgICAgICAgICAgY29uc3QgcW9oID0gZGF0YUl0ZW0ucW9oIHx8IDA7CiAgICAgICAgICAgIC8vIGlmIChidW9tLmhhc093blByb3BlcnR5KCduYW1lJykpIHsKICAgICAgICAgICAgcmV0dXJuIHFvaDsKICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAvLyByZXR1cm4gYGAKICAgICAgICB9LAogICAgICAgIFVPTVRlbXBsYXRlKGRhdGFJdGVtKSB7CiAgICAgICAgICAgIGNvbnN0IHVvbSA9IGRhdGFJdGVtLmJ1b207CiAgICAgICAgICAgIGlmICh1b20pIHsKICAgICAgICAgICAgICAgIHJldHVybiBgPHNwYW4+JHt1b20ubmFtZSA/IHVvbS5uYW1lIDogYGB9PC9zcGFuPmA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYGA7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIG51bWJlckVkaXRvcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAga2VuZG8KICAgICAgICAgICAgICAgIC5qUXVlcnkoJzxpbnB1dCBkYXRhLWJpbmQ9InZhbHVlOicgKyBvcHRpb25zLmZpZWxkICsgJyIvPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKQogICAgICAgICAgICAgICAgLmtlbmRvTnVtZXJpY1RleHRCb3goewogICAgICAgICAgICAgICAgICAgIGRlY2ltYWxzOiAzMCwKICAgICAgICAgICAgICAgICAgICBtaW46IDAsCiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBgJHt0aGlzLnNhbGVGb3JtQ29udGVudC5kZWNpbWFsfWAsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIHJvd051bWJlclRtcGwoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5pdGVtTGluZURTLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICBpbmRleCA9IGRzLmluZGV4T2YoZGF0YUl0ZW0pOwogICAgICAgICAgICByZXR1cm4gaW5kZXggKyAxOwogICAgICAgIH0sCiAgICAgICAgYWRkUm93KCkgewogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLml0ZW1MaW5lRFMua2VuZG9XaWRnZXQoKSwKICAgICAgICAgICAgICAgIHRvdGFsID0gZHMudG90YWwoKTsKICAgICAgICAgICAgdGhpcy5pdGVtTGluZS5pZCA9IGl0ZW1MaW5lUHJlZml4ICsgdXVpZC52MSgpOwogICAgICAgICAgICB0aGlzLml0ZW1MaW5lLmRlY2ltYWxGb3JtYXQgPSAibiIgKyB0aGlzLnNhbGVGb3JtQ29udGVudC5kZWNpbWFsOwogICAgICAgICAgICBkcy5pbnNlcnQodG90YWwsIHRoaXMuaXRlbUxpbmUpOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgZGF0YVNvdXJjZUNoYW5nZWQoZSkgewogICAgICAgICAgICBpZiAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgbGV0IGRhdGFSb3cgPSBlLml0ZW1zWzBdLCBpdGVtVHlwZSA9ICcnLAogICAgICAgICAgICAgICAgICAgIGJ1b20gPSB7fSwKICAgICAgICAgICAgICAgICAgICBjb3VudCA9IDAsCiAgICAgICAgICAgICAgICAgICAgZGlmZiA9IDAsCiAgICAgICAgICAgICAgICAgICAgcW9oID0gMDsKICAgICAgICAgICAgICAgIHN3aXRjaCAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgIml0ZW0iOgogICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiZGVzY3JpcHRpb24iLCBkYXRhUm93Lml0ZW0uZGVzY3JpcHRpb24pOwogICAgICAgICAgICAgICAgICAgICAgICBidW9tID0gZGF0YVJvdy5pdGVtLnVvbTsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoImJ1b20iLCBidW9tKTsKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVR5cGUgPSBkYXRhUm93Lml0ZW0udHlwZSB8fCAnJwogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnNlYXJjaFRyYW5zYWN0aW9uKGRhdGFSb3csIGRhdGFSb3cuaXRlbS5pZCwgaXRlbVR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJjb3VudCI6CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudCA9IHBhcnNlRmxvYXQoZGF0YVJvdy5jb3VudCB8fCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFvaCA9IHBhcnNlRmxvYXQoZGF0YVJvdy5xb2ggfHwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWZmID0gY291bnQgLSBxb2g7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiZGlmZmVyZW50IiwgcGFyc2VGbG9hdChkaWZmKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYW1vdW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUZsb2F0KGRhdGFSb3cuY29zdCkgKiBwYXJzZUZsb2F0KGRpZmYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJkaWZmZXJlbnQiLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJhbW91bnQiLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJjb3N0IjoKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZmYgPSBwYXJzZUZsb2F0KGRhdGFSb3cuZGlmZmVyZW50IHx8IDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVJvdy5zZXQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFtb3VudCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VGbG9hdChkYXRhUm93LmNvc3QpICogcGFyc2VGbG9hdChkaWZmKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiYW1vdW50IiwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZS5maWVsZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpOwogICAgICAgICAgICAgICAgICAgIC8vIHRoaXMucmF3Rm9ySm91cm5hbCgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGF1dG9DYWxjdWxhdGUoKSB7CiAgICAgICAgICAgIGxldCBkcyA9IHRoaXMuJHJlZnMuaXRlbUxpbmVEUy5rZW5kb1dpZGdldCgpOwogICAgICAgICAgICBsZXQgbmF0dXJlID0gIiIsCiAgICAgICAgICAgICAgICBhbW91bnQgPSAwLAogICAgICAgICAgICAgICAgcXR5ID0gMDsKICAgICAgICAgICAgdGhpcy5qUmF3ID0gW107CiAgICAgICAgICAgIGNvbnN0IHJvd3MgPSBkcy5kYXRhKCk7CiAgICAgICAgICAgIHJvd3MuZm9yRWFjaCgodmFsdWUpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGFtdCA9IGtlbmRvLnBhcnNlRmxvYXQodmFsdWUuYW1vdW50KTsKICAgICAgICAgICAgICAgIGNvbnN0IGRpZmYgPSBrZW5kby5wYXJzZUZsb2F0KHZhbHVlLmRpZmZlcmVudCk7CiAgICAgICAgICAgICAgICBhbW91bnQgKz0gYW10OwogICAgICAgICAgICAgICAgcXR5ICs9IGRpZmY7CiAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gdmFsdWUuaXRlbTsKICAgICAgICAgICAgICAgIGlmIChhbXQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgbmF0dXJlID0gImRyIjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbmF0dXJlID0gImNyIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0udHlwZSA9PT0gIlZhcmlhbnQiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmhhc093blByb3BlcnR5KCJpbnZlbnRvcnlBY2MiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uaW52ZW50b3J5QWNjLmhhc093blByb3BlcnR5KCJpZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGludmVudG9yeUFjYyA9IGl0ZW0uaW52ZW50b3J5QWNjOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMualJhdy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGludmVudG9yeUFjYy5pZCArICItIiArIG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogbmV3IEl0ZW1MaW5lTW9kZWwodmFsdWUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogaXRlbS5kZXNjcmlwdGlvbiB8fCAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogaXRlbS5pbnZlbnRvcnlBY2MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRJZDogaXRlbS5pbnZlbnRvcnlBY2MuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogYW10LCAvLyBxdHkqYXZnX2Nvc3QgLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogYW10LCAvL3hBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZUFzOiAiaXRlbSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmludmVudG9yeUFkanVzdG1lbnQuYW1vdW50ID0gYW1vdW50OwogICAgICAgICAgICB0aGlzLmludmVudG9yeUFkanVzdG1lbnQuZXhjaGFuZ2VBbW91bnQgPSBhbW91bnQ7CiAgICAgICAgICAgIHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC5xdHkgPSBxdHk7CiAgICAgICAgICAgIC8vIGFkanVzdG1lbnQgYWNjb3VudAogICAgICAgICAgICBpZiAodGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LmFjY291bnQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFkanVzdEFjYyA9IHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC5hY2NvdW50OwogICAgICAgICAgICAgICAgaWYgKGFtb3VudCAqIC0xID4gMCkgewogICAgICAgICAgICAgICAgICAgIG5hdHVyZSA9ICJkciI7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG5hdHVyZSA9ICJjciI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLmpSYXcucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgaWQ6IGFkanVzdEFjYy5pZCArICItIiArIG5hdHVyZSwKICAgICAgICAgICAgICAgICAgICBsaW5lOiBuZXcgSXRlbUxpbmVNb2RlbCh7fSksCiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC5qb3VybmFsTm90ZSwKICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiBhZGp1c3RBY2MsCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudElkOiBhZGp1c3RBY2MuaWQsCiAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBhbW91bnQgKiAtMSwgLy8gcXR5KmF2Z19jb3N0ICwKICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogYW1vdW50ICogLTEsIC8veEFtb3VudCwKICAgICAgICAgICAgICAgICAgICB0eXBlOiBuYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgdHlwZUFzOiAiYWRqdXN0bWVudCBhY2MiLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gdG9kbzogcmF3IEpvdXJuYWwKICAgICAgICAgICAgLy8gY29uc3QgYWNjb3VudCA9IHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC5hY2NvdW50IHx8IHt9CiAgICAgICAgICAgIC8vIGlmICh0aGlzLmludmVudG9yeUFkanVzdG1lbnQuYW1vdW50RHVlID4gMCkgewogICAgICAgICAgICAvLyAgIG5hdHVyZSA9ICdkcicKICAgICAgICAgICAgLy8gfSBlbHNlIHsKICAgICAgICAgICAgLy8gICBuYXR1cmUgPSAnY3InCiAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgLy8gaWYgKGFjY291bnQpIHsKICAgICAgICAgICAgLy8gICBpZiAoYWNjb3VudC5oYXNPd25Qcm9wZXJ0eSgnaWQnKSkgewogICAgICAgICAgICAvLyAgICAgdGhpcy5qUmF3LnB1c2goewogICAgICAgICAgICAvLyAgICAgICBpZDogYWNjb3VudC5pZCArICctJyArIG5hdHVyZSwKICAgICAgICAgICAgLy8gICAgICAgbGluZTogbmV3IEl0ZW1MaW5lTW9kZWwoe30pLAogICAgICAgICAgICAvLyAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5pbnZvaWNlLmpvdXJuYWxOb3RlLAogICAgICAgICAgICAvLyAgICAgICBhY2NvdW50OiBhY2NvdW50LAogICAgICAgICAgICAvLyAgICAgICBhY2NvdW50SWQ6IGFjY291bnQuaWQsCiAgICAgICAgICAgIC8vICAgICAgIGV4Y2hhbmdlQW1vdW50OiB0aGlzLmludmVudG9yeUFkanVzdG1lbnQuZXhjaGFuZ2VBbW91bnQsCiAgICAgICAgICAgIC8vICAgICAgIGFtb3VudDogdGhpcy5pbnZvaWNlLmFtb3VudER1ZSwKICAgICAgICAgICAgLy8gICAgICAgdHlwZTogbmF0dXJlLAogICAgICAgICAgICAvLyAgICAgICB0eXBlQXM6ICdhcicKICAgICAgICAgICAgLy8gICAgIH0pCiAgICAgICAgICAgIC8vICAgfQogICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIC8vIHRvZG86IGVuZCByYXcgSm91cm5hbAogICAgICAgICAgICB0aGlzLnNocmlua0RhdGEodGhpcy5qUmF3KTsKICAgICAgICAgICAgLy8gY29uc3QgdW5pcXVlID0gdGhpcy5yZW1vdmVEdXBsaWNhdGUodGhpcy5hY2NvdW50cykKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKHVuaXF1ZSwgJ3VuaXF1ZScpCiAgICAgICAgfSwKICAgICAgICByZW1vdmVEdXBsaWNhdGUoYXJyYXkpIHsKICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gW107CiAgICAgICAgICAgIGNvbnN0IG1hcCA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGFycmF5KSB7CiAgICAgICAgICAgICAgICBpZiAoIW1hcC5oYXMoaXRlbS5pZCkpIHsKICAgICAgICAgICAgICAgICAgICBtYXAuc2V0KGl0ZW0uaWQsIHRydWUpOyAvLyBzZXQgYW55IHZhbHVlIHRvIE1hcAogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfSwKICAgICAgICBzaHJpbmtEYXRhKG9iaikgewogICAgICAgICAgICBjb25zdCB1bmlxdWVzID0KICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlRHVwbGljYXRlKG9iaik7IC8qWy4uLm5ldyBTZXQoYWNjb3VudElkLm1hcChpID0+IHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgaWRfOiBpLmlkXywKICAgICAgICAgICAgICAgICAgICBpZDogaS5pZCwKICAgICAgICAgICAgICAgICAgICB0eXBlOiBpLnR5cGUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkpXSovCiAgICAgICAgICAgIHVuaXF1ZXMuZm9yRWFjaCgobikgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZm91bmQgPSBvYmouZmlsdGVyKChtKSA9PiBtLmlkID09PSBuLmlkKTsKICAgICAgICAgICAgICAgIGxldCBhbW91bnQgPSAwLAogICAgICAgICAgICAgICAgICAgIHhBbW91bnQgPSAwOwogICAgICAgICAgICAgICAgZm91bmQuZm9yRWFjaCgoeikgPT4gewogICAgICAgICAgICAgICAgICAgIGFtb3VudCArPSBwYXJzZUZsb2F0KHouYW1vdW50IHx8IDApOwogICAgICAgICAgICAgICAgICAgIHhBbW91bnQgKz0gcGFyc2VGbG9hdCh6LmV4Y2hhbmdlQW1vdW50IHx8IDApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBuLmFtb3VudCA9IHBhcnNlRmxvYXQoYW1vdW50KTsgLy90aGlzLm51bWJlckZvcm1hdChhbW91bnQpCiAgICAgICAgICAgICAgICBuLmV4Y2hhbmdlQW1vdW50ID0gcGFyc2VGbG9hdCh4QW1vdW50KTsgLy9wYXJzZUZsb2F0KHBhcnNlRmxvYXQoYW1vdW50ICogcGFyc2VGbG9hdCh0aGlzLmludm9pY2UudHhuUmF0ZSkpKSAvL3RoaXMubnVtYmVyRm9ybWF0KGFtb3VudCAqIHBhcnNlRmxvYXQodGhpcy5pbnZvaWNlLnR4blJhdGUpKSAvLy50b0ZpeGVkKHRoaXMuc2FsZUZvcm1Db250ZW50LmRlY2ltYWwpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmpSYXcgPSB1bmlxdWVzOwogICAgICAgICAgICBsZXQgZHIgPSAwLAogICAgICAgICAgICAgICAgY3IgPSAwOwogICAgICAgICAgICB0aGlzLmpSYXcuZm9yRWFjaCgoaikgPT4gewogICAgICAgICAgICAgICAgc3dpdGNoIChqLnR5cGUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICJjciI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNyICs9IHBhcnNlRmxvYXQoai5hbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJkciI6CiAgICAgICAgICAgICAgICAgICAgICAgIGRyICs9IHBhcnNlRmxvYXQoai5hbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuZHIgPSBkcjsKICAgICAgICAgICAgdGhpcy5jciA9IGNyOwogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coImRyPSIsIGRyLCAiY3I9IiwgY3IsICJkcitjciA9ICIsIGRyICsgY3IpOwogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkodW5pcXVlcyksICJ1bmlxdWVzIik7CiAgICAgICAgfSwKICAgICAgICBIZWxwKGtleXdvcmRfc2VhcmNoKSB7CiAgICAgICAgICAgIFNob3dSZXNvdXJjZShrZXl3b3JkX3NlYXJjaCk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBzZWFyY2hUcmFuc2FjdGlvbihkYXRhUm93LCBpdGVtSWQsIGl0ZW1UeXBlKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC50cmFuc2FjdGlvbkRhdGU7CiAgICAgICAgICAgICAgICAgICAgbGV0IHN0ckZpbHRlciA9ICI/YXNPZj0iICsgc3RhcnREYXRlICsgIiZpZD0iICsgaXRlbUlkICsgJyZpdGVtVHlwZT0nICsgaXRlbVR5cGU7CiAgICAgICAgICAgICAgICAgICAgYmlsbGluZ0hhbmRsZXIuaW52ZW50b3J5QmFsYW5jZShzdHJGaWx0ZXIpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBiYWxhbmNlID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiYWxhbmNlLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgiY29zdCIsIGJhbGFuY2VbMF0ud2FjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhUm93LnNldCgicW9oIiwgYmFsYW5jZVswXS5xb2gpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYW1vdW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VGbG9hdChiYWxhbmNlWzBdLndhYykgKiBwYXJzZUZsb2F0KGRhdGFSb3cuZGlmZmVyZW50KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFSb3cuc2V0KCJjb3N0IiwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coImJhbGFuY2UiLCByZXMuZGF0YS5kYXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZEFjY291bnQoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIGFjY291bnRIYW5kbGVyLmdldEFsbCgpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWNjb3VudHMgPSByZXMuZGF0YS5tYXAoKGl0bSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogaXRtLnV1aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXVpZDogaXRtLnV1aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogaXRtLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxfbmFtZTogaXRtLmxvY2FsX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyOiBpdG0ubnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX3RheGFibGU6IGl0bS5pc190YXhhYmxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhbmhqaUFjY0NvZGU6IGl0bS5iYW5oamlBY2NDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwX2NvZGU6IGl0bS5ncm91cF9jb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudF9hY2NvdW50OiBpdG0ucGFyZW50X2FjY291bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZV9jb2RlOiBpdG0udHlwZV9jb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRfdHlwZTogaXRtLmFjY291bnRfdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5hY2NvdW50cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmludmVudG9yeUFkanVzdG1lbnQuYWNjb3VudCA9IHRoaXMuYWNjb3VudHNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkUHJvamVjdHMoKSB7CiAgICAgICAgICAgIGF3YWl0IHByb2plY3RIYW5kbGVyLmxpc3QoKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMucHJvamVjdHMgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgaWYgKHRoaXMucHJvamVjdHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC5wcm9qZWN0ID0gdGhpcy5wcm9qZWN0c1swXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkU2VnbWVudCgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWdtZW50cyA9IFtdOwogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzSGFuZGxlcgogICAgICAgICAgICAgICAgICAgICAgICAuZ2V0U2VnKCkKICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VnbWVudHMgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlZ21lbnRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LnNlZ21lbnQgPSB0aGlzLnNlZ21lbnRzWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLnNlZ21lbnRMaXN0ID0gcmVzLmRhdGEuZGF0YQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKTsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZExvY2F0aW9uKCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvY2F0aW9ucyA9IFtdOwogICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uSGFuZGxlcgogICAgICAgICAgICAgICAgICAgICAgICAubGlzdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvY2F0aW9ucyA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubG9jYXRpb25zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LmxvY2F0aW9uID0gdGhpcy5sb2NhdGlvbnNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKTsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFdhcmVob3VzZXMoKSB7CiAgICAgICAgICAgIHdhcmVob3VzZUhhbmRsZXIuZ2V0V2FyZWhvdXNlU2V0dGluZ0FsbCgpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgdGhpcy53YXJlaG91c2VzID0gcmVzOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRQcmVmaXgoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCJyZXNvbHZlZCIpOwogICAgICAgICAgICAgICAgICAgIGF3YWl0IHByZWZpeEhhbmRsZXIuZ2V0KHByZWZpeCkudGhlbihhc3luYyAocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb25UeXBlcyA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50cmFuc2FjdGlvblR5cGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmludmVudG9yeUFkanVzdG1lbnQudHJhbnNhY3Rpb25UeXBlID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvblR5cGVzWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmdlbmVyYXRlTnVtYmVyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgZ2VuZXJhdGVOdW1iZXIoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmludmVudG9yeUFkanVzdG1lbnQudHJhbnNhY3Rpb25EYXRlICE9PSAiIikgewogICAgICAgICAgICAgICAgbGV0IGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgYWJicjogdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LnRyYW5zYWN0aW9uVHlwZS5hYmJyLAogICAgICAgICAgICAgICAgICAgIHN0cnVjdHVyZTogdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LnRyYW5zYWN0aW9uVHlwZS5zdHJ1Y3R1cmUsCiAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25EYXRlOiB0aGlzLmludmVudG9yeUFkanVzdG1lbnQudHJhbnNhY3Rpb25EYXRlLAogICAgICAgICAgICAgICAgICAgIHNlcXVjZW5jaW5nOiB0aGlzLmludmVudG9yeUFkanVzdG1lbnQudHJhbnNhY3Rpb25UeXBlLnNlcXVjZW5jaW5nLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJJbnZlbnRvcnkgQWRqdXN0bWVudCIsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LmFiYnIgPSBkYXRhLmFiYnI7CiAgICAgICAgICAgICAgICB0aGlzLmludmVudG9yeUFkanVzdG1lbnQuc3RydWN0dXJlID0gZGF0YS5zdHJ1Y3R1cmU7CiAgICAgICAgICAgICAgICB0aGlzLmludmVudG9yeUFkanVzdG1lbnQuc2VxdWNlbmNpbmcgPSBkYXRhLnNlcXVjZW5jaW5nOwogICAgICAgICAgICAgICAgdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LnRyYW5zYWN0aW9uRGF0ZSA9IGRhdGEudHJhbnNhY3Rpb25EYXRlOwogICAgICAgICAgICAgICAgdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LnR5cGUgPSBkYXRhLnR5cGU7CiAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGF3YWl0IGJpbGxpbmdIYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgLmxhc3ROdW1iZXIoZGF0YSkKICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXMgPSByZXNwb25zZS5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXN0TnVtYmVyID0gdGhpcy56ZXJvUGFkKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlSW50KHJlcy5sYXN0TnVtYmVyKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmludmVudG9yeUFkanVzdG1lbnQudHJhbnNhY3Rpb25UeXBlLmZvcm1hdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC5udW1iZXIgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5zdWZmaXggKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC50cmFuc2FjdGlvblR5cGUubnVtYmVyU2VwYXJhdG9yICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0TnVtYmVyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50Lmxhc3ROdW1iZXIgPSByZXMuc3VmZml4ICsgbGFzdE51bWJlcjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUuZXJyb3IoZSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHplcm9QYWQobnVtLCBwbGFjZXMpIHsKICAgICAgICAgICAgcmV0dXJuIFN0cmluZyhudW0pLnBhZFN0YXJ0KHBsYWNlcywgIjAiKTsKICAgICAgICB9LAogICAgICAgIHNhdmVQcmludCgpIHsKICAgICAgICB9LAogICAgICAgIHNhdmVOZXcoKSB7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBvblNhdmVDbG9zZShpc1NhdmUpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLiRyZWZzLmZvcm0udmFsaWRhdGUoKSkgewogICAgICAgICAgICAgICAgdGhpcy4kcmVmcy5mb3JtLnZhbGlkYXRlKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCJtRW1wbG95ZWUiLCB0aGlzLmludmVudG9yeUFkanVzdG1lbnQuZW1wbG95ZWUpOwogICAgICAgICAgICBpZiAodGhpcy5tRW1wbG95ZWUuaWQgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpc0F1dG9HZW5lcmF0ZSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlID0gbmV3IERhdGUodGhpcy50cmFuc2FjdGlvbkRhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJhbkRhdGVBZGp1c3RtZW50ID0gbmV3IERhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LnRyYW5zYWN0aW9uRGF0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5EYXRlTSA9IHRyYW5EYXRlLmdldEZ1bGxZZWFyKCkgKyB0cmFuRGF0ZS5nZXRNb250aCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJhbkRhdGVUeG5NID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuRGF0ZUFkanVzdG1lbnQuZ2V0RnVsbFllYXIoKSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbkRhdGVBZGp1c3RtZW50LmdldE1vbnRoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJhbkRhdGVNID09PSB0cmFuRGF0ZVR4bk0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0F1dG9HZW5lcmF0ZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hdXRvQ2FsY3VsYXRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpdGVtTGluZURTID0gdGhpcy4kcmVmcy5pdGVtTGluZURTLmtlbmRvV2lkZ2V0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFSb3cgPSBpdGVtTGluZURTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZGF0YSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChvKSA9PiBvLmJ1b20gIT09IHt9IHx8IG8uYnVvbSAhPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKG8pID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEl0ZW1MaW5lTW9kZWwobyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFSb3cubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC5pZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC5pZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQ6IHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC51dWlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LnV1aWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb3VybmFsX3V1aWQ6IHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC5qb3VybmFsX3V1aWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyB0aGlzLmludmVudG9yeUFkanVzdG1lbnQuam91cm5hbF91dWlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogdHhuVHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC5udW1iZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJicjogdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LnRyYW5zYWN0aW9uVHlwZS5hYmJyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogdGhpcy50cmFuc2FjdGlvbkRhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9udGhPZjogdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50Lm1vbnRoT2YsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25UeXBlOiB0aGlzLmludmVudG9yeUFkanVzdG1lbnQudHJhbnNhY3Rpb25UeXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4blJhdGU6IHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC50eG5SYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlUmF0ZTogdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LmV4Y2hhbmdlUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LmN1cnJlbmN5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1MaW5lOiBkYXRhUm93LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnQ6IHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC5zZWdtZW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiB0aGlzLmludmVudG9yeUFkanVzdG1lbnQubG9jYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdDogdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LnByb2plY3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1wbG95ZWU6IHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC5lbXBsb3llZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbk5vdGU6IHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC50cmFuc2FjdGlvbk5vdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgam91cm5hbE5vdGU6IHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC5qb3VybmFsTm90ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiB0aGlzLmludmVudG9yeUFkanVzdG1lbnQuYWNjb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0OiB0aGlzLmludmVudG9yeUFkanVzdG1lbnQuY3JlYXRlZEF0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LmFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUFtb3VudDogdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LmV4Y2hhbmdlQW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF0eTogdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LnF0eSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZWRVc2VyOiB0aGlzLmxvZ2dlZFVzZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNBdXRvR2VuZXJhdGU6IGlzQXV0b0dlbmVyYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpSYXc6IHRoaXMualJhdywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25UeXBlOiB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyB0aGlzLiRyb3V0ZS5xdWVyeS50eXBlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogIm5ldyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaWxsaW5nSGFuZGxlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5pbnZlbnRvcnlBZGp1c3RtZW50KGRhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5zdWNjZXNzKCJTdWNjZXNzZnVsbHkiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc1NhdmUgPT0gIm5ldyIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzU2F2ZSA9PSAiY2xvc2UiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcigiU29tZXRoaW5nIHdlbnQgd3JvbmciKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvcnMucHVzaChlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBjbG9zZSgpIHsKICAgICAgICAgICAgd2luZG93Lmhpc3RvcnkuZ28oLTEpOwogICAgICAgIH0sCiAgICAgICAgY2xlYXIoKSB7CiAgICAgICAgICAgIHRoaXMubG9hZFByZWZpeCgpOwogICAgICAgICAgICB0aGlzLmxvYWRBY2NvdW50KCk7CiAgICAgICAgICAgIHRoaXMubG9hZFNlZ21lbnQoKTsKICAgICAgICAgICAgdGhpcy5sb2FkTG9jYXRpb24oKTsKICAgICAgICAgICAgdGhpcy5sb2FkUHJvamVjdHMoKTsKICAgICAgICAgICAgdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50ID0gbmV3IEludmVudG9yeUFkanVzdG1lbnQoe30pOwogICAgICAgICAgICBsZXQgZHMgPSB0aGlzLiRyZWZzLml0ZW1MaW5lRFMua2VuZG9XaWRnZXQoKTsKICAgICAgICAgICAgZHMuZGF0YShbXSk7CiAgICAgICAgICAgIHRoaXMuYWRkUm93KCk7CiAgICAgICAgfSwKICAgICAgICByZW1vdmVSb3coZSkgewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGNvbnN0IGdyaWQgPSBrZW5kby5qUXVlcnkoIiNncmlkSXRlbUxpbmUiKS5kYXRhKCJrZW5kb0dyaWQiKSwKICAgICAgICAgICAgICAgIGRhdGFTb3VyY2UgPSBncmlkLmRhdGFTb3VyY2UsCiAgICAgICAgICAgICAgICBkYXRhSXRlbSA9IGdyaWQuZGF0YUl0ZW0oJChlLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoInRyIikpOwoKICAgICAgICAgICAgaWYgKGRhdGFTb3VyY2UudG90YWwoKSA+IDEpIHsKICAgICAgICAgICAgICAgIGRhdGFTb3VyY2UucmVtb3ZlKGRhdGFJdGVtKTsKICAgICAgICAgICAgICAgIHRoaXMuYXV0b0NhbGN1bGF0ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBlcnJvck1lc3NhZ2UoKSB7CiAgICAgICAgfSwKICAgICAgICBhY2NvdW50RHJvcERvd25FZGl0b3IoKSB7CiAgICAgICAgfSwKICAgICAgICBjYW5jZWwoKSB7CiAgICAgICAgICAgIHRoaXMuJHN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IGkxOG4udCgibXNnX3RpdGxlX3dhcm5pbmciKSwKICAgICAgICAgICAgICAgIHRleHQ6IGkxOG4udCgibXNnX2Rpc2NhcmQiKSwKICAgICAgICAgICAgICAgIGljb246ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBpMThuLnQoImNhbmNlbCIpLAogICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzRkNDg0OCIsCiAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNFRDFBM0EiLAogICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IGkxOG4udCgiZGlzY2FyZCIpLAogICAgICAgICAgICB9KS50aGVuKChyZXN1bHRDZW4pID0+IHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHRDZW4udmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIuZ28oLTEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGhpZGVTbWFsbFNpZGViYXIoKSB7CiAgICAgICAgICAgIHRoaXMuaXNIaWRlQmFyID0gIXRoaXMuaXNIaWRlQmFyOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFZpZXdBZGp1c3RtZW50KCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2codGhpcy4kcm91dGUucGFyYW1zLmlkLCAnaWQnKQogICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGUucGFyYW1zLmlkICE9PSB1bmRlZmluZWQgfHwKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGUucGFyYW1zLmlkICE9PSAiIgogICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgYmlsbGluZ0hhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5pbnZlbnRvcnlBZGp1c3RtZW50TGlzdCgiP2lkPSIgKyB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgKyAnJnR5cGU9SW52ZW50b3J5IEFkanVzdG1lbnQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmludmVudG9yeUFkanVzdG1lbnQgPSByZXMuZGF0YS5kYXRhWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1MaW5lcyA9IHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC5pdGVtTGluZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKHRoaXMuaXRlbUxpbmVzLCAnLScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb25EYXRlID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC50cmFuc2FjdGlvbkRhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubUVtcGxveWVlID0gdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LmVtcGxveWVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhY2NvdW50XyA9IHRoaXMuaW52ZW50b3J5QWRqdXN0bWVudC5hY2NvdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmludmVudG9yeUFkanVzdG1lbnQuYWNjb3VudCA9IGFjY291bnRfOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmF1dG9DYWxjdWxhdGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFN0b2NrQ291bnQodHlwZSkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGFydERhdGUgPSAnJwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZERhdGUgPSAnJwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0ckZpbHRlciA9ICI/c3RhcnQ9IiArIHN0YXJ0RGF0ZSArICImZW5kPSIgKyBlbmREYXRlICsgIiZ0eXBlPSIgKyB0eXBlOwoKICAgICAgICAgICAgICAgICAgICBiaWxsaW5nSGFuZGxlci5pbnZlbnRvcnlBZGp1c3RtZW50TGlzdChzdHJGaWx0ZXIpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHJlcy5kYXRhLmRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvY2tDb3VudHMgPSByZXNwb25zZS5maWx0ZXIobiA9PiBuLnN0YXR1cyA9PT0gMSkKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGxvYWRWaWV3U3RvY2tDb3VudCgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCwgJ2lkJykKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdG9ja0NvdW50ID0gdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LnN0b2NrQ291bnQgfHwge30KICAgICAgICAgICAgICAgICAgICBjb25zdCBzdG9ja0NvdW50SWQgPSBzdG9ja0NvdW50LmlkIHx8ICcnCiAgICAgICAgICAgICAgICAgICAgaWYgKHN0b2NrQ291bnRJZCAhPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGJpbGxpbmdIYW5kbGVyLmludmVudG9yeUFkanVzdG1lbnRMaXN0KCI/aWQ9IiArIHN0b2NrQ291bnRJZCArICcmdHlwZT1TdG9jayBDb3VudCcpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0b2NrQ291bnQgPSByZXMuZGF0YS5kYXRhWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIHN0b2NrQ291bnRBZGp1c3RtZW50KCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2codGhpcy4kcm91dGUucGFyYW1zLmlkLCAnaWQnKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0b2NrQ291bnQgPSB0aGlzLmludmVudG9yeUFkanVzdG1lbnQuc3RvY2tDb3VudCB8fCB7fQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0b2NrQ291bnRJZCA9IHN0b2NrQ291bnQuaWQgfHwgJycKICAgICAgICAgICAgICAgICAgICBjb25zdCBhc09mID0gdGhpcy5pbnZlbnRvcnlBZGp1c3RtZW50LnRyYW5zYWN0aW9uRGF0ZSB8fCAnJwogICAgICAgICAgICAgICAgICAgIGlmIChzdG9ja0NvdW50SWQgIT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1MaW5lcyA9IFtdCiAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3RWYXJpYW50SGFuZGxlci5zdG9ja0NvdW50QWRqdXN0bWVudCgiP2lkPSIgKyBzdG9ja0NvdW50SWQgKyAnJmFzT2Y9JyArIGFzT2YpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1MaW5lcyA9IHJlcy5kYXRhLmRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgIH0sCiAgICB3YXRjaDogewogICAgICAgIGlkKCkgewogICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coJ2lkLS0nLCB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQpCiAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgdGhpcy5pbml0RGF0YSgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRWaWV3QWRqdXN0bWVudCgpOwogICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgIH0sCiAgICBjcmVhdGVkKCkgewogICAgICAgIC8vIGZldGNoIHRoZSBkYXRhIHdoZW4gdGhlIHZpZXcgaXMgY3JlYXRlZCBhbmQgdGhlIGRhdGEgaXMKICAgICAgICAvLyBhbHJlYWR5IGJlaW5nIG9ic2VydmVkCiAgICAgICAgLy8gdGhpcy5sb2FkT2JqKCkKICAgIH0sCiAgICBhc3luYyBtb3VudGVkKCkgewogICAgICAgIGF3YWl0IHRoaXMubG9hZFNhbGVGb3JtQ29udGVudCgpOwogICAgICAgIGF3YWl0IHRoaXMubG9hZEFjY291bnQoKTsKICAgICAgICBhd2FpdCB0aGlzLmxvYWRMb2NhdGlvbigpOwogICAgICAgIGF3YWl0IHRoaXMubG9hZFByZWZpeCgpOwogICAgICAgIGF3YWl0IHRoaXMubG9hZFNlZ21lbnQoKTsKICAgICAgICBhd2FpdCB0aGlzLmxvYWRQcm9qZWN0cygpOwogICAgICAgIC8vIGF3YWl0IHRoaXMubG9hZFdhcmVob3VzZXMoKQogICAgICAgIC8vIGF3YWl0IHRoaXMubG9hZEVtcGxveWVlQ2VudGVyKCk7CiAgICAgICAgYXdhaXQgdGhpcy5sb2FkU3RvY2tDb3VudCgnU3RvY2sgQ291bnQnKTsKICAgIH0sCiAgICBjb21wdXRlZDogewogICAgICAgIGhpZGRlbkJ1dHRvbigpIHsKICAgICAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnF1ZXJ5LnR5cGUgPT0gImVkaXQiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICB9LAp9Owo="},{"version":3,"sources":["InventoryAdjustment.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2aA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"InventoryAdjustment.vue","sourceRoot":"src/views/products/product/inventory_adjustment","sourcesContent":["<template>\n    <v-app>\n        <v-container>\n            <v-row>\n                <v-col sm=\"12\" cols=\"12\">\n                    <v-card\n                        outlined\n                        dense\n                        class=\"pa-4 no_border rounded-sm\"\n                        color=\"white\">\n                        <v-row>\n                            <v-col\n                                class=\"bigSide py-0\"\n                                sm=\"8\"\n                                cols=\"12\"\n                                style=\"transition: 0.3s ease-in\"\n                                :class=\"{ hide_big_bar_class: isHideBar }\">\n                                <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                                    <v-card outlined dense class=\"no_border\">\n                                        <h2 class=\"mb-0\">{{ $t(\"inventory_adjustment\") }}</h2>\n                                        <v-icon\n                                            v-if=\"isHideBar\"\n                                            @click=\"cancel()\"\n                                            style=\"cursor: pointer; color: #333; font-size: 40px\"\n                                            class=\"float-right\">close\n                                        </v-icon>\n                                        <span\n                                            style=\"transition: 0.3s ease-in; z-index: 10\"\n                                            :class=\"{  iconArrow: !isHideBar, iconArrowHide: isHideBar, }\">\n                      <v-icon\n                          size=\"22\"\n                          class=\"arr_icon\"\n                          @click=\"hideSmallSidebar\"\n                          v-if=\"isHideBar\">\n                        mdi-chevron-left-circle\n                      </v-icon>\n                      <v-icon\n                          size=\"22\"\n                          class=\"arr_icon\"\n                          @click=\"hideSmallSidebar\"\n                          v-if=\"!isHideBar\">\n                        mdi-chevron-right-circle\n                      </v-icon>\n                    </span>\n                                    </v-card>\n\n                                    <v-card\n                                        outlined\n                                        dense\n                                        class=\"px-3 no_border\"\n                                        color=\"grayBg\"\n                                        height=\" 172px\">\n                                        <v-row>\n                                            <v-col sm=\"4\" cols=\"12\" class=\"pb-0\">\n                                                <label class=\"label\">{{ $t(\"date\") }}</label>\n                                                <app-datepicker\n                                                    :initialDate=\"inventoryAdjustment.transactionDate\"\n                                                    @onChanged=\"onTransactionDateChanged\"\n                                                    @emitDate=\"inventoryAdjustment.transactionDate = $event\"\n                                                />\n                                                <label class=\"label\">{{ $t(\"stock_count_ref\") }}</label>\n                                                <v-select\n                                                    class=\"mt-1\"\n                                                    :items=\"stockCounts\"\n                                                    tage=\"account\"\n                                                    item-value=\"id\"\n                                                    item-text=\"referenceNo\"\n                                                    @change=\"stockCountAdjustment\"\n                                                    v-model=\"inventoryAdjustment.stockCount\"\n                                                    clearable\n                                                    return-object\n                                                    outlined\n                                                />\n                                            </v-col>\n                                            <v-col sm=\"4\" cols=\"12\">\n                                                <label class=\"label\">{{\n                                                        $t(\"adjustment_number\")\n                                                    }}</label>\n                                                <div class=\"d-flex mt-1\">\n                                                    <div class=\"code_text flex-1 text-bold\">\n                                                        {{ inventoryAdjustment.abbr }}\n                                                    </div>\n                                                    <v-text-field\n                                                        class=\"flex-2 custom-border\"\n                                                        v-model=\"inventoryAdjustment.number\"\n                                                        readonly\n                                                        outlined\n                                                        :rules=\"[(v) => !!v || $t('is_required')]\"\n                                                        required\n                                                    />\n                                                    <v-icon\n                                                        color=\"black\"\n                                                        size=\"30\"\n                                                        style=\"height: 40px\"\n                                                        class=\"border_qrcode ml-2\"\n                                                        @click=\"generateNumber\"\n                                                    >mdi-qrcode\n                                                    </v-icon>\n                                                </div>\n                                            </v-col>\n                                            <v-col sm=\"4\" cols=\"12\">\n                                                <label class=\"label\">{{\n                                                        $t(\"adjustment_account\")\n                                                    }}</label>\n                                                <v-select\n                                                    class=\"mt-1\"\n                                                    :items=\"accounts\"\n                                                    tage=\"account\"\n                                                    item-value=\"id\"\n                                                    :item-text=\"(item) => `${item.number} - ${item.name}`\"\n                                                    v-model=\"inventoryAdjustment.account\"\n                                                    :rules=\"[(v) => !!v || $t('is_required')]\"\n                                                    return-object\n                                                    outlined\n                                                />\n                                                <!-- <label class=\"label\">{{ $t(\"adjustment_memo\") }}</label>\n                                                <v-text-field\n                                                  class=\"mt-1\"\n                                                  v-model=\"inventoryAdjustment.transactionNote\"\n                                                  outlined\n                                                  tage=\"memo\"\n                                                  required\n                                                /> -->\n                                                <!-- <label class=\"label\">{{\n                                                  $t(\"message_for_journal\")\n                                                }}</label>\n                                                <v-text-field\n                                                  class=\"mt-1\"\n                                                  v-model=\"inventoryAdjustment.journalNote\"\n                                                  outlined\n                                                  tage=\"Message for Journal\"\n                                                  required\n                                                /> -->\n                                            </v-col>\n                                        </v-row>\n                                    </v-card>\n\n                                    <v-row style=\"background-color: #fff\">\n                                        <v-col sm=\"12\" cols=\"12\">\n                                            <kendo-datasource\n                                                ref=\"itemLineDS\"\n                                                :data=\"itemLines\"\n                                                :change=\"dataSourceChanged\"\n                                            />\n                                            <kendo-grid\n                                                id=\"gridItemLine\"\n                                                class=\"grid-function\"\n                                                :data-source-ref=\"'itemLineDS'\"\n                                                :sortable=\"false\"\n                                                :column-menu=\"true\"\n                                                :editable=\"true\"\n                                                :scrollable-virtual=\"true\"\n                                            >\n                                                <kendo-grid-column\n                                                    :command=\"{ iconClass: 'k-icon k-i-trash', text: ' ', click: removeRow, class: 'btn-plus',}\"\n                                                    :title=\"''\"\n                                                    :width=\"63\"\n                                                    :headerAttributes=\"{ style: 'text-align: left; background-color: #EDF1F5',}\"\n                                                />\n                                                <kendo-grid-column\n                                                    :title=\"$t('no.')\"\n                                                    :width=\"53\"\n                                                    :column-menu=\"false\"\n                                                    :template=\"rowNumberTmpl\"\n                                                    :headerAttributes=\"{ style: 'background-color: #EDF1F5;', class: 'text-products', }\"\n                                                    :attributes=\"{ style: 'text-align: products', }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'item'\"\n                                                    :title=\"$t('item')\"\n                                                    :template=\"itemTemplate\"\n                                                    :editor=\"ItemDropDownEditor\"\n                                                    :width=\"200\"\n                                                    :headerAttributes=\"{ style: 'background-color: #EDF1F5', }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'description'\"\n                                                    :title=\"$t('description')\"\n                                                    :template=\"'<span>#=description#</span>'\"\n                                                    :width=\"200\"\n                                                    :headerAttributes=\"{  style: 'background-color: #EDF1F5', }\"\n                                                />\n\n                                                <kendo-grid-column\n                                                    :field=\"'buom'\"\n                                                    :title=\"$t('uom')\"\n                                                    :width=\"170\"\n                                                    :template=\"UOMTemplate\"\n                                                    :editable=\" () => { return false; } \"\n                                                    :headerAttributes=\"{ style: 'text-align: left; background-color: #EDF1F5', }\"\n                                                    :attributes=\"{ style: 'text-align: left', }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'cost'\"\n                                                    :title=\"$t('cost')\"\n                                                    :editor=\"numberEditor\"\n                                                    :template=\"'<span>#=kendo.toString(cost || 0, decimalFormat) || 0#</span>'\"\n                                                    :width=\"170\"\n                                                    :headerAttributes=\"{ style: 'text-align: left; background-color: #EDF1F5', }\"\n                                                    :attributes=\"{ style: 'text-align: right; ' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'qoh'\"\n                                                    :title=\"$t('on_hand')\"\n                                                    :template=\"'<span>#=kendo.toString(qoh || 0, decimalFormat) || 0#</span>'\"\n                                                    :width=\"170\"\n                                                    :editable=\" () => { return false;  }\"\n                                                    :headerAttributes=\"{ style: 'text-align: left; background-color: #EDF1F5',}\"\n                                                    :attributes=\"{ style: 'text-align: right; ' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'count'\"\n                                                    :title=\"$t('counted')\"\n                                                    :editor=\"numberEditor\"\n                                                    :template=\"'<span>#=kendo.toString(count || 0, decimalFormat)#</span>'\"\n                                                    :width=\"170\"\n                                                    :headerAttributes=\"{ style: 'text-align: left; background-color: #EDF1F5',  }\"\n                                                    :attributes=\"{ style: 'text-align: right; ' }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'different'\"\n                                                    :title=\"$t('different')\"\n                                                    :editable=\" () => { return false; } \"\n                                                    :width=\"170\"\n                                                    :template=\"'<span>#=kendo.toString(different || 0, decimalFormat)#</span>'\"\n                                                    :editor=\"numberEditor\"\n                                                    :headerAttributes=\"{ style: 'text-align: left; background-color: #EDF1F5', }\"\n                                                    :attributes=\"{ style: 'text-align: right', }\"\n                                                />\n                                                <kendo-grid-column\n                                                    :field=\"'amount'\"\n                                                    :title=\"$t('amount')\"\n                                                    :width=\"170\"\n                                                    :editable=\" () => { return false; }\"\n                                                    :template=\"'<span>#=kendo.toString(amount || 0, decimalFormat)#</span>'\"\n                                                    :headerAttributes=\"{ style: 'text-align: left; background-color: #EDF1F5', }\"\n                                                    :attributes=\"{ style: 'text-align: right', }\"\n                                                />\n                                            </kendo-grid>\n                                        </v-col>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"py-0\">\n                                            <v-btn\n                                                color=\"primary\"\n                                                class=\"float-left ml-0 btn_plus rounded-4 white--text mr-2\"\n                                                @click=\"addRow\">\n                                                <v-icon size=\"\" class=\"ma-1\">mdi-plus</v-icon>\n                                            </v-btn>\n                                        </v-col>\n                                        <v-col sm=\"6\" cols=\"12\">\n                                            <label>{{ $t(\"message_these_adjustment\") }}</label>\n                                            <v-textarea\n                                                class=\"mt-1\"\n                                                outlined\n                                                no-resize\n                                                height=\"70px\"\n                                                tage=\"Message on Invoice\"\n                                                placeholder=\"This will appear on the invoice\"\n                                            />\n                                            <label>{{ $t(\"message_on_journal\") }}</label>\n                                            <v-textarea\n                                                class=\"mt-1\"\n                                                outlined\n                                                no-resize\n                                                height=\"70px\"\n                                                tage=\"Message on Order\"\n                                                placeholder=\"This will appear on the journal\"\n                                            />\n                                        </v-col>\n                                        <v-col class=\"pt-5\" sm=\"6\" cols=\"12\">\n                                            <v-simple-table>\n                                                <template v-slot:default>\n                                                    <tbody>\n                                                    <tr>\n                                                        <td class=\"text-left\">{{ $t(\"dr\") }}</td>\n                                                        <td class=\"text-center\">:</td>\n                                                        <td class=\"text-right color_green text-bold\">\n                                                            {{ numberFormat(dr) }}\n                                                        </td>\n                                                    </tr>\n                                                    <tr>\n                                                        <td class=\"text-left\">{{ $t(\"cr\") }}</td>\n                                                        <td class=\"text-center\">:</td>\n                                                        <td class=\"text-right color_green text-bold\">\n                                                            {{ numberFormat(cr) }}\n                                                        </td>\n                                                    </tr>\n                                                    </tbody>\n                                                </template>\n                                            </v-simple-table>\n                                        </v-col>\n                                    </v-row>\n                                    <v-divider/>\n                                    <v-card elevation=\"0\" class=\"no_border function_footer\">\n                                        <v-alert type=\"warning\" v-model=\"alert\" dismissible>\n                                            <span v-html=\"errorMessage\"/>\n                                        </v-alert>\n                                        <v-menu>\n                                            <v-list>\n                                                <v-list-item\n                                                    v-for=\"(item, index) in templates\"\n                                                    :key=\"index\">\n                                                    <v-list-item-title>{{\n                                                            item.title\n                                                        }}\n                                                    </v-list-item-title>\n                                                </v-list-item>\n                                            </v-list>\n                                        </v-menu>\n                                        <v-btn\n                                            color=\"primary\"\n                                            outlined\n                                            class=\"text-capitalize black--text float-left\"\n                                            @click=\"cancel\"\n                                        >{{ $t(\"cancel\") }}\n                                        </v-btn>\n                                        <v-btn\n                                            color=\"primary\"\n                                            @click=\"onSaveClose('close')\"\n                                            class=\"float-right white--text text-capitalize\">\n                                            {{ $t(\"save_close\") }}\n                                        </v-btn>\n                                        <v-btn\n                                            color=\"secondary\"\n                                            style=\"margin-right: 10px !important\"\n                                            class=\"white--text float-right text-capitalize\"\n                                            @click=\"onSaveClose('new')\"\n                                            :hidden=\"hiddenButton\">{{ $t(\"save_new\") }}\n                                        </v-btn>\n                                    </v-card>\n                                </v-form>\n                            </v-col>\n                            <v-col\n                                class=\"smallSide\"\n                                sm=\"4\"\n                                style=\"transition: 0.3s ease-in\"\n                                :class=\"{ hide_small_bar_class: isHideBar }\">\n                                <h3\n                                    style=\"color: #b3b5bc; font-size: 20px\"\n                                    v-if=\"!isHideBar\"\n                                    class=\"text-uppercase float-right mt-n3\">\n                  <span class=\"pointer\" @click=\"Help('inventory adjustment')\">\n                    {{ $t(\"help\") }}\n                  </span>\n                                    <v-icon\n                                        @click=\"cancel()\"\n                                        style=\"cursor: pointer; color: #333; font-size: 40px\"\n                                        class=\"float-right mt-n1\"\n                                    >close\n                                    </v-icon>\n                                </h3>\n\n                                <div v-if=\"!isHideBar\" class=\"small_sidebar mt-8 grayBg\">\n                                    <v-row>\n                                        <v-col sm=\"12\" cols=\"12\" class=\"pt-0\">\n                                            <v-card\n                                                outlined\n                                                dense\n                                                class=\" pa-3 mb-2 no_border my_card rounded-4 white--text \"\n                                                color=\"primary\"\n                                                height=\"60px\">\n                                                <h3 class=\"text-left font_13 flex-1 text-uppercase\">\n                                                    {{ $t(\"adjustment_amount\") }}\n                                                </h3>\n                                                <h3 class=\"text-right flex-1 font_20 niradei_heavy\">\n                                                    0000\n                                                </h3>\n                                            </v-card>\n                                            <label class=\"label mb-0\">{{ $t(\"segment\") }}</label>\n                                            <v-select\n                                                class=\"mt-1\"\n                                                v-model=\"inventoryAdjustment.segment\"\n                                                :items=\"segments\"\n                                                item-value=\"id\"\n                                                :item-text=\"(item) => `${item.code} - ${item.name}`\"\n                                                return-object\n                                                tage=\"sub Of\"\n                                                placeholder=\"Sub Of\"\n                                                outlined=\"\"\n                                            />\n                                            <label class=\"label mb-0\">{{ $t(\"location\") }}</label>\n                                            <v-select\n                                                class=\"mt-1\"\n                                                v-model=\"inventoryAdjustment.location\"\n                                                :items=\"locations\"\n                                                item-value=\"id\"\n                                                :item-text=\"(item) => `${item.code} - ${item.name}`\"\n                                                return-object\n                                                tage=\"Location\"\n                                                placeholder=\"location\"\n                                                outlined=\"\"\n                                            />\n                                            <label class=\"label\">{{ $t(\"project\") }}</label>\n                                            <v-select\n                                                class=\"mt-1\"\n                                                v-model=\"inventoryAdjustment.project\"\n                                                :items=\"projects\"\n                                                :item-text=\"(item) => `${item.code} - ${item.name}`\"\n                                                item-value=\"id\"\n                                                tage=\"Project\"\n                                                outlined\n                                            />\n                                            <label class=\"label\">{{ $t(\"for_month_of\") }}</label>\n                                            <app-monthpicker\n                                                :initMonthOf=\"inventoryAdjustment.monthOf\"\n                                                @emitMonthOf=\"inventoryAdjustment.monthOf = $event\"\n                                            />\n                                            <p class=\"detial_smallside_p font_14\">\n                                                {{ $t(\"inventory_adjustment_func_desc\") }} </p>\n                                        </v-col>\n                                    </v-row>\n                                </div>\n                            </v-col>\n                        </v-row>\n                    </v-card>\n                </v-col>\n            </v-row>\n            <LoadingMe\n                :isLoading=\"showLoading\"\n                :fullPage=\"false\"\n                type=\"loading\"\n                :myLoading=\"true\"\n            />\n        </v-container>\n    </v-app>\n</template>\n\n<script>\n// import kendo from '@progress/kendo-ui'\nimport {i18n} from \"@/i18n\";\nimport InventoryAdjustment from \"@/scripts/model/inventoryAdjustment\";\nimport {ShowResource} from \"@/observable/store\";\nimport {uuid} from \"vue-uuid\";\nimport kendo from \"@progress/kendo-ui\";\nimport SaleFormContentModel from \"@/scripts/model/SaleFormContent\";\nimport ItemLineModel from \"@/scripts/inventory-adjustment/model/ItemLine\";\n// import { DropDownList } from \"@progress/kendo-vue-dropdowns\";\n\nconst accountHandler = require(\"@/scripts/handler/accounting/account\");\nconst billingHandler = require(\"@/scripts/invoice/handler/billingHandler\");\nconst prefixHandler = require(\"@/scripts/prefixHandler\");\nconst warehouseHandler = require(\"@/scripts/warehouseHandler\");\nconst settingsHandler = require(\"@/scripts/settingsHandler\");\nconst locationHandler = require(\"@/scripts/locationHandler\");\nconst projectHandler = require(\"@/scripts/projectHandler\");\nconst productVariantHandler = require(\"@/scripts/productVariantHandler\");\nconst saleFormContentHandler = require(\"@/scripts/saleFormContentHandler\");\nconst saleFormContentModel = new SaleFormContentModel({});\nconst currencyHandler = require(\"@/scripts/currency/handler/currencyHandler\");\n\nconst itemLineModel = new ItemLineModel({});\nconst prefix = \"inventory adjustment\";\nconst txnType = \"Inventory Adjustment\";\nconst itemLinePrefix = \"lin-\";\nconst $ = kendo.jQuery\n\nconst cookieJS = require(\"@/cookie.js\");\nconst cookie = cookieJS.getCookie();\n\nexport default {\n    name: \"InventoryAdjustment\",\n    components: {\n        LoadingMe: () => import(`@/components/Loading`),\n        \"app-datepicker\": () => import(\"@/components/custom_templates/DatePickerComponent\"),\n        \"app-monthpicker\": () => import(\"@/components/kendo_templates/MonthOfPicker\"),\n        // dropdownlist: DropDownList,\n    },\n    props: [\"id\"],\n    data: () => ({\n        isEdit: false,\n        // LoadingMe\n        showLoading: true,\n        alert: false,\n        valid: true,\n        templates: [\n            {title: \"Draft\"},\n            {title: \"Open\"},\n            {title: \"Partially Closed\"},\n            {title: \"Closed\"},\n        ],\n        isHideBar: false,\n        accounts: [],\n        segments: [],\n        locations: [],\n        projects: [],\n        warehouses: [],\n        buom: [],\n        itemLines: [],\n        baseCurrency: {},\n        exchangeRate: {},\n        saleFormContent: saleFormContentModel,\n        inventoryAdjustment: new InventoryAdjustment({}),\n        itemLine: itemLineModel,\n        transactionDate: \"\",\n        jRaw: [],\n        dr: 0,\n        cr: 0,\n        loggedUser: {\n            id: cookie.creator,\n            name: cookie.email,\n        },\n        stockCounts: []\n    }),\n    methods: {\n        numberFormat(value) {\n            return kendo.toString(value, `n${this.saleFormContent.decimal}`);\n        },\n        onTransactionDateChanged() {\n            // this.resetDataWhenTxnDateChanged()\n            if (this.$route.params.id === undefined) {\n                this.generateNumber();\n            }\n            this.inventoryAdjustment.monthOf = new Date(\n                this.inventoryAdjustment.transactionDate\n            )\n                .toISOString()\n                .substr(0, 7);\n        },\n        async initData() {\n            if (this.$route.params.id !== undefined) {\n                await this.loadViewAdjustment();\n                // window.console.log('1', this.$route.params)\n            } else {\n                this.addRow();\n            }\n        },\n        async loadSaleFormContent() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    saleFormContentHandler.list().then(async (res) => {\n                        if (res.data.statusCode === 200) {\n                            const data = res.data.data;\n                            if (data.length > 0) {\n                                this.saleFormContent = data[0];\n                                this.baseCurrency = data[0].baseCurrency;\n                                this.inventoryAdjustment.currency = this.baseCurrency;\n                                await this.initData();\n                                await this.loadTransactionRate();\n                            }\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async loadTransactionRate() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    const date = new Date(this.inventoryAdjustment.transactionDate)\n                        .toISOString()\n                        .substr(0, 10);\n                    const currency = this.baseCurrency;\n                    let code = \"\";\n                    if (currency.hasOwnProperty(\"code\")) {\n                        code = currency.code;\n                    }\n                    if (code !== undefined || code !== \"\") {\n                        this.showLoading = true;\n                        currencyHandler\n                            .getLastExchangeRateByDate(date, code)\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    this.exchangeRate = res.data.data[0];\n                                    this.inventoryAdjustment.txnRate = this.exchangeRate.rate;\n                                    this.inventoryAdjustment.exchangeRate = this.exchangeRate;\n                                    this.showLoading = false;\n                                }\n                            });\n                    }\n                }, 10);\n            });\n        },\n        itemTemplate(dataItem) {\n            const item = dataItem.item;\n            if (item) {\n                return `<span>${item.name ? item.name : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        ItemDropDownEditor(container, options) {\n            kendo\n                .jQuery('<input name=\"' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoDropDownList({\n                    autoBind: true,\n                    autoWidth: true,\n                    height: 400,\n                    filter: \"contains\",\n                    dataTextField: \"name\",\n                    dataValueField: \"id\",\n                    headerTemplate:\n                        '<div class=\"dropdown-header k-widget k-header\">' +\n                        \"<span>Items </span>\" +\n                        \"<span></span>\" +\n                        \"</div>\",\n                    template: \"<span>#=name#</span>\",\n                    optionLabel: \"--- Select ---\",\n                    dataSource: new kendo.data.DataSource({\n                        serverFiltering: true,\n                        transport: {\n                            read: {\n                                url: productVariantHandler.itemVariantSearchURL(),\n                            },\n                            dataType: \"json\",\n                        },\n                        schema: {\n                            model: {\n                                id: \"id\",\n                                fields: {\n                                    id: {type: \"string\"},\n                                    name: {type: \"string\"},\n                                    sku: {type: \"string\"},\n                                },\n                            },\n                            data: function (response) {\n                                return response.data;\n                            },\n                            total: function (response) {\n                                return response.data.count;\n                            },\n                        },\n                    }),\n                });\n        },\n        qohTemplate(dataItem) {\n            // const buom = dataItem.buom || {}\n            const qoh = dataItem.qoh || 0;\n            // if (buom.hasOwnProperty('name')) {\n            return qoh;\n            // }\n            // return ``\n        },\n        UOMTemplate(dataItem) {\n            const uom = dataItem.buom;\n            if (uom) {\n                return `<span>${uom.name ? uom.name : ``}</span>`;\n            } else {\n                return ``;\n            }\n        },\n        numberEditor(container, options) {\n            kendo\n                .jQuery('<input data-bind=\"value:' + options.field + '\"/>')\n                .appendTo(container)\n                .kendoNumericTextBox({\n                    decimals: 30,\n                    min: 0,\n                    format: `${this.saleFormContent.decimal}`,\n                });\n        },\n        rowNumberTmpl(dataItem) {\n            let ds = this.$refs.itemLineDS.kendoWidget(),\n                index = ds.indexOf(dataItem);\n            return index + 1;\n        },\n        addRow() {\n            let ds = this.$refs.itemLineDS.kendoWidget(),\n                total = ds.total();\n            this.itemLine.id = itemLinePrefix + uuid.v1();\n            this.itemLine.decimalFormat = \"n\" + this.saleFormContent.decimal;\n            ds.insert(total, this.itemLine);\n        },\n        async dataSourceChanged(e) {\n            if (e.field) {\n                let dataRow = e.items[0], itemType = '',\n                    buom = {},\n                    count = 0,\n                    diff = 0,\n                    qoh = 0;\n                switch (e.field) {\n                    case \"item\":\n                        dataRow.set(\"description\", dataRow.item.description);\n                        buom = dataRow.item.uom;\n                        dataRow.set(\"buom\", buom);\n                        itemType = dataRow.item.type || ''\n                        await this.searchTransaction(dataRow, dataRow.item.id, itemType);\n                        break;\n                    case \"count\":\n                        try {\n                            count = parseFloat(dataRow.count || 0);\n                            qoh = parseFloat(dataRow.qoh || 0);\n                            diff = count - qoh;\n                            dataRow.set(\"different\", parseFloat(diff));\n                            dataRow.set(\n                                \"amount\",\n                                parseFloat(dataRow.cost) * parseFloat(diff)\n                            );\n                        } catch {\n                            dataRow.set(\"different\", 0);\n                            dataRow.set(\"amount\", 0);\n                        }\n                        break;\n                    case \"cost\":\n                        try {\n                            diff = parseFloat(dataRow.different || 0);\n                            dataRow.set(\n                                \"amount\",\n                                parseFloat(dataRow.cost) * parseFloat(diff)\n                            );\n                        } catch {\n                            dataRow.set(\"amount\", 0);\n                        }\n                        break;\n                    default:\n                        break;\n                }\n                if (e.field) {\n                    this.autoCalculate();\n                    // this.rawForJournal()\n                }\n            }\n        },\n        autoCalculate() {\n            let ds = this.$refs.itemLineDS.kendoWidget();\n            let nature = \"\",\n                amount = 0,\n                qty = 0;\n            this.jRaw = [];\n            const rows = ds.data();\n            rows.forEach((value) => {\n                const amt = kendo.parseFloat(value.amount);\n                const diff = kendo.parseFloat(value.different);\n                amount += amt;\n                qty += diff;\n                const item = value.item;\n                if (amt > 0) {\n                    nature = \"dr\";\n                } else {\n                    nature = \"cr\";\n                }\n                if (item) {\n                    if (item.type === \"Variant\") {\n                        if (item.hasOwnProperty(\"inventoryAcc\")) {\n                            if (item.inventoryAcc.hasOwnProperty(\"id\")) {\n                                let inventoryAcc = item.inventoryAcc;\n                                this.jRaw.push({\n                                    id: inventoryAcc.id + \"-\" + nature,\n                                    line: new ItemLineModel(value),\n                                    description: item.description || \"\",\n                                    account: item.inventoryAcc,\n                                    accountId: item.inventoryAcc.id,\n                                    amount: amt, // qty*avg_cost ,\n                                    exchangeAmount: amt, //xAmount,\n                                    type: nature,\n                                    typeAs: \"item\",\n                                });\n                            }\n                        }\n                    }\n                }\n            });\n            this.inventoryAdjustment.amount = amount;\n            this.inventoryAdjustment.exchangeAmount = amount;\n            this.inventoryAdjustment.qty = qty;\n            // adjustment account\n            if (this.inventoryAdjustment.account) {\n                const adjustAcc = this.inventoryAdjustment.account;\n                if (amount * -1 > 0) {\n                    nature = \"dr\";\n                } else {\n                    nature = \"cr\";\n                }\n                this.jRaw.push({\n                    id: adjustAcc.id + \"-\" + nature,\n                    line: new ItemLineModel({}),\n                    description: this.inventoryAdjustment.journalNote,\n                    account: adjustAcc,\n                    accountId: adjustAcc.id,\n                    amount: amount * -1, // qty*avg_cost ,\n                    exchangeAmount: amount * -1, //xAmount,\n                    type: nature,\n                    typeAs: \"adjustment acc\",\n                });\n            }\n            // todo: raw Journal\n            // const account = this.inventoryAdjustment.account || {}\n            // if (this.inventoryAdjustment.amountDue > 0) {\n            //   nature = 'dr'\n            // } else {\n            //   nature = 'cr'\n            // }\n            // if (account) {\n            //   if (account.hasOwnProperty('id')) {\n            //     this.jRaw.push({\n            //       id: account.id + '-' + nature,\n            //       line: new ItemLineModel({}),\n            //       description: this.invoice.journalNote,\n            //       account: account,\n            //       accountId: account.id,\n            //       exchangeAmount: this.inventoryAdjustment.exchangeAmount,\n            //       amount: this.invoice.amountDue,\n            //       type: nature,\n            //       typeAs: 'ar'\n            //     })\n            //   }\n            // }\n            // todo: end raw Journal\n            this.shrinkData(this.jRaw);\n            // const unique = this.removeDuplicate(this.accounts)\n            // window.console.log(unique, 'unique')\n        },\n        removeDuplicate(array) {\n            const result = [];\n            const map = new Map();\n            for (const item of array) {\n                if (!map.has(item.id)) {\n                    map.set(item.id, true); // set any value to Map\n                    result.push(item);\n                }\n            }\n            return result;\n        },\n        shrinkData(obj) {\n            const uniques =\n                this.removeDuplicate(obj); /*[...new Set(accountId.map(i => {\n                return {\n                    id_: i.id_,\n                    id: i.id,\n                    type: i.type\n                }\n            }))]*/\n            uniques.forEach((n) => {\n                const found = obj.filter((m) => m.id === n.id);\n                let amount = 0,\n                    xAmount = 0;\n                found.forEach((z) => {\n                    amount += parseFloat(z.amount || 0);\n                    xAmount += parseFloat(z.exchangeAmount || 0);\n                });\n                n.amount = parseFloat(amount); //this.numberFormat(amount)\n                n.exchangeAmount = parseFloat(xAmount); //parseFloat(parseFloat(amount * parseFloat(this.invoice.txnRate))) //this.numberFormat(amount * parseFloat(this.invoice.txnRate)) //.toFixed(this.saleFormContent.decimal)\n            });\n            this.jRaw = uniques;\n            let dr = 0,\n                cr = 0;\n            this.jRaw.forEach((j) => {\n                switch (j.type) {\n                    case \"cr\":\n                        cr += parseFloat(j.amount);\n                        break;\n                    case \"dr\":\n                        dr += parseFloat(j.amount);\n                        break;\n                    default:\n                        break;\n                }\n            });\n            this.dr = dr;\n            this.cr = cr;\n            window.console.log(\"dr=\", dr, \"cr=\", cr, \"dr+cr = \", dr + cr);\n            window.console.log(JSON.stringify(uniques), \"uniques\");\n        },\n        Help(keyword_search) {\n            ShowResource(keyword_search);\n        },\n        async searchTransaction(dataRow, itemId, itemType) {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    this.showLoading = true;\n                    const startDate = this.inventoryAdjustment.transactionDate;\n                    let strFilter = \"?asOf=\" + startDate + \"&id=\" + itemId + '&itemType=' + itemType;\n                    billingHandler.inventoryBalance(strFilter).then((res) => {\n                        if (res.data.statusCode === 200) {\n                            const balance = res.data.data;\n                            if (balance.length > 0) {\n                                dataRow.set(\"cost\", balance[0].wac);\n                                dataRow.set(\"qoh\", balance[0].qoh);\n                                dataRow.set(\n                                    \"amount\",\n                                    parseFloat(balance[0].wac) * parseFloat(dataRow.different)\n                                );\n                            } else {\n                                dataRow.set(\"cost\", 0);\n                            }\n                            window.console.log(\"balance\", res.data.data);\n                        }\n                        this.showLoading = false;\n                    });\n                }, 10);\n            });\n        },\n        async loadAccount() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    accountHandler.getAll().then((res) => {\n                        this.showLoading = false;\n                        this.accounts = res.data.map((itm) => {\n                            return {\n                                id: itm.uuid,\n                                uuid: itm.uuid,\n                                name: itm.name,\n                                local_name: itm.local_name,\n                                number: itm.number,\n                                is_taxable: itm.is_taxable,\n                                banhjiAccCode: itm.banhjiAccCode,\n                                group_code: itm.group_code,\n                                parent_account: itm.parent_account,\n                                type_code: itm.type_code,\n                                account_type: itm.account_type,\n                            };\n                        });\n                        if (this.accounts.length > 0) {\n                            this.inventoryAdjustment.account = this.accounts[0];\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async loadProjects() {\n            await projectHandler.list().then((res) => {\n                this.projects = res.data.data;\n                if (this.projects.length > 0) {\n                    this.inventoryAdjustment.project = this.projects[0];\n                }\n            });\n        },\n        async loadSegment() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    this.segments = [];\n                    settingsHandler\n                        .getSeg()\n                        .then((res) => {\n                            this.showLoading = true;\n                            if (res.data.statusCode === 200) {\n                                this.showLoading = false;\n                                this.segments = res.data.data;\n                                if (this.segments.length > 0) {\n                                    this.inventoryAdjustment.segment = this.segments[0];\n                                }\n                                // this.segmentList = res.data.data\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 10);\n            });\n        },\n        async loadLocation() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    this.locations = [];\n                    locationHandler\n                        .list()\n                        .then((res) => {\n                            this.showLoading = true;\n                            if (res.data.statusCode === 200) {\n                                this.showLoading = false;\n                                this.locations = res.data.data;\n                                if (this.locations.length > 0) {\n                                    this.inventoryAdjustment.location = this.locations[0];\n                                }\n                            }\n                        })\n                        .catch();\n                    {\n                        this.showLoading = false;\n                    }\n                }, 10);\n            });\n        },\n        async loadWarehouses() {\n            warehouseHandler.getWarehouseSettingAll().then((res) => {\n                this.warehouses = res;\n            });\n        },\n        async loadPrefix() {\n            new Promise((resolve) => {\n                setTimeout(async () => {\n                    resolve(\"resolved\");\n                    await prefixHandler.get(prefix).then(async (res) => {\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false;\n                            this.transactionTypes = res.data.data;\n                            if (this.transactionTypes.length > 0) {\n                                this.inventoryAdjustment.transactionType =\n                                    this.transactionTypes[0];\n                                if (this.$route.params.id === undefined) {\n                                    await this.generateNumber();\n                                }\n                            }\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async generateNumber() {\n            if (this.inventoryAdjustment.transactionDate !== \"\") {\n                let data = {\n                    abbr: this.inventoryAdjustment.transactionType.abbr,\n                    structure: this.inventoryAdjustment.transactionType.structure,\n                    transactionDate: this.inventoryAdjustment.transactionDate,\n                    sequcencing: this.inventoryAdjustment.transactionType.sequcencing,\n                    type: \"Inventory Adjustment\",\n                };\n                this.inventoryAdjustment.abbr = data.abbr;\n                this.inventoryAdjustment.structure = data.structure;\n                this.inventoryAdjustment.sequcencing = data.sequcencing;\n                this.inventoryAdjustment.transactionDate = data.transactionDate;\n                this.inventoryAdjustment.type = data.type;\n                this.showLoading = true;\n                await billingHandler\n                    .lastNumber(data)\n                    .then((response) => {\n                        if (response.data.statusCode === 200) {\n                            this.showLoading = false;\n                            const res = response.data.data;\n                            const lastNumber = this.zeroPad(\n                                parseInt(res.lastNumber),\n                                this.inventoryAdjustment.transactionType.format\n                            );\n                            this.inventoryAdjustment.number =\n                                res.suffix +\n                                this.inventoryAdjustment.transactionType.numberSeparator +\n                                lastNumber;\n                            this.inventoryAdjustment.lastNumber = res.suffix + lastNumber;\n                        }\n                    })\n                    .catch((e) => {\n                        this.showLoading = false;\n                        window.console.error(e);\n                    });\n            }\n        },\n        zeroPad(num, places) {\n            return String(num).padStart(places, \"0\");\n        },\n        savePrint() {\n        },\n        saveNew() {\n        },\n        async onSaveClose(isSave) {\n            if (!this.$refs.form.validate()) {\n                this.$refs.form.validate();\n                return;\n            }\n            window.console.log(\"mEmployee\", this.inventoryAdjustment.employee);\n            if (this.mEmployee.id !== null) {\n                new Promise((resolve) => {\n                    setTimeout(() => {\n                        resolve(\"resolved\");\n                        let isAutoGenerate = 1;\n                        if (this.$route.params.id) {\n                            const tranDate = new Date(this.transactionDate);\n                            const tranDateAdjustment = new Date(\n                                this.inventoryAdjustment.transactionDate\n                            );\n                            const tranDateM = tranDate.getFullYear() + tranDate.getMonth();\n                            const tranDateTxnM =\n                                tranDateAdjustment.getFullYear() +\n                                tranDateAdjustment.getMonth();\n                            if (tranDateM === tranDateTxnM) {\n                                isAutoGenerate = 0;\n                            }\n                        }\n                        this.autoCalculate();\n                        let itemLineDS = this.$refs.itemLineDS.kendoWidget();\n                        const dataRow = itemLineDS\n                            .data()\n                            .filter((o) => o.buom !== {} || o.buom !== null)\n                            .map((o) => {\n                                return new ItemLineModel(o);\n                            });\n                        if (dataRow.length > 0) {\n                            let data = {\n                                id: this.inventoryAdjustment.id\n                                    ? this.inventoryAdjustment.id\n                                    : \"\",\n                                uuid: this.inventoryAdjustment.uuid\n                                    ? this.inventoryAdjustment.uuid\n                                    : \"\",\n                                journal_uuid: this.inventoryAdjustment.journal_uuid\n                                    ? this.inventoryAdjustment.journal_uuid\n                                    : \"\",\n                                type: txnType,\n                                number: this.inventoryAdjustment.number,\n                                abbr: this.inventoryAdjustment.transactionType.abbr,\n                                transactionDate: this.transactionDate,\n                                monthOf: this.inventoryAdjustment.monthOf,\n                                transactionType: this.inventoryAdjustment.transactionType,\n                                txnRate: this.inventoryAdjustment.txnRate,\n                                exchangeRate: this.inventoryAdjustment.exchangeRate,\n                                currency: this.inventoryAdjustment.currency,\n                                itemLine: dataRow,\n                                segment: this.inventoryAdjustment.segment,\n                                location: this.inventoryAdjustment.location,\n                                project: this.inventoryAdjustment.project,\n                                employee: this.inventoryAdjustment.employee,\n                                transactionNote: this.inventoryAdjustment.transactionNote,\n                                journalNote: this.inventoryAdjustment.journalNote,\n                                account: this.inventoryAdjustment.account,\n                                status: 1,\n                                createdAt: this.inventoryAdjustment.createdAt,\n                                amount: this.inventoryAdjustment.amount,\n                                exchangeAmount: this.inventoryAdjustment.exchangeAmount,\n                                qty: this.inventoryAdjustment.qty,\n                                loggedUser: this.loggedUser,\n                                isAutoGenerate: isAutoGenerate,\n                                jRaw: this.jRaw,\n                                actionType: this.$route.params.id\n                                    ? this.$route.query.type\n                                    : \"new\",\n                            };\n                            this.showLoading = true;\n                            billingHandler\n                                .inventoryAdjustment(data)\n                                .then((response) => {\n                                    if (response.data.statusCode === 201) {\n                                        this.showLoading = false;\n                                        this.$snotify.success(\"Successfully\");\n                                        if (isSave == \"new\") {\n                                            this.clear();\n                                        } else if (isSave == \"close\") {\n                                            this.clear();\n                                            this.close();\n                                        }\n                                    }\n                                })\n                                .catch((e) => {\n                                    this.showLoading = false;\n                                    this.$snotify.error(\"Something went wrong\");\n                                    this.errors.push(e);\n                                });\n                        }\n                    }, 10);\n                });\n            }\n        },\n        close() {\n            window.history.go(-1);\n        },\n        clear() {\n            this.loadPrefix();\n            this.loadAccount();\n            this.loadSegment();\n            this.loadLocation();\n            this.loadProjects();\n            this.inventoryAdjustment = new InventoryAdjustment({});\n            let ds = this.$refs.itemLineDS.kendoWidget();\n            ds.data([]);\n            this.addRow();\n        },\n        removeRow(e) {\n            e.preventDefault();\n            const grid = kendo.jQuery(\"#gridItemLine\").data(\"kendoGrid\"),\n                dataSource = grid.dataSource,\n                dataItem = grid.dataItem($(e.currentTarget).closest(\"tr\"));\n\n            if (dataSource.total() > 1) {\n                dataSource.remove(dataItem);\n                this.autoCalculate();\n            }\n        },\n        errorMessage() {\n        },\n        accountDropDownEditor() {\n        },\n        cancel() {\n            this.$swal({\n                title: i18n.t(\"msg_title_warning\"),\n                text: i18n.t(\"msg_discard\"),\n                icon: \"warning\",\n                showCancelButton: true,\n                cancelButtonText: i18n.t(\"cancel\"),\n                confirmButtonColor: \"#4d4848\",\n                cancelButtonColor: \"#ED1A3A\",\n                confirmButtonText: i18n.t(\"discard\"),\n            }).then((resultCen) => {\n                if (resultCen.value) {\n                    this.$router.go(-1);\n                }\n            });\n        },\n        hideSmallSidebar() {\n            this.isHideBar = !this.isHideBar;\n        },\n        async loadViewAdjustment() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    // window.console.log(this.$route.params.id, 'id')\n                    if (\n                        this.$route.params.id !== undefined ||\n                        this.$route.params.id !== \"\"\n                    ) {\n                        this.showLoading = true;\n                        billingHandler\n                            .inventoryAdjustmentList(\"?id=\" + this.$route.params.id + '&type=Inventory Adjustment')\n                            .then((res) => {\n                                if (res.data.statusCode === 200) {\n                                    this.showLoading = false;\n                                    this.inventoryAdjustment = res.data.data[0];\n                                    this.itemLines = this.inventoryAdjustment.itemLine;\n                                    // window.console.log(this.itemLines, '-')\n                                    this.transactionDate =\n                                        this.inventoryAdjustment.transactionDate;\n                                    this.mEmployee = this.inventoryAdjustment.employee;\n                                    const account_ = this.inventoryAdjustment.account;\n                                    this.inventoryAdjustment.account = account_;\n                                    this.autoCalculate();\n                                }\n                            });\n                    }\n                }, 10);\n            });\n        },\n        async loadStockCount(type) {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    this.showLoading = true;\n                    const startDate = ''\n                    const endDate = ''\n                    const strFilter = \"?start=\" + startDate + \"&end=\" + endDate + \"&type=\" + type;\n\n                    billingHandler.inventoryAdjustmentList(strFilter).then((res) => {\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false;\n                            const response = res.data.data\n                            this.stockCounts = response.filter(n => n.status === 1)\n                        } else {\n                            this.showLoading = false;\n                        }\n                    });\n                }, 10);\n            });\n        },\n        async loadViewStockCount() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    // window.console.log(this.$route.params.id, 'id')\n                    const stockCount = this.inventoryAdjustment.stockCount || {}\n                    const stockCountId = stockCount.id || ''\n                    if (stockCountId !== '') {\n                        this.showLoading = true;\n                        billingHandler.inventoryAdjustmentList(\"?id=\" + stockCountId + '&type=Stock Count').then((res) => {\n                            if (res.data.statusCode === 200) {\n                                this.showLoading = false;\n                                this.stockCount = res.data.data[0];\n                            } else {\n                                this.showLoading = false\n                            }\n                        });\n                    }\n                }, 10);\n            });\n        },\n        async stockCountAdjustment() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    // window.console.log(this.$route.params.id, 'id')\n                    const stockCount = this.inventoryAdjustment.stockCount || {}\n                    const stockCountId = stockCount.id || ''\n                    const asOf = this.inventoryAdjustment.transactionDate || ''\n                    if (stockCountId !== '') {\n                        this.showLoading = true;\n                        this.itemLines = []\n                        productVariantHandler.stockCountAdjustment(\"?id=\" + stockCountId + '&asOf=' + asOf).then((res) => {\n                            if (res.data.statusCode === 200) {\n                                this.showLoading = false;\n                                this.itemLines = res.data.data\n                            } else {\n                                this.showLoading = false\n                            }\n                        });\n                    }\n                }, 10);\n            });\n        },\n    },\n    watch: {\n        id() {\n            // window.console.log('id--', this.$route.params.id)\n            if (this.$route.params.id === undefined) {\n                this.initData();\n            } else {\n                this.showLoading = true;\n                this.loadViewAdjustment();\n                this.showLoading = false;\n            }\n        },\n    },\n    created() {\n        // fetch the data when the view is created and the data is\n        // already being observed\n        // this.loadObj()\n    },\n    async mounted() {\n        await this.loadSaleFormContent();\n        await this.loadAccount();\n        await this.loadLocation();\n        await this.loadPrefix();\n        await this.loadSegment();\n        await this.loadProjects();\n        // await this.loadWarehouses()\n        // await this.loadEmployeeCenter();\n        await this.loadStockCount('Stock Count');\n    },\n    computed: {\n        hiddenButton() {\n            if (this.$route.query.type == \"edit\") {\n                return true;\n            } else {\n                return false;\n            }\n        },\n    },\n};\n</script>\n\n<style scoped>\n.small_sidebar {\n    height: 95%;\n    position: relative;\n    padding: 12px;\n}\n\n.hide_small_bar_class {\n    max-width: 0;\n    transition: 0.5s ease-in;\n    flex: 0 0 0;\n    padding: 0;\n}\n\n.hide_big_bar_class {\n    max-width: 100%;\n    transition: 0.5s ease-in;\n    flex: 0 0 100%;\n}\n\n.iconArrow {\n    right: -35px;\n    position: absolute;\n    bottom: -10px;\n}\n\n.iconArrowHide {\n    position: absolute;\n    right: -7px;\n    bottom: -10px;\n}\n\n.theme--light.v-data-table\n> .v-data-table__wrapper\n> table\n> tbody\n> tr:hover:not(.v-data-table__expanded__content):not(.v-data-table__empty-wrapper) {\n    background-color: transparent !important;\n}\n\n.detial_smallside_p {\n    /*position: absolute;*/\n    bottom: 10px;\n}\n</style>\n"]}]}