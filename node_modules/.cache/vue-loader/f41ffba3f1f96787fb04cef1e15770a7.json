{"remainingRequest":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/finances/CloseLoan.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/src/views/finances/CloseLoan.vue","mtime":1638499443230},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macos/Desktop/banhji-0.2/banhji-accounting-web-module/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBIZWxwZXIgZnJvbSAiQC9oZWxwZXIuanMiCmltcG9ydCBEYXRlUGlja2VyQ29tcG9uZW50IGZyb20gJ0AvY29tcG9uZW50cy9jdXN0b21fdGVtcGxhdGVzL0RhdGVQaWNrZXJDb21wb25lbnQnCi8vIGltcG9ydCB7RHJvcERvd25MaXN0fSBmcm9tICJAcHJvZ3Jlc3Mva2VuZG8tdnVlLWRyb3Bkb3ducyIKaW1wb3J0IGtlbmRvIGZyb20gIkBwcm9ncmVzcy9rZW5kby11aSIKY29uc3QgJCA9IGtlbmRvLmpRdWVyeQppbXBvcnQgQ2xvc2VMb2FuTW9kZWwgZnJvbSAnQC9zY3JpcHRzL2ZpbmFuY2luZy9tb2RlbC9DbG9zZUxvYW4nCgpjb25zdCBtZW1iZXJIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL21lbWJlckhhbmRsZXIiKQpjb25zdCBjdXN0b21lckhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvY3VzdG9tZXJIYW5kbGVyIikKY29uc3QgY3VycmVuY3lIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2N1cnJlbmN5L2hhbmRsZXIvY3VycmVuY3lIYW5kbGVyIikKLy8gY29uc3QgbG9hbkhhbmRsZXIgPSByZXF1aXJlKCJAL3NjcmlwdHMvbG9hbkhhbmRsZXIiKQpjb25zdCBiaWxsaW5nSGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9pbnZvaWNlL2hhbmRsZXIvYmlsbGluZ0hhbmRsZXIiKQpjb25zdCBwcmVmaXhIYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL3ByZWZpeEhhbmRsZXIiKQovLyBjb25zdCBhY2NvdW50SGFuZGxlciA9IHJlcXVpcmUoIkAvc2NyaXB0cy9hY2NvdW50SGFuZGxlciIpCmltcG9ydCB7YWNjb3VudEhhbmRsZXJ9IGZyb20gIkAvc2NyaXB0cy9BcHBIYW5kbGVycyI7Cgpjb25zdCB0ZXh0RmllbGQgPSAnbmFtZScKY29uc3Qga2V5RmllbGQgPSAnaWQnCmNvbnN0IGN1c3RvbWVySXRlbSA9IHtbdGV4dEZpZWxkXTogJ1NlbGVjdCBDdXN0b21lci4uLicsIFtrZXlGaWVsZF06IG51bGx9CmNvbnN0IG1lbWJlckl0ZW0gPSB7W3RleHRGaWVsZF06ICdTZWxlY3QgTWVtYmVyLi4uJywgW2tleUZpZWxkXTogbnVsbH0KY29uc3QgZW1wdHlJdGVtID0ge1t0ZXh0RmllbGRdOiAnbG9hZGluZyAuLi4nfQpjb25zdCBzdG9yZSA9IHJlcXVpcmUoIkAvaW5zdGl0dXRlLmpzIikKY29uc3Qge2Nvb2tpZXN9ID0gc3RvcmUuZGVmYXVsdC5zdGF0ZQoKLy8gam91cm5hbAppbXBvcnQge0pvdXJuYWxNb2RlbCwgVXNlck1vZGVsfSBmcm9tICJAL3NjcmlwdHMvbW9kZWwvQXBwTW9kZWxzIgppbXBvcnQgc2FsZUZvcm1Db250ZW50SGFuZGxlciBmcm9tICJAL3NjcmlwdHMvc2FsZUZvcm1Db250ZW50SGFuZGxlciI7CmNvbnN0IHsgam91cm5hbEhhbmRsZXIgfSA9IHJlcXVpcmUoIkAvc2NyaXB0cy9BcHBIYW5kbGVycyIpOwpjb25zdCB7RW50aXR5VHlwZX0gPSByZXF1aXJlKCJAL3NjcmlwdHMvZGVmYXVsdF9zZXR1cC9Db2xsZWN0aW9ucyIpCmNvbnN0IGxvYW5IYW5kbGVyID0gcmVxdWlyZSgiQC9zY3JpcHRzL2ZpbmFuY2luZy9oYW5kbGVyL2xvYW5IYW5kbGVyIikKaW1wb3J0IFZ1ZU51bWVyaWMgZnJvbSAndnVlLW51bWVyaWMnCmltcG9ydCBMb2FuVHlwZSBmcm9tICJAL3NjcmlwdHMvZGVmYXVsdF9zZXR1cC9Mb2FuVHlwZS5qcyI7CmV4cG9ydCBkZWZhdWx0IHsKICAgIGRhdGE6ICgpID0+ICh7CiAgICAgICAgdmFsaWQ6IHRydWUsCiAgICAgICAgc2hvd0xvYWRpbmc6IGZhbHNlLAogICAgICAgIHNob3dMb2FkaW5nRGF0YTogZmFsc2UsCiAgICAgICAgc2hvd0xvYWRpbmdMb2FuOiBmYWxzZSwKICAgICAgICBlcnJvcnM6IFtdLAogICAgICAgIHVzZXI6IG5ldyBVc2VyTW9kZWwoY29va2llcy51c2VyKSwKICAgICAgICBsb2FkaW5nQWxlcnQ6IGZhbHNlLAogICAgICAgIGxvYWRpbmdDb2xvckFsZXJ0OiAnJywKICAgICAgICBsb2FkaW5nVGV4dEFsZXJ0OiAnJywKICAgICAgICB0ZXh0RmllbGQ6ICduYW1lJywKICAgICAgICBkYXRhSXRlbUtleTogJ2lkJywKICAgICAgICBzZWxlY3RNZW1iZXI6ICdpc01lbWJlcicsCiAgICAgICAgaXNNZW1iZXI6IHRydWUsCiAgICAgICAgaXNDdXN0b206IGZhbHNlLAogICAgICAgIGNhc2hBY2NvdW50czogW10sCiAgICAgICAgc2FsZUZvcm1Db250ZW50OiB7fSwKICAgICAgICBjdXJyZW5jeUNvZGU6ICcnLAogICAgICAgIGludm9pY2VUeXBlOiB7fSwKICAgICAgICBsYXN0TnVtYmVyOiB7fSwKICAgICAgICBzY2hlZHVsZUFSOiBbXSwKICAgICAgICBsb2FuQW1vdW50OiAwLAogICAgICAgIHJhdGU6IDEsCiAgICAgICAgLy8KICAgICAgICBkaXNidXJzTGlzdDogW10sCiAgICAgICAgbDogbmV3IENsb3NlTG9hbk1vZGVsKHt9KSwKICAgICAgICBsb2FuOiB7fSwKICAgICAgICBsb2FuTGlzdDogW10sCiAgICAgICAgdG90YWxQYXltZW50OiAwLAogICAgICAgIG1vbnRobHlQYXltZW50OiAwLAogICAgICAgIHRvdGFsSW50ZXJlc3Q6IDAsCiAgICAgICAgLy9jdXN0b21lcgogICAgICAgIGN1c0Jhc2VVcmw6IGN1c3RvbWVySGFuZGxlci5zZWFyY2goKSwKICAgICAgICBjdXN0b21lckxpc3Q6IFtdLAogICAgICAgIGN1c3RvbWVySXRlbTogY3VzdG9tZXJJdGVtLAogICAgICAgIGN1c3RvbWVyZmlsdGVyOiAnJywKICAgICAgICAvL21lbWJlcgogICAgICAgIG1lbUJhc2VVcmw6IG1lbWJlckhhbmRsZXIuc2VhcmNoKCksCiAgICAgICAgbWVtYmVyTGlzdDogW10sCiAgICAgICAgbWVtYmVySXRlbTogbWVtYmVySXRlbSwKICAgICAgICBtZW1iZXJmaWx0ZXI6ICcnLAogICAgICAgIGRlY2ltYWxzOiBbXSwKICAgICAgICBudW1iZXJGb3JtYXQ6ICdjMCcsCiAgICAgICAgbWVtYmVyRGF0YTogW10sCiAgICAgICAgLy9qb3VybmFsCiAgICAgICAgam91cm5hbE51bWJlcjogJycsCiAgICAgICAgam91cm5hbFByZWZpeDogJycsCiAgICAgICAgam91cm5hbFR4blR5cGU6IEVudGl0eVR5cGUuSk9VUk5BTCwKICAgICAgICBsb2dnZWRVc2VyOiBuZXcgVXNlck1vZGVsKGNvb2tpZXMudXNlciksCiAgICAgICAgc2VnbWVudHM6IFtdLAogICAgICAgIHNlZ21lbnQ6IHt9LAogICAgICAgIGFjY291bnROYW1lOiAnbmFtZScsCiAgICAgICAgdG90YWxSZW1haW5uaW5nOiAwLAogICAgICAgIHBlbmFsdHlBY2NvdW50OiB7fSwKICAgICAgICBvbGRJbnRlcmVzdDogMCwKICAgICAgICBpbnB1dERlYzogMiwKICAgICAgICBwZW5hbHR5QWNjb3VudHM6IFtdLAogICAgICAgIHRyYW5zYWN0aW9uVHlwZToge30sCiAgICAgICAgc3VmZml4OiAnJwogICAgfSksCiAgICBjb21wb25lbnRzOiB7CiAgICAgICAgJ2FwcC1kYXRlcGlja2VyJzogRGF0ZVBpY2tlckNvbXBvbmVudCwKICAgICAgICBMb2FkaW5nTWU6ICgpID0+IGltcG9ydChgQC9jb21wb25lbnRzL0xvYWRpbmdgKSwKICAgICAgICBWdWVOdW1lcmljCiAgICB9LAogICAgbWV0aG9kczogewogICAgICAgIHJvd051bWJlclRtcGwoZGF0YUl0ZW0pIHsKICAgICAgICAgICAgbGV0IGRzID0gdGhpcy4kcmVmcy5zY2hlZHVsZUFSLmtlbmRvV2lkZ2V0KCksCiAgICAgICAgICAgICAgICBpbmRleCA9IGRzLmluZGV4T2YoZGF0YUl0ZW0pOwogICAgICAgICAgICBpZiAoaW5kZXggPT09ICh0aGlzLnNjaGVkdWxlQVIubGVuZ3RoIC0gMSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAnJwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGluZGV4ICsgMQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FuQ2hhbmdlKCkgewogICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2codGhpcy5sLmxvYW4sICdsb2FuJykKICAgICAgICAgICAgdGhpcy5jdXJyZW5jeUNvZGUgPSB0aGlzLmwubG9hbi5jdXJyZW5jeS5jb2RlCiAgICAgICAgICAgIGF3YWl0IHRoaXMubG9hZFRyYW5zYWN0aW9uUmF0ZSgpCiAgICAgICAgICAgIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgncmVzb2x2ZWQnKQogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmdMb2FuID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIGxvYW5IYW5kbGVyLmxvYW5TY2hlZHVsZUdldCh0aGlzLmwubG9hbi5pZCkudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZ0xvYW4gPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRhdGEgPSByZXMuZGF0YS5kYXRhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coZGF0YSwgJ3NjaGVkdWxlJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0b3RhbCA9IDAsIHNlbGYgPSB0aGlzLCBpbnQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNjaGVkdWxlQVIgPSBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGRhdGEsIGZ1bmN0aW9uIChpLHYpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHYuc3RhdHVzID09IDEpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbCArPSBwYXJzZUZsb2F0KHYuZGF0YS5wcmluY2lwYWwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCArPSBwYXJzZUZsb2F0KHYuZGF0YS5pbnRlcmVzdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zY2hlZHVsZUFSLnB1c2godikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50b3RhbFJlbWFpbm5pbmcgPSB0b3RhbCArIGludAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sLmludGVyZXN0ID0gaW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9sZEludGVyZXN0ID0gaW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmwucHJpbmNpcGFsID0gdG90YWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0TGFzdE51bSgpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaCgpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAzMDApCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBhZGRUb3RhbCgpIHsKICAgICAgICAgICAgdGhpcy5zY2hlZHVsZUFSLnB1c2goewogICAgICAgICAgICAgICAgcHJpbmNpcGFsX3I6ICcnLAogICAgICAgICAgICAgICAgcHJpbmNpcGFsOiBwYXJzZUZsb2F0KHRoaXMubG9hbi5hbW91bnQpLAogICAgICAgICAgICAgICAgaW50ZXJlc3Q6IHRoaXMudG90YWxJbnRlcmVzdCwKICAgICAgICAgICAgICAgIHRvdGFsOiB0aGlzLnRvdGFsUGF5bWVudCwKICAgICAgICAgICAgICAgIGRhdGU6ICdUb3RhbCcsCiAgICAgICAgICAgICAgICBsb2NhbGU6IHRoaXMuY3VycmVuY3lDb2RlLAogICAgICAgICAgICAgICAgbnVtYmVyRm9ybWF0OiB0aGlzLm51bWJlckZvcm1hdCwKICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uX251bWJlcjogJycsCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLnNjaGVkdWxlQVIsICdsb2FuIHNjaGVkdWxlJykKICAgICAgICB9LAogICAgICAgIG1ha2VCYWxhbmNlKGFtdCkgewogICAgICAgICAgICBsZXQgaWR4ID0gcGFyc2VGbG9hdCh0aGlzLmxvYW4ucGVyaW9kKSAtIDEKICAgICAgICAgICAgbGV0IG9hbXQgPSB0aGlzLnNjaGVkdWxlQVJbaWR4XS5wcmluY2lwYWwKICAgICAgICAgICAgbGV0IG5hbXQgPSBvYW10ICsgYW10CiAgICAgICAgICAgIG5hbXQgPSBwYXJzZUZsb2F0KG5hbXQudG9GaXhlZCh0aGlzLnNhbGVGb3JtQ29udGVudC5kZWNpbWFsKSkKICAgICAgICAgICAgdGhpcy5zY2hlZHVsZUFSW2lkeF0ucHJpbmNpcGFsID0gbmFtdAogICAgICAgICAgICB0aGlzLnNjaGVkdWxlQVJbaWR4XS50b3RhbCA9IHRoaXMuc2NoZWR1bGVBUltpZHhdLmludGVyZXN0ICsgbmFtdAogICAgICAgIH0sCiAgICAgICAgZml4UmF0ZShQLCByLCB0KSB7CiAgICAgICAgICAgIC8vIHZhciBDID0gMDsKICAgICAgICAgICAgLy8gdmFyIGEgPSBQKnI7CiAgICAgICAgICAgIC8vIHZhciBiID0gTWF0aC5wb3coKDErciksIHQpOwogICAgICAgICAgICAvLyAgICAgYiA9IHBhcnNlRmxvYXQoYi50b0ZpeGVkKDIpKTsKICAgICAgICAgICAgLy8gdmFyIGMgPSAxL2I7CiAgICAgICAgICAgIC8vIHZhciBkID0gMSAtIGM7CiAgICAgICAgICAgIC8vICAgICBkID0gcGFyc2VGbG9hdChkLnRvRml4ZWQoMikpOwogICAgICAgICAgICAvLyBDID0gYS9kOwogICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhQKyItLSIrcisiLS0iK3QpOwogICAgICAgICAgICAvLyByZXR1cm4gQzsKICAgICAgICAgICAgbGV0IGwgPSAxIC8gdCwgaSA9IHIgKiBsLCBuID0gdAogICAgICAgICAgICBsZXQgZW1pID0gaSAqIFAgLyBbMSAtIE1hdGgucG93KCgxICsgaSksIC1uKV0KICAgICAgICAgICAgcmV0dXJuIGVtaQogICAgICAgIH0sCiAgICAgICAgZXJyb3JNZXNzYWdlKCkgewogICAgICAgIH0sCiAgICAgICAgemVyb1BhZChudW0sIHBsYWNlcykgewogICAgICAgICAgICByZXR1cm4gU3RyaW5nKG51bSkucGFkU3RhcnQocGxhY2VzLCAnMCcpCiAgICAgICAgfSwKICAgICAgICAvLyBhc3luYyBsb2FkUHJlZml4KCkgewogICAgICAgIC8vICAgICBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHsKICAgICAgICAvLyAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIC8vICAgICAgICAgICAgIHJlc29sdmUoJ3Jlc29sdmVkJyk7CiAgICAgICAgLy8gICAgICAgICAgICAgcHJlZml4SGFuZGxlci5nZXQoJ2ludm9pY2UnKS50aGVuKHJlcyA9PiB7CiAgICAgICAgLy8gICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZQogICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnZvaWNlVHlwZSA9IHJlcy5kYXRhLmRhdGFbMF0KICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0SW52b2ljZUxhc3ROdW1iZXIoKQogICAgICAgIC8vICAgICAgICAgICAgICAgICB9CiAgICAgICAgLy8gICAgICAgICAgICAgfSkKICAgICAgICAvLyAgICAgICAgIH0sIDMwMCk7CiAgICAgICAgLy8gICAgIH0pCiAgICAgICAgLy8gfSwKICAgICAgICBnZXRJbnZvaWNlTGFzdE51bWJlcigpIHsKICAgICAgICAgICAgbGV0IGRhdGEgPSB7CiAgICAgICAgICAgICAgICBhYmJyOiB0aGlzLmludm9pY2VUeXBlLmFiYnIsCiAgICAgICAgICAgICAgICBzdHJ1Y3R1cmU6IHRoaXMuaW52b2ljZVR5cGUuc3RydWN0dXJlLAogICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25EYXRlOiB0aGlzLmwuaXNzdWVkRGF0ZSwKICAgICAgICAgICAgICAgIHNlcXVjZW5jaW5nOiB0aGlzLmludm9pY2VUeXBlLnNlcXVjZW5jaW5nLAogICAgICAgICAgICAgICAgdHlwZTogJ0ludm9pY2UnLAogICAgICAgICAgICAgICAgZW50aXR5OiAxCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYmlsbGluZ0hhbmRsZXIubGFzdE51bWJlcihkYXRhKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMubGFzdE51bWJlciA9IHJlc3BvbnNlLmRhdGEuZGF0YQogICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLmxhc3ROdW1iZXIsICdsYXN0IG51bWJlcicpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgICAgICAgICAgdGhpcy5lcnJvcnMucHVzaChlKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgZ2V0TG9hbigpIHsKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHRoaXMubC5tZW1iZXIpCiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlCiAgICAgICAgICAgIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgncmVzb2x2ZWQnKTsKICAgICAgICAgICAgICAgICAgICBtZW1iZXJIYW5kbGVyLmdldExvYW5CeU1lbWJlcklkKHRoaXMubC5tZW1iZXIuaWQpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hbkxpc3QgPSByZXMuZGF0YS5kYXRhLmZpbHRlcigob2JqKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqLnN0YXR1cyA9PSAzCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sIDMwMCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICAvL2N1c3RvbWVyCiAgICAgICAgb25DdXN0b21lckNoYW5nZShldmVudCkgewogICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGV2ZW50LnZhbHVlCiAgICAgICAgICAgIGlmICh2YWx1ZSAmJiB2YWx1ZVt0ZXh0RmllbGRdID09PSBlbXB0eUl0ZW1bdGV4dEZpZWxkXSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuY3VzdG9tZXIgPSB2YWx1ZQogICAgICAgICAgICB0aGlzLmwuY3VzdG9tZXIgPSB2YWx1ZQogICAgICAgICAgICB0aGlzLmdldExvYW4oKQogICAgICAgIH0sCiAgICAgICAgb25DdXN0b21lckZpbHRlckNoYW5nZShldmVudCkgewogICAgICAgICAgICBjb25zdCBmaWx0ZXIgPSBldmVudC5maWx0ZXIudmFsdWUKICAgICAgICAgICAgdGhpcy5jdXN0b21lclJlcXVlc3REYXRhKDAsIGZpbHRlciwgdGhpcy5jdXNCYXNlVXJsKQogICAgICAgICAgICB0aGlzLmN1c3RvbWVyZmlsdGVyID0gZmlsdGVyCiAgICAgICAgfSwKICAgICAgICBjdXN0b21lclJlcXVlc3REYXRhKHNraXAsIGZpbHRlciwgYmFzZVVybCkgewogICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2coYmFzZVVybCwgJ3JlcXUnKQogICAgICAgICAgICBjb25zdCB1cmwgPSBiYXNlVXJsICsKICAgICAgICAgICAgICAgIGA/ZmlsdGVyPSR7ZmlsdGVyfWAKICAgICAgICAgICAgdGhpcy5yZXF1ZXN0U3RhcnRlZCA9IHRydWU7CiAgICAgICAgICAgIGZldGNoKHVybCkKICAgICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAudGhlbih0aGlzLmN1c3RvbWVyQWZ0ZXJGZXRjaCkKICAgICAgICB9LAogICAgICAgIGN1c3RvbWVyQWZ0ZXJGZXRjaChqc29uKSB7CiAgICAgICAgICAgIHRoaXMuY3VzdG9tZXJMaXN0ID0ganNvbi5kYXRhCiAgICAgICAgfSwKICAgICAgICAvL21lbWJlcgogICAgICAgIHNlbGVjdE1lbWJlckNoYW5nZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0TWVtYmVyID09ICdpc01lbWJlcicpIHsKICAgICAgICAgICAgICAgIHRoaXMubG9hbi5pc01lbWJlciA9IDEKICAgICAgICAgICAgICAgIHRoaXMubWVtYmVyRGF0YSA9IHRoaXMubWVtYmVyTGlzdAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5sb2FuLmlzTWVtYmVyID0gMgogICAgICAgICAgICAgICAgdGhpcy5tZW1iZXJEYXRhID0gdGhpcy5jdXN0b21lckxpc3QKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmxvYW4ubWVtYmVyID0ge30KICAgICAgICB9LAogICAgICAgIG9uTWVtYmVyQ2hhbmdlKCkgewogICAgICAgICAgICB0aGlzLmdldExvYW4oKQogICAgICAgIH0sCiAgICAgICAgb25NZW1iZXJGaWx0ZXJDaGFuZ2UoZXZlbnQpIHsKICAgICAgICAgICAgY29uc3QgZmlsdGVyID0gZXZlbnQuZmlsdGVyLnZhbHVlCiAgICAgICAgICAgIHRoaXMubWVtYmVyUmVxdWVzdERhdGEoMCwgZmlsdGVyLCB0aGlzLm1lbUJhc2VVcmwpCiAgICAgICAgICAgIHRoaXMubWVtYmVyZmlsdGVyID0gZmlsdGVyCiAgICAgICAgfSwKICAgICAgICBtZW1iZXJSZXF1ZXN0RGF0YShza2lwLCBmaWx0ZXIsIGJhc2VVcmwpIHsKICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKGJhc2VVcmwsICdyZXF1JykKICAgICAgICAgICAgY29uc3QgdXJsID0gYmFzZVVybCArCiAgICAgICAgICAgICAgICBgP2ZpbHRlcj0ke2ZpbHRlcn1gCiAgICAgICAgICAgIHRoaXMucmVxdWVzdFN0YXJ0ZWQgPSB0cnVlOwogICAgICAgICAgICBmZXRjaCh1cmwpCiAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLnRoZW4odGhpcy5tZW1iZXJBZnRlckZldGNoKQogICAgICAgIH0sCiAgICAgICAgbWVtYmVyQWZ0ZXJGZXRjaChqc29uKSB7CiAgICAgICAgICAgIHRoaXMubWVtYmVyTGlzdCA9IGpzb24uZGF0YQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFRyYW5zYWN0aW9uUmF0ZSgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCdyZXNvbHZlZCcpCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHRoaXMubC5pc3N1ZWREYXRlKS50b0lTT1N0cmluZygpLnN1YnN0cigwLCAxMCkKICAgICAgICAgICAgICAgICAgICBsZXQgY29kZSA9IHRoaXMuY3VycmVuY3lDb2RlCiAgICAgICAgICAgICAgICAgICAgaWYgKGNvZGUgIT09IHVuZGVmaW5lZCB8fCBjb2RlICE9PSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUhhbmRsZXIuZ2V0TGFzdEV4Y2hhbmdlUmF0ZUJ5RGF0ZShkYXRlLCBjb2RlKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSByZXMuZGF0YS5kYXRhWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2luZG93LmNvbnNvbGUubG9nKHJlc3BvbnNlLCAnY3VycmVuY3kgcmF0ZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoT2JqZWN0LmtleXMocmVzcG9uc2UpLmxlbmd0aCA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV4Y2hhbmdlUmF0ZSA9IHJlc3BvbnNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubC5leGNoYW5nZVJhdGUgPSB0aGlzLmV4Y2hhbmdlUmF0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmwucmF0ZSA9IHJlc3BvbnNlLnJhdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yYXRlID0gcmVzcG9uc2UucmF0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LmVycm9yKCdQbGVhc2Ugc2V0IGV4Y2hhbmdlIHJhdGUgb24gY3VycmVuY3kgc2V0dGluZycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FuY2VsKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMzAwKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZERlY2ltYWwoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgncmVzb2x2ZWQnKTsKICAgICAgICAgICAgICAgICAgICBsb2FuSGFuZGxlci5kZWNpbWFsR2V0KCkudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRlY2ltYWxzID0gcmVzLmRhdGEuZGF0YQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LCAzMDApOwogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgbnVtYmVyRm9ybWF0YSh2YWx1ZSkgewogICAgICAgICAgICBpZiAodGhpcy5jdXJyZW5jeUNvZGUpIHsKICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VGbG9hdCh2YWx1ZSkKICAgICAgICAgICAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyh2YWx1ZSwgdGhpcy5udW1iZXJGb3JtYXQpCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIC8vZnVuY3Rpb24KICAgICAgICBhc3luYyBhZGRFbXB0eSgpIHsKICAgICAgICAgICAgdGhpcy5sID0gbmV3IENsb3NlTG9hbk1vZGVsKHt9KQogICAgICAgICAgICB0aGlzLmxvYW4gPSB7fQogICAgICAgICAgICB0aGlzLmN1c3RvbWVyID0ge30KICAgICAgICAgICAgdGhpcy5tZW1iZXIgPSB7fQogICAgICAgICAgICB0aGlzLmwuY2FzaEFjY291bnQgPSB0aGlzLmNhc2hBY2NvdW50c1swXQogICAgICAgICAgICB0aGlzLmN1cnJlbmN5Q29kZSA9ICcnCiAgICAgICAgICAgIGF3YWl0IHRoaXMubG9hZExvYW4oKQogICAgICAgIH0sCiAgICAgICAgY2FuY2VsKCkgewogICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5nbygtMSkKICAgICAgICB9LAogICAgICAgIHNhdmVOZXcoKSB7CiAgICAgICAgICAgIHRoaXMuaXNTYXZlTmV3ID0gdHJ1ZQogICAgICAgICAgICB0aGlzLnNhdmVPcHRpb24gPSAnc2F2ZU5ldycKICAgICAgICAgICAgdGhpcy5zYXZlKCkKICAgICAgICB9LAogICAgICAgIHNhdmVDbG9zZSgpIHsKICAgICAgICAgICAgdGhpcy5pc1NhdmVOZXcgPSBmYWxzZQogICAgICAgICAgICB0aGlzLnNhdmVPcHRpb24gPSAnc2F2ZUNsb3NlJwogICAgICAgICAgICB0aGlzLmFkZEpvdXJuYWwoKQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgc2F2ZSgpIHsKICAgICAgICAgICAgdGhpcy5sLnNhdmVPcHRpb24gPSB0aGlzLnNhdmVPcHRpb24KICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZ0RhdGEgPSB0cnVlCiAgICAgICAgICAgIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgncmVzb2x2ZWQnKTsKICAgICAgICAgICAgICAgICAgICBsb2FuSGFuZGxlci5jbG9zZUxvYW5DcmVhdGUobmV3IENsb3NlTG9hbk1vZGVsKHRoaXMubCkpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nRGF0YSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5zdWNjZXNzKCdTdWNjZXNzZnVsbHknKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lmhpc3RvcnkuZ28oLTEpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaChlID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcignU29tZXRoaW5nIHdlbnQgd3JvbmcnKQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9ycy5wdXNoKGUpCiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhlLCAnZXJyb3InKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LCAzMDApOwogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFNlZ21lbnQoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgncmVzb2x2ZWQnKQogICAgICAgICAgICAgICAgICAgIHRoaXMuc2VnbWVudCA9IHt9CiAgICAgICAgICAgICAgICAgICAgbG9hbkhhbmRsZXIuYnVzaW5lc3NTZXR0aW5nR2V0KCkudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzID0gcmVzLmRhdGEuZGF0YS5maWx0ZXIoKG9iaikgPT4ge3JldHVybiBvYmoudHlwZSA9PSAiQ3JlZGl0In0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihzLmxlbmd0aCA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VnbWVudCA9IHNbMF0uc2VnbWVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcignUGxlYXNlIHNlbGVjdCBzZWdtZW50IG9uIHNldHRpbmcgcGFnZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW5jZWwoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMzAwKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZEFjY291bnQoKSB7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgncmVzb2x2ZWQnKTsKICAgICAgICAgICAgICAgICAgICBhY2NvdW50SGFuZGxlci5nZXRBbGwoKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAvLyB3aW5kb3cuY29uc29sZS5sb2cocmVzLCAnYWNjJykKICAgICAgICAgICAgICAgICAgICAgICAgLy9SZWNlaXZhYmxlIEFjY291bnQKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXNoQWNjb3VudHMgPSByZXMuZGF0YS5maWx0ZXIobSA9PiBtLmFjY291bnRfdHlwZS5udW1iZXIgPT09IDEpLm1hcChpdG0gPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogaXRtLnV1aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXVpZDogaXRtLnV1aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogaXRtLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxfbmFtZTogaXRtLmxvY2FsX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyOiBpdG0ubnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX3RheGFibGU6IGl0bS5pc190YXhhYmxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhbmhqaUFjY0NvZGU6IGl0bS5iYW5oamlBY2NDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwX2NvZGU6IGl0bS5ncm91cF9jb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudF9hY2NvdW50OiBpdG0ucGFyZW50X2FjY291bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZV9jb2RlOiBpdG0udHlwZV9jb2RlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGVuYWx0eUFjY291bnRzID0gcmVzLmRhdGEuZmlsdGVyKG0gPT4gbS5hY2NvdW50X3R5cGUubnVtYmVyID09PSAzOCkubWFwKGl0bSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBpdG0udXVpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dWlkOiBpdG0udXVpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBpdG0ubmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9uYW1lOiBpdG0ubG9jYWxfbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IGl0bS5udW1iZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNfdGF4YWJsZTogaXRtLmlzX3RheGFibGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFuaGppQWNjQ29kZTogaXRtLmJhbmhqaUFjY0NvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBfY29kZTogaXRtLmdyb3VwX2NvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50X2FjY291bnQ6IGl0bS5wYXJlbnRfYWNjb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlX2NvZGU6IGl0bS50eXBlX2NvZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucGVuYWx0eUFjY291bnRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubC5wZW5hbHR5QWNjb3VudCA9IHRoaXMucGVuYWx0eUFjY291bnRzWzBdCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2FzaEFjY291bnRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubC5jYXNoQWNjb3VudCA9IHRoaXMuY2FzaEFjY291bnRzWzBdCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwgMzAwKTsKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIC8vIGpvdW5hbAogICAgICAgIGFzeW5jIGdldEpvdXJuYWxOdW1iZXIoKSB7CiAgICAgICAgICAgIGxldCBudW0gPSBhd2FpdCBIZWxwZXIuZ2VuZXJhdGVBY2NvdW50aW5nTnVtYmVyKHRoaXMuam91cm5hbFR4blR5cGUsIHRoaXMubC5pc3N1ZWREYXRlKQogICAgICAgICAgICB0aGlzLmpvdXJuYWxOdW1iZXIgPSBudW0ubnVtYmVyCiAgICAgICAgICAgIHRoaXMuam91cm5hbFByZWZpeCA9IG51bS5wcmVmaXhfZm9ybWF0CiAgICAgICAgICAgIHRoaXMubC5qb3VybmFsTnVtYmVyID0gbnVtLm51bWJlcgogICAgICAgIH0sCiAgICAgICAgYXN5bmMgYWRkSm91cm5hbCgpewogICAgICAgICAgICBjb25zdCBvYmogPSB0aGlzLmwKICAgICAgICAgICAgLy8gY29uc3Qgc2VnID0gdGhpcy5zZWdtZW50CiAgICAgICAgICAgIGlmICghdGhpcy4kcmVmcy5mb3JtLnZhbGlkYXRlKCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuJHJlZnMuZm9ybS52YWxpZGF0ZSgpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBpZih0aGlzLnNjaGVkdWxlQVIubGVuZ3RoID09IDApewogICAgICAgICAgICAgICAgdGhpcy5sLnVzZXIgPSB0aGlzLmxvZ2dlZFVzZXIKICAgICAgICAgICAgICAgIHRoaXMubC50b3RhbEFtb3VudCA9IHRoaXMudG90YWxSZW1haW5uaW5nCiAgICAgICAgICAgICAgICB0aGlzLmwuc2NoZWR1bGVzID0gdGhpcy5zY2hlZHVsZUFSCiAgICAgICAgICAgICAgICB0aGlzLnNhdmUoKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gbGV0IGN1c3RvbWVyID0gb2JqLm1lbWJlcgogICAgICAgICAgICAvLyBpZihPYmplY3Qua2V5cyhjdXN0b21lcikubGVuZ3RoID09IDApewogICAgICAgICAgICAvLyAgICAgdGhpcy4kc25vdGlmeS5lcnJvcignUGxlYXNlIHNlbGVjdCBhIG1lbWJlciBvciBjdXN0b21lcicpCiAgICAgICAgICAgIC8vICAgICByZXR1cm4KICAgICAgICAgICAgLy8gfQogICAgICAgICAgICBpZihPYmplY3Qua2V5cyhvYmoubG9hbikubGVuZ3RoID09IDApewogICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcignUGxlYXNlIHNlbGVjdCBhIGxvYW4gbnVtYmVyJykKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlCiAgICAgICAgICAgIGxldCBhbXQgPSBwYXJzZUZsb2F0KHRoaXMudG90YWxSZW1haW5uaW5nKSArIHBhcnNlRmxvYXQob2JqLnBlbmFsdHkpCiAgICAgICAgICAgIGxldCBqb3VybkxpbmUgPSBbXQogICAgICAgICAgICBqb3VybkxpbmUucHVzaCh7CiAgICAgICAgICAgICAgICAidXVpZCI6ICIiLAogICAgICAgICAgICAgICAgImFjY291bnQiOiBvYmoubG9hbi5sb2FuQWNjb3VudCwKICAgICAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6IG9iai5ub3RlLAogICAgICAgICAgICAgICAgInByaW1hcnlfY29udGFjdCI6IHt9LAogICAgICAgICAgICAgICAgInRoaXJkX2NvbnRhY3RzIjogW10sCiAgICAgICAgICAgICAgICAicmVmX251bWJlciI6ICcnLAogICAgICAgICAgICAgICAgImFtb3VudCI6IHBhcnNlRmxvYXQoYW10KSwKICAgICAgICAgICAgICAgICJkaXNjb3VudCI6IHt9LAogICAgICAgICAgICAgICAgIm1hcmtfdXAiOiAwLAogICAgICAgICAgICAgICAgImJpbGxhYmxlIjogMCwKICAgICAgICAgICAgICAgICJ0YXhfY29kZSI6ICIiLAogICAgICAgICAgICAgICAgInBheW1lbnRfbWV0aG9kIjoge30sCiAgICAgICAgICAgICAgICAiY3VycmVuY3kiOiB0aGlzLmV4Y2hhbmdlUmF0ZSwKICAgICAgICAgICAgICAgICJleGNoYW5nZV9yYXRlX3V1aWQiOiAiIiwKICAgICAgICAgICAgICAgICJleGNoYW5nZV9yYXRlIjogdGhpcy5yYXRlLAogICAgICAgICAgICAgICAgImV4Y2hhbmdlZF9hbW91bnQiOiBwYXJzZUZsb2F0KGFtdCkgKiBwYXJzZUZsb2F0KHRoaXMucmF0ZSksCiAgICAgICAgICAgICAgICAidGF4X2Ftb3VudCI6IDAsCiAgICAgICAgICAgICAgICAiZXhjaGFuZ2VkX3RheF9hbW91bnQiOiAwLAogICAgICAgICAgICAgICAgImlzX3JlY29uY2lsZWQiOiAwLAogICAgICAgICAgICAgICAgImlzX3NldHRsZWQiOiAwLAogICAgICAgICAgICAgICAgImNsYXNzXzFfdXVpZCI6ICIiLAogICAgICAgICAgICAgICAgImNsYXNzXzJfdXVpZCI6ICIiLAogICAgICAgICAgICAgICAgImNsYXNzXzNfdXVpZCI6ICIiLAogICAgICAgICAgICAgICAgImNsYXNzXzRfdXVpZCI6ICIiLAogICAgICAgICAgICAgICAgImNsYXNzXzVfdXVpZCI6ICIiLAogICAgICAgICAgICAgICAgInBheW1lbnRfbWV0aG9kX2FzIjogIiIsCiAgICAgICAgICAgICAgICAiY3JlYXRlZF9ieSI6IG51bGwsCiAgICAgICAgICAgICAgICAibW9kaWZpZWRfYnkiOiBudWxsLAogICAgICAgICAgICAgICAgImNyZWF0ZWRfZGF0ZSI6IG51bGwsCiAgICAgICAgICAgICAgICAibW9kaWZpZWRfZGF0ZSI6IG51bGwKICAgICAgICAgICAgfSkKICAgICAgICAgICAgam91cm5MaW5lLnB1c2goewogICAgICAgICAgICAgICAgInV1aWQiOiAiIiwKICAgICAgICAgICAgICAgICJhY2NvdW50Ijogb2JqLmNhc2hBY2NvdW50LAogICAgICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogdGhpcy5qb3VybmFsLmRlc2NyaXB0aW9uLAogICAgICAgICAgICAgICAgInByaW1hcnlfY29udGFjdCI6IHt9LAogICAgICAgICAgICAgICAgInRoaXJkX2NvbnRhY3RzIjogW10sCiAgICAgICAgICAgICAgICAicmVmX251bWJlciI6ICcnLAogICAgICAgICAgICAgICAgImFtb3VudCI6IChwYXJzZUZsb2F0KHRoaXMudG90YWxSZW1haW5uaW5nKSAqIC0xKSwKICAgICAgICAgICAgICAgICJkaXNjb3VudCI6IHt9LAogICAgICAgICAgICAgICAgIm1hcmtfdXAiOiAwLAogICAgICAgICAgICAgICAgImJpbGxhYmxlIjogMCwKICAgICAgICAgICAgICAgICJ0YXhfY29kZSI6ICIiLAogICAgICAgICAgICAgICAgInBheW1lbnRfbWV0aG9kIjoge30sCiAgICAgICAgICAgICAgICAiY3VycmVuY3kiOiB0aGlzLmV4Y2hhbmdlUmF0ZSwKICAgICAgICAgICAgICAgICJleGNoYW5nZV9yYXRlX3V1aWQiOiAiIiwKICAgICAgICAgICAgICAgICJleGNoYW5nZV9yYXRlIjogdGhpcy5yYXRlLAogICAgICAgICAgICAgICAgImV4Y2hhbmdlZF9hbW91bnQiOiAoKHBhcnNlRmxvYXQodGhpcy50b3RhbFJlbWFpbm5pbmcpICogLTEpKnBhcnNlRmxvYXQodGhpcy5yYXRlKSksCiAgICAgICAgICAgICAgICAidGF4X2Ftb3VudCI6IDAsCiAgICAgICAgICAgICAgICAiZXhjaGFuZ2VkX3RheF9hbW91bnQiOiAwLAogICAgICAgICAgICAgICAgImlzX3JlY29uY2lsZWQiOiAwLAogICAgICAgICAgICAgICAgImlzX3NldHRsZWQiOiAwLAogICAgICAgICAgICAgICAgImNsYXNzXzFfdXVpZCI6ICIiLAogICAgICAgICAgICAgICAgImNsYXNzXzJfdXVpZCI6ICIiLAogICAgICAgICAgICAgICAgImNsYXNzXzNfdXVpZCI6ICIiLAogICAgICAgICAgICAgICAgImNsYXNzXzRfdXVpZCI6ICIiLAogICAgICAgICAgICAgICAgImNsYXNzXzVfdXVpZCI6ICIiLAogICAgICAgICAgICAgICAgInBheW1lbnRfbWV0aG9kX2FzIjogIiIsCiAgICAgICAgICAgICAgICAiY3JlYXRlZF9ieSI6IG51bGwsCiAgICAgICAgICAgICAgICAibW9kaWZpZWRfYnkiOiBudWxsLAogICAgICAgICAgICAgICAgImNyZWF0ZWRfZGF0ZSI6IG51bGwsCiAgICAgICAgICAgICAgICAibW9kaWZpZWRfZGF0ZSI6IG51bGwKICAgICAgICAgICAgfSkKICAgICAgICAgICAgaWYob2JqLnBlbmFsdHkgPiAwKXsKICAgICAgICAgICAgICAgIGpvdXJuTGluZS5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAidXVpZCI6ICIiLAogICAgICAgICAgICAgICAgICAgICJhY2NvdW50Ijogb2JqLnBlbmFsdHlBY2NvdW50LAogICAgICAgICAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICcnLAogICAgICAgICAgICAgICAgICAgICJwcmltYXJ5X2NvbnRhY3QiOiB7fSwKICAgICAgICAgICAgICAgICAgICAidGhpcmRfY29udGFjdHMiOiBbXSwKICAgICAgICAgICAgICAgICAgICAicmVmX251bWJlciI6ICcnLAogICAgICAgICAgICAgICAgICAgICJhbW91bnQiOiAocGFyc2VGbG9hdChvYmoucGVuYWx0eSkgKiAtMSksCiAgICAgICAgICAgICAgICAgICAgImRpc2NvdW50Ijoge30sCiAgICAgICAgICAgICAgICAgICAgIm1hcmtfdXAiOiAwLAogICAgICAgICAgICAgICAgICAgICJiaWxsYWJsZSI6IDAsCiAgICAgICAgICAgICAgICAgICAgInRheF9jb2RlIjogIiIsCiAgICAgICAgICAgICAgICAgICAgInBheW1lbnRfbWV0aG9kIjoge30sCiAgICAgICAgICAgICAgICAgICAgImN1cnJlbmN5IjogdGhpcy5leGNoYW5nZVJhdGUsCiAgICAgICAgICAgICAgICAgICAgImV4Y2hhbmdlX3JhdGVfdXVpZCI6ICIiLAogICAgICAgICAgICAgICAgICAgICJleGNoYW5nZV9yYXRlIjogdGhpcy5yYXRlLAogICAgICAgICAgICAgICAgICAgICJleGNoYW5nZWRfYW1vdW50IjogKChwYXJzZUZsb2F0KG9iai5wZW5hbHR5KSAqIC0xKSpwYXJzZUZsb2F0KHRoaXMucmF0ZSkpLAogICAgICAgICAgICAgICAgICAgICJ0YXhfYW1vdW50IjogMCwKICAgICAgICAgICAgICAgICAgICAiZXhjaGFuZ2VkX3RheF9hbW91bnQiOiAwLAogICAgICAgICAgICAgICAgICAgICJpc19yZWNvbmNpbGVkIjogMCwKICAgICAgICAgICAgICAgICAgICAiaXNfc2V0dGxlZCI6IDAsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzXzFfdXVpZCI6ICIiLAogICAgICAgICAgICAgICAgICAgICJjbGFzc18yX3V1aWQiOiAiIiwKICAgICAgICAgICAgICAgICAgICAiY2xhc3NfM191dWlkIjogIiIsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzXzRfdXVpZCI6ICIiLAogICAgICAgICAgICAgICAgICAgICJjbGFzc181X3V1aWQiOiAiIiwKICAgICAgICAgICAgICAgICAgICAicGF5bWVudF9tZXRob2RfYXMiOiAiIiwKICAgICAgICAgICAgICAgICAgICAiY3JlYXRlZF9ieSI6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgIm1vZGlmaWVkX2J5IjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAiY3JlYXRlZF9kYXRlIjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAibW9kaWZpZWRfZGF0ZSI6IG51bGwKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gQVBJIEpvdXJuYWwKICAgICAgICAgICAgbGV0IHNlbGYgPSB0aGlzOwogICAgICAgICAgICAvLyBsZXQgZGF0YSA9IHsKICAgICAgICAgICAgLy8gICAgICJudW1iZXIiOiB0aGlzLmpvdXJuYWxOdW1iZXIsCiAgICAgICAgICAgIC8vICAgICAiZGVzY3JpcHRpb24iOiBvYmoubm90ZSwKICAgICAgICAgICAgLy8gICAgICJqb3VybmFsX3R5cGUiOiAiZ2VuZXJhbF9qb3VybmFsIiwKICAgICAgICAgICAgLy8gICAgICJqb3VybmFsX2RhdGUiOiBuZXcgRGF0ZShvYmouaXNzdWVkRGF0ZSksCiAgICAgICAgICAgIC8vICAgICAiY3VycmVuY3lfY29kZSI6IHRoaXMuY3VycmVuY3lDb2RlLAogICAgICAgICAgICAvLyAgICAgImJ1aW5zZXNzX3VuaXRfdXVpZCI6ICIiLAogICAgICAgICAgICAvLyAgICAgImxvY2F0aW9uX3V1aWQiOiAiIiwKICAgICAgICAgICAgLy8gICAgICJwcm9qZWN0X3V1aWQiOiAiIiwKICAgICAgICAgICAgLy8gICAgICJzZWdtZW50X3V1aWQiOiAnJywKICAgICAgICAgICAgLy8gICAgICJqb3VybmFsX2VudHJpZXMiOiBqb3VybkxpbmUsCiAgICAgICAgICAgIC8vICAgICAidHJhbnNhY3Rpb25fdHlwZSI6ICJqb3VybmFsIiwKICAgICAgICAgICAgLy8gICAgICJpc19kcmFmdCI6IDAsCiAgICAgICAgICAgIC8vICAgICAiaXNfcmV2ZXJzZWQiOiAwLAogICAgICAgICAgICAvLyAgICAgInByZWZpeF9mb3JtYXQiOiB0aGlzLmpvdXJuYWxQcmVmaXgsCiAgICAgICAgICAgIC8vICAgICAiY3JlYXRlZF9ieSI6IHRoaXMubG9nZ2VkVXNlcgogICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIHRoaXMuam91cm5hbC5wcmVmaXhfZm9ybWF0ID0gdGhpcy5qb3VybmFsUHJlZml4CiAgICAgICAgICAgIHRoaXMuam91cm5hbC5qb3VybmFsX2VudHJpZXMgPSBqb3VybkxpbmUKICAgICAgICAgICAgdGhpcy5qb3VybmFsLmN1cnJlbmN5X2NvZGUgPSB0aGlzLmN1cnJlbmN5Q29kZQogICAgICAgICAgICB0aGlzLmpvdXJuYWwuam91cm5hbF9kYXRlID0gSGVscGVyLnRvSVNPRGF0ZSh0aGlzLmwuaXNzdWVkRGF0ZSkKICAgICAgICAgICAgdGhpcy5qb3VybmFsLmNyZWF0ZWRfYnkgPSB0aGlzLmxvZ2dlZFVzZXIKICAgICAgICAgICAgaWYob2JqLmxvYW4uaGFzT3duUHJvcGVydHkoJ3NlZ21lbnQnKSl7CiAgICAgICAgICAgICAgICB0aGlzLmpvdXJuYWwuc2VnbWVudF91dWlkID0gb2JqLmxvYW4uc2VnbWVudC5pZAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKG9iai5sb2FuLmhhc093blByb3BlcnR5KCdsb2NhdGlvbicpKXsKICAgICAgICAgICAgICAgIHRoaXMuam91cm5hbC5sb2NhdGlvbl91dWlkID0gb2JqLmxvYW4ubG9jYXRpb24uaWQKICAgICAgICAgICAgfQogICAgICAgICAgICBqb3VybmFsSGFuZGxlci5zYXZlKG5ldyBKb3VybmFsTW9kZWwodGhpcy5qb3VybmFsKSkKICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgIHNlbGYubC51c2VyID0gc2VsZi5sb2dnZWRVc2VyCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sLnRvdGFsQW1vdW50ID0gc2VsZi50b3RhbFJlbWFpbm5pbmcKICAgICAgICAgICAgICAgICAgICBzZWxmLmwuc2NoZWR1bGVzID0gc2VsZi5zY2hlZHVsZUFSCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sLmpvdXJuYWxJZCA9ICByZXNwb25zZS5kYXRhLnV1aWQKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhdmUoKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICBIZWxwZXIuYWxlcnRFcnJvck1zZyhlcnJvcikKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coZXJyb3IpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmZpbmFsbHkoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHNlbGYuc2hvd0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZEFjY291bnROYW1lKCkgewogICAgICAgICAgICBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoJ3Jlc29sdmVkJykKICAgICAgICAgICAgICAgICAgICB0aGlzLnNlZ21lbnRzID0gW10KICAgICAgICAgICAgICAgICAgICBsb2FuSGFuZGxlci5hY2NvdW50TmFtZUdldCgpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuZGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY2NvdW50TmFtZSA9IHJlcy5kYXRhLmRhdGFbMF0ubmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMzAwKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgLy9udW1iZXIKICAgICAgICAvLyBhc3luYyBnZXRMYXN0TnVtYmVyKCkgewogICAgICAgIC8vICAgICBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHsKICAgICAgICAvLyAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIC8vICAgICAgICAgICAgIHJlc29sdmUoJ3Jlc29sdmVkJyk7CiAgICAgICAgLy8gICAgICAgICAgICAgbGV0IGRhdGEgPSB7CiAgICAgICAgLy8gICAgICAgICAgICAgICAgIHR5cGU6ICJDbG9zZUxvYW4iLAogICAgICAgIC8vICAgICAgICAgICAgIH07CiAgICAgICAgLy8gICAgICAgICAgICAgbG9hbkhhbmRsZXIKICAgICAgICAvLyAgICAgICAgICAgICAgICAgLmdldExhc3ROdW1iZXIoZGF0YSkudGhlbihyZXMgPT4gewogICAgICAgIC8vICAgICAgICAgICAgICAgICB0aGlzLmwubGFzdE51bWJlciA9IHJlcy5kYXRhLmRhdGEubGFzdE51bWJlcgogICAgICAgIC8vICAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlTnVtYmVyKCkKICAgICAgICAvLyAgICAgICAgICAgICB9KS5jYXRjaChlID0+IHsKICAgICAgICAvLyAgICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcignU29tZXRoaW5nIHdlbnQgd3JvbmcnKQogICAgICAgIC8vICAgICAgICAgICAgICAgICB0aGlzLmVycm9ycy5wdXNoKGUpCiAgICAgICAgLy8gICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5jb25zb2xlLmxvZyhlKQogICAgICAgIC8vICAgICAgICAgICAgIH0pCiAgICAgICAgLy8gICAgICAgICB9LCAzMDApOwogICAgICAgIC8vICAgICB9KQogICAgICAgIC8vIH0sCiAgICAgICAgLy8gZ2VuZXJhdGVOdW1iZXIoKXsKICAgICAgICAvLyAgICAgbGV0IG5ld051bSA9ICcnCiAgICAgICAgLy8gICAgIGxldCBhYmJyID0gJ0NMT0FOJwogICAgICAgIC8vICAgICBsZXQgbG51bSA9IHRoaXMuemVyb1BhZCh0aGlzLmwubGFzdE51bWJlciwgNikKICAgICAgICAvLyAgICAgbmV3TnVtID0gYWJicitsbnVtCiAgICAgICAgLy8gICAgIHRoaXMubC5hYmJyID0gYWJicgogICAgICAgIC8vICAgICB0aGlzLmwubnVtYmVyID0gbmV3TnVtCiAgICAgICAgLy8gfSwKICAgICAgICBwZW5hbHR5Q2hhbmdlKCl7CiAgICAgICAgICAgIGlmKHRoaXMubC5wZW5hbHR5ID4gMCl7CiAgICAgICAgICAgICAgICB0aGlzLnRvdGFsUmVtYWlubmluZyArPSBwYXJzZUZsb2F0KHRoaXMubC5wZW5hbHR5KQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkU2luZ2xlUGVuYWx0eSgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCdyZXNvbHZlZCcpCiAgICAgICAgICAgICAgICAgICAgbG9hbkhhbmRsZXIucGVuYWx0eUdldCgpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihyZXMuZGF0YS5kYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgYSA9IHJlcy5kYXRhLmRhdGFbMF0uQWNjb3VudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGVuYWx0eUFjY291bnQgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBhLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dWlkOiBhLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYW5oamlBY2NDb2RlOiBhLmJhbmhqaUFjY0NvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwX2NvZGU6IGEuZ3JvdXBfY29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNfdGF4YWJsZTogYS5pc190YXhhYmxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9uYW1lOiBhLmxvY2FsX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGEubmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyOiBhLm51bWJlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50X2FjY291bnQ6IGEucGFyZW50X2FjY291bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVfY29kZTogYS50eXBlX2NvZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRzbm90aWZ5LmVycm9yKCdQbGVhc2Ugc2V0IHBlbmFsdHkgYWNjb3VudCBvbiBnZW5lcmFsIHNldHRpbmcnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FuY2VsKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKCkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDMwMCkKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIGludGVyZXN0Q2hhbmdlKCl7CiAgICAgICAgICAgIGlmKHRoaXMubC5pbnRlcmVzdCA+IHRoaXMub2xkSW50ZXJlc3QpewogICAgICAgICAgICAgICAgdGhpcy4kc25vdGlmeS5lcnJvcignSW50ZXJlc3QgYW1vdW50IGludmFsaWQnKQogICAgICAgICAgICAgICAgdGhpcy5sLmludGVyZXN0ID0gdGhpcy5vbGRJbnRlcmVzdAogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIGxldCBpbnQgPSB0aGlzLm9sZEludGVyZXN0IC0gdGhpcy5sLmludGVyZXN0CiAgICAgICAgICAgICAgICB0aGlzLnRvdGFsUmVtYWlubmluZyAtPSBpbnQKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgbG9hZFNhbGVGb3JtQ29udGVudCgpIHsKICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoInJlc29sdmVkIik7CiAgICAgICAgICAgICAgICAgICAgc2FsZUZvcm1Db250ZW50SGFuZGxlci5saXN0KCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2FsZUZvcm1Db250ZW50ID0gZGF0YVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm51bWJlckZvcm1hdCA9ICduJyArIHRoaXMuc2FsZUZvcm1Db250ZW50LmRlY2ltYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0RGVjID0gcGFyc2VJbnQodGhpcy5zYWxlRm9ybUNvbnRlbnQuZGVjaW1hbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGxvYWRMb2FuKCkgewogICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZQogICAgICAgICAgICB0aGlzLmxvYW5MaXN0ID0gW10KICAgICAgICAgICAgbG9hbkhhbmRsZXIubG9hbkdldHMoKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkID0gZGF0YS5maWx0ZXIoKG9iaikgPT4ge3JldHVybiBvYmouc3RhdHVzID09ICdhY3RpdmUnfSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYoZC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYW5MaXN0ID0gZAogICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FuY2VsKCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIGdlbmVyYXRlTnVtYmVyKCkgewogICAgICAgICAgICBsZXQgZGF0YSA9IHsKICAgICAgICAgICAgICAgIGFiYnI6IHRoaXMudHJhbnNhY3Rpb25UeXBlLmFiYnIsCiAgICAgICAgICAgICAgICBzdHJ1Y3R1cmU6IHRoaXMudHJhbnNhY3Rpb25UeXBlLnN0cnVjdHVyZSwKICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogdGhpcy5sLmlzc3VlZERhdGUsCiAgICAgICAgICAgICAgICB0eXBlOiAiQ2xvc2UgTG9hbiIsCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGJpbGxpbmdIYW5kbGVyCiAgICAgICAgICAgICAgICAubGFzdE51bWJlcihkYXRhKQogICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdWZmaXggPSByZXMuc3VmZml4OwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldExhc3ROdW0oKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvcnMucHVzaChlKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgZ2V0TGFzdE51bSgpewogICAgICAgICAgICBsZXQgZCA9IHsKICAgICAgICAgICAgICAgIHR5cGU6ICJDbG9zZUxvYW4iLAogICAgICAgICAgICB9OwogICAgICAgICAgICBsb2FuSGFuZGxlcgogICAgICAgICAgICAgICAgLmdldExhc3ROdW1iZXIoZCkKICAgICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXN0TnVtYmVyID0gdGhpcy56ZXJvUGFkKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VJbnQocmVzLmxhc3ROdW1iZXIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvblR5cGUuZm9ybWF0CiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubC5sYXN0TnVtYmVyID0gcGFyc2VJbnQocmVzLmxhc3ROdW1iZXIpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG51bWJlciA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN1ZmZpeCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uVHlwZS5udW1iZXJTZXBhcmF0b3IgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdE51bWJlcjsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRlcyA9ICcnCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKE9iamVjdC5rZXlzKHRoaXMubC5sb2FuKS5sZW5ndGggPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlcyA9IGBDbG9zZSBMb2FuIGZyb20gJHt0aGlzLmwubG9hbi5maW5hbmNpYWxJbnN0aXR1dGlvbnMubmFtZX0gRm9yIExvYW4gTnVtYmVyICR7dGhpcy5sLmxvYW4uYXBwcm92ZU51bWJlcn1gOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygpCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuam91cm5hbCA9IG5ldyBKb3VybmFsTW9kZWwoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGRlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uX3R5cGU6IExvYW5UeXBlLkNMT1NFLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgam91cm5hbF90eXBlOiBMb2FuVHlwZS5DTE9TRSwKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuam91cm5hbC5hYmJyID0gdGhpcy50cmFuc2FjdGlvblR5cGUuYWJicgogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmxvYW4uYWN0aXZlRGF0ZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zdWJzdHIoMCwgMTApOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIDIgZGVmYXVsdCByb3dzCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuYWRkUm93VCh0aGlzLiRyZWZzLmNhc2hCYW5rQWNjb3VudERTLmtlbmRvV2lkZ2V0KCkpOwogICAgICAgICAgICAgICAgICAgICAgICAvLyBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgMjsgaW5kZXgrKykgewogICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgdGhpcy5hZGRSb3codGhpcy4kcmVmcy5yZWxhdGVkQ29zdERTLmtlbmRvV2lkZ2V0KCkpOwogICAgICAgICAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuam91cm5hbC5udW1iZXIgPSB0aGlzLnRyYW5zYWN0aW9uVHlwZS5hYmJyICsgdGhpcy50cmFuc2FjdGlvblR5cGUubnVtYmVyU2VwYXJhdG9yICsgbnVtYmVyCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubC5hYmJyID0gdGhpcy50cmFuc2FjdGlvblR5cGUuYWJicgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmwubnVtYmVyID0gdGhpcy50cmFuc2FjdGlvblR5cGUuYWJiciArIHRoaXMudHJhbnNhY3Rpb25UeXBlLm51bWJlclNlcGFyYXRvciArIG51bWJlcjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKGUpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBsb2FkUHJlZml4KCkgewogICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gdHJ1ZQogICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgicmVzb2x2ZWQiKTsKICAgICAgICAgICAgICAgICAgICBwcmVmaXhIYW5kbGVyLmdldCgiY2xvc2UgbG9hbiIpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uVHlwZSA9IHJlcy5kYXRhLmRhdGFbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlTnVtYmVyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgIH0sCiAgICBjb21wdXRlZDoge30sCiAgICBtb3VudGVkOiBhc3luYyBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gYXdhaXQgdGhpcy5sb2FkRGVjaW1hbCgpCiAgICAgICAgYXdhaXQgdGhpcy5sb2FkU2FsZUZvcm1Db250ZW50KCkKICAgICAgICBhd2FpdCB0aGlzLmdldEpvdXJuYWxOdW1iZXIoKQogICAgfSwKICAgIGNyZWF0ZWQ6IGFzeW5jIGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLmFkZEVtcHR5KCkKICAgICAgICBhd2FpdCB0aGlzLmxvYWRQcmVmaXgoKQogICAgICAgIGF3YWl0IHRoaXMubG9hZEFjY291bnQoKQogICAgfSwKfTsK"},{"version":3,"sources":["CloseLoan.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsOA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CloseLoan.vue","sourceRoot":"src/views/finances","sourcesContent":["<template>\n    <v-app>\n        <v-container>\n            <v-row>\n                <v-col cols=\"12\" sm=\"12\">\n                    <v-card outlined dense class=\"pa-4 no_border rounded-sm\" color=\"white\">\n                        <v-row>\n                            <v-col class=\"bigSide py-0\" sm=\"12\" cols=\"12\" style=\"transition: .3s ease-in;\">\n                                <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n                                    <div class=\"function_header\">\n                                        <h2>{{ $t('close_loan') }}</h2>\n                                        <v-icon\n                                            onclick=\"window.history.go(-1); return false;\"\n                                            style=\"cursor: pointer; color: #333; font-size: 40px;\"\n                                            class=\"float-right\"\n                                        >close\n                                        </v-icon>\n                                    </div>\n                                    <div class=\"\">\n                                        <!-- Form -->\n                                        <v-form\n                                            ref=\"form\"\n                                            v-model=\"valid\"\n                                            lazy-validation>\n                                            <v-col>\n                                                <v-row>\n                                                    <v-col sm=\"6\" cols=\"12\" class=\"pl-0 pb-0\">\n                                                        <label class=\"label mb-0\">{{ $t('date') }}</label>\n                                                        <app-datepicker\n                                                            class=\"mt-1\"\n                                                            :initialDate=\"l.issuedDate\"\n                                                            @emitDate=\"l.issuedDate = $event\"/>\n                                                        <label\n                                                            class=\"label mb-0\">{{ $t('transaction_number') }}</label>\n                                                        <v-text-field\n                                                            class=\"mt-1\"\n                                                            v-model=\"l.number\"\n                                                            outlined\n                                                            disabled\n                                                            :rules=\"[v => !!v || 'Number is required']\"\n                                                        />\n                                                        <label class=\"label  mb-0\">{{ $t('loan') }}</label>\n                                                        <v-select\n                                                            class=\"mt-1\"\n                                                            :items=\"loanList\"\n                                                            :placeholder=\"$t('select')\"\n                                                            item-text=\"name\"\n                                                            item-value=\"id\"\n                                                            tage=\"\"\n                                                            v-model=\"l.loan\"\n                                                            @change=\"loanChange\"\n                                                            :rules=\"[v => !!v || 'Loan is required']\"\n                                                            return-object\n                                                            outlined/>\n                                                        <label class=\"label  mb-0\">{{ $t('cash_account') }}</label>\n                                                        <v-select\n                                                            class=\"mt-1\"\n                                                            :items=\"cashAccounts\"\n                                                            :placeholder=\"$t('select')\"\n                                                            :item-text=\"item => `${accountName=='name'?item.name:item.local_name}`\"\n                                                            tage=\"\"\n                                                            v-model=\"l.cashAccount\"\n                                                            :rules=\"[v => !!v || 'Cash account is required']\"\n                                                            return-object\n                                                            outlined/>\n                                                        <label class=\"label\">{{ $t('penalty_account') }}</label>\n                                                        <v-select\n                                                            class=\"mt-1\"\n                                                            outlined\n                                                            return-object\n                                                            id=\"\"\n                                                            :items=\"penaltyAccounts\"\n                                                            item-text=\"name\"\n                                                            item-value=\"id\"\n                                                            v-model=\"l.penaltyAccount\"\n                                                        />\n                                                    </v-col>\n\n                                                    <v-col sm=\"6\" cols=\"6\" class=\"pb-0 function_content pa-3\">\n                                                        <v-card class=\"pa-3 no-boxshadow d-flex justify-space-between align-center\"\n                                                                min-height=\"50px\" color=\"primary\">\n                                                            <h3 style=\"font-size: 18px\" class=\"text-white text-uppercase\">\n                                                                {{ $t('amount_remaining') }}:</h3>\n                                                            <h3 class=\"text-bold float-right text-white\" style=\"font-size: 22px\">\n                                                                {{ numberFormata(totalRemainning) }}</h3>\n\n                                                        </v-card>\n                                                        <v-simple-table>\n                                                            <template v-slot:default>\n                                                                <tbody>\n                                                                <tr>\n                                                                    <td class=\"text-left pr-0\">{{\n                                                                            $t('principal_remaining')\n                                                                        }}\n                                                                    </td>\n                                                                    <td class=\"text-center\">:</td>\n                                                                    <td class=\"text-right\">\n                                                                        {{ numberFormata(l.principal) }}\n                                                                    </td>\n                                                                </tr>\n                                                                <tr>\n                                                                    <td class=\"text-left pr-0\">{{\n                                                                            $t('interest_remaining')\n                                                                        }} ({{ numberFormata(oldInterest) }})\n                                                                    </td>\n                                                                    <td class=\"text-center\">:</td>\n                                                                    <td class=\"text-right pl-2 pt-2\">\n                                                                        <vue-numeric\n                                                                            style=\"width: 100%;font-size: 18px;background-color: #ffff;border-radius: 4px;text-align: right;border: 1px solid #ddd !important; padding: 9px !important; margin-bottom: 15px;\"\n                                                                            class=\"mt-1 mr-2 mt-0 text-bold pa-4\"\n                                                                            currency=\"\"\n                                                                            separator=\",\"\n                                                                            v-bind:minus=\"false\"\n                                                                            v-bind:precision=\"inputDec\"\n                                                                            v-model=\"l.interest\"\n                                                                            @change=\"interestChange\"\n                                                                            outlined\n                                                                        >\n                                                                        </vue-numeric>\n                                                                    </td>\n                                                                </tr>\n                                                                <tr>\n                                                                    <td class=\"text-left pr-0\">{{\n                                                                            $t('penalty_amount')\n                                                                        }}\n                                                                    </td>\n                                                                    <td class=\"text-center\">:</td>\n                                                                    <td class=\"text-right pl-2 pt-2\">\n                                                                        <vue-numeric\n                                                                            style=\"width: 100%;font-size: 18px;background-color: #ffff;border-radius: 4px;text-align: right;border: 1px solid #ddd !important; padding: 9px !important; margin-bottom: 15px;\"\n                                                                            class=\"mt-1 mr-2 mt-0 text-bold pa-4\"\n                                                                            currency=\"\"\n                                                                            separator=\",\"\n                                                                            v-bind:minus=\"false\"\n                                                                            v-bind:precision=\"inputDec\"\n                                                                            v-model=\"l.penalty\"\n                                                                            @change=\"penaltyChange\"\n                                                                            outlined\n                                                                        >\n                                                                        </vue-numeric>\n                                                                    </td>\n                                                                </tr>\n                                                                <tr>\n                                                                    <td class=\"text-left pr-0\">{{\n                                                                            $t('reference_no')\n                                                                        }}\n                                                                    </td>\n                                                                    <td class=\"text-center\">:</td>\n                                                                    <td class=\"text-right pl-2 pt-2\">\n                                                                        <v-text-field\n                                                                            class=\"mt-1\"\n                                                                            v-model=\"l.referenceNumber\"\n                                                                            outlined\n                                                                        />\n                                                                    </td>\n                                                                </tr>\n                                                                <tr>\n                                                                    <td class=\"text-left pr-0\">{{\n                                                                            $t('currency')\n                                                                        }}\n                                                                    </td>\n                                                                    <td class=\"text-center\">:</td>\n                                                                    <td class=\"text-right\">\n                                                                        {{currencyCode}}\n                                                                    </td>\n                                                                </tr>\n                                                                <tr>\n                                                                    <td class=\"text-left pr-0\">{{\n                                                                            $t('rate')\n                                                                        }}\n                                                                    </td>\n                                                                    <td class=\"text-center\">:</td>\n                                                                    <td class=\"text-right\">\n                                                                        {{ rate }}\n                                                                    </td>\n                                                                </tr>\n                                                                </tbody>\n                                                            </template>\n\n                                                        </v-simple-table>\n                                                        <v-textarea\n                                                            v-model=\"l.note\"\n                                                            class=\"mt-4\"\n                                                            solo\n                                                            :label=\"$t('note')+'...'\"\n                                                            name=\"input-7-4\">\n                                                        </v-textarea>\n                                                    </v-col>\n                                                </v-row>\n                                            </v-col>\n                                        </v-form>\n                                        <!-- Grid -->\n                                    </div>\n                                    <div class=\"function_footer\">\n                                        <v-btn outlined color=\"#494846\" class=\"float-left text-capitalize\"\n                                               @click=\"cancel\">{{ $t('cancel') }}\n                                        </v-btn>\n\n                                        <v-btn color=\"primary\" class=\"float-right white--text text-capitalize\"\n                                               @click=\"saveClose\">\n                                            {{ $t('save_close') }}\n                                        </v-btn>\n                                    </div>\n                                </v-form>\n                            </v-col>\n                        </v-row>\n\n                    </v-card>\n                </v-col>\n            </v-row>\n            <LoadingMe\n                :isLoading=\"showLoading\"\n                :fullPage=\"true\"\n                :myLoading=\"true\"\n                :alertMessage=\"loadingAlert\"\n                :color=\"loadingColorAlert\"\n                :alertText=\"loadingTextAlert\"/>\n            <LoadingMe\n                :isLoading=\"showLoadingData\"\n                :fullPage=\"true\"\n                :myLoading=\"true\"/>\n            <LoadingMe\n                :isLoading=\"showLoadingLoan\"\n                :fullPage=\"true\"\n                :myLoading=\"true\"/>\n        </v-container>\n    </v-app>\n</template>\n\n<script>\nimport Helper from \"@/helper.js\"\nimport DatePickerComponent from '@/components/custom_templates/DatePickerComponent'\n// import {DropDownList} from \"@progress/kendo-vue-dropdowns\"\nimport kendo from \"@progress/kendo-ui\"\nconst $ = kendo.jQuery\nimport CloseLoanModel from '@/scripts/financing/model/CloseLoan'\n\nconst memberHandler = require(\"@/scripts/memberHandler\")\nconst customerHandler = require(\"@/scripts/customerHandler\")\nconst currencyHandler = require(\"@/scripts/currency/handler/currencyHandler\")\n// const loanHandler = require(\"@/scripts/loanHandler\")\nconst billingHandler = require(\"@/scripts/invoice/handler/billingHandler\")\nconst prefixHandler = require(\"@/scripts/prefixHandler\")\n// const accountHandler = require(\"@/scripts/accountHandler\")\nimport {accountHandler} from \"@/scripts/AppHandlers\";\n\nconst textField = 'name'\nconst keyField = 'id'\nconst customerItem = {[textField]: 'Select Customer...', [keyField]: null}\nconst memberItem = {[textField]: 'Select Member...', [keyField]: null}\nconst emptyItem = {[textField]: 'loading ...'}\nconst store = require(\"@/institute.js\")\nconst {cookies} = store.default.state\n\n// journal\nimport {JournalModel, UserModel} from \"@/scripts/model/AppModels\"\nimport saleFormContentHandler from \"@/scripts/saleFormContentHandler\";\nconst { journalHandler } = require(\"@/scripts/AppHandlers\");\nconst {EntityType} = require(\"@/scripts/default_setup/Collections\")\nconst loanHandler = require(\"@/scripts/financing/handler/loanHandler\")\nimport VueNumeric from 'vue-numeric'\nimport LoanType from \"@/scripts/default_setup/LoanType.js\";\nexport default {\n    data: () => ({\n        valid: true,\n        showLoading: false,\n        showLoadingData: false,\n        showLoadingLoan: false,\n        errors: [],\n        user: new UserModel(cookies.user),\n        loadingAlert: false,\n        loadingColorAlert: '',\n        loadingTextAlert: '',\n        textField: 'name',\n        dataItemKey: 'id',\n        selectMember: 'isMember',\n        isMember: true,\n        isCustom: false,\n        cashAccounts: [],\n        saleFormContent: {},\n        currencyCode: '',\n        invoiceType: {},\n        lastNumber: {},\n        scheduleAR: [],\n        loanAmount: 0,\n        rate: 1,\n        //\n        disbursList: [],\n        l: new CloseLoanModel({}),\n        loan: {},\n        loanList: [],\n        totalPayment: 0,\n        monthlyPayment: 0,\n        totalInterest: 0,\n        //customer\n        cusBaseUrl: customerHandler.search(),\n        customerList: [],\n        customerItem: customerItem,\n        customerfilter: '',\n        //member\n        memBaseUrl: memberHandler.search(),\n        memberList: [],\n        memberItem: memberItem,\n        memberfilter: '',\n        decimals: [],\n        numberFormat: 'c0',\n        memberData: [],\n        //journal\n        journalNumber: '',\n        journalPrefix: '',\n        journalTxnType: EntityType.JOURNAL,\n        loggedUser: new UserModel(cookies.user),\n        segments: [],\n        segment: {},\n        accountName: 'name',\n        totalRemainning: 0,\n        penaltyAccount: {},\n        oldInterest: 0,\n        inputDec: 2,\n        penaltyAccounts: [],\n        transactionType: {},\n        suffix: ''\n    }),\n    components: {\n        'app-datepicker': DatePickerComponent,\n        LoadingMe: () => import(`@/components/Loading`),\n        VueNumeric\n    },\n    methods: {\n        rowNumberTmpl(dataItem) {\n            let ds = this.$refs.scheduleAR.kendoWidget(),\n                index = ds.indexOf(dataItem);\n            if (index === (this.scheduleAR.length - 1)) {\n                return ''\n            } else {\n                return index + 1\n            }\n        },\n        async loanChange() {\n            window.console.log(this.l.loan, 'loan')\n            this.currencyCode = this.l.loan.currency.code\n            await this.loadTransactionRate()\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved')\n                    this.showLoadingLoan = true\n                    loanHandler.loanScheduleGet(this.l.loan.id).then(res => {\n                        this.showLoading = false\n                        if (res.data.statusCode === 200) {\n                            this.showLoadingLoan = false\n                            let data = res.data.data\n                            window.console.log(data, 'schedule')\n                            let total = 0, self = this, int = 0\n                            this.scheduleAR = []\n                            $.each(data, function (i,v){\n                                if(v.status == 1){\n                                    total += parseFloat(v.data.principal)\n                                    int += parseFloat(v.data.interest)\n                                    self.scheduleAR.push(v)\n                                }\n                            })\n                            this.totalRemainning = total + int\n                            this.l.interest = int\n                            this.oldInterest = int\n                            this.l.principal = total\n                            this.getLastNum()\n                        }\n                    }).catch()\n                    {\n                        this.showLoading = false\n                    }\n                }, 300)\n            })\n        },\n        addTotal() {\n            this.scheduleAR.push({\n                principal_r: '',\n                principal: parseFloat(this.loan.amount),\n                interest: this.totalInterest,\n                total: this.totalPayment,\n                date: 'Total',\n                locale: this.currencyCode,\n                numberFormat: this.numberFormat,\n                transaction_number: '',\n            })\n            // window.console.log(this.scheduleAR, 'loan schedule')\n        },\n        makeBalance(amt) {\n            let idx = parseFloat(this.loan.period) - 1\n            let oamt = this.scheduleAR[idx].principal\n            let namt = oamt + amt\n            namt = parseFloat(namt.toFixed(this.saleFormContent.decimal))\n            this.scheduleAR[idx].principal = namt\n            this.scheduleAR[idx].total = this.scheduleAR[idx].interest + namt\n        },\n        fixRate(P, r, t) {\n            // var C = 0;\n            // var a = P*r;\n            // var b = Math.pow((1+r), t);\n            //     b = parseFloat(b.toFixed(2));\n            // var c = 1/b;\n            // var d = 1 - c;\n            //     d = parseFloat(d.toFixed(2));\n            // C = a/d;\n            // console.log(P+\"--\"+r+\"--\"+t);\n            // return C;\n            let l = 1 / t, i = r * l, n = t\n            let emi = i * P / [1 - Math.pow((1 + i), -n)]\n            return emi\n        },\n        errorMessage() {\n        },\n        zeroPad(num, places) {\n            return String(num).padStart(places, '0')\n        },\n        // async loadPrefix() {\n        //     new Promise(resolve => {\n        //         setTimeout(() => {\n        //             resolve('resolved');\n        //             prefixHandler.get('invoice').then(res => {\n        //                 if (res.data.statusCode === 200) {\n        //                     this.showLoading = false\n        //                     this.invoiceType = res.data.data[0]\n        //                     this.getInvoiceLastNumber()\n        //                 }\n        //             })\n        //         }, 300);\n        //     })\n        // },\n        getInvoiceLastNumber() {\n            let data = {\n                abbr: this.invoiceType.abbr,\n                structure: this.invoiceType.structure,\n                transactionDate: this.l.issuedDate,\n                sequcencing: this.invoiceType.sequcencing,\n                type: 'Invoice',\n                entity: 1\n            }\n            billingHandler.lastNumber(data).then(response => {\n                if (response.data.statusCode === 200) {\n                    this.lastNumber = response.data.data\n                    // window.console.log(this.lastNumber, 'last number')\n                }\n            }).catch(e => {\n                this.errors.push(e)\n            })\n        },\n        getLoan() {\n            window.console.log(this.l.member)\n            this.showLoading = true\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved');\n                    memberHandler.getLoanByMemberId(this.l.member.id).then(res => {\n                        this.showLoading = false\n                        this.loanList = res.data.data.filter((obj) => {\n                            return obj.status == 3\n                        })\n                    })\n                }, 300);\n            })\n        },\n        //customer\n        onCustomerChange(event) {\n            const value = event.value\n            if (value && value[textField] === emptyItem[textField]) {\n                return;\n            }\n            this.customer = value\n            this.l.customer = value\n            this.getLoan()\n        },\n        onCustomerFilterChange(event) {\n            const filter = event.filter.value\n            this.customerRequestData(0, filter, this.cusBaseUrl)\n            this.customerfilter = filter\n        },\n        customerRequestData(skip, filter, baseUrl) {\n            // window.console.log(baseUrl, 'requ')\n            const url = baseUrl +\n                `?filter=${filter}`\n            this.requestStarted = true;\n            fetch(url)\n                .then((response) => {\n                    return response.json()\n                })\n                .then(this.customerAfterFetch)\n        },\n        customerAfterFetch(json) {\n            this.customerList = json.data\n        },\n        //member\n        selectMemberChange() {\n            if (this.selectMember == 'isMember') {\n                this.loan.isMember = 1\n                this.memberData = this.memberList\n            } else {\n                this.loan.isMember = 2\n                this.memberData = this.customerList\n            }\n            this.loan.member = {}\n        },\n        onMemberChange() {\n            this.getLoan()\n        },\n        onMemberFilterChange(event) {\n            const filter = event.filter.value\n            this.memberRequestData(0, filter, this.memBaseUrl)\n            this.memberfilter = filter\n        },\n        memberRequestData(skip, filter, baseUrl) {\n            // window.console.log(baseUrl, 'requ')\n            const url = baseUrl +\n                `?filter=${filter}`\n            this.requestStarted = true;\n            fetch(url)\n                .then((response) => {\n                    return response.json()\n                })\n                .then(this.memberAfterFetch)\n        },\n        memberAfterFetch(json) {\n            this.memberList = json.data\n        },\n        async loadTransactionRate() {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved')\n                    const date = new Date(this.l.issuedDate).toISOString().substr(0, 10)\n                    let code = this.currencyCode\n                    if (code !== undefined || code !== '') {\n                        currencyHandler.getLastExchangeRateByDate(date, code).then(res => {\n                            if (res.data.statusCode === 200) {\n                                const response = res.data.data[0]\n                                // window.console.log(response, 'currency rate')\n                                if(Object.keys(response).length > 0){\n                                    this.exchangeRate = response\n                                    this.l.exchangeRate = this.exchangeRate\n                                    this.l.rate = response.rate\n                                    this.rate = response.rate\n                                }else{\n                                    this.$snotify.error('Please set exchange rate on currency setting')\n                                    this.cancel()\n                                }\n                                this.showLoading = false\n                            }\n                        })\n                    }\n                }, 300)\n            })\n        },\n        async loadDecimal() {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved');\n                    loanHandler.decimalGet().then(res => {\n                        this.decimals = res.data.data\n                    })\n                }, 300);\n            })\n        },\n        numberFormata(value) {\n            if (this.currencyCode) {\n                value = parseFloat(value)\n                return kendo.toString(value, this.numberFormat)\n            }\n        },\n        //function\n        async addEmpty() {\n            this.l = new CloseLoanModel({})\n            this.loan = {}\n            this.customer = {}\n            this.member = {}\n            this.l.cashAccount = this.cashAccounts[0]\n            this.currencyCode = ''\n            await this.loadLoan()\n        },\n        cancel() {\n            window.history.go(-1)\n        },\n        saveNew() {\n            this.isSaveNew = true\n            this.saveOption = 'saveNew'\n            this.save()\n        },\n        saveClose() {\n            this.isSaveNew = false\n            this.saveOption = 'saveClose'\n            this.addJournal()\n        },\n        async save() {\n            this.l.saveOption = this.saveOption\n            this.showLoadingData = true\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved');\n                    loanHandler.closeLoanCreate(new CloseLoanModel(this.l)).then(response => {\n                        this.showLoadingData = false\n                        if (response.data.statusCode === 201) {\n                            this.$snotify.success('Successfully')\n                            window.history.go(-1)\n                        }\n                    }).catch(e => {\n                        this.$snotify.error('Something went wrong')\n                        this.errors.push(e)\n                        window.console.log(e, 'error')\n                    })\n                }, 300);\n            })\n        },\n        async loadSegment() {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved')\n                    this.segment = {}\n                    loanHandler.businessSettingGet().then(res => {\n                        this.showLoading = true\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false\n                            let s = res.data.data.filter((obj) => {return obj.type == \"Credit\"})\n                            if(s.length > 0){\n                                this.segment = s[0].segment\n                            }else{\n                                this.$snotify.error('Please select segment on setting page')\n                                this.cancel()\n                            }\n                        }\n                    }).catch()\n                    {\n                        this.showLoading = false\n                    }\n                }, 300)\n            })\n        },\n        async loadAccount() {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved');\n                    accountHandler.getAll().then(res => {\n                        this.showLoading = false\n                        // window.console.log(res, 'acc')\n                        //Receivable Account\n                        this.cashAccounts = res.data.filter(m => m.account_type.number === 1).map(itm => {\n                            return {\n                                id: itm.uuid,\n                                uuid: itm.uuid,\n                                name: itm.name,\n                                local_name: itm.local_name,\n                                number: itm.number,\n                                is_taxable: itm.is_taxable,\n                                banhjiAccCode: itm.banhjiAccCode,\n                                group_code: itm.group_code,\n                                parent_account: itm.parent_account,\n                                type_code: itm.type_code\n                            }\n                        })\n                        this.penaltyAccounts = res.data.filter(m => m.account_type.number === 38).map(itm => {\n                            return {\n                                id: itm.uuid,\n                                uuid: itm.uuid,\n                                name: itm.name,\n                                local_name: itm.local_name,\n                                number: itm.number,\n                                is_taxable: itm.is_taxable,\n                                banhjiAccCode: itm.banhjiAccCode,\n                                group_code: itm.group_code,\n                                parent_account: itm.parent_account,\n                                type_code: itm.type_code\n                            }\n                        })\n                        if (this.penaltyAccounts.length > 0) {\n                            this.l.penaltyAccount = this.penaltyAccounts[0]\n                        }\n                        if (this.cashAccounts.length > 0) {\n                            this.l.cashAccount = this.cashAccounts[0]\n                        }\n                    })\n                }, 300);\n            })\n        },\n        // jounal\n        async getJournalNumber() {\n            let num = await Helper.generateAccountingNumber(this.journalTxnType, this.l.issuedDate)\n            this.journalNumber = num.number\n            this.journalPrefix = num.prefix_format\n            this.l.journalNumber = num.number\n        },\n        async addJournal(){\n            const obj = this.l\n            // const seg = this.segment\n            if (!this.$refs.form.validate()) {\n                this.$refs.form.validate()\n                return\n            }\n            if(this.scheduleAR.length == 0){\n                this.l.user = this.loggedUser\n                this.l.totalAmount = this.totalRemainning\n                this.l.schedules = this.scheduleAR\n                this.save()\n                return\n            }\n            // let customer = obj.member\n            // if(Object.keys(customer).length == 0){\n            //     this.$snotify.error('Please select a member or customer')\n            //     return\n            // }\n            if(Object.keys(obj.loan).length == 0){\n                this.$snotify.error('Please select a loan number')\n                return\n            }\n            this.showLoading = true\n            let amt = parseFloat(this.totalRemainning) + parseFloat(obj.penalty)\n            let journLine = []\n            journLine.push({\n                \"uuid\": \"\",\n                \"account\": obj.loan.loanAccount,\n                \"description\": obj.note,\n                \"primary_contact\": {},\n                \"third_contacts\": [],\n                \"ref_number\": '',\n                \"amount\": parseFloat(amt),\n                \"discount\": {},\n                \"mark_up\": 0,\n                \"billable\": 0,\n                \"tax_code\": \"\",\n                \"payment_method\": {},\n                \"currency\": this.exchangeRate,\n                \"exchange_rate_uuid\": \"\",\n                \"exchange_rate\": this.rate,\n                \"exchanged_amount\": parseFloat(amt) * parseFloat(this.rate),\n                \"tax_amount\": 0,\n                \"exchanged_tax_amount\": 0,\n                \"is_reconciled\": 0,\n                \"is_settled\": 0,\n                \"class_1_uuid\": \"\",\n                \"class_2_uuid\": \"\",\n                \"class_3_uuid\": \"\",\n                \"class_4_uuid\": \"\",\n                \"class_5_uuid\": \"\",\n                \"payment_method_as\": \"\",\n                \"created_by\": null,\n                \"modified_by\": null,\n                \"created_date\": null,\n                \"modified_date\": null\n            })\n            journLine.push({\n                \"uuid\": \"\",\n                \"account\": obj.cashAccount,\n                \"description\": this.journal.description,\n                \"primary_contact\": {},\n                \"third_contacts\": [],\n                \"ref_number\": '',\n                \"amount\": (parseFloat(this.totalRemainning) * -1),\n                \"discount\": {},\n                \"mark_up\": 0,\n                \"billable\": 0,\n                \"tax_code\": \"\",\n                \"payment_method\": {},\n                \"currency\": this.exchangeRate,\n                \"exchange_rate_uuid\": \"\",\n                \"exchange_rate\": this.rate,\n                \"exchanged_amount\": ((parseFloat(this.totalRemainning) * -1)*parseFloat(this.rate)),\n                \"tax_amount\": 0,\n                \"exchanged_tax_amount\": 0,\n                \"is_reconciled\": 0,\n                \"is_settled\": 0,\n                \"class_1_uuid\": \"\",\n                \"class_2_uuid\": \"\",\n                \"class_3_uuid\": \"\",\n                \"class_4_uuid\": \"\",\n                \"class_5_uuid\": \"\",\n                \"payment_method_as\": \"\",\n                \"created_by\": null,\n                \"modified_by\": null,\n                \"created_date\": null,\n                \"modified_date\": null\n            })\n            if(obj.penalty > 0){\n                journLine.push({\n                    \"uuid\": \"\",\n                    \"account\": obj.penaltyAccount,\n                    \"description\": '',\n                    \"primary_contact\": {},\n                    \"third_contacts\": [],\n                    \"ref_number\": '',\n                    \"amount\": (parseFloat(obj.penalty) * -1),\n                    \"discount\": {},\n                    \"mark_up\": 0,\n                    \"billable\": 0,\n                    \"tax_code\": \"\",\n                    \"payment_method\": {},\n                    \"currency\": this.exchangeRate,\n                    \"exchange_rate_uuid\": \"\",\n                    \"exchange_rate\": this.rate,\n                    \"exchanged_amount\": ((parseFloat(obj.penalty) * -1)*parseFloat(this.rate)),\n                    \"tax_amount\": 0,\n                    \"exchanged_tax_amount\": 0,\n                    \"is_reconciled\": 0,\n                    \"is_settled\": 0,\n                    \"class_1_uuid\": \"\",\n                    \"class_2_uuid\": \"\",\n                    \"class_3_uuid\": \"\",\n                    \"class_4_uuid\": \"\",\n                    \"class_5_uuid\": \"\",\n                    \"payment_method_as\": \"\",\n                    \"created_by\": null,\n                    \"modified_by\": null,\n                    \"created_date\": null,\n                    \"modified_date\": null\n                })\n            }\n            // API Journal\n            let self = this;\n            // let data = {\n            //     \"number\": this.journalNumber,\n            //     \"description\": obj.note,\n            //     \"journal_type\": \"general_journal\",\n            //     \"journal_date\": new Date(obj.issuedDate),\n            //     \"currency_code\": this.currencyCode,\n            //     \"buinsess_unit_uuid\": \"\",\n            //     \"location_uuid\": \"\",\n            //     \"project_uuid\": \"\",\n            //     \"segment_uuid\": '',\n            //     \"journal_entries\": journLine,\n            //     \"transaction_type\": \"journal\",\n            //     \"is_draft\": 0,\n            //     \"is_reversed\": 0,\n            //     \"prefix_format\": this.journalPrefix,\n            //     \"created_by\": this.loggedUser\n            // }\n            this.journal.prefix_format = this.journalPrefix\n            this.journal.journal_entries = journLine\n            this.journal.currency_code = this.currencyCode\n            this.journal.journal_date = Helper.toISODate(this.l.issuedDate)\n            this.journal.created_by = this.loggedUser\n            if(obj.loan.hasOwnProperty('segment')){\n                this.journal.segment_uuid = obj.loan.segment.id\n            }\n            if(obj.loan.hasOwnProperty('location')){\n                this.journal.location_uuid = obj.loan.location.id\n            }\n            journalHandler.save(new JournalModel(this.journal))\n                .then(function (response) {\n                    self.l.user = self.loggedUser\n                    self.l.totalAmount = self.totalRemainning\n                    self.l.schedules = self.scheduleAR\n                    self.l.journalId =  response.data.uuid\n                    self.save()\n                })\n                .catch(function (error) {\n                    Helper.alertErrorMsg(error)\n                    window.console.log(error)\n                })\n                .finally(() => {\n                    self.showLoading = false;\n                });\n        },\n        async loadAccountName() {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved')\n                    this.segments = []\n                    loanHandler.accountNameGet().then(res => {\n                        this.showLoading = true\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false\n                            if (res.data.data.length > 0) {\n                                this.accountName = res.data.data[0].name\n                            }\n                        }\n                    }).catch()\n                    {\n                        this.showLoading = false\n                    }\n                }, 300)\n            })\n        },\n        //number\n        // async getLastNumber() {\n        //     new Promise(resolve => {\n        //         setTimeout(() => {\n        //             resolve('resolved');\n        //             let data = {\n        //                 type: \"CloseLoan\",\n        //             };\n        //             loanHandler\n        //                 .getLastNumber(data).then(res => {\n        //                 this.l.lastNumber = res.data.data.lastNumber\n        //                 this.generateNumber()\n        //             }).catch(e => {\n        //                 this.$snotify.error('Something went wrong')\n        //                 this.errors.push(e)\n        //                 // window.console.log(e)\n        //             })\n        //         }, 300);\n        //     })\n        // },\n        // generateNumber(){\n        //     let newNum = ''\n        //     let abbr = 'CLOAN'\n        //     let lnum = this.zeroPad(this.l.lastNumber, 6)\n        //     newNum = abbr+lnum\n        //     this.l.abbr = abbr\n        //     this.l.number = newNum\n        // },\n        penaltyChange(){\n            if(this.l.penalty > 0){\n                this.totalRemainning += parseFloat(this.l.penalty)\n            }\n        },\n        async loadSinglePenalty() {\n            new Promise(resolve => {\n                setTimeout(() => {\n                    resolve('resolved')\n                    loanHandler.penaltyGet().then(res => {\n                        this.showLoading = true\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false\n                            if(res.data.data.length > 0) {\n                                let a = res.data.data[0].Account\n                                this.penaltyAccount = {\n                                    id: a.id,\n                                    uuid: a.id,\n                                    banhjiAccCode: a.banhjiAccCode,\n                                    group_code: a.group_code,\n                                    is_taxable: a.is_taxable,\n                                    local_name: a.local_name,\n                                    name: a.name,\n                                    number: a.number,\n                                    parent_account: a.parent_account,\n                                    type_code: a.type_code\n                                }\n                            }else{\n                                this.$snotify.error('Please set penalty account on general setting')\n                                this.cancel()\n                            }\n                        }\n                    }).catch()\n                    {\n                        this.showLoading = false\n                    }\n                }, 300)\n            })\n        },\n        interestChange(){\n            if(this.l.interest > this.oldInterest){\n                this.$snotify.error('Interest amount invalid')\n                this.l.interest = this.oldInterest\n            }else{\n                let int = this.oldInterest - this.l.interest\n                this.totalRemainning -= int\n            }\n        },\n        async loadSaleFormContent() {\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    saleFormContentHandler.list().then((res) => {\n                        if (res.data.statusCode === 200) {\n                            const data = res.data.data;\n                            if (data.length > 0) {\n                                this.saleFormContent = data[0];\n                                this.numberFormat = 'n' + this.saleFormContent.decimal\n                                this.inputDec = parseInt(this.saleFormContent.decimal)\n                            }\n                        }\n                    });\n                }, 10);\n            });\n        },\n        loadLoan() {\n            this.showLoading = true\n            this.loanList = []\n            loanHandler.loanGets().then((res) => {\n                if (res.data.statusCode === 200) {\n                    const data = res.data.data;\n                    if (data.length > 0) {\n                        let d = data.filter((obj) => {return obj.status == 'active'})\n                        if(d.length > 0) {\n                            this.loanList = d\n                        }else{\n                            this.cancel()\n                        }\n                    }\n                }\n            })\n        },\n        generateNumber() {\n            let data = {\n                abbr: this.transactionType.abbr,\n                structure: this.transactionType.structure,\n                transactionDate: this.l.issuedDate,\n                type: \"Close Loan\",\n            };\n            billingHandler\n                .lastNumber(data)\n                .then((response) => {\n                    if (response.data.statusCode === 200) {\n                        const res = response.data.data;\n                        this.suffix = res.suffix;\n                        this.getLastNum();\n                    }\n                })\n                .catch((e) => {\n                    this.errors.push(e);\n                });\n        },\n        getLastNum(){\n            let d = {\n                type: \"CloseLoan\",\n            };\n            loanHandler\n                .getLastNumber(d)\n                .then((response) => {\n                    if (response.data.statusCode === 200) {\n                        this.showLoading = false\n                        const res = response.data.data;\n                        const lastNumber = this.zeroPad(\n                            parseInt(res.lastNumber),\n                            this.transactionType.format\n                        );\n                        this.l.lastNumber = parseInt(res.lastNumber)\n                        const number =\n                            this.suffix +\n                            this.transactionType.numberSeparator +\n                            lastNumber;\n                        let des = ''\n                        if(Object.keys(this.l.loan).length > 0){\n                            des = `Close Loan from ${this.l.loan.financialInstitutions.name} For Loan Number ${this.l.loan.approveNumber}`;\n                        }\n                        window.console.log()\n                        this.journal = new JournalModel({\n                            description: des,\n                            transaction_type: LoanType.CLOSE,\n                            journal_type: LoanType.CLOSE,\n                        });\n                        this.journal.abbr = this.transactionType.abbr\n                        // this.loan.activeDate = new Date().toISOString().substr(0, 10);\n\n                        // Add 2 default rows\n                        // this.addRowT(this.$refs.cashBankAccountDS.kendoWidget());\n                        // for (let index = 0; index < 2; index++) {\n                        //     this.addRow(this.$refs.relatedCostDS.kendoWidget());\n                        // }\n                        this.journal.number = this.transactionType.abbr + this.transactionType.numberSeparator + number\n                        this.l.abbr = this.transactionType.abbr\n                        this.l.number = this.transactionType.abbr + this.transactionType.numberSeparator + number;\n                    }\n                })\n                .catch((e) => {\n                    window.console.log(e);\n                });\n        },\n        async loadPrefix() {\n            this.showLoading = true\n            new Promise((resolve) => {\n                setTimeout(() => {\n                    resolve(\"resolved\");\n                    prefixHandler.get(\"close loan\").then((res) => {\n                        if (res.data.statusCode === 200) {\n                            this.showLoading = false;\n                            this.transactionType = res.data.data[0];\n                            this.generateNumber();\n                        }\n                    });\n                }, 10);\n            });\n        },\n    },\n    computed: {},\n    mounted: async function () {\n        // await this.loadDecimal()\n        await this.loadSaleFormContent()\n        await this.getJournalNumber()\n    },\n    created: async function () {\n        this.addEmpty()\n        await this.loadPrefix()\n        await this.loadAccount()\n    },\n};\n</script>\n\n<style scoped>\n.k-dropdown {\n    width: 100%;\n    margin-top: 4px;\n}\n\n\n.function_content .label {\n    margin-bottom: 10px;\n    display: inline-block;\n}\n\n\n.color_green {\n    color: #03b154;\n}\n\n@media (min-width: 1264px) {\n    .container {\n        /* max-width: 1250px; */\n        max-width: 1080px;\n    }\n}\n\n@media (max-width: 576px) {\n    .pt-6.col-sm-5.col-12 {\n        padding-top: 0 !important;\n    }\n\n    .code_text {\n        width: 100%;\n    }\n\n    .phone_no_pt {\n        padding-top: 0 !important;\n    }\n\n    .select_template,\n    .save_option {\n        margin-bottom: 10px;\n    }\n}\n\n\n.exchange-table.theme--light.v-data-table > .v-data-table__wrapper > table > thead > tr > th {\n    font-family: 'Krasar-Bold', serif;\n    color: #000 !important;\n    border-top: 1px solid #000 !important;\n    border-bottom: 1px solid #000 !important;\n    font-size: 15px !important;\n}\n\n.exchange-table.theme--light.v-data-table > .v-data-table__wrapper > table > thead > tr > td {\n    color: #000 !important;\n    padding: 5px !important;\n    border-bottom: 1px solid #000 !important;\n}\n\n.exchange-table.theme--light.v-data-table > .v-data-table__wrapper > table > tbody > tr:last-child td {\n    border-bottom: 1px solid #000 !important;\n}\n\n.v-slide-group__content {\n    background-color: #F8F8F9 !important;\n}\n\n.v-tab--active {\n    background-color: #ffffff !important;\n    border-left: none;\n}\n\n.function_content {\n    padding: 0;\n    background-color: #F8F8F9;\n}\n\n.v-input--radio-group--row {\n    margin-top: 0px !important;\n    padding: 0px;\n}\n\n.v-input__control {\n    height: 25px !important;\n}\n</style>\n"]}]}